<?php
function CheckValidateSucesionRut_2024($id_comite_save,$rut_colaborador, $r_posicion, $rut_posicion){
    //echo "<br>-> CheckValidateSucesionRut_2024 $id_comite_save $rut_colaborador,$r_posicion <br>";
    $data_col=Sucesion_Colaborador_data_2024($rut_colaborador);
    $data_pos=Sucesion_Colaborador_data_2024($rut_posicion);
        //print_r($data_col);
        // R es menor
    $levels = ["R0", "R1", "R2", "R3", "R4", "R5", "R6", "R7"];
    $CheckOk=0;
        // Example values
    $nivel_r    = $r_posicion;
    $nivel_r2   = $data_col[0]->r;
    //$nivel_r2   =   "R4";
    $index_r = array_search($nivel_r, $levels);
    $index_r2 = array_search($nivel_r2, $levels);

    $result = ($index_r2 > $index_r) ? 1 : 0;
        //echo "<br>-> $nivel_r posicion, $nivel_r2 colaborador, result $result ";
    if($data_col[0]->r<>""){
        // validacion R
        if($result>0){
            //validacion no es parte del equipo
            //$jefe = LimpiaRutFront($data_col[0]->jefe);
            $Comparte_Jefe=Sucesion_Check_Comparte_Jefe_data_2024($rut_colaborador, $data_pos[0]->jefe);
            //echo $Comparte_Jefe;
            if($Comparte_Jefe>0){
                echo "<script>alert('El colaborador no puede ser del mismo equipo del Lider.');</script>";
            } else {
                $CheckOk=1;
            }
            //echo "<br>jefe $jefe"; exit();

        } else {
            echo "<script>alert('El colaborador tiene un Nivel ".$data_col[0]->r.". Recuerda que el colaborador para la matriz de sucesion debe estar un nivel R menor.');</script>";
        }

    }





    return $CheckOk;
}
function Ficha_colaborador_Sucesion_fn($PRINCIPAL, $rut, $perfil, $filtro, $id_empresa){

    $Usu=DatosUsuario_($rut, $id_empresa);
    //echo "<br>-> Rut $rut";
    $Data=DatosDataBci2021($rut);
    $Perfil=Perfil_Acceso_SN_data($_SESSION["user_"]);
    //echo "<h1>perfil $Perfil</h1>";
    $avatar=$Usu[0]->avatar;
    $avatar = str_replace("s96-c",      "s180-c",           $avatar);
    //echo "avatar $avatar";
    if($avatar==""){$avatar="https://www.potencialbci.cl/front/img/sinfoto.png";}
    $PRINCIPAL = str_replace("{AVATAR_COLABORADOR}",       $avatar,                    $PRINCIPAL);
    $PRINCIPAL = str_replace("{NOMBRE_COLABORADOR}",       utf8_encode($Usu[0]->nombre_completo),           $PRINCIPAL);

    if($Usu[0]->vigencia=="1"){
        $vigente="<a class='btn btn-sm btn-light-warning fw-bold ms-2 fs-8 py-1 px-3' data-bs-target='#kt_modal_upgrade_plan' data-bs-toggle='modal' href='#'>NO ACTIVO</a>";
    } else {
        $vigente="<a class='btn btn-sm btn-light-success fw-bold ms-2 fs-8 py-1 px-3' data-bs-target='#kt_modal_upgrade_plan' data-bs-toggle='modal' href='#'>ACTIVO</a>";
    }

    $PRINCIPAL = str_replace("{VIGENTE}",               $vigente,                    $PRINCIPAL);
    $PRINCIPAL = str_replace("{RUT_COMPLETO}",          $Usu[0]->rut_completo,       $PRINCIPAL);
    $PRINCIPAL = str_replace("{CARGO}",                 $Data[0]->d5,              $PRINCIPAL);
    $PRINCIPAL = str_replace("{POSICION}",              $Data[0]->d6,           $PRINCIPAL);
    $edad=calcular_edad_2023($Data[0]->d18);
    $PRINCIPAL = str_replace("{EMAIL}",                 $Data[0]->d17,          $PRINCIPAL);
    $PRINCIPAL = str_replace("{ANTIGUEDAD_BCI}",        $Data[0]->d13,           $PRINCIPAL);
    $PRINCIPAL = str_replace("{ANTIGUEDAD_CARGO}",      $Data[0]->d14,           $PRINCIPAL);
    $PRINCIPAL = str_replace("{ANTIGUEDAD_POSICION}",   Ficha_Traduccion_Fecha_espanol(Ficha_Potencial_Fecha_Posicion_data($rut)),  $PRINCIPAL);
    $PRINCIPAL = str_replace("{FECHA_NACIMIENTO}",      $Data[0]->d18,           $PRINCIPAL);
    $PRINCIPAL = str_replace("{ANTIGUEDAD_BCI_YEARS}",        calcular_edad_2023($Data[0]->d13),          $PRINCIPAL);
    $PRINCIPAL = str_replace("{ANTIGUEDAD_CARGO_YEARS}",      calcular_edad_2023($Data[0]->d14),          $PRINCIPAL);
    $PRINCIPAL = str_replace("{ANTIGUEDAD_POSICION_YEARS}",   calcular_edad_2023(Ficha_Traduccion_Fecha_espanol(Ficha_Potencial_Fecha_Posicion_data($rut))),          $PRINCIPAL);
    $PRINCIPAL = str_replace("{EDAD}",                  $edad,                   $PRINCIPAL);

    $NivelHay=Ficha_NivelHay_data($rut);
    $nivel_HAY_txt="Nivel HAY: ".$NivelHay;
    $PRINCIPAL = str_replace("{GERENCIA}",              $Data[0]->d7,          $PRINCIPAL);
    $PRINCIPAL = str_replace("{FONDO}",                 $Data[0]->d8,          $PRINCIPAL);
    $PRINCIPAL = str_replace("{DEPENDENCIA}",           $Data[0]->d9,          $PRINCIPAL);
    $PRINCIPAL = str_replace("{NIVEL_HAY}",              $nivel_HAY_txt,         $PRINCIPAL);
    $UsuSSNN=DatosUsuario_(LimpiaRutFront($Data[0]->d11), $id_empresa);
    $UsuJEFE=DatosUsuario_(LimpiaRutFront($Data[0]->d12), $id_empresa);

    //echo "<br>->Rut Jefe ".$Data[0]->d12." ".$id_empresa;

    /*$EsJefe=EsJefetblUsuario($rut, $id_empresa);
        if($EsJefe>0){
            $es_jefe="LIDER";
        } else {
            $es_jefe="NO LIDER";
        }*/
    $PRINCIPAL = str_replace("{NOMBRE_SSNN}",      $UsuSSNN[0]->nombre_completo,           $PRINCIPAL);
    $PRINCIPAL = str_replace("{NOMBRE_LIDER}",     $UsuJEFE[0]->nombre_completo,           $PRINCIPAL);
    $PRINCIPAL = str_replace("{TIPO_DE_CARGO}",    "FALTA TIPO CARGO",          $PRINCIPAL);
    $PRINCIPAL = str_replace("{LIDER_NO_LIDER}",   $Data[0]->d10,          $PRINCIPAL);
    $PRINCIPAL = str_replace("{NIVEL_R}",          "Nivel R: ".$Data[0]->d16,          $PRINCIPAL);
    $PRINCIPAL = str_replace("{FACILITADOR_ACADEMIA}",  "",          $PRINCIPAL);
    global $periodo_A,$periodo_B,$periodo_C;
    $PRINCIPAL = str_replace("{YEAR_A}",  $periodo_A,          $PRINCIPAL);
    $PRINCIPAL = str_replace("{YEAR_B}",  $periodo_B,          $PRINCIPAL);
    $PRINCIPAL = str_replace("{YEAR_C}",  $periodo_C,          $PRINCIPAL);
    $Desempeno_ficha_A            =     Ficha_Desempeno_ficha($periodo_A, $rut);
    $Desempeno_promedios_ficha_A  =     Ficha_Desempeno_promedio_ficha($periodo_A, $rut);

    //print_r($Desempeno_promedios_ficha_A);
    if($Desempeno_ficha_A[0]->acd_1_1<>"" and $Desempeno_promedios_ficha_A[0]->promedio==""){
        //echo " calcular promedio -> ";
        $Desempeno_promedios_ficha_A=Ficha_Calculo_Promedio_Competencias_2023_data($rut, $periodo_A);
        $Desempeno_promedios_ficha_A[0]->promedio=round(($Desempeno_promedios_ficha_A[0]->acd+$Desempeno_promedios_ficha_A[0]->imp+$Desempeno_promedios_ficha_A[0]->sac+$Desempeno_promedios_ficha_A[0]->lob)/4,2);
        //print_r($Desempeno_promedios_ficha_A);
    }
    $PRINCIPAL = str_replace("{DESEMPENO_A}",                   $Desempeno_ficha_A[0]->desempeno,          $PRINCIPAL);
    $PRINCIPAL = str_replace("{DESEMPENO_PROMEDIO_A}",          $Desempeno_promedios_ficha_A[0]->promedio,          $PRINCIPAL);
    $PRINCIPAL = str_replace("{DESEMPENO_CATEGORIA1_A}",        $Desempeno_promedios_ficha_A[0]->acd,          $PRINCIPAL);
    $PRINCIPAL = str_replace("{DESEMPENO_SUBCATEGORIA11_A}",    $Desempeno_ficha_A[0]->acd_1_1,          $PRINCIPAL);
    $PRINCIPAL = str_replace("{DESEMPENO_SUBCATEGORIA12_A}",    $Desempeno_ficha_A[0]->acd_2_1,          $PRINCIPAL);
    $PRINCIPAL = str_replace("{DESEMPENO_SUBCATEGORIA13_A}",    $Desempeno_ficha_A[0]->acd_3_1,          $PRINCIPAL);
    $PRINCIPAL = str_replace("{DESEMPENO_CATEGORIA2_A}",        $Desempeno_promedios_ficha_A[0]->imp,          $PRINCIPAL);
    $PRINCIPAL = str_replace("{DESEMPENO_SUBCATEGORIA21_A}",    $Desempeno_ficha_A[0]->imp_1_1,          $PRINCIPAL);
    $PRINCIPAL = str_replace("{DESEMPENO_SUBCATEGORIA22_A}",    $Desempeno_ficha_A[0]->imp_2_1,          $PRINCIPAL);
    $PRINCIPAL = str_replace("{DESEMPENO_SUBCATEGORIA23_A}",    $Desempeno_ficha_A[0]->imp_3_1,          $PRINCIPAL);
    $PRINCIPAL = str_replace("{DESEMPENO_SUBCATEGORIA24_A}",    $Desempeno_ficha_A[0]->imp_4_1,          $PRINCIPAL);
    $PRINCIPAL = str_replace("{DESEMPENO_SUBCATEGORIA25_A}",    $Desempeno_ficha_A[0]->imp_5_1,          $PRINCIPAL);
    $PRINCIPAL = str_replace("{DESEMPENO_CATEGORIA3_A}",        $Desempeno_promedios_ficha_A[0]->sac,          $PRINCIPAL);
    $PRINCIPAL = str_replace("{DESEMPENO_SUBCATEGORIA31_A}",    $Desempeno_ficha_A[0]->sac_1_1,          $PRINCIPAL);
    $PRINCIPAL = str_replace("{DESEMPENO_SUBCATEGORIA32_A}",    $Desempeno_ficha_A[0]->sac_2_1,          $PRINCIPAL);
    $PRINCIPAL = str_replace("{DESEMPENO_SUBCATEGORIA33_A}",    $Desempeno_ficha_A[0]->sac_3_1,          $PRINCIPAL);
    $PRINCIPAL = str_replace("{DESEMPENO_CATEGORIA4_A}",        $Desempeno_promedios_ficha_A[0]->lob,          $PRINCIPAL);
    $PRINCIPAL = str_replace("{DESEMPENO_SUBCATEGORIA41_A}",    $Desempeno_ficha_A[0]->lob_1_1,          $PRINCIPAL);
    $PRINCIPAL = str_replace("{DESEMPENO_SUBCATEGORIA42_A}",    $Desempeno_ficha_A[0]->lob_2_1,          $PRINCIPAL);
    $PRINCIPAL = str_replace("{DESEMPENO_SUBCATEGORIA43_A}",    $Desempeno_ficha_A[0]->lob_3_1,          $PRINCIPAL);

    $Desempeno_ficha_B            =     Ficha_Desempeno_ficha($periodo_B, $rut);
    $Desempeno_promedios_ficha_B  =     Ficha_Desempeno_promedio_ficha($periodo_B, $rut);
    //echo "<br>-> Desempeno_ficha_B <br>"; print_r($Desempeno_ficha_B);
    //echo "<br>-> Desempeno_promedios_ficha_B <br>"; print_r($Desempeno_promedios_ficha_B);

    //print_r($Desempeno_promedios_ficha_B);
    if($Desempeno_ficha_B[0]->acd_1_1<>"" and $Desempeno_promedios_ficha_B[0]->promedio==""){
        //echo " calcular promedio -> ";
        $Desempeno_promedios_ficha_B=Ficha_Calculo_Promedio_Competencias_2023_data($rut, $periodo_B);
        //print_r($Desempeno_promedios_ficha_B);
        $Desempeno_promedios_ficha_B[0]->promedio=round(($Desempeno_promedios_ficha_B[0]->acd+$Desempeno_promedios_ficha_B[0]->imp+$Desempeno_promedios_ficha_B[0]->sac+$Desempeno_promedios_ficha_B[0]->lob)/4,2);
    }

    $PRINCIPAL = str_replace("{DESEMPENO_B}",                   $Desempeno_ficha_B[0]->desempeno,          $PRINCIPAL);
    $PRINCIPAL = str_replace("{DESEMPENO_PROMEDIO_B}",          $Desempeno_promedios_ficha_B[0]->promedio,          $PRINCIPAL);
    $PRINCIPAL = str_replace("{DESEMPENO_CATEGORIA1_B}",        $Desempeno_promedios_ficha_B[0]->acd,          $PRINCIPAL);
    $PRINCIPAL = str_replace("{DESEMPENO_SUBCATEGORIA11_B}",    $Desempeno_ficha_B[0]->acd_1_1,          $PRINCIPAL);
    $PRINCIPAL = str_replace("{DESEMPENO_SUBCATEGORIA12_B}",    $Desempeno_ficha_B[0]->acd_2_1,          $PRINCIPAL);
    $PRINCIPAL = str_replace("{DESEMPENO_SUBCATEGORIA13_B}",    $Desempeno_ficha_B[0]->acd_3_1,          $PRINCIPAL);
    $PRINCIPAL = str_replace("{DESEMPENO_CATEGORIA2_B}",        $Desempeno_promedios_ficha_B[0]->imp,          $PRINCIPAL);
    $PRINCIPAL = str_replace("{DESEMPENO_SUBCATEGORIA21_B}",    $Desempeno_ficha_B[0]->imp_1_1,          $PRINCIPAL);
    $PRINCIPAL = str_replace("{DESEMPENO_SUBCATEGORIA22_B}",    $Desempeno_ficha_B[0]->imp_2_1,          $PRINCIPAL);
    $PRINCIPAL = str_replace("{DESEMPENO_SUBCATEGORIA23_B}",    $Desempeno_ficha_B[0]->imp_3_1,          $PRINCIPAL);
    $PRINCIPAL = str_replace("{DESEMPENO_SUBCATEGORIA24_B}",    $Desempeno_ficha_B[0]->imp_4_1,          $PRINCIPAL);
    $PRINCIPAL = str_replace("{DESEMPENO_SUBCATEGORIA25_B}",    $Desempeno_ficha_B[0]->imp_5_1,          $PRINCIPAL);
    $PRINCIPAL = str_replace("{DESEMPENO_CATEGORIA3_B}",        $Desempeno_promedios_ficha_B[0]->sac,          $PRINCIPAL);
    $PRINCIPAL = str_replace("{DESEMPENO_SUBCATEGORIA31_B}",    $Desempeno_ficha_B[0]->sac_1_1,          $PRINCIPAL);
    $PRINCIPAL = str_replace("{DESEMPENO_SUBCATEGORIA32_B}",    $Desempeno_ficha_B[0]->sac_2_1,          $PRINCIPAL);
    $PRINCIPAL = str_replace("{DESEMPENO_SUBCATEGORIA33_B}",    $Desempeno_ficha_B[0]->sac_3_1,          $PRINCIPAL);
    $PRINCIPAL = str_replace("{DESEMPENO_CATEGORIA4_B}",        $Desempeno_promedios_ficha_B[0]->lob,          $PRINCIPAL);
    $PRINCIPAL = str_replace("{DESEMPENO_SUBCATEGORIA41_B}",    $Desempeno_ficha_B[0]->lob_1_1,          $PRINCIPAL);
    $PRINCIPAL = str_replace("{DESEMPENO_SUBCATEGORIA42_B}",    $Desempeno_ficha_B[0]->lob_2_1,          $PRINCIPAL);
    $PRINCIPAL = str_replace("{DESEMPENO_SUBCATEGORIA43_B}",    $Desempeno_ficha_B[0]->lob_3_1,          $PRINCIPAL);

    $Desempeno_ficha_C            =     Ficha_Desempeno_ficha($periodo_C, $rut);
    $Desempeno_promedios_ficha_C  =     Ficha_Desempeno_promedio_ficha($periodo_C, $rut);
    //print_r($Desempeno_promedios_ficha_C);
    if($Desempeno_ficha_C[0]->acd_1_1<>"" and $Desempeno_promedios_ficha_C[0]->promedio==""){
        //echo " calcular promedio -> ";
        $Desempeno_promedios_ficha_C=Ficha_Calculo_Promedio_Competencias_2023_data($rut, $periodo_C);
        //print_r($Desempeno_promedios_ficha_B);
        $Desempeno_promedios_ficha_C[0]->promedio=round(($Desempeno_promedios_ficha_C[0]->acd+$Desempeno_promedios_ficha_C[0]->imp+$Desempeno_promedios_ficha_C[0]->sac+$Desempeno_promedios_ficha_C[0]->lob)/4,2);
    }

    $PRINCIPAL = str_replace("{DESEMPENO_C}",                   $Desempeno_ficha_C[0]->desempeno,          $PRINCIPAL);
    $PRINCIPAL = str_replace("{DESEMPENO_PROMEDIO_C}",          $Desempeno_promedios_ficha_C[0]->promedio,          $PRINCIPAL);
    $PRINCIPAL = str_replace("{DESEMPENO_CATEGORIA1_C}",        $Desempeno_promedios_ficha_C[0]->acd,          $PRINCIPAL);
    $PRINCIPAL = str_replace("{DESEMPENO_SUBCATEGORIA11_C}",    $Desempeno_ficha_C[0]->acd_1_1,          $PRINCIPAL);
    $PRINCIPAL = str_replace("{DESEMPENO_SUBCATEGORIA12_C}",    $Desempeno_ficha_C[0]->acd_2_1,          $PRINCIPAL);
    $PRINCIPAL = str_replace("{DESEMPENO_SUBCATEGORIA13_C}",    $Desempeno_ficha_C[0]->acd_3_1,          $PRINCIPAL);
    $PRINCIPAL = str_replace("{DESEMPENO_CATEGORIA2_C}",        $Desempeno_promedios_ficha_C[0]->imp,          $PRINCIPAL);
    $PRINCIPAL = str_replace("{DESEMPENO_SUBCATEGORIA21_C}",    $Desempeno_ficha_C[0]->imp_1_1,          $PRINCIPAL);
    $PRINCIPAL = str_replace("{DESEMPENO_SUBCATEGORIA22_C}",    $Desempeno_ficha_C[0]->imp_2_1,          $PRINCIPAL);
    $PRINCIPAL = str_replace("{DESEMPENO_SUBCATEGORIA23_C}",    $Desempeno_ficha_C[0]->imp_3_1,          $PRINCIPAL);
    $PRINCIPAL = str_replace("{DESEMPENO_SUBCATEGORIA24_C}",    $Desempeno_ficha_C[0]->imp_4_1,          $PRINCIPAL);
    $PRINCIPAL = str_replace("{DESEMPENO_SUBCATEGORIA25_C}",    $Desempeno_ficha_C[0]->imp_5_1,          $PRINCIPAL);
    $PRINCIPAL = str_replace("{DESEMPENO_CATEGORIA3_C}",        $Desempeno_promedios_ficha_C[0]->sac,          $PRINCIPAL);
    $PRINCIPAL = str_replace("{DESEMPENO_SUBCATEGORIA31_C}",    $Desempeno_ficha_C[0]->sac_1_1,          $PRINCIPAL);
    $PRINCIPAL = str_replace("{DESEMPENO_SUBCATEGORIA32_C}",    $Desempeno_ficha_C[0]->sac_2_1,          $PRINCIPAL);
    $PRINCIPAL = str_replace("{DESEMPENO_SUBCATEGORIA33_C}",    $Desempeno_ficha_C[0]->sac_3_1,          $PRINCIPAL);
    $PRINCIPAL = str_replace("{DESEMPENO_CATEGORIA4_C}",        $Desempeno_promedios_ficha_C[0]->lob,          $PRINCIPAL);
    $PRINCIPAL = str_replace("{DESEMPENO_SUBCATEGORIA41_C}",    $Desempeno_ficha_C[0]->lob_1_1,          $PRINCIPAL);
    $PRINCIPAL = str_replace("{DESEMPENO_SUBCATEGORIA42_C}",    $Desempeno_ficha_C[0]->lob_2_1,          $PRINCIPAL);
    $PRINCIPAL = str_replace("{DESEMPENO_SUBCATEGORIA43_C}",    $Desempeno_ficha_C[0]->lob_3_1,          $PRINCIPAL);

    if($Desempeno_ficha_C[0]->desempeno<>""){} else {$PRINCIPAL = str_replace("{DESEMPENO_C_DISPLAY}", "display:none!important;",  $PRINCIPAL);}
    if($Desempeno_ficha_B[0]->desempeno<>""){} else {$PRINCIPAL = str_replace("{DESEMPENO_B_DISPLAY}", "display:none!important;",  $PRINCIPAL);}
    if($Desempeno_ficha_A[0]->desempeno<>""){} else {$PRINCIPAL = str_replace("{DESEMPENO_A_DISPLAY}", "display:none!important;",  $PRINCIPAL);}

    //desempeno_metas

    $Meta_A = utf8_decode(Ficha_Desempeno_Metas_2023_data($rut, $periodo_A));
    $Meta_B = utf8_decode(Ficha_Desempeno_Metas_2023_data($rut, $periodo_B));
    $Meta_C = utf8_decode(Ficha_Desempeno_Metas_2023_data($rut, $periodo_C));
    $PRINCIPAL = str_replace("{METAS_A}",  $Meta_A,          $PRINCIPAL);
    $PRINCIPAL = str_replace("{METAS_B}",  $Meta_B,          $PRINCIPAL);
    $PRINCIPAL = str_replace("{METAS_C}",  $Meta_C,          $PRINCIPAL);

    if($Meta_C<>""){} else {$PRINCIPAL = str_replace("{METAS_C_DISPLAY}", "display:none!important;",  $PRINCIPAL);}
    if($Meta_B<>""){} else {$PRINCIPAL = str_replace("{METAS_B_DISPLAY}", "display:none!important;",  $PRINCIPAL);}
    if($Meta_A<>""){} else {$PRINCIPAL = str_replace("{METAS_A_DISPLAY}", "display:none!important;",  $PRINCIPAL);}

    $Cuadrante_Vigente = (Ficha_Cuadrantes_2023_data($rut, "vigente"));
    $Cuadrante_Anterior = (Ficha_Cuadrantes_2023_data($rut, "anterior"));
    //print_r($Cuadrante_Vigente);
    //echo "<br>Cuadrante_Vigente ".$Cuadrante_Vigente[0]->cuadrante."  Cuadrante_Anterior ".$Cuadrante_Anterior[0]->cuadrante;

    /*if($Perfil=="TALENTO"){

    } else {
        $Cuadrante_Vigente = (Ficha_Cuadrantes_2023_data($rut, "vigente"));
        $Cuadrante_Anterior = (Ficha_Cuadrantes_2023_data($rut, "anterior"));
    }*/

    $PRINCIPAL = str_replace("{CUADRANTE_VIGENTE}",        $Cuadrante_Vigente[0]->cuadrante,          $PRINCIPAL);
    $PRINCIPAL = str_replace("{CUADRANTE_FECHA_VIGENTE}",  Ficha_Traduccion_Fecha_espanol($Cuadrante_Vigente[0]->fecha),          $PRINCIPAL);
    $PRINCIPAL = str_replace("{CUADRANTE_VIGENTE_CLASE}",  $Cuadrante_Vigente[0]->clase,          $PRINCIPAL);
    $PRINCIPAL = str_replace("{CUADRANTE_ANTERIOR}",        $Cuadrante_Anterior[0]->cuadrante,          $PRINCIPAL);
    $PRINCIPAL = str_replace("{CUADRANTE_FECHA_ANTERIOR}",  Ficha_Traduccion_Fecha_espanol($Cuadrante_Anterior[0]->fecha),          $PRINCIPAL);
    $PRINCIPAL = str_replace("{CUADRANTE_ANTERIOR_CLASE}",  $Cuadrante_Anterior[0]->clase,          $PRINCIPAL);


    if($Cuadrante_Vigente[0]->cuadrante==""){
        $PRINCIPAL = str_replace("{DISPLAY_POTENCIAL}",      "display:none!important;",          $PRINCIPAL);
    }
    if($Cuadrante_Anterior[0]->cuadrante==""){
        $PRINCIPAL = str_replace("{DISPLAY_POTENCIAL_ANTERIOR}",      "display:none!important;",          $PRINCIPAL);
    }

    $ENGAGEMENT_A   = Ficha_Engagement_2023_data($rut, $periodo_A);
    $ENGAGEMENT_B   = Ficha_Engagement_2023_data($rut, $periodo_B);
    $ENGAGEMENT_C   = Ficha_Engagement_2023_data($rut, $periodo_C);
    $PRINCIPAL = str_replace("{ENGAGEMENT_A}",  $ENGAGEMENT_A,          $PRINCIPAL);
    $PRINCIPAL = str_replace("{ENGAGEMENT_B}",  $ENGAGEMENT_B,          $PRINCIPAL);
    $PRINCIPAL = str_replace("{ENGAGEMENT_C}",  $ENGAGEMENT_C,          $PRINCIPAL);

    if($ENGAGEMENT_C<>""){} else {$PRINCIPAL = str_replace("{ENGAGEMENT_C_DISPLAY}", "display:none!important;",  $PRINCIPAL);}
    if($ENGAGEMENT_B<>""){} else {$PRINCIPAL = str_replace("{ENGAGEMENT_B_DISPLAY}", "display:none!important;",  $PRINCIPAL);}
    if($ENGAGEMENT_A<>""){} else {$PRINCIPAL = str_replace("{ENGAGEMENT_A_DISPLAY}", "display:none!important;",  $PRINCIPAL);}

    $CLIMA_A   = Ficha_Clima_2023_data($rut, $periodo_A);
    $CLIMA_B   = Ficha_Clima_2023_data($rut, $periodo_B);
    $CLIMA_C   = Ficha_Clima_2023_data($rut, $periodo_C);
    $PRINCIPAL = str_replace("{CLIMA_A}",  $CLIMA_A,          $PRINCIPAL);
    $PRINCIPAL = str_replace("{CLIMA_B}",  $CLIMA_B,          $PRINCIPAL);
    $PRINCIPAL = str_replace("{CLIMA_C}",  $CLIMA_C,          $PRINCIPAL);

    if($CLIMA_C<>""){} else {$PRINCIPAL = str_replace("{CLIMA_C_DISPLAY}", "display:none!important;",  $PRINCIPAL);}
    if($CLIMA_B<>""){} else {$PRINCIPAL = str_replace("{CLIMA_B_DISPLAY}", "display:none!important;",  $PRINCIPAL);}
    if($CLIMA_A<>""){} else {$PRINCIPAL = str_replace("{CLIMA_A_DISPLAY}", "display:none!important;",  $PRINCIPAL);}

    if($ENGAGEMENT_A=="" and $ENGAGEMENT_B==""  and $ENGAGEMENT_B=="" and $CLIMA_A=="" and $CLIMA_B=="" and $CLIMA_C==""){
        $PRINCIPAL = str_replace("{DISPLAY_ENGAGEMENT_CLIMA}",  "display:none!important",          $PRINCIPAL);
    }

    $SkillChallenge=Ficha_SkillChallenge_2023_data($rut);
    foreach ($SkillChallenge as $sk){
        $cuenta_skillchallenges++;
        IF($sk->estado_skill_cursos=="EXIMIDA_AUTO"){
            $sk->estado_skill_cursos="Skill Eximida";
        }
        $row_skill_challenge.="  <tr><td class='ps-9'><span class='badge badge-light-primary fs-7 fw-bold'>".utf8_encode($sk->skill)."</span></td>
                                        <td class='ps-0'><a class='text-hover-primary text-gray-600' href=''>".utf8_encode($sk->nom_nivel_skill)."</a></td>
                                        <td>".utf8_encode($sk->estado_skill_cursos)."</td>
                                    </tr>";
        $cargo_oficial_sk=$sk->cargo;
    }
    $PRINCIPAL = str_replace("{CARGO_OFICIAL_SKILLCHALLENGE}",              utf8_decode($cargo_oficial_sk),          $PRINCIPAL);
    $PRINCIPAL = str_replace("{FICHA_COLABORADOR_ROW_SKILL_CHALLENGE}",     utf8_decode($row_skill_challenge),          $PRINCIPAL);

    if($cuenta_skillchallenges>0){
        $display_none_skillchallenge=" ";
    } else {
        $display_none_skillchallenge=" display:none !important; ";
    }
    $PRINCIPAL = str_replace("{DISPLAY_NONE_SKILL_CHALLENGE}",  $display_none_skillchallenge,          $PRINCIPAL);

    $Premiaciones=Ficha_Premiaciones_2023_data($rut);
    foreach ($Premiaciones as $pr){
        $cuenta_premiaciones++;
        $row_premiaciones.="        <tr>
                                        <td class='ps-9'><span class='badge badge-light-primary fs-7 fw-bold'>".utf8_encode($pr->tipo)."</span></td>
                                        <td class='ps-0'><a class='text-hover-primary text-gray-600' href='' style='padding-left: 10px;'>".utf8_encode($pr->periodo)."</a></td>
                                    </tr>";
    }

    if($cuenta_premiaciones>0){
        $PRINCIPAL = str_replace("{ROW_FICHA_COLABORADOR_PREMIACIONES_2023}",  utf8_decode($row_premiaciones),          $PRINCIPAL);
    } else {
        $PRINCIPAL = str_replace("{DISPLAY_NONE_PREMIACIONES_2023}",  "display:none!important;",          $PRINCIPAL);
        $PRINCIPAL = str_replace("{DISPLAY_PREMIACIONES}",  "display:none!important;",          $PRINCIPAL);
        $PRINCIPAL = str_replace("{ROW_FICHA_COLABORADOR_PREMIACIONES_2023}",  "<div style='padding-left: 30px;'>Sin Premiaciones</div>",          $PRINCIPAL);
    }

    $AccionesDesarrollo=Ficha_AccionesDesarrollo_2023_data($rut);
    //print_r($AccionesDesarrollo);
    foreach ($AccionesDesarrollo as $ad){
        $cuenta_accionesdesarrollo++;
        $row_acciones_desarrollo.="  <tr><td class='ps-9'><span class='badge badge-light-primary fs-7 fw-bold'>".utf8_encode($ad->tipo)."</span></td>
                                        <td class='ps-0'><a class='text-hover-primary text-gray-600' href=''  style='padding-left: 10px;'>".utf8_encode($ad->periodo)."</a></td>
                                    </tr>";
    }
    if($cuenta_accionesdesarrollo>0){
        $PRINCIPAL = str_replace("{ROW_FICHA_COLABORADOR_ACCIONES_DESARROLLO_2023}",  utf8_decode($row_acciones_desarrollo),          $PRINCIPAL);
    } else {
        $PRINCIPAL = str_replace("{ROW_FICHA_COLABORADOR_ACCIONES_DESARROLLO_2023}",  "<div style='padding-left: 30px;'>Sin Acciones de Desarrollo</div>",          $PRINCIPAL);
        $PRINCIPAL = str_replace("{DISPLAY_NONE_ACCIONES_DESARROLLO_2023}",  "display:none!important;",          $PRINCIPAL);
        $PRINCIPAL = str_replace("{DISPLAY_ACCIONES}",  "display:none!important;",          $PRINCIPAL);
    }
    return ($PRINCIPAL);
}
function SucesionEstadoTareaComite($id_comite,$tipo_estado,$rut_tarea, $fecha_inicio, $fecha_cierre, $posicion){

    $hoy=date("Y-m-d");
    // echo "<br>-> $id_comite,$tipo_estado,$rut_tarea, $fecha_inicio, $fecha_cierre, posicion $posicion";

    if($tipo_estado=="comite"){
        $cuenta_colaboradores=Sucesion_EstadoComite_Cuenta_colaboradores_propuestos($id_comite);
        // "<br>-> cuenta_colaboradores $cuenta_colaboradores $id_comite";
        $estado_comite_tarea="<span class='badge badge-warning'>No Iniciado</span><br>";
        if($fecha_cierre<$hoy){
            $estado_comite_tarea="<span class='badge badge-danger'>Finalizado</span><br>";
        }
        if($cuenta_colaboradores>0){
            $estado_comite_tarea="<span class='badge badge-primary'>En Proceso</span><br>";
        }
    }
    if($tipo_estado=="tarea") {
            //echo "<br>tarea $posicion $id_comite";
        $Inmediato = PotencialSucesion_Vista_Colaboradores_Tarea_Posicion_2024($id_comite, "", "", "1", $posicion);
        $Mediano = PotencialSucesion_Vista_Colaboradores_Tarea_Posicion_2024($id_comite, "", "", "2", $posicion);
        $Largo = PotencialSucesion_Vista_Colaboradores_Tarea_Posicion_2024($id_comite, "", "", "3", $posicion);
            //echo "<br> I " . ($Inmediato) . " M " . ($Mediano) . " L " . ($Largo) . " ";
        $estado_comite_tarea="<span class='badge badge-warning'>No Iniciado</span><br>";
        if($Inmediato>0 or $Mediano>0 or $Largo>0){
            $estado_comite_tarea="<span class='badge badge-danger'>Incompleto</span><br>";
        }
        if($Inmediato>0 and $Mediano>0 and $Largo>0){
            $estado_comite_tarea="<span class='badge badge-primary'>En Proceso</span><br>";
        }


    }
    return $estado_comite_tarea;
}
function Potencial_Sucesion_Colaboradores_Comites_Ficha_2024($PRINCIPAL, $id_comite, $rut, $perfil, $posicion, $id_empresa)
{
    $MiRx=MiRx($_SESSION["user_"]);
    //echo "potencial_ficha_sucesion mi Rx $MiRx";
    if($perfil=="LIDER"){
        $display_acciones_desarrollo = " display:none; ";
    } else {
        $display_acciones_desarrollo = "  ";
    }
    $array_comite=Potencial_Comites_Suc_data($id_comite,$id_empresa);
    //print_r($array_comite);
    $comite_cerrado_esta=$array_comite[0]->comite_cerrado;

        //todo0s agregan acciones desarrollo
    $display_acciones_desarrollo = "  ";
        //Rx $MiRx";

    if($perfil=="LIDER"){
        $display_acciones_desarrollo = " display:none; ";
    } else {
        $display_acciones_desarrollo = "  ";
    }

    $array_comite=Potencial_Comites_Suc_data($id_comite,$id_empresa);
    //print_r($array_comite);

    $comite_cerrado_esta=$array_comite[0]->comite_cerrado;

    //todo0s agregan acciones desarrollo
    $display_acciones_desarrollo = "  ";
    $row_inmediato="";
    $row_lista1="";
    $Inmediato=PotencialSucesion_Vista_Colaboradores_Posicion_2024($id_comite, $unico->rut, $id_empresa, "1", $posicion);
    //print_r($Inmediato);
    foreach ($Inmediato as $uni1){
        if($comite_cerrado_esta=="SI" and $uni1->estado=="No es sucesor"){
           // continue;
        }
        $Usua1=DatosUsuario_($uni1->rut_col, $id_empresa);
            //echo "<br>-> Usu1 ".$Usua1[0]->vigencia_descripcion;
        if($Usua1[0]->vigencia_descripcion=="Externo"){
            $row_lista1.= file_get_contents("views/sucesion/sucesion_row_colaboradores_comites_sucesion_avatar_externos.html");
        } else {
            $row_lista1.= file_get_contents("views/sucesion/sucesion_row_colaboradores_comites_sucesion_avatar.html");
            $row_lista1=Ficha_colaborador_Sucesion_fn($row_lista1, $uni1->rut_col, $perfil, $filtro, $id_empresa);
        }
        $row_lista1 = str_replace("{CARGO_EXTERNO}", 			$Usua1[0]->cargo, $row_lista1);

        $row_lista1 = str_replace("{AVATAR_RUT_SUCESORES}",   				VerificaFotoPersonal($uni1->rut_col), $row_lista1);
        $RxCol=MiRx($uni1->rut_col);
        $visualiza1=CheckVisualizaMiRxRxCol($MiRx, $RxCol);

        $es_posicion_clave=Pot_CheckPosicion_Clave($uni1->rut_col);
        if($es_posicion_clave>0){
            $posicion_clave	=" <div class='badge badge-gray' style='    background-color: transparent !important;padding-left: 0px!important;'><center></center></div><br>";
        } else {
            $posicion_clave="";
        }
        $row_lista1 = str_replace("{POSICION_CLAVE}", 			$posicion_clave, $row_lista1);
        $Num_Sucesion=Potencial_Sucesion_Num_Sucesores_2024($uni1->rut_col);
        if($Cuad_2020<>""){
            if($Cuad_2020=="10"){$Cuad_2020="5+";}
            $cuadrante_2020="Cuadrante Actual: $Cuad_2020";
        } else {
            $cuadrante_2020="Sin cuadrante actual";
        }
        if($Num_Sucesion>0){
            $num_sucesion_2020="Veces como sucesor: $Num_Sucesion";
        } else {
            $num_sucesion_2020="1 vez como sucesor";
        }
        /*$Usua=DatosUsuario_($uni1->rut_col, $id_empresa);
        if($Usua[0]->gerencia=="GERENCIA CORPORATIVA GESTION PERSONAS"){
            $cuadrante_2020="";
        }*/
        if($visualiza1=="NO"){$num_sucesion_2020="";}
        if($visualiza1=="NO"){$cuadrante_2020="";}
        $row_lista1 = str_replace("{CARGO_CUDRANTE_SUCESORES}",   $cuadrante_2020, $row_lista1);
        $row_lista1 = str_replace("{CARGO_VECES_SUCESOR}",     		$num_sucesion_2020, $row_lista1);
        $estado_badge_avatar="";
        if($uni1->estado=="No es sucesor"){
            if($uni1->rutlider==""){
                $estado_badge_avatar="<span class='badge badge-danger' style='color:#fff'>No es Sucesor</span>";
            } else {
                $estado_badge_avatar="<span class='badge badge-danger' style='color:#fff'>No es Sucesor</span> <span style='font-size: 12px;display:none;'>Sugerido por L&iacute;der</span>";
            }
        }
        if($uni1->estado=="Es Sucesor"){
            if($uni1->rutlider==""){
                $estado_badge_avatar="<span class='badge badge-info' style='color:#fff'>Es Sucesor</span> - <span style='font-size: 12px;'>Propuesta de Sucesi&oacute;n</span>";
            } else {
                $estado_badge_avatar="<span class='badge badge-info' style='color:#fff'>Es Sucesor</span> <span style='font-size: 12px;display:none;'>Sugerido por L&iacute;der</span>";
            }
        }
        if($comite_cerrado_esta=="SI" and $uni1->estado=="Es Sucesor"){
            $estado_badge_avatar="";
        }
        $row_lista1 = str_replace("{NO_ES_SUCESOR_ESTADO_BADGE}",     		$estado_badge_avatar, $row_lista1);
        $row_lista1 = str_replace("{COLABORADOR_SUCESORES}",     ($Usua1[0]->nombre_completo), $row_lista1);
        $posicion1=Potencial_Sucesion_d6_d5($uni1->rut_col);
        $row_lista1 = str_replace("{POSICION_SUCESORES}",        ($posicion1[0]->d6), $row_lista1);
        $row_lista1 = str_replace("{CARGO_SUCESORES}",           ($posicion1[0]->d5), $row_lista1);
        $row_lista1 = str_replace("{RUT_SUCESORES}",           	 ($uni1->rut_col), $row_lista1);
        $row_lista1 = str_replace("{RUT_SUCESORES_ENC}",         Encodear3($uni1->rut_col), $row_lista1);
        $row_lista1 = str_replace("{ID_SUCESORES}",           	 Encodear3($uni1->id), $row_lista1);
        $row_lista1 = str_replace("{ID_POSICION_ENC}",           Encodear3($posicion), $row_lista1);
        $row_lista1 = str_replace("{ID_COMITE_ENC}",           	 Encodear3($id_comite), $row_lista1);
        $row_lista1 = str_replace("{ID_COL}",           				 Encodear3($uni1->id), $row_lista1);
        $row_lista1 = str_replace("{PERFIL_ENC}",           		Encodear3($perfil), $row_lista1);
        $row_lista1 = str_replace("{ACTUAL_TEMPORALIDAD}",      "Inmediato", $row_lista1);
        $row_lista1 = str_replace("{ID_ACTUAL_TEMPORALIDAD}",      "1", $row_lista1);
        $sucesion_display_none="";
        if($visualiza1=="NO"){$sucesion_display_none=" display:none; ";}
        $row_lista1 = str_replace("{sucesion_display_none}",      $sucesion_display_none, $row_lista1);
        $row_lista1 = str_replace("{RUT}",              ($uni1->rut), $row_lista1);
        $row_lista1 = str_replace("{COLABORADOR}",   	($uni1->nombre_completo), $row_lista1);
        $row_lista1 = str_replace("{CARGO_COL}",   		($uni1->cargo_col), $row_lista1);
        if($visualiza1=="NO"){
            $row_lista1 = str_replace("{BOTON_VER_FICHA}","", $row_lista1);
            $row_lista1 = str_replace("{BOTON_VER_FICHA_A_inicial}","", $row_lista1);
            $row_lista1 = str_replace("{BOTON_VER_FICHA_B_final}","", $row_lista1);
        } else {
            $row_lista1 = str_replace("{BOTON_VER_FICHA}","<a href='?sw=potencial_fichaxxx&rut_col=".Encodear3($uni1->rut_col)."&id_comite=".Encodear3($id_comite)."&sucesion=1&sucesion=1&sucesion=1&id_posicion_enc=".Encodear3($posicion)."' class='btn btn-link' >
			        <span class='azul_comite'><i class='fas fa-user'></i> <span class='mt-comment-authorSM'> Ficha</span></span></a>", $row_lista1);
            $row_lista1 = str_replace("{BOTON_VER_FICHA_A_inicial}","<a href='?sw=potencial_ficha&rut_col=".Encodear3($uni1->rut_col)."&id_comite=".Encodear3($id_comite)."&sucesion=1&sucesion=1&id_posicion_enc=".Encodear3($posicion)."'
						   class='btn btn-link' style='padding-left: 0px;    padding-left: 0px;text-align: left;padding-right: 0px;'>", $row_lista1);
            $row_lista1 = str_replace("{BOTON_VER_FICHA_B_final}","</a>", $row_lista1);
        }
        $row_lista1 = str_replace("{STYLO_AGREGAR_ACCIONES_DESARROLLO}", $display_acciones_desarrollo, $row_lista1);
        $row_lista1_acciones="";

        $row_bitacora1="";
        $Bitacora1=SucesionBitacora_2024($uni1->rut_col, $id_comite);
        foreach ($Bitacora1 as $b1){
            $row_bitacora1.="<br> <i class='bi bi-arrow-right-short'></i> ".$b1->comentario;
        }
        $row_lista1 = str_replace("{BITACORA}",$row_bitacora1, $row_lista1);

        /*$Potencial_Acciones_Desarrollo	=	Potencial_Busca_Acciones_Desarrollo($uni1->rut_col);
        if(count($Potencial_Acciones_Desarrollo)>0){
            foreach ($Potencial_Acciones_Desarrollo as $un1){
                $row_lista1_acciones.=" 
						  		
						  		<i class='far fa-file-alt'></i> 
						  				".$un1->plan."
						  				<span class='pull-right'><a href='?sw=potencial_ficha_sucesion&id_posicion_enc=".Encodear3($posicion)."&id_comite=".Encodear3($id_comite)."&perfil=".Encodear3($perfil)."&delad=".Encodear3($un1->id)."'><i class='far fa-trash-alt' style='color: #337ab7;'></i></a></span>
						  		<br>
						  		<i class='fas fa-chevron-right' style='padding-left: 20px;'></i> 
						  				".$un1->fundamento."
						  	<br>";
            }
            $row_lista1 = str_replace("{ACCIONES_DE_DESARROLLO_TITULO1}", "<div class='txt_2020' data-toggle='collapse' href='#collapseExample2_".$uni1->rut_col."' role='button' aria-expanded='false' aria-controls='collapseExample2'>Acciones de Desarrollo</div>", $row_lista1);
            $row_lista1 = str_replace("{ACCIONES_DE_DESARROLLO}", $row_lista1_acciones, $row_lista1);
        } else {
            $row_lista1 = str_replace("{ACCIONES_DE_DESARROLLO}", "", $row_lista1);
            $row_lista1 = str_replace("{ACCIONES_DE_DESARROLLO_TITULO1}", "", $row_lista1);
        }
        $Potencial_Bitacora_Desarrollo	=	Potencial_Busca_Bitacora_Desarrollo($uni1->rut_col);
        $row_lista1_bitacora="";
        if(count($Potencial_Bitacora_Desarrollo)>0){
            foreach ($Potencial_Bitacora_Desarrollo as $un1){
                $row_lista1_bitacora.=" 
						  		
						  		".$un1->comite." - Sucesi&oacute;n - ".$un1->fecha." 
						  				 <br> ".$un1->nombre_completo." <br>  ".$un1->accion." ".$un1->comentario."
						  				<!--<span class='pull-right'><a href='?sw=potencial_ficha_sucesion&id_posicion_enc=".Encodear3($posicion)."&id_comite=".Encodear3($id_comite)."&perfil=".Encodear3($perfil)."&delad=".Encodear3($un1->id)."'><i class='far fa-trash-alt' style='color: #337ab7;'></i></a></span>-->
						  	<br><br>";
            }
            $row_lista1 = str_replace("{BITACORA_DE_DESARROLLO_TITULO1}", "<div class='txt_2020' data-toggle='collapse' href='#collapseExample1_".$uni1->rut_col."' role='button' aria-expanded='false' aria-controls='collapseExample'>Bit&aacute;cora de Sucesi&oacute;n</div>", $row_lista1);
            $row_lista1 = str_replace("{BITACORA_DE_DESARROLLO}", $row_lista1_bitacora, $row_lista1);
        } else {
            $row_lista1 = str_replace("{BITACORA_DE_DESARROLLO_TITULO1}", "", $row_lista1);
            $row_lista1 = str_replace("{BITACORA_DE_DESARROLLO}", "", $row_lista1);
        }*/
    }

    $row_mediano="";
    $row_lista2="";
    $Mediano=PotencialSucesion_Vista_Colaboradores_Posicion_2024($id_comite, $unico->rut, $id_empresa, "2", $posicion);
    //echo "mediano";
            //print_r($Mediano);
    foreach ($Mediano as $uni2){
        if($comite_cerrado_esta=="SI" and $uni2->estado=="No es sucesor"){
           // continue;
        }
        $Usua2=DatosUsuario_($uni2->rut_col, $id_empresa);
        if($Usua2[0]->vigencia_descripcion=="Externo"){
           // echo "<br>Temp 2 A ".$uni2->rut_col;
            $row_lista2.= file_get_contents("views/sucesion/sucesion_row_colaboradores_comites_sucesion_avatar_externos.html");
        } else {
            //echo "<br>Temp 2 B ".$uni2->rut_col;
            $row_lista2.= file_get_contents("views/sucesion/sucesion_row_colaboradores_comites_sucesion_avatar.html");
            $row_lista2=Ficha_colaborador_Sucesion_fn($row_lista2, $uni2->rut_col, $perfil, $filtro, $id_empresa);
        }
        $row_lista2 = str_replace("{RUT}",           ($uni2->rut), $row_lista2);
        $RxCol=MiRx($uni2->rut_col);
        $visualiza2=CheckVisualizaMiRxRxCol($MiRx,	$RxCol);
        $row_lista2 = str_replace("{COLABORADOR}",   	($uni2->nombre_completo), $row_lista2);
        $row_lista2 = str_replace("{CARGO_COL}",   		($uni2->cargo_col), $row_lista2);
        $row_lista2 = str_replace("{AVATAR_RUT_SUCESORES}",   				VerificaFotoPersonal($uni2->rut_col), $row_lista2);
        $row_lista2 = str_replace("{RUT_SUCESORES}",           ($uni2->rut_col), $row_lista2);
        $row_lista2 = str_replace("{RUT_SUCESORES_ENC}",           Encodear3($uni2->rut_col), $row_lista2);
        $row_lista2 = str_replace("{ID_POSICION_ENC}",           	Encodear3($posicion), $row_lista2);
        $row_lista2 = str_replace("{ID_COMITE_ENC}",           		Encodear3($id_comite), $row_lista2);
        $row_lista2 = str_replace("{ID_COL}",           					Encodear3($uni2->id), $row_lista2);
        $row_lista2 = str_replace("{PERFIL_ENC}",           		Encodear3($perfil), $row_lista2);
        $row_lista2 = str_replace("{ID_ACTUAL_TEMPORALIDAD}",      "2", $row_lista2);


        $es_posicion_clave=Pot_CheckPosicion_Clave($uni2->rut_col);
        if($es_posicion_clave>0){
            $posicion_clave	="<div class='badge badge-gray'  style='    background-color: transparent !important;padding-left: 0px!important;'><strong>Posici&oacute;n Clave</strong></div><br>";
        } else {
            $posicion_clave="";
        }
        $row_lista2 = str_replace("{POSICION_CLAVE}", 			$posicion_clave, $row_lista2);
        $row_lista2 = str_replace("{COLABORADOR_SUCESORES}",     ($Usua2[0]->nombre_completo), $row_lista2);
        $posicion2=Potencial_Sucesion_d6_d5($uni2->rut_col);
        $row_lista2 = str_replace("{POSICION_SUCESORES}",        ($posicion2[0]->d6), $row_lista2);
        $row_lista2 = str_replace("{CARGO_SUCESORES}",           ($posicion2[0]->d5), $row_lista2);
        $row_lista2 = str_replace("{ID_SUCESORES}",           		Encodear3($uni2->id), $row_lista2);
        $row_lista2 = str_replace("{STYLO_AGREGAR_ACCIONES_DESARROLLO}", $display_acciones_desarrollo, $row_lista2);
        $row_lista2 = str_replace("{ACTUAL_TEMPORALIDAD}",      "Mediano", $row_lista2);
        $sucesion_display_none="";
        if($visualiza2=="NO"){$sucesion_display_none=" display:none; ";}
        $row_lista2 = str_replace("{sucesion_display_none}",      $sucesion_display_none, $row_lista2);
        $Num_Sucesion=Potencial_Sucesion_Num_Sucesores_2024($uni2->rut_col);
        if($Cuad_2020<>""){
            if($Cuad_2020=="10"){$Cuad_2020="5+";}
            $cuadrante_2020="Cuadrante Actual: $Cuad_2020";
        } else {
            $cuadrante_2020="Sin cuadrante actual";
        }
        if($Num_Sucesion>0){
            $num_sucesion_2020="Veces como sucesor: $Num_Sucesion";
        } else {
            $num_sucesion_2020="1 vez como sucesor";
        }
        /*$Usua=DatosUsuario_($uni2->rut_col, $id_empresa);
        if($Usua[0]->gerencia=="GERENCIA CORPORATIVA GESTION PERSONAS"){
            $cuadrante_2020="";
        }*/
        if($visualiza2=="NO"){$num_sucesion_2020="";}
        if($visualiza2=="NO"){$cuadrante_2020="";}
        $estado_badge_avatar2="";
        $row_lista2 = str_replace("{CARGO_CUDRANTE_SUCESORES}",   $cuadrante_2020, $row_lista2);
        $row_lista2 = str_replace("{CARGO_VECES_SUCESOR}",     		$num_sucesion_2020, $row_lista2);
        if($uni2->estado=="No es sucesor"){
            if($uni2->rutlider==""){
                $estado_badge_avatar2="<span class='badge badge-danger' style='color:#fff'>No es Sucesor</span>";
            } else {
                $estado_badge_avatar2="<span class='badge badge-danger' style='color:#fff'>No es Sucesor</span> <span style='font-size: 12px;display:none;'>Sugerido por L&iacute;der</span>";
            }
        }
        if($uni2->estado=="Es Sucesor"){
            if($uni2->rutlider==""){
                $estado_badge_avatar2="<span class='badge badge-info' style='color:#fff'>Es Sucesor</span> - <span style='font-size: 12px;'>Propuesta de Sucesi&oacute;n</span>";
            } else {
                $estado_badge_avatar2="<span class='badge badge-info' style='color:#fff'>Es Sucesor</span>  <span style='font-size: 12px; display:none;'>Sugerido por L&iacute;der</span>";
            }
        }
        if($comite_cerrado_esta=="SI" and $uni3->estado=="Es Sucesor"){
            $estado_badge_avatar2="";
        }
        $row_lista2 = str_replace("{NO_ES_SUCESOR_ESTADO_BADGE}",     		$estado_badge_avatar2, $row_lista2);
        if($visualiza2=="NO"){
            $row_lista2 = str_replace("{BOTON_VER_FICHA}","", $row_lista2);
            $row_lista2 = str_replace("{BOTON_VER_FICHA_A_inicial}","", $row_lista2);
            $row_lista2 = str_replace("{BOTON_VER_FICHA_B_final}","", $row_lista2);
        } else {
            $row_lista2 = str_replace("{BOTON_VER_FICHA}","<a href='?sw=potencial_ficha&rut_col=".Encodear3($uni2->rut_col)."&id_comite=".Encodear3($id_comite)."&sucesion=1&sucesion=1&id_posicion_enc=".Encodear3($posicion)."' class='btn btn-link' >			        <span class='azul_comite'><i class='fas fa-user'></i> <span class='mt-comment-authorSM'> Ficha</span></span></a>", $row_lista2);
            $row_lista2 = str_replace("{BOTON_VER_FICHA_A_inicial}","<a href='?sw=potencial_ficha&rut_col=".Encodear3($uni2->rut_col)."&id_comite=".Encodear3($id_comite)."&sucesion=1&sucesion=1&id_posicion_enc=".Encodear3($posicion)."'
						   class='btn btn-link' style='padding-left: 0px;    padding-left: 0px;text-align: left;padding-right: 0px;'>", $row_lista2);
            $row_lista2 = str_replace("{BOTON_VER_FICHA_B_final}","</a>", $row_lista2);
        }

        $row_bitacora2="";
        $Bitacora2=SucesionBitacora_2024($uni2->rut_col, $id_comite);
        foreach ($Bitacora2 as $b2){
            $row_bitacora2.="<br> <i class='bi bi-arrow-right-short'></i> ".$b2->comentario;
        }
        $row_lista2 = str_replace("{BITACORA}",$row_bitacora2, $row_lista2);

        $row_lista2_acciones="";
        /*$Potencial_Acciones_Desarrollo	=	Potencial_Busca_Acciones_Desarrollo($uni2->rut_col);
        if(count($Potencial_Acciones_Desarrollo)>0){
            foreach ($Potencial_Acciones_Desarrollo as $un2){
                $row_lista2_acciones.=" <i class='far fa-file-alt'></i> ".$un2->plan."
									  		<span class='pull-right'><a href='?sw=potencial_ficha_sucesion&id_posicion_enc=".Encodear3($posicion)."&id_comite=".Encodear3($id_comite)."&perfil=".Encodear3($perfil)."&delad=".Encodear3($un2->id)."'><i class='far fa-trash-alt' style='color: #337ab7;'></i></a></span>
									  		<br>
									  		<i class='fas fa-chevron-right' style='padding-left: 20px;'></i> ".$un2->fundamento."<br>";
            }
            $row_lista2 = str_replace("{ACCIONES_DE_DESARROLLO_TITULO1}", "<div class='txt_2020' data-toggle='collapse' href='#collapseExample2_".$uni2->rut_col."' role='button' aria-expanded='false' aria-controls='collapseExample'>Acciones de Desarrollo</div>", $row_lista2);
            $row_lista2 = str_replace("{ACCIONES_DE_DESARROLLO}", $row_lista2_acciones, $row_lista2);
        } else {
            $row_lista2 = str_replace("{ACCIONES_DE_DESARROLLO}", "", $row_lista2);
            $row_lista2 = str_replace("{ACCIONES_DE_DESARROLLO_TITULO1}", "", $row_lista2);
        }*/
        /*$Potencial_Bitacora_Desarrollo	=	Potencial_Busca_Bitacora_Desarrollo($uni2->rut_col);
        if(count($Potencial_Bitacora_Desarrollo)>0){
            $row_lista1_bitacora="";
            foreach ($Potencial_Bitacora_Desarrollo as $un1){
                $row_lista1_bitacora.=" 
						  		
						  		".$un1->comite." - Sucesi&oacute;n - ".$un1->fecha." 
						  				 <br> ".$un1->nombre_completo." <br>  ".$un1->accion." ".$un1->comentario."
						  				<!--<span class='pull-right'><a href='?sw=potencial_ficha_sucesion&id_posicion_enc=".Encodear3($posicion)."&id_comite=".Encodear3($id_comite)."&perfil=".Encodear3($perfil)."&delad=".Encodear3($un1->id)."'><i class='far fa-trash-alt' style='color: #337ab7;'></i></a></span>-->
						  	<br><br>";
            }
            $row_lista2 = str_replace("{BITACORA_DE_DESARROLLO_TITULO1}", "<div class='txt_2020' data-toggle='collapse' href='#collapseExample1_".$uni2->rut_col."' role='button' aria-expanded='false' aria-controls='collapseExample'>Bit&aacute;cora de Sucesi&oacute;n</div>", $row_lista2);
            $row_lista2 = str_replace("{BITACORA_DE_DESARROLLO}", $row_lista1_bitacora, $row_lista2);
        } else {
            $row_lista2 = str_replace("{BITACORA_DE_DESARROLLO_TITULO1}", "", $row_lista2);
            $row_lista2 = str_replace("{BITACORA_DE_DESARROLLO}", "", $row_lista2);
        }*/
    }

    //echo "<br>Roe list 2 $row_lista2";

    $row_largo="";
    $row_lista3="";
    $Largo=PotencialSucesion_Vista_Colaboradores_Posicion_2024($id_comite, $unico->rut, $id_empresa, "3", $posicion);
    //print_r($Largo);
    foreach ($Largo as $uni3){
        if($comite_cerrado_esta=="SI" and $uni3->estado=="No es sucesor"){
          //  continue;
        }

        $Usua3=DatosUsuario_($uni3->rut_col, $id_empresa);
        if($Usua3[0]->vigencia_descripcion=="Externo"){
            $row_lista3.= file_get_contents("views/sucesion/sucesion_row_colaboradores_comites_sucesion_avatar_externos.html");
        } else {
            $row_lista3.= file_get_contents("views/sucesion/sucesion_row_colaboradores_comites_sucesion_avatar.html");
            $row_lista3=Ficha_colaborador_Sucesion_fn($row_lista3, $uni3->rut_col, $perfil, $filtro, $id_empresa);
        }
        $row_lista3 = str_replace("{RUT}",           ($uni3->rut_col), $row_lista3);
        $RxCol=MiRx($uni3->rut_col);
        $visualiza3=CheckVisualizaMiRxRxCol($MiRx,	$RxCol);
        $row_lista3 = str_replace("{COLABORADOR}",   	($uni3->nombre_completo), $row_lista3);
        $row_lista3 = str_replace("{CARGO_COL}",   		($uni3->cargo_col), $row_lista3);
        $row_lista3 = str_replace("{RUT_SUCESORES_ENC}",           Encodear3($uni3->rut_col), $row_lista3);
        $row_lista3 = str_replace("{ID_POSICION_ENC}",           	Encodear3($posicion), $row_lista3);
        $row_lista3 = str_replace("{ID_COMITE_ENC}",           		Encodear3($id_comite), $row_lista3);
        $row_lista3 = str_replace("{ID_COL}",           					Encodear3($uni3->id), $row_lista3);
        $row_lista3 = str_replace("{AVATAR_RUT_SUCESORES}",   				VerificaFotoPersonal($uni3->rut_col), $row_lista3);
        $row_lista3 = str_replace("{PERFIL_ENC}",           		Encodear3($perfil), $row_lista3);
        $row_lista3 = str_replace("{ACTUAL_TEMPORALIDAD}",      "Largo", $row_lista3);
        $row_lista3 = str_replace("{ID_ACTUAL_TEMPORALIDAD}",      "3", $row_lista3);
        $sucesion_display_none="";
        if($visualiza3=="NO"){$sucesion_display_none=" display:none; ";}
        $row_lista3 = str_replace("{sucesion_display_none}",      $sucesion_display_none, $row_lista3);
        $es_posicion_clave=Pot_CheckPosicion_Clave($uni3->rut_col);
        if($es_posicion_clave>0){
            $posicion_clave	="<div class='badge badge-gray'  style='    background-color: transparent !important;padding-left: 0px!important;'><strong>Posici&oacute;n Clave</strong></div><br>";
        } else {
            $posicion_clave="";
        }
        $row_lista3 = str_replace("{POSICION_CLAVE}", 			$posicion_clave, $row_lista3);
        $row_lista3 = str_replace("{COLABORADOR_SUCESORES}",     ($Usua3[0]->nombre_completo), $row_lista3);
        $posicion3=Potencial_Sucesion_d6_d5($uni3->rut_col);
        $row_lista3 = str_replace("{POSICION_SUCESORES}",        ($posicion3[0]->d6), $row_lista3);
        $row_lista3 = str_replace("{CARGO_SUCESORES}",           ($posicion3[0]->d5), $row_lista3);
        $row_lista3 = str_replace("{RUT_SUCESORES}",           		($uni3->rut_col), $row_lista3);
        $row_lista3 = str_replace("{STYLO_AGREGAR_ACCIONES_DESARROLLO}", $display_acciones_desarrollo, $row_lista3);
        $row_lista3 = str_replace("{ID_SUCESORES}",           		Encodear3($uni3->id), $row_lista3);
        $Num_Sucesion=Potencial_Sucesion_Num_Sucesores_2024($uni3->rut_col);
        if($Cuad_2020<>""){
            if($Cuad_2020=="10"){$Cuad_2020="5+";}
            $cuadrante_2020="Cuadrante Actual: $Cuad_2020";
        } else {
            $cuadrante_2020="Sin cuadrante actual";
        }
        if($Num_Sucesion>0){
            $num_sucesion_2020="Veces como sucesor: $Num_Sucesion";
        } else {
            $num_sucesion_2020="1 vez como sucesor";
        }
        //$Usua=DatosUsuario_($uni3->rut_col, $id_empresa);
        if($Usua[0]->gerencia=="GERENCIA CORPORATIVA GESTION PERSONAS"){
            $cuadrante_2020="";
        }
        if($visualiza3=="NO"){$num_sucesion_2020="";}
        if($visualiza3=="NO"){$cuadrante_2020="";}
        $row_lista3 = str_replace("{CARGO_CUDRANTE_SUCESORES}",   $cuadrante_2020, $row_lista3);
        $row_lista3 = str_replace("{CARGO_VECES_SUCESOR}",     		$num_sucesion_2020, $row_lista3);
        $estado_badge_avatar3="";
        if($uni3->estado=="No es sucesor"){
            if($uni3->rutlider==""){
                $estado_badge_avatar3="<span class='badge badge-danger' style='color:#fff'>No es Sucesor</span>";
            } else {
                $estado_badge_avatar3="<span class='badge badge-danger' style='color:#fff'>No es Sucesor</span>  <span style='font-size: 12px;display:none;'>Sugerido por L&iacute;der</span>";
            }
        }
        if($uni3->estado=="Es Sucesor"){
            if($uni3->rutlider==""){
                $estado_badge_avatar3="<span class='badge badge-info' style='color:#fff'>Es Sucesor</span> - <span style='font-size: 12px;'>Propuesta de Sucesi&oacute;n</span>";
            } else {
                $estado_badge_avatar3="<span class='badge badge-info' style='color:#fff'>Es Sucesor</span>  <span style='font-size: 12px;display:none;'>Sugerido por L&iacute;der</span>";
            }
        }
        if($comite_cerrado_esta=="SI" and $uni3->estado=="Es Sucesor"){
            $estado_badge_avatar3="";
        }
        $row_lista3 = str_replace("{NO_ES_SUCESOR_ESTADO_BADGE}",     		$estado_badge_avatar3, $row_lista3);
        $row_lista3 = str_replace("{BOTON_VER_FICHA}","<a href='?sw=potencial_ficha&rut_col=".Encodear3($uni3->rut_col)."&id_comite=".Encodear3($id_comite)."&sucesion=1&sucesion=1&id_posicion_enc=".Encodear3($posicion)."' class='btn btn-link' >
			        <span class='azul_comite'><i class='fas fa-user'></i> <span class='mt-comment-authorSM'> Ficha</span></span></a>", $row_lista3);
        $row_lista3 = str_replace("{BOTON_VER_FICHA_A_inicial}","<a href='?sw=potencial_ficha&rut_col=".Encodear3($uni3->rut_col)."&id_comite=".Encodear3($id_comite)."&sucesion=1&sucesion=1&id_posicion_enc=".Encodear3($posicion)."'
						   class='btn btn-link' style='padding-left: 0px;    padding-left: 0px;text-align: left;padding-right: 0px;'>", $row_lista3);
        $row_lista3 = str_replace("{BOTON_VER_FICHA_B_final}","</a>", $row_lista3);
        if($visualiza3=="NO"){
            $row_lista3 = str_replace("{BOTON_VER_FICHA}","<a href='?sw=potencial_ficha&rut_col=".Encodear3($uni3->rut_col)."&id_comite=".Encodear3($id_comite)."&sucesion=1&sucesion=1&id_posicion_enc=".Encodear3($posicion)."' class='btn btn-link' >
			        <span class='azul_comite'><i class='fas fa-user'></i> <span class='mt-comment-authorSM'> Ficha</span></span></a>", $row_lista3);
            $row_lista3 = str_replace("{BOTON_VER_FICHA_A_inicial}","<a href='?sw=potencial_ficha&rut_col=".Encodear3($uni3->rut_col)."&id_comite=".Encodear3($id_comite)."&sucesion=1&sucesion=1&id_posicion_enc=".Encodear3($posicion)."'
						   class='btn btn-link' style='padding-left: 0px;    padding-left: 0px;text-align: left;padding-right: 0px;'>", $row_lista3);
            $row_lista3 = str_replace("{BOTON_VER_FICHA_B_final}","</a>", $row_lista3);
        } else {
            $row_lista3 = str_replace("{BOTON_VER_FICHA}","", $row_lista3);
            $row_lista3 = str_replace("{BOTON_VER_FICHA_A_inicial}","", $row_lista3);
            $row_lista3 = str_replace("{BOTON_VER_FICHA_B_final}","", $row_lista3);
        }
        $row_lista3_acciones="";
        $row_bitacora2="";
        $Bitacora3=SucesionBitacora_2024($uni3->rut_col, $id_comite);
        foreach ($Bitacora3 as $b3){
            $row_bitacora3.="<br> <i class='bi bi-arrow-right-short'></i> ".$b3->comentario;
        }
        $row_lista3 = str_replace("{BITACORA}",$row_bitacora3, $row_lista3);
        /*$Potencial_Acciones_Desarrollo	=	Potencial_Busca_Acciones_Desarrollo($uni3->rut_col);
        if(count($Potencial_Acciones_Desarrollo)>0){
            foreach ($Potencial_Acciones_Desarrollo as $un3){
                $row_lista3_acciones.=" <i class='far fa-file-alt'></i> ".$un3->plan."
									  		<span class='pull-right'><a href='?sw=potencial_ficha_sucesion&id_posicion_enc=".Encodear3($posicion)."&id_comite=".Encodear3($id_comite)."&perfil=".Encodear3($perfil)."&delad=".Encodear3($un3->id)."'><i class='far fa-trash-alt' style='color: #337ab7;'></i></a></span>
									  		<br>
									  		<i class='fas fa-chevron-right' style='padding-left: 20px;'></i> ".$un3->fundamento."<br>";
            }
            $row_lista3 = str_replace("{ACCIONES_DE_DESARROLLO_TITULO1}", "<div class='txt_2020' data-toggle='collapse' href='#collapseExample2_".$uni3->rut_col."' role='button' aria-expanded='false' aria-controls='collapseExample'>Acciones de Desarrollo</div>", $row_lista3);
            $row_lista3 = str_replace("{ACCIONES_DE_DESARROLLO}", $row_lista3_acciones, $row_lista3);
        } else {
            $row_lista3 = str_replace("{ACCIONES_DE_DESARROLLO}", "", $row_lista3);
            $row_lista3 = str_replace("{ACCIONES_DE_DESARROLLO_TITULO1}", "", $row_lista3);
        }
        $Potencial_Bitacora_Desarrollo	=	Potencial_Busca_Bitacora_Desarrollo($uni3->rut_col);
        if(count($Potencial_Bitacora_Desarrollo)>0){
            $row_lista1_bitacora="";
            foreach ($Potencial_Bitacora_Desarrollo as $un1){
                $row_lista1_bitacora.=" 
						  		
						  		".$un1->comite." - Sucesi&oacute;n - ".$un1->fecha." 
						  				 <br> ".$un1->nombre_completo." <br>  ".$un1->accion." ".$un1->comentario."
						  				<!--<span class='pull-right'><a href='?sw=potencial_ficha_sucesion&id_posicion_enc=".Encodear3($posicion)."&id_comite=".Encodear3($id_comite)."&perfil=".Encodear3($perfil)."&delad=".Encodear3($un1->id)."'><i class='far fa-trash-alt' style='color: #337ab7;'></i></a></span>-->
						  	<br><br>";
            }
            $row_lista3 = str_replace("{BITACORA_DE_DESARROLLO_TITULO1}", "<div class='txt_2020' data-toggle='collapse' href='#collapseExample1_".$uni3->rut_col."' role='button' aria-expanded='false' aria-controls='collapseExample'>Bit&aacute;cora de Sucesi&oacute;n</div>", $row_lista3);
            $row_lista3 = str_replace("{BITACORA_DE_DESARROLLO}", $row_lista1_bitacora, $row_lista3);
        } else {
            $row_lista3 = str_replace("{BITACORA_DE_DESARROLLO_TITULO1}", "", $row_lista3);
            $row_lista3 = str_replace("{BITACORA_DE_DESARROLLO}", "", $row_lista3);
        }*/
    }
    $PRINCIPAL = str_replace("{INMEDIATO}", ($row_lista1), $PRINCIPAL);
    $PRINCIPAL = str_replace("{MEDIANO}",   ($row_lista2), $PRINCIPAL);
    $PRINCIPAL = str_replace("{LARGO}",   	($row_lista3), $PRINCIPAL);
    $PRINCIPAL = str_replace("{MIS_COLABORADORES_COMITES_POTENCIAL}",         $row_lista,         $PRINCIPAL);
    $PRINCIPAL = str_replace("{COLABORADORES_COMITE_POTENCIAL_TITULO}",  $potencial_titulo,  $PRINCIPAL);

    return ($PRINCIPAL);
}

function DDYYMMM($date) {
    // Check if the date is in the format yyyy-mm-dd
    if (DateTime::createFromFormat('Y-m-d', $date) !== false) {
        // Create a DateTime object from the given date
        $dateTime = DateTime::createFromFormat('Y-m-d', $date);
        // Return the date in the format dd-mm-yyyy
        return $dateTime->format('d-m-Y');
    } else {
        // Return an error message if the date is not in the correct format
        return "Invalid date format. Please use yyyy-mm-dd.";
    }
}

function Potencial_Sucesion_Mis_Comites_estado_activo_2024($PRINCIPAL, $rut, $perfil, $id_empresa, $comite_cierre)
{
    $lista = Potencial_Sucesion_Mis_Comites_data_2024($id_empresa, $rut, $perfil);
            //print_r($lista);
    $nomuestracabeceras="";
    if($perfil=="VISUALIZADOR"){$nomuestracabeceras="1";}
    if($nomuestracabeceras=="1"){$lider="";$colab="";} else {$lider1="LIDER";$colab="COLAB.";}
    $num_comites    =   count($lista);
    if($num_comites>0){$potencial_titulo="";}   else   {
        $potencial_titulo="<div class='row'><div class='col-sm-12 txt_title_pot'><br><br><center>[ No hay comit&eacute;s de sucesión creados ]</center></div></div>";
    }
    foreach($lista as $unico) {
        $cuenta_lista++;
        $num_colaboradores=0;
        $array_comite=Potencial_Comites_Suc_data_2024($unico->id_comite,$id_empresa);
        $id_comite_cerrado = $array_comite[0]->comite_cerrado;
        $perfil="YO";
        $g2="";
        $array_g2=Potencial_Busca_Colaboradores_Comite_2024($unico->id_comite, $id_empresa);
        foreach ($array_g2 as $unlid){
            $g2.="<i class='bi bi-arrow-right-short'></i><strong>".$unlid->posicion."</strong>".$pot_sucesion_badge_ok_cerrado."
                        <br><br><i class='bi bi-person'></i> ".$unlid->nombre_completo."
                        <br><i class='bi bi-arrow-right-short'></i>Cargo: ".$unlid->d5." 
                        <br><i class='bi bi-bookmark'></i> Nivel R: ".$unlid->d16."
                        <br> <hr>";
        }
        $row_lista.= file_get_contents("views/sucesion/row_comites_sucesion.html");
        $row_lista = str_replace("{ID_COMITE}", ($unico->id_comite), $row_lista);
        $row_lista = str_replace("{COMITE}", ($unico->nombre), $row_lista);
        $row_lista = str_replace("{CARGO_LIDER_COMITE}", ($unico->cargo_lider), $row_lista);
        $row_lista = str_replace("{POSICION_LIDER_COMITE}", ($unico->posicion_lider), $row_lista);
        $row_lista = str_replace("{NIVEL_R_LIDER_COMITE}", ($unico->nivelr_lider), $row_lista);

        if(trim($estado_tarea_comite) == "<span class='badge badge-danger'>Finalizado</span><br>") {
           // echo "A";
            $row_button_eliminar_editar="";
        } else {
           // echo "B";
            $row_button_eliminar_editar = "
                <br>
                <a href='?sw=sucesion&id_comite=".Encodear3($unico->id_comite)."&edit=1&previsualizar=1'>
                    <i class='bi bi-pencil'></i>
                </a> 
                <a href='?sw=sucesion&id_comite=".Encodear3($unico->id_comite)."&del=1' 
                   onclick='return confirm(\"¿Está seguro de eliminar el comité?\")'>
                    <i class='bi bi-trash'></i>
                </a>
            ";

        }
        $row_lista = str_replace("{BOTON_EDITAR_ELIMINAR_COMITE}", $row_button_eliminar_editar, $row_lista);


        $estado_tarea_comite=SucesionEstadoTareaComite($unico->id_comite,"comite","",$unico->fecha,$unico->fecha_comite,"");
        $row_lista = str_replace("{ESTADO_TAREA_COMITE}", ($estado_tarea_comite), $row_lista);

        $row_lista = str_replace("{COMITE}", ($unico->nombre), $row_lista);

        $fechas_comite  =   "   Desde: ".DDYYMMM($unico->fecha)."<br> T&eacute;rmino: ".DDYYMMM($unico->fecha_comite);

        $row_lista = str_replace("{FECHA}", $fechas_comite, $row_lista);
        $row_lista = str_replace("{GERENTES_R2}", ($g2), $row_lista);
        $row_lista = str_replace("{COLABORADORES}", $num_colaboradores, $row_lista);
            //$UsuaCreadorComite=DatosUsuario_($unico->rut, $id_empresa);
        $row_lista = str_replace("{NOMBRE_CREADOR_COMITE}",     $unico->nombre_creador, $row_lista);
        $row_lista = str_replace("{NOMBRE_LIDER_COMITE}",       $unico->nombre_lider, $row_lista);
        $row_lista = str_replace("{BOTON_VER_COMITE}", "<a href='?sw=sucesion_comite&id_comite=".Encodear3($unico->id_comite)."' class='btn btn-info'><span class='blanco'>Ingresar</span></a>", $row_lista);

        if($perfil=="SOCIO DE NEGOCIO" OR $perfil=="SUPER USER")    {
            $row_lista = str_replace("{BOTON_ELIMINAR_COMITE}", "<a href='?sw=sucesion&id_del=".Encodear3($unico->id_comite)."' class='btn btn-link'>
        	<span class='azul_comite'><i class='fas fa-trash-alt'></i></span></a>", $row_lista);
        }else {
            $row_lista = str_replace("{BOTON_ELIMINAR_COMITE}", "", $row_lista);
        }
    }
        $PRINCIPAL = str_replace("{MIS_COMITES_SUCESION}",         $row_lista,         $PRINCIPAL);
        $PRINCIPAL = str_replace("{MIS_COMITES_POTENCIAL_TITULO}",  $potencial_titulo,  $PRINCIPAL);


    if($cuenta_lista>0){
        $display_none_mi_sucesion="";
    } else {
        $display_none_mi_sucesion="display:none!important";
    }
    $PRINCIPAL = str_replace("{MIS_COMITES_SUCESION_DISPLAY_NONE}",  $display_none_mi_sucesion,  $PRINCIPAL);

    return ($PRINCIPAL);
}

function Potencial_Sucesion_Colaboradores_Comites_2024($PRINCIPAL, $id_comite, $rut, $perfil, $id_empresa)
{
    $lista = Potencial_Sucesion_Colaboradores_Comites_2024_data($id_comite, $rut, $perfil, $id_empresa);
    //print_r($lista);exit();
    $num_comites    =   count($lista);
    //echo "<br>num_comites $num_comites<br>";
    if($num_comites>0){
        $potencial_titulo="
					<div class=''>

					</div>";
    }   else   {
        $potencial_titulo="
					<div class=''><br>
					    <div class='col-sm-12 txt_title_pot_hohay'><center>[ No hay cargos a suceder ]</center></div>
					    					<br>
					</div>";
    }

    $cuenta_inmediato=0; $cuenta_mediano=0; $cuenta_largo=0;

    foreach($lista as $unico) {
        $row_lista.= file_get_contents("views/sucesion/row_colaboradores_comite.html");
        //print_r($unico);
        //echo "<br>-> ".$row_lista; exit();
        $row_lista = str_replace("{RUT}",           ($unico->rut), $row_lista);
        $row_lista = str_replace("{NIVEL_R_COL}",           ($unico->r), $row_lista);


        $Potencial_Mapeado=Potencial_Check_Mapeado($unico->rut);
        if($Potencial_Mapeado<>""){
            $row_lista = str_replace("{MAPEADO}",           "<span class='badge badge-success' style='font-size: 10px;'><span class='blanco'>Mapeado</span></span>", $row_lista);
        } else {
            $row_lista = str_replace("{MAPEADO}",         	"", $row_lista);
        }

        $Estado_Tarea=SucesionEstadoTareaComite($id_comite,"tarea","", "", "",$unico->posicion);
        $row_lista = str_replace("{ESTADO_TAREA}",           ($Estado_Tarea), $row_lista);

        $pos_validada=Sucesion_Check_Posicion_validada($unico->cargo_col);
        if($pos_validada>0){
            $pot_sucesion_badge_ok_cerrado="<div class='badge badge-success'><i class='fas fa-check' style='color: #fff;'></i></div>";
        } else {
            $pot_sucesion_badge_ok_cerrado="";
        }
        $row_lista = str_replace("{CARGO_SUCEDER_LIDER_CERRADO}",         	$pot_sucesion_badge_ok_cerrado, $row_lista);
        $modal_row_rutc_col	 = "
						<a href='?sw=sucesion_ficha_sucesion&id_posicion_enc=".Encodear3($unico->posicion)."&id_comite=".Encodear3($id_comite)."&perfil=".Encodear3($perfil)."' 
						        class='btn btn-info'> 
								Ver Matriz de Sucesi&oacute;n 
						</a>
				";



        $sucesores_cuadrantes_2_3=0;
        $sucesores_cuadrantes_6=0;
        $sucesores_cuadrantes_1_9_4_8_7=0;
        $cuenta_femenino=0;
        $cuenta_total=0;
        //
        $row_inmediato="";
        $row_lista1="";
        $cuenta_inmediato="";
        $Inmediato=PotencialSucesion_Vista_Colaboradores_Posicion_2024($id_comite, $unico->rut, $id_empresa, "Inmediato", $unico->posicion);

        foreach ($Inmediato as $uni1){

            if($uni1->estado=="No es sucesor"){continue;}

            $cuenta_inmediato++;
            $row_lista1.= file_get_contents("views/sucesion/row_colaboradores_comites_sucesion.html");
            $row_lista1 = str_replace("{AVATAR_RUT_SUCESORES}",   				VerificaFotoPersonal($uni1->rut_col), $row_lista1);

            $Usua1=DatosUsuario_($uni1->rut_col, $id_empresa);
            $row_lista1 = str_replace("{COLABORADOR_SUCESORES}",     ($Usua1[0]->nombre_completo), $row_lista1);
            $row_lista1 = str_replace("{CARGO_SUCESORES}",           ($Usua1[0]->cargo), $row_lista1);
            $row_lista1 = str_replace("{TEMPORALIDAD}",           	"Inmediato / Hoy", $row_lista1);

            $cuadrante1=Potencial_Mi_Cuadrante_Actual($uni1->rut_col);
            //echo "<br>cuadrante1<br>";print_r($cuadrante1);

            $genero1=Potencial_Genero($uni1->rut_col);

            if($cuadrante1=="2" or $cuadrante1=="3")	{$sucesores_cuadrantes_2_3++;}
            if($cuadrante1=="6")	{$sucesores_cuadrantes_6++;}
            if($cuadrante1=="1" or $cuadrante1=="9" or $cuadrante1=="4" or $cuadrante1=="8" or $cuadrante1=="7")	{$sucesores_cuadrantes_1_9_4_8_7++;}
            if($genero1=="Femenino")																			{$cuenta_femenino++;}
            $cuenta_total++;
            $row_lista1 = str_replace("{RUT}",           ($uni1->rut_col), $row_lista1);
            $row_lista1 = str_replace("{COLABORADOR}",   	($uni1->nombre_completo), $row_lista1);
            $row_lista1 = str_replace("{CARGO_COL}",   		($uni1->cargo_col), $row_lista1);
            $row_lista1 = str_replace("{BOTON_VER_FICHA}","<a href='?sw=potencial_ficha&rut_col=".Encodear3($uni1->rut)."&id_comite=".Encodear3($id_comite)."' class='btn btn-link' >
			        <span class='azul_comite'><i class='fas fa-user'></i> <span class='mt-comment-authorSM'> Ficha</span></span></a>", $row_lista1);
            $row_lista1 = str_replace("{BOTON_VER_FICHA_A_inicial}","<a href='?sw=potencial_ficha&rut_col=".Encodear3($uni1->rut_col)."&id_comite=".Encodear3($id_comite)."'
						   class='btn btn-link' style='padding-left: 0px;    padding-left: 0px;text-align: left;padding-right: 0px;padding: 0px;'>", $row_lista1);
            $row_lista1 = str_replace("{BOTON_VER_FICHA_B_final}","</a>", $row_lista1);
        }

        $row_mediano="";
        $row_lista2="";
        $cuenta_mediano="";
        $Mediano=PotencialSucesion_Vista_Colaboradores_Posicion_2024($id_comite, 	$unico->rut, $id_empresa, "Mediano", $unico->posicion);

        //$Largo=PotencialSucesion_Vista_Colaboradores_Posicion($id_comite, 		$unico->rut, $id_empresa, "Largo", $unico->cargo_col);
        foreach ($Mediano as $uni2){
            $cuenta_mediano++;

            if($uni2->estado=="No es sucesor"){continue;}

            $row_lista2.= file_get_contents("views/sucesion/row_colaboradores_comites_sucesion.html");
            $row_lista2 = str_replace("{RUT}",           ($uni3->rut_col), $row_lista2);
            $row_lista2 = str_replace("{COLABORADOR}",   	($uni3->nombre_completo), $row_lista2);

            $row_lista2 = str_replace("{CARGO_COL}",   		($uni2->cargo_col), $row_lista2);
            $row_lista2 = str_replace("{TEMPORALIDAD}",           	"Mediano / 1 a 2 a&ntilde;os", $row_lista2);
            $row_lista2 = str_replace("{AVATAR_RUT_SUCESORES}",   				VerificaFotoPersonal($uni2->rut_col), $row_lista2);
            $cuenta_total++;


            $Usua2=DatosUsuario_($uni2->rut_col, $id_empresa);
            $row_lista2 = str_replace("{COLABORADOR_SUCESORES}",     ($Usua2[0]->nombre_completo), $row_lista2);
            $row_lista2 = str_replace("{CARGO_SUCESORES}",           ($Usua2[0]->cargo), $row_lista2);

            $cuadrante2=Potencial_Mi_Cuadrante_Actual($uni2->rut_col);
            //echo "<br>cuadrante2<br>"; print_r($cuadrante2);

            $genero2=Potencial_Genero($uni2->rut_col);

            if($cuadrante2=="2" or $cuadrante2=="3")	{$sucesores_cuadrantes_2_3++;}
            if($cuadrante2=="6")	{$sucesores_cuadrantes_6++;}
            if($cuadrante2=="1" or $cuadrante2=="9" or $cuadrante2=="4" or $cuadrante2=="8" or $cuadrante2=="7")	{$sucesores_cuadrantes_1_9_4_8_7++;}
            if($genero2=="Femenino")																			{$cuenta_femenino++;}

            $row_lista2 = str_replace("{BOTON_VER_FICHA}","<a href='?sw=potencial_ficha&rut_col=".Encodear3($uni2->rut)."&id_comite=".Encodear3($id_comite)."' class='btn btn-link' >			        <span class='azul_comite'><i class='fas fa-user'></i> <span class='mt-comment-authorSM'> Ficha</span></span></a>", $row_lista2);
            $row_lista2 = str_replace("{BOTON_VER_FICHA_A_inicial}","<a href='?sw=potencial_ficha&rut_col=".Encodear3($uni2->rut_col)."&id_comite=".Encodear3($id_comite)."'
						   class='btn btn-link' style='padding-left: 0px;    padding-left: 0px;text-align: left;padding-right: 0px; padding: 0px;'>", $row_lista2);
            $row_lista2 = str_replace("{BOTON_VER_FICHA_B_final}","</a>", $row_lista2);									}

        $row_largo="";
        $row_lista3="";
        $cuenta_largo="";
        $Largo=PotencialSucesion_Vista_Colaboradores_Posicion_2024($id_comite, 		$unico->rut, $id_empresa, "Largo", $unico->posicion);
        foreach ($Largo as $uni3){
            $cuenta_largo++;

            if($uni3->estado=="No es sucesor"){continue;}

            $row_lista3.= file_get_contents("views/sucesion/row_colaboradores_comites_sucesion.html");
            $row_lista3 = str_replace("{RUT}",           ($uni3->rut_col), $row_lista3);
            $row_lista3 = str_replace("{COLABORADOR}",   	($uni3->nombre_completo), $row_lista3);
            $row_lista3 = str_replace("{CARGO_COL}",   		($uni3->cargo_col), $row_lista3);
            $row_lista3 = str_replace("{TEMPORALIDAD}",           	"Largo  / 3 a 5 a&ntilde;os", $row_lista3);
            $row_lista3 = str_replace("{AVATAR_RUT_SUCESORES}",   				VerificaFotoPersonal($uni3->rut_col), $row_lista3);

            $Usua3=DatosUsuario_($uni3->rut_col, $id_empresa);
            $row_lista3 = str_replace("{COLABORADOR_SUCESORES}",     ($Usua3[0]->nombre_completo), $row_lista3);
            $row_lista3 = str_replace("{CARGO_SUCESORES}",           ($Usua3[0]->cargo), $row_lista3);

            $cuadrante3=Potencial_Mi_Cuadrante_Actual($uni3->rut_col);
            //echo "<br>cuadrante3<br>";print_r($cuadrante3);
            $genero3=Potencial_Genero($uni3->rut_col);
            //echo "<br>cuadrante3 $cuadrante3, genero3 $genero3";

            if($cuadrante3=="6")	                    {$sucesores_cuadrantes_2_3++;}
            if($cuadrante3=="2" or $cuadrante3=="3")	{$sucesores_cuadrantes_6++;}
            if($cuadrante3=="1" or $cuadrante3=="9" or $cuadrante3=="4" or $cuadrante3=="8" or $cuadrante3=="7")	{$sucesores_cuadrantes_1_9_4_8_7++;}
            if($genero3=="Femenino")																			{$cuenta_femenino++;}
            $cuenta_total++;

            $row_lista3 = str_replace("{BOTON_VER_FICHA}","<a href='?sw=potencial_ficha&rut_col=".Encodear3($uni3->rut)."&id_comite=".Encodear3($id_comite)."' class='btn btn-link'>
			        <span class='azul_comite'><i class='fas fa-user'></i> <span class='mt-comment-authorSM'> Ficha</span></span></a>", $row_lista3);
            $row_lista3 = str_replace("{BOTON_VER_FICHA_A_inicial}","<a href='?sw=potencial_ficha&rut_col=".Encodear3($uni3->rut_col)."&id_comite=".Encodear3($id_comite)."'
						   class='btn btn-link' style='padding-left: 0px;    padding-left: 0px;text-align: left;padding: 0px;'>", $row_lista3);
            $row_lista3 = str_replace("{BOTON_VER_FICHA_B_final}","</a>", $row_lista3);




        }


        //echo "<br>Femenino $cuenta_femenino , sucesores_cuadrantes_2_3_6 $sucesores_cuadrantes_2_3_6, sucesores_cuadrantes_1_9_4_8_7 $sucesores_cuadrantes_1_9_4_8_7";
        //echo "<BR> <BR>cARGO $cuenta_inmediato, $cuenta_mediano, $cuenta_largo";
        $Porcentaje_Cargo	=	Potencial_CalculoPorcentaje($cuenta_inmediato,$cuenta_mediano,$cuenta_largo);
        $cuenta_porcentaje_cargo++;
        $suma_porcentaje_cargo		= $suma_porcentaje_cargo + $Porcentaje_Cargo	;
        //echo "<BR> <BR>PORCENTAJE  Porcentaje_Cargo $Porcentaje_Cargo";

        $row_lista = str_replace("{INMEDIATO}", ($row_lista1), $row_lista);
        $row_lista = str_replace("{MEDIANO}",   ($row_lista2), $row_lista);
        $row_lista = str_replace("{LARGO}",   	($row_lista3), $row_lista);

        $cuenta_masculino=$cuenta_total-$cuenta_femenino;
//echo "<br> 236 $sucesores_cuadrantes_2_3_6 19478 $sucesores_cuadrantes_1_9_4_8_7 FEM $cuenta_femenino MASC $cuenta_masculino";

        $porc_2_3=round(100*$sucesores_cuadrantes_2_3/$cuenta_total);
        $porc_6=round(100*$sucesores_cuadrantes_6/$cuenta_total);
        $porc_1_9_4_8_6=round(100*$sucesores_cuadrantes_1_9_4_8_7/$cuenta_total);
        $porc_fem=round(100*$cuenta_femenino/$cuenta_total);
        $porc_mas=round(100*$cuenta_masculino/$cuenta_total);

        $row_lista = str_replace("{Sucesores_Cuadrantes_23}",  		"Cuadrantes 2-3: <div class='badge badge-info'>			<span style='color:#fff'>".$porc_2_3."%</span></div>", $row_lista);
        $row_lista = str_replace("{Sucesores_Cuadrantes_6}",  		"Cuadrantes 6: <div class='badge badge-info'>			<span style='color:#fff'>".$porc_6."%</span></div>", $row_lista);
        $row_lista = str_replace("{Sucesores_Cuadrantes_19487}",  	"Cuadrantes 1-9-4-8-7: <div class='badge badge-info'>			<span style='color:#fff'>".$porc_1_9_4_8_6."%</span></div>", $row_lista);
        $row_lista = str_replace("{Sucesores_Mujeres}",  			"Mujeres: <div class='badge badge-info'>			<span style='color:#fff'>".($porc_fem)."%</span></div>", $row_lista);
        $row_lista = str_replace("{Sucesores_Hombre}",  			"Hombres: <div class='badge badge-info'>			<span style='color:#fff'>".($porc_mas)."%</span></div>", $row_lista);

        //if($cuenta_mediano>0){ $titulo_inmediato="<div class='txt_title_pot'>Inmediato</div>"; } else { $titulo_inmediato=""; }
        //if($cuenta_mediano>0){ $titulo_mediano="<div class='txt_title_pot'>Mediano</div>"; } else { $titulo_mediano=""; }
        //if($cuenta_mediano>0){ $titulo_largo="<div class='txt_title_pot'>Largo</div>"; } else { $titulo_largo=""; }


        $row_lista = str_replace("{LARGO}",   	($row_lista3), $row_lista);

        $row_lista = str_replace("{TITULO_INMEDIATO}", 	$titulo_inmediato, $row_lista);
        $row_lista = str_replace("{TITULO_MEDIANO}",   	$titulo_mediano, $row_lista);
        $row_lista = str_replace("{TITULO_LARGO}",   		$titulo_largo, $row_lista);


        $row_lista = str_replace("{NOMBRE_COL}",   	($unico->nombre_completo), $row_lista);
        $row_lista = str_replace("{POSICION_COL}",  ($unico->posicion), $row_lista);
        $row_lista = str_replace("{CARGO_COL}",   	($unico->cargo), $row_lista);
        $row_lista = str_replace("{NOMBRE_LIDER}",  ($unico->nombre_lider), $row_lista);
        $row_lista = str_replace("{AVATAR}",   		VerificaFotoPersonal($unico->rut), $row_lista);
        $row_lista = str_replace("{BOTON_MODAL}",  	($modal_row_rutc_col), $row_lista);

        $row_lista = str_replace("{BOTON_VER_FICHA}",							"<a href='?sw=potencial_ficha_sucesion&id_posicion_enc=".Encodear3($unico->cargo_col)."&id_comite=".Encodear3($id_comite)."' class='btn btn-link' >
        <span class='azul_comite'><i class='fas fa-user'></i> <span class='mt-comment-authorSM'> Ficha</span></span></a>", $row_lista);

        $row_lista = str_replace("{BOTON_VER_FICHA_A_inicial}",	"<a href='?sw=potencial_ficha_sucesion&id_posicion_enc=".Encodear3($unico->cargo_col)."&id_comite=".Encodear3($id_comite)."'
			   class='btn btn-link' style='padding-left: 0px;    padding-left: 0px;text-align: left;padding-right: 0px;'>", $row_lista);

        $row_lista = str_replace("{BOTON_VER_FICHA_B_final}","</a>", $row_lista);


        $SUMA_sucesores_cuadrantes_2_3=	$sucesores_cuadrantes_2_3 + $SUMA_sucesores_cuadrantes_2_3;
        $SUMA_sucesores_cuadrantes_6=	$sucesores_cuadrantes_6 + $SUMA_sucesores_cuadrantes_6;

        $SUMA_sucesores_cuadrantes_1_9_4_8_7=	$sucesores_cuadrantes_1_9_4_8_7 + $SUMA_sucesores_cuadrantes_1_9_4_8_7;

        $SUMA_cuenta_femenino		=	$cuenta_femenino + $SUMA_cuenta_femenino;
        $SUMA_cuenta_masculino	=	$cuenta_masculino + $SUMA_cuenta_masculino;
        $SUMA_cuenta_total			=	$cuenta_total + $SUMA_cuenta_total;


    }



    $PRINCIPAL = str_replace("{MIS_COLABORADORES_COMITES_POTENCIAL}",         $row_lista,         $PRINCIPAL);
    $PRINCIPAL = str_replace("{COLABORADORES_COMITE_POTENCIAL_TITULO}",  $potencial_titulo,  $PRINCIPAL);
    $PRINCIPAL = str_replace("{PORCENTAJE_AREA_PONDERADO}", "Área Total: <div class='badge badge-info'>			<span style='color:#fff'>".round($suma_porcentaje_cargo/$cuenta_porcentaje_cargo)."%</span></div>",  $PRINCIPAL);


    $porc_total_2_3=round(100*$SUMA_sucesores_cuadrantes_2_3/$SUMA_cuenta_total);

    $porc_total_6=round(100*$SUMA_sucesores_cuadrantes_6/$SUMA_cuenta_total);

    $porc_total_1_9_4_8_6=round(100*$SUMA_sucesores_cuadrantes_1_9_4_8_7/$SUMA_cuenta_total);
    $porc_total_fem=round(100*$SUMA_cuenta_femenino/$SUMA_cuenta_total);
    $porc_total_mas=round(100*$SUMA_cuenta_masculino/$SUMA_cuenta_total);


    $PRINCIPAL = str_replace("{MASCULINO_PONDERADO}", "Sucesores Hombres: <div class='badge badge-info'>			<span style='color:#fff'>".($porc_total_mas)."%</span></div>",  $PRINCIPAL);
    $PRINCIPAL = str_replace("{FEMENINO_PONDERADO}", 	"Sucesores Mujeres: <div class='badge badge-info'>			<span style='color:#fff'>".($porc_total_fem)."%</span></div>",  $PRINCIPAL);

    $PRINCIPAL = str_replace("{CUADRANTE_23}", 			"Sucesores en Cuadrantes 2-3: <div class='badge badge-info'>			<span style='color:#fff'>".($porc_total_2_3)."%</span></div>",  $PRINCIPAL);
    $PRINCIPAL = str_replace("{CUADRANTE_6}", 			"Sucesores en Cuadrantes 6: <div class='badge badge-info'>			<span style='color:#fff'>".($porc_total_6)."%</span></div>",  $PRINCIPAL);
    $PRINCIPAL = str_replace("{CUADRANTE_19487}", 		"Sucesores en Cuadrantes 1-9-4-8-7: <div class='badge badge-info'>			<span style='color:#fff'>".($porc_total_1_9_4_8_6)."%</span></div>",  $PRINCIPAL);



    return ($PRINCIPAL);
}

function Potencial_Sucesion_Mi_Sucesion_estado_activo_2024($PRINCIPAL, $rut, $perfil, $id_empresa, $comite_cierre)
{
    $lista = Potencial_Sucesion_Mi_Sucesion_data_2024($id_empresa, $rut, $perfil);
    //print_r($lista);
    $nomuestracabeceras="";
    if($perfil=="VISUALIZADOR"){$nomuestracabeceras="1";}
    if($nomuestracabeceras=="1"){$lider="";$colab="";} else {$lider1="LIDER";$colab="COLAB.";}

    $num_comites    =   count($lista);
    if($num_comites>0){$potencial_titulo="";}   else   {
        $potencial_titulo="<div class='row'><div class='col-sm-12 txt_title_pot'><br><br><center>[ No hay comit&eacute;s de sucesión creados ]</center></div></div>";
    }
    foreach($lista as $unico) {
    $cuenta_lista++;
        $Usu=UsuaData2021_mini($rut);
        $num_colaboradores=0;
        $array_comite=Potencial_Comites_Suc_data_2024($unico->id_comite,$id_empresa);
        $id_comite_cerrado = $array_comite[0]->comite_cerrado;
        $row_lista.= file_get_contents("views/sucesion/row_mi_sucesion.html");
        //echo "<br>views/potencial/" . $id_empresa . "_potencial_row_comites.html";
        $row_lista = str_replace("{ID_COMITE}", ($unico->id_comite), $row_lista);
        $row_lista = str_replace("{COMITE}", ($unico->nombre), $row_lista);
        $row_lista = str_replace("{FECHA}", $unico->fecha_comite, $row_lista);
        $row_lista = str_replace("{CARGO}", $Usu[0]->d6, $row_lista);
        $row_lista = str_replace("{COLABORADORES}", $num_colaboradores, $row_lista);
        //$UsuaCreadorComite=DatosUsuario_($unico->rut, $id_empresa);
        $row_lista = str_replace("{NOMBRE_CREADOR_COMITE}",     $unico->nombre_creador, $row_lista);
        $row_lista = str_replace("{NOMBRE_LIDER_COMITE}",       $unico->nombre_lider, $row_lista);
        $row_lista = str_replace("{BOTON_VER_COMITE}", "<a href='?sw=sucesion_comite&id_comite=".Encodear3($unico->id_comite)."' class='btn btn-info'><span class='blanco'>Ingresar</span></a>", $row_lista);

        if($perfil=="SOCIO DE NEGOCIO" OR $perfil=="SUPER USER")    {
            $row_lista = str_replace("{BOTON_ELIMINAR_COMITE}", "<a href='?sw=sucesion&id_del=".Encodear3($unico->id_comite)."' class='btn btn-link'>
        	<span class='azul_comite'><i class='fas fa-trash-alt'></i></span></a>", $row_lista);
        }else {
            $row_lista = str_replace("{BOTON_ELIMINAR_COMITE}", "", $row_lista);
        }
    }
    $PRINCIPAL = str_replace("{MI_SUCESION}",         $row_lista,         $PRINCIPAL);
    $PRINCIPAL = str_replace("{MIS_COMITES_POTENCIAL_TITULO}",  $potencial_titulo,  $PRINCIPAL);


    if($cuenta_lista>0){
        $display_none_mi_sucesion="";
    } else {
        $display_none_mi_sucesion="display:none!important";
    }
    $PRINCIPAL = str_replace("{MI_SUCESION_DISPLAY_NONE}",  $display_none_mi_sucesion,  $PRINCIPAL);

    return ($PRINCIPAL);
}
function VerificaArregloSQLInjectionV2_bk($arreglo)
{
    $total_arreglo = count($arreglo);

    foreach ($arreglo as $clave => $valor) {

       if (strtoupper(trim($valor)) == "") {
            continue;
        }
     
        $valor = str_replace("'", "", $valor);
        $valor = str_replace('"', "", $valor);
        $valor = str_replace("+'", "", $valor);
        $valor = str_replace('--', "", $valor);
        $valor = str_replace('--', "", $valor);
        $valor = str_replace('--', "", $valor);
        //$valor = str_replace('', "", $valor);
        $valor = str_replace('.php', "", $valor);
        $valor = str_replace('.js', "", $valor);
        $valor = str_replace('.vbs', "", $valor);
        $valor = str_replace('%', "", $valor);
        //valor = str_replace('&', "", $valor);
        $valor = str_replace('&amp;', "", $valor);
        $valor = str_replace('&#38;', "", $valor);
        $valor = str_replace('<', "", $valor);
        $valor = str_replace('&lt;', "", $valor);
        $valor = str_replace('&#60;', "", $valor);
        $valor = str_replace('>', "", $valor);
        $valor = str_replace('&gt;', "", $valor);
        $valor = str_replace('&#62;', "", $valor);
        $valor = str_replace('&quot;', "", $valor);
        $valor = str_replace('&#34;', "", $valor);
        $valor = str_replace('&#39;', "", $valor);
        $valor = str_replace('select', "", $valor);
        $valor = str_replace('tables', "", $valor);
        $valor = str_replace('union', "", $valor);
        $valor = str_replace('information_schema', "", $valor);
        //$valor = str_replace('', "", $valor);
        $valor = str_replace('delete', "", $valor);
        $valor = str_replace('update', "", $valor);
        $valor = str_replace('show', "", $valor);
        $valor = str_replace('|', "", $valor);
        $arreglo[$clave]= $valor;
    }
    return ($arreglo);
}
function VerificaArregloSQLInjectionV2($arreglo) {
    // Define a regex pattern to match potentially dangerous characters and keywords
    $pattern = "/('|\"|<|>|`|\||;|%|--|\.php|\.js|select|delete|update|show|alert|script|onerror|onload|\x00|%00)/i";

    // Process each input parameter
    foreach ($arreglo as $clave => $valor) {
        // Skip if the value is empty after trimming whitespace
        if (trim($valor) == "") {
            continue;
        }

        // Remove any dangerous characters or keywords using regex
        $valor = preg_replace($pattern, '', $valor);

        // HTML encode the sanitized value to prevent XSS in general contexts
        $valor = htmlspecialchars($valor, ENT_QUOTES, 'UTF-8');

        // Percent-encode if the parameter is URL-related (e.g., 'url' or 'href' keys)
        if (strpos($clave, 'url') !== false || strpos($clave, 'href') !== false) {
            $valor = urlencode($valor);
        }

        // Sanitize input based on length and type expectations
        if (is_numeric($valor)) {
            $valor = (int)$valor; // Convert to integer if expecting a number
        } elseif (is_string($valor) && strlen($valor) > 1000) {
            $valor = substr($valor, 0, 1000); // Limit string length
        }

        // Assign the cleaned value back to the array
        $arreglo[$clave] = $valor;
    }
    return $arreglo;
}
function CheckVisualizaMiRxRxCol($miRx,	$miRx_2){
	
	if($miRx=="")		{$visualiza="NO";}
	if($miRx=="R1")	{$visualiza="SI";}

	if($miRx=="R2" and $miRx_2=="R1"){$visualiza="NO";}
	if($miRx=="R2" and $miRx_2=="R2"){$visualiza="NO";}
	if($miRx=="R2" and $miRx_2=="R3"){$visualiza="SI";}
	if($miRx=="R2" and $miRx_2=="R4"){$visualiza="SI";}
	if($miRx=="R2" and $miRx_2=="R5"){$visualiza="SI";}
	if($miRx=="R2" and $miRx_2=="R6"){$visualiza="SI";}
	if($miRx=="R2" and $miRx_2=="R7"){$visualiza="SI";}
	
	if($miRx=="R3" and $miRx_2=="R1"){$visualiza="NO";}
	if($miRx=="R3" and $miRx_2=="R2"){$visualiza="NO";}
	if($miRx=="R3" and $miRx_2=="R3"){$visualiza="NO";}
	if($miRx=="R3" and $miRx_2=="R4"){$visualiza="SI";}
	if($miRx=="R3" and $miRx_2=="R5"){$visualiza="SI";}
	if($miRx=="R3" and $miRx_2=="R6"){$visualiza="SI";}
	if($miRx=="R3" and $miRx_2=="R7"){$visualiza="SI";}

	if($miRx=="R4" and $miRx_2=="R1"){$visualiza="NO";}
	if($miRx=="R4" and $miRx_2=="R2"){$visualiza="NO";}
	if($miRx=="R4" and $miRx_2=="R3"){$visualiza="NO";}
	if($miRx=="R4" and $miRx_2=="R4"){$visualiza="NO";}
	if($miRx=="R4" and $miRx_2=="R5"){$visualiza="SI";}
	if($miRx=="R4" and $miRx_2=="R6"){$visualiza="SI";}
	if($miRx=="R4" and $miRx_2=="R7"){$visualiza="SI";}

	if($miRx=="R5" and $miRx_2=="R1"){$visualiza="NO";}
	if($miRx=="R5" and $miRx_2=="R2"){$visualiza="NO";}
	if($miRx=="R5" and $miRx_2=="R3"){$visualiza="NO";}
	if($miRx=="R5" and $miRx_2=="R4"){$visualiza="NO";}
	if($miRx=="R5" and $miRx_2=="R5"){$visualiza="NO";}
	if($miRx=="R5" and $miRx_2=="R6"){$visualiza="SI";}
	if($miRx=="R5" and $miRx_2=="R7"){$visualiza="SI";}

	if($miRx=="R6" and $miRx_2=="R1"){$visualiza="NO";}
	if($miRx=="R6" and $miRx_2=="R2"){$visualiza="NO";}
	if($miRx=="R6" and $miRx_2=="R3"){$visualiza="NO";}
	if($miRx=="R6" and $miRx_2=="R4"){$visualiza="NO";}
	if($miRx=="R6" and $miRx_2=="R5"){$visualiza="NO";}
	if($miRx=="R6" and $miRx_2=="R6"){$visualiza="NO";}
	if($miRx=="R6" and $miRx_2=="R7"){$visualiza="SI";}
			
	if($miRx=="R7" and $miRx_2=="R1"){$visualiza="NO";}
	if($miRx=="R7" and $miRx_2=="R2"){$visualiza="NO";}
	if($miRx=="R7" and $miRx_2=="R3"){$visualiza="NO";}
	if($miRx=="R7" and $miRx_2=="R4"){$visualiza="NO";}
	if($miRx=="R7" and $miRx_2=="R5"){$visualiza="NO";}
	if($miRx=="R7" and $miRx_2=="R6"){$visualiza="NO";}
	if($miRx=="R7" and $miRx_2=="R7"){$visualiza="NO";}	

	$perfil_super=Potencial_SoySuper($_SESSION["user_"]);
	//print_r($perfil_super);
	if($perfil_super>0){
		$visualiza="SI";
	}

    $perfil_sn=Potencial_Es_Socio($_SESSION["user_"]);
	if($perfil_sn>0){
		$visualiza="SI";
	}

	

	return $visualiza;
	
}
function CheckMiRxRxPropuesto($miRx,	$miRx_2){
	
	
	if($miRx=="")		{$save="NO";}
	if($miRx=="R1")	{$save="SI";}

	if($miRx=="R2" and $miRx_2=="R1"){$save="NO";}
	if($miRx=="R2" and $miRx_2=="R2"){$save="SI";}
	if($miRx=="R2" and $miRx_2=="R3"){$save="SI";}
	if($miRx=="R2" and $miRx_2=="R4"){$save="SI";}
	if($miRx=="R2" and $miRx_2=="R5"){$save="SI";}
	if($miRx=="R2" and $miRx_2=="R6"){$save="SI";}
	if($miRx=="R2" and $miRx_2=="R7"){$save="SI";}
	
	if($miRx=="R3" and $miRx_2=="R1"){$save="NO";}
	if($miRx=="R3" and $miRx_2=="R2"){$save="NO";}
	if($miRx=="R3" and $miRx_2=="R3"){$save="SI";}
	if($miRx=="R3" and $miRx_2=="R4"){$save="SI";}
	if($miRx=="R3" and $miRx_2=="R5"){$save="SI";}
	if($miRx=="R3" and $miRx_2=="R6"){$save="SI";}
	if($miRx=="R3" and $miRx_2=="R7"){$save="SI";}

	if($miRx=="R4" and $miRx_2=="R1"){$save="NO";}
	if($miRx=="R4" and $miRx_2=="R2"){$save="NO";}
	if($miRx=="R4" and $miRx_2=="R3"){$save="NO";}
	if($miRx=="R4" and $miRx_2=="R4"){$save="SI";}
	if($miRx=="R4" and $miRx_2=="R5"){$save="SI";}
	if($miRx=="R4" and $miRx_2=="R6"){$save="SI";}
	if($miRx=="R4" and $miRx_2=="R7"){$save="SI";}

	if($miRx=="R5" and $miRx_2=="R1"){$save="NO";}
	if($miRx=="R5" and $miRx_2=="R2"){$save="NO";}
	if($miRx=="R5" and $miRx_2=="R3"){$save="NO";}
	if($miRx=="R5" and $miRx_2=="R4"){$save="NO";}
	if($miRx=="R5" and $miRx_2=="R5"){$save="SI";}
	if($miRx=="R5" and $miRx_2=="R6"){$save="SI";}
	if($miRx=="R5" and $miRx_2=="R7"){$save="SI";}


	if($miRx=="R6" and $miRx_2=="R1"){$save="NO";}
	if($miRx=="R6" and $miRx_2=="R2"){$save="NO";}
	if($miRx=="R6" and $miRx_2=="R3"){$save="NO";}
	if($miRx=="R6" and $miRx_2=="R4"){$save="NO";}
	if($miRx=="R6" and $miRx_2=="R5"){$save="NO";}
	if($miRx=="R6" and $miRx_2=="R6"){$save="SI";}
	if($miRx=="R6" and $miRx_2=="R7"){$save="SI";}
			
	if($miRx=="R7" and $miRx_2=="R1"){$save="NO";}
	if($miRx=="R7" and $miRx_2=="R2"){$save="NO";}
	if($miRx=="R7" and $miRx_2=="R3"){$save="NO";}
	if($miRx=="R7" and $miRx_2=="R4"){$save="NO";}
	if($miRx=="R7" and $miRx_2=="R5"){$save="NO";}
	if($miRx=="R7" and $miRx_2=="R6"){$save="NO";}
	if($miRx=="R7" and $miRx_2=="R7"){$save="SI";}	

	return $save;
	
}
function PotChecKMisUsuarioFuera($rut_col){
	
	//echo "<h1>rut_col $rut_col</h1>";
	$soy_super=Potencial_SoySuper($_SESSION["user_"]);
	//echo "PotChecKMisUsuarioFuera soy super $soy_super";
	
	if($soy_super>0){
		//echo "soy syper";
	} else {
		//echo "no soy syper. ";
		$bloqueado=Check_Usr_PrimerNivel_Bloqueado($rut_col);
		if($bloqueado>0){
			echo "    <script>         location.href='?sw=home_bci_new';     </script>"; exit;	
		}
	//echo "bloqueado $bloqueado .";	
	
	$bloqueadoGGPP=Check_Usr_PrimerNivel_BloqueadoGGPP($rut_col);
	//echo "bloqueadoGGPP $bloqueadoGGPP .";	
		if($bloqueadoGGPP>0){
				//echo "<br>UNO Bloqueo<br>".$_SESSION["user_"]." rut col ".$rut_col;	
				$BloqueSoyLider=Check_Usr_PrimerNivel_BloqueadoGGPP_soyLider($rut_col);
				//echo "<br>UNO BloqueSoyLider<br>".$BloqueSoyLider;	
				
				if($BloqueSoyLider>0){
					//echo "a"; 
					
				} else {
					$continue="1";
										//echo "<br>b"; continue;
				//echo "    <script>         location.href='?sw=home_bci_new1';     </script>"; exit;	
					
				}
				
		}
	}
	if($soy_super>0){
	} else {
		
	
		if($_SESSION["user_"]==LimpiaRutFront($rut_col)){
			echo "    <script>         location.href='?sw=home_bci_new';     </script>"; exit;		
		}
	}
	return $continue;
}
// panel de liderazgo
function Panel_valor_competencias_en_base_cien($promedio_res){
	
	
//echo "<br>promedio_res $promedio_res<br>";
	
if($promedio_res>=1 and $promedio_res<1.1){$valor=0;}
if($promedio_res>=1.1 and $promedio_res<1.2){$valor=5.5625;}
if($promedio_res>=1.2 and $promedio_res<1.3){$valor=11.125;}
if($promedio_res>=1.3 and $promedio_res<1.4){$valor=16.6875;}
if($promedio_res>=1.4 and $promedio_res<1.5){$valor=22.25;}
if($promedio_res>=1.5 and $promedio_res<1.6){$valor=27.8125;}
if($promedio_res>=1.6 and $promedio_res<1.7){$valor=33.375;}
if($promedio_res>=1.7 and $promedio_res<1.8){$valor=38.9375;}
if($promedio_res>=1.8 and $promedio_res<1.9){$valor=44.5;}
if($promedio_res>=1.9 and $promedio_res<2){$valor=50.0625;}
if($promedio_res>=2 and $promedio_res<2.1){$valor=55.625;}
if($promedio_res>=2.1 and $promedio_res<2.2){$valor=61.1875;}
if($promedio_res>=2.2 and $promedio_res<2.3){$valor=66.75;}
if($promedio_res>=2.3 and $promedio_res<2.4){$valor=72.3125;}
if($promedio_res>=2.4 and $promedio_res<2.5){$valor=77.875;}
if($promedio_res>=2.5 and $promedio_res<2.59){$valor=83.4375;}
if($promedio_res>=2.59 and $promedio_res<2.6){$valor=89;}
if($promedio_res>=2.6 and $promedio_res<2.7){$valor=90;}
if($promedio_res>=2.7 and $promedio_res<2.8){$valor=92;}
if($promedio_res>=2.8 and $promedio_res<2.9){$valor=94;}
if($promedio_res>=2.9 and $promedio_res<3){$valor=96;}
if($promedio_res>=3 and $promedio_res<3.1){$valor=98;}
if($promedio_res>=3.1 and $promedio_res<3.2){$valor=100;}
if($promedio_res>=3.2 and $promedio_res<3.3){$valor=102;}
if($promedio_res>=3.3 and $promedio_res<3.4){$valor=104;}
if($promedio_res>=3.4 and $promedio_res<3.5){$valor=106;}
if($promedio_res>=3.5 and $promedio_res<3.59){$valor=108;}
if($promedio_res>=3.59 and $promedio_res<3.6){$valor=110;}
if($promedio_res>=3.6 and $promedio_res<3.7){$valor=111.33;}
if($promedio_res>=3.7 and $promedio_res<3.8){$valor=112.66;}
if($promedio_res>=3.8 and $promedio_res<3.9){$valor=113.99;}
if($promedio_res>=3.9 and $promedio_res<4){$valor=115.32;}
if($promedio_res>=4 and $promedio_res<4.1){$valor=116.65;}
if($promedio_res>=4.1 and $promedio_res<4.2){$valor=117.98;}
if($promedio_res>=4.2 and $promedio_res<4.3){$valor=119.31;}
if($promedio_res>=4.3 and $promedio_res<4.4){$valor=120.64;}
if($promedio_res>=4.4 and $promedio_res<4.5){$valor=121.97;}
if($promedio_res>=4.5 and $promedio_res<4.6){$valor=123.3;}
if($promedio_res>=4.6 and $promedio_res<4.7){$valor=124.63;}
if($promedio_res>=4.7 and $promedio_res<4.8){$valor=125.96;}
if($promedio_res>=4.8 and $promedio_res<4.9){$valor=127.29;}
if($promedio_res>=4.9 and $promedio_res<5){$valor=128.62;}
if($promedio_res>=5 and $promedio_res<6){$valor=130;}


	return $valor;
	//echo "<br>valor $valor<br>";

}
function Panel_valor_liderazgo_en_base_cien($promedio_res){
	
	
//echo "<br>Panel_valor_liderazgo_en_base_cien $promedio_res<br>";
	
	
if($promedio_res>=100 and $promedio_res<1000){$valor=130;}
if($promedio_res>=99 and $promedio_res<100){$valor=128.5;}
if($promedio_res>=98 and $promedio_res<99){$valor=127;}
if($promedio_res>=97 and $promedio_res<98){$valor=125.5;}
if($promedio_res>=96 and $promedio_res<97){$valor=124;}
if($promedio_res>=95 and $promedio_res<96){$valor=122.5;}
if($promedio_res>=94 and $promedio_res<95){$valor=121;}
if($promedio_res>=93 and $promedio_res<94){$valor=119.5;}
if($promedio_res>=92 and $promedio_res<93){$valor=118;}
if($promedio_res>=91 and $promedio_res<92){$valor=116.5;}
if($promedio_res>=90 and $promedio_res<91){$valor=115;}
if($promedio_res>=89 and $promedio_res<90){$valor=113.5;}
if($promedio_res>=88 and $promedio_res<89){$valor=112;}
if($promedio_res>=87 and $promedio_res<88){$valor=110.5;}
if($promedio_res>=86 and $promedio_res<87){$valor=109;}
if($promedio_res>=85 and $promedio_res<86){$valor=107.5;}
if($promedio_res>=84 and $promedio_res<85){$valor=106;}
if($promedio_res>=83 and $promedio_res<84){$valor=104.5;}
if($promedio_res>=82 and $promedio_res<83){$valor=103;}
if($promedio_res>=81 and $promedio_res<82){$valor=101.5;}
if($promedio_res>=80 and $promedio_res<81){$valor=100;}
if($promedio_res>=79 and $promedio_res<80){$valor=98.5;}
if($promedio_res>=78 and $promedio_res<79){$valor=97;}
if($promedio_res>=77 and $promedio_res<78){$valor=95.5;}
if($promedio_res>=76 and $promedio_res<77){$valor=94;}
if($promedio_res>=75 and $promedio_res<76){$valor=92.5;}
if($promedio_res>=74 and $promedio_res<75){$valor=91;}
if($promedio_res>=73 and $promedio_res<74){$valor=89.5;}
if($promedio_res>=72 and $promedio_res<73){$valor=88;}
if($promedio_res>=71 and $promedio_res<72){$valor=86.5;}
if($promedio_res>=70 and $promedio_res<71){$valor=85;}
if($promedio_res>=69 and $promedio_res<70){$valor=83.5;}
if($promedio_res>=68 and $promedio_res<69){$valor=82;}
if($promedio_res>=67 and $promedio_res<68){$valor=80.5;}
if($promedio_res>=66 and $promedio_res<67){$valor=79;}
if($promedio_res>=65 and $promedio_res<66){$valor=77.5;}
if($promedio_res>=64 and $promedio_res<65){$valor=76;}
if($promedio_res>=63 and $promedio_res<64){$valor=74.5;}
if($promedio_res>=62 and $promedio_res<63){$valor=73;}
if($promedio_res>=61 and $promedio_res<62){$valor=71.5;}
if($promedio_res>=60 and $promedio_res<61){$valor=70;}
if($promedio_res>=59 and $promedio_res<60){$valor=0;}
if($promedio_res>=58 and $promedio_res<59){$valor=0;}
if($promedio_res>0 and $promedio_res<58){$valor=0;}


//echo "<br>Panel_valor_liderazgo_en_base_cien $valor<br>";



	return $valor;
	//echo "<br>valor $valor<br>";

}
function PanelBuscaTipoDatos($PRINCIPAL, $id_empresa, $rut_col, $tipo, $year)
{
	
if($tipo=="QUE"){

$PanelTipoFlexContinue	=PanelBuscoFlexPersonaYDanCotinue($rut_col, $id_empresa);
	//echo "<br>continue para $rut_col es $PanelTipoFlexContinue<br>";
	$Panel_Criterios=PanelBuscaPanelCriterios($tipo, $id_empresa);
	//print_r($Panel_Criterios);
	$cuenta_verde=0;
	$cuenta_todos=0;	
	foreach ($Panel_Criterios as $unico){

		if($unico->id_kpi==$PanelTipoFlexContinue){continue;}
						
			$array_res			=		PanelBuscaResultadoKpiInicioFinal($unico->id_kpi, $rut_col, $id_empresa,$year);
				//echo "<pre>";print_r($array_res);echo "</pre>";		

			$array_res_inicio	=	$array_res[0];
			$array_res_final	=	$array_res[1];
			//echo "<pre>";
			//print_r($array_res_inicio);
			//echo "</pre>";
	
			$resultado_inicial		=		round(100*$array_res_inicio[0]->numerador/$array_res_inicio[0]->dotacion);
			$resultado_final			=		round(100*$array_res_final[0]->numerador/$array_res_final[0]->dotacion);
			//echo "<br>resultado inicial $resultado_inicial, resultado final $resultado_final<br>";

			$resultado_inicial		=		round($array_res_inicio[0]->cumplimiento);
			$resultado_final			=		round($array_res_final[0]->cumplimiento);	
			
			if($unico->id_kpi=="en"){
				$resultado_inicial			=		PanelBuscaResultadoKpiInicioFinalEngLid("eng_c", $rut_col, $id_empresa,$year);
				$resultado_final				=  	$resultado_inicial;
			}

			$gestion				= 	PanelGeneraGestionDadoKpi($resultado_inicial, $resultado_final);
			$semaforo				=		PanelGeneraSemaforoDadoKpi($resultado_inicial, $resultado_final, $unico->kpi_aspiracional);
			$semaforo_txt		=		PanelGeneraTxtSemaforoDadoKpi($resultado_inicial, $resultado_final, $unico->kpi_aspiracional);
			
			
			if($semaforo=="<div class='panel_semaforo_verde'><i class='fas fa-dot-circle'></i></div>"){$cuenta_verde++;}
			$cuenta_todos++;
			//echo "<br>kpi ".$unico->id_kpi."->  $cuenta_verde semaforo ".$semaforo;
			$url="?sw=panel_liderazgo_vista_usuario_tendencia&rutcol=".Encodear3($rut_col)."&idp=".Encodear3($unico->id_kpi);
			
	   	$row.= file_get_contents("views/panel_liderazgo/row_vista_colaborador.html");	
	   	$row = str_replace("{NOMBRE_KPI}",     	($unico->kpi), $row);
	   	$row = str_replace("{PONDERACION}",    	($unico->ponderacion), $row);
	   	$row = str_replace("{ASPIRACIONAL}",   	($unico->kpi_aspiracional), $row);
	   	$row = str_replace("{RESULTADO}",      	($resultado_final), $row);
	   	$row = str_replace("{GESTION}",      		($gestion), $row);
	   	$row = str_replace("{SEMAFORO}",      	($semaforo), $row);
	   	$row = str_replace("{URL}",      				($url), $row);
		//echo "<br>cuenta verde. $semaforo_txt. $cuenta_verde.<br>";
	}

		$resultado_cuenta_verdes_que=PanelResultadoCuentaVerdes($cuenta_verde,$cuenta_todos);
		$PRINCIPAL = str_replace("{RESULTADO_QUE}",         $resultado_cuenta_verdes_que,         $PRINCIPAL);
    $PRINCIPAL = str_replace("{PANEL_ROW_QUE}",         $row,         												$PRINCIPAL);
}


if($tipo=="COMPETENCIAS"){

				PanelBuscaResultadoKpiInicioFinalEngLid($id_kpi, $rut_col, $id_empresa, $year);
				$resultado_inicial_LID			=		PanelBuscaResultadoKpiInicioFinalEngLid("lid_c", $rut_col, $id_empresa,$year);
				$aspiracional_LID						=  	PanelBuscaAspiracionalCriterio("en");
				$semaforo										=		PanelGeneraSemaforoDadoKpi($resultado_inicial_LID, $resultado_inicial_LID, $aspiracional_LID);


    $PRINCIPAL = str_replace("{ASPIRACIONAL_LIDERAZGO}",      $aspiracional_LID,         												$PRINCIPAL);
    $PRINCIPAL = str_replace("{RESULTADO_LIDERAZGO}",         $resultado_inicial_LID,							$PRINCIPAL);
    $PRINCIPAL = str_replace("{GESTION_LIDERAZGO}",           "",         												$PRINCIPAL);
    $PRINCIPAL = str_replace("{SEMAFORO_LIDERAZGO}",          $semaforo,         												$PRINCIPAL);

$cumplimiento_liderazgo=Panel_valor_liderazgo_en_base_cien($resultado_inicial_LID);

    $PRINCIPAL = str_replace("{CUMPLIMIENTO_LIDERAZGO}",          $cumplimiento_liderazgo,         												$PRINCIPAL);

	$Panel_Criterios=PanelBuscaPanelCriterios($tipo, $id_empresa);
	foreach ($Panel_Criterios as $unico){

			//echo "<br><br>id ".$unico->id_kpi."<br><br>";
			$array_res		=PanelBuscaResultadosCompetencias($unico->id_kpi, $rut_col, $year, $id_empresa);
			//print_r($array_res);
			
			foreach ($array_res as $un){
					//print_r($un);
					if($un->evaluacion == "Autoevaluacion")	{								$res_ae	=	$un->resultado;}
					if($un->evaluacion == "Descendente")		{								$res_ds	=	$un->resultado;}
					if($un->evaluacion == "Mis Pares")			{								$res_mp	=	$un->resultado;}
					if($un->evaluacion == "Ascendente")			{								$res_as	=	$un->resultado;}
			}

			//echo "<br><br>AE $res_ae , DS $res_ds, MP $res_mp, AS $res_as";
			$res_linea_competencia			= 	PanelResCompetenciaLinea($res_ae,$res_ds,$res_mp,$res_as);
			
			//print_r($res_linea_competencia);		
			
			$res_linea_competencia_res  =	  $res_linea_competencia[0];
			
			$pon_ds			=		$res_linea_competencia[1];
			$pon_as			=		$res_linea_competencia[2];
			$pon_mp     =		$res_linea_competencia[3];
			$pon_ae     =		$res_linea_competencia[4];		
			
			//echo "<br>pon_ae $pon_ae";
			
			//$res_linea_competencia			=   PanelLiderazgoResultadoFinal($res_ds,$res_ae,$res_as,$res_mp);
			$suma_res										=		$suma_res	+	round($res_linea_competencia_res*20/100,2);
			//echo "<br>$res_linea_competencia, $suma_res	";

			
			//echo "<br>kpi ".$unico->id_kpi.", res $suma_res		= liunea competencia		$res_linea_competencia	+	suma_res	$suma_res ";
			
			$cuenta_competencias++;
			//echo "<br>rut $rut_col,  Resultaso competencias ".$array_res[0]->evaluacion." resultados ".$array_res[0]->resultado." des $res_ds";
			
	   	$row.= file_get_contents("views/panel_liderazgo/row_vista_colaborador_competencias.html");	
	   	$row = str_replace("{NOMBRE_KPI}",     	($unico->kpi), $row);
	   	$row = str_replace("{PONDERACION}",    	($unico->ponderacion), $row);
	   	$row = str_replace("{DESCENDENTE}",   	($res_ds), $row);
	   	$row = str_replace("{ASCENDENTE}",     	($res_as), $row);
	   	$row = str_replace("{AUTOEVALUACION}", 	($res_ae), $row);
	   	$row = str_replace("{PARES}",      			($res_mp), $row);
	   	$row = str_replace("{RESULTADO_PONDERADO_COMPETENCIAS}",    ($res_linea_competencia_res), $row);

			$res_ds_number=str_replace(",",".",$res_ds);
			$res_as_number=str_replace(",",".",$res_as);
			$res_ae_number=str_replace(",",".",$res_ae);
			$res_mp_number=str_replace(",",".",$res_mp);
			$res_linea_competencia_number=str_replace(",",".",$res_linea_competencia_res);



			if($res_ds<>""){$suma_res_ds=$res_ds_number+$suma_res_ds; $cuenta_res_ds++;}
			if($res_as<>""){$suma_res_as=$res_as_number+$suma_res_as; $cuenta_res_as++;}
			if($res_ae<>""){$suma_res_ae=$res_ae_number+$suma_res_ae; $cuenta_res_ae++;}
			if($res_mp<>""){$suma_res_mp=$res_mp_number+$suma_res_mp; $cuenta_res_mp++;}
			if($res_linea_competencia<>""){$suma_res_linea=$res_linea_competencia_number+$suma_res_linea; $cuenta_res_linea++;}
		//echo "<br>cuenta verde. $semaforo_txt. $cuenta_verde.<br>";
	}

$promedio_ds		=round($suma_res_ds/$cuenta_res_ds, 2);
$promedio_as		=round($suma_res_as/$cuenta_res_as, 2);
$promedio_ae		=round($suma_res_ae/$cuenta_res_ae, 2);
$promedio_mp		=round($suma_res_mp/$cuenta_res_mp, 2);
$promedio_res		=round($suma_res_linea/$cuenta_res_linea, 2);


			//echo "<br>promedio RE $promedio_res, $suma_res_linea/$cuenta_res_linea";
	   	$row.= file_get_contents("views/panel_liderazgo/row_vista_colaborador_competencias_total.html");	
	   	$row = str_replace("{NOMBRE_KPI}",     	"Resultado Total", $row);
	   	$row = str_replace("{PONDERACION}",    	"", $row);
	   	$row = str_replace("{DESCENDENTE}",   	($promedio_ds), $row);
	   	$row = str_replace("{ASCENDENTE}",     	($promedio_as), $row);
	   	$row = str_replace("{AUTOEVALUACION}", 	($promedio_ae), $row);
	   	$row = str_replace("{PARES}",      			($promedio_mp), $row);
	   	$row = str_replace("{RESULTADO_PONDERADO_COMPETENCIAS}",    ($promedio_res), $row);

//LIDERAZGO 
$valor_competencias_en_base_cien=Panel_valor_competencias_en_base_cien($promedio_res);

	   	
	   	$row.= file_get_contents("views/panel_liderazgo/row_vista_colaborador_competencias_total.html");	
	   	$row = str_replace("{NOMBRE_KPI}",     	"Cumplimiento", $row);
	   	$row = str_replace("{PONDERACION}",    	"", $row);
	   	$row = str_replace("{DESCENDENTE}",   	"", $row);
	   	$row = str_replace("{ASCENDENTE}",     	"", $row);
	   	$row = str_replace("{AUTOEVALUACION}", 	"", $row);
	   	$row = str_replace("{PARES}",      			"", $row);
	   	$row = str_replace("{RESULTADO_PONDERADO_COMPETENCIAS}",    ($valor_competencias_en_base_cien)."%", $row);
	   	


//echo "<br>lid  $resultado_inicial_LID competencia $valor_competencias_en_base_cien";
$suma_lid		=	round($cumplimiento_liderazgo*20/100,2);
//Suma Competencia
$suma_comp	=	round($valor_competencias_en_base_cien*80/100,2);
$resultado_como	= round($suma_lid+$suma_comp);

if($valor_competencias_en_base_cien==""){
	$resultado_como	= round($cumplimiento_liderazgo);

}


if($cumplimiento_liderazgo>0){
	
}else {
	if($valor_competencias_en_base_cien<>""){
		$resultado_como	= round($valor_competencias_en_base_cien);	
	}
}

//echo "cumplimiento_liderazgo $cumplimiento_liderazgo, $valor_competencias_en_base_cien";
//echo "<br>$suma_total_competencias=$suma_lid+$suma_res";

		//echo "<br>suma_res $suma_res, cuenta_competencias $cuenta_competencias";
		//$resultado_competencia			=		round($suma_res/$cuenta_competencias,2);
		//$resultado_competencia_final	= PanelCompetenciaCriteriosFinal($resultado_competencia);
		//echo "<br>Resultado $resultado_competencia, txt $resultado_competencia_final";
		
		$PRINCIPAL = str_replace("{RESULTADO_COMPETENCIAS}",         $resultado_como,         $PRINCIPAL);
    $PRINCIPAL = str_replace("{PANEL_ROW_COMPETENCIAS}",         $row,         												$PRINCIPAL);
}

	
    $PRINCIPAL             = str_replace("{FOTO_PERSONA}", VerificaFotoPersonal($rut), $PRINCIPAL);
    $datos_usuario         = DatosUsuarioLeftJefeDeTblUsuario($rut);
    //Datos JEfe
    $arreglo_rut_jefe      = explode("-", $datos_usuario[0]->jefe);
    $datos_personales_jefe = DatosUsuarioLeftJefeDeTblUsuario($arreglo_rut_jefe[0]);
    $PRINCIPAL             = str_replace("{NOMBRE}", ($datos_usuario[0]->nombre . " " . $datos_usuario[0]->apaterno . " " . $datos_usuario[0]->amaterno), $PRINCIPAL);
    $PRINCIPAL             = str_replace("{CARGO}", ($datos_usuario[0]->cargo), $PRINCIPAL);
    $PRINCIPAL             = str_replace("{GERENCIA}", ($datos_usuario[0]->gerencia), $PRINCIPAL);
    $PRINCIPAL             = str_replace("{DIVISION}", ($datos_usuario[0]->division), $PRINCIPAL);
    $PRINCIPAL             = str_replace("{CORREO}", $datos_usuario[0]->email, $PRINCIPAL);
    $PRINCIPAL             = str_replace("{RUT_ENCODEADO}", Encodear3($rut), $PRINCIPAL);
  


/*  $txt_ae="AE".$pon_ae."%";
  echo "	<br>txt_ae $txt_ae
  				<br>pon_ae $pon_ae";
  $txt_as=$pon_as."%";
  $txt_ds=$pon_ds."%";
  $txt_mp=$pon_mp."%";
  */
  
  //print_r($res_linea_competencia);
  		$pon_ds			=		$res_linea_competencia[1];
			$pon_as			=		$res_linea_competencia[2];
			$pon_mp     =		$res_linea_competencia[3];
			$pon_ae     =		$res_linea_competencia[4];		
  
   
   /* echo "	<br>txt_ae $txt_ae
  				<br>pon_ae $pon_ae";
    */
    
    $ponderadiones_mostrar[1]=$pon_ds;
    $ponderadiones_mostrar[2]=$pon_as;
    $ponderadiones_mostrar[3]=$pon_mp;
    $ponderadiones_mostrar[4]=$pon_ae;
    
    
    $arreglo[0]=$PRINCIPAL;
    $arreglo[1]=$resultado_cuenta_verdes_que;
    $arreglo[2]="";
    $arreglo[3]=$resultado_como;
    $arreglo[4]=$ponderadiones_mostrar;
    
    return ($arreglo);
}
function Potencial_CalculoPorcentaje($cuenta_inmediato,$cuenta_mediano,$cuenta_largo){
		$porcentaje=0;
		if($cuenta_largo>0)					{ $porcentaje=50;}
		if($cuenta_mediano>0)					{ $porcentaje=70;}
		if($cuenta_inmediato>0)					{ $porcentaje=100;}
	
	return $porcentaje;
}
function Potencial_Sucesion_Actualiza_GerentesR2_old($rut_R1, $id_empresa, $id_comite){
			Potencial_Sucesion_Truncate($id_comite);
			$array_g2=PotencialSucesion_BuscaR2($rut_R1, $id_empresa);
			foreach ($array_g2 as $unico){
					//echo "<br>rut ".$unico->rut;
					Potencial_Sucesion_CheckSave($unico->rut,$unico->d151,$id_comite,$id_empresa);
			}
}
function Potencial_Sucesion_Actualiza_GerentesR2($rut_R1, $id_empresa, $id_comite){
    Potencial_Sucesion_Truncate($id_comite);
    $array_g2=PotencialSucesion_BuscaR2($rut_R1, $id_empresa);
    foreach ($array_g2 as $unico){
        //echo "<br>rut ".$unico->rut;
        Potencial_Sucesion_CheckSave($unico->rut,$unico->d6,$id_comite,$id_empresa);
    }
}
function Potencial_Sucesion_Colaboradores_Comites($PRINCIPAL, $id_comite, $rut, $perfil, $id_empresa)
{
    $lista = Potencial_Sucesion_Colaboradores_Comites_data($id_comite, $rut, $perfil, $id_empresa);
    //print_r($lista);
    
    $num_comites    =   count($lista);
    //echo "<br>num_comites $num_comites<br>";
    if($num_comites>0){
        $potencial_titulo="
					<div class=''>

					</div>";
    }   else   {
        $potencial_titulo="
					<div class=''><br>
					    <div class='col-sm-12 txt_title_pot_hohay'><center>[ No hay cargos a suceder ]</center></div>
					    					<br>
					</div>";
    }
		
		$cuenta_inmediato=0; $cuenta_mediano=0; $cuenta_largo=0;
			
    foreach($lista as $unico) {
        $row_lista.= file_get_contents("views/potencial/" . $id_empresa . "_potencial_sucesion_row_colaboradores_comites.html");
        $row_lista = str_replace("{RUT}",           ($unico->rut), $row_lista);
        $Potencial_Mapeado=Potencial_Check_Mapeado($unico->rut);
	        if($Potencial_Mapeado<>""){
	        	$row_lista = str_replace("{MAPEADO}",           "<span class='badge badge-success' style='font-size: 10px;'><span class='blanco'>Mapeado</span></span>", $row_lista);
	        } else {
	        	$row_lista = str_replace("{MAPEADO}",         	"", $row_lista);
	        }

			$pos_validada=Sucesion_Check_Posicion_validada($unico->cargo_col);
			if($pos_validada>0){
					$pot_sucesion_badge_ok_cerrado="<div class='badge badge-success'><i class='fas fa-check' style='color: #fff;'></i></div>";
				} else {
					$pot_sucesion_badge_ok_cerrado="";
				}
      	$row_lista = str_replace("{CARGO_SUCEDER_LIDER_CERRADO}",         	$pot_sucesion_badge_ok_cerrado, $row_lista);



				$modal_row_rutc_col	 = "
				
						<a href='?sw=potencial_ficha_sucesion&id_posicion_enc=".Encodear3($unico->cargo_col)."&id_comite=".Encodear3($id_comite)."&perfil=".Encodear3($perfil)."' 
						    class='btn btn-info'> 
								 Ver Matriz de Sucesi&oacute;n 
						</a>
						
						<!--<button type='button' class='btn btn-primary' data-toggle='modal' data-target='#exampleModal_".$unico->rut."'>
  								Vista Sucesión
						</button>				-->
				";
				
				
				
$sucesores_cuadrantes_2_3_6=0;
$sucesores_cuadrantes_1_9_4_8_7=0;
$cuenta_femenino=0;
$cuenta_total=0;				
				//
				$row_inmediato="";
				$row_lista1="";
				$cuenta_inmediato="";
				$Inmediato=PotencialSucesion_Vista_Colaboradores_Posicion($id_comite, $unico->rut, $id_empresa, "Inmediato", $unico->cargo_col);
				
				foreach ($Inmediato as $uni1){

			        if($uni1->estado=="No es sucesor"){continue;}
					
							$cuenta_inmediato++;
			        $row_lista1.= file_get_contents("views/potencial/" . $id_empresa . "_potencial_sucesion_row_colaboradores_comites_sucesion.html");
			        $row_lista1 = str_replace("{AVATAR_RUT_SUCESORES}",   				VerificaFotoPersonal($uni1->rut_col), $row_lista1);
							
							$Usua1=DatosUsuario_($uni1->rut_col, $id_empresa);
			        $row_lista1 = str_replace("{COLABORADOR_SUCESORES}",     ($Usua1[0]->nombre_completo), $row_lista1);
			        $row_lista1 = str_replace("{CARGO_SUCESORES}",           ($Usua1[0]->cargo), $row_lista1);
			        $row_lista1 = str_replace("{TEMPORALIDAD}",           	"Inmediato / Hoy", $row_lista1);

			        $cuadrante1=Potencial_Mi_Cuadrante_Actual($uni1->rut_col);
			        //echo "<br>cuadrante1<br>";print_r($cuadrante1);
			        
			        $genero1=Potencial_Genero($uni1->rut_col);
			        
			        if($cuadrante1=="2" or $cuadrante1=="3" or $cuadrante1=="6")	{$sucesores_cuadrantes_2_3_6++;}
			        if($cuadrante1=="1" or $cuadrante1=="9" or $cuadrante1=="4" or $cuadrante1=="8" or $cuadrante1=="7")	{$sucesores_cuadrantes_1_9_4_8_7++;}
			        if($genero1=="Femenino")																			{$cuenta_femenino++;}        
			        $cuenta_total++;
			        $row_lista1 = str_replace("{RUT}",           ($uni1->rut_col), $row_lista1);
			        $row_lista1 = str_replace("{COLABORADOR}",   	($uni1->nombre_completo), $row_lista1);
			        $row_lista1 = str_replace("{CARGO_COL}",   		($uni1->cargo_col), $row_lista1);					
			        $row_lista1 = str_replace("{BOTON_VER_FICHA}","<a href='?sw=potencial_ficha&rut_col=".Encodear3($uni1->rut)."&id_comite=".Encodear3($id_comite)."' class='btn btn-link' >
			        <span class='azul_comite'><i class='fas fa-user'></i> <span class='mt-comment-authorSM'> Ficha</span></span></a>", $row_lista1);
						  $row_lista1 = str_replace("{BOTON_VER_FICHA_A_inicial}","<a href='?sw=potencial_ficha&rut_col=".Encodear3($uni1->rut_col)."&id_comite=".Encodear3($id_comite)."'
						   class='btn btn-link' style='padding-left: 0px;    padding-left: 0px;text-align: left;padding-right: 0px;padding: 0px;'>", $row_lista1);
						  $row_lista1 = str_replace("{BOTON_VER_FICHA_B_final}","</a>", $row_lista1);					
				}
				
				$row_mediano="";
				$row_lista2="";
				$cuenta_mediano="";
				$Mediano=PotencialSucesion_Vista_Colaboradores_Posicion($id_comite, 	$unico->rut, $id_empresa, "Mediano", $unico->cargo_col);
				
		//$Largo=PotencialSucesion_Vista_Colaboradores_Posicion($id_comite, 		$unico->rut, $id_empresa, "Largo", $unico->cargo_col);
				foreach ($Mediano as $uni2){
							$cuenta_mediano++;
							
			        if($uni2->estado=="No es sucesor"){continue;}
							
			        $row_lista2.= file_get_contents("views/potencial/" . $id_empresa . "_potencial_sucesion_row_colaboradores_comites_sucesion.html");
			        $row_lista2 = str_replace("{RUT}",           ($uni3->rut_col), $row_lista2);
			        $row_lista2 = str_replace("{COLABORADOR}",   	($uni3->nombre_completo), $row_lista2);
				
		        $row_lista2 = str_replace("{CARGO_COL}",   		($uni2->cargo_col), $row_lista2);				
			        $row_lista2 = str_replace("{TEMPORALIDAD}",           	"Mediano / 1 a 2 a&ntilde;os", $row_lista2);
			        $row_lista2 = str_replace("{AVATAR_RUT_SUCESORES}",   				VerificaFotoPersonal($uni2->rut_col), $row_lista2);
							$cuenta_total++;
			        
			        
							$Usua2=DatosUsuario_($uni2->rut_col, $id_empresa);
			        $row_lista2 = str_replace("{COLABORADOR_SUCESORES}",     ($Usua2[0]->nombre_completo), $row_lista2);
			        $row_lista2 = str_replace("{CARGO_SUCESORES}",           ($Usua2[0]->cargo), $row_lista2);

			        $cuadrante2=Potencial_Mi_Cuadrante_Actual($uni2->rut_col);
			        //echo "<br>cuadrante2<br>"; print_r($cuadrante2);
			        
			        $genero2=Potencial_Genero($uni2->rut_col);

			        if($cuadrante2=="2" or $cuadrante2=="3")	    {$sucesores_cuadrantes_2_3++;}
                    if($cuadrante2=="6")	                        {$sucesores_cuadrantes_6++;}
			        if($cuadrante2=="1" or $cuadrante2=="9" or $cuadrante2=="4" or $cuadrante2=="8" or $cuadrante2=="7")	{$sucesores_cuadrantes_1_9_4_8_7++;}
			        if($genero2=="Femenino")																			{$cuenta_femenino++;}        
		        	
			        $row_lista2 = str_replace("{BOTON_VER_FICHA}","<a href='?sw=potencial_ficha&rut_col=".Encodear3($uni2->rut)."&id_comite=".Encodear3($id_comite)."' class='btn btn-link' >			        <span class='azul_comite'><i class='fas fa-user'></i> <span class='mt-comment-authorSM'> Ficha</span></span></a>", $row_lista2);						  
			        $row_lista2 = str_replace("{BOTON_VER_FICHA_A_inicial}","<a href='?sw=potencial_ficha&rut_col=".Encodear3($uni2->rut_col)."&id_comite=".Encodear3($id_comite)."'
						   class='btn btn-link' style='padding-left: 0px;    padding-left: 0px;text-align: left;padding-right: 0px; padding: 0px;'>", $row_lista2);
						  $row_lista2 = str_replace("{BOTON_VER_FICHA_B_final}","</a>", $row_lista2);									}
				
				$row_largo="";
				$row_lista3="";
				$cuenta_largo="";
				$Largo=PotencialSucesion_Vista_Colaboradores_Posicion($id_comite, 		$unico->rut, $id_empresa, "Largo", $unico->cargo_col);
				foreach ($Largo as $uni3){
							$cuenta_largo++;
							
			        if($uni3->estado=="No es sucesor"){continue;}
							
			        $row_lista3.= file_get_contents("views/potencial/" . $id_empresa . "_potencial_sucesion_row_colaboradores_comites_sucesion.html");
			        $row_lista3 = str_replace("{RUT}",           ($uni3->rut_col), $row_lista3);
			        $row_lista3 = str_replace("{COLABORADOR}",   	($uni3->nombre_completo), $row_lista3);
			        $row_lista3 = str_replace("{CARGO_COL}",   		($uni3->cargo_col), $row_lista3);			
			        $row_lista3 = str_replace("{TEMPORALIDAD}",           	"Largo  / 3 a 5 a&ntilde;os", $row_lista3);
			        $row_lista3 = str_replace("{AVATAR_RUT_SUCESORES}",   				VerificaFotoPersonal($uni3->rut_col), $row_lista3);
			        
							$Usua3=DatosUsuario_($uni3->rut_col, $id_empresa);
			        $row_lista3 = str_replace("{COLABORADOR_SUCESORES}",     ($Usua3[0]->nombre_completo), $row_lista3);
			        $row_lista3 = str_replace("{CARGO_SUCESORES}",           ($Usua3[0]->cargo), $row_lista3);
			        
				      $cuadrante3=Potencial_Mi_Cuadrante_Actual($uni3->rut_col);
				      //echo "<br>cuadrante3<br>";print_r($cuadrante3);
			        $genero3=Potencial_Genero($uni3->rut_col);
			        //echo "<br>cuadrante3 $cuadrante3, genero3 $genero3";		
			        
			        if($cuadrante3=="2" or $cuadrante3=="3" or $cuadrante3=="6")	{$sucesores_cuadrantes_2_3_6++;}
			        if($cuadrante3=="1" or $cuadrante3=="9" or $cuadrante3=="4" or $cuadrante3=="8" or $cuadrante3=="7")	{$sucesores_cuadrantes_1_9_4_8_7++;}
			        if($genero3=="Femenino")																			{$cuenta_femenino++;}        
			        $cuenta_total++;
			        		
			        $row_lista3 = str_replace("{BOTON_VER_FICHA}","<a href='?sw=potencial_ficha&rut_col=".Encodear3($uni3->rut)."&id_comite=".Encodear3($id_comite)."' class='btn btn-link'>
			        <span class='azul_comite'><i class='fas fa-user'></i> <span class='mt-comment-authorSM'> Ficha</span></span></a>", $row_lista3);
						  $row_lista3 = str_replace("{BOTON_VER_FICHA_A_inicial}","<a href='?sw=potencial_ficha&rut_col=".Encodear3($uni3->rut_col)."&id_comite=".Encodear3($id_comite)."'
						   class='btn btn-link' style='padding-left: 0px;    padding-left: 0px;text-align: left;padding: 0px;'>", $row_lista3);
						  $row_lista3 = str_replace("{BOTON_VER_FICHA_B_final}","</a>", $row_lista3);									
						  


						  
						}


					//echo "<br>Femenino $cuenta_femenino , sucesores_cuadrantes_2_3_6 $sucesores_cuadrantes_2_3_6, sucesores_cuadrantes_1_9_4_8_7 $sucesores_cuadrantes_1_9_4_8_7";
					//echo "<BR> <BR>cARGO $cuenta_inmediato, $cuenta_mediano, $cuenta_largo";
					$Porcentaje_Cargo	=	Potencial_CalculoPorcentaje($cuenta_inmediato,$cuenta_mediano,$cuenta_largo);
					$cuenta_porcentaje_cargo++;
					$suma_porcentaje_cargo		= $suma_porcentaje_cargo + $Porcentaje_Cargo	;
					//echo "<BR> <BR>PORCENTAJE  Porcentaje_Cargo $Porcentaje_Cargo";
					
        $row_lista = str_replace("{INMEDIATO}", ($row_lista1), $row_lista);
        $row_lista = str_replace("{MEDIANO}",   ($row_lista2), $row_lista);
        $row_lista = str_replace("{LARGO}",   	($row_lista3), $row_lista);

$cuenta_masculino=$cuenta_total-$cuenta_femenino;
//echo "<br> 236 $sucesores_cuadrantes_2_3_6 19478 $sucesores_cuadrantes_1_9_4_8_7 FEM $cuenta_femenino MASC $cuenta_masculino";

$porc_2_3_6=round(100*$sucesores_cuadrantes_2_3_6/$cuenta_total);
$porc_1_9_4_8_6=round(100*$sucesores_cuadrantes_1_9_4_8_7/$cuenta_total);
$porc_fem=round(100*$cuenta_femenino/$cuenta_total);
$porc_mas=round(100*$cuenta_masculino/$cuenta_total);



        $row_lista = str_replace("{Porcentaje_Cargo}",  						"<small>Cargo: </small><div class='badge badge-info'>			<span style='color:#fff'>".($Porcentaje_Cargo)."%</span></div>", $row_lista);
        $row_lista = str_replace("{Sucesores_Cuadrantes_236}",  		"<small>Sucesores en Cuadrantes 2-3-6: </small><div class='badge badge-info'>			<span style='color:#fff'>".$porc_2_3_6."%</span></div>", $row_lista);
        $row_lista = str_replace("{Sucesores_Cuadrantes_19487}",  	"<small>Sucesores en Cuadrantes 1-9-4-8-7: </small><div class='badge badge-info'>			<span style='color:#fff'>".$porc_1_9_4_8_6."%</span></div>", $row_lista);
        $row_lista = str_replace("{Sucesores_Mujeres}",  						"<small>Sucesores Mujeres: </small><div class='badge badge-info'>			<span style='color:#fff'>".($porc_fem)."%</span></div>", $row_lista);
        $row_lista = str_replace("{Sucesores_Hombre}",  						"<small>Sucesores Hombres: </small><div class='badge badge-info'>			<span style='color:#fff'>".($porc_mas)."%</span></div>", $row_lista);
   
				//if($cuenta_mediano>0){ $titulo_inmediato="<div class='txt_title_pot'>Inmediato</div>"; } else { $titulo_inmediato=""; }
				//if($cuenta_mediano>0){ $titulo_mediano="<div class='txt_title_pot'>Mediano</div>"; } else { $titulo_mediano=""; }
				//if($cuenta_mediano>0){ $titulo_largo="<div class='txt_title_pot'>Largo</div>"; } else { $titulo_largo=""; }


        $row_lista = str_replace("{LARGO}",   	($row_lista3), $row_lista);



        $row_lista = str_replace("{TITULO_INMEDIATO}", 	$titulo_inmediato, $row_lista);
        $row_lista = str_replace("{TITULO_MEDIANO}",   	$titulo_mediano, $row_lista);
        $row_lista = str_replace("{TITULO_LARGO}",   		$titulo_largo, $row_lista);

				
        $row_lista = str_replace("{COLABORADOR}",   	($unico->nombre_completo), $row_lista);
        $row_lista = str_replace("{CARGO_COL}",   		($unico->cargo_col), $row_lista);
        $row_lista = str_replace("{NOMBRE_LIDER}",  	($unico->nombre_lider), $row_lista);
        $row_lista = str_replace("{AVATAR}",   				VerificaFotoPersonal($unico->rut), $row_lista);
        $row_lista = str_replace("{BOTON_MODAL}",  	($modal_row_rutc_col), $row_lista);

        $row_lista = str_replace("{BOTON_VER_FICHA}",							"<a href='?sw=potencial_ficha_sucesion&id_posicion_enc=".Encodear3($unico->cargo_col)."&id_comite=".Encodear3($id_comite)."' class='btn btn-link' >
        <span class='azul_comite'><i class='fas fa-user'></i> <span class='mt-comment-authorSM'> Ficha</span></span></a>", $row_lista);

			  $row_lista = str_replace("{BOTON_VER_FICHA_A_inicial}",	"<a href='?sw=potencial_ficha_sucesion&id_posicion_enc=".Encodear3($unico->cargo_col)."&id_comite=".Encodear3($id_comite)."'
			   class='btn btn-link' style='padding-left: 0px;    padding-left: 0px;text-align: left;padding-right: 0px;'>", $row_lista);

			  $row_lista = str_replace("{BOTON_VER_FICHA_B_final}","</a>", $row_lista);
        
        
        	$SUMA_sucesores_cuadrantes_2_3_6=	$sucesores_cuadrantes_2_3_6 + $SUMA_sucesores_cuadrantes_2_3_6;
        	$SUMA_sucesores_cuadrantes_1_9_4_8_7=	$sucesores_cuadrantes_1_9_4_8_7 + $SUMA_sucesores_cuadrantes_1_9_4_8_7;
        	$SUMA_cuenta_femenino		=	$cuenta_femenino + $SUMA_cuenta_femenino;
        	$SUMA_cuenta_masculino	=	$cuenta_masculino + $SUMA_cuenta_masculino;
        	$SUMA_cuenta_total			=	$cuenta_total + $SUMA_cuenta_total;

        
		}
		

    
    $PRINCIPAL = str_replace("{MIS_COLABORADORES_COMITES_POTENCIAL}",         $row_lista,         $PRINCIPAL);
    $PRINCIPAL = str_replace("{COLABORADORES_COMITE_POTENCIAL_TITULO}",  $potencial_titulo,  $PRINCIPAL);
    $PRINCIPAL = str_replace("{PORCENTAJE_AREA_PONDERADO}", "Área Total: <div class='badge badge-info'>			<span style='color:#fff'>".round($suma_porcentaje_cargo/$cuenta_porcentaje_cargo)."%</span></div>",  $PRINCIPAL);


$porc_total_2_3_6=round(100*$SUMA_sucesores_cuadrantes_2_3_6/$SUMA_cuenta_total);
$porc_total_1_9_4_8_6=round(100*$SUMA_sucesores_cuadrantes_1_9_4_8_7/$SUMA_cuenta_total);
$porc_total_fem=round(100*$SUMA_cuenta_femenino/$SUMA_cuenta_total);
$porc_total_mas=round(100*$SUMA_cuenta_masculino/$SUMA_cuenta_total);


    $PRINCIPAL = str_replace("{MASCULINO_PONDERADO}", "Sucesores Hombres: <div class='badge badge-info'>			<span style='color:#fff'>".($porc_total_mas)."%</span></div>",  $PRINCIPAL);
    $PRINCIPAL = str_replace("{FEMENINO_PONDERADO}", 	"Sucesores Mujeres: <div class='badge badge-info'>			<span style='color:#fff'>".($porc_total_fem)."%</span></div>",  $PRINCIPAL);

    $PRINCIPAL = str_replace("{CUADRANTE_236}", 			"Sucesores en Cuadrantes 2-3-6: <div class='badge badge-info'>			<span style='color:#fff'>".($porc_total_2_3_6)."%</span></div>",  $PRINCIPAL);
    $PRINCIPAL = str_replace("{CUADRANTE_19487}", 		"Sucesores en Cuadrantes 1-9-4-8-7: <div class='badge badge-info'>			<span style='color:#fff'>".($porc_total_1_9_4_8_6)."%</span></div>",  $PRINCIPAL);



    return ($PRINCIPAL);
}
function Potencial_Sucesion_Colaboradores_Comites_Ficha($PRINCIPAL, $id_comite, $rut, $perfil, $posicion, $id_empresa)
{
							$MiRx=MiRx($_SESSION["user_"]);
							//echo "potencial_ficha_sucesion mi Rx $MiRx";
						
						  if($perfil=="LIDER"){
						  	$display_acciones_desarrollo = " display:none; ";
						  } else {
						  	$display_acciones_desarrollo = "  ";
						  }
							
							
							$array_comite=Potencial_Comites_Suc_data($id_comite,$id_empresa);
							//print_r($array_comite);
							
							$comite_cerrado_esta=$array_comite[0]->comite_cerrado;
							
							
							//todo0s agregan acciones desarrollo
							$display_acciones_desarrollo = "  ";
//Rx $MiRx";
						
						  if($perfil=="LIDER"){
						  	$display_acciones_desarrollo = " display:none; ";
						  } else {
						  	$display_acciones_desarrollo = "  ";
						  }
							
							
							$array_comite=Potencial_Comites_Suc_data($id_comite,$id_empresa);
							//print_r($array_comite);
							
							$comite_cerrado_esta=$array_comite[0]->comite_cerrado;
							
							
							//todo0s agregan acciones desarrollo
							$display_acciones_desarrollo = "  ";
			$row_inmediato="";
				$row_lista1="";
				$Inmediato=PotencialSucesion_Vista_Colaboradores_Posicion($id_comite, $unico->rut, $id_empresa, "Inmediato", $posicion);
				//print_r($Inmediato);
				foreach ($Inmediato as $uni1){



							if($comite_cerrado_esta=="SI" and $uni1->estado=="No es sucesor"){
								continue;
							}

			        $row_lista1.= file_get_contents("views/potencial/" . $id_empresa . "_potencial_sucesion_row_colaboradores_comites_sucesion_avatar.html");
			        $row_lista1 = str_replace("{AVATAR_RUT_SUCESORES}",   				VerificaFotoPersonal($uni1->rut_col), $row_lista1);
							$RxCol=MiRx($uni1->rut_col);
							$visualiza1=CheckVisualizaMiRxRxCol($MiRx, $RxCol);
							
							//echo "<br>->".$uni1->rut_col." R ".$RxCol." - Visualiza ".$visualiza;
							$Usua1=DatosUsuario_($uni1->rut_col, $id_empresa);
							$es_posicion_clave=Pot_CheckPosicion_Clave($uni1->rut_col);
											if($es_posicion_clave>0){
													$posicion_clave	=" 
																
																	<div class='badge badge-gray' style='    background-color: transparent !important;padding-left: 0px!important;'>
																		<center>
																			<strong>Posici&oacute;n Clave</strong>
																		</center>
																	</div><br>
															";
													} else {
													$posicion_clave="";	
													}
							$row_lista1 = str_replace("{POSICION_CLAVE}", 			$posicion_clave, $row_lista1);

							
							//$Cuad_2020=Potencial_Check_Mapeado_oAnterior($uni1->rut_col);
							$Cuad_2020=Potencial_Mi_Cuadrante_Actual($uni1->rut_col);
							
							$Num_Sucesion=Potencial_Sucesion_Num_Sucesores($uni1->rut_col);
							if($Cuad_2020<>""){
								if($Cuad_2020=="10"){$Cuad_2020="5+";}
								$cuadrante_2020="Cuadrante Actual: $Cuad_2020";
							} else {
								$cuadrante_2020="Sin cuadrante actual";
							}
							if($Num_Sucesion>0){
								$num_sucesion_2020="Veces como sucesor: $Num_Sucesion";
							} else {
								$num_sucesion_2020="1 vez como sucesor";
							}							
							
							
							
							
							$Usua=DatosUsuario_($uni1->rut_col, $id_empresa);
							if($Usua[0]->gerencia=="GERENCIA CORPORATIVA GESTION PERSONAS"){
								$cuadrante_2020="";
							}
							
							
							if($visualiza1=="NO"){$num_sucesion_2020="";}
							if($visualiza1=="NO"){$cuadrante_2020="";}
							
														
			        $row_lista1 = str_replace("{CARGO_CUDRANTE_SUCESORES}",   $cuadrante_2020, $row_lista1);
			        $row_lista1 = str_replace("{CARGO_VECES_SUCESOR}",     		$num_sucesion_2020, $row_lista1);
							$estado_badge_avatar="";
							if($uni1->estado=="No es sucesor"){
								if($uni1->rutlider==""){
									$estado_badge_avatar="<span class='badge badge-danger' style='color:#fff'>No es Sucesor</span>";
								} else {
								$estado_badge_avatar="<span class='badge badge-danger' style='color:#fff'>No es Sucesor</span> <span style='font-size: 12px;display:none;'>Sugerido por L&iacute;der</span>";	
								}
							}
							
				
							
							if($uni1->estado=="Es Sucesor"){
								if($uni1->rutlider==""){
									$estado_badge_avatar="<span class='badge badge-info' style='color:#fff'>Es Sucesor</span> - <span style='font-size: 12px;'>Propuesta de Sucesi&oacute;n</span>";
								} else {
								$estado_badge_avatar="<span class='badge badge-info' style='color:#fff'>Es Sucesor</span> <span style='font-size: 12px;display:none;'>Sugerido por L&iacute;der</span>";	
								}
							}		
							
					if($comite_cerrado_esta=="SI" and $uni1->estado=="Es Sucesor"){
						$estado_badge_avatar="";
					}
												
							
			        $row_lista1 = str_replace("{NO_ES_SUCESOR_ESTADO_BADGE}",     		$estado_badge_avatar, $row_lista1);

							
			        $row_lista1 = str_replace("{COLABORADOR_SUCESORES}",     ($Usua1[0]->nombre_completo), $row_lista1);
			        $posicion1=Potencial_Sucesion_d145_databci($uni1->rut_col);

			        $row_lista1 = str_replace("{CARGO_SUCESORES}",           ($posicion1), $row_lista1);
			        $row_lista1 = str_replace("{RUT_SUCESORES}",           	 ($uni1->rut_col), $row_lista1);
			        $row_lista1 = str_replace("{RUT_SUCESORES_ENC}",         Encodear3($uni1->rut_col), $row_lista1);
			        $row_lista1 = str_replace("{ID_SUCESORES}",           	 Encodear3($uni1->id), $row_lista1);
			        $row_lista1 = str_replace("{ID_POSICION_ENC}",           Encodear3($posicion), $row_lista1);
			        $row_lista1 = str_replace("{ID_COMITE_ENC}",           	 Encodear3($id_comite), $row_lista1);
			        $row_lista1 = str_replace("{ID_COL}",           				 Encodear3($uni1->id), $row_lista1);
			        $row_lista1 = str_replace("{PERFIL_ENC}",           		Encodear3($perfil), $row_lista1);



			        $row_lista1 = str_replace("{ACTUAL_TEMPORALIDAD}",      "Inmediato", $row_lista1);
							
							$sucesion_display_none="";
							if($visualiza1=="NO"){$sucesion_display_none=" display:none; ";}
			        $row_lista1 = str_replace("{sucesion_display_none}",      $sucesion_display_none, $row_lista1);
			        
			        $row_lista1 = str_replace("{RUT}",           ($uni1->rut), $row_lista1);
			        $row_lista1 = str_replace("{COLABORADOR}",   	($uni1->nombre_completo), $row_lista1);
			        $row_lista1 = str_replace("{CARGO_COL}",   		($uni1->cargo_col), $row_lista1);		
			        
			        
			  if($visualiza1=="NO"){
			        $row_lista1 = str_replace("{BOTON_VER_FICHA}","", $row_lista1);
						  $row_lista1 = str_replace("{BOTON_VER_FICHA_A_inicial}","", $row_lista1);
						  $row_lista1 = str_replace("{BOTON_VER_FICHA_B_final}","", $row_lista1);			
			  } else {
			        $row_lista1 = str_replace("{BOTON_VER_FICHA}","<a href='?sw=potencial_fichaxxx&rut_col=".Encodear3($uni1->rut_col)."&id_comite=".Encodear3($id_comite)."&sucesion=1&sucesion=1&sucesion=1&id_posicion_enc=".Encodear3($posicion)."' class='btn btn-link' >
			        <span class='azul_comite'><i class='fas fa-user'></i> <span class='mt-comment-authorSM'> Ficha</span></span></a>", $row_lista1);
						  $row_lista1 = str_replace("{BOTON_VER_FICHA_A_inicial}","<a href='?sw=potencial_ficha&rut_col=".Encodear3($uni1->rut_col)."&id_comite=".Encodear3($id_comite)."&sucesion=1&sucesion=1&id_posicion_enc=".Encodear3($posicion)."'
						   class='btn btn-link' style='padding-left: 0px;    padding-left: 0px;text-align: left;padding-right: 0px;'>", $row_lista1);
						  $row_lista1 = str_replace("{BOTON_VER_FICHA_B_final}","</a>", $row_lista1);			
			  }
			        			
	
						
						  $row_lista1 = str_replace("{STYLO_AGREGAR_ACCIONES_DESARROLLO}", $display_acciones_desarrollo, $row_lista1);		
						  
						  $row_lista1_acciones="";
						  $Potencial_Acciones_Desarrollo	=	Potencial_Busca_Acciones_Desarrollo($uni1->rut_col);
						  if(count($Potencial_Acciones_Desarrollo)>0){
						  	foreach ($Potencial_Acciones_Desarrollo as $un1){
						  		$row_lista1_acciones.=" 
						  		
						  		<i class='far fa-file-alt'></i> 
						  				".$un1->plan."
						  				<span class='pull-right'><a href='?sw=potencial_ficha_sucesion&id_posicion_enc=".Encodear3($posicion)."&id_comite=".Encodear3($id_comite)."&perfil=".Encodear3($perfil)."&delad=".Encodear3($un1->id)."'><i class='far fa-trash-alt' style='color: #337ab7;'></i></a></span>
						  		<br>
						  		<i class='fas fa-chevron-right' style='padding-left: 20px;'></i> 
						  				".$un1->fundamento."
						  	<br>";
						  	}
						  		$row_lista1 = str_replace("{ACCIONES_DE_DESARROLLO_TITULO1}", "<div class='txt_2020' data-toggle='collapse' href='#collapseExample2_".$uni1->rut_col."' role='button' aria-expanded='false' aria-controls='collapseExample2'>Acciones de Desarrollo</div>", $row_lista1);		
						  		$row_lista1 = str_replace("{ACCIONES_DE_DESARROLLO}", $row_lista1_acciones, $row_lista1);		
						  } else {
						  		$row_lista1 = str_replace("{ACCIONES_DE_DESARROLLO}", "", $row_lista1);		
						  		$row_lista1 = str_replace("{ACCIONES_DE_DESARROLLO_TITULO1}", "", $row_lista1);		
						  	
						  }


						  $Potencial_Bitacora_Desarrollo	=	Potencial_Busca_Bitacora_Desarrollo($uni1->rut_col);
						  $row_lista1_bitacora="";
						  if(count($Potencial_Bitacora_Desarrollo)>0){
						  	foreach ($Potencial_Bitacora_Desarrollo as $un1){
						  		$row_lista1_bitacora.=" 
						  		
						  		".$un1->comite." - Sucesi&oacute;n - ".$un1->fecha." 
						  				 <br> ".$un1->nombre_completo." <br>  ".$un1->accion." ".$un1->comentario."
						  				<!--<span class='pull-right'><a href='?sw=potencial_ficha_sucesion&id_posicion_enc=".Encodear3($posicion)."&id_comite=".Encodear3($id_comite)."&perfil=".Encodear3($perfil)."&delad=".Encodear3($un1->id)."'><i class='far fa-trash-alt' style='color: #337ab7;'></i></a></span>-->
						  	<br><br>";
						  	}
						  		$row_lista1 = str_replace("{BITACORA_DE_DESARROLLO_TITULO1}", "<div class='txt_2020' data-toggle='collapse' href='#collapseExample1_".$uni1->rut_col."' role='button' aria-expanded='false' aria-controls='collapseExample'>Bit&aacute;cora de Sucesi&oacute;n</div>", $row_lista1);		
						  		$row_lista1 = str_replace("{BITACORA_DE_DESARROLLO}", $row_lista1_bitacora, $row_lista1);		
						  } else {
						  		$row_lista1 = str_replace("{BITACORA_DE_DESARROLLO_TITULO1}", "", $row_lista1);		
						  		$row_lista1 = str_replace("{BITACORA_DE_DESARROLLO}", "", $row_lista1);		
						  	
						  }
						  		
				}
				
				$row_mediano="";
				$row_lista2="";
				$Mediano=PotencialSucesion_Vista_Colaboradores_Posicion($id_comite, $unico->rut, $id_empresa, "Mediano", $posicion);
				//echo "mediano";
				//print_r($Mediano);
				foreach ($Mediano as $uni2){

							if($comite_cerrado_esta=="SI" and $uni2->estado=="No es sucesor"){
								continue;
							}
					
			        $row_lista2.= file_get_contents("views/potencial/" . $id_empresa . "_potencial_sucesion_row_colaboradores_comites_sucesion_avatar.html");
			        $row_lista2 = str_replace("{RUT}",           ($uni2->rut), $row_lista2);
			        
							$RxCol=MiRx($uni2->rut_col);
							$visualiza2=CheckVisualizaMiRxRxCol($MiRx,	$RxCol);			
							        
			        $row_lista2 = str_replace("{COLABORADOR}",   	($uni2->nombre_completo), $row_lista2);
			        $row_lista2 = str_replace("{CARGO_COL}",   		($uni2->cargo_col), $row_lista2);				

			        $row_lista2 = str_replace("{AVATAR_RUT_SUCESORES}",   				VerificaFotoPersonal($uni2->rut_col), $row_lista2);
			        $row_lista2 = str_replace("{RUT_SUCESORES}",           ($uni2->rut_col), $row_lista2);
			        $row_lista2 = str_replace("{RUT_SUCESORES_ENC}",           Encodear3($uni2->rut_col), $row_lista2);
			        
			        $row_lista2 = str_replace("{ID_POSICION_ENC}",           	Encodear3($posicion), $row_lista2);
			        $row_lista2 = str_replace("{ID_COMITE_ENC}",           		Encodear3($id_comite), $row_lista2);
			        $row_lista2 = str_replace("{ID_COL}",           					Encodear3($uni2->id), $row_lista2);
			        $row_lista2 = str_replace("{PERFIL_ENC}",           		Encodear3($perfil), $row_lista2);
							$Usua2=DatosUsuario_($uni2->rut_col, $id_empresa);
							
							$es_posicion_clave=Pot_CheckPosicion_Clave($uni2->rut_col);
											if($es_posicion_clave>0){
													$posicion_clave	=" 
																
																	<div class='badge badge-gray'  style='    background-color: transparent !important;padding-left: 0px!important;'>
																		
																			<strong>Posici&oacute;n Clave</strong>
																	
																	</div><br>
															";
													} else {
													$posicion_clave="";	
													}
							$row_lista2 = str_replace("{POSICION_CLAVE}", 			$posicion_clave, $row_lista2);							
							
			        $row_lista2 = str_replace("{COLABORADOR_SUCESORES}",     ($Usua2[0]->nombre_completo), $row_lista2);
 							$posicion2=Potencial_Sucesion_d145_databci($uni2->rut_col);

			        $row_lista2 = str_replace("{CARGO_SUCESORES}",           ($posicion2), $row_lista2);
			        $row_lista2 = str_replace("{ID_SUCESORES}",           		Encodear3($uni2->id), $row_lista2);
						  $row_lista2 = str_replace("{STYLO_AGREGAR_ACCIONES_DESARROLLO}", $display_acciones_desarrollo, $row_lista2);				

			        $row_lista2 = str_replace("{ACTUAL_TEMPORALIDAD}",      "Mediano", $row_lista2);

							$sucesion_display_none="";
							if($visualiza2=="NO"){$sucesion_display_none=" display:none; ";}
			        $row_lista2 = str_replace("{sucesion_display_none}",      $sucesion_display_none, $row_lista2);
							//$Cuad_2020=Potencial_Check_Mapeado_oAnterior($uni2->rut_col);
							$Cuad_2020=Potencial_Mi_Cuadrante_Actual($uni2->rut_col);							
							$Num_Sucesion=Potencial_Sucesion_Num_Sucesores($uni2->rut_col);
							if($Cuad_2020<>""){
								if($Cuad_2020=="10"){$Cuad_2020="5+";}
								$cuadrante_2020="Cuadrante Actual: $Cuad_2020";
							} else {
								$cuadrante_2020="Sin cuadrante actual";
							}
							if($Num_Sucesion>0){
								$num_sucesion_2020="Veces como sucesor: $Num_Sucesion";
							} else {
								$num_sucesion_2020="1 vez como sucesor";
							}				
							
							$Usua=DatosUsuario_($uni2->rut_col, $id_empresa);
							if($Usua[0]->gerencia=="GERENCIA CORPORATIVA GESTION PERSONAS"){
								$cuadrante_2020="";
							}		
							
							if($visualiza2=="NO"){$num_sucesion_2020="";}
							if($visualiza2=="NO"){$cuadrante_2020="";}					
										
							$estado_badge_avatar2="";
			        $row_lista2 = str_replace("{CARGO_CUDRANTE_SUCESORES}",   $cuadrante_2020, $row_lista2);
			        $row_lista2 = str_replace("{CARGO_VECES_SUCESOR}",     		$num_sucesion_2020, $row_lista2);
							if($uni2->estado=="No es sucesor"){
								if($uni2->rutlider==""){
									$estado_badge_avatar2="<span class='badge badge-danger' style='color:#fff'>No es Sucesor</span>";
								} else {
								$estado_badge_avatar2="<span class='badge badge-danger' style='color:#fff'>No es Sucesor</span> <span style='font-size: 12px;display:none;'>Sugerido por L&iacute;der</span>";	
								}
							}
							if($uni2->estado=="Es Sucesor"){
								if($uni2->rutlider==""){
									$estado_badge_avatar2="<span class='badge badge-info' style='color:#fff'>Es Sucesor</span> - <span style='font-size: 12px;'>Propuesta de Sucesi&oacute;n</span>";
								} else {
								$estado_badge_avatar2="<span class='badge badge-info' style='color:#fff'>Es Sucesor</span>  <span style='font-size: 12px; display:none;'>Sugerido por L&iacute;der</span>";	
								}
							}								

					if($comite_cerrado_esta=="SI" and $uni3->estado=="Es Sucesor"){
						$estado_badge_avatar2="";
					}							
			        $row_lista2 = str_replace("{NO_ES_SUCESOR_ESTADO_BADGE}",     		$estado_badge_avatar2, $row_lista2);


			  if($visualiza2=="NO"){
			        $row_lista2 = str_replace("{BOTON_VER_FICHA}","", $row_lista2);
						  $row_lista2 = str_replace("{BOTON_VER_FICHA_A_inicial}","", $row_lista2);
						  $row_lista2 = str_replace("{BOTON_VER_FICHA_B_final}","", $row_lista2);			
			  } else {
			        $row_lista2 = str_replace("{BOTON_VER_FICHA}","<a href='?sw=potencial_ficha&rut_col=".Encodear3($uni2->rut_col)."&id_comite=".Encodear3($id_comite)."&sucesion=1&sucesion=1&id_posicion_enc=".Encodear3($posicion)."' class='btn btn-link' >			        <span class='azul_comite'><i class='fas fa-user'></i> <span class='mt-comment-authorSM'> Ficha</span></span></a>", $row_lista2);
						  $row_lista2 = str_replace("{BOTON_VER_FICHA_A_inicial}","<a href='?sw=potencial_ficha&rut_col=".Encodear3($uni2->rut_col)."&id_comite=".Encodear3($id_comite)."&sucesion=1&sucesion=1&id_posicion_enc=".Encodear3($posicion)."'
						   class='btn btn-link' style='padding-left: 0px;    padding-left: 0px;text-align: left;padding-right: 0px;'>", $row_lista2);
						  $row_lista2 = str_replace("{BOTON_VER_FICHA_B_final}","</a>", $row_lista2);			
						  }
					

			        	
						
							$row_lista2_acciones="";
									  $Potencial_Acciones_Desarrollo	=	Potencial_Busca_Acciones_Desarrollo($uni2->rut_col);
									  if(count($Potencial_Acciones_Desarrollo)>0){
									  	foreach ($Potencial_Acciones_Desarrollo as $un2){
									  		$row_lista2_acciones.=" <i class='far fa-file-alt'></i> ".$un2->plan."
									  		<span class='pull-right'><a href='?sw=potencial_ficha_sucesion&id_posicion_enc=".Encodear3($posicion)."&id_comite=".Encodear3($id_comite)."&perfil=".Encodear3($perfil)."&delad=".Encodear3($un2->id)."'><i class='far fa-trash-alt' style='color: #337ab7;'></i></a></span>
									  		<br>
									  		<i class='fas fa-chevron-right' style='padding-left: 20px;'></i> ".$un2->fundamento."<br>";
									  	}
									  	$row_lista2 = str_replace("{ACCIONES_DE_DESARROLLO_TITULO1}", "<div class='txt_2020' data-toggle='collapse' href='#collapseExample2_".$uni2->rut_col."' role='button' aria-expanded='false' aria-controls='collapseExample'>Acciones de Desarrollo</div>", $row_lista2);		
									  	$row_lista2 = str_replace("{ACCIONES_DE_DESARROLLO}", $row_lista2_acciones, $row_lista2);		
									  } else {
									  	$row_lista2 = str_replace("{ACCIONES_DE_DESARROLLO}", "", $row_lista2);		
									  	$row_lista2 = str_replace("{ACCIONES_DE_DESARROLLO_TITULO1}", "", $row_lista2);		
									  	
									  }

					  $Potencial_Bitacora_Desarrollo	=	Potencial_Busca_Bitacora_Desarrollo($uni2->rut_col);
						  if(count($Potencial_Bitacora_Desarrollo)>0){
						  	$row_lista1_bitacora="";
						  	foreach ($Potencial_Bitacora_Desarrollo as $un1){
						 						  		$row_lista1_bitacora.=" 
						  		
						  		".$un1->comite." - Sucesi&oacute;n - ".$un1->fecha." 
						  				 <br> ".$un1->nombre_completo." <br>  ".$un1->accion." ".$un1->comentario."
						  				<!--<span class='pull-right'><a href='?sw=potencial_ficha_sucesion&id_posicion_enc=".Encodear3($posicion)."&id_comite=".Encodear3($id_comite)."&perfil=".Encodear3($perfil)."&delad=".Encodear3($un1->id)."'><i class='far fa-trash-alt' style='color: #337ab7;'></i></a></span>-->
						  	<br><br>";
						  	}
						  		$row_lista2 = str_replace("{BITACORA_DE_DESARROLLO_TITULO1}", "<div class='txt_2020' data-toggle='collapse' href='#collapseExample1_".$uni2->rut_col."' role='button' aria-expanded='false' aria-controls='collapseExample'>Bit&aacute;cora de Sucesi&oacute;n</div>", $row_lista2);		
						  		$row_lista2 = str_replace("{BITACORA_DE_DESARROLLO}", $row_lista1_bitacora, $row_lista2);		
						  } else {
						  		$row_lista2 = str_replace("{BITACORA_DE_DESARROLLO_TITULO1}", "", $row_lista2);		
						  		$row_lista2 = str_replace("{BITACORA_DE_DESARROLLO}", "", $row_lista2);		
						  	
						  }
									  
						  
					}
				
				$row_largo="";
				$row_lista3="";
				$Largo=PotencialSucesion_Vista_Colaboradores_Posicion($id_comite, $unico->rut, $id_empresa, "Largo", $posicion);
				foreach ($Largo as $uni3){
					
							if($comite_cerrado_esta=="SI" and $uni3->estado=="No es sucesor"){
								continue;
							}
					
			        $row_lista3.= file_get_contents("views/potencial/" . $id_empresa . "_potencial_sucesion_row_colaboradores_comites_sucesion_avatar.html");
			        $row_lista3 = str_replace("{RUT}",           ($uni3->rut_col), $row_lista3);
			        
			        $RxCol=MiRx($uni3->rut_col);
							$visualiza3=CheckVisualizaMiRxRxCol($MiRx,	$RxCol);			
			        
			        $row_lista3 = str_replace("{COLABORADOR}",   	($uni3->nombre_completo), $row_lista3);
			        $row_lista3 = str_replace("{CARGO_COL}",   		($uni3->cargo_col), $row_lista3);			
			        $row_lista3 = str_replace("{RUT_SUCESORES_ENC}",           Encodear3($uni3->rut_col), $row_lista3);
			        $row_lista3 = str_replace("{ID_POSICION_ENC}",           	Encodear3($posicion), $row_lista3);
			        $row_lista3 = str_replace("{ID_COMITE_ENC}",           		Encodear3($id_comite), $row_lista3);
			        $row_lista3 = str_replace("{ID_COL}",           					Encodear3($uni3->id), $row_lista3);
			        $row_lista3 = str_replace("{AVATAR_RUT_SUCESORES}",   				VerificaFotoPersonal($uni3->rut_col), $row_lista3);
							$row_lista3 = str_replace("{PERFIL_ENC}",           		Encodear3($perfil), $row_lista3);
			        $row_lista3 = str_replace("{ACTUAL_TEMPORALIDAD}",      "Largo", $row_lista3);

										$sucesion_display_none="";
							if($visualiza3=="NO"){$sucesion_display_none=" display:none; ";}
			        $row_lista3 = str_replace("{sucesion_display_none}",      $sucesion_display_none, $row_lista3);        
							$Usua3=DatosUsuario_($uni3->rut_col, $id_empresa);
							
							$es_posicion_clave=Pot_CheckPosicion_Clave($uni3->rut_col);
											if($es_posicion_clave>0){
													$posicion_clave	=" 
																
																	<div class='badge badge-gray'  style='    background-color: transparent !important;padding-left: 0px!important;'>
																		
																			<strong>Posici&oacute;n Clave</strong>
																		
																	</div><br>
															";
													} else {
													$posicion_clave="";	
													}
							$row_lista3 = str_replace("{POSICION_CLAVE}", 			$posicion_clave, $row_lista3);									
							
			        $row_lista3 = str_replace("{COLABORADOR_SUCESORES}",     ($Usua3[0]->nombre_completo), $row_lista3);
			         							$posicion3=Potencial_Sucesion_d145_databci($uni3->rut_col);

			        $row_lista3 = str_replace("{CARGO_SUCESORES}",           ($posicion3), $row_lista3);
			        $row_lista3 = str_replace("{RUT_SUCESORES}",           		($uni3->rut_col), $row_lista3);
						  $row_lista3 = str_replace("{STYLO_AGREGAR_ACCIONES_DESARROLLO}", $display_acciones_desarrollo, $row_lista3);				

			        $row_lista3 = str_replace("{ID_SUCESORES}",           		Encodear3($uni3->id), $row_lista3);

							//$Cuad_2020=Potencial_Check_Mapeado_oAnterior($uni3->rut_col);
							$Cuad_2020=Potencial_Mi_Cuadrante_Actual($uni3->rut_col);							
							
							$Num_Sucesion=Potencial_Sucesion_Num_Sucesores($uni3->rut_col
							);
							if($Cuad_2020<>""){
								if($Cuad_2020=="10"){$Cuad_2020="5+";}
								$cuadrante_2020="Cuadrante Actual: $Cuad_2020";
							} else {
								$cuadrante_2020="Sin cuadrante actual";
							}
							if($Num_Sucesion>0){
								$num_sucesion_2020="Veces como sucesor: $Num_Sucesion";
							} else {
								$num_sucesion_2020="1 vez como sucesor";
							}							


							$Usua=DatosUsuario_($uni3->rut_col, $id_empresa);
							if($Usua[0]->gerencia=="GERENCIA CORPORATIVA GESTION PERSONAS"){
								$cuadrante_2020="";
							}		

							if($visualiza3=="NO"){$num_sucesion_2020="";}
							if($visualiza3=="NO"){$cuadrante_2020="";}					
							
			        $row_lista3 = str_replace("{CARGO_CUDRANTE_SUCESORES}",   $cuadrante_2020, $row_lista3);
			        $row_lista3 = str_replace("{CARGO_VECES_SUCESOR}",     		$num_sucesion_2020, $row_lista3);        

							$estado_badge_avatar3="";
							if($uni3->estado=="No es sucesor"){
								if($uni3->rutlider==""){
									$estado_badge_avatar3="<span class='badge badge-danger' style='color:#fff'>No es Sucesor</span>";
								} else {
								$estado_badge_avatar3="<span class='badge badge-danger' style='color:#fff'>No es Sucesor</span>  <span style='font-size: 12px;display:none;'>Sugerido por L&iacute;der</span>";	
								}
							}
							
					if($uni3->estado=="Es Sucesor"){
								if($uni3->rutlider==""){
									$estado_badge_avatar3="<span class='badge badge-info' style='color:#fff'>Es Sucesor</span> - <span style='font-size: 12px;'>Propuesta de Sucesi&oacute;n</span>";
								} else {
								$estado_badge_avatar3="<span class='badge badge-info' style='color:#fff'>Es Sucesor</span>  <span style='font-size: 12px;display:none;'>Sugerido por L&iacute;der</span>";	
								}
							}	
							
					if($comite_cerrado_esta=="SI" and $uni3->estado=="Es Sucesor"){
						$estado_badge_avatar3="";
					}
							
			        $row_lista3 = str_replace("{NO_ES_SUCESOR_ESTADO_BADGE}",     		$estado_badge_avatar3, $row_lista3);
								        
			        		
			        $row_lista3 = str_replace("{BOTON_VER_FICHA}","<a href='?sw=potencial_ficha&rut_col=".Encodear3($uni3->rut_col)."&id_comite=".Encodear3($id_comite)."&sucesion=1&sucesion=1&id_posicion_enc=".Encodear3($posicion)."' class='btn btn-link' >
			        <span class='azul_comite'><i class='fas fa-user'></i> <span class='mt-comment-authorSM'> Ficha</span></span></a>", $row_lista3);
						  $row_lista3 = str_replace("{BOTON_VER_FICHA_A_inicial}","<a href='?sw=potencial_ficha&rut_col=".Encodear3($uni3->rut_col)."&id_comite=".Encodear3($id_comite)."&sucesion=1&sucesion=1&id_posicion_enc=".Encodear3($posicion)."'
						   class='btn btn-link' style='padding-left: 0px;    padding-left: 0px;text-align: left;padding-right: 0px;'>", $row_lista3);
						  $row_lista3 = str_replace("{BOTON_VER_FICHA_B_final}","</a>", $row_lista3);									
						  
						  
 if($visualiza3=="NO"){
			        $row_lista3 = str_replace("{BOTON_VER_FICHA}","<a href='?sw=potencial_ficha&rut_col=".Encodear3($uni3->rut_col)."&id_comite=".Encodear3($id_comite)."&sucesion=1&sucesion=1&id_posicion_enc=".Encodear3($posicion)."' class='btn btn-link' >
			        <span class='azul_comite'><i class='fas fa-user'></i> <span class='mt-comment-authorSM'> Ficha</span></span></a>", $row_lista3);
						  $row_lista3 = str_replace("{BOTON_VER_FICHA_A_inicial}","<a href='?sw=potencial_ficha&rut_col=".Encodear3($uni3->rut_col)."&id_comite=".Encodear3($id_comite)."&sucesion=1&sucesion=1&id_posicion_enc=".Encodear3($posicion)."'
						   class='btn btn-link' style='padding-left: 0px;    padding-left: 0px;text-align: left;padding-right: 0px;'>", $row_lista3);
						  $row_lista3 = str_replace("{BOTON_VER_FICHA_B_final}","</a>", $row_lista3);						
			  } else {
			        $row_lista3 = str_replace("{BOTON_VER_FICHA}","", $row_lista3);
						  $row_lista3 = str_replace("{BOTON_VER_FICHA_A_inicial}","", $row_lista3);
						  $row_lista3 = str_replace("{BOTON_VER_FICHA_B_final}","", $row_lista3);				
		 }						  
						  
						  
						  $row_lista3_acciones="";
									  $Potencial_Acciones_Desarrollo	=	Potencial_Busca_Acciones_Desarrollo($uni3->rut_col);
									  if(count($Potencial_Acciones_Desarrollo)>0){
									  	foreach ($Potencial_Acciones_Desarrollo as $un3){
									  		$row_lista3_acciones.=" <i class='far fa-file-alt'></i> ".$un3->plan."
									  		<span class='pull-right'><a href='?sw=potencial_ficha_sucesion&id_posicion_enc=".Encodear3($posicion)."&id_comite=".Encodear3($id_comite)."&perfil=".Encodear3($perfil)."&delad=".Encodear3($un3->id)."'><i class='far fa-trash-alt' style='color: #337ab7;'></i></a></span>
									  		<br>
									  		<i class='fas fa-chevron-right' style='padding-left: 20px;'></i> ".$un3->fundamento."<br>";
									  	}
									  	$row_lista3 = str_replace("{ACCIONES_DE_DESARROLLO_TITULO1}", "<div class='txt_2020' data-toggle='collapse' href='#collapseExample2_".$uni3->rut_col."' role='button' aria-expanded='false' aria-controls='collapseExample'>Acciones de Desarrollo</div>", $row_lista3);		
									  	$row_lista3 = str_replace("{ACCIONES_DE_DESARROLLO}", $row_lista3_acciones, $row_lista3);		
									  } else {
									  	$row_lista3 = str_replace("{ACCIONES_DE_DESARROLLO}", "", $row_lista3);		
									  	$row_lista3 = str_replace("{ACCIONES_DE_DESARROLLO_TITULO1}", "", $row_lista3);		
									  	
									  }
									  
									  
					  $Potencial_Bitacora_Desarrollo	=	Potencial_Busca_Bitacora_Desarrollo($uni3->rut_col);
						  if(count($Potencial_Bitacora_Desarrollo)>0){
						  	$row_lista1_bitacora="";
						  	foreach ($Potencial_Bitacora_Desarrollo as $un1){
						 						  		$row_lista1_bitacora.=" 
						  		
						  		".$un1->comite." - Sucesi&oacute;n - ".$un1->fecha." 
						  				 <br> ".$un1->nombre_completo." <br>  ".$un1->accion." ".$un1->comentario."
						  				<!--<span class='pull-right'><a href='?sw=potencial_ficha_sucesion&id_posicion_enc=".Encodear3($posicion)."&id_comite=".Encodear3($id_comite)."&perfil=".Encodear3($perfil)."&delad=".Encodear3($un1->id)."'><i class='far fa-trash-alt' style='color: #337ab7;'></i></a></span>-->
						  	<br><br>";
						  	}
						  		$row_lista3 = str_replace("{BITACORA_DE_DESARROLLO_TITULO1}", "<div class='txt_2020' data-toggle='collapse' href='#collapseExample1_".$uni3->rut_col."' role='button' aria-expanded='false' aria-controls='collapseExample'>Bit&aacute;cora de Sucesi&oacute;n</div>", $row_lista3);		
						  		$row_lista3 = str_replace("{BITACORA_DE_DESARROLLO}", $row_lista1_bitacora, $row_lista3);		
						  } else {
						  		$row_lista3 = str_replace("{BITACORA_DE_DESARROLLO_TITULO1}", "", $row_lista3);		
						  		$row_lista3 = str_replace("{BITACORA_DE_DESARROLLO}", "", $row_lista3);		
						  	
						  }									  
						  }







 
 
         $PRINCIPAL = str_replace("{INMEDIATO}", ($row_lista1), $PRINCIPAL);
        $PRINCIPAL = str_replace("{MEDIANO}",   ($row_lista2), $PRINCIPAL);
        $PRINCIPAL = str_replace("{LARGO}",   	($row_lista3), $PRINCIPAL);
    
    $PRINCIPAL = str_replace("{MIS_COLABORADORES_COMITES_POTENCIAL}",         $row_lista,         $PRINCIPAL);
    $PRINCIPAL = str_replace("{COLABORADORES_COMITE_POTENCIAL_TITULO}",  $potencial_titulo,  $PRINCIPAL);

    return ($PRINCIPAL);
}
function Potencial_Sucesion_Mis_Comites($PRINCIPAL, $rut, $perfil, $id_empresa)
{		
		$Usua=DatosUsuario_($rut, $id_empresa);
    $lista = Potencial_Mis_Comites_data($id_empresa, $rut, $perfil, $Usua[0]->jefe);
    //print_r($lista);
    
$nomuestracabeceras="";
if($perfil=="VISUALIZADOR"){
	$nomuestracabeceras="1";
}    
    
    if($nomuestracabeceras=="1"){
    	$lider="";
    	$colab="";
    	
    } else {
    	$lider1="LIDER";
    	$colab="COLAB.";
    }
    $num_comites    =   count($lista);
    //echo "<br>num_comites $num_comites<br>";
    if($num_comites>0){
        $potencial_titulo="
        <br>
<div class=''>
    <strong>
        <div class='col-sm-4 txt_title_pot'>COMITE</div>
        <div class='col-sm-2 txt_title_pot'>FECHA REALIZACION</div>
        <div class='col-sm-3 txt_title_pot'>".$lider1."</div>
        <div class='col-sm-1 txt_title_pot'>".$colab."</div>
        <div class='col-sm-2 txt_title_pot'>GESTIONAR</div>
    </strong>
</div>";
    }   else   {
        $potencial_titulo="
<div class='row'>
    <div class='col-sm-12 txt_title_pot'><br><br><center>[ No hay comit&eacute;s creados ]</center></div>
</div>";

    }

    foreach($lista as $unico) {
			$num_colaboradores=0;
    if($perfil=="LIDER")    {   $num_colaboradores=Potencial_Busca_Cantidad_Colaboradores_lider($rut, $unico->id_comite, $id_empresa);
                $Usua=DatosUsuario_($rut, $id_empresa);
                $lider= $Usua[0]->nombre_completo;
    }
    
    if($perfil=="SOCIO DE NEGOCIO")    {   $num_colaboradores=Potencial_Busca_Cantidad_Colaboradores_socio($rut, $unico->id_comite, $id_empresa);


			$lider="";
      $array_lideres=PotencialBuscaLideres($unico->id_comite, $id_empresa);
      //print_r($array_lideres);
      foreach ($array_lideres as $unlid){
          $nombr_l=DatosUsuario_($unlid->rut_lider, $id_empresa);
          $lider.=$nombr_l[0]->nombre_completo."<br>";
      }
    }
        //echo "<br>hola ".$unico->nombre;
        $row_lista.= file_get_contents("views/potencial/" . $id_empresa . "_potencial_row_comites.html");
        //echo "<br>views/potencial/" . $id_empresa . "_potencial_row_comites.html";
        $row_lista = str_replace("{ID_COMITE}", ($unico->id_comite), $row_lista);
        $row_lista = str_replace("{COMITE}", ($unico->nombre), $row_lista);
        $row_lista = str_replace("{FECHA}", $unico->fecha_comite, $row_lista);
        $row_lista = str_replace("{LIDER}", ($lider), $row_lista);
        $row_lista = str_replace("{COLABORADORES}", $num_colaboradores, $row_lista);
        $row_lista = str_replace("{BOTON_VER_COMITE}", "<a href='?sw=potencial_comite&id_comite=".Encodear3($unico->id_comite)."' class='btn btn-success'>
        	<span class='blanco'>Ingresar</span></a>", $row_lista);
        
        if($perfil=="SOCIO DE NEGOCIO")    { 
        	$row_lista = str_replace("{BOTON_ELIMINAR_COMITE}", "<a href='?sw=potencial&id_del=".Encodear3($unico->id_comite)."' class='btn btn-link'>
        	<span class='azul_comite'><i class='fas fa-trash-alt'></i></span></a>", $row_lista);
      	}else {
      		$row_lista = str_replace("{BOTON_ELIMINAR_COMITE}", "", $row_lista);
      	}
    }
    //echo  "$row_lista";
    $PRINCIPAL = str_replace("{MIS_COMITES_POTENCIAL}",         $row_lista,         $PRINCIPAL);
    $PRINCIPAL = str_replace("{MIS_COMITES_POTENCIAL_TITULO}",  $potencial_titulo,  $PRINCIPAL);

    return ($PRINCIPAL);
}

function Potencial_Sucesion_Mis_Comites_estado_cierre($PRINCIPAL, $rut, $perfil, $id_empresa, $comite_cierre)
{
    $lista = Potencial_Sucesion_Mis_Comites_data($id_empresa, $rut, $perfil);
    //print_r($lista);
    //echo "<br>comite_cierre $comite_cierre<br>";
    
		$nomuestracabeceras="";
		if($perfil=="VISUALIZADOR"){
			$nomuestracabeceras="1";
		}    
    
    if($nomuestracabeceras=="1"){
    	$lider="";
    	$colab="";
    	
    } else {
    	$lider1="LIDER";
    	$colab="COLAB.";
    }
    $num_comites    =   count($lista);
    //echo "<br>num_comites $num_comites<br>";
    if($num_comites>0){
        $potencial_titulo="
        <br>
<div class=''>
					    <strong>
					        <div class='col-sm-4 txt_title_pot'>COMITE SUCESION</div>
					        <div class='col-sm-2 txt_title_pot'>FECHA REALIZACION</div>
					        <div class='col-sm-4 txt_title_pot'>CARGOS A SUCEDER</div>
					        <div class='col-sm-2 txt_title_pot'>GESTIONAR</div>
					    </strong>
</div>";
    }   else   {
        $potencial_titulo="
<div class='row'>
    <div class='col-sm-12 txt_title_pot'><br><br><center>[ No hay comit&eacute;s creados ]</center></div>
</div>";

    }

    foreach($lista as $unico) {
			$num_colaboradores=0;

			$array_comite=Potencial_Comites_Suc_data($unico->id_comite,$id_empresa);
			//echo "<br>";				print_r($array_comite);			echo "<br>";exit();
			
			$id_comite_cerrado = $array_comite[0]->comite_cerrado;
			//echo "<br>IdComite ".$unico->id_comite." comite cerrado ".$comite_cierre." id_comite_cerrado ".$id_comite_cerrado;
			
			if($comite_cierre=="cerrado" and $id_comite_cerrado<>"SI"){
				continue;
			}

			if($comite_cierre=="activo" and $id_comite_cerrado=="SI"){
				continue;
			}
	  if($perfil=="LIDER")    {   $num_colaboradores=Potencial_Busca_Cantidad_Colaboradores_lider($rut, $unico->id_comite, $id_empresa);
                $Usua=DatosUsuario_($rut, $id_empresa);
                $lider= $Usua[0]->nombre_completo;
    }
    
    if($perfil=="SOCIO DE NEGOCIO" OR $perfil=="SUPER USER")    {   $num_colaboradores=Potencial_Busca_Cantidad_Colaboradores_socio($rut, $unico->id_comite, $id_empresa);


			$g2="";
      $array_g2=PotencialSucesion_BuscaR2($unico->gerenciaR1, $id_empresa);
      //print_r($array_g2);
      foreach ($array_g2 as $unlid){
          //$nombr_l=DatosUsuario_($unlid->rut, $id_empresa);
          
          Potencial_Sucesion_CheckSave($unlid->rut,$unlid->d6,$unico->id_comite,$id_empresa);
			$pos_validada=Sucesion_Check_Posicion_validada($unlid->d6);
			if($pos_validada>0 and $comite_cierre=="activo"){
					$pot_sucesion_badge_ok_cerrado="<div class='badge badge-success'><i class='fas fa-check' style='color: #fff;'></i></div>";
				} else {
					$pot_sucesion_badge_ok_cerrado="";
			}

          $g2.=$unlid->d6." ".$pot_sucesion_badge_ok_cerrado."<br>";


          
          
      }
    }
        //echo "<br>hola ".$unico->nombre;
        $row_lista.= file_get_contents("views/potencial/" . $id_empresa . "_potencial_row_comites_sucesion.html");
        //echo "<br>views/potencial/" . $id_empresa . "_potencial_row_comites.html";
        $row_lista = str_replace("{ID_COMITE}", ($unico->id_comite), $row_lista);
        $row_lista = str_replace("{COMITE}", ($unico->nombre), $row_lista);
        $row_lista = str_replace("{FECHA}", $unico->fecha_comite, $row_lista);
        $row_lista = str_replace("{GERENTES_R2}", ($g2), $row_lista);
        
        $UsuaCreadorComite=DatosUsuario_($unico->rut, $id_empresa);
        $row_lista = str_replace("{POR_CREADOR_COMITE}", $UsuaCreadorComite[0]->nombre_completo, $row_lista);
        
        $row_lista = str_replace("{BOTON_VER_COMITE}", "<a href='?sw=potencial_sucesion_comite&id_comite=".Encodear3($unico->id_comite)."' class='btn btn-success'>
        	<span class='blanco'>Ingresar</span></a>", $row_lista);
        
        if($perfil=="SOCIO DE NEGOCIO"  OR $perfil=="SUPER USER")    { 
        	$row_lista = str_replace("{BOTON_ELIMINAR_COMITE}", "<a href='?sw=potencial_sucesion&id_del=".Encodear3($unico->id_comite)."' class='btn btn-link'>
        	<span class='azul_comite'><i class='fas fa-trash-alt'></i></span></a>", $row_lista);
      	}else {
      		$row_lista = str_replace("{BOTON_ELIMINAR_COMITE}", "", $row_lista);
      	}
    }
    //echo  "$row_lista";
    

    	$PRINCIPAL = str_replace("{MIS_COMITES_POTENCIAL2}",         $row_lista,         $PRINCIPAL);
    	$PRINCIPAL = str_replace("{MIS_COMITES_POTENCIAL_TITULO2}",  $potencial_titulo,  $PRINCIPAL);

 

    return ($PRINCIPAL);
}
function Potencial_Descripcion_Cuadrantes_TXT($cuadrante){
	
if($cuadrante=="1"){
$texto="Consistentemente no alcanza los estándares de desempeño
Competencias superiores al nivel esperado
Tiene potencial para desempeñarse y contribuir a la organización pero puede estar en la posición equivocada

Acción: Re-posicionar para el éxito, dar feedback, formación
";}

if($cuadrante=="2"){
$texto="Muestra consistentemente un desempeño acorde a lo esperado
Competencias superiores al nivel esperado
Aborda fácilmente nuevos desafíos y se adapta fácilmente a ellos

Acción: Apto para asumir nuevos roles, reconocer, dar exposición
";}

if($cuadrante=="3"){
$texto="Consistentemente excede el desempeño esperado
Competencias superiores al nivel esperado
Prospera frente a desafíos nuevos, ambiguos y complejos
Domina el actual rol

Acción: Acelerar desarrollo, reconocimiento, dar exposición
";}

if($cuadrante=="4"){
$texto="Consistentemente no alcanza los estándares de desempeño
Competencias acorde al nivel esperado
Puede estar en la posición equivocada o en proceso de aprendizaje

Acción: Reevaluar su futuro, proveer feedback, coaching de jefatura
";}

if($cuadrante=="5"){
$texto="Se ajusta 100% a su rol actual y su desempeño cumple con las expectativas de su cargo
Competencias acorde al nivel esperado
Entiende y conoce bien su trabajo actual

Acción: Desafiar y probar
";}

if($cuadrante=="6"){
$texto="Consistentemente excede el desempeño esperado
Competencias acorde al nivel esperado
Es referente en su área de especialidad

Acción: Preparar para extender su rol, reconocer contribución
";}

if($cuadrante=="7"){
$texto="Consistentemente no alcanza los estándares de desempeño
Muestra competencias consistentemente bajo lo esperado
Caso crítico

Acción: Plan de mejora o salida
";}

if($cuadrante=="8"){
$texto="Cumple consistentemente con lo esperado en metas
Competencias por debajo del nivel esperado para su rol
Capacidad limitada para tener éxito en un rol más complejo

Acción: Apoyar y desarrollar, proveer feedback, coaching de jefatura
";}

if($cuadrante=="9"){
$texto="Consistentemente excede el desempeño esperado
Tiene alta experiencia en un área funcional, conoce bien su trabajo
Tiene algunas competencias en nivel esperado y aun hay oportunidades de mejora

Acción: Aprovechar/apalancar la experiencia
";}

if($cuadrante=="5+" or $cuadrante=="10"){
$texto="Se ajusta 100% a su rol actual y su desempeño cumple con las expectativas de su cargo
En oportunidades destaca y comienza a demostrar competencias por sobre lo esperado, pero todavía falta consistencia y tiempo

Acción: Desafiar y consolidar
";}
	
return 	$texto;
	
	
}
function calcular_edad($fecha){
$fecha_nac = new DateTime(date('Y/m/d',strtotime($fecha))); // Creo un objeto DateTime de la fecha ingresada
$fecha_hoy =  new DateTime(date('Y/m/d',time())); // Creo un objeto DateTime de la fecha de hoy
$edad = date_diff($fecha_hoy,$fecha_nac); // La funcion ayuda a calcular la diferencia, esto seria un objeto
return $edad;
}
function Potencial_Bitacora_Comites($PRINCIPAL, $id_comite, $rut, $perfil, $id_empresa){

//echo "<br>Potencial_Bitacora_Comites $id_comite, $id_empresa";

 $lista = Potencial_Bitacora_Comites_data($id_comite, $rut, $perfil, $id_empresa);
    //print_r($lista);
    $num_comentarios    =   count($lista);
    //echo "<br>num_comites $num_comites<br>";
    if($num_comentarios>0){
        $potencial_bitacora_titulo="

<div class='panel panel-info'>
                                    <div class='panel-heading'>Bit&aacute;cora de Cambios de Cuadrantes</div>
                                    <div class='panel-body'>


<div class=''>
    <strong>
        <div class='col-sm-4 txt_title_pot'>Colaborador</div>
        <div class='col-sm-4 txt_title_pot'>Quien realizó Cambio</div>
        <div class='col-sm-1 txt_title_pot' style='padding-left: 36px;'>Cuadrante</div>
        <div class='col-sm-3 txt_title_pot' style='padding-left: 36px;'>Fundamento</div>
   </strong>
</div>";
    }   else   {
        $potencial_bitacora_titulo="

<div class=''><br>
    <div class='col-sm-12 txt_title_pot_hohay'><center>[ No hay bit&aacute;cora de cuadrantes ]</center></div>
    					<br>
</div>
";

    }
    //print_r($lista);
    foreach($lista as $unico) {
        //echo "<br>hola ".$unico->nombre;
        $row_lista.= file_get_contents("views/potencial/" . $id_empresa . "_potencial_row_colaboradores_bitacora.html");
        //echo "<br>views/potencial/" . $id_empresa . "_potencial_row_comites.html";
        $row_lista = str_replace("{NOMBRE_AUTOR}",      ($unico->nombre_completo), $row_lista);
        $row_lista = str_replace("{FOTO_AUTOR}",        VerificaFotoPersonal($unico->rut), $row_lista);
        $row_lista = str_replace("{PERFIL}",            ($unico->perfil), $row_lista);
        $row_lista = str_replace("{FOTO_COLABORADOR}",  VerificaFotoPersonal($unico->rut_colaborador), $row_lista);
        $row_lista = str_replace("{NOMBRE_COLABORADOR}",($unico->nombre_completo_col), $row_lista);
        $box_propuesto=Potencial_Matriz_Box_Nuevo_Propuesta($unico->box_propuesto);

      $row_lista = str_replace("{BOX}",   ($box_propuesto), $row_lista);
        $row_lista = str_replace("{COMENTARIO}", ($unico->comentario), $row_lista);
        $row_lista = str_replace("{FECHA}", ($unico->fecha), $row_lista);
    }
    //echo  "$row_lista";
    $PRINCIPAL = str_replace("{BITACORA_CAMBIOS_COMENTARIOS_POTENCIAL}",         $row_lista,         $PRINCIPAL);
    $PRINCIPAL = str_replace("{BITACORA_CAMBIOS_COMENTARIOS_POTENCIAL_TITULO}",  $potencial_bitacora_titulo,  $PRINCIPAL);

    return ($PRINCIPAL);


}
function Potencial_Box9_Comites($PRINCIPAL, $id_comite, $rut, $perfil, $boxfiltro, $id_empresa){

    $row_lista.= file_get_contents("views/potencial/" . $id_empresa . "_potencial_box9.html");

    $cuenta_total_cols=Potencial_Lista_Colaboradores_Reales($id_comite, $id_empresa);
		for ($i = 1; $i <= 10; $i++){
			//echo "<br>i $i";
				    $array	=	Potencial_lista_colabordores_comite($i, $id_comite, $rut, $perfil, $id_empresa);
				    $row_	=	"";
						$cuenta_array=count( $array) + $cuenta_array;
					  foreach($array as $unico){
									//echo "<br>Line 1 - i $i rut ".$unico->rut." cuadrante $Cuadrante_Actual lider $Cuadrante_Lider $Sube_Baja_Mantiene, box filtro $boxfiltro";
				       		$continue= PotChecKMisUsuarioFuera($unico->rut);
				       		if($continue=="1"){ continue;}
									$cuenta++;
									$Cuadrante_Actual		=   Potencial_Mi_Cuadrante_Actual($unico->rut);
									$Cuadrante_Lider 		=   Potencial_Mi_Cuadrante_Lider($unico->rut);
									$Sube_Baja_Mantiene	    =   Potencial_Baja_Igual_Sube($Cuadrante_Actual, $Cuadrante_Lider);
									if($boxfiltro==""){
										$MiCuadrante=$Cuadrante_Actual;
									} else {
										$MiCuadrante=$Cuadrante_Lider;
										if($Sube_Baja_Mantiene==$boxfiltro){
											
										} else {
											continue;
										}
									}
									if($MiCuadrante==$i){
									} else {
										continue;
									}
						$row_.= file_get_contents("views/potencial/" . $id_empresa . "_potencial_box9_rowpersonas.html");
				        $row_ = str_replace("{BOTON_VER_FICHA_A_inicial}",  "<a href='?sw=potencial_ficha&rut_col=".Encodear3($unico->rut)."&id_comite=".Encodear3($id_comite)."'class='btn btn-link' style='padding-left: 0px;    padding-left: 0px;text-align: left;padding-right: 0px;'>",   $row_);
				        $row_ = str_replace("{BOTON_VER_FICHA_B_final}",  "</a>",   $row_);
				        $row_ = str_replace("{AVATAR}",  (VerificaFotoPersonal($unico->rut)),   $row_);
                        $Col=DatosNombreCargoDataBci2021($unico->rut);
				        $row_ = str_replace("{NOMBRE}", ( $Col[0]),             $row_);
				        $row_ = str_replace("{PROPUESTA_MODELO}", "(".($Cuadrante_Actual).")",             $row_);
						        
						    if($i==1){$cuenta1++;}
						    if($i==2){$cuenta2++;}
						    if($i==3){$cuenta3++;}
						    if($i==4){$cuenta4++;}
						    if($i==5){$cuenta5++;}
						    if($i==6){$cuenta6++;}
						    if($i==7){$cuenta7++;}
						    if($i==8){$cuenta8++;}
						    if($i==9){$cuenta9++;}
						    if($i==10){$cuenta10++;}
						    $cuenta++;
						}
				    if($i==1){$row_1=$row_;}
				    if($i==2){$row_2=$row_;}
				    if($i==3){$row_3=$row_;}
				    if($i==4){$row_4=$row_;}
				    if($i==5){$row_5=$row_;}
				    if($i==6){$row_6=$row_;}
				    if($i==7){$row_7=$row_;}
				    if($i==8){$row_8=$row_;}
				    if($i==9){$row_9=$row_;}
				    if($i==10){$row_10=$row_;}
				}
				
				$porc1  =   round(100*$cuenta1/$cuenta_total_cols);
				$porc2  =   round(100*$cuenta2/$cuenta_total_cols);
				$porc3  =   round(100*$cuenta3/$cuenta_total_cols);
				$porc4  =   round(100*$cuenta4/$cuenta_total_cols);
				$porc5  =   round(100*$cuenta5/$cuenta_total_cols);
				$porc6  =   round(100*$cuenta6/$cuenta_total_cols);
				$porc7  =   round(100*$cuenta7/$cuenta_total_cols);
				$porc8  =   round(100*$cuenta8/$cuenta_total_cols);
				$porc9  =   round(100*$cuenta9/$cuenta_total_cols);
				$porc10 =   round(100*$cuenta10/$cuenta_total_cols);

    $row_lista = str_replace("{1}",   $row_1, $row_lista);
    $row_lista = str_replace("{2}",   $row_2, $row_lista);
    $row_lista = str_replace("{3}",   $row_3, $row_lista);
    $row_lista = str_replace("{4}",   $row_4, $row_lista);
    $row_lista = str_replace("{5}",   $row_5, $row_lista);
    $row_lista = str_replace("{6}",   $row_6, $row_lista);
    $row_lista = str_replace("{7}",   $row_7, $row_lista);
    $row_lista = str_replace("{8}",   $row_8, $row_lista);
    $row_lista = str_replace("{9}",   $row_9, $row_lista);
    $row_lista = str_replace("{10}",   $row_10, $row_lista);

    $row_lista = str_replace("{NUM_1}",   $cuenta1, $row_lista);
    $row_lista = str_replace("{NUM_2}",   $cuenta2, $row_lista);
    $row_lista = str_replace("{NUM_3}",   $cuenta3, $row_lista);
    $row_lista = str_replace("{NUM_4}",   $cuenta4, $row_lista);
    $row_lista = str_replace("{NUM_5}",   $cuenta5, $row_lista);
    $row_lista = str_replace("{NUM_6}",   $cuenta6, $row_lista);
    $row_lista = str_replace("{NUM_7}",   $cuenta7, $row_lista);
    $row_lista = str_replace("{NUM_8}",   $cuenta8, $row_lista);
    $row_lista = str_replace("{NUM_9}",   $cuenta9, $row_lista);
    $row_lista = str_replace("{NUM_10}",   $cuenta10, $row_lista);

    $row_lista = str_replace("{PORC_1}",   $porc1."%", $row_lista);
    $row_lista = str_replace("{PORC_2}",   $porc2."%", $row_lista);
    $row_lista = str_replace("{PORC_3}",   $porc3."%", $row_lista);
    $row_lista = str_replace("{PORC_4}",   $porc4."%", $row_lista);
    $row_lista = str_replace("{PORC_5}",   $porc5."%", $row_lista);
    $row_lista = str_replace("{PORC_6}",   $porc6."%", $row_lista);
    $row_lista = str_replace("{PORC_7}",   $porc7."%", $row_lista);
    $row_lista = str_replace("{PORC_8}",   $porc8."%", $row_lista);
    $row_lista = str_replace("{PORC_9}",   $porc9."%", $row_lista);
    $row_lista = str_replace("{PORC_10}",   $porc10."%", $row_lista);

 
    if($cuenta_array>0){
    	if($boxfiltro<>""){
    	        $box9_curva_distribucion="<br><br>";
    	} else {
               $box9_curva_distribucion="<center> <div id='chart_div' style='width: 900px; height: 300px;'></div></center><br><br>";
    	}
						    $PRINCIPAL = str_replace("{CHART_PORC_1}",         $porc1,         $PRINCIPAL);
						    $PRINCIPAL = str_replace("{CHART_PORC_2}",         $porc2,         $PRINCIPAL);
						    $PRINCIPAL = str_replace("{CHART_PORC_3}",         $porc3,         $PRINCIPAL);
						    $PRINCIPAL = str_replace("{CHART_PORC_4}",         $porc4,         $PRINCIPAL);
						    $PRINCIPAL = str_replace("{CHART_PORC_5}",         $porc5,         $PRINCIPAL);
						    $PRINCIPAL = str_replace("{CHART_PORC_6}",         $porc6,         $PRINCIPAL);
						    $PRINCIPAL = str_replace("{CHART_PORC_7}",         $porc7,         $PRINCIPAL);
						    $PRINCIPAL = str_replace("{CHART_PORC_8}",         $porc8,         $PRINCIPAL);
						    $PRINCIPAL = str_replace("{CHART_PORC_9}",         $porc9,         $PRINCIPAL);
						    $PRINCIPAL = str_replace("{CHART_PORC_10}",        $porc10,         $PRINCIPAL);
						    $PRINCIPAL = str_replace("{POTENCIAL_BOX9_COMITE_LIDER_PROPUESTA}",         $row_lista,         $PRINCIPAL);
						    $PRINCIPAL = str_replace("{POTENCIAL_BOX9_CURVA_DISTRIBUCION}", $box9_curva_distribucion,         $PRINCIPAL);
    } else {
						    $PRINCIPAL = str_replace("{POTENCIAL_BOX9_COMITE_LIDER_PROPUESTA}",    "<div class=''><br><div class='col-sm-12 txt_title_pot_hohay'><center>[ No hay colaboradores ]</center></div><br></div>",         $PRINCIPAL);
						    $PRINCIPAL = str_replace("{POTENCIAL_BOX9_CURVA_DISTRIBUCION}",        "",         $PRINCIPAL);
    }
    return ($PRINCIPAL);
}


function BuscaCuadranteAnterior2023($rut){
    //echo "<br>rut ".$u->rut;
    $cuenta_mapeos=Cantidad_Comites_Mapeados($rut);
    //echo " - Cuenta Mapeos $cuenta_mapeos";
    $cuental=0;
    if($cuenta_mapeos>=2){
        //echo "<br>-> mayor que dos";
        $IdComites= Cantidad_Distint_Comites_Mapeados($rut);
        $box_anterior="";
        $box_actual="";
        foreach ($IdComites as $u2){
            $cuental++;
            //echo "<br>->IdComite ".$u2->id_comite;
            $box=BuscaBoxPropuestaUltimoComite($u2->id_comite, $rut);
            //echo ": box ".$box;

            if($cuental=="1"){
                $box_actual=$box;
            }
            if($cuental=="2"){
                $box_anterior=$box;
            }

        }
        $tipo="Mas de dos comites";

    } elseif($cuenta_mapeos==1){
        $IdComites= Cantidad_Distint_Comites_Mapeados($rut);
        foreach ($IdComites as $u2){
            $cuental++;
            //echo "<br>->IdComite ".$u2->id_comite;
            $box=BuscaBoxPropuestaUltimoComite($u2->id_comite, $rut);
            //echo ": box ".$box;
            if($cuental=="1"){
                $box_actual=$box;
            }
            $box_anterior=BuscaBoxAnterior_data_2022Comite($rut);
        }
        $tipo="1 Comite";
    } else {
        $BoxData2=BuscaBoxAnterior_data_2022ComiteSinMapeo($rut);
        $box_actual=$BoxData2[0]->actual;
        $box_anterior=$BoxData2[0]->anterior;
        $tipo="Sin Comite";
    }

    $box_anterior=Potencial_Matriz_Box_Nuevo_Propuesta($box_anterior);
    return $box_anterior;
}
function BuscaCuadranteAnterior2023_solo_num($rut){
    //echo "<br>rut ".$u->rut;
    $cuenta_mapeos=Cantidad_Comites_Mapeados($rut);
    //echo " - Cuenta Mapeos $cuenta_mapeos";
    $cuental=0;
    if($cuenta_mapeos>=2){
        //echo "<br>-> mayor que dos";
        $IdComites= Cantidad_Distint_Comites_Mapeados($rut);
        $box_anterior="";
        $box_actual="";
        foreach ($IdComites as $u2){
            $cuental++;
            //echo "<br>->IdComite ".$u2->id_comite;
            $box=BuscaBoxPropuestaUltimoComite($u2->id_comite, $rut);
            //echo ": box ".$box;

            if($cuental=="1"){
                $box_actual=$box;
            }
            if($cuental=="2"){
                $box_anterior=$box;
            }

        }
        $tipo="Mas de dos comites";

    } elseif($cuenta_mapeos==1){
        $IdComites= Cantidad_Distint_Comites_Mapeados($rut);
        foreach ($IdComites as $u2){
            $cuental++;
            //echo "<br>->IdComite ".$u2->id_comite;
            $box=BuscaBoxPropuestaUltimoComite($u2->id_comite, $rut);
            //echo ": box ".$box;
            if($cuental=="1"){
                $box_actual=$box;
            }
            $box_anterior=BuscaBoxAnterior_data_2022Comite($rut);
        }
        $tipo="1 Comite";
    } else {
        $BoxData2=BuscaBoxAnterior_data_2022ComiteSinMapeo($rut);
        $box_actual=$BoxData2[0]->actual;
        $box_anterior=$BoxData2[0]->anterior;
        $tipo="Sin Comite";
    }


    return $box_anterior;
}
function Potencial_Colaboradores_Comites($PRINCIPAL, $id_comite, $rut, $perfil, $id_empresa)
{
	$array_comite_row=Potencial_Comites_data($id_comite,$id_empresa);
	$dato_cerrado="";
	if($array_comite_row[0]->comite_cerrado=="SI"){
		$fecha_comite_array=explode("-",$array_comite_row[0]->fecha);
		//echo "<h1>--> fecha year ".$array_comite_row[0]->fecha." - ".$fecha_comite_array[0]."</h1>";
		$year_actual=date("Y");
		if($fecha_comite_array[0]==$year_actual){
			$display_none_lider_mapeado="display:none;";
		}
		
			
	} else {
		$display_none_lider_mapeado="";
	}
			//echo "<br>display_none_lider_mapeado $display_none_lider_mapeado<br>";
	
    $lista = Potencial_Colaboradores_Comites_data($id_comite, $rut, $perfil, $id_empresa);
    //print_r($lista);
    $num_comites    =   count($lista);
    //echo "<br>num_comites $num_comites<br>";
    if($num_comites>0){
        $potencial_titulo="
						<div class=''>
						    <strong>
						        <div class='col-sm-3 txt_title_pot'>Colaborador</div>
						        <div class='col-sm-2 txt_title_pot'>Metas</div>
						        <div class='col-sm-2 txt_title_pot'>Competencias</div>
						        <div class='col-sm-1 txt_title_pot'>C. Actual</div>
						        <div class='col-sm-1 txt_title_pot'>C. Anterior</div>
						        <div class='col-sm-1 txt_title_pot'>C. Propuesta Según Modelo</div>
						        <div class='col-sm-1 txt_title_pot' style='".$display_none_lider_mapeado."'>C. Propuesta Líder</div>
						        <div class='col-sm-1 txt_title_pot'></div>
						    </strong>
						</div>";
    }   else   {
        $potencial_titulo="
							<div class=''><br>
							    <div class='col-sm-12 txt_title_pot_hohay'><center>[ No hay colaboradores ]</center></div>
							    					<br>
							</div>";

    }
		
		$i_v=0;$i_s=0;$i_m=0;$i_b=0;

    foreach($lista as $unico) {
				//CheckMapeadoCerrado($unico->rut);     	
       $continue= PotChecKMisUsuarioFuera($unico->rut);
       if($continue=="1"){ continue;}
        $row_lista.= file_get_contents("views/potencial/" . $id_empresa . "_potencial_row_colaboradores_comites.html");
        $row_lista = str_replace("{RUT}",           ($unico->rut), $row_lista);



       $box_anterior_2023= BuscaCuadranteAnterior2023($unico->rut);
        $row_lista = str_replace("{BOX_ANTERIOR_2023}",   	$box_anterior_2023, $row_lista);

        // SI EL COMITE ESTA CERRADO Y ES DEL AÑO PONE CERRADO 1
				if($array_comite_row[0]->comite_cerrado=="SI"){
								if($fecha_comite_array[0]==$year_actual){
									$dato_cerrado="1";
							} else {
									$dato_cerrado="";
							}
					// aca deberia cerrar poner
					 Potencial_Update_data_tbl_bci($promedio_metas,$promedio_competencias,$box_propuesta,$rut, $dato_cerrado);
				} else {
					Potencial_Update_data_tbl_bci($promedio_metas,$promedio_comp,$box_propuesta,$unico->rut,"");	
				}
				
				//busca mapeados si esta cerrado
        $Potencial_Mapeado=Potencial_Check_Mapeado($unico->rut);
	        if($Potencial_Mapeado<>""){
	        	if($array_comite_row[0]->comite_cerrado=="SI"){
	        		$row_lista = str_replace("{MAPEADO}",         	"", $row_lista);
	        	} else {
	        			$Potencial_Mapeado_Cerrado=Potencial_Check_Mapeado_Cerrado($unico->rut);
	        			//echo "<br>-->Potencial_Mapeado_Cerrado ".$Potencial_Mapeado_Cerrado;
	        			$cerrado=Potencial_BuscaUltimoComitedeRut($rut);
	        			
	        			if($Potencial_Mapeado_Cerrado>0 and $cerrado=="1"){
	        				$row_lista = str_replace("{MAPEADO}",           "", $row_lista);	
	        			} else {
	        				$row_lista = str_replace("{MAPEADO}",           "<span class='badge badge-success' style='font-size: 10px;'><span class='blanco'>Mapeado</span></span>", $row_lista);			
	        			}
	        		
	        	}
	        	
	        } else {
	        		$row_lista = str_replace("{MAPEADO}",         	"", $row_lista);
	        }

            $Col=DatosNombreCargoDataBci2021($unico->rut);
            $Lid=DatosNombreCargoDataBci2021($unico->rut_lider);
            //print_r($Col);exit();
        $row_lista = str_replace("{COLABORADOR}",   	($Col[0]), $row_lista);
        $row_lista = str_replace("{CARGO_COL}",   		($Col[1]), $row_lista);
        $row_lista = str_replace("{NOMBRE_LIDER}",  	($Lid[0]), $row_lista);

        $row_lista = str_replace("{AVATAR}",   VerificaFotoPersonal($unico->rut), $row_lista);
        $array_resultados       =       Potencial_Colaboradores_Matriz_Fields_tbl_data_bci_data($unico->rut);
		$Metas2020Array			=		Potencial_BuscaDesempeno_2020($unico->rut);
		$Metas2021Array			=		Potencial_BuscaDesempeno_2021($unico->rut);
        $cuenta_metas=0;    $cuenta_comp=0;    
        $suma_metas=0;      $suma_comp=0;     
        $promedio_metas=""; 
        $promedio_comp="";
       	$comp2019_80="";
       	$comp2019_20="";
       	$comp2018_80="";
       	$comp2018_20="";
       	$comp_2019="";
       	$comp_2018="";
       	
		        if($array_resultados[0]->meta_2019>0)														{$cuenta_metas++; $suma_metas=$array_resultados[0]->meta_2019+$suma_metas;}
				if($Metas2020Array[0]->meta_2020>0)															{$cuenta_metas++; $suma_metas=$Metas2020Array[0]->meta_2020+$suma_metas;}
				if($Metas2021Array[0]->meta_2021>0)															{$cuenta_metas++; $suma_metas=$Metas2021Array[0]->meta_2021+$suma_metas;}


				//127 Mis Colaboradores - Actua como dueno 2019 + Mis Colaboradores - 130 Logra Objetivos Ambiciosos 2019
		    if($array_resultados[0]->competencia_2019<>'')										{$comp2019_80=($array_resultados[0]->d127+$array_resultados[0]->d130)/2;}
		    // 129 Mis Colaboradores - Se apasiona por el cliente 2019 + 128 Mis Colaboradores - Obtiene lo mejor de las personas 2019
		    if($array_resultados[0]->competencia_2019<>'')										{$comp2019_20=($array_resultados[0]->d129+$array_resultados[0]->d128)/2;}
				//79 Mis colaboradores - Innovacion abierta 2018+  80 Mis colaboradores - Trabajo colaborativo 2018 + 77 Mis colaboradores - Agilidad en la ejecucion  2018
		    if($array_resultados[0]->competencia_miscolaboradores_2018<>'')		{$comp2018_80=($array_resultados[0]->d79+$array_resultados[0]->d80+$array_resultados[0]->d77)/3;}
		    if($array_resultados[0]->competencia_miscolaboradores_2018<>'')		{
				//87 Mis colaboradores - Liderazgo integrador 2018 + 77 Mis colaboradores - Agilidad en la ejecucion  201 	
			    	if($array_resultados[0]->d87<>""){
			    		$comp2018_20=($array_resultados[0]->d87+$array_resultados[0]->d77)/2;	
			    	} else {
							$comp2018_20=$array_resultados[0]->d77;		    		
			    	}
		    	}
 
 				if($array_resultados[0]->competencia_2019<>'')										{$comp_2019=round(0.8*$comp2019_80+$comp2019_20*0.2,2); $suma_comp=$suma_comp+$comp_2019; $cuenta_comp++;}
 				if($Metas2020Array[0]->promedio<>'')		{
 					$comp2020_80=($Metas2020Array[0]->acd+$Metas2020Array[0]->lob)/2;
 					$comp2020_20=($Metas2020Array[0]->omp+$Metas2020Array[0]->sac)/2;
 					$comp_2020=round(0.8*$comp2020_80+$comp2020_20*0.2,2);
 					$cuenta_comp++; $suma_comp=$comp_2020+$suma_comp;
 					}
		
 				if($Metas2021Array[0]->promedio<>'')		{
 					$comp2021_80=($Metas2021Array[0]->acd+$Metas2021Array[0]->lob)/2;
 					$comp20201_20=($Metas2021Array[0]->omp+$Metas2021Array[0]->sac)/2;
 					$comp_2021=round(0.8*$comp2021_80+$comp2020_21*0.2,2);
 					$cuenta_comp++; $suma_comp=$comp_2021+$suma_comp;
 					}		
        $promedio_metas         =       $suma_metas/$cuenta_metas;
        $promedio_comp         	=       $suma_comp/$cuenta_comp;


				// SEGUN RESULTADO META Y COMPETENCIA SE VISUALIZA CORRECTAMENTE EL CUADRANTE PROPUESTO

        if($unico->rut=="21159012") {
                //echo "<br>->promedio metas ".$promedio_metas." promedio comp ".$promedio_comp;
        }

				$potencial_matriz=Potencial_Matriz_Box_Potencial($promedio_metas, $promedio_comp);

             if($unico->rut=="21159012") {
                 //echo "<br> potencial matriz<br> <pre>";print_r($potencial_matriz);echo "</pre>";
             }
				if($array_comite_row[0]->comite_cerrado=="SI"){


                } else {
                    //echo "update";
                    $hoy=date("Y-m-d");
                    Potencial_Cuadrantes_Update_2022_Data($unico->rut,$promedio_metas,
                        $promedio_comp,$potencial_matriz[4],$hoy);
                }

                        //API CUADRANTES
			$array_info_actual_potencial_cuadrantes=Potencial_Colaboradores_Matriz_tbl_potencial_cuadrantes_data($id_empresa, $unico->rut);
            if($unico->rut=="12864371"){
                   // echo "<br>array_info_actual_potencial_cuadrantes<br><pre>";print_r($array_info_actual_potencial_cuadrantes);echo "</pre>";
            }



        //print_r($potencial_matriz);
				$meta                   =   $potencial_matriz[0];
				$meta_txt               =   $potencial_matriz[1];
				$competencia            =   $potencial_matriz[2];
				$competencia_txt        =   $potencial_matriz[3];
				$box_propuesta          =   $potencial_matriz[4];
				$box_propuesta_txt      =   $potencial_matriz[5];
        
        if($cuenta_metas==0){
        	$meta_txt="<center><br><div class='txt_azul_box_v3_SM'>Sin Información de Metas</div></center>";	
        } 
        if($cuenta_comp==0){
        	$competencia_txt="<center><br><div class='txt_azul_box_v3_SM'>Sin Información de Competencias</div></center>";	
        } 
      	if($cuenta_metas==0 or $cuenta_comp==0){
      	$box_propuesta_txt	="<center><br><div class='txt_azul_box_v3_SM'>Sin Propuesta de Cuadrante</div></center>";	
      	}
        
        $row_lista = str_replace("{ID}",            $array_resultados[0]->id, $row_lista);
        $row_lista = str_replace("{ID_COMITE}",     Encodear3($id_comite), $row_lista);
        $row_lista = str_replace("{PERFIL}",        $perfil, $row_lista);

        $row_lista = str_replace("{META}",          $meta_txt, $row_lista);
        $row_lista = str_replace("{COMPETENCIA}",   $competencia_txt, $row_lista);
        $row_lista = str_replace("{BOX_PROPUESTA}", $box_propuesta_txt, $row_lista);
        
        $hoy   = date('Y-m-d');
        
        


     $box_propuesta_lider_txt= Potencial_Matriz_Box_Nuevo_Propuesta($array_info_actual_potencial_cuadrantes[0]->cuadrante_2020_lider);
     //PRROPUESTA DEL LIDER 
   	if($array_comite_row[0]->comite_cerrado=="SI"){
     	  $row_lista = str_replace("{BOX_PROPUESTA_LIDER}", "", $row_lista);
    } else {
     	$CheckCerrado=Potencial_Check_Mapeado_Cerrado($unico->rut);
     	if($CheckCerrado>0){
    	  $row_lista = str_replace("{BOX_PROPUESTA_LIDER}", "", $row_lista);
     	} else {
    	  $row_lista = str_replace("{BOX_PROPUESTA_LIDER}", $box_propuesta_lider_txt, $row_lista);
     	}
    }
      

					if($unico->rut=="12864371"){
						//print_r($array_info_actual_potencial_cuadrantes);
					}
				//print_r($array_info_actual_potencial_cuadrantes);
      	if($array_info_actual_potencial_cuadrantes[0]->cuadrante_2020<>""){
      		
      		$array_resultados[0]->cuadrante_anterior			= $array_info_actual_potencial_cuadrantes[0]->cuadrante_anterior;
      		$array_resultados[0]->fecha_cuadrante_actual	    = $array_info_actual_potencial_cuadrantes[0]->fecha_cuadrante_2020;
      		$array_resultados[0]->cuadrante_actual				= $array_info_actual_potencial_cuadrantes[0]->cuadrante_2020;
      		
      	}  
        
        $ts1 =strtotime($array_resultados[0]->cuadrante_actual); 
				$ts2 = strtotime($hoy); 
				$year1 = date('Y', $ts1); 
				$year2 = date('Y', $ts2); 
				$month1 = date('m', $ts1); $month2 = date('m', $ts2); 
				$meses_actual = (($year2 - $year1) * 12) + ($month2 - $month1) ;
				
        $cuadrante_actual=Potencial_Matriz_Box_Nuevo_Propuesta($array_resultados[0]->cuadrante_actual);
				if($cuadrante_actual==""){ $meses_actual="";}   else {$meses_actual=$meses_actual. " meses";}   
				
				//echo "<br> $cuadrante_actual $meses_actual";
				
				  
				if($cuadrante_actual==""){
      		$cuadrante_actual	="<center><br><div class='txt_azul_box_v3_SM'>Sin Cuadrante Actual</div></center>";	
      	}

        $cuadrante_anterior=Potencial_Matriz_Box_Nuevo_Propuesta($array_resultados[0]->cuadrante_anterior);
				if($cuadrante_anterior==""){ $meses_anterior="";} else {
					
					$meses_anterior=$array_resultados[0]->meses_cuadrante_anterior;
        	$meses_anterior = str_replace(".00", "", $meses_anterior);
					
					$meses_anterior=$meses_anterior. " meses";}
      	if($cuadrante_anterior==""){
      		$cuadrante_anterior	="<center><br><div class='txt_azul_box_v3_SM'>Sin Cuadrante Anterior</div></center>";	
      	}
      	
      	if($array_info_actual_potencial_cuadrantes[0]->cuadrante_2020<>""){
      						$meses_anterior="";
      						
      		        $ts1 =strtotime($array_resultados[0]->fecha_cuadrante_actual); 
									$ts2 = strtotime($hoy); 
									$year1 = date('Y', $ts1); 
									$year2 = date('Y', $ts2); 
									$month1 = date('m', $ts1); $month2 = date('m', $ts2); 
									$meses_actual = (($year2 - $year1) * 12) + ($month2 - $month1) ;
					      	$meses_anterior=$meses_actual. " meses";
					      	
					      	$meses_actual=$meses_actual. " meses";
      	}



        $row_lista = str_replace("{BOX_ACTUAL}",  	$cuadrante_actual."<center><div class='txt_azul_box_v3_SM' 	style='    margin-top: -7px;'>
        ".$meses_actual."</div></center> ", $row_lista);
        $row_lista = str_replace("{BOX_ANTERIOR}",  $cuadrante_anterior."<center><div class='txt_azul_box_v3_SM' style='    margin-top: -7px;'>
        </div></center> ", $row_lista);

        $row_lista = str_replace("{FECHA}", $unico->fecha, $row_lista);
        $row_lista = str_replace("{LIDER}", $unico->nombre_lider, $row_lista);
        $row_lista = str_replace("{COLABORADORES}", $unico->num_colaboradores, $row_lista);        
        $row_lista = str_replace("{RUT_COL}", Encodear3($unico->rut), $row_lista);
        $row_lista = str_replace("{BOTON_VER_COMITE}", "<a href='?sw=potencial_comite&id_comite=".Encodear3($unico->id_comite)."' class='btn btn-info'><span class='blanco'>Ingresar</span></a>", $row_lista);
        $boton_ver_editar_box   ="<button type='button' class='btn btn-link' data-toggle='modal' data-target='#".Encodear3($array_resultados[0]->rut)."'>
        <span class='azul_comite'><i class='fas fa-edit'></i></span></button>";
        
       if($perfil=="SOCIO DE NEGOCIO"){
        $row_lista = str_replace("{BOTON_VER_EDITAR_BOX}", $boton_ver_editar_box, $row_lista);
      } else {
      	$row_lista = str_replace("{BOTON_VER_EDITAR_BOX}", $boton_ver_editar_box, $row_lista);
      }


				//echo "<br>Line ".$unico->rut." ".$unico->nombre_completo." propuesta sistema ".$box_propuesta." lider ".$array_info_actual_potencial_cuadrantes[0]->cuadrante_2020_lider."<br>$box_propuesta_txt<br>";
				$Potencial_Baja_Igual_Sube=Potencial_Baja_Igual_Sube($box_propuesta, $array_info_actual_potencial_cuadrantes[0]->cuadrante_2020_lider);
				
				
				if($box_propuesta_txt=="<center><br><div class='txt_azul_box_v3_SM'>Sin Propuesta de Cuadrante</div></center>"){
					$Arreglo_Cambio_Lider_Vacio[$i_v]=($unico->nombre_completo);$i_v++;
				} else {
					//echo " ----> ".$Potencial_Baja_Igual_Sube;
					
					if($Potencial_Baja_Igual_Sube=="SUBE")			{	$Arreglo_Cambio_Lider_Sube[$i_s]			=($unico->nombre_completo);$i_s++;}
					if($Potencial_Baja_Igual_Sube=="MANTIENE")	{	$Arreglo_Cambio_Lider_Mantiene[$i_m]	=($unico->nombre_completo);$i_m++;}
					if($Potencial_Baja_Igual_Sube=="BAJA")			{	$Arreglo_Cambio_Lider_Baja[$i_b]			=($unico->nombre_completo);$i_b++;}
					if($Potencial_Baja_Igual_Sube=="VACIO")			{	$Arreglo_Cambio_Lider_Vacio[$i_v]			=($unico->nombre_completo);$i_v++;}
					
				}
				//echo "<br>perfil $perfil<br>";
        $row_lista = str_replace("{BOTON_VER_FICHA}","<a href='?sw=potencial_ficha&rut_col=".Encodear3($unico->rut)."&id_comite=".Encodear3($id_comite)."' class='btn btn-link' >
        <span class='azul_comite'><i class='fas fa-user'></i> <span class='mt-comment-authorSM'> Ficha</span></span></a>", $row_lista);

			  $row_lista = str_replace("{BOTON_VER_FICHA_A_inicial}","<a href='?sw=potencial_ficha&rut_col=".Encodear3($unico->rut)."&id_comite=".Encodear3($id_comite)."'
			   class='btn btn-link' style='padding-left: 0px;    padding-left: 0px;text-align: left;padding-right: 0px;'>", $row_lista);

			  $row_lista = str_replace("{BOTON_VER_FICHA_B_final}","</a>", $row_lista);



    }

    /*	
    		echo "<br>Sube<br>";    			print_r($Arreglo_Cambio_Lider_Sube);
    		echo "<br>Mantiene<br>";    	print_r($Arreglo_Cambio_Lider_Mantiene);
    		echo "<br>Baja<br>";    			print_r($Arreglo_Cambio_Lider_Baja);
    		echo "<br>Vacio<br>";    			print_r($Arreglo_Cambio_Lider_Vacio);	
    */
    
    foreach ($Arreglo_Cambio_Lider_Sube as $unS){
    	$row_sube.="<div>".$unS."</div>";
    }

    foreach ($Arreglo_Cambio_Lider_Mantiene as $unM){
    	$row_mantiene.="<div>".$unM."</div>";
    }

    foreach ($Arreglo_Cambio_Lider_Baja as $unB){
    	$row_baja.="<div>".$unB."</div>";
    }

    foreach ($Arreglo_Cambio_Lider_Vacio as $unV){
    	$row_vacio.="<div>".$unV."</div>";
    }

    $PRINCIPAL = str_replace("{LIDER_SUBEN}",         $row_sube,         $PRINCIPAL);
    $PRINCIPAL = str_replace("{LIDER_SEMANTIENEN}",   $row_mantiene,     $PRINCIPAL);
    $PRINCIPAL = str_replace("{LIDER_BAJAN}",         $row_baja,         $PRINCIPAL);
    $PRINCIPAL = str_replace("{LIDER_VACIO}",         $row_vacio,        $PRINCIPAL);
    
    $PRINCIPAL = str_replace("{MIS_COLABORADORES_COMITES_POTENCIAL}",         $row_lista,         $PRINCIPAL);
    $PRINCIPAL = str_replace("{COLABORADORES_COMITE_POTENCIAL_TITULO}",  $potencial_titulo,  $PRINCIPAL);

    return ($PRINCIPAL);
}
function Potencial_Colaboradores_MiEquipo($PRINCIPAL, $tipo_accion, $rut_completo, $perfil, $id_empresa)
{
    $lista = Potencial_Colaboradores_MiEquipo_data($rut_completo, $perfil, $id_empresa);

    $num_cols    =   count($lista);
    if($num_cols>0){
        $potencial_titulo="
<div class=''>
    <strong>
        <div class='col-sm-4 txt_title_pot'>Colaborador</div>
        <div class='col-sm-7 txt_title_pot'>Acciones de Desarrollo</div>
        <div class='col-sm-1 txt_title_pot'></div>
    </strong>
</div>";
    }   else   {
        $potencial_titulo="
<div class=''><br>
    <div class='col-sm-12 txt_title_pot_hohay'><center>[ No tienes colaboradores a tu cargo ]</center></div>
    					<br>
</div>";

    }
		
		$i_v=0;$i_s=0;$i_m=0;$i_b=0;
			

    foreach($lista as $unico) {

        $row_lista.= file_get_contents("views/potencial/" . $id_empresa . "_potencial_row_colaboradores_acciones_desarrollo.html");
        $row_lista = str_replace("{RUT}",           	($unico->rut), $row_lista);
        $row_lista = str_replace("{COLABORADOR}",   	($unico->d7)." ".($unico->d8)." ".($unico->d9), $row_lista);
        $row_lista = str_replace("{CARGO_COL}",   		($unico->d15), $row_lista);
        $row_lista = str_replace("{NOMBRE_LIDER}",  	($unico->nombre_lider), $row_lista);
        $row_lista = str_replace("{AVATAR}",   VerificaFotoPersonal($unico->rut), $row_lista);

       	$row_lista = str_replace("{BOTON_VER_FICHA}","<a href='?sw=potencial_ficha&rut_col=".Encodear3($unico->rut)."&id_comite=".Encodear3($id_comite)."&accionesDesarrollo=1' class='btn btn-link' >
       		<span class='azul_comite'><i class='fas fa-user'></i> <span class='mt-comment-authorSM'> Ficha</span></span></a>", $row_lista);
		  	$row_lista = str_replace("{BOTON_VER_FICHA_A_inicial}","<a href='?sw=potencial_ficha&rut_col=".Encodear3($unico->rut)."&id_comite=".Encodear3($row_lista)."&accionesDesarrollo=1'
	   			class='btn btn-link' style='padding-left: 0px;    padding-left: 0px;text-align: left;padding-right: 0px;padding: 0px;'>", $row_lista);
		  	$row_lista = str_replace("{BOTON_VER_FICHA_B_final}","</a>", $row_lista);					

					$AD=Potencial_Busca_Acciones_Desarrollo_Dado_Rut($unico->rut);
					$row_ad="";
					$AccDes="";
					foreach ($AD as $unicoAD){
						
							$plan					=($unicoAD->plan);
							$fundamento		=($unicoAD->fundamento);
							$estado				=($unicoAD->estado);
							$fecha_estado	=($unicoAD->fecha_estado);
							$periodo			=($unicoAD->periodo);
			

			if($unicoAD->estado=="Realizado"){
				$estado="<div class='badge badge-success'><span style='color:#fff'>Realizado</span></div>";
			}  elseif($unicoAD->estado=="Suspendido"){
				$estado="<div class='badge badge-danger'><span style='color:#fff'>Suspendido</span></div>";
			}   elseif($unicoAD->estado=="En Proceso"){
				$estado="<div class='badge badge-danger'><span style='color:#fff'>En Proceso</span></div>";
			} 
			elseif($unicoAD->estado=="No Iniciado"){
				$estado="<div class='badge badge-warning'><span style='color:#fff'>No Iniciado</span></div>";
			}
			 elseif($unicoAD->estado=="No Realizado"){
				$estado="<div class='badge badge-danger'><span style='color:#fff'>No Realizado</span></div>";
			} else {
				$estado="<div class='badge badge-gray'><span style='color:#fff'>Sin Información</span></div>";
			
			}
			
					$AccDes.="
	
					  				
																<div class='col-md-7'>
																	<div class=''> 

																		<div class='badge badge-gray'>Periodo: ".($unicoAD->periodo)."</div><br>
																		<div class='badge badge-gray'>".($unicoAD->plan)."</div><br>
																		<div >".($unicoAD->fundamento)."</div>
																	</div>
																</div>
																<div class='col-md-2'><div class=''> <center>".($estado)."
																<br><span style='    font-size: 10px;color: #337ab7;'>".($unicoAD->fecha_estado)." <br> ".($unicoAD->comentario_estado)."</span>
																</center>
																
																 </div></div>
																<div class='col-md-3'><div class=''>  
																
																
							<button type='button' class='btn btn-link' data-toggle='modal' data-target='#exampleAD_Modal_".$unicoAD->id."' style='font-size: 12px;'>
  							<span style='color: #337ab7;'>		Editar Estado <i class='fas fa-pen'></i> </span>
							</button>																


							<div class='modal fade' id='exampleAD_Modal_".$unicoAD->id."' tabindex='-1' role='dialog' aria-labelledby='exampleModalLabel' aria-hidden='true'>
							  <div class='modal-dialog' role='document'>
							    <div class='modal-content'>
							      <div class='modal-body'>
							       	<br>Editar Estado de Acci&oacute;n de Desarrollo:  <strong>".($unicoAD->plan)."</strong>
							       	<br><br>
							       	
							       	<form id='".$unicoAD->id."' name='".$unicoAD->id."' action='' method='post'>
							       	<div class='txt_2020'>Estado</div>
							       		<select name='estado' class='form form-control' required>
							       				<option value='".$unicoAD->estado."'>".$unicoAD->estado."</option>
							       				<option value='Realizado'>Realizado</option>
							       				<option value='Suspendido'>Suspendido</option>
							       				<option value='En Proceso'>En Proceso</option>
							       				<option value='No Iniciado'>No Iniciado</option>

							       		</select>
							       		<div class='txt_2020'>Fundamento / Comentarios</div>
							       		<input type='text' name='fundamento' id='fundamento'  class='form form-control' required value='".$unicoAD->fundamento."'>
							       		<input type='hidden' value='".Encodear3($unicoAD->id)."' name='idEdEst'>
							       		<br><input type='submit' class='btn btn-info' name='editar' value='Actualizar Estado'>
							       	</form>
							      </div>
							    </div>
							  </div>
							</div>
																
																</div></div>
															 <div class='col-md-12'><div class=''><hr> </div></div>
	";	}
        $row_lista = str_replace("{ACCIONES_DESARROLLO}",           	($AccDes), $row_lista);


		
		}


    $PRINCIPAL = str_replace("{MIS_COLABORADORES_COMITES_POTENCIAL_MIEQUIPO}",         $row_lista,         $PRINCIPAL);
    $PRINCIPAL = str_replace("{COLABORADORES_COMITE_POTENCIAL_TITULO_MIEQUIPO}",  $potencial_titulo,  $PRINCIPAL);

    return ($PRINCIPAL);
}
function Potencial_Matriz_Box_Nuevo_Propuesta($id_box_propuesta){
if($id_box_propuesta ==  "10")           {$box_propuesta="10"; $txt_box_propuesta="<div class='alert alert-info'>5+</div>";}

if($id_box_propuesta ==  "5")           {$box_propuesta="5"; $txt_box_propuesta="<div class='alert alert-info'>5</div>";}
if($id_box_propuesta ==  "4")           {$box_propuesta="4"; $txt_box_propuesta="<div class='alert alert-warning'>4</div>";}
if($id_box_propuesta ==  "6")           {$box_propuesta="6"; $txt_box_propuesta="<div class='alert alert-success'>6</div>";}

if($id_box_propuesta ==  "8")           {$box_propuesta="8"; $txt_box_propuesta="<div class='alert alert-warning'>8</div>";}
if($id_box_propuesta ==  "7")           {$box_propuesta="7"; $txt_box_propuesta="<div class='alert alert-danger'>7</div>";}
if($id_box_propuesta ==  "9")           {$box_propuesta="9"; $txt_box_propuesta="<div class='alert alert-info'>9</div>";}

if($id_box_propuesta ==  "2")           {$box_propuesta="2"; $txt_box_propuesta="<div class='alert alert-success'>2</div>";}
if($id_box_propuesta ==  "1")           {$box_propuesta="1"; $txt_box_propuesta="<div class='alert alert-info'>1</div>";}
if($id_box_propuesta ==  "3")           {$box_propuesta="3"; $txt_box_propuesta="<div class='alert alert-success'>3</div>";}

if($id_box_propuesta ==  "5+")           {$box_propuesta="5+"; $txt_box_propuesta="<div class='alert alert-info'>5+</div>";}

return  $txt_box_propuesta;
}
function Potencial_Matriz_Box_Nuevo_Propuesta_Step($id_box_propuesta){
if($id_box_propuesta ==  "10")           {$box_propuesta="10"; $txt_box_propuesta="<div class='step step_info'>5+</div>";}


if($id_box_propuesta ==  "5")           {$box_propuesta="5"; $txt_box_propuesta="<div class='step step_info'>5</div>";}
if($id_box_propuesta ==  "4")           {$box_propuesta="4"; $txt_box_propuesta="<div class='step step_warning'>4</div>";}
if($id_box_propuesta ==  "6")           {$box_propuesta="6"; $txt_box_propuesta="<div class='step step_success'>6</div>";}

if($id_box_propuesta ==  "8")           {$box_propuesta="8"; $txt_box_propuesta="<div class='step step_warning'>8</div>";}
if($id_box_propuesta ==  "7")           {$box_propuesta="7"; $txt_box_propuesta="<div class='step step-danger'>7</div>";}
if($id_box_propuesta ==  "9")           {$box_propuesta="9"; $txt_box_propuesta="<div class='step step_info'>9</div>";}

if($id_box_propuesta ==  "2")           {$box_propuesta="2"; $txt_box_propuesta="<div class='step step_success'>2</div>";}
if($id_box_propuesta ==  "1")           {$box_propuesta="1"; $txt_box_propuesta="<div class='step step_info'>1</div>";}
if($id_box_propuesta ==  "3")           {$box_propuesta="3"; $txt_box_propuesta="<div class='step step_success'>3</div>";}

if($id_box_propuesta ==  "5+")           {$box_propuesta="5+"; $txt_box_propuesta="<div class='step step_info'>5+</div>";}

return  $txt_box_propuesta;
}
function Potencial_Matriz_Box_Potencial($metas_promedio, $competencias_promedio){

//echo "<br> Potencial_Matriz_Box_Potencial metas $metas_promedio, comp $competencias_promedio";

if($metas_promedio<0.9)                                 {$meta="No cumple";             $txt_meta="<div class='alert alert-danger'>No cumple</div>";}
elseif($metas_promedio<1.2 and $metas_promedio>=0.9)    {$meta="Cumple";                $txt_meta="<div class='alert alert-info'>Cumple</div>";}
elseif($metas_promedio>=1.2)                            {$meta="Sobrecumple";           $txt_meta="<div class='alert alert-success'>Sobrecumple</div>";}
else                                                    {$meta="Sin dato Metas";        $txt_meta="";}


//echo "<br>METAS dato $metas_promedio METAS  $meta    $txt_meta";

if($competencias_promedio<2.6)                                          {$competencia="Bajo";       $txt_competencia="<div class='alert alert-danger'>Bajo</div>";}
elseif($competencias_promedio<3.5 and $competencias_promedio>=2.6)      {$competencia="Esperado";   $txt_competencia="<div class='alert alert-info'>Esperado</div>";}
elseif($competencias_promedio>=3.5)                                     {$competencia="Alto";       $txt_competencia="<div class='alert alert-success'>Alto</div>";}
else                                                                    {$competencia="Sin dato Competencias";  $txt_competencia="";}

//echo "<br>COMP dato $competencias_promedio $competencia    $txt_competencia";

if($competencia ==  "Esperado"  and  $meta   == "Cumple")               {$box_propuesta="5"; $txt_box_propuesta="<div class='alert alert-info'>5</div>";}
if($competencia ==  "Esperado"  and  $meta   == "No cumple")            {$box_propuesta="4"; $txt_box_propuesta="<div class='alert alert-warning'>4</div>";}
if($competencia ==  "Esperado"  and  $meta   == "Sobrecumple")          {$box_propuesta="6"; $txt_box_propuesta="<div class='alert alert-success'>6</div>";}

if($competencia ==  "Bajo"      and  $meta   == "Cumple")               {$box_propuesta="8"; $txt_box_propuesta="<div class='alert alert-warning'>8</div>";}
if($competencia ==  "Bajo"      and  $meta   == "No cumple")            {$box_propuesta="7"; $txt_box_propuesta="<div class='alert alert-danger'>7</div>";}
if($competencia ==  "Bajo"      and  $meta   == "Sobrecumple")          {$box_propuesta="9"; $txt_box_propuesta="<div class='alert alert-info'>9</div>";}

if($competencia ==  "Alto"      and  $meta   == "Cumple")               {$box_propuesta="2"; $txt_box_propuesta="<div class='alert alert-success'>2</div>";}
if($competencia ==  "Alto"      and  $meta   == "No cumple")            {$box_propuesta="1"; $txt_box_propuesta="<div class='alert alert-info'>1</div>";}
if($competencia ==  "Alto"      and  $meta   == "Sobrecumple")          {$box_propuesta="3"; $txt_box_propuesta="<div class='alert alert-success'>3</div>";}



$arreglo[0]=$meta;
$arreglo[1]=$txt_meta;

$arreglo[2]=$competencia;
$arreglo[3]=$txt_competencia;

$arreglo[4]=$box_propuesta;
$arreglo[5]=$txt_box_propuesta;

return  $arreglo;
}
function Potencial_Mis_Comites($PRINCIPAL, $rut, $perfil, $id_empresa)
{
		$Usua=DatosUsuario_($rut, $id_empresa);
    $lista = Potencial_Mis_Comites_data($id_empresa, $rut, $perfil, $Usua[0]->jefe);
    //print_r($lista);
    
$nomuestracabeceras="";
if($perfil=="VISUALIZADOR"){
	$nomuestracabeceras="1";
}    
    
    if($nomuestracabeceras=="1"){
    	$lider="";
    	$colab="";
    	
    } else {
    	$lider1="LIDER";
    	$colab="COLAB.";
    }
    $num_comites    =   count($lista);
    //echo "<br>num_comites $num_comites<br>";
    if($num_comites>0){
        $potencial_titulo="
        <br>
<div class=''>
    <strong>
        <div class='col-sm-4 txt_title_pot'>COMITE</div>
        <div class='col-sm-2 txt_title_pot'>FECHA REALIZACION</div>
        <div class='col-sm-3 txt_title_pot'>".$lider1."</div>
        <div class='col-sm-1 txt_title_pot'>".$colab."</div>
        <div class='col-sm-2 txt_title_pot'>GESTIONAR</div>
    </strong>
</div>";
    }   else   {
        $potencial_titulo="
<div class='row'>
    <div class='col-sm-12 txt_title_pot'><br><br><center>[ No hay comit&eacute;s creados ]</center></div>
</div>";

    }

    foreach($lista as $unico) {
			$num_colaboradores=0;
    if($perfil=="LIDER")    {   $num_colaboradores=Potencial_Busca_Cantidad_Colaboradores_lider($rut, $unico->id_comite, $id_empresa);
                $Usua=DatosUsuario_($rut, $id_empresa);
                $lider= $Usua[0]->nombre_completo;
    }
    
    if($perfil=="SOCIO DE NEGOCIO")    {   $num_colaboradores=Potencial_Busca_Cantidad_Colaboradores_socio($rut, $unico->id_comite, $id_empresa);


			$lider="";
      $array_lideres=PotencialBuscaLideres($unico->id_comite, $id_empresa);
      //print_r($array_lideres);
      foreach ($array_lideres as $unlid){
          $nombr_l=DatosUsuario_($unlid->rut_lider, $id_empresa);
          $lider.=$nombr_l[0]->nombre_completo."<br>";
      }
    }
        //echo "<br>hola ".$unico->nombre;
        $row_lista.= file_get_contents("views/potencial/" . $id_empresa . "_potencial_row_comites.html");
        //echo "<br>views/potencial/" . $id_empresa . "_potencial_row_comites.html";
        $row_lista = str_replace("{ID_COMITE}", ($unico->id_comite), $row_lista);
        $row_lista = str_replace("{COMITE}", ($unico->nombre), $row_lista);
        $row_lista = str_replace("{FECHA}", $unico->fecha_comite, $row_lista);
        $row_lista = str_replace("{LIDER}", ($lider), $row_lista);
        $row_lista = str_replace("{COLABORADORES}", $num_colaboradores, $row_lista);
        $row_lista = str_replace("{BOTON_VER_COMITE}", "<a href='?sw=potencial_comite&id_comite=".Encodear3($unico->id_comite)."' class='btn btn-success'>
        	<span class='blanco'>Ingresar</span></a>", $row_lista);
        
        if($perfil=="SOCIO DE NEGOCIO")    { 
        	$row_lista = str_replace("{BOTON_ELIMINAR_COMITE}", "<a href='?sw=potencial&id_del=".Encodear3($unico->id_comite)."' class='btn btn-link'>
        	<span class='azul_comite'><i class='fas fa-trash-alt'></i></span></a>", $row_lista);
      	}else {
      		$row_lista = str_replace("{BOTON_ELIMINAR_COMITE}", "", $row_lista);
      	}
    }
    //echo  "$row_lista";
    $PRINCIPAL = str_replace("{MIS_COMITES_POTENCIAL}",         $row_lista,         $PRINCIPAL);
    $PRINCIPAL = str_replace("{MIS_COMITES_POTENCIAL_TITULO}",  $potencial_titulo,  $PRINCIPAL);

    return ($PRINCIPAL);
}
function Potencial_Mis_Comites_estado_activo($PRINCIPAL, $rut, $perfil, $id_empresa, $comite_cierre,$periodo)
{		
	$Usua=DatosUsuario_($rut, $id_empresa);
    $lista = Potencial_Mis_Comites_data($id_empresa, $rut, $perfil, $Usua[0]->jefe,$periodo);

		$nomuestracabeceras="";
		if($perfil=="VISUALIZADOR"){
			$nomuestracabeceras="1";
		}    
    
    if($nomuestracabeceras=="1"){
    	$lider="";
    	$colab="";
    	
    } else {
    	$lider1="LIDER";
    	$colab="COLAB.";
    }
    $num_comites    =   count($lista);
    //echo "<br>num_comites $num_comites<br>";
    if($num_comites>0){
        $potencial_titulo="
        <br>
					<div class=''>
					    <strong>
					        <div class='col-sm-4 txt_title_pot'>COMITE</div>
					        <div class='col-sm-2 txt_title_pot'>FECHA REALIZACION</div>
					        <div class='col-sm-3 txt_title_pot'>".$lider1."</div>
					        <div class='col-sm-1 txt_title_pot'>".$colab."</div>
					        <div class='col-sm-2 txt_title_pot'>GESTIONAR</div>
					    </strong>
					</div>";
    }   else   {
        $potencial_titulo="
					<div class='row'>
					    <div class='col-sm-12 txt_title_pot'><br><br><center>[ No hay comit&eacute;s creados ]</center></div>
					</div>";
    }

    foreach($lista as $unico) {
			$num_colaboradores=0;

			$array_comite=Potencial_Comites_data($unico->id_comite,$id_empresa);
			//echo "<br>";				print_r($array_comite);			echo "<br>";
			
			$id_comite_cerrado = $array_comite[0]->comite_cerrado;
			//echo "<br>IdComite ".$unico->id_comite." comite cerrado ".$comite_cierre." id_comite_cerrado ".$id_comite_cerrado;
			
			if($comite_cierre=="cerrado" and $id_comite_cerrado<>"SI"){
				continue;
			}

			if($comite_cierre=="activo" and $id_comite_cerrado=="SI"){
				continue;
			}
			
    if($perfil=="LIDER")    {   $num_colaboradores=Potencial_Busca_Cantidad_Colaboradores_lider($rut, $unico->id_comite, $id_empresa);
                $Usua=DatosUsuario_($rut, $id_empresa);
                $lider= $Usua[0]->nombre_completo;
    }
    
    if($perfil=="SOCIO DE NEGOCIO")    {   $num_colaboradores=Potencial_Busca_Cantidad_Colaboradores_socio($rut, $unico->id_comite, $id_empresa);


			$lider="";
      $array_lideres=PotencialBuscaLideres($unico->id_comite, $id_empresa);
      //print_r($array_lideres);
      foreach ($array_lideres as $unlid){
          $nombr_l=DatosUsuario_($unlid->rut_lider, $id_empresa);
          $lider.=$nombr_l[0]->nombre_completo."<br>";
      }
    }
        //echo "<br>hola ".$unico->nombre;
        $row_lista.= file_get_contents("views/potencial/" . $id_empresa . "_potencial_row_comites.html");
        //echo "<br>views/potencial/" . $id_empresa . "_potencial_row_comites.html";
        $row_lista = str_replace("{ID_COMITE}", ($unico->id_comite), $row_lista);
        $row_lista = str_replace("{COMITE}", ($unico->nombre), $row_lista);
        $row_lista = str_replace("{FECHA}", $unico->fecha_comite, $row_lista);
        $row_lista = str_replace("{LIDER}", ($lider), $row_lista);
        
        
        $row_lista = str_replace("{COLABORADORES}", $num_colaboradores, $row_lista);

        $UsuaCreadorComite=DatosUsuario_($unico->socio, $id_empresa);
        $row_lista = str_replace("{POR_CREADOR_COMITE}", $UsuaCreadorComite[0]->nombre_completo, $row_lista);
        
        $row_lista = str_replace("{BOTON_VER_COMITE}", "<a href='?sw=potencial_comite&id_comite=".Encodear3($unico->id_comite)."' class='btn btn-success'>
        	<span class='blanco'>Ingresar</span></a>", $row_lista);
        
        if($perfil=="SOCIO DE NEGOCIO")    { 
        	$row_lista = str_replace("{BOTON_ELIMINAR_COMITE}", "<a href='?sw=potencial&id_del=".Encodear3($unico->id_comite)."' class='btn btn-link'>
        	<span class='azul_comite'><i class='fas fa-trash-alt'></i></span></a>", $row_lista);
      	}else {
      		$row_lista = str_replace("{BOTON_ELIMINAR_COMITE}", "", $row_lista);
      	}
    }
    //echo  "$row_lista";
    
    if($comite_cierre=="activo"){
    	$PRINCIPAL = str_replace("{MIS_COMITES_POTENCIAL}",         $row_lista,         $PRINCIPAL);
    	$PRINCIPAL = str_replace("{MIS_COMITES_POTENCIAL_TITULO}",  $potencial_titulo,  $PRINCIPAL);

    	
    } else {
    	$PRINCIPAL = str_replace("{MIS_COMITES_POTENCIAL}",         $row_lista,         $PRINCIPAL);
    	$PRINCIPAL = str_replace("{MIS_COMITES_POTENCIAL}",  				$potencial_titulo,  $PRINCIPAL);

    }

    return ($PRINCIPAL);
}
function Potencial_Mis_Comites_estado_cierre($PRINCIPAL, $rut, $perfil, $id_empresa, $comite_cierre,$periodo)
{
		$Usua=DatosUsuario_($rut, $id_empresa);
    $lista = Potencial_Mis_Comites_data($id_empresa, $rut, $perfil, $Usua[0]->jefe,$periodo);
    //print_r($lista);
    //echo "<br>comite_cierre $comite_cierre<br>";
    
		$nomuestracabeceras="";
		if($perfil=="VISUALIZADOR"){
			$nomuestracabeceras="1";
		}    
    
    if($nomuestracabeceras=="1"){
    	$lider="";
    	$colab="";
    	
    } else {
    	$lider1="LIDER";
    	$colab="COLAB.";
    }
    $num_comites    =   count($lista);
    //echo "<br>num_comites $num_comites<br>";
    if($num_comites>0){
        $potencial_titulo="
        <br>
<div class=''>
    <strong>
        <div class='col-sm-4 txt_title_pot'>COMITE</div>
        <div class='col-sm-2 txt_title_pot'>FECHA REALIZACION</div>
        <div class='col-sm-3 txt_title_pot'>".$lider1."</div>
        <div class='col-sm-1 txt_title_pot'>".$colab."</div>
        <div class='col-sm-2 txt_title_pot'>GESTIONAR</div>
    </strong>
</div>";
    }   else   {
        $potencial_titulo="
<div class='row'>
    <div class='col-sm-12 txt_title_pot'><br><br><center>[ No hay comit&eacute;s creados ]</center></div>
</div>";

    }

    foreach($lista as $unico) {
			$num_colaboradores=0;

			$array_comite=Potencial_Comites_data($unico->id_comite,$id_empresa);
			//echo "<br>";				print_r($array_comite);			echo "<br>";exit();
			
			$id_comite_cerrado = $array_comite[0]->comite_cerrado;
			//echo "<br>IdComite ".$unico->id_comite." comite cerrado ".$comite_cierre." id_comite_cerrado ".$id_comite_cerrado;
			
			if($comite_cierre=="cerrado" and $id_comite_cerrado<>"SI"){
				continue;
			}

			if($comite_cierre=="activo" and $id_comite_cerrado=="SI"){
				continue;
			}
			
    if($perfil=="LIDER")    {   $num_colaboradores=Potencial_Busca_Cantidad_Colaboradores_lider($rut, $unico->id_comite, $id_empresa);
                $Usua=DatosUsuario_($rut, $id_empresa);
                $lider= $Usua[0]->nombre_completo;
    }
    
    if($perfil=="SOCIO DE NEGOCIO")    {   $num_colaboradores=Potencial_Busca_Cantidad_Colaboradores_socio($rut, $unico->id_comite, $id_empresa);


			$lider="";
      $array_lideres=PotencialBuscaLideres($unico->id_comite, $id_empresa);
      //print_r($array_lideres);
      foreach ($array_lideres as $unlid){
          $nombr_l=DatosUsuario_($unlid->rut_lider, $id_empresa);
          $lider.=$nombr_l[0]->nombre_completo."<br>";
      }
    }
        //echo "<br>hola ".$unico->nombre;
        $row_lista.= file_get_contents("views/potencial/" . $id_empresa . "_potencial_row_comites.html");
        //echo "<br>views/potencial/" . $id_empresa . "_potencial_row_comites.html";
        $row_lista = str_replace("{ID_COMITE}", ($unico->id_comite), $row_lista);
        $row_lista = str_replace("{COMITE}", ($unico->nombre), $row_lista);
        $row_lista = str_replace("{FECHA}", $unico->fecha_comite, $row_lista);
        $row_lista = str_replace("{LIDER}", ($lider), $row_lista);
        $row_lista = str_replace("{COLABORADORES}", $num_colaboradores, $row_lista);
        
        $UsuaCreadorComite=DatosUsuario_($unico->socio, $id_empresa);
        $row_lista = str_replace("{POR_CREADOR_COMITE}", $UsuaCreadorComite[0]->nombre_completo, $row_lista);
        
        $row_lista = str_replace("{BOTON_VER_COMITE}", "<a href='?sw=potencial_comite&id_comite=".Encodear3($unico->id_comite)."' class='btn btn-success'>
        	<span class='blanco'>Ingresar</span></a>", $row_lista);
        
        if($perfil=="SOCIO DE NEGOCIO")    { 
        	$row_lista = str_replace("{BOTON_ELIMINAR_COMITE}", "<a href='?sw=potencial&id_del=".Encodear3($unico->id_comite)."' class='btn btn-link'>
        	<span class='azul_comite'><i class='fas fa-trash-alt'></i></span></a>", $row_lista);
      	}else {
      		$row_lista = str_replace("{BOTON_ELIMINAR_COMITE}", "", $row_lista);
      	}
    }
    //echo  "$row_lista";
    

    	$PRINCIPAL = str_replace("{MIS_COMITES_POTENCIAL2}",         $row_lista,         $PRINCIPAL);
    	$PRINCIPAL = str_replace("{MIS_COMITES_POTENCIAL_TITULO2}",  $potencial_titulo,  $PRINCIPAL);

 

    return ($PRINCIPAL);
}
function ColocaMetodologias($rut, $perfil, $id_empresa){
    $datos=DatosMEtodologia($id_empresa, $rut);
    if(count($datos)>0){
        foreach($datos as $dat){
             if($perfil=="jefe") {
             $total_datos_ingresados.= file_get_contents("views/assessment/" . $id_empresa . "_row_metodologia_lectura.html");

                 } else {
             $total_datos_ingresados.= file_get_contents("views/assessment/" . $id_empresa . "_row_metodologia.html");

                 }
            $total_datos_ingresados = str_replace("{METODOLOGIA}", ($dat->metodologia)." ".($dat->metodologia_otro), $total_datos_ingresados);

            $total_datos_ingresados = str_replace("{ID_ENCODEADO}", Encodear3($dat->id), $total_datos_ingresados);
            $total_datos_ingresados = str_replace("{TIPO_BLOQUE}", Encodear3("metodologia"), $total_datos_ingresados);


        }

    }else{

    }

    return($total_datos_ingresados);
}
function array_sort_by_column($arr, $col, $dir = SORT_ASC) {
    $sort_col = array();
    foreach ($arr as $key=> $row) {
        $sort_col[$key] = $row->$col;
    }

    array_multisort($sort_col, $dir, $arr);
}
function array_orderby()
{
    $args = func_get_args();
    $data = array_shift($args);
    foreach ($args as $n => $field) {
        if (is_string($field)) {
            $tmp = array();
            foreach ($data as $key => $row)
                $tmp[$key] = $row[$field];
            $args[$n] = $tmp;
            }
    }
    $args[] = &$data;
    call_user_func_array('array_multisort', $args);
    return array_pop($args);
}
function VistaRanking($PRINCIPAL, $id_empresa, $tipoc1c2c3c4, $id_programa, $id_foco, $orden, $jefe, $groupby)
{ // echo "<br />VistaRanking id empresa $id_empresa, tipo filtro $tipoc1c2c3c4, id programa $id_programa, orden $orden, jefe $jefe, groupby $groupby";
    // if($orden=="avance"){echo "orden por avance";}
    // if($orden=="puntos"){echo "orden por puntos";}
    // echo "<br />orden $orden";
    // echo "<br />id_programa $id_programa";
    // if($id_programa==""){echo "<br />filtro programas TODOS";} else {echo "<br />programa $id_programa";}
    // if($id_foco==""){echo "<br />filtro id foco TODOS";} else {echo "<br />id foco $id_foco";}
    // echo "<br />hola";
    if ($orden == "avance" and $tipoc1c2c3c4 == "") {
        $array_Rank_all = Ranking_desafios_avance_Data("", $id_programa, $id_foco, $id_empresa, $rut, $groupby);
        // echo "<pre>"; print_r($array_Rank_all);
    }
    if ($orden == "puntos" and $tipoc1c2c3c4 == "") {
        $array_Rank_all = Ranking_desafios_puntos_Data("", $id_programa, $id_foco, $id_empresa, $rut, $groupby);
        // echo "<pre>"; print_r($array_Rank_all);
    }
    if ($orden == "puntos" and $tipoc1c2c3c4 == "tipo_cargo") {
        $array_Rank_all = Ranking_desafios_puntos_Data("", "tipo_cargo", $id_programa, $id_empresa, $rut, $groupby);
        // echo "<pre>"; print_r($array_Rank_all);
    }
    if ($orden == "avance" and ($tipoc1c2c3c4 == "c1" or $tipoc1c2c3c4 == "c2" or $tipoc1c2c3c4 == "c3" or $tipoc1c2c3c4 == "c4")) {
        $array_Rank_all = Ranking_desafios_avance_C1C2C3C4_Data("", $id_programa, $id_foco, $id_empresa, $rut, $groupby);
        // echo "<pre>"; print_r($array_Rank_all);
    }
    if ($orden == "avance" and ($tipoc1c2c3c4 == "c1" or $tipoc1c2c3c4 == "c2" or $tipoc1c2c3c4 == "c3" or $tipoc1c2c3c4 == "c4")) {
        $array_Rank_all = Ranking_desafios_avance_C1C2C3C4_Data("", $id_programa, $id_foco, $id_empresa, $rut, $groupby);
        // echo "<pre>"; print_r($array_Rank_all);
    }
    //echo "<br>orden $orden tipoc1c2c3c4 $tipoc1c2c3c4";

    $avance = 0;
    $aprobacion = 0;
    foreach($array_Rank_all as $unico) {
        $cuenta_rank++;
        $datos_usuarios = TraeDatosBiografiayUsuario($unico->rut, $id_empresa);
        $avance = $unico->avance;
        $aprobacion = round(100 * $unico->num_aprobados / $unico->total_cursos);

        if ($orden == "avance" and $tipoc1c2c3c4 == "") {
            $row.= file_get_contents("views/ranking/" . $id_empresa . "_ranking_vistas_personas_avance.html");
        }
        if ($orden == "puntos" and $tipoc1c2c3c4 == "") {
            $row.= file_get_contents("views/ranking/" . $id_empresa . "_ranking_vistas_personas.html");
        }
        if ($orden == "puntos" and $tipoc1c2c3c4 == "tipo_cargo") {
            $row.= file_get_contents("views/ranking/" . $id_empresa . "_ranking_vistas_personas.html");
        }
        if ($orden == "avance" and ($tipoc1c2c3c4 == "c1" or $tipoc1c2c3c4 == "c2" or $tipoc1c2c3c4 == "c3" or $tipoc1c2c3c4 == "c4")) {
            $row.= file_get_contents("views/ranking/" . $id_empresa . "_ranking_vistas_gerencias.html");
        }
        $row = str_replace("{RANKING}", $cuenta_rank, $row);
        $row = str_replace("{NOMBRE_PERSONA}", ($datos_usuarios[0]->nombre_completo) , $row);
        $row = str_replace("{FOTO_PERSONA}", VerificaFotoPersonal($unico->rut) , $row);
        $row = str_replace("{CARGO}", ($datos_usuarios[0]->cargo) , $row);
        $row = str_replace("{GERENCIA}", ($datos_usuarios[0]->gerencia) , $row);
        $row = str_replace("{GERENCIA_C1C2C3C4}", ($unico->gerencia) , $row);
        $row = str_replace("{PUNTOS}", $unico->total_puntos, $row);
        $row = str_replace("{BADGES}", $unico->total_medallas, $row);
                $SaldoPuntosLG=premios_buscadatos($unico->rut, $id_empresa);
        $row = str_replace("{PUNTOS_CANJE_USUARIO}", $SaldoPuntosLG[0]->puntossaldo, $row);

        $row = str_replace("{AVANCE}", $unico->avance, $row);
    }
    if ($orden == "avance") {
        if ($tipoc1c2c3c4 == "") {
            $PRINCIPAL = str_replace("{RANKING_REAL_INDIVIDUAL_AVANCE_TOTAL}", $row, $PRINCIPAL);
        }
        if ($tipoc1c2c3c4 == "c1") {
            $PRINCIPAL = str_replace("{RANKING_C1_REAL_INDIVIDUAL_AVANCE_TOTAL}", $row, $PRINCIPAL);
        }
        if ($tipoc1c2c3c4 == "c2") {
            $PRINCIPAL = str_replace("{RANKING_C2_REAL_INDIVIDUAL_AVANCE_TOTAL}", $row, $PRINCIPAL);
        }
        if ($tipoc1c2c3c4 == "c3") {
            $PRINCIPAL = str_replace("{RANKING_C3_REAL_INDIVIDUAL_AVANCE_TOTAL}", $row, $PRINCIPAL);
        }
        if ($tipoc1c2c3c4 == "c4") {
            $PRINCIPAL = str_replace("{RANKING_C4_REAL_INDIVIDUAL_AVANCE_TOTAL}", $row, $PRINCIPAL);
        }
    }
    if ($orden == "puntos") {
        if ($tipoc1c2c3c4 == "") {
            $PRINCIPAL = str_replace("{RANKING_REAL_INDIVIDUAL_PUNTOS_TOTAL}", $row, $PRINCIPAL);
        }
        if ($tipoc1c2c3c4 == "tipo_cargo") {
            $PRINCIPAL = str_replace("{RANKING_REAL_INDIVIDUAL_PUNTOS_TIPO_CARGO_TOTAL}", $row, $PRINCIPAL);
        }
        if ($tipoc1c2c3c4 == "c1") {
            $PRINCIPAL = str_replace("{RANKING_C1_REAL_INDIVIDUAL_PUNTOS_TOTAL}", $row, $PRINCIPAL);
        }
        if ($tipoc1c2c3c4 == "c2") {
            $PRINCIPAL = str_replace("{RANKING_C2_REAL_INDIVIDUAL_PUNTOS_TOTAL}", $row, $PRINCIPAL);
        }
        if ($tipoc1c2c3c4 == "c3") {
            $PRINCIPAL = str_replace("{RANKING_C3_REAL_INDIVIDUAL_PUNTOS_TOTAL}", $row, $PRINCIPAL);
        }
        if ($tipoc1c2c3c4 == "c4") {
            $PRINCIPAL = str_replace("{RANKING_C4_REAL_INDIVIDUAL_PUNTOS_TOTAL}", $row, $PRINCIPAL);
        }
    }
    return ($PRINCIPAL);
}
function validateDate($date, $format = 'Y-m-d')
{
if (DateTime::createFromFormat('Y-m-d', $date) !== FALSE) {
    // it's a date
    return("SI");
}
}
function FechaaNombredia($date){

//Convert the date string into a unix timestamp.
$unixTimestamp = strtotime($date);
//Get the day of the week using PHP's date function.
$dayOfWeek = date("l", $unixTimestamp);
//Print out the day that our date fell on.
//echo $date . ' fell on a ' . $dayOfWeek;


if($dayOfWeek=="Sunday")    {$dia="DO";}
if($dayOfWeek=="Monday")    {$dia="LU";}
if($dayOfWeek=="Tuesday")    {$dia="MA";}
if($dayOfWeek=="Wednesday")    {$dia="MI";}
if($dayOfWeek=="Thursday")    {$dia="JU";}
if($dayOfWeek=="Friday")    {$dia="VI";}
if($dayOfWeek=="Saturday")    {$dia="SA";}


        return $dia;

}
function BuscaCursosPrograma($PRINCIPAL, $id_programa, $id_empresa){
        $rut=$_SESSION["user_"];
        $array_cursos=BuscaCursosProgramaData($id_programa, $id_empresa);

        foreach ($array_cursos as $list) {
            $i++;
                $verificaEstadoCursoArray=VerificaEstadoCursoRut($rut, $list->id_curso, $id_empresa);
                 //print_r($verificaEstadoCursoArray);

                if($verificaEstadoCursoArray<>100){$estado="<span class='badge badge-info'>Pendiente</span>";}
                if($verificaEstadoCursoArray==100){$estado="<span class='badge badge-success'>Realizado</span>";}



            //print_r($list);
            $row .= file_get_contents("views/templates/bci_intnova_row_cursos.html");
            $row = str_replace("{ID_CURSO_ENCODEADO}",         Encodear3($list->id_curso), $row);
            $row = str_replace("{NOMBRE_CAPSULA}",         ($list->nombre_curso), $row);
            $row = str_replace("{DESCRIPCION_CAPSULA}", ($list->descripcion_curso), $row);
            $row = str_replace("{IMAGEN_CAPSULA}",         ($list->imagen_curso), $row);
            $row = str_replace("{AVANCE}",         ($verificaEstadoCursoArray), $row);
            $row = str_replace("{ESTADO}",         ($estado), $row);

            }


    $PRINCIPAL = str_replace("{BCI_NOVA_LISTA_CAPSULAS}", $row, $PRINCIPAL);

    return ($PRINCIPAL);



}
function Seguimiento_BloqueArchivosAdjuntos    ($PRINCIPAL, $id_empresa, $id_registro){
    $datos_registro=SEGUIMIENTO_DatosRegistroSoloId($id_empresa, $id_registro);

    $contador=0;

        if($datos_registro[0]->archivo1){ $listado_archivos.="<label class='col-md-12 control-label'><a target='_blank' class='btn btn-info' href='documentos_hotline/".$datos_registro[0]->archivo1."'>Archivo N?1 >></a></label><br>"; $contador++; }
        if($datos_registro[0]->archivo2){ $listado_archivos.="<label class='col-md-12 control-label'><a target='_blank' class='btn btn-info' href='documentos_hotline/".$datos_registro[0]->archivo2."'>Archivo N?2 >></a></label><br>"; $contador++; }
        if($datos_registro[0]->archivo3){ $listado_archivos.="<label class='col-md-12 control-label'><a target='_blank' class='btn btn-info' href='documentos_hotline/".$datos_registro[0]->archivo3."'>Archivo N?3 >></a></label><br>"; $contador++; }
        if($datos_registro[0]->archivo4){ $listado_archivos.="<label class='col-md-12 control-label'><a target='_blank' class='btn btn-info' href='documentos_hotline/".$datos_registro[0]->archivo4."'>Archivo N?4 >></a></label><br>"; $contador++; }
        if($datos_registro[0]->archivo5){ $listado_archivos.="<label class='col-md-12 control-label'><a target='_blank' class='btn btn-info' href='documentos_hotline/".$datos_registro[0]->archivo5."'>Archivo N?5 >></a></label><br>"; $contador++; }

    if($contador==0){
        $PRINCIPAL = str_replace("{BLOQUE_ARCHIVOS_ADJUNTOS}", "No existen Archivos Adjuntos", $PRINCIPAL);
    }else{
        $PRINCIPAL = str_replace("{BLOQUE_ARCHIVOS_ADJUNTOS}", $listado_archivos, $PRINCIPAL);
    }

    return($PRINCIPAL);
}
function allCuiPorEmpresa($buscar, $id_empresa)
{
    $dataPersonas = allCuiData($buscar, $id_empresa);
    if ($dataPersonas) {
        foreach ($dataPersonas as $dataPersonas_aux) {
            echo ($dataPersonas_aux->area) . "   " . ($buscar) . " " . ($dataPersonas_aux->amaterno) . " " . "|" . $dataPersonas_aux->rut . "\n";
            //echo ($dataPersonas_aux->nombre)."\n";
        }
    } else {
        $data = 'No Existe este CUI';
    }
    return $data;
}
function allCuiPorNombreOficina($buscar, $id_empresa)
{
    $dataPersonas = allCuiOficData($buscar, $id_empresa);
    //print_r($dataPersonas);
    if ($dataPersonas) {
        foreach ($dataPersonas as $dataPersonas_aux) {
            $data=($dataPersonas_aux->id_gerencia) . " " . ($dataPersonas_aux->sucursal) . "";
            //echo ($dataPersonas_aux->nombre)."\n";
        }
    } else {
        $data = 'No Existe CUI';
    }
   // print_r($data);exit();
    return $data;
}
function allPersonasPorNombreCargoPorEmpresa($buscar, $id_empresa, $rut)
{
    //$datos_usuario=UsuarioEnBasePersonas($rut);
    //$dataPersonas = allPersonasPorEmpresa($buscar, $id_empresa);
    $buscar       = LimpiaRutFront($buscar);
    $dataPersonas = allPersonasPorEmpresa($buscar, $id_empresa, $datos_usuario[0]->gerencia);
    if ($dataPersonas) {
        foreach ($dataPersonas as $dataPersonas_aux) {
            echo ($dataPersonas_aux->nombre_completo) . " / " . ($dataPersonas_aux->cargo) . " " . ($dataPersonas_aux->rut_completo) . "" . "|" . $dataPersonas_aux->rut . "" . "|" . $dataPersonas_aux->local . "\n";
            //echo ($dataPersonas_aux->nombre)."\n";
        }
    } else {
        $data = 'No Existe este nombre';
    }
    return $data;
}
function allPersonasPorNombreCargoPorEmpresaSinDivPersonas($buscar, $id_empresa, $rut)
{
    //$datos_usuario=UsuarioEnBasePersonas($rut);
    //$dataPersonas = allPersonasPorEmpresa($buscar, $id_empresa);
    $buscar       = LimpiaRutFront($buscar);
    $dataPersonas = allPersonasPorEmpresaSinDivPersona($buscar, $id_empresa, $datos_usuario[0]->gerencia);
    if ($dataPersonas) {
        foreach ($dataPersonas as $dataPersonas_aux) {
            echo ($dataPersonas_aux->nombre_completo) . " " . ($dataPersonas_aux->rut_completo) . "" . "|" . $dataPersonas_aux->rut . "" . "|" . $dataPersonas_aux->local . "\n";
            //echo ($dataPersonas_aux->nombre)."\n";
        }
    } else {
        $data = 'No Existen Resultados';    }
    return $data;
}
function allPersonasPorNombreCargoPorEmpresaSinDivPersonasJefe($buscar, $id_empresa, $rut)
{
    //$datos_usuario=UsuarioEnBasePersonas($rut);
    //$dataPersonas = allPersonasPorEmpresa($buscar, $id_empresa);
    $buscar       = LimpiaRutFront($buscar);
    $dataPersonas = allPersonasPorEmpresaSinDivPersonaJefe($buscar, $id_empresa, $datos_usuario[0]->gerencia);
    if ($dataPersonas) {
        foreach ($dataPersonas as $dataPersonas_aux) {
            echo ($dataPersonas_aux->nombre_completo) . " " . ($dataPersonas_aux->rut_completo) . "" . "|" . $dataPersonas_aux->rut . "" . "|" . $dataPersonas_aux->local ." ". $dataPersonas_aux->unidad_negocio. "    \n";
            //echo ($dataPersonas_aux->nombre)."\n";
        }
    } else {
        $data = 'No Existen Resultados';
    }
    return $data;
}
function RO_BuscaEstadoCursos($id_malla, $id_empresa, $rut, $PRINCIPAL)
{
    $arreglo_cursos = Ro_escuela_busca_cursosmalla($id_malla, $id_empresa);
    //echo "<br>";                print_r($arreglo_cursos);            echo "<br>";
    foreach ($arreglo_cursos as $arreglo_curso) {
        $arreglo = CAPACITACION_ObtenerEstadoAvanceCurso($rut, $arreglo_curso->id_curso, "", $id_empresa);
        if ($arreglo[4] >= 100) {
            $PRINCIPAL = str_replace("{ESTADO_" . $arreglo_curso->id_curso . "}", "Curso Realizado", $PRINCIPAL);
            $PRINCIPAL = str_replace("{ESTILO_ESCRO_" . $arreglo_curso->id_curso . "}", "fbox-icon-success", $PRINCIPAL);
            $PRINCIPAL = str_replace("{ICONO_ESCRO_" . $arreglo_curso->id_curso . "}", "icon-check", $PRINCIPAL);
        } elseif ($arreglo[4] > 0 and $arreglo[4] < 100) {
            $PRINCIPAL = str_replace("{ESTADO_" . $arreglo_curso->id_curso . "}", "Curso en Proceso", $PRINCIPAL);
            $PRINCIPAL = str_replace("{ESTILO_ESCRO_" . $arreglo_curso->id_curso . "}", "fbox-icon-warning", $PRINCIPAL);
            $PRINCIPAL = str_replace("{ICONO_ESCRO_" . $arreglo_curso->id_curso . "}", "icon-laptop", $PRINCIPAL);
        } else {
            $PRINCIPAL = str_replace("{ESTADO_" . $arreglo_curso->id_curso . "}", "Curso no Iniciado", $PRINCIPAL);
            $PRINCIPAL = str_replace("{ESTILO_ESCRO_" . $arreglo_curso->id_curso . "}", "fbox-icon", $PRINCIPAL);
            $PRINCIPAL = str_replace("{ICONO_ESCRO_" . $arreglo_curso->id_curso . "}", "icon-laptop", $PRINCIPAL);
        }
        //echo "<br>".$arreglo_curso->id_curso." rut ".$rut;
        //echo "<br>";
        //print_r($arreglo);
    }
    return ($PRINCIPAL);
}
function VerificaArregloSQLInjection($arreglo)
{
    //print_R($arreglo);
    //echo "aca";
    $flag          = "Todo Bien";
    //veo si es un arreglo
    $total_arreglo = count($arreglo);

    foreach ($arreglo as $clave => $valor) {
        //echo "El valor de $clave es: $valor<br><br>";
        //lo paso por la tabla de sql_injection
        if (strtoupper(trim($valor)) == "") {
            continue;
        }
        $valor = str_replace("'", "", $valor);
        $valor = str_replace('"', "", $valor);
        $valor = str_replace("+'", "", $valor);
        $valor = str_replace('--', "", $valor);





        $palabra_injection = buscaPalabraSqlInjection(strtoupper(trim($valor)));
        if ($palabra_injection) {
            //echo "<br><span class='badge_small badge-azul'> SQL INJECTION</span><br>";
            //echo $arreglo[$clave];
            $arreglo[$clave] = "";
            //echo "variable limpiada ".$arreglo[$clave]." <- <br>";
            //exit;
        } else {
            //Ahora traigo todas las palabras de la tabla, y las busco si estan, s
            $palabras = TraePalabraSqlInjection();
            foreach ($palabras as $pal) {
                $arreglo[$clave] = str_replace($pal->palabra, "", $arreglo[$clave]);
                $arreglo[$clave] = str_replace(strtoupper($pal->palabra), "", $arreglo[$clave]);
                $arreglo[$clave] = str_replace(strtolower($pal->palabra), "", $arreglo[$clave]);
            }
            //echo "<br>";
        }
    }
    exit;
    return ($arreglo);
}
function fechaCastellano($fecha)
{
    $fecha     = substr($fecha, 0, 10);
    $numeroDia = date('d', strtotime($fecha));
    $dia       = date('l', strtotime($fecha));
    $mes       = date('F', strtotime($fecha));
    $anio      = date('Y', strtotime($fecha));
    $dias_ES   = array(
        "Lunes",
        "Martes",
        "Mi?rcoles",
        "Jueves",
        "Viernes",
        "S?bado",
        "Domingo"
    );
    $dias_EN   = array(
        "Monday",
        "Tuesday",
        "Wednesday",
        "Thursday",
        "Friday",
        "Saturday",
        "Sunday"
    );
    $nombredia = str_replace($dias_EN, $dias_ES, $dia);
    $meses_ES  = array(
    "Enero",
        "Febrero",
        "Marzo",
        "Abril",
        "Mayo",
        "Junio",
        "Julio",
        "Agosto",
        "Septiembre",
        "Octubre",
        "Noviembre",
        "Diciembre"
    );
    $meses_EN  = array(
        "January",
        "February",
        "March",
        "April",
        "May",
        "June",
        "July",
        "August",
        "September",
        "October",
        "November",
        "December"
    );
    $nombreMes = str_replace($meses_EN, $meses_ES, $mes);
    return $nombredia . " " . $numeroDia . " de " . $nombreMes . " de " . $anio;
}
function fechaCastellano2($fecha)
{
    $fecha     = substr($fecha, 0, 10);
    $numeroDia = date('d', strtotime($fecha));
    $dia       = date('l', strtotime($fecha));
    $mes       = date('F', strtotime($fecha));
    $anio      = date('Y', strtotime($fecha));
    $dias_ES   = array(
        "Lunes",
        "Martes",
        "Mi?rcoles",
        "Jueves",
        "Viernes",
        "S?bado",
        "Domingo"
    );
    $dias_EN   = array(
        "Monday",
        "Tuesday",
        "Wednesday",
        "Thursday",
        "Friday",
        "Saturday",
        "Sunday"
    );
    $nombredia = str_replace($dias_EN, $dias_ES, $dia);
    $meses_ES  = array(
    "Enero",
        "Febrero",
        "Marzo",
        "Abril",
        "Mayo",
        "Junio",
        "Julio",
        "Agosto",
        "Septiembre",
        "Octubre",
        "Noviembre",
        "Diciembre"
    );
    $meses_EN  = array(
        "January",
        "February",
        "March",
        "April",
        "May",
        "June",
        "July",
        "August",
        "September",
        "October",
        "November",
        "December"
    );
    $nombreMes = str_replace($meses_EN, $meses_ES, $mes);
    return $numeroDia . " de " . $nombreMes . " de " . $anio;
}
function ColocaEstadosPorClasificacion($PRINCIPAL, $rut, $id_malla, $id_empresa)
{
    //Traigo las clasificaciones de esta malla de la rel_lms_malla_curso
    $clasificaciones = ClasificacionesPorMalla($id_empresa, $id_malla);
    foreach ($clasificaciones as $clas) {
        //Ahora por cada clasificacion, traigo los cursos de esta malla
        $cursos                              = CursosPorClasificacionesMalla($id_empresa, $id_malla, $clas->id_clasificacion);
        $acumulador_avance_por_clasificacion = 0;
        foreach ($cursos as $curso) {
            //Traigo los avances por dimensiones desde la tabla cierre
            $datos_cierre                        = DatosInscripcioncierreRutCursoEmpresa($rut, $curso->id_curso, $id_empresa);
            $acumulador_avance_por_clasificacion = $acumulador_avance_por_clasificacion + $datos_cierre[0]->avance;
        }
        $avance    = round($acumulador_avance_por_clasificacion / count($cursos));
        $PRINCIPAL = str_replace("{AVANCE_" . $clas->id_clasificacion . "}", $avance, $PRINCIPAL);
        if ($avance == 100) {
            $PRINCIPAL = str_replace("{ICONO_" . $clas->id_clasificacion . "}", "<img src='img/ok.png'>", $PRINCIPAL);
        } else {
            $PRINCIPAL = str_replace("{ICONO_" . $clas->id_clasificacion . "}", "", $PRINCIPAL);
        }
    }
    return ($PRINCIPAL);
}
function ColocaEstadColocaEstadosPorClasificacionOrderSlider($PRINCIPAL, $rut, $id_malla, $id_empresa)
{
    //Traigo las clasificaciones de esta malla de la rel_lms_malla_curso
    $clasificaciones = ClasificacionesPorMalla($id_empresa, $id_malla);
    foreach ($clasificaciones as $clas) {
        $contador++;
        //Ahora por cada clasificacion, traigo los cursos de esta malla
        $cursos                              = CursosPorClasificacionesMalla($id_empresa, $id_malla, $clas->id_clasificacion);
        $acumulador_avance_por_clasificacion = 0;
        foreach ($cursos as $curso) {
            //Traigo los avances por dimensiones desde la tabla cierre
            $datos_cierre                        = DatosInscripcioncierreRutCursoEmpresa($rut, $curso->id_curso, $id_empresa);
            $acumulador_avance_por_clasificacion = $acumulador_avance_por_clasificacion + $datos_cierre[0]->avance;
        }
        $avance_array[$contador] = round($acumulador_avance_por_clasificacion / count($cursos));
    }
    if ($avance_array[1] < "100") {
        $row_slider .= file_get_contents("views/templates/tc_slider1.html");
        $row_slider .= file_get_contents("views/templates/tc_slider2.html");
        $row_slider .= file_get_contents("views/templates/tc_slider3.html");
        $row_slider .= file_get_contents("views/templates/tc_slider4.html");
    }
    if ($avance_array[1] == "100") {
        $row_slider .= file_get_contents("views/templates/tc_slider2.html");
        $row_slider .= file_get_contents("views/templates/tc_slider3.html");
        $row_slider .= file_get_contents("views/templates/tc_slider4.html");
        $row_slider .= file_get_contents("views/templates/tc_slider1.html");
    }
    if ($avance_array[2] == "100") {
        $row_slider .= file_get_contents("views/templates/tc_slider3.html");
        $row_slider .= file_get_contents("views/templates/tc_slider4.html");
        $row_slider .= file_get_contents("views/templates/tc_slider1.html");
        $row_slider .= file_get_contents("views/templates/tc_slider2.html");
    }
    if ($avance_array[3] == "100") {
        $row_slider .= file_get_contents("views/templates/tc_slider4.html");
        $row_slider .= file_get_contents("views/templates/tc_slider1.html");
        $row_slider .= file_get_contents("views/templates/tc_slider2.html");
        $row_slider .= file_get_contents("views/templates/tc_slider3.html");
    }
    if ($avance_array[4] == "100") {
        $row_slider .= file_get_contents("views/templates/tc_slider1.html");
        $row_slider .= file_get_contents("views/templates/tc_slider2.html");
        $row_slider .= file_get_contents("views/templates/tc_slider3.html");
        $row_slider .= file_get_contents("views/templates/tc_slider4.html");
    }
    return $row_slider;
}
function buscaarrobadomain($texto, $id_mp, $rut, $id_empresa)
{
   // echo "<br>texto $texto";
    $porciones = explode("@", $texto);
   // print_R($porciones);   sleep(2);

    for ($i = 0; $i < count($porciones); $i++) {
           //echo   "<br>porciones ".$porciones[$i];
            $texto=str_replace(' ', '_', $texto);
            $texto=str_replace(',', '_', $texto);
            $texto=str_replace(';', '_', $texto);
            $texto=str_replace('-', '_', $texto);
            $texto=str_replace('_', '_', $texto);
                    $porcionesX = explode("_", $texto);
                    for ($j = 0; $j < count($porcionesX); $j++) {
                     // echo   "<br>porciones X ".$porcionesX[$j];
                     if(substr( $porcionesX[$j], 0, 1 ) === "@"){
                       // echo $porcionesX[$j];

                       $arreglo[]= $porcionesX[$j];

                      }

                    }

                    //echo "<br> arreglo";



        }
    $i=0;
    $arreglo=(array_unique($arreglo));
    //print_r($arreglo);
    foreach ($arreglo as $unico){
       // echo "UNICO $unico";
      $tagueados[$i] = SaveMpTagPeople($unico, $id_mp, $rut, $id_empresa);
      $i++;
    }
                    // echo "<br>";sleep(4);


      // print_r($tagueados); exit();

        return $tagueados;
}
function SendGrid_Email($to, $nombreto, $from, $nombrefrom, $tipo, $subject, $titulo1, $subtitulo1, $texto1, $url,
$texto_url, $texto2, $texto3, $texto4, $logo, $id_empresa, $url2, $tipomensaje, $rut, $key, $otro_template)
{


 if($tipo==""){$tipo="text/html";}

 if($id_empresa==""){
        $id_empresa = $_SESSION["id_empresa"];
    }

  //echo $otro_template;


        $message = file_get_contents("views/emails_notificaciones/" . $id_empresa . "_template_notificacion.html");
        //echo " template normal ";
       // echo "/views/emails_notificaciones/" . $id_empresa . "_template_notificacion.html";

  

//   echo "<br>";
 //  echo "https://".$_SERVER['SERVER_NAME']."/front/views/emails_notificaciones/".$id_empresa."_template_notificacion.html";
  // echo "<br>";


 /* echo "<br>SendGrid_Email<br>
     <br>to $to,
     <br>nombreto $nombreto,
     <br>from $from, <br>nombrefrom $nombrefrom,
     <br> tipo $tipo,<br>
     subject $subject,<br> titulo1 $titulo1,
     <br> subtitulo1 $subtitulo1,<br>texto1 $texto1,<br>url $url,<br>txto url $texto_url,
     <br>texto2 $texto2, <br>texto3 $texto3, <br>texto4 $texto4, <br>logo $logo, <br>id_empresa $id_empresa, <br>url $url, <br>tipomensaje $tipomensaje,<br>    rut $rut,
     <br>key $key,<br>otro_template $otro_template";
   */

    $message = str_replace("{TITULO1}", $titulo1, $message);
    $message = str_replace("{SUBTITULO1}", $subtitulo1, $message);
    $message = str_replace("{TEXTO1}", $texto1, $message);
    $message = str_replace("{URL}", $url, $message);
    $message = str_replace("{TEXTO_URL}", $texto_url, $message);
    $message = str_replace("{TEXTO2}", $texto2, $message);
    $message = str_replace("{TEXTO3}", $texto3, $message);
    $message = str_replace("{TEXTO4}", $texto4, $message);
    $message = str_replace("{LOGO}", $logo, $message);

    //echo "<br>mensaje<br><br>$message";
   /* require("script/sendgrid-php/sendgrid-php.php");
    global $from_2022,$nombrefrom_2022,$api_key_2022;
    $from       = new SendGrid\Email($nombrefrom_2022, $from_2022);
    $to         = new SendGrid\Email($nombreto, $to);
    $content    = new SendGrid\Content($tipo, $message);
    $mail       = new SendGrid\Mail($from, $subject, $to, $content);
    $apiKey     = $api_key_2022;
    $sg         = new \SendGrid($apiKey);
    $response   = $sg->client->mail()->send()->post($mail);


    $statuscode = $response->statusCode();
    $headers    = $response->headers();
    $body       = $response->body();
    $fecha      = date("Y-m-d");*/
/*
echo "<br><br>statuscode_";    print_r($statuscode);
echo "<br><br>headers_";        print_r($headers);
echo "<br><br>body_";       print_r($body);
exit();*/

SaveLogEmails($id_empresa, $tipo, $subject, $to, $nombreto, $fecha, $statuscode, $headers, $body, $tipomensaje, $rut, $key);
}
function SendGrid_Email_template($to, $nombreto, $from, $nombrefrom, $tipo, $subject, $titulo1, $subtitulo1, $texto1, $url, $texto_url, $texto2, $texto3, $texto4, $logo, $id_empresa, $url2, $tipomensaje, $rut, $key, $template)
{

      if($id_empresa==""){ $id_empresa = $_SESSION["id_empresa"];}

    //$to="rod@gop.cl";

// echo "<br>SendGrid_Email_template<br><br>to $to, nombre $nombreto, from $from, nombre $nombrefrom, tipo $tipo,<br>
// subject $subject, titulo1 $titulo1, subtitulo1 $subtitulo1, t1 $texto1,url $url, texto url $texto_url, texto2 $texto2,
// texto3 $texto3, texto4 $texto4,
// logo $logo, idempresa $id_empresa, url $url, tipomensaje $tipomensaje, rut $rut, key $key template $template";
 //echo "<br>";    echo "https://".$_SERVER['SERVER_NAME']."/front/views/emails_notificaciones/".$id_empresa."_template_notificacion.html";    echo "<br>";

    $message = file_get_contents("".$template."");
    //echo "<br>message url $message";
    $message = str_replace("{TITULO1}", $titulo1, $message);
    $message = str_replace("{SUBTITULO1}", $subtitulo1, $message);
    $message = str_replace("{TEXTO1}", $texto1, $message);
    $message = str_replace("{URL}", $url, $message);
    $message = str_replace("{TEXTO_URL}", $texto_url, $message);
    $message = str_replace("{TEXTO2}", $texto2, $message);
    $message = str_replace("{TEXTO3}", $texto3, $message);
    $message = str_replace("{TEXTO4}", $texto4, $message);
    $message = str_replace("{LOGO}", $logo, $message);

    require("script/sendgrid-php/sendgrid-php.php");
    global $from_2022,$nombrefrom_2022,$api_key_2022;
    $from       = new SendGrid\Email($nombrefrom_2022, $from_2022);
    $to         = new SendGrid\Email($nombreto, $to);
    $content    = new SendGrid\Content($tipo, $message);
    $mail       = new SendGrid\Mail($from, $subject, $to, $content);
    $apiKey     = $api_key_2022;
    $sg         = new \SendGrid($apiKey);
    $response   = $sg->client->mail()->send()->post($mail);
    $statuscode = $response->statusCode();
    $headers    = $response->headers();
    $body       = $response->body();
    $fecha      = date("Y-m-d");

    //echo "<br><br>statuscode_";    print_r($statuscode);   echo "<br><br>headers_";    print_r($headers);    echo "<br><br>body_";    print_r($body); sleep(10);
    SaveLogEmails($id_empresa, $tipo, $subject, $to, $nombreto, $fecha, $statuscode, $headers, $body, $tipomensaje, $rut, $key);
}
function SendGrid_Email_Gcloud($to, $nombreto, $from, $nombrefrom, $tipo, $subject, $titulo1, $subtitulo1, $texto1, $url, $texto_url, $texto2, $texto3, $texto4, $logo, $id_empresa, $url2, $tipomensaje, $rut, $key)
{

    //echo "ro $to, $nombreto, $from, $nombrefrom, $tipo, $subject, $titulo1,$subtitulo1,$texto1,$url,$texto_url, $texto2, $texto3, $texto4, $logo, $id_empresa, $url,$tipomensaje, $rut, $key";
    $message = file_get_contents("https://gcloud.cl/front/views/emails_notificaciones/gcloud_template_notificacion.html");
    //$message =file_get_contents("views/emails_notificaciones/gcloud_template_notificacion.html");
    $message = str_replace("{TITULO1}", $titulo1, $message);
    $message = str_replace("{SUBTITULO1}", $subtitulo1, $message);
    $message = str_replace("{TEXTO1}", $texto1, $message);
    $message = str_replace("{URL}", $url, $message);
    $message = str_replace("{TEXTO_URL}", $texto_url, $message);
    $message = str_replace("{TEXTO2}", $texto2, $message);
    $message = str_replace("{TEXTO3}", $texto3, $message);
    $message = str_replace("{TEXTO4}", $texto4, $message);
    $message = str_replace("{LOGO}", $logo, $message);
    require("script/sendgrid-php/sendgrid-php.php");
    global $from_2022,$nombrefrom_2022,$api_key_2022;
    $from       = new SendGrid\Email($nombrefrom_2022, $from_2022);
    $to         = new SendGrid\Email($nombreto, $to);
    $content    = new SendGrid\Content($tipo, $message);
    $mail       = new SendGrid\Mail($from, $subject, $to, $content);
    $apiKey     = $api_key_2022;

    $sg         = new \SendGrid($apiKey);
    $response   = $sg->client->mail()->send()->post($mail);
    //echo "$message";
    $statuscode = $response->statusCode();
    $headers    = $response->headers();
    $body       = $response->body();
    $fecha      = date("Y-m-d");
    //echo "<br><br>statuscode_";
    //print_r($statuscode);
    //echo "<br><br>headers_";
    //print_r($headers);
    //echo "<br><br>tipo_";
    //print_r($tipo);
    //echo "<br><br>body_";
    //print_r($body);
    sleep(3);
    SaveLogEmails($id_empresa, $tipo, $subject, $to, $nombreto, $fecha, $statuscode, $headers, $body, $tipomensaje, $rut, $key);
}
function ColocaCheckPorDia($PRINCIPAL, $id_empresa, $rut_jefe, $rut_colaborador, $dia)
{
    $datos_colaborador = UsuarioEnBasePersonas($rut_colaborador);
    $PRINCIPAL         = str_replace("{NOMBRE_COLABORADOR_CHECK}", $datos_colaborador[0]->nombre_completo, $PRINCIPAL);
    $PRINCIPAL         = str_replace("{DIA}", $dia, $PRINCIPAL);
    $PRINCIPAL         = str_replace("{RUT_COLABORADOR}", $rut_colaborador, $PRINCIPAL);
    $PRINCIPAL         = str_replace("{DIA}", $dia, $PRINCIPAL);
    $actividades       = CHECK_LIST_PreguntasPorDia($dia);
    $titulo            = "";
    foreach ($actividades as $act) {
        if ($titulo <> $act->actividad) {
            $row_actividad .= file_get_contents("views/home/home_esc_bp_jof_pregunta_titulo.html");
            $row_actividad = str_replace("{TITULO}", $act->actividad, $row_actividad);
            $titulo        = $act->actividad;
        } else {
            $titulo = $act->actividad;
        }
        $row_actividad .= file_get_contents("views/home/home_esc_bp_jof_pregunta.html");
        $row_actividad = str_replace("{PAUTA_OBSERVACION}", $act->pauta, $row_actividad);
        $row_actividad = str_replace("{ID_ACTIVIDAD}", $act->id, $row_actividad);
    }
    $PRINCIPAL = str_replace("{BLOQUE_CHECK_LIST}", ($row_actividad), $PRINCIPAL);
    return ($PRINCIPAL);
}
function ColocaColaboradoresDeCampoLider($PRINCIPAL, $id_empresa, $rut_lider)
{
    $colaboradores = LIDER_Colaboradores($rut_lider, $id_empresa);
    foreach ($colaboradores as $col) {
        $row_equipo .= file_get_contents("views/mi_equipo_lider/" . $id_empresa . "_row_equipo_campo_lider.html");
        $malla_colaborador = LMSMallaEcuelaBP($col->rut, $id_empresa);
        $row_equipo        = str_replace("{NOMBRE}", $col->nombre_completo, $row_equipo);
        $row_equipo        = str_replace("{CARGO}", $col->cargo, $row_equipo);
        $row_equipo        = str_replace("{GERENCIA}", $col->gerencia, $row_equipo);
        if ($malla_colaborador[0]->id_malla == "bci_escbp_ola7") {
            $row_equipo = str_replace("{LINK_EVALUACION}", "
            <a href='?sw=checjof&d=" . Encodear3(11) . "&re=" . Encodear3($col->rut) . "' style='color:#000000'>Check Dia 1</a><br>
            <a href='?sw=checjof&d=" . Encodear3(12) . "&re=" . Encodear3($col->rut) . "' style='color:#000000'>Check Dia 2</a><br>
            <a href='?sw=checjof&d=" . Encodear3(13) . "&re=" . Encodear3($col->rut) . "' style='color:#000000'>Check Dia 3</a><br>
            <a href='?sw=checjof&d=" . Encodear3(14) . "&re=" . Encodear3($col->rut) . "' style='color:#000000'>Check Dia 4</a><br>
            <a href='?sw=checjof&d=" . Encodear3(15) . "&re=" . Encodear3($col->rut) . "' style='color:#000000'>Check Dia 5</a><br>
            <a href='?sw=checjof&d=" . Encodear3(16) . "&re=" . Encodear3($col->rut) . "' style='color:#000000'>Check Dia 6</a><br>
            <a href='?sw=checjof&d=" . Encodear3(17) . "&re=" . Encodear3($col->rut) . "' style='color:#000000'>Check Dia 7</a><br>
            <br>
            ", $row_equipo);
        } else {
            $row_equipo = str_replace("{LINK_EVALUACION}", "
            <a href='?sw=checjof&d=" . Encodear3(1) . "&re=" . Encodear3($col->rut) . "' style='color:#000000'>Check Dia 1</a><br>
            <a href='?sw=checjof&d=" . Encodear3(2) . "&re=" . Encodear3($col->rut) . "' style='color:#000000'>Check Dia 2</a><br>
            <a href='?sw=checjof&d=" . Encodear3(3) . "&re=" . Encodear3($col->rut) . "' style='color:#000000'>Check Dia 3</a><br>
            <a href='?sw=checjof&d=" . Encodear3(4) . "&re=" . Encodear3($col->rut) . "' style='color:#000000'>Check Dia 4</a><br>
            <a href='?sw=checjof&d=" . Encodear3(5) . "&re=" . Encodear3($col->rut) . "' style='color:#000000'>Check Dia 5</a><br>
            <a href='?sw=checjof&d=" . Encodear3(6) . "&re=" . Encodear3($col->rut) . "' style='color:#000000'>Check Dia 6</a><br>
            <br>
            ", $row_equipo);
        }
        $row_equipo = str_replace("{URL_PERSONA}", VerificaFotoPersonal($col->rut), $row_equipo);
    }
    $PRINCIPAL = str_replace("{ROW_COLABORADORES}", $row_equipo, $PRINCIPAL);
    return ($PRINCIPAL);
}
function ColocaLinksPorPEstanas($PRINCIPAL, $rut_embajador, $rut_r2, $id_empresa)
{
    $datos_reunion_inicial       = EMBAJADORES_DatosPlanReunionInicial($id_empresa, $rut_embajador, $rut_r2);
    $estado_embajador            = ObtenerPorcentajeAvanceSemana3($datos_reunion_inicial[0]->rut, $id_empresa, $datos_reunion_inicial[0]->tutor, $datos_reunion_inicial[0]->r2);
    $estado_embajador_validacion = EstadoAvanceValidacionesEmbajadores($datos_reunion_inicial[0]->tutor, $datos_reunion_inicial[0]->r2, $datos_reunion_inicial[0]->rut, $id_empresa);
    //echo $estado_embajador_validacion;
    if ($_GET["sw"] == "emb_levantamient") {
        $PRINCIPAL = str_replace("{LINK_SEGUNDO}", "?sw=emb_vista1&r2={RUT_R2_ENCODEADO}", $PRINCIPAL);
        $PRINCIPAL = str_replace("{LINK_TERCERO}", "?sw=emb_vista1&r2={RUT_R2_ENCODEADO}", $PRINCIPAL);
        $PRINCIPAL = str_replace("{LINK_CUARTO}", "?sw=emb_vista1&r2={RUT_R2_ENCODEADO}", $PRINCIPAL);
        $PRINCIPAL = str_replace("{LINK_QUINTO}", "?sw=emb_vista1&r2={RUT_R2_ENCODEADO}", $PRINCIPAL);
        $PRINCIPAL = str_replace("{LINK_SEXTO}", "?sw=emb_vista1&r2={RUT_R2_ENCODEADO}", $PRINCIPAL);
        $PRINCIPAL = str_replace("{LINK_SIETE}", "?sw=emb_vista1&r2={RUT_R2_ENCODEADO}", $PRINCIPAL);
    }
    //x_ratioecho $estado_embajador;
    if ($estado_embajador == 0) {
    } else if ($estado_embajador == 25) {
        $PRINCIPAL = str_replace("{LINK_SEGUNDO}", "#second", $PRINCIPAL);
        $PRINCIPAL = str_replace("{LINK_TERCERO}", "#third", $PRINCIPAL);
        $PRINCIPAL = str_replace("{LINK_CUARTO}", "", $PRINCIPAL);
        $PRINCIPAL = str_replace("{LINK_QUINTO}", "", $PRINCIPAL);
        $PRINCIPAL = str_replace("{LINK_SEXTO}", "", $PRINCIPAL);
        $PRINCIPAL = str_replace("{LINK_SIETE}", "#seven", $PRINCIPAL);
        $PRINCIPAL = str_replace("{BLOQUE_FINALIZADO_ETAPA_1}", file_get_contents("views/embajadores/huincha_finalizado_etapa.html"), $PRINCIPAL);
        $PRINCIPAL = str_replace("{BLOQUE_FINALIZADO_ETAPA_2}", "", $PRINCIPAL);
        $PRINCIPAL = str_replace("{BLOQUE_FINALIZADO_ETAPA_3}", "", $PRINCIPAL);
        $PRINCIPAL = str_replace("{BLOQUE_FINALIZADO_ETAPA_4}", "", $PRINCIPAL);
        $PRINCIPAL = str_replace("{BLOQUE_FINALIZADO_ETAPA_5}", "", $PRINCIPAL);
    } else if ($estado_embajador == 50) {
        $PRINCIPAL = str_replace("{LINK_SEGUNDO}", "#second", $PRINCIPAL);
        $PRINCIPAL = str_replace("{LINK_TERCERO}", "#third", $PRINCIPAL);
        $PRINCIPAL = str_replace("{LINK_CUARTO}", "#four", $PRINCIPAL);
        $PRINCIPAL = str_replace("{LINK_QUINTO}", "", $PRINCIPAL);
        $PRINCIPAL = str_replace("{LINK_SEXTO}", "", $PRINCIPAL);
        $PRINCIPAL = str_replace("{LINK_SIETE}", "#seven", $PRINCIPAL);
        $PRINCIPAL = str_replace("{BLOQUE_FINALIZADO_ETAPA_1}", file_get_contents("views/embajadores/huincha_finalizado_etapa.html"), $PRINCIPAL);
        $PRINCIPAL = str_replace("{BLOQUE_FINALIZADO_ETAPA_2}", file_get_contents("views/embajadores/huincha_finalizado_etapa.html"), $PRINCIPAL);
        $PRINCIPAL = str_replace("{BLOQUE_FINALIZADO_ETAPA_3}", "", $PRINCIPAL);
        $PRINCIPAL = str_replace("{BLOQUE_FINALIZADO_ETAPA_4}", "", $PRINCIPAL);
        $PRINCIPAL = str_replace("{BLOQUE_FINALIZADO_ETAPA_5}", "", $PRINCIPAL);
    } else if ($estado_embajador == 75) {
        $PRINCIPAL = str_replace("{LINK_SEGUNDO}", "#second", $PRINCIPAL);
        $PRINCIPAL = str_replace("{LINK_TERCERO}", "#third", $PRINCIPAL);
        $PRINCIPAL = str_replace("{LINK_CUARTO}", "#four", $PRINCIPAL);
        $PRINCIPAL = str_replace("{LINK_QUINTO}", "#five", $PRINCIPAL);
        $PRINCIPAL = str_replace("{LINK_SEXTO}", "", $PRINCIPAL);
        $PRINCIPAL = str_replace("{LINK_SIETE}", "#seven", $PRINCIPAL);
        $PRINCIPAL = str_replace("{BLOQUE_FINALIZADO_ETAPA_1}", file_get_contents("views/embajadores/huincha_finalizado_etapa.html"), $PRINCIPAL);
        $PRINCIPAL = str_replace("{BLOQUE_FINALIZADO_ETAPA_2}", file_get_contents("views/embajadores/huincha_finalizado_etapa.html"), $PRINCIPAL);
        $PRINCIPAL = str_replace("{BLOQUE_FINALIZADO_ETAPA_3}", file_get_contents("views/embajadores/huincha_finalizado_etapa.html"), $PRINCIPAL);
        $PRINCIPAL = str_replace("{BLOQUE_FINALIZADO_ETAPA_4}", "", $PRINCIPAL);
        $PRINCIPAL = str_replace("{BLOQUE_FINALIZADO_ETAPA_5}", "", $PRINCIPAL);
    } else if ($estado_embajador == 100) {
        $PRINCIPAL = str_replace("{LINK_SEGUNDO}", "#second", $PRINCIPAL);
        $PRINCIPAL = str_replace("{LINK_TERCERO}", "#third", $PRINCIPAL);
        $PRINCIPAL = str_replace("{LINK_CUARTO}", "#four", $PRINCIPAL);
        $PRINCIPAL = str_replace("{LINK_QUINTO}", "#five", $PRINCIPAL);
        $PRINCIPAL = str_replace("{LINK_SEXTO}", "#six", $PRINCIPAL);
        $PRINCIPAL = str_replace("{LINK_SIETE}", "#seven", $PRINCIPAL);
        $PRINCIPAL = str_replace("{BLOQUE_FINALIZADO_ETAPA_1}", file_get_contents("views/embajadores/huincha_finalizado_etapa.html"), $PRINCIPAL);
        $PRINCIPAL = str_replace("{BLOQUE_FINALIZADO_ETAPA_2}", file_get_contents("views/embajadores/huincha_finalizado_etapa.html"), $PRINCIPAL);
        $PRINCIPAL = str_replace("{BLOQUE_FINALIZADO_ETAPA_3}", file_get_contents("views/embajadores/huincha_finalizado_etapa.html"), $PRINCIPAL);
        $PRINCIPAL = str_replace("{BLOQUE_FINALIZADO_ETAPA_4}", file_get_contents("views/embajadores/huincha_finalizado_etapa.html"), $PRINCIPAL);
        $PRINCIPAL = str_replace("{BLOQUE_FINALIZADO_ETAPA_5}", "", $PRINCIPAL);
    }
    //$row_r2 = str_replace("{AVANCE_ETAPA_VAL}",EstadoAvanceValidacionesEmbajadores($unico->tutor, $unico->r2, $unico->rut, $id_empresa),$row_r2);
    //$row_r2 = str_replace("{AVANCE_TAREAS}",EstadoIngresoTareas($unico->rut, $unico->r2, $unico->tutor, $id_empresa),$row_r2);
    //$row_r2 = str_replace("{AVANCE_TAREAS_VAL}",EstadoIngresoTareasValidacion($unico->rut, $unico->r2, $unico->tutor, $id_empresa),$row_r2);
    ;
    return ($PRINCIPAL);
}
function EstadoIngresoTareasValidacion($rut_embajador, $rut_r2, $rut_tutor, $id_empresa)
{
    $selecciona_tareas = EMBAJADORES_TraigoTareasPorActividadYRutSoloRutYEmpresa($id_empresa, $rut_embajador, $rut_r2);
    $total_tares       = count($selecciona_tareas);
    $ingresadas        = 0;
    foreach ($selecciona_tareas as $tarea) {
        if ($tarea->fecha_tarea_validada) {
            $ingresadas++;
        }
    }
    $avance = round(($ingresadas * 100) / $total_tares);
    return ($avance);
}
function EstadoIngresoTareas($rut_embajador, $rut_r2, $rut_tutor, $id_empresa)
{
    $selecciona_tareas = EMBAJADORES_TraigoTareasPorActividadYRutSoloRutYEmpresa($id_empresa, $rut_embajador, $rut_r2);
    $total_tares       = count($selecciona_tareas);
    $ingresadas        = 0;
    foreach ($selecciona_tareas as $tarea) {
        if ($tarea->link_drive) {
            $ingresadas++;
        }
    }
    $avance = round(($ingresadas * 100) / $total_tares);
    return ($avance);
}
function EstadoAvanceValidacionesEmbajadores($rut_tutor, $r2, $rut_embajador, $id_empresa)
{
    $estapa_validada = EMBAJADORES_VerificaValidacion3($id_empresa, $rut_embajador, $r2, $rut_tutor);
    $porcentaje      = (count($estapa_validada) * 100) / 5;
    return (round($porcentaje));
}
function ColocoObjetosPorCurso($PRINCIPAL, $id_empresa, $id_curso, $rut)
{
    //Traigo los ovjetos por curso
    $objetos = CHECK_ObjetosPorCurso($id_curso);
    foreach ($objetos as $obj) {
        $row .= file_get_contents("views/google_expand/row_objeto.html");
        $row = str_replace("{NOMBRE_OBJETO}", $obj->titulo, $row);
        $row = str_replace("{DESCRIPCION}", $obj->descripcion, $row);
        $row = str_replace("{IDOBJETO}", $obj->id, $row);
        $row = str_replace("{ID_OBJETO_ENCODEADO}", Encodear3($obj->id), $row);
        $row = str_replace("{IMAGEN}", $obj->imagen, $row);
        $row = str_replace("{ESTILO_OVERLAY}", $obj->imagentexto, $row);
        $row = str_replace("{RUT}", $rut, $row);
        $row = str_replace("{ID_OBJETO}", $obj->id, $row);
    }
    $PRINCIPAL = str_replace("{ROW_LISTADO_OBJETOS_GOOGLE_EXPANDS}", ($row), $PRINCIPAL);
    return ($PRINCIPAL);
}
function ActualizaTablatblLmsReportePorRutPrograma($rut, $id_programa)
{
}
function ColocaR2PorEmbajador($PRINCIPAL, $rut, $id_empresa)
{
    //Veo si este usuario tiene mas de un R2
    $r2 = TraeR2PorEmbajador($rut, $id_empresa);
    //if(count($r2)>1){
    foreach ($r2 as $unico) {
        $row_r2 .= file_get_contents("views/embajadores/emb_row_vista_r2.html");
        $row_r2 = str_replace("{NOMBRE_USUARIO}", $unico->nombre_completo, $row_r2);
        $row_r2 = str_replace("{FECHA_R2}", $unico->fecha, $row_r2);
        $row_r2 = str_replace("{RUT_R2_ENCODEADO}", Encodear3($unico->r2), $row_r2);
        $row_r2 = str_replace("{AVANCE_ETAPA}", ObtenerPorcentajeAvanceSemana3($unico->rut, $id_empresa, $unico->tutor, $unico->r2), $row_r2);
        $row_r2 = str_replace("{AVANCE_ETAPA_VAL}", EstadoAvanceValidacionesEmbajadores($unico->tutor, $unico->r2, $unico->rut, $id_empresa), $row_r2);
        $row_r2 = str_replace("{AVANCE_TAREAS}", EstadoIngresoTareas($unico->rut, $unico->r2, $unico->tutor, $id_empresa), $row_r2);
        $row_r2 = str_replace("{AVANCE_TAREAS_VAL}", EstadoIngresoTareasValidacion($unico->rut, $unico->r2, $unico->tutor, $id_empresa), $row_r2);
    }
    $row_r2titulo    = file_get_contents("views/embajadores/emb_titulo_vista_r2.html");
    $row_r2fintitulo = file_get_contents("views/embajadores/emb_titulofin_vista_r2.html");
    $PRINCIPAL       = str_replace("{TITULO_BLOQUE_LISTADO_R2}", $row_r2titulo, $PRINCIPAL);
    $PRINCIPAL       = str_replace("{BLOQUE_LISTADO_R2}", $row_r2, $PRINCIPAL);
    $PRINCIPAL       = str_replace("{FIN_TITULO_BLOQUE_LISTADO_R2}", $row_r2fintitulo, $PRINCIPAL);
    /*
    if(Decodear3($_GET["r2"])){
    $PRINCIPAL = str_replace("{LINK_SEGUNDO}","#second",$PRINCIPAL);
    $PRINCIPAL = str_replace("{LINK_TERCERO}","#third",$PRINCIPAL);
    $PRINCIPAL = str_replace("{LINK_CUARTO}","#four",$PRINCIPAL);
    $PRINCIPAL = str_replace("{LINK_QUINTO}","#five",$PRINCIPAL);
    $PRINCIPAL = str_replace("{LINK_SEXTO}","#six",$PRINCIPAL);
    $PRINCIPAL = str_replace("{LINK_SIETE}","#seven",$PRINCIPAL);
    }else{
    $PRINCIPAL = str_replace("{LINK_SEGUNDO}","",$PRINCIPAL);
    $PRINCIPAL = str_replace("{LINK_TERCERO}","",$PRINCIPAL);
    $PRINCIPAL = str_replace("{LINK_CUARTO}","",$PRINCIPAL);
    $PRINCIPAL = str_replace("{LINK_QUINTO}","",$PRINCIPAL);
    $PRINCIPAL = str_replace("{LINK_SEXTO}","",$PRINCIPAL);
    $PRINCIPAL = str_replace("{LINK_SIETE}","",$PRINCIPAL);
    $PRINCIPAL = str_replace("{EMB_ESTADO_ICONO1}","",$PRINCIPAL);
    $PRINCIPAL = str_replace("{EMB_ESTADO_ICONO2}","",$PRINCIPAL);
    $PRINCIPAL = str_replace("{EMB_ESTADO_ICONO3}","",$PRINCIPAL);
    $PRINCIPAL = str_replace("{EMB_ESTADO_ICONO4}","",$PRINCIPAL);
    $PRINCIPAL = str_replace("{EMB_ESTADO_ICONO5}","",$PRINCIPAL);
    $PRINCIPAL = str_replace("{EMB_ESTADO_ICONO6}","",$PRINCIPAL);
    $PRINCIPAL = str_replace("{EMB_ESTADO_ICONO7}","",$PRINCIPAL);
    }
    */
    /*
    }else{
    $PRINCIPAL = str_replace("{BLOQUE_LISTADO_R2}","",$PRINCIPAL);
    $PRINCIPAL = str_replace("{TITULO_BLOQUE_LISTADO_R2}","",$PRINCIPAL);
    $PRINCIPAL = str_replace("{BLOQUE_LISTADO_R2}","",$PRINCIPAL);
    $PRINCIPAL = str_replace("{FIN_TITULO_BLOQUE_LISTADO_R2}","",$PRINCIPAL);
    $PRINCIPAL = str_replace("{LINK_SEGUNDO}","#second",$PRINCIPAL);
    $PRINCIPAL = str_replace("{LINK_TERCERO}","#third",$PRINCIPAL);
    $PRINCIPAL = str_replace("{LINK_CUARTO}","#four",$PRINCIPAL);
    $PRINCIPAL = str_replace("{LINK_QUINTO}","#five",$PRINCIPAL);
    $PRINCIPAL = str_replace("{LINK_SEXTO}","#six",$PRINCIPAL);
    $PRINCIPAL = str_replace("{LINK_SIETE}","#seven",$PRINCIPAL);
    }
    */
    return ($PRINCIPAL);
}
function ColocaReplyInterraccionesGenerico($id_empresa, $id_comentario)
{
    //Traigo los comentarios
    $comentarios = INTERACCIONES_TotalComentariosPorId($id_comentario);
    foreach ($comentarios as $comen) {
        $row_comentario .= file_get_contents("views/embajadores/row_reply.html");
        $row_comentario = str_replace("{COMENTARIO}", $comen->comentario, $row_comentario);
        $row_comentario = str_replace("{ID_COMENTARIO}", $comen->id, $row_comentario);
        $row_comentario = str_replace("{AUTOR}", $comen->nombre_completo, $row_comentario);
        $row_comentario = str_replace("{FOTO_AUTOR}", VerificaFotoPersonal($comen->rut_autor), $row_comentario);
    }
    return (($row_comentario));
}
function ColocaComentariosInterraccionesGenerico($id_empresa, $etapa_embajadores, $usuario_embajadores, $r2)
{
    $bloque_comentarios = "bloque comentarios";
    //Traigo los comentarios
    $comentarios        = EMBAJADORES_TraigoInterraccionesEmbajadores($id_empresa, $etapa_embajadores, $usuario_embajadores, $r2);
    foreach ($comentarios as $comen) {
        /*
        if($etapa_embajadores==99){
        $row_comentario.=file_get_contents("views/embajadores/row_interacciones_con_reply.html");
        }else if($etapa_embajadores==100){
        $row_comentario.=file_get_contents("views/embajadores/row_interacciones_con_reply.html");
        }else{
        $row_comentario.=file_get_contents("views/embajadores/row_interacciones.html");
        }
        */
        $row_comentario .= file_get_contents("views/embajadores/row_interacciones_con_reply.html");
        $row_comentario           = str_replace("{COMENTARIO}", $comen->comentario, $row_comentario);
        $row_comentario           = str_replace("{ID_COMENTARIO}", $comen->id, $row_comentario);
        $row_comentario           = str_replace("{AUTOR}", $comen->nombre_completo, $row_comentario);
        $bloque_comentarios_reply = ColocaReplyInterraccionesGenerico($id_empresa, $comen->id);
        $row_comentario           = str_replace("{BLOQUE_ROW_COMENTARIOS_REPLY}", $bloque_comentarios_reply, $row_comentario);
        $row_comentario           = str_replace("{FOTO_AUTOR}", VerificaFotoPersonal($comen->rut_autor), $row_comentario);
    }
    return (($row_comentario));
}
function ColocaComentariosInterraccionesGenericoObjetos($id_empresa, $etapa_embajadores, $usuario_embajadores)
{
    $bloque_comentarios = "bloque comentarios";
    //Traigo los comentarios
    $comentarios        = ColocaComentariosInterraccionesGenericoObjetosDATA($id_empresa, $etapa_embajadores, $usuario_embajadores);
    foreach ($comentarios as $comen) {
        /*
        if($etapa_embajadores==99){
        $row_comentario.=file_get_contents("views/embajadores/row_interacciones_con_reply.html");
        }else if($etapa_embajadores==100){
        $row_comentario.=file_get_contents("views/embajadores/row_interacciones_con_reply.html");
        }else{
        $row_comentario.=file_get_contents("views/embajadores/row_interacciones.html");
        }
        */
        $row_comentario .= file_get_contents("views/embajadores/row_interacciones_con_reply.html");
        $row_comentario           = str_replace("{COMENTARIO}", $comen->comentario, $row_comentario);
        $row_comentario           = str_replace("{ID_COMENTARIO}", $comen->id, $row_comentario);
        $row_comentario           = str_replace("{AUTOR}", $comen->nombre_completo, $row_comentario);
        $bloque_comentarios_reply = ColocaReplyInterraccionesGenerico($id_empresa, $comen->id);
        $row_comentario           = str_replace("{BLOQUE_ROW_COMENTARIOS_REPLY}", $bloque_comentarios_reply, $row_comentario);
        $row_comentario           = str_replace("{FOTO_AUTOR}", VerificaFotoPersonal($comen->rut_autor), $row_comentario);
    }
    return (($row_comentario));
}
function ColocaBloqueValidacion($PRINCIPAL, $tutor, $embajador, $etapa, $id_empresa, $rut_r2)
{
    $esta_validado         = EMBAJADORES_VerificaValidacion2($id_empresa, $embajador, $etapa, $rut_r2);
    $datos_reunion_inicial = EMBAJADORES_DatosPlanReunionInicial($id_empresa, $embajador, $rut_r2);
    if ($esta_validado) {
        $formulario = file_get_contents("views/embajadores/texto_validacion_tutor.html");
        $formulario = str_replace("{ESTADO_VALIDACION}", $esta_validado[0]->estado_validacion, $formulario);
        $formulario = str_replace("{NUMERO_ETAPA}", $etapa, $formulario);
        $formulario = str_replace("{RUT_EMBAJADOR_ENCODEADO}", Encodear3($embajador), $formulario);
        $formulario = str_replace("{RUT_TUTOR_ENCODEADO}", Encodear3($datos_reunion_inicial[0]->tutor), $formulario);
        $formulario = str_replace("{RUT_R2_ENCODEADO}", Encodear3($rut_r2), $formulario);
    } else {
        $formulario = file_get_contents("views/embajadores/form_validacion_tutor.html");
        $formulario = str_replace("{ETAPA}", $etapa, $formulario);
        if ($etapa == 1) {
            $formulario = str_replace("{NOMBRE_ETAPA}", "Reuni?n Inicial", $formulario);
        } else if ($etapa == 2) {
            $formulario = str_replace("{NOMBRE_ETAPA}", "Selecci?n de Plan", $formulario);
        } else if ($etapa == 3) {
            $formulario = str_replace("{NOMBRE_ETAPA}", "Selecci?n de Tareas", $formulario);
        } else if ($etapa == 4) {
            $formulario = str_replace("{NOMBRE_ETAPA}", "Calendarizaci?n de Tareas", $formulario);
        } else if ($etapa == 5) {
            $formulario = str_replace("{NOMBRE_ETAPA}", "Desarrollo de Tareas", $formulario);
        } else if ($etapa == 6) {
            $formulario = str_replace("{NOMBRE_ETAPA}", "Levantamientos", $formulario);
        }
        $formulario = str_replace("{RUT_EMBAJADOR}", $embajador, $formulario);
        $formulario = str_replace("{RUT_R2}", $rut_r2, $formulario);
    }
    return ($formulario);
}
function ObtenerPorcentajeAvanceSemana3($rut_embajador, $id_empresa, $rut_Sesion, $rut_r2)
{
    //echo "<br><br>r2 ".$rut_r2."<br>";
    $datos_reunion_inicial = EMBAJADORES_DatosPlanReunionInicial($id_empresa, $rut_embajador, $rut_r2);
    $contador_etapas       = 0;
    if ($datos_reunion_inicial[0]->fecha) {
        $contador_etapas++;
    }
    //echo "<br>---et1 reunion inicial ".$contador_etapas;
    if ($datos_reunion_inicial[0]->plan and $datos_reunion_inicial[0]->factor_exito and $datos_reunion_inicial[0]->ambito and $datos_reunion_inicial[0]->periodicidad and $datos_reunion_inicial[0]->nombre_kpi and $datos_reunion_inicial[0]->kpi_inicial >= 0 and $datos_reunion_inicial[0]->kpi_esperado >= 0) {
        $contador_etapas++;
    }
    //echo "<br>---et2 datos_reunion_inicial[0]->plan ".$contador_etapas;
    $selecciona_tareas = EMBAJADORES_TraigoTareasPorActividadYRutSoloRutYEmpresa($id_empresa, $rut_embajador, $rut_r2);
    if ($selecciona_tareas) {
        $contador_etapas++;
        //echo $rut_embajador."<br>";
    }
    //echo "<br>---et3 selecciona_tareas ".$contador_etapas;
    $tareas_calendarizadas = EMBAJADORES_CalendarizacionTareaPorUsuario($id_empresa, $rut_embajador, $rut_r2);
    if ($tareas_calendarizadas) {
        $contador_etapas++;
    }
    //echo "<br>---et4 selecciona_tareas_calendarizadas ".$contador_etapas;
    /*$estado_ingreso_tareas=EstadoIngresoTareas($rut_embajador, $rut_r2, $datos_reunion_inicial[0]->tutor, $id_empresa);
    if($estado_ingreso_tareas==100){
    $contador_etapas++;
    }*/
    //echo "<br>---et5 estado_ingreso_tareas ".$contador_etapas;
    $porcentaje = (100 * $contador_etapas) / 4;
    if ($porcentaje >= 100)
        $porcentaje = 100;
    return ($porcentaje);
}
function ColocaListadoCertificaciones($PRINCIPAL, $rut, $id_empresa)
{
    $certificaciones = TraeCerficicacionesPorRutEmpresa($id_empresa, $rut);
    foreach ($certificaciones as $cert) {
        $row_certificacion .= file_get_contents("views/home/home_row_certificacion.html");
        $row_certificacion = str_replace("{NOMBRE_CERTIFICACIONES}", ($cert->certificacion), $row_certificacion);
        $valor             = str_replace(",", ".", $cert->nota);
        $row_certificacion = str_replace("{RESULTADO_CERTIFICACION}", $valor, $row_certificacion);
    }
    $PRINCIPAL = str_replace("{ROW_CERTIFICACIONES}", ($row_certificacion), $PRINCIPAL);
    return ($PRINCIPAL);
}
function FormularioPost($PRINCIPAL, $id_mp, $id_empresa)
{
    $unico = com_mp_full_data($id_empresa, $id_mp);
    if ($unico) {
        $PRINCIPAL = str_replace("{VALOR_BOTON}", "Editar Publicacion", $PRINCIPAL);
        $PRINCIPAL = str_replace("{ACTION}", "com_mp_edit_post", $PRINCIPAL);
        $PRINCIPAL = str_replace("{ID_MP}", Encodear3($id_mp), $PRINCIPAL);
    } else {
        $PRINCIPAL = str_replace("{VALOR_BOTON}", "Publicar", $PRINCIPAL);
        $PRINCIPAL = str_replace("{ACTION}", "com_mp_save_post", $PRINCIPAL);
    }
    $PRINCIPAL          = str_replace("{TITULO}", ($unico[0]->nombre), $PRINCIPAL);
    $PRINCIPAL          = str_replace("{LINK_YOUTUBE}", ($unico[0]->video), $PRINCIPAL);
    //$PRINCIPAL = str_replace("{LINK_DOCUMENTO}",($unico[0]->archivo),$PRINCIPAL);
    $PRINCIPAL          = str_replace("{LINK_DOCUMENTO}", ($unico[0]->url_documento), $PRINCIPAL);
    $PRINCIPAL          = str_replace("{FUENTE}", ($unico[0]->fuente), $PRINCIPAL);
    $PRINCIPAL          = str_replace("{CONTENIDO}", ($unico[0]->contenido), $PRINCIPAL);
    $PRINCIPAL          = str_replace("{RESUMEN}", ($unico[0]->resumen), $PRINCIPAL);
    $PRINCIPAL          = str_replace("{SELECT_" . ($unico[0]->tipo) . "}", "selected='selected'", $PRINCIPAL);
    $tags               = TagsPorMPEmpresa($id_mp, $id_empresa);
    $arreglo_tags       = "";
    $contador           = 1;
    $categorias_mp      = TraeCategoriasMejoresPracticas($id_empresa);
    $options_categorias = "";
    foreach ($categorias_mp as $cat) {
        if ($unico[0]->id_categoria == $cat->id_categoria) {
            $options_categorias .= "<option value='" . $cat->id_categoria . "' selected='selected'>" . $cat->categoria . "</option>";
        } else {
            $options_categorias .= "<option value='" . $cat->id_categoria . "'>" . $cat->categoria . "</option>";
        }
    }
    $array_MP_template = MP_BuscaTemplate($rut, $id_empresa);
    if ($array_MP_template[0]->template <> '') {
        $template = $array_MP_template[0]->template . "";
    } else {
        $template = "";
    }
    $ambitos_mp      = TraeAmbitosMejoresPracticas($id_empresa, $template);
    $options_ambitos = "";
    $options_ambitos .= "<option value=''>[ SELECCIONA ]</option>";
    foreach ($ambitos_mp as $ambito) {
        if ($unico[0]->id_ambito == $ambito->id_ambito) {
            $options_ambitos .= "<option value='" . $ambito->id_ambito . "' selected='selected'>" . $ambito->ambito . "</option>";
        } else {
            $options_ambitos .= "<option value='" . $ambito->id_ambito . "'>" . $ambito->ambito . "</option>";
        }
    }
    $PRINCIPAL = str_replace("{CATEGORIAS}", ($options_categorias), $PRINCIPAL);
    $PRINCIPAL = str_replace("{AMBITOS}", ($options_ambitos), $PRINCIPAL);
    foreach ($tags as $tg) {
        $arreglo_tags .= "#" . $tg->tag;
        if ($contador < count($tags)) {
            $arreglo_tags .= " ";
        }
        $contador++;
    }
    $PRINCIPAL = str_replace("{TAGS_MP}", ($arreglo_tags), $PRINCIPAL);
    return ($PRINCIPAL);
}
function FormularioPostPregunta($PRINCIPAL, $id_mp, $id_empresa)
{
    $unico = com_mp_full_data($id_empresa, $id_mp);
    if ($unico) {
        $PRINCIPAL = str_replace("{VALOR_BOTON}", "Editar Pregunta", $PRINCIPAL);
        $PRINCIPAL = str_replace("{ACTION}", "com_mp_edit_post_question", $PRINCIPAL);
        $PRINCIPAL = str_replace("{ID_MP}", Encodear3($id_mp), $PRINCIPAL);
    } else {
        $PRINCIPAL = str_replace("{VALOR_BOTON}", "Preguntar", $PRINCIPAL);
        $PRINCIPAL = str_replace("{ACTION}", "com_mp_save_post_question", $PRINCIPAL);
    }
    $PRINCIPAL          = str_replace("{TITULO}", ($unico[0]->nombre), $PRINCIPAL);
    $PRINCIPAL          = str_replace("{CONTENIDO}", ($unico[0]->contenido), $PRINCIPAL);
    $PRINCIPAL          = str_replace("{RESUMEN}", ($unico[0]->resumen), $PRINCIPAL);
    $contador           = 1;
    $categorias_mp      = TraeCategoriasMejoresPracticas($id_empresa);
    $options_categorias = "";
    foreach ($categorias_mp as $cat) {
        if ($unico[0]->id_categoria == $cat->id_categoria) {
            $options_categorias .= "<option value='" . $cat->id_categoria . "' selected='selected'>" . $cat->categoria . "</option>";
        } else {
            $options_categorias .= "<option value='" . $cat->id_categoria . "'>" . $cat->categoria . "</option>";
        }
    }
    $array_MP_template = MP_BuscaTemplate($rut, $id_empresa);
    if ($array_MP_template[0]->template <> '') {
        $template = $array_MP_template[0]->template . "";
    } else {
        $template = "";
    }
    $ambitos_mp      = TraeAmbitosMejoresPracticas($id_empresa, $template);
    $options_ambitos = "";
    $options_ambitos .= "<option value='' >[ SELECCIONA ]</option>";
    foreach ($ambitos_mp as $ambito) {
        if ($unico[0]->id_ambito == $ambito->id_ambito) {
            $options_ambitos .= "<option value='" . $ambito->id_ambito . "' selected='selected'>" . $ambito->ambito . "</option>";
        } else {
            $options_ambitos .= "<option value='" . $ambito->id_ambito . "'>" . $ambito->ambito . "</option>";
        }
    }
    $PRINCIPAL = str_replace("{CATEGORIAS}", ($options_categorias), $PRINCIPAL);
    $PRINCIPAL = str_replace("{AMBITOS}", ($options_ambitos), $PRINCIPAL);
    return ($PRINCIPAL);
}
function ColocaClasificacionesPrevia($PRINCIPAL, $id_empresa, $id_malla, $id_programa)
{
    $listado_clasificaciones = TraeClasificacionesPorEmpresaPrograma($id_empresa, $id_programa);
    foreach ($listado_clasificaciones as $list) {
        $row_listado .= file_get_contents("views/cursos/capacitacion/" . $id_empresa . "_row_avance_clasificacion_home_plan.html");
        $row_listado = str_replace("{TITULO}", $list->nombre_clasificacion, $row_listado);
        $row_listado = str_replace("{DESCRIPCION}", $list->descripcion_clasificacion, $row_listado);
        $row_listado = str_replace("{CLAS_IMG_NIVEL}", $list->imagen_clasificacion, $row_listado);
        $row_listado = str_replace("{ID_MALLA_ENCODEADA}", Encodear3($id_malla), $row_listado);
    }
    $PRINCIPAL = str_replace("{ROWS_LISTADO_CLASIFICACIONES}", ($row_listado), $PRINCIPAL);
    return ($PRINCIPAL);
}


function resumir($texto, $limite, $car=".", $final="?")
{
if(strlen($texto) <= $limite) return $texto;
  if(false !== ($breakpoint = strpos($texto, $car, $limite)))
  {
   $val=strlen($texto)-1;
   if( $breakpoint < $val)
   {
    $texto= substr($texto, 0, $breakpoint) . $final;
   }
  }
return $texto;
}

//Muestra fecha tipo Facebook
function nicetime($date)
{
    if (empty($date)) {
        return "No hay fecha que mostrar";
    }
    $periods   = array(
        "segundo",
        "minuto",
        "hora",
        "dia",
        "semana",
        "mes",
        "a?o",
        "decada"
    );
    $lengths   = array(
        "60",
        "60",
        "24",
        "7",
        "4.35",
        "12",
        "10"
    );
    $now       = time();
    $unix_date = strtotime($date);
    // check validity of date
    if (empty($unix_date)) {
        return "Bad date";
    }
    // is it future date or past date
    if ($now > $unix_date) {
        $difference = $now - $unix_date;
        $tense      = "hace";
    } else {
        $difference = $unix_date - $now;
        $tense      = "from now";
    }
    for ($j = 0; $difference >= $lengths[$j] && $j < count($lengths) - 1; $j++) {
        $difference /= $lengths[$j];
    }
    $difference = round($difference);
    if ($difference != 1) {
        $periods[$j] .= "s";
    }
    return "<span class=\"mini\">{$tense}</span><span class=\"big\"> $difference </span><span class=\"mini\">$periods[$j]</span> ";
}

function limit_words($string, $word_limit)
{
    $words = explode(" ",$string);
    return implode(" ",array_splice($words,0,$word_limit));
}


function ColocaImagenPost($url_imagen)
{
    if ($url_imagen <> '') {
        $template_imagen = file_get_contents("views/comunidad_mp/com_imagen.html");
        $template_imagen = str_replace("{URL_IMAGEN_FONDO}", $url_imagen, $template_imagen);
    } else {
        $template_imagen = "";
    }
    return ($template_imagen);
}


function ellipsis($str, $len = 50)
{
    return strlen($str) > $len ? substr($str, 0, $len) . '...' : $str;
}

function ClaseParaDrofAndDrop()
{
    abstract class SlimStatus
    {
        const FAILURE = 'failure';
        const SUCCESS = 'success';
    }
    class Slim
    {
        public static function getImages($inputName = 'slim')
        {
            $values = Slim::getPostData($inputName);
            // test for errors
            if ($values === false) {
                return false;
            }
            // determine if contains multiple input values, if is singular, put in array
            $data = array();
            if (!is_array($values)) {
                $values = array(
                    $values
                );
            }
            // handle all posted fields
            foreach ($values as $value) {
                $inputValue = Slim::parseInput($value);
                if ($inputValue) {
                    array_push($data, $inputValue);
                }
            }
            // return the data collected from the fields
            return $data;
        }
        // $value should be in JSON format
        private static function parseInput($value)
        {
            // if no json received, exit, don't handle empty input values.
            if (empty($value)) {
                return null;
            }
            // The data is posted as a JSON String so to be used it needs to be deserialized first
            $data    = json_decode($value);
            // shortcut
            $input   = null;
            $actions = null;
            $output  = null;
            $meta    = null;
            if (isset($data->input)) {
                $inputData = null;
                if (isset($data->input->image)) {
                    $inputData = Slim::getBase64Data($data->input->image);
                } else if (isset($data->input->field)) {
                    $filename = $_FILES[$data->input->field]['tmp_name'];
                    if ($filename) {
                        $inputData = file_get_contents($filename);
                    }
                }
                $input = array(
                    'data' => $inputData,
                    'name' => $data->input->name,
                    'type' => $data->input->type,
                    'size' => $data->input->size,
                    'width' => $data->input->width,
                    'height' => $data->input->height
                );
            }
            if (isset($data->output)) {
                $outputDate = null;
                if (isset($data->output->image)) {
                    $outputData = Slim::getBase64Data($data->output->image);
                } else if (isset($data->output->field)) {
                    $filename = $_FILES[$data->output->field]['tmp_name'];
                    if ($filename) {
                        $outputData = file_get_contents($filename);
                    }
                }
                $output = array(
                    'data' => $outputData,
                    'name' => $data->output->name,
                    'type' => $data->output->type,
                    'width' => $data->output->width,
                    'height' => $data->output->height
                );
            }
            if (isset($data->actions)) {
                $actions = array(
                    'crop' => $data->actions->crop ? array(
                        'x' => $data->actions->crop->x,
                        'y' => $data->actions->crop->y,
                        'width' => $data->actions->crop->width,
                        'height' => $data->actions->crop->height,
                        'type' => $data->actions->crop->type
                    ) : null,
                    'size' => $data->actions->size ? array(
                        'width' => $data->actions->size->width,
                        'height' => $data->actions->size->height
                    ) : null,
                    'rotation' => $data->actions->rotation,
                    'filters' => $data->actions->filters ? array(
                        'sharpen' => $data->actions->filters->sharpen
                    ) : null
                );
            }
            if (isset($data->meta)) {
                $meta = $data->meta;
            }
            // We've sanitized the base64data and will now return the clean file object
            return array(
                'input' => $input,
                'output' => $output,
                'actions' => $actions,
                'meta' => $meta
            );
        }
        // $path should have trailing slash
        public static function saveFile($data, $name, $path = 'tmp/', $uid = true)
        {
            // Add trailing slash if omitted
            if (substr($path, -1) !== '/') {
                $path .= '/';
            }
            // Test if directory already exists
            if (!is_dir($path)) {
                mkdir($path, 0755, true);
            }
            // Sanitize characters in file name
            $name = Slim::sanitizeFileName($name);
            // Let's put a unique id in front of the filename so we don't accidentally overwrite other files
            if ($uid) {
                $name = uniqid() . '_' . $name;
            }
            // Add name to path, we need the full path including the name to save the file
            $path = $path . $name;
            // store the file
            Slim::save($data, $path);
            // return the files new name and location
            return array(
                'name' => $name,
                'path' => $path
            );
        }
        /**
         * Get data from remote URL
         * @param $url
         * @return string
         */
        public static function fetchURL($url, $maxFileSize)
        {
            if (!ini_get('allow_url_fopen')) {
                return null;
            }
            $content = null;
            try {
                $content = @file_get_contents($url, false, null, 0, $maxFileSize);
            }
            catch (Exception $e) {
                return false;
            }
            return $content;
        }
        public static function outputJSON($data)
        {
            header('Content-Type: application/json');
            echo json_encode($data);
        }
        /**
         * http://stackoverflow.com/a/2021729
         * Remove anything which isn't a word, whitespace, number
         * or any of the following characters -_~,;[]().
         * If you don't need to handle multi-byte characters
         * you can use preg_replace rather than mb_ereg_replace
         * @param $str
         * @return string
         */
        public static function sanitizeFileName($str)
        {
            // Basic clean up
            $str = mb_ereg_replace("([^\w\s\d\-_~,;\[\]\(\).])", '', $str);
            // Remove any runs of periods
            $str = mb_ereg_replace("([\.]{2,})", '', $str);
            return $str;
        }
        /**
         * Gets the posted data from the POST or FILES object. If was using Slim to upload it will be in POST (as posted with hidden field) if not enhanced with Slim it'll be in FILES.
         * @param $inputName
         * @return array|bool
         */
        private static function getPostData($inputName)
        {
            $values = array();
            if (isset($_POST[$inputName])) {
                $values = $_POST[$inputName];
            } else if (isset($_FILES[$inputName])) {
                // Slim was not used to upload this file
                return false;
            }
            return $values;
        }
        /**
         * Saves the data to a given location
         * @param $data
         * @param $path
         * @return bool
         */
        private static function save($data, $path)
        {
            if (!file_put_contents($path, $data)) {
                return false;
            }
            return true;
        }
        /**
         * Strips the "data:image..." part of the base64 data string so PHP can save the string as a file
         * @param $data
         * @return string
         */
        private static function getBase64Data($data)
        {
            return base64_decode(preg_replace('#^data:image/\w+;base64,#i', '', $data));
        }
    }
    /***** FIN SLIM.PHP */
    // Get posted data
    $images = Slim::getImages();
    // No image found under the supplied input name
    if ($images == false) {
        // inject your own auto crop or fallback script here
        echo '<p>Slim was not used to upload these images.</p>';
    } else {
        // Could be multiple slim croppers
        foreach ($images as $image) {
            $files = array();
            // save output data if set
            if (isset($image['output']['data'])) {
                // Save the file
                $name   = $image['output']['name'];
                // We'll use the output crop data
                $data   = $image['output']['data'];
                // If you want to store the file in another directory pass the directory name as the third parameter.
                // $file = Slim::saveFile($data, $name, 'my-directory/');
                // If you want to prevent Slim from adding a unique id to the file name add false as the fourth parameter.
                // $file = Slim::saveFile($data, $name, 'tmp/', false);
                $output = Slim::saveFile($data, $name);
                array_push($files, $output);
            }
            // save input data if set
            if (isset($image['input']['data'])) {
                // Save the file
                $name  = $image['input']['name'];
                // We'll use the output crop data
                $data  = $image['input']['data'];
                // If you want to store the file in another directory pass the directory name as the third parameter.
                // $file = Slim::saveFile($data, $name, 'my-directory/');
                // If you want to prevent Slim from adding a unique id to the file name add false as the fourth parameter.
                // $file = Slim::saveFile($data, $name, 'tmp/', false);
                $input = Slim::saveFile($data, $name);
                array_push($files, $input);
            }
            $filenames = join(', ', array_map(function($file)
            {
                return ellipsis($file['name'], 100);
            }, $files));
            $images = array_map(function($file)
            {
                return '<img src="' . $file['path'] . '" alt=""/>';
            }, $files);
            echo '
    <h1>You uploaded "' . $filenames . '"</h1>
    ' . join('<br>', $images) . '
    <div class="table-wrapper">
    <table>
        <thead>
            <tr>
                <th>Property</th>
                <th>Value</th>
            </tr>
        </thead>
        ';
            if (isset($image['input']['data'])) {
                echo '
            <tbody>
                <tr>
                    <th colspan="2">Input</th>
                </tr>
                <tr>
                    <th>Name</th>
                    <td>' . ellipsis($image['input']['name'], 100) . '</td>
                </tr>
                <tr>
                    <th>Type</th>
                    <td>' . $image['input']['type'] . '</td>
                </tr>
                <tr>
                    <th>Size</th>
                    <td>' . $image['input']['size'] . '</td>
                </tr>
                <tr>
                    <th>Width</th>
                    <td>' . $image['input']['width'] . '</td>
                </tr>
                <tr>
                    <th>Height</th>
                    <td>' . $image['input']['height'] . '</td>
                </tr>
                    <tr>
                        <th>Data</th>
                        ' . (isset($image['input']['data']) ? '<td class="bytes">' . ellipsis(base64_encode($image['output']['data']), 50) . '</td>' : '<td>Input data was not sent, add the "input" value to the <code>data-post</code> property to send it along.</td>') . '
                    </tr>
            </tbody>
            ';
            }
            if (isset($image['output']['data'])) {
                echo '
                <tbody>
                    <tr>
                        <th colspan="2">Output</th>
                    </tr>
                    <tr>
                        <th>Name</th>
                        <td>' . $image['output']['name'] . '</td>
                    </tr>
                    <tr>
                        <th>Type</th>
                        <td>' . $image['output']['type'] . '</td>
                    </tr>
                    <tr>
                        <th>Width</th>
                        <td>' . $image['output']['width'] . '</td>
                    </tr>
                    <tr>
                        <th>Height</th>
                        <td>' . $image['output']['height'] . '</td>
                    </tr>
                    <tr>
                        <th>Data</th>
                        ' . (isset($image['output']['data']) ? '<td class="bytes">' . ellipsis(base64_encode($image['output']['data']), 50) . '</td>' : '<td>Output data was not sent, add the "output" value to the <code>data-post</code> property to send it along.</td>') . '
                    </tr>
                </tbody>
            ';
            }
            if (isset($image['actions'])) {
                echo '
                <tbody>
                <tr>
                    <th colspan="2">Crop</th>
                </tr>
                <tr>
                    <th>Type</th>
                    <td>' . $image['actions']['crop']['type'] . '</td>
                </tr>
                <tr>
                    <th>X</th>
                    <td>' . $image['actions']['crop']['x'] . '</td>
                </tr>
                <tr>
                    <th>Y</th>
                    <td>' . $image['actions']['crop']['y'] . '</td>
                </tr>
                <tr>
                    <th>Width</th>
                    <td>' . $image['actions']['crop']['width'] . '</td>
                </tr>
                <tr>
                    <th>Height</th>
                    <td>' . $image['actions']['crop']['height'] . '</td>
                </tr>
            </tbody>
            <tbody>
                <tr>
                    <th colspan="2">Size</th>
                </tr>
                <tr>
                    <th>Width</th>
                    <td>' . $image['actions']['size']['width'] . '</td>
                </tr>
                <tr>
                    <th>Height</th>
                    <td>' . $image['actions']['size']['height'] . '</td>
                </tr>
            </tbody>
            ';
            }
            echo '
        <tbody>
            <tr>
                <th colspan="2">Meta</th>
            </tr>
            <tr>
                <th>Data</th>
                <td>' . ($image['meta'] ? json_encode($image['meta']) : 'No meta data received') . '</td>
            </tr>
        </tbody>
    </table>
    </div>';
        }
    }
    function ellipsis($str, $len = 50)
    {
        return strlen($str) > $len ? substr($str, 0, $len) . '...' : $str;
    }
}
function BloqueBloqueBannerDinamicoIdMalla($id_empresa, $id_malla, $rut)
{
    $vio_banner = VioBannerMalla($rut, $id_empresa, $id_malla);
    return $vio_banner;
}
function ColocaOpcionesDeMetrica($id_empresa, $id_dimension)
{
    $metricas_por_dimension = totalMetricasObjetivosPorEmpresaDimension($id_empresa, $id_dimension);
    foreach ($metricas_por_dimension as $metrica) {
        $option .= "<option value='" . $metrica->id_metrica . "'>" . $metrica->metrica . "</option>";
    }
    return (($option));
}
function ColocaObjetivoEmpresaGerencia($PRINCIPAL, $rut, $id_empresa)
{
    //primero traigo los objetivos de la empresa
    $objetivos_empresa = TrarObjetivosEmpresa($id_empresa);
    $html_empresa      = file_get_contents("views/sgd/objetivos/dimensiones/formulario_76_lectura_empresa.html");
    foreach ($objetivos_empresa as $obj) {
        $row_empresa .= file_get_contents("views/sgd/objetivos/dimensiones/row_formulario_76_lectura_empresa.html");
        $row_empresa = str_replace("{CATEGORY}", $obj->dimension, $row_empresa);
        $row_empresa = str_replace("{KPI}", $obj->kpi, $row_empresa);
        $row_empresa = str_replace("{UNIT}", $obj->metrica, $row_empresa);
        $row_empresa = str_replace("{TARGET}", $obj->descripcion_objetivo, $row_empresa);
        $row_empresa = str_replace("{WEIGHT}", $obj->ponderacion, $row_empresa);
        $row_empresa = str_replace("{KPI_POINTS}", $obj->puntos_kpi, $row_empresa);
        $row_empresa = str_replace("{PAYOUT_RATIO}", $obj->pago, $row_empresa);
    }
    $html_empresa       = str_replace("{ROW_INGRESADOS}", $row_empresa, $html_empresa);
    $datos_usuario      = UsuarioEnBasePersonas($rut);
    $objetivos_gerencia = TrarObjetivosPorGerencia($id_empresa, $datos_usuario[0]->gerencia);
    $html_gerencia      = file_get_contents("views/sgd/objetivos/dimensiones/formulario_76_lectura_gerencia.html");
    $html_gerencia      = str_replace("{NOMBRE_GERENCIA}", $datos_usuario[0]->gerencia, $html_gerencia);
    foreach ($objetivos_gerencia as $obj_gere) {
        $row_gerencia .= file_get_contents("views/sgd/objetivos/dimensiones/row_formulario_76_lectura_gerencia.html");
        $row_gerencia = str_replace("{KPI}", $obj_gere->kpi, $row_gerencia);
        $row_gerencia = str_replace("{UNIT}", $obj_gere->metrica, $row_gerencia);
        $row_gerencia = str_replace("{TARGET}", $obj_gere->descripcion_objetivo, $row_gerencia);
        $row_gerencia = str_replace("{WEIGHT}", $obj_gere->ponderacion, $row_gerencia);
        $row_gerencia = str_replace("{KPI_POR}", $obj_gere->kpi_por, $row_gerencia);
    }
    $html_gerencia = str_replace("{ROW_INGRESADOS}", $row_gerencia, $html_gerencia);
    $PRINCIPAL     = str_replace("{BLOQUE_FORMULARIOS_POR_DIMENSIONES}", ($html_empresa . "<br>" . $html_gerencia), $PRINCIPAL);
    return ($PRINCIPAL);
}
function ColocaResumenPorEquipo($PRINCIPAL, $rut, $id_empresa, $id_proceso)
{
    $evaluados              = TraeRelacionesSinAeConDatos($rut, $id_proceso);
    $row_nombre_colaborares = "";
    foreach ($evaluados as $eva) {
        $row_nombre_colaborares .= "<td class='borde_azul_bottom2'>" . $eva->nombre_completo . "</td>";
    }
    //Primero traigo todas las dimeniones
    $dimsiones = DimensionesObjetivosPorEmpresa($id_empresa);
    foreach ($dimsiones as $dimen) {
        //Por cada dimension hago un select distinct del campo descripcion objetivo, mientras sea vacio
        $row_html_ponderaciones .= "<tr><td class='borde_azul_bottom2'><b>" . $dimen->nombre . "</b></td>
        <td class='borde_azul_bottom2' colspan='" . count($evaluados) . "'>&nbsp;</td></tr>";
        $descripcion_objetivos = DistinctCampoDescripcionObjetivosPorDimensionEmpresa($id_empresa, $dimen->id);
        foreach ($descripcion_objetivos as $descr_ob) {
            //luego pro cada descripcion de objetivo, veo si lo tiene cada colaborador, si lo tiene, coloco la ponderacion
            $row_html_ponderaciones .= "<tr>";
            $row_html_ponderaciones .= "<td class='borde_azul_bottom2'>" . $descr_ob->descripcion_objetivo . "</td>";
            foreach ($evaluados as $eva) {
                $tiene_objetivo = ColaboradorTieneObjetivoDadodimensionDescripcionRutIdempresa($id_empresa, $eva->evaluado, $descr_ob->descripcion_objetivo, $dimen->id);
                if ($tiene_objetivo[0]->ponderacion) {
                    $row_html_ponderaciones .= "<td class='borde_azul_bottom2'>" . $tiene_objetivo[0]->ponderacion . "%</td>";
                } else {
                    $row_html_ponderaciones .= "<td class='borde_azul_bottom2'></td>";
                }
            }
            $row_html_ponderaciones .= "</tr>";
        }
    }
    $PRINCIPAL = str_replace("{ROW_POR_COLABORADOR_PONDERACIONES}", ($row_html_ponderaciones), $PRINCIPAL);
    $PRINCIPAL = str_replace("{ROW_TABLA_COLABORADORES}", ($row_nombre_colaborares), $PRINCIPAL);
    return ($PRINCIPAL);
}
function ColocaCantidadDeFavorito($html, $id_mp, $id_empresa)
{
    //veo si este usuario para esta mp y para esta empresa, ya tiene un Me Gusta
    $total_interaccioneS_por_mp = COMUNIDAD_TieneInteraccion($id_empresa, $id_mp, "FAVORITA");
    $html                       = str_replace("{CANTIDAD_FAVORITOS}", count($total_interaccioneS_por_mp), $html);
    return ($html);
    }
function VerificaRelacionEvaluadoEvaluadorDadoRelMallaPersona($rut, $rut2, $id_empresa)
{
    //traigo la relacion de rel_lms_malla_persona
    $rel_lms_malla_persona = LS_TraeMallaConPerfilSGD($rut, $id_empresa);
    $id_perfil             = $rel_lms_malla_persona[0]->id_malla;
    //ahora veo si tiene este perfil en la tabla tbl_Sgd_relaciones
    $tiene_Relacion        = LMS_TraeRelacionAE($rut, $rut2, $id_empresa, $id_perfil);
    if (count($tiene_Relacion) == 0) {
        //Inserto registro en la tabla relaciones sgd
        LMS_InsertaRelacionEvaluadoEvaluador($rut, $rut2, $id_empresa, $id_perfil);
    }
}
function MuestraInformeIndividualDesdeVistaJefe($rut, $id_objeto)
{
    $datos_objeto = DatosObjeto($id_objeto);
    if ($datos_objeto[0]->preguntas_aleatorias > 0) {
        $datos_preguntas = PreguntasDadoIdObjetoaleatorio($id_objeto, $rut);
    } else {
        $datos_preguntas = PreguntasDadoIdObjeto($id_objeto);
    }
    $total_preguntas = "";
    $i               = 1;
    $correctas       = 0;
    foreach ($datos_preguntas as $preg) {
        $total_preguntas .= file_get_contents("views/integracion/" . $_SESSION["id_empresa"] . "_row_preguntas_respuestas.html");
        $total_preguntas   = str_replace("{N}", $i, $total_preguntas);
        $total_preguntas   = str_replace("{PREGUNTA}", $preg->pregunta, $total_preguntas);
        //Verifico si la respuesta que ingreso el usuario para eta pregunta es correcta o no
        $respuesta_usuario = ObtenerRespuestaDeUsuario($preg->id, $rut);
        //print_r($respuesta_usuario);
        $total_preguntas   = str_replace("{TURESPUESTA}", $respuesta_usuario[0]->alternativa, $total_preguntas);
        if ($respuesta_usuario[0]->correcta == "1") {
            $total_preguntas = str_replace("{COLOR_FONDO}", "color_aprobado_text", $total_preguntas);
            $total_preguntas = str_replace("{ICONO_INFORME_PREGUNTAS}", "fas fa-check-square", $total_preguntas);
            $total_preguntas = str_replace("{RESPUESTA_CORRECTA}", "", $total_preguntas);
            $correctas++;
        } else {
            $total_preguntas = str_replace("{COLOR_FONDO}", "color_reprobado_text", $total_preguntas);
            $total_preguntas = str_replace("{ICONO_INFORME_PREGUNTAS}", "far fa-times-circle", $total_preguntas);
            if ($_SESSION["id_empresa"] <> 57) {
                if (file_exists("views/cursos/informe/" . $_SESSION["id_empresa"] . "_row_respuesta_correcta.html")) {
                    $total_preguntas = str_replace("{RESPUESTA_CORRECTA}", file_get_contents("views/cursos/informe/" . $_SESSION["id_empresa"] . "_row_respuesta_correcta.html"), $total_preguntas);
                } else {
                    $total_preguntas = str_replace("{RESPUESTA_CORRECTA}", file_get_contents("views/cursos/informe/row_respuesta_correcta.html"), $total_preguntas);
                }
            } else {
                $total_preguntas = str_replace("{RESPUESTA_CORRECTA}", "", $total_preguntas);
            }
            $total_preguntas   = str_replace("{CORRECTA}", $respuesta_usuario[0]->alternativa_correcta, $total_preguntas);
            $total_preguntas   = str_replace("{PUNTOS}", round($respuesta_usuario[0]->puntaje), $total_preguntas);
            $total_suma_puntos = $total_suma_puntos + round($respuesta_usuario[0]->puntaje);
        }
        $i++;
    }
    return ($total_preguntas);
}
function MuestraMetassucursales($PRINCIPAL, $evaluado, $id_empresa, $id_proceso, $tipo)
{
    //Trae indicadores
    $cumplimiento_final = METAS_CumplimientoNotaFinal($evaluado);
    $html .= '<div class="TituloSGDDimensiones">
    Resultado  Final&nbsp;&nbsp;|&nbsp;&nbsp; <small>Ponderaci?n:</small> <b>' . $cumplimiento_final[0]->nota . '%</b>
</div>';
    $indicadores = METAS_Indicadores($evaluado, $id_empresa);
    if ($tipo == "pdf") {
        $html .= file_get_contents("views/sgd/objetivos/dimensiones/pdf_row_formulario_indicadores_61.html");
    } else {
        $html .= file_get_contents("views/sgd/objetivos/dimensiones/row_formulario_indicadores_61.html");
    }
    $html  = str_replace("{VARIABLE_NEGOCIO}", $indicadores[0]->variable_negocio, $html);
    $html  = str_replace("{VARIABLE_CONTROL}", $indicadores[0]->variable_control, $html);
    $html  = str_replace("{VARIABLE_SERVICIO}", $indicadores[0]->variable_servicio, $html);
    $html  = str_replace("{PANEL_CONTROL}", $indicadores[0]->panel_control, $html);
    $html  = str_replace("{CUMPLIMIENTO}", $indicadores[0]->cumplimiento, $html);
    //Resultados Clima
    $clima = METAS_CLIMA($evaluado, $id_empresa);
    if ($tipo == "pdf") {
        $html .= file_get_contents("views/sgd/objetivos/dimensiones/pdf_row_formulario_clima_61.html");
    } else {
        $html .= file_get_contents("views/sgd/objetivos/dimensiones/row_formulario_clima_61.html");
    }
    $html      = str_replace("{VA}", $clima[0]->va, $html);
    $html      = str_replace("{VC}", $clima[0]->vc, $html);
    $html      = str_replace("{TI}", $clima[0]->ti, $html);
    $html      = str_replace("{CUMPLIMIENTO}", $clima[0]->cumplimiento, $html);
    //DEsempe?o Laboral
    $desempeno = METAS_DESEMPENO($evaluado, $id_empresa);
    if ($tipo == "pdf") {
        $html .= file_get_contents("views/sgd/objetivos/dimensiones/pdf_row_formulario_desempeno_61.html");
    } else {
        $html .= file_get_contents("views/sgd/objetivos/dimensiones/row_formulario_desempeno_61.html");
    }
    $html      = str_replace("{PUNTAJE_FINAL}", $desempeno[0]->puntaje_final, $html);
    $html      = str_replace("{NOTA_FINAL}", $desempeno[0]->nota_final, $html);
    $html      = str_replace("{CUMPLIMIENTO}", $desempeno[0]->cumplimiento, $html);
    //Auditoria
    $auditoria = METAS_AUDITORIA($evaluado, $id_empresa);
    if ($tipo == "pdf") {
        $html .= file_get_contents("views/sgd/objetivos/dimensiones/pdf_row_formulario_auditoria_61.html");
    } else {
        $html .= file_get_contents("views/sgd/objetivos/dimensiones/row_formulario_auditoria_61.html");
    }
    $html           = str_replace("{AUDITORIA}", $auditoria[0]->auditoria2016, $html);
    $html           = str_replace("{TABLA_CLASIFICACION}", $auditoria[0]->tabla_clasificacion, $html);
    $html           = str_replace("{CUMPLIMIENTO}", $auditoria[0]->cumplimiento, $html);
    $datos_evaluado = UsuarioEnBasePersonasConEvaluadorValidador($evaluado);
    $PRINCIPAL      = str_replace("{RUT_COMPLETO}", ($datos_evaluado[0]->rut_completo), $PRINCIPAL);
    $PRINCIPAL      = str_replace("{NOMBRE}", ($datos_evaluado[0]->nombre_completo), $PRINCIPAL);
    $PRINCIPAL      = str_replace("{PERFIL_COMPETENCIAS}", ($datos_evaluado[0]->perfil_competencia), $PRINCIPAL);
    $PRINCIPAL      = str_replace("{FECHA_INGRESO}", formatearFechaCompleta($datos_evaluado[0]->fecha_ingreso), $PRINCIPAL);
    $PRINCIPAL      = str_replace("{JEFE}", ($datos_evaluado[0]->nombre_evaluador), $PRINCIPAL);
    $PRINCIPAL      = str_replace("{JEFE_DEL_JEFE}", ($datos_evaluado[0]->nombre_validador), $PRINCIPAL);
    $PRINCIPAL      = str_replace("{CARGO}", ($datos_evaluado[0]->cargo), $PRINCIPAL);
    $PRINCIPAL      = str_replace("{GERENCIA}", ($datos_evaluado[0]->gerencia), $PRINCIPAL);
    $PRINCIPAL      = str_replace("{DEPARTAMENTO}", ($datos_evaluado[0]->departamento), $PRINCIPAL);
    $PRINCIPAL      = str_replace("{GRUPO_COMPETENCIAS}", ($datos_evaluado[0]->perfil_competencia), $PRINCIPAL);
    $PRINCIPAL      = str_replace("{URL_PERSONA}", VerificaFotoPersonal($rut_evaluado), $PRINCIPAL);
    $PRINCIPAL      = str_replace("{BLOQUE_METAS_SUCURSALES_CENCO}", $html, $PRINCIPAL);
    $PRINCIPAL      = str_replace("{BLOQUE_FORMULARIOS_POR_DIMENSIONES}", $html, $PRINCIPAL);
    $arreglo[1]     = $PRINCIPAL;
    return ($arreglo);
}
function ConectaLDAPUltramar($user, $pass)
{
    $ldaprdn  = $user; // ldap rdn or dn
    $ldappass = $pass; // associated password
    session_start();
    $arreglo_user           = explode("@", $user);
    $datos_usuario          = UsuarioEnBasePersonaPorEmpresaCodigoSAP($arreglo_user[0]);
    $_SESSION["user_"]      = $datos_usuario[0]->rut;
    $_SESSION["id_empresa"] = $datos_usuario[0]->id_empresa;
    ValidarSesion("visitas", $_SESSION["id_empresa"]);
    $datos_proceso_anual           = ObtengoDatosProcesoAnualActivo($_SESSION["id_empresa"]);
    $_SESSION["id_proceso_anual"]  = $datos_proceso_anual[0]->id;
    $_SESSION["ano_proceso_anual"] = $datos_proceso_anual[0]->ano;
    $datos_empresa                 = DatosEmpresa($existe_base[0]->id_empresa);
    //      echo "LDAP bind successful...";
    ini_set("session.cookie_lifetime", "36000");
    ini_set("session.gc_maxlifetime", "36000");
    setcookie('user_', $datos_usuario[0]->rut, time() + 4800);
    setcookie('id_empresa', $datos_usuario[0]->id_empresa, time() + 4800);
    //echo "    <script>         location.href='?sw=home_ultramar_new';     </script>";
    echo "    <script>         location.href='?sw=com_mp_home';     </script>"; exit;
    $ldaprdn = $ldaprdn . "@holding.net";
    $ldapconn = ldap_connect("198.41.39.47") or die("Could not connect to LDAP server.");
    if ($ldapconn) {
        //echo "no hay conexion con servidor establecida, falta autenticaci?n con credenciales...<br><br>";
        // realizando la autenticaciÃ³n
        $ldapbind = ldap_bind($ldapconn, $ldaprdn, utf8_decode($ldappass));
        // verificaciÃ³n del enlace
        if ($ldapbind) {
            //echo "conexion Exitosa";
            //exit;
            session_start();
            $arreglo_user           = explode("@", $user);
            $datos_usuario          = UsuarioEnBasePersonaPorEmpresaCodigoSAP($arreglo_user[0]);
            $_SESSION["user_"]      = $datos_usuario[0]->rut;
            $_SESSION["id_empresa"] = $datos_usuario[0]->id_empresa;
            ValidarSesion("visitas", $_SESSION["id_empresa"]);
            $datos_proceso_anual           = ObtengoDatosProcesoAnualActivo($_SESSION["id_empresa"]);
            $_SESSION["id_proceso_anual"]  = $datos_proceso_anual[0]->id;
            $_SESSION["ano_proceso_anual"] = $datos_proceso_anual[0]->ano;
            $datos_empresa                 = DatosEmpresa($existe_base[0]->id_empresa);
            if ($_POST["rel"] == "1") {
                $_SESSION["rol"] = "relator";
            }
            //echo "    <script>         location.href='?sw=listMejIVPH&r=".$datos_usuario[0]->rut."';     </script>";
            //      echo "LDAP bind successful...";
            ini_set("session.cookie_lifetime", "36000");
            ini_set("session.gc_maxlifetime", "36000");
            setcookie('user_', $datos_usuario[0]->rut, time() + 4800);
            setcookie('id_empresa', $datos_usuario[0]->id_empresa, time() + 4800);
            //echo "    <script>         location.href='?sw=home_ultramar_new';     </script>";
            echo "    <script>         location.href='?sw=com_mp_home';     </script>";
            //echo "    <script>         location.href='?sw=com_mp_personal';     </script>";
            exit;
            //return("si");
        } else {
            //echo "LDAP bind failed...";
            exit;
            echo "    <script>         location.href='?sw=logultramarv2';     </script>";
            exit;
            //return("no");
        }
    } else {
    }
}
function ColocaBotonCompromisosPorcolaborador($id_empresa)
{
    $boton .= file_get_contents("views/mi_equipo_lider/" . $id_empresa . "_boton_compromisos.html");
    return ($boton);
}
function rutemailaarroba($rut, $id_empresa){

    //echo "$rut, $id_empresa";

        $email  = TraeEmailUsuario($rut, $id_empresa);
        $arr_email= explode("@", $email);
        $nombre_email=$arr_email[0];
        $nombre="@".$nombre_email;

        return $nombre;

    }
function arrayUnique($array, $preserveKeys = false)
{
    // Unique Array for return
    $arrayRewrite = array();
    // Array with the md5 hashes
    $arrayHashes  = array();
    foreach ($array as $key => $item) {
        // Serialize the current element and create a md5 hash
        $hash = md5(serialize($item));
        // If the md5 didn't come up yet, add the element to
        // to arrayRewrite, otherwise drop it
        if (!isset($arrayHashes[$hash])) {
            // Save the current element hash
            $arrayHashes[$hash] = $hash;
            // Add element to the unique Array
            if ($preserveKeys) {
                $arrayRewrite[$key] = $item;
            } else {
                $arrayRewrite[] = $item;
            }
        }
    }
    return $arrayRewrite;
}
function ColocaPestanasFocosHome($rut, $id_empresa)
{
    $focos = ObtenerFocosPorRut($rut, $id_empresa);
    foreach ($focos as $foc) {
        $html_foco .= file_get_contents("views/home/focos_home/row_pestanas_focos.html");
        $html_foco = str_replace("{CODIGO_FOCO}", $foc->id_foco, $html_foco);
        $html_foco = str_replace("{NOMBRE_FOCO}", $foc->nombre_foco, $html_foco);
    }
    return ($html_foco);
}
function ReparaInconsistenciasObjetoCursoMallaAvance($rut, $id_empresa)
{
    //objetos con id curso vacio
    $objetosInconsistencias = ReparaInconsistenciasObjetoCursoMallaAvanceData($rut);
    foreach ($objetosInconsistencias as $objetoInconsistencia) {
        $id_cursoReparar = ReparaInconsistenciasBuscaCursoDadoObjetos($objetoInconsistencia->id_objeto, $id_empresa);
        //print_r($id_cursoReparar);
        ReparaInconsistenciasActualizaObjetoFinalizadoDadoObjetos($rut, $objetoInconsistencia->id_objeto, $id_cursoReparar[0]->id_curso, $id_empresa);
    }
    $objetosInconsistentesErroneos = ReparaInconsistenciasObjetoCursoIncorrectoData($rut);
    foreach ($objetosInconsistentesErroneos as $objetoInconsistenteErroneo) {
        $id_cursoReparar = ReparaInconsistenciasBuscaCursoDadoObjetos($objetoInconsistenteErroneo->id_objeto, $id_empresa);
        ReparaInconsistenciasActualizaObjetoFinalizadoDadoObjetos($rut, $objetoInconsistenteErroneo->id_objeto, $id_cursoReparar[0]->id_curso, $id_empresa);
    }
}
function ReparaInconsistenciasAvanceCurso($rut, $id_curso, $id_empresa)
{





    //$start = microtime(true);

    //echo "hola";
    $AvanceDetalle = ReparaInconsistenciasBuscaObjetoFinalizadosCurso($id_curso, $id_empresa, $rut);
    $nota          = GAMIFICACIONTraeDatosObjetosPorCurso($rut, $id_curso);
    $nota          = $nota[0]->promedio_por_curso;
    //echo "<br>diferencia $id_curso propuesto ";
    //echo $AvanceDetalle[0]->AvancePropuesto;
    //echo "escrito ";
    //    echo $AvanceDetalle[0]->AvanceEscrito;
    if ($AvanceDetalle[0]->AvancePropuesto >= 100) {
        $avance = 100;$estado = 1;
    }
    if ($AvanceDetalle[0]->AvancePropuesto <= 100) {
        $avance = $AvanceDetalle[0]->AvancePropuesto;$estado = 3;
    }
    $datos_objeto = TraigoObjetoCertificacionDadoCurso($id_curso, $id_empresa);
    //print_r($datos_objeto);
    //exit;
    if ($avance == 100) {
        if ($datos_objeto[0]->nota_aprobacion <> '' and $nota < $datos_objeto[0]->nota_aprobacion) {
            //REPROBADO
            //$estado=0;
            $estado             = 1;
            $estado_descripcion = "REPROBADO";
        } else {
            //APROBADO
            $estado             = 1;
            $estado_descripcion = "APROBADO";
        }
        //}
    }
    //echo $avance;exit;
    ReparaInconsistenciasActualizaIncripcionCierre($avance, $estado, $rut, $id_curso, $id_empresa, $nota, $estado_descripcion);
    //print_r($AvancePropuesto);
    //$CuentaObjetos
    //$avacePropuesta
    //$avanceEscrito
    //$Actualiza

    // $time_elapsed_secs = microtime(true) - $start;
    // $time_elapsed= gmdate("H:i:s", $time_elapsed_secs);
//echo "<br>Tiempo: $time_elapsed_secs";

}


function ColocaPaginacionDeComentarios($pagina, $id_objeto, $rut, $id_malla, $cantidad_comentarios)
{
    //$imagenes=FotosPorObjeto($id_objeto, $_SESSION["id_empresa"], "no");
    //echo "$pagina, $id_objeto, $rut, idmalla $id_malla";
    $imagenes    = FotosPorObjeto($id_objeto, $_SESSION["id_empresa"], "no", $id_malla);
    //traigo el total de comentarios por objeto
    $comentarios = ComentariosPorObjeto($id_objeto);
    //print_r($comentarios);
    if (!$pagina) {
        $pagina = 1;
    }
    $total_comentarios = count($comentarios);
    $paginacion        = file_get_contents("views/cursos/objetos/foro/entorno_paginacion.html");
    $total_paginas     = ceil($total_comentarios / $cantidad_comentarios);
    //echo "$imagenes_por_pagina, $total_imagenes, $total_paginas";
    for ($i = 1; $i <= $total_paginas; $i++) {
        $row .= file_get_contents("views/cursos/objetos/foro/row_paginacion.html");
        $row = str_replace("{NUMERO_PAGINA}", $i, $row);
        $row = str_replace("{PAGINA}", $i, $row);
        if ($pagina == $i) {
            $row = str_replace("{CLASE_ACTIVO}", "class='active'", $row);
        } else {
            $row = str_replace("{CLASE_ACTIVO}", "", $row);
        }
    }
    $paginacion = str_replace("{ROW_PAGINACION}", $row, $paginacion);
    return ($paginacion);
}
function ColocaBloqueTweets($PRINCIPAL, $rut)
{
    $tweets = TwwetsPorUsuario($rut);
    foreach ($tweets as $Tw) {
        $linea .= file_get_contents("views/mejorespracticas/53_mp_row_tweets.html");
        $linea = str_replace("{TEXTO_TWEET}", $Tw->tweet, $linea);
        $linea = str_replace("{FECHA_TWEET}", $Tw->fecha, $linea);
    }
    $PRINCIPAL = str_replace("{ROW_TWEETS}", $linea, $PRINCIPAL);
    return ($PRINCIPAL);
}
function ColocaComentariosCoach($id_ivph)
{
    //traigo los comentarios de los coach del ivph
    $comentarios = ComentariosCoahPorIVPH($id_ivph);
    if ($comentarios) {
        $listado .= "<div class='row'>
        <div class='col-xs-3 badge badge-info'>Comentarios Coach</div>
        <div class='col-xs-8 badge badge-info'></div>
        <div class='col-xs-1'>&nbsp;</div>
        </div>";
    }
    foreach ($comentarios as $comen) {
        if ($comen->tipo == "Privado") {
            if ($comen->rut_autor == $_SESSION["user_"] or $comen->rut_coach == $_SESSION["user_"]) {
                $listado .= "<div class='row'>
                <div class='col-xs-1'>&nbsp;</div>
                <div class='col-xs-6'>" . $comen->comentario . "</div>
                <div class='col-xs-2'>" . $comen->fecha . "</div>
                <div class='col-xs-2'>" . $comen->hora . "</div>
                <div class='col-xs-1'>&nbsp;</div>
            </div>";
            }
        } else {
            $listado .= "<div class='row'>
                <div class='col-xs-1'>&nbsp;</div>
                <div class='col-xs-6'>" . $comen->comentario . "</div>
                <div class='col-xs-2'>" . $comen->fecha . "</div>
                <div class='col-xs-2'>" . $comen->hora . "</div>
                <div class='col-xs-1'>&nbsp;</div>
            </div>";
        }
    }
    return ($listado);
}
function SubirEvidencia2($FILES, $extension_doc, $prefijo, $ruta, $numero)
{
    //echo "$extension_archivo, $prefijo, $ruta";exit;
    //$ruta_con_archivo=$ruta."/".$prefijo."_BK.".$extension_archivo;
    $ruta_con_archivo = $ruta . "/" . $prefijo . "." . $extension_doc;
    copy($FILES['evidencia2']['tmp_name'], $ruta_con_archivo);
    $nombre_imagen_video = $prefijo . "." . $extension_doc;
    //RedimensionarImagenSlider($ruta_con_archivo, $nombre_imagen_slider);
    //Devuelvol un arreglo, con datos del archivo subido
    $arreglo[0]          = $ruta_con_archivo; //Ruta Completa
    $arreglo[1]          = $prefijo . "." . $extension_doc; //Nombre del Archivo
    $arreglo[2]          = $ruta . "/" . $prefijo; //Ruta del Objeto sin el index
    return ($arreglo);
}
function SubirEvidencia1($FILES, $extension_doc, $prefijo, $ruta, $numero)
{
    //echo "$extension_archivo, $prefijo, $ruta";exit;
    //$ruta_con_archivo=$ruta."/".$prefijo."_BK.".$extension_archivo;
    $ruta_con_archivo = $ruta . "/" . $prefijo . "." . $extension_doc;
    copy($FILES['evidencia1']['tmp_name'], $ruta_con_archivo);
    $nombre_imagen_video = $prefijo . "." . $extension_doc;
    //RedimensionarImagenSlider($ruta_con_archivo, $nombre_imagen_slider);
    //Devuelvol un arreglo, con datos del archivo subido
    $arreglo[0]          = $ruta_con_archivo; //Ruta Completa
    $arreglo[1]          = $prefijo . "." . $extension_doc; //Nombre del Archivo
    $arreglo[2]          = $ruta . "/" . $prefijo; //Ruta del Objeto sin el index
    return ($arreglo);
}
function ColocaBloqueCoach($PRINCIPAL, $rut)
{
    //verifico si es coach el usuario
    $mp = ListadoPlanesPorCoach($rut, $_SESSION["id_empresa"]);
    if ($mp) {
        $PRINCIPAL = str_replace("{BLOQUE_COACH}", file_get_contents("views/mejorespracticas/53_mp_entorno_coach.html"), $PRINCIPAL);
    } else {
        $PRINCIPAL = str_replace("{BLOQUE_COACH}", "", $PRINCIPAL);
    }
    return ($PRINCIPAL);
}
function BloquefijacionObjetivosPlanes($evaluado, $evaluador, $id_empresa, $id_proceso)
{
    $html      = file_get_contents("views/sgd/informe/" . $id_empresa . "_entorno_fijacion_objetivos_planes.html");
    //Traigo los objetivos de este evaluado
    $objetivos = TraigoObjetivoFijacionTodos($evaluado, $evaluador, $id_proceso, "objetivo", "objetivo");
    $i         = 1;
    foreach ($objetivos as $obj) {
        $total_objetivos .= file_get_contents("views/sgd/informe/" . $id_empresa . "_row_fijacion_objetivos_planes.html");
        $total_objetivos = str_replace("{NUMERO}", ($i), $total_objetivos);
        $i++;
        $total_objetivos = str_replace("{VALOR1}", ($obj->objetivo), $total_objetivos);
        $total_objetivos = str_replace("{VALOR2}", ($obj->medicion_cumplimiento), $total_objetivos);
    }
    $html           = str_replace("{ROW_FIJACION_OBJETIVOS}", ($total_objetivos), $html);
    $listado_planes = TraigoObjetivoFijacionTodos($evaluado, $evaluador, $id_proceso, "plan", "areas_desarrollo");
    $i              = 1;
    foreach ($listado_planes as $plan) {
        $total_planes .= file_get_contents("views/sgd/informe/" . $id_empresa . "_row_fijacion_objetivos_planes.html");
        $total_planes = str_replace("{NUMERO}", ($i), $total_planes);
        $i++;
        $total_planes = str_replace("{VALOR1}", ($plan->areas_desarrollo), $total_planes);
        $total_planes = str_replace("{VALOR2}", ($plan->acciones_requeridas), $total_planes);
    }
    $html = str_replace("{ROW_FIJACION_PLANES}", ($total_planes), $html);
    return ($html);
}
function BloqueInteresesDesarrollo($evaluado, $evaluador, $id_empresa, $id_proceso)
{
    $html         = file_get_contents("views/sgd/informe/" . $id_empresa . "_entorno_intereses_desarrollo.html");
    $intereses_ae = InteresesDesarrolloEvaluadoEvaluador($evaluado, $evaluado, $id_proceso, $id_empresa);
    foreach ($intereses_ae as $interes) {
        $total_intereses_ae .= $interes->nombre_interes . "<br>";
    }
    $intereses_desc = InteresesDesarrolloEvaluadoEvaluador($evaluado, $evaluador, $id_proceso, $id_empresa);
    foreach ($intereses_desc as $interes) {
        $total_intereses_desc .= $interes->nombre_interes . "<br>";
    }
    $html    = str_replace("{LISTADO_INTERESES_AE}", ($total_intereses_ae), $html);
    $html    = str_replace("{LISTADO_INTERESES_DESC}", ($total_intereses_desc), $html);
    $sucesor = TieneComentariosFinalesSGD($evaluado, $evaluado, $id_proceso);
    $html    = str_replace("{SUCESOR}", ($sucesor[0]->sucesor), $html);
    return ($html);
}
function BloqueUltimaPReguntaForm($rut, $id_empresa)
{
    $template       = file_get_contents("views/mensajeria/mensajeria_ultima_pregunta.html");
    //Traigo ultima pregunta realizada
    $ultimo_mensaje = UltimoMensajeMensajeria($rut, $id_empresa);
    return ($template);
}
function ColocaFormularioContactate($PRINCIPAL, $id_empresa, $rut)
{
    $PRINCIPAL = str_replace("{RUT_ENCODEADO}", Encodear3($rut), $PRINCIPAL);
    return ($PRINCIPAL);
}
function ListadoIVPH($PRINCIPAL, $id_empresa, $rut, $ord_by, $filt_by, $filt_cat, $vp, $tipo_listado)
{
    if ($tipo_listado == "MisPlanes") {
        $todas = ListadoIvphPorRutEmpresaPlanes($rut, $id_empresa);
    } else if ($tipo_listado == "MisInteracc") {
        ////$todas=ListadoIvphPorRutEmpresa($rut, $id_empresa);
        $todas = ListadoIvphPorRutEmpresaInteracciones($rut, $id_empresa, $_GET["id_mp"]);
    } else if ($tipo_listado == "coachIvph") {
        ////$todas=ListadoIvphPorRutEmpresa($rut, $id_empresa);
        $todas = ListadoPlanesPorCoach($rut, $id_empresa);
    } else if ($tipo_listado == "VeIVPH") {
        $todas = ListadoIvphPorID($_GET["id_mp"], $id_empresa);
    } else {
        $todas = ListadoIvphPorRutEmpresa($rut, $id_empresa);
    }
    $total_listado = "";
    $i             = 1;
    foreach ($todas as $unico) {
        $total_listado .= file_get_contents("views/mejorespracticas/53_mp_row_listado.html");
        if ($unico->rut == $_SESSION["user_"]) {
            if ($unico->id_estado == 2 or $unico->id_estado == 3) {
                $total_listado = str_replace("{BLOQUE_CIERRE}", "<img src='img/green.png' width='15'>", $total_listado);
            } else {
                $total_listado = str_replace("{BLOQUE_CIERRE}", file_get_contents("views/mejorespracticas/53_mp_row_listado_estado.html"), $total_listado);
            }
        } else {
            $total_listado = str_replace("{BLOQUE_CIERRE}", "", $total_listado);
        }
        $total_listado = str_replace("{ID_MP}", $unico->id_mp, $total_listado);
        $total_listado = str_replace("{LINK}", $link_MP, $total_listado);
        if ($unico->coach == $_SESSION["user_"]) {
            if ($unico->id_estado == 2) {
                $total_listado = str_replace("{BLOQUE_VALIDA_COACH}", file_get_contents("views/mejorespracticas/53_mp_coach_valida.html"), $total_listado);
            } else {
                $total_listado = str_replace("{BLOQUE_VALIDA_COACH}", "", $total_listado);
            }
        } else {
            $total_listado = str_replace("{BLOQUE_VALIDA_COACH}", "", $total_listado);
        }
        $total_listado         = str_replace("{CATEGORIA_MP}", ($unico->categoria), $total_listado);
        $total_listado         = str_replace("{NUMERO}", ($i), $total_listado);
        //$total_listado = str_replace("{PORC}",round($unico->promedio_avances_plan),$total_listado);
        $total_planes          = TotalPlanesPorMp($unico->id_mp, $_SESSION["id_empresa"]);
        $total_planes_cerrados = TotalPlanesPorMpCerrados($unico->id_mp, $_SESSION["id_empresa"]);
        $porcentaje            = (count($total_planes_cerrados) * 100) / count($total_planes);
        $total_listado         = str_replace("{PORC}", round($porcentaje), $total_listado);
        //echo "<b>".round($porcentaje)."%</b>";
        $total_listado         = str_replace("{PROBLEMATICA}", ($unico->problema), $total_listado);
        $total_listado         = str_replace("{NOMBRE}", ($unico->nombre), $total_listado);
        $total_listado         = str_replace("{COACH}", ($unico->nombre_coach), $total_listado);
        $total_listado         = str_replace("{KPI}", ($unico->kpi_afectado), $total_listado);
        $total_listado         = str_replace("{CUANTIFICACION}", ($unico->cuantificacion), $total_listado);
        $total_listado         = str_replace("{CANTIDAD_EQUIPO}", ($unico->total_equipo), $total_listado);
        $total_listado         = str_replace("{CANTIDAD_PLANES}", ($unico->total_planes), $total_listado);
        $total_listado         = str_replace("{DOCUMENTO}", ($unico->archivo), $total_listado);
        $total_listado         = str_replace("{DOCUMENTO2}", ($unico->archivo2), $total_listado);
        $total_listado         = str_replace("{EVIDENCIA1}", ($unico->evidencia1), $total_listado);
        $total_listado         = str_replace("{EVIDENCIA2}", ($unico->evidencia2), $total_listado);
        $total_listado         = str_replace("{BLOQUE_LISTADO_COLABORADORES}", utf8_decode(ColocaBloqueEquipoMP($unico->id_mp, $id_empresa)), $total_listado);
        $total_listado         = str_replace("{BLOQUE_LISTADO_PLANES}", utf8_decode(BloquecomentariosPorMP($unico->id_mp, $id_empresa)), $total_listado);
        $total_listado         = str_replace("{BLOQUE_COMENTARIOS_COACH}", (ColocaComentariosCoach($unico->id_mp)), $total_listado);
        //trae los tags por MP
        $total_tags            = TagsPorMPEmpresa($unico->id_mp, $id_empresa);
        $total_tag             = "";
        foreach ($total_tags as $tag) {
            $total_tag .= "<span class='badge2 badge-info'>" . $tag->tag . "</span>&nbsp;&nbsp;&nbsp;";
        }
        $i++;
        $total_listado = str_replace("{TAGS}", $total_tag, $total_listado);
        $total_listado = str_replace("{CONTENIDO}", limit_text($unico->contenido, 25), $total_listado);
        $total_listado = str_replace("{FECHA}", formatearFechaSmall($unico->fecha), $total_listado);
        $total_listado = str_replace("{ESTADO}", ($unico->estado), $total_listado);
        $total_listado = str_replace("{DESCRIPCION_ESTADO}", ($unico->descripcion_estado), $total_listado);
        $total_listado = str_replace("{RUT_AUTOR}", ($unico->rut), $total_listado);
        $total_listado = str_replace("{NOMBRE_AUTOR}", ($unico->nombre_autor), $total_listado);
        $total_listado = str_replace("{FOTO_AUTOR}", VerificaFotoPersonal($unico->rut), $total_listado);
        $total_listado = str_replace("{NUMVISITAS}", round($unico->numvisitas), $total_listado);
        $total_listado = str_replace("{NUMMEGUSTA}", ($unico->nummegusta), $total_listado);
        $total_listado = str_replace("{NUMCOMPARTIDA}", ($unico->numcompartido), $total_listado);
        $total_listado = str_replace("{NUMCOMENTARIO}", ($unico->numcomentarios), $total_listado);
        $total_listado = str_replace("{ESTILOESTADO}", ($unico->estilo), $total_listado);
        $total_listado = str_replace("{ICONOESTADO}", ($unico->icono_estado), $total_listado);
        $total_listado = str_replace("{ESTILOCATEGORIA}", ($unico->style), $total_listado);
        $total_listado = str_replace("{ICONOCATEGORIA}", ($unico->icono), $total_listado);
        $total_listado = str_replace("{CATEGORIA_MP}", ($unico->categoria), $total_listado);
        $total_listado = str_replace("{ID_MP}", $unico->id_mp, $total_listado);
    }
    $PRINCIPAL = str_replace("{NUM_FAV}", MPbuscaFav($rut, $id_empresa), $PRINCIPAL);
    $PRINCIPAL = str_replace("{NUM_MISPR}", MPbuscaMp($rut, $id_empresa), $PRINCIPAL);
    $PRINCIPAL = str_replace("{INSIGNIA}", "", $PRINCIPAL);
    //$PRINCIPAL = str_replace("{ROW_LISTADO_RECIENTES}",($total_listado),$PRINCIPAL);
    $PRINCIPAL = str_replace("{ROW_LISTADO_IVPH}", ($total_listado), $PRINCIPAL);
    $PRINCIPAL = str_replace("{AGRUPACION_CATEGORIAS}", ($total_agrup_categoria), $PRINCIPAL);
    $PRINCIPAL = str_replace("{AGRUPACION_AMBITOS}", ($total_agrup_ambito), $PRINCIPAL);
    $PRINCIPAL = str_replace("{MAS_PROPOSITIVOS}", ($total_listado_mas_propositivo), $PRINCIPAL);
    $PRINCIPAL = str_replace("{MAS_COLABORADORES}", ($total_listado_mas_colaborador), $PRINCIPAL);
    $PRINCIPAL = str_replace("{MAS_APOYADORES}", ($total_listado_mas_apoyador), $PRINCIPAL);
    $PRINCIPAL = str_replace("{MAS_PARTICIPATIVOS}", ($total_listado_mas_participativo), $PRINCIPAL);
    $PRINCIPAL = str_replace("{MAS_MASTER}", ($total_listado_mas_master), $PRINCIPAL);
    $PRINCIPAL = str_replace("{TAG_CLOUD}", ($total_listado_tag_cloud), $PRINCIPAL);
    return ($PRINCIPAL);
}
function ColocarDatosHomeFinanciero($PRINCIPAL, $rut, $id_empresa)
{
    //Obtengo datos de la malla
    $datos_curso     = TotalcursosPorUsuaroEmpresa($rut, $id_empresa);
    //cuento el total de aprobados
    $total_aprobados = 0;
    foreach ($datos_curso as $cur) {
        if ($cur->estado == 1) {
            $total_aprobados++;
        }
    }
    $cuadro1 = "";
    $cuadro2 = "";
    $cuadro3 = "";
    $cuadro4 = "";
    $cuadro5 = "";
    $cuadro6 = "";
    $cuadro7 = "";
    $cuadro8 = "";
    if ($total_aprobados == 0) {
        $imagen_fondo = "bci_edu_fin_gameboard0.png";
        $cuadro1      = '{
                            "id" : "rect-biblioteca",
                            "type" : "rect",
                            "x" : 26.5,
                            "y" : 7,
                            "width" : 11,
                            "height" : 15.6,
                            "actions" : {
                                "click" : "follow-link",
                                "link" : "?sw=detalle_cursoCap&idc_senc=bci_ed_nivel1",
                                "open_link_in_new_window" : 0
                            },
                            "default_style" : {
                                "border_radius" : 10,
                                "background_color" : "#ffff00",
                                "background_opacity" : 0.05,
                                "border_width" : 4,
                                "border_style" : "dashed",
                                "border_color" : "#1e78af",
                                "border_opacity" : 0.40601503759398494
                            },
                            "mouseover_style" : {
                                "border_radius" : 10,
                                "background_color" : "#ffff00",
                                "border_style" : "dashed",
                                "border_color" : "#1e78af",
                                "background_opacity" : 0.15560385338345864
                            },
                            "tooltip_style" : {
                                "background_color" : "#00589b"
                            },
                            "tooltip_content" : {
                                "plain_text" : "Endeudamiento Responsable: En este nivel aprender?s a manejar tu nivel de Endeudamiento! (desde function)"
                            }}, ';
    } else if ($total_aprobados == 1) {
        $imagen_fondo = "bci_edu_fin_gameboard1.png";
        $cuadro1      = '{
                            "id" : "cuadro1",
                            "type" : "rect",
                            "x" : 26.5,
                            "y" : 7,
                            "width" : 11,
                            "height" : 15.6,
                            "actions" : {
                                "click" : "follow-link",
                                "link" : "?sw=detalle_cursoCap&idc_senc=bci_ed_nivel1",
                                "open_link_in_new_window" : 0
                            },
                            "default_style" : {
                                "border_radius" : 10,
                                "background_color" : "#ffff00",
                                "background_opacity" : 0.05,
                                "border_width" : 4,
                                "border_style" : "dashed",
                                "border_color" : "#1e78af",
                                "border_opacity" : 0.40601503759398494
                            },
                            "mouseover_style" : {
                                "border_radius" : 10,
                                "background_color" : "#ffff00",
                                "border_style" : "dashed",
                                "border_color" : "#1e78af",
                                "background_opacity" : 0.15560385338345864
                            },
                            "tooltip_style" : {
                                "background_color" : "#00589b"
                            },
                            "tooltip_content" : {
                                "plain_text" : "Endeudamiento Responsable: En este nivel aprender?s a manejar tu nivel de Endeudamiento! (desde function)"
                            }}, ';
        $cuadro2      = '
                            {"id" : "rect-cuadro2",
                            "type" : "rect",
                            "x" : 47,
                            "y" : 1,
                            "width" : 22,
                            "height" : 30,
                            "actions" : {
                                "click" : "follow-link",
                                "link" : "?sw=detalle_cursoCap&idc_senc=bci_ed_nivel2",
                                "open_link_in_new_window" : 0
                            },
                            "default_style" : {
                                "border_radius" : 10,
                                "background_color" : "#ffff00",
                                "background_opacity" : 0.05,
                                "border_width" : 5,
                                "border_style" : "dashed",
                                "border_color" : "#1e78af",
                                "border_opacity" : 0.7
                            },
                            "mouseover_style" : {
                                "border_radius" : 10,
                                "background_color" : "#ffff00",
                                "border_style" : "dashed",
                                "border_color" : "#1e78af",
                                "background_opacity" : 0.15560385338345864
                            },
                            "tooltip_style" : {
                                "background_color" : "#F6303E"
                            },
                            "tooltip_content" : {
                                "plain_text" : "Cuenta Vista / Cuenta Prima: En este nivel aprender?s qu? son las cuentas Vista y Prima, y sus caracter?sticas"
                            }}, ';
    } else if ($total_aprobados == 2) {
        $imagen_fondo = "bci_edu_fin_gameboard2.png";
    } else if ($total_aprobados == 3) {
        $imagen_fondo = "bci_edu_fin_gameboard3.png";
    } else if ($total_aprobados == 4) {
        $imagen_fondo = "bci_edu_fin_gameboard4.png";
    } else if ($total_aprobados == 5) {
        $imagen_fondo = "bci_edu_fin_gameboard5.png";
    } else if ($total_aprobados == 6) {
        $imagen_fondo = "bci_edu_fin_gameboard6.png";
    } else if ($total_aprobados == 7) {
        $imagen_fondo = "bci_edu_fin_gameboard7.png";
    } else if ($total_aprobados == 8) {
        $imagen_fondo = "bci_edu_fin_gameboard8.png";
    }
    //echo $imagen_fondo;
    $PRINCIPAL = str_replace("{IMAGEN_FONDO}", $imagen_fondo, $PRINCIPAL);
    $PRINCIPAL = str_replace("{CUADRO1}", $cuadro1, $PRINCIPAL);
    $PRINCIPAL = str_replace("{CUADRO2}", $cuadro2, $PRINCIPAL);
    $PRINCIPAL = str_replace("{CUADRO3}", $cuadro3, $PRINCIPAL);
    $PRINCIPAL = str_replace("{CUADRO4}", $cuadro4, $PRINCIPAL);
    return ($PRINCIPAL);
}
function EnviaCorreoGmailInscripciones($nombre_destinatario, $nombre_remitente, $id_empresa, $asunto, $template)
{
    $datos_destinatario = UsuarioEnBasePersonaPorEmpresa($destinatario, $id_empresa);
    $remitente          = UsuarioEnBasePersonaPorEmpresa($remitente, $id_empresa);
    $template           = str_replace("{NOMBRE_JEFE}", ($nombre_destinatario), $template);
    $template           = str_replace("{NOMBRE_COLABORADOR}", ($nombre_remitente), $template);
    $mail               = new PHPMailer;
    $mail->isSMTP(); //Enable SMTP debugging
    $mail->SMTPDebug   = 1;
    $mail->Debugoutput = 'error_log';
    $mail->Host        = "mail.ngd.cl";
    $mail->Port        = 25;
    $mail->SMTPAuth    = true;
    $mail->Username    = "soporte@ngd.cl";
    $mail->Password    = "N+N5TMTuS3=p";
    $mail->setFrom("soporte@ngd.cl", "CapacitacionBci");
    //$mail->addAddress($datos_destinatario[0]->email, $datos_destinatario[0]->nombre_completo);
    //$mail->addAddress("rod@gop.cl", $nombre_destinatario);
    $mail->addAddress("soporte@gop.cl", $nombre_destinatario);
    $mail->addAddress("daniel@gop.cl", $nombre_destinatario);
    //$mail->addAddress("rod@gop.cl", $datos_destinatario[0]->nombre_completo);
    //$mail->AddBCC("rod@gop.cl","BCC: ".$datos_destinatario[0]->nombre_completo);
    $mail->Subject = $asunto;
    $mail->msgHTML($template, dirname(__FILE__));
    $mail->AltBody = 'Si no puedes visualizar este correo ....';
    //send the message, check for errors
    if (!$mail->send()) {
        //echo "Mailer Error: " . $mail->ErrorInfo;
    } else {
        echo "Notificaci?n Enviada a " . $datos_destinatario[0]->email;
    }
}
function practicascompartidos($rut, $id_empresa)
{
    $arreglo_tips = Obtenerpracticascompartidos($rut, $id_empresa);
    //print_r($arreglo_tips);
    foreach ($arreglo_tips as $arreglo_tip) {
        $lista_tips .= "<div><blockquote><p>" . ($arreglo_tip->tip) . "</p>
    <p>" . ($arreglo_tip->masinfo) . "</p></blockquote></div><hr>";
    }
    return ($lista_tips);
}
function ColocaDatosEnPerfilV2($row, $rut, $id_empressa)
{
    $datos_mallapersona = buscamalla($rut, $id_empresa);
    $datos_mallapersona[0]->id_malla;
    $datos_malla        = DatosMalla($datos_mallapersona[0]->id_malla);
    //print_r($datos_malla);
    $datos_consolidados = TienePuntosConsolidadosPorMalla($rut, $id_empresa, $datos_mallapersona[0]->id_malla);
    $row                = str_replace("{PUNTOS}", $datos_consolidados[0]->puntos, $row);
    $promedio_trivias   = PromedioTrivias($rut, $id_empresa);
    if (!$promedio_trivias[0]->promedio_trivias) {
        $row = str_replace("{PROMEDIO}", "0", $row);
    } else {
        $row = str_replace("{PROMEDIO}", round($promedio_trivias[0]->promedio_trivias), $row);
    }
    if ($promedio_trivias[0]->promedio_trivias > 0) {
        $row = str_replace("{PODERES}", "<img src='img/61_rf_badges_5.png' width='20'>", $row);
    } else {
        $row = str_replace("{PODERES}", "", $row);
    }
    $medallas = "";
    for ($k = 1; $k <= $datos_consolidados[0]->medallas; $k++) {
        $medallas .= "<img src='img/rf_medal.png'> ";
    }
    //$row = str_replace("{MEDALLAS}",$datos_consolidados[0]->medallas,$row);
    $row = str_replace("{MEDALLAS}", $medallas, $row);
    return ($row);
}
function BloquecomentariosPorMP($id_mp, $id_empresa, $tipo)
{
    //Traigo el listado de planes por id mp
    $planes     = TotalPlanesPorMp($id_mp, $id_empresa);
    $i          = 1;
    $datos_ivph = TraeDatosMP2($id_mp, $id_empresa);
    foreach ($planes as $plan) {
        if ($tipo == "formulario") {
            $listado .= file_get_contents("views/mejorespracticas/" . $id_empresa . "_mp_row_plan.html");
        } else {
            if ($plan->evaluado == $_SESSION["user_"]) {
                if ($datos_ivph[0]->id_estado == 1) {
                    $listado .= file_get_contents("views/mejorespracticas/" . $id_empresa . "_mp_row_plan_seguimiento.html");
                } else {
                    $listado .= file_get_contents("views/mejorespracticas/" . $id_empresa . "_mp_row_plan_seguimiento_lectura.html");
                }
            } else {
                $listado .= file_get_contents("views/mejorespracticas/" . $id_empresa . "_mp_row_plan_seguimiento_lectura.html");
            }
            /*
             * elseif($plan->evaluado==$_SESSION["user_"]){
             $listado.=file_get_contents("views/mejorespracticas/".$id_empresa."_mp_row_plan_seguimiento_dueno_ivph.html");
             }else{
             $listado.=file_get_contents("views/mejorespracticas/".$id_empresa."_mp_row_plan_seguimiento_lectura.html");
             }
             *
             * */
        }
        $listado = str_replace("{NUMERO}", $i, $listado);
        if ($plan->seguimiento_grado_cumplimiento) {
            if ($plan->validado) {
                $listado = str_replace("{VALIDA}", file_get_contents("views/mejorespracticas/53_mp_row_plan_valida_dueno_ivph_validado.html"), $listado);
            } else {
                $listado = str_replace("{VALIDA}", file_get_contents("views/mejorespracticas/53_mp_row_plan_valida_dueno_ivph.html"), $listado);
            }
        } else {
            $listado = str_replace("{VALIDA}", "<center><img src='img/alert.png' alt='Pendiente' width='15'></center>", $listado);
        }
        $listado = str_replace("{CAUSA_RAIZ}", $plan->causa_raiz, $listado);
        $listado = str_replace("{PLAN}", $plan->plan, $listado);
        $listado = str_replace("{ID_PLAN}", $plan->id, $listado);
        $listado = str_replace("{ID_MP}", $id_mp, $listado);
        //$listado= str_replace("{RESPONSABLE}",$plan->responsable,$listado);
        $listado = str_replace("{RESPONSABLE}", ($plan->nombre_completo), $listado);
        $listado = str_replace("{FECHA}", $plan->fecha, $listado);
        //$listado= str_replace("{ESTADO_SEGUIMIENTO}",$plan->seguimiento_grado_cumplimiento,$listado);
        if ($plan->seguimiento_grado_cumplimiento == "Abierto") {
            $estado_plan = '<span class="badgeAbierto badge-info">' . $plan->seguimiento_grado_cumplimiento . '</span>';
        } else if ($plan->seguimiento_grado_cumplimiento == "Cerrado") {
            $estado_plan = '<span class="badgeCerrado badge-info">' . $plan->seguimiento_grado_cumplimiento . '</span>';
        } else if ($plan->seguimiento_grado_cumplimiento == "Cancelado") {
            $estado_plan = '<span class="badgeCancelado badge-info">' . $plan->seguimiento_grado_cumplimiento . '</span>';
        } else if ($plan->seguimiento_grado_cumplimiento == "Stand By") {
            $estado_plan = '<span class="badgeStandBy badge-info">' . $plan->seguimiento_grado_cumplimiento . '</span>';
        }
        $listado = str_replace("{ESTADO_SEGUIMIENTO}", $estado_plan, $listado);
        $listado = str_replace("{SELECT_" . $plan->seguimiento_grado_cumplimiento . "}", "selected='selected'", $listado);
        $listado = str_replace("{SELECT_Abierto}", "", $listado);
        $listado = str_replace("{SELECT_Cerrado}", "", $listado);
        $listado = str_replace("{SELECT_Cancelado}", "", $listado);
        $listado = str_replace("{SELECT_Stand}", "", $listado);
        $i++;
    }
    return ($listado);
}
function ColocaBloqueEquipoMP($id_mp, $id_empresa)
{
    //Traigo el total de equipo por mp
    $equipo   = TotalEquipoPorMp($id_mp, $id_empresa);
    $i        = 1;
    $datos_mp = TraeDatosMP2($id_mp, $id_empresa);
    foreach ($equipo as $equ) {
        if ($datos_mp[0]->rut == $_SESSION["user_"]) {
            $listado .= file_get_contents("views/mejorespracticas/" . $id_empresa . "_mp_row_equipo.html");
        } else {
            $listado .= file_get_contents("views/mejorespracticas/" . $id_empresa . "_mp_row_equipo_lectura.html");
        }
        $listado = str_replace("{ID}", $equ->id, $listado);
        $listado = str_replace("{ID_MP}", $equ->id_mp, $listado);
        $listado = str_replace("{NUMERO}", $i, $listado);
        $listado = str_replace("{NOMBRE_COLABORADOR}", ($equ->nombre_completo), $listado);
        $i++;
    }
    return ($listado);
}
function ColocaBloquePreguntaPorObjetoUnicaRadio($id_objeto, $rut, $tipo)
{
    $pregunta        = PreguntaDadoIdObjeto($id_objeto, $tipo);
    $tipo            = $pregunta[0]->tipo;
    $bloque_archivos = "";
    $tiene_respuesta = VerificaRespuestaPorPreguntaObjetoUsuario($id_objeto, $pregunta[0]->id, $rut);
    //si tiene respuesta
    if ($tiene_respuesta) {
        if ($tipo == 1) {
            $bloque_archivos = MuestraResultadosPreguntaPorObjeto($id_objeto, $pregunta[0]->id, $rut);
        } else if ($tipo == 2) {
            $bloque_archivos = MuestraResultadosPreguntaPorObjetoCheck($id_objeto, $pregunta[0]->id, $rut);
        } else if ($tipo == 3) {
            $bloque_archivos = MuestraResultadosPreguntaPorObjetoCheck($id_objeto, $pregunta[0]->id, $rut);
            //}else if($tipo==4){
        } else {
            $bloque_archivos = MuestraResultadosPreguntaPorObjeto4($id_objeto, $pregunta[0]->id, $rut);
        }
    } else {
        $bloque_archivos = file_get_contents("views/cursos/contenidos/entorno_bloque_pregunta" . $tipo . ".html");
        $bloque_archivos = str_replace("{PREGUNTA}", ($pregunta[0]->pregunta), $bloque_archivos);
        $bloque_archivos = str_replace("{ID_PREGUNTA_ENCODEADA}", ($pregunta[0]->id), $bloque_archivos);
        //Coloco las alternativas
        //$alternativas=AlternativasDadoGupoId($pregunta[0]->id_alternativas);
        $alternativas    = AlternativasDadoGupoId(1);
        foreach ($alternativas as $alt) {
            $alternativas_html .= file_get_contents("views/cursos/contenidos/row_alternativa_pregunta_objeto_radio.html");
            $alternativas_html = str_replace("{ALTERNATIVA}", $alt->alternativa, $alternativas_html);
            $alternativas_html = str_replace("{VALUE_CHECK}", $alt->id, $alternativas_html);
            $alternativas_html = str_replace("{NAME}", $pregunta[0]->id, $alternativas_html);
        }
        $bloque_archivos = str_replace("{TOTAL_ALTERNATIVAS}", count($alternativas), $bloque_archivos);
        $bloque_archivos = str_replace("{OPCIONES}", $alternativas_html, $bloque_archivos);
    }
    return ($bloque_archivos);
}
function EnviaCorreoGmail($destinatario, $remitente, $id_empresa, $asunto, $template)
{
    $datos_destinatario = UsuarioEnBasePersonaPorEmpresa($destinatario, $id_empresa);
    $remitente          = UsuarioEnBasePersonaPorEmpresa($remitente, $id_empresa);
    $template           = str_replace("{NOMBRE_JEFE}", ($datos_destinatario[0]->nombre_completo), $template);
    $template           = str_replace("{NOMBRE_COLABORADOR}", ($remitente[0]->nombre_completo), $template);
    $mail               = new PHPMailer;
    $mail->isSMTP(); //Enable SMTP debugging
    $mail->SMTPDebug   = 1;
    $mail->Debugoutput = 'error_log';
    $mail->Host        = "mail.ngd.cl";
    $mail->Port        = 25;
    $mail->SMTPAuth    = true;
    $mail->Username    = "soporte@ngd.cl";
    $mail->Password    = "N+N5TMTuS3=p";
    $mail->setFrom("soporte@ngd.cl", "CapacitacionBci");
    $mail->addAddress($datos_destinatario[0]->email, $datos_destinatario[0]->nombre_completo);
    //$mail->addAddress("rod@gop.cl", $datos_destinatario[0]->nombre_completo);
    $mail->AddBCC("rod@gop.cl", "BCC: " . $datos_destinatario[0]->nombre_completo);
    $mail->Subject = $asunto;
    $mail->msgHTML($template, dirname(__FILE__));
    $mail->AltBody = 'Si no puedes visualizar este correo ....';
    //send the message, check for errors
    if (!$mail->send()) {
        //echo "Mailer Error: " . $mail->ErrorInfo;
    } else {
        echo "Notificaci?n Enviada a " . $datos_destinatario[0]->email;
    }
}
function ColocaFijacion($PRINCIPAL, $evaluado, $evaluador, $id_proceso, $id_empresa)
{
    $cantidad                       = 6;
    $cantidad_obligatorio_objetivos = 3;
    for ($i = 1; $i <= $cantidad; $i++) {
        $tiene = TraigoObjetivoFijacion($evaluado, $evaluador, $id_proceso, $i, "objetivo");
        $total_objetivos .= file_get_contents("views/sgd/fijacion/" . $id_empresa . "_row_objetivos.html");
        $total_objetivos = str_replace("{NUM}", $i, $total_objetivos);
        $total_objetivos = str_replace("{VALUE_OBJETIVOS}", ($tiene[0]->objetivo), $total_objetivos);
        $total_objetivos = str_replace("{VALUE_MEDICION_CUMPLIMIENTO}", ($tiene[0]->medicion_cumplimiento), $total_objetivos);
        if ($i <= $cantidad_obligatorio_objetivos) {
            $total_objetivos = str_replace("{REQUIRED_OBLIGATORIO}", "required='required'", $total_objetivos);
        } else {
            $total_objetivos = str_replace("{REQUIRED_OBLIGATORIO}", "", $total_objetivos);
        }
    }
    $PRINCIPAL                 = str_replace("{ROW_INGRESO_OBJETIVOS}", $total_objetivos, $PRINCIPAL);
    $cantidad                  = 3;
    $cantidad_obligatorio_plan = 1;
    for ($i = 1; $i <= $cantidad; $i++) {
        $tiene = TraigoObjetivoFijacion($evaluado, $evaluador, $id_proceso, $i, "plan");
        $total_planes .= file_get_contents("views/sgd/fijacion/" . $id_empresa . "_row_plan.html");
        $total_planes = str_replace("{NUM}", $i, $total_planes);
        $total_planes = str_replace("{VALUE_AREA_DESARROLLO}", ($tiene[0]->areas_desarrollo), $total_planes);
        $total_planes = str_replace("{VALUE_ACCIONES_REQUERIDAS}", ($tiene[0]->acciones_requeridas), $total_planes);
        if ($i <= $cantidad_obligatorio_plan) {
            $total_planes = str_replace("{REQUIRED_OBLIGATORIO}", "required='required'", $total_planes);
        } else {
            $total_planes = str_replace("{REQUIRED_OBLIGATORIO}", "", $total_planes);
        }
    }
    $PRINCIPAL = str_replace("{ROW_INGRESO_PLANES}", $total_planes, $PRINCIPAL);
    $PRINCIPAL = str_replace("{EVALUADO_ENCODEADO}", Encodear3($evaluado), $PRINCIPAL);
    $PRINCIPAL = str_replace("{NUMERO_ENCODEADO}", Encodear3($cantidad), $PRINCIPAL);
    $PRINCIPAL = str_replace("{EVALUADOR_ENCODEADO}", Encodear3($evaluador), $PRINCIPAL);
    return ($PRINCIPAL);
}
function ListadoColaboradoresFijacion($html, $evaluador, $rut_evaluado, $id_proceso)
{
    $id_empresa    = $_SESSION["id_empresa"];
    //$evaluados=EvaluadosDadoEvaluador($evaluador);
    $evaluados     = EvaluadosDadoEvaluadorPorProcesoSinAeParaFijacion($evaluador, $id_proceso);
    //Se muestran los objetivos individuales.
    $total_html    = file_get_contents("views/sgd/fijacion/" . $id_empresa . "_entorno_bloque_principal.html");
    $template_row  = file_get_contents("views/sgd/fijacion/" . $id_empresa . "_row_colaboradores.html");
    //Primero veo si es que hay registro en la tabla de sesion
    $row           = "";
    $ok_finalizado = 0;
    foreach ($evaluados as $evaluado) {
        $row .= $template_row;
        //$row=FormularioIngresaObjetivos($row, $evaluado->evaluado, $evaluador);
        $row = ColocaDatosUsuario($row, $evaluado->evaluado, "sinmensaje");
        //$valores_objetivos=ListadoObjetivosAValidar($evaluado->evaluado, $evaluador, $id_objetivo, "jefe");
        $row = str_replace("{RUT_ENCODEADO}", Encodear3($evaluado->evaluado), $row);
        $row = str_replace("{RUT_EVALUADO_ENCODEADO}", Encodear3($evaluado->evaluado), $row);
        $row = str_replace("{NUM_OBJETIVOS}", ($evaluado->total_objetivos), $row);
        $row = str_replace("{NUM_PLAN}", ($evaluado->total_planes), $row);
        if ($evaluado->finalizado_proceso) {
            $row = str_replace("{ICON_FINALIZADO}", "text-success_icon fas fa-check-square", $row);
        } else {
            $row = str_replace("{ICON_FINALIZADO}", "text-alert_icon icon-circle", $row);
        }
        //$total_planes=TraeDatosPorPlanes($evaluado->evaluado);
        $total_planes = TraeDatosPorPlanesPorProcesoPlan($evaluado->evaluado, $id_proceso_plan);
        //ACA veo si es que tiene comentarios de rechazo
    }
    $total_html = str_replace("{LISTADO_COLABORADORES}", ($row), $total_html);
    $html       = str_replace("{ENTORNO_LISTADO_COLABORADORES}", ($total_html), $html);
    return ($html);
}
function ColocaDesarrolloCarrera($PRINCIPAL, $evaluado, $id_proceso, $evaluador, $id_empresa, $equipo)
{
    //Traigo el listado de los intereses de desarrollo
    $intereses = totalInteresesDesarrollo($id_empresa);
    if ($equipo == "equipo") {
        $total_evaluados = TraeEvaluadosDadoEvaluadorPorProcesoSinAe($evaluador, $id_proceso);
        foreach ($total_evaluados as $eva) {
            //$check.="Evaluado ".$eva->nombre_completo."<br>";
            $check .= "<hr>";
            $check .= file_get_contents("views/sgd/informe/" . $id_empresa . "_tabla_superior_informe.html");
            $check  = ColocaDatosUsuarioSGD($check, $eva->rut, "", $evaluador, $id_proceso);
            $check  = str_replace("{TABLA_RESUMEN1}", "", $check);
            $titulo = "";
            foreach ($intereses as $int) {
                if ($int->agrupacion <> $titulo) {
                    $check .= "<br><b>" . $int->agrupacion . "</b><br><br>";
                }
                $titulo    = $int->agrupacion;
                $chequeado = 'checked="checked"';
                //Veo si este desarrollo de carrera esta o no esta para este evaluado evaluador proceso empresa id_Desarrollo_carrera
                $tiene     = TienedesarrolloCarrera($eva->rut, $evaluador, $id_proceso, $id_empresa, $int->id);
                if ($tiene) {
                    $check .= "<input type='checkbox' checked='checked'  name='" . $int->nombre . "_" . $eva->rut . "'>&nbsp;" . $int->interes . "<br>";
                } else {
                    $check .= "<input type='checkbox'  name='" . $int->nombre . "_" . $eva->rut . "'>&nbsp;" . $int->interes . "<br>";
                }
            }
            $check .= "<br><br>";
        }
        $PRINCIPAL = str_replace("{LISTADO_DESARROLLO_CARRERA}", ($check), $PRINCIPAL);
        $PRINCIPAL = str_replace("{VALUE_EQUIPO}", "1", $PRINCIPAL);
    } else {
        $titulo = "";
        foreach ($intereses as $int) {
            if ($int->agrupacion <> $titulo) {
                $check .= "<br><b>" . $int->agrupacion . "</b><br><br>";
                //$check.=file_get_contents("views/sgd/evaluacion/66_entorno_interes_desarrollo.html");
                //$check= str_replace("{NOMBRE_AGRUPACION}",$int->agrupacion,$check);
                //$check_row="";
            }
            $titulo    = $int->agrupacion;
            $chequeado = 'checked="checked"';
            //Veo si este desarrollo de carrera esta o no esta para este evaluado evaluador proceso empresa id_Desarrollo_carrera
            $tiene     = TienedesarrolloCarrera($evaluado, $evaluador, $id_proceso, $id_empresa, $int->id);
            if ($tiene) {
                $check .= "<input type='checkbox' checked='checked'  name='" . $int->nombre . "'>&nbsp;" . $int->interes . "<br>";
            } else {
                $check .= "<input type='checkbox'  name='" . $int->nombre . "'>&nbsp;" . $int->interes . "<br>";
            }
            //$check_row.="<input type='checkbox'  name='".$int->nombre."'>&nbsp;".$int->interes."<br>";
            //$check= str_replace("{LISTADO_INTERESES_POR_AGRUPACION}",($check_row),$check);
        }
        $PRINCIPAL = str_replace("{LISTADO_DESARROLLO_CARRERA}", ($check), $PRINCIPAL);
        $PRINCIPAL = str_replace("{VALUE_EQUIPO}", "0", $PRINCIPAL);
    }
    return ($PRINCIPAL);
}
function colocaGraficoPromedioPorDeterminantes($PRINCIPAL, $evaluador, $id_proceso, $evaluado)
{
    //$PRINCIPAL= str_replace("{ARREGLO_NOMBRE_DETERMINANTES}","'PUEDE','QUIERE','SABE'",$PRINCIPAL);
    //$PRINCIPAL = str_replace("{ARREGLO_VALORES_DETERMINANTES}","2.5,3,3.25",$PRINCIPAL);
    if ($evaluado && $evaluador) {
        $resultadosPorDeterminantes = ResultadosPromedioPorDeterminantes($evaluador, $id_proceso, $evaluado);
    } else {
        $resultadosPorDeterminantes = ResultadosPromedioPorDeterminantes($evaluador, $id_proceso);
    }
    foreach ($resultadosPorDeterminantes as $res) {
        $row_dete .= file_get_contents("views/sgd/informe/row_informe_determinante.html");
        $row_dete                = str_replace("{NOMBRE}", ($res->sigla), $row_dete);
        $criterios_determinantes = ObtenerCriterioPuntajeMatrizNotaFinal($res->promedio_por_determinante, $evaluado, "", "comp", $evaluador, $id_proceso);
        $row_dete                = str_replace("{ESTILO_ETIQUETA}", $criterios_determinantes[2], $row_dete);
        $row_dete                = str_replace("{ICONO}", $criterios_determinantes[3], $row_dete);
        $row_dete                = str_replace("{CRITERIO}", $criterios_determinantes[0], $row_dete);
        $row_dete                = str_replace("{NOTA}", ColocaDecimalesNotasFinales(2, $res->promedio_por_determinante, $tipo) . "", $row_dete);
        $row_dete                = str_replace("{NOMBRE_AE}", ($res->sigla), $row_dete);
        $criterios_determinantes = ObtenerCriterioPuntajeMatrizNotaFinal($res->nota_ae, $evaluado, "", "comp", $evaluador, $id_proceso);
        $row_dete                = str_replace("{ESTILO_ETIQUETA_AE}", $criterios_determinantes[2], $row_dete);
        $row_dete                = str_replace("{ICONO_AE}", $criterios_determinantes[3], $row_dete);
        $row_dete                = str_replace("{CRITERIO_AE}", $criterios_determinantes[0], $row_dete);
        $row_dete                = str_replace("{NOTA_AE}", ColocaDecimalesNotasFinales(2, $res->nota_ae, $tipo) . "", $row_dete);
        $arreglo_datos .= $res->promedio_por_determinante;
        $arreglo_siglas .= '"' . $res->sigla . '"';
        if ($i < count($resultadosPorDeterminantes)) {
            $arreglo_datos .= ", ";
            $arreglo_siglas .= ", ";
        }
        $i++;
    }
    $PRINCIPAL = str_replace("{ARREGLO_NOMBRE_DETERMINANTES}", $arreglo_siglas, $PRINCIPAL);
    $PRINCIPAL = str_replace("{ARREGLO_VALORES_DETERMINANTES}", $arreglo_datos, $PRINCIPAL);
    $PRINCIPAL = str_replace("{LISTADO_DETERMINANTES}", ($row_dete), $PRINCIPAL);
    return ($PRINCIPAL);
}
function colocaGraficoPorPromediocompetencias($PRINCIPAL, $evaluador, $id_proceso)
{
    $promediocompetenciasPorEvaluador = ResultadosPromedioCompetenciasSGD($evaluador, $id_proceso);
    $i                                = 1;
    foreach ($promediocompetenciasPorEvaluador as $prom) {
        $arreglo_datos .= $prom->promedio_competencia;
        $arreglo_siglas .= '"' . $prom->sigla . '"';
        if ($i < count($promediocompetenciasPorEvaluador)) {
            $arreglo_datos .= ", ";
            $arreglo_siglas .= ", ";
        }
        $i++;
    }
    $PRINCIPAL = str_replace("{ETIQUETAS_GRAFICO_COMPETENCIAS}", $arreglo_siglas, $PRINCIPAL);
    $PRINCIPAL = str_replace("{ARREGLO_DATOS_GRAFICO_COMPETENCIAS}", $arreglo_datos, $PRINCIPAL);
    return ($PRINCIPAL);
}
function ColocaBotonera3($PRINCIPAL, $id_proceso, $rut)
{
    $id_empresa                = $_SESSION["id_empresa"];
    $datos_usuario_sesion      = UsuarioEnBasePersonaPorEmpresa($rut, $id_empresa);
    //Veo si realizo su AUtevaluacion
    $finalizada_AE             = FinalizadoEvaluadoEvaluadorProProceso($rut, $rut, $id_proceso);
    //Veo si este usuario para este proceso, tiene evaluados, si es asi,
    $tiene_evaluados           = TraeRelacionesSinAe($rut, $id_proceso);
    $todos_los_evaluados_sinAE = TraeRelacionesSinAeTODOS($rut, $id_proceso);
    $tiene_evaluadosDO         = TraeRelacionesSinAeDO($rut, $id_proceso);
    $total_finalizados_sin_ae  = FinalizadoEvaluadorPorProcesoSinAe($rut, $id_proceso);
    if (count($tiene_evaluados) == 0 && count($tiene_evaluadosDO) > 0) {
        $PRINCIPAL = str_replace("{BOTONERA3}", file_get_contents("views/sgd/botonera3/" . $id_empresa . "_botonera3_evaluaequipoDO.html"), $PRINCIPAL);
        $PRINCIPAL = str_replace("{URL_EVALUACION_EQUIPO}", "?sw={ENVIRONMENT_EQUIPO}&ip={ID_PROCESO_ENCODEADO}", $PRINCIPAL);
    } else {
        if ($datos_usuario_sesion[0]->perfil_evaluacion == "DO") {
            if (count($tiene_evaluados) > 0) {
                $PRINCIPAL = str_replace("{BOTONERA3}", file_get_contents("views/sgd/botonera3/" . $id_empresa . "_botonera3_evaluaequipo.html"), $PRINCIPAL);
            } else {
                $PRINCIPAL = str_replace("{BOTONERA3}", file_get_contents("views/sgd/botonera3/" . $id_empresa . "_botonera3_DO.html"), $PRINCIPAL);
            }
        } else {
            if ($tiene_evaluados) {
                //$PRINCIPAL= str_replace("{BOTONERA3}",file_get_contents("views/sgd/botonera3/".$id_empresa."_botonera3.html"),$PRINCIPAL);
                $datos_evaluador = UsuarioEnBasePersonaPorEmpresa($rut, $id_empresa);
                if ($datos_evaluador[0]->perfil_evaluacion == "SoloEvaluaEquipo") {
                    $PRINCIPAL = str_replace("{BOTONERA3}", file_get_contents("views/sgd/botonera3/" . $id_empresa . "_botonera3_evaluaequipo.html"), $PRINCIPAL);
                    $PRINCIPAL = str_replace("{URL_EVALUACION_EQUIPO}", "?sw={ENVIRONMENT_EQUIPO}&ip={ID_PROCESO_ENCODEADO}", $PRINCIPAL);
                } else {
                    $PRINCIPAL = str_replace("{BOTONERA3}", file_get_contents("views/sgd/botonera3/" . $id_empresa . "_botonera3.html"), $PRINCIPAL);
                }
            } else {
                $PRINCIPAL = str_replace("{BOTONERA3}", file_get_contents("views/sgd/botonera3/" . $id_empresa . "_botonera3_ae.html"), $PRINCIPAL);
            }
        }
    }
    if ($finalizada_AE) {
        $PRINCIPAL = str_replace("{URL_EVALUACION_EQUIPO}", "?sw={ENVIRONMENT_EQUIPO}&ip={ID_PROCESO_ENCODEADO}", $PRINCIPAL);
        $PRINCIPAL = str_replace("{CLASE_AE}", "button-green", $PRINCIPAL);
        $PRINCIPAL = str_replace("{ICONO_AE}", "fas fa-check-square", $PRINCIPAL);
        $PRINCIPAL = str_replace("{ICONO_EV_DESC}", "icon-chevron-sign-right", $PRINCIPAL);
        $PRINCIPAL = str_replace("{ENVIRONMENT_AE}", "inf", $PRINCIPAL);
    } else {
        $PRINCIPAL = str_replace("{URL_EVALUACION_EQUIPO}", "?sw={ENVIRONMENT_EQUIPO}&ip={ID_PROCESO_ENCODEADO}", $PRINCIPAL);
        //$PRINCIPAL= str_replace("{URL_EVALUACION_EQUIPO}","#",$PRINCIPAL);
        $PRINCIPAL = str_replace("{CLASE_AE}", "", $PRINCIPAL);
        $PRINCIPAL = str_replace("{ICONO_AE}", "icon-chevron-sign-right", $PRINCIPAL);
        $tiene_ae  = SGD_ExisteAe($evaluado, $id_proceso, $id_empresa);
        if ($tiene_ae) {
            $PRINCIPAL = str_replace("{CLASE_EVAL_DESC}", "button-leaf", $PRINCIPAL);
        }
        $PRINCIPAL = str_replace("{ICONO_EV_DESC}", "icon-minus", $PRINCIPAL);
        $PRINCIPAL = str_replace("{ENVIRONMENT_AE}", "evind", $PRINCIPAL);
    }
    if (count($tiene_evaluados) == count($total_finalizados_sin_ae)) {
        $PRINCIPAL                       = str_replace("{CLASE_EVAL_DESC}", "button-green", $PRINCIPAL);
        $PRINCIPAL                       = str_replace("{ENVIRONMENT_EQUIPO}", "sgd2", $PRINCIPAL);
        //aca verifico cuantos finalizados tiene el evaluador
        $total_finalizados_por_evaluador = FinalizadoFijacionEvaluador($rut, $id_proceso);
        //echo count($total_finalizados_por_evaluador);echo "<br>";
        //echo count($todos_los_evaluados_sinAE);
        //if(count($total_finalizados_por_evaluador)==count($tiene_evaluados)){
        if (count($total_finalizados_por_evaluador) == count($todos_los_evaluados_sinAE)) {
            $PRINCIPAL = str_replace("{ESTILO_FIJACION}", "button-green", $PRINCIPAL);
        } else {
            $PRINCIPAL = str_replace("{ESTILO_FIJACION}", "", $PRINCIPAL);
        }
    } else {
        //$PRINCIPAL= str_replace("{ENVIRONMENT_EQUIPO}","ev",$PRINCIPAL);
        $PRINCIPAL = str_replace("{ENVIRONMENT_EQUIPO}", "sgd2", $PRINCIPAL);
        $PRINCIPAL = str_replace("{ESTILO_FIJACION}", "rounded button-leaf", $PRINCIPAL);
        //exit("1");
        $PRINCIPAL = str_replace("{BON_INFORME_FINAL}", file_get_contents("views/sgd/botonera3/" . $id_empresa . "_boton_ve_informe_final_desactivado.html"), $PRINCIPAL);
    }
    //Aca verifico para el Boton Informe final
    $finalizado_full = COMPASS_VerificoParaInformeFinal($rut, $id_proceso, $id_empresa);
    if ($datos_usuario_sesion[0]->perfil_evaluacion == "DO") {
        if (count($finalizada_AE) >= 0 && $finalizado_full[0]->total_fijacion_objetivos >= 1 && $finalizado_full[0]->total_fijacion_planes >= 1) {
            //echo ".";
            $PRINCIPAL = str_replace("{BON_INFORME_FINAL}", file_get_contents("views/sgd/botonera3/" . $id_empresa . "_boton_ve_informe_final.html"), $PRINCIPAL);
        } else {
            //echo "..";
            $PRINCIPAL = str_replace("{BON_INFORME_FINAL}", file_get_contents("views/sgd/botonera3/" . $id_empresa . "_boton_ve_informe_final_desactivado.html"), $PRINCIPAL);
        }
    } else {
        //echo count($finalizada_AE)." ".$finalizado_full[0]->fecha." ".$finalizado_full[0]->total_fijacion_objetivos." ".$finalizado_full[0]->total_fijacion_planes;
        if (count($finalizada_AE) >= 0 && $finalizado_full[0]->fecha && $finalizado_full[0]->total_fijacion_objetivos >= 1 && $finalizado_full[0]->total_fijacion_planes >= 1) {
            //echo "...";
            $PRINCIPAL = str_replace("{BON_INFORME_FINAL}", file_get_contents("views/sgd/botonera3/" . $id_empresa . "_boton_ve_informe_final.html"), $PRINCIPAL);
        } else {
            //echo "....";
            //exit("1");
            $PRINCIPAL = str_replace("{BON_INFORME_FINAL}", file_get_contents("views/sgd/botonera3/" . $id_empresa . "_boton_ve_informe_final_desactivado.html"), $PRINCIPAL);
        }
    }
    $PRINCIPAL = str_replace("{ID_PROCESO_ENCODEADO}", Encodear3($id_proceso), $PRINCIPAL);
    $PRINCIPAL = str_replace("{RUT_EVALUADO_ENCODEADO}", Encodear3($rut), $PRINCIPAL);
    $PRINCIPAL = str_replace("{RUT_EVALUADOR_ENCODEADO}", Encodear3($rut), $PRINCIPAL);
    $PRINCIPAL = str_replace("{ID_EMPRESA_ENCODEADO}", Encodear3($id_empresa), $PRINCIPAL);
    return ($PRINCIPAL);
}
function ColocarRankingPorCampos($PRINCIPAL, $id_empresa, $rut, $c1, $c2, $c3)
{
    $datos_empresa          = DatosEmpresa($id_empresa);
    //Campo1
    $datos_usuario_campo123 = UsuarioEnBaseDePersonasInnerEmpresa($rut);
    if ($c1) {
        $datos = Datos_tbl_lms_ranking($id_empresa, "c1");
        if ($datos) {
            $i = 1;
            $total .= file_get_contents("views/cursos/capacitacion/" . $id_empresa . "_row_ranking_grupal_titulo.html");
            $total = str_replace("{NOMBRE_CRITERIO}", $datos_empresa[0]->campo1, $total);
            foreach ($datos as $uni) {
                $total .= file_get_contents("views/cursos/capacitacion/" . $id_empresa . "_row_ranking_grupal.html");
                $total = str_replace("{RANK}", $i, $total);
                if ($datos_usuario_campo123[0]->{$datos_usuario_campo123[0]->campo1} == $uni->valor_campo) {
                    $total = str_replace("{CLASE_COMOVOY}", "lms_miranking", $total);
                } else {
                    $total = str_replace("{CLASE_COMOVOY}", "", $total);
                }
                $total = str_replace("{NOMBRE}", $uni->criterio, $total);
                $total = str_replace("{PUNTOS}", $uni->suma_puntos, $total);
                $total = str_replace("{MEDALLAS}", $uni->medallas, $total);
                $total = str_replace("{AVANCE}", number_format($uni->avance, 1, ",", "."), $total);
                $i++;
            }
        }
    }
    //Traigo los datos por C1
    //$datos=GAMIFICACION_TodosLosConsolidadosPorCampoEmpresa($id_empresa, $datos_empresa[0]->campo3);
    if ($c2) {
        $datos = Datos_tbl_lms_ranking($id_empresa, "c2");
        if ($datos) {
            $i = 1;
            $total .= file_get_contents("views/cursos/capacitacion/" . $id_empresa . "_row_ranking_grupal_titulo.html");
            $total = str_replace("{NOMBRE_CRITERIO}", $datos_empresa[0]->campo2, $total);
            foreach ($datos as $uni) {
                $total .= file_get_contents("views/cursos/capacitacion/" . $id_empresa . "_row_ranking_grupal.html");
                $total = str_replace("{RANK}", $i, $total);
                if ($datos_usuario_campo123[0]->{$datos_usuario_campo123[0]->campo2} == $uni->valor_campo) {
                    $total = str_replace("{CLASE_COMOVOY}", "lms_miranking", $total);
                } else {
                    $total = str_replace("{CLASE_COMOVOY}", "", $total);
                }
                $total = str_replace("{NOMBRE}", $uni->criterio, $total);
                $total = str_replace("{PUNTOS}", $uni->suma_puntos, $total);
                $total = str_replace("{MEDALLAS}", $uni->medallas, $total);
                $total = str_replace("{AVANCE}", number_format($uni->avance, 1, ",", "."), $total);
                $i++;
            }
        }
    }
    if ($c3) {
        $datos = Datos_tbl_lms_ranking($id_empresa, "c3");
        if ($datos) {
            $i = 1;
            $total .= file_get_contents("views/cursos/capacitacion/" . $id_empresa . "_row_ranking_grupal_titulo.html");
            $total = str_replace("{NOMBRE_CRITERIO}", $datos_empresa[0]->campo3, $total);
            foreach ($datos as $uni) {
                $total .= file_get_contents("views/cursos/capacitacion/" . $id_empresa . "_row_ranking_grupal.html");
                $total = str_replace("{RANK}", $i, $total);
                if ($datos_usuario_campo123[0]->{$datos_usuario_campo123[0]->campo3} == $uni->valor_campo) {
                    $total = str_replace("{CLASE_COMOVOY}", "lms_miranking", $total);
                } else {
                    $total = str_replace("{CLASE_COMOVOY}", "", $total);
                }
                $total = str_replace("{NOMBRE}", $uni->criterio, $total);
                $total = str_replace("{PUNTOS}", $uni->suma_puntos, $total);
                $total = str_replace("{MEDALLAS}", $uni->medallas, $total);
                $total = str_replace("{AVANCE}", number_format($uni->avance, 1, ",", "."), $total);
                $i++;
            }
        }
    }
    $PRINCIPAL = str_replace("{ROW_RANKING}", ($total), $PRINCIPAL);
    return ($PRINCIPAL);
}
function ColocaPreguntasorDesafio($id_desafio, $rut, $id_objeto, $id_curso, $id_desafio2, $id_empresa)
{
    $preguntas          = TraigoPreguntasPorDesafio($id_desafio, $rut, $id_objeto, $id_curso, $id_desafio2, $id_empresa);
    $total_preguntas    = "";
    $usuario_finalizado = TieneAccionesPEndientes($rut, $id_empresa, $id_curso, $id_objeto);
    $titulo_dimension   = "";
    $datos_desafio      = TraeDatosDesafioDadoId($id_desafio);
    $contador_colspan   = 0;
    foreach ($preguntas as $preg) {
        if ($titulo_dimension <> $preg->dimension) {
            if ($preg->tipo_dimension == 1) {
                if ($datos_desafio[0]->colspan) {
                    $contador_colspan = $contador_colspan + $datos_desafio[0]->colspan;
                }
                $total_preguntas .= file_get_contents("views/cursos/objetos/desafio/row_titulo_dimension_1.html");
            } else {
                $total_preguntas .= file_get_contents("views/cursos/objetos/desafio/row_titulo_dimension.html");
            }
            $total_preguntas  = str_replace("{NOMBRE_DIMENSION}", $preg->dimension, $total_preguntas);
            $titulo_dimension = $preg->dimension;
        } else {
            $titulo_dimension = $preg->dimension;
        }
        if ($usuario_finalizado) {
            if ($_GET["edidesa"] == 1) {
                if ($preg->solo_lectura == 1) {
                    if ($datos_desafio[0]->colspan) {
                        $contador_colspan = $contador_colspan + $datos_desafio[0]->colspan;
                        $total_preguntas .= file_get_contents("views/cursos/objetos/desafio/" . $preg->template . "_lectura.html");
                        //echo "1";
                    } else {
                        $total_preguntas .= file_get_contents("views/cursos/objetos/desafio/" . $preg->template . "_lectura_estatico.html");
                        //echo "2";
                    }
                } else {
                    if ($datos_desafio[0]->colspan) {
                        $contador_colspan = $contador_colspan + $datos_desafio[0]->colspan;
                        $total_preguntas .= file_get_contents("views/cursos/objetos/desafio/" . $preg->template . ".html");
                        //echo "3";
                    } else {
                        $total_preguntas .= file_get_contents("views/cursos/objetos/desafio/" . $preg->template . "_estatico.html");
                        //echo "4";
                    }
                }
            } else {
                if ($datos_desafio[0]->colspan) {
                    $contador_colspan = $contador_colspan + $datos_desafio[0]->colspan;
                    $total_preguntas .= file_get_contents("views/cursos/objetos/desafio/" . $preg->template . "_lectura.html");
                    //echo "5";
                } else {
                    if ($datos_desafio[0]->id_objeto) {
                        //echo "views/cursos/objetos/desafio/".$preg->template."_lectura_estatico_".$datos_desafio[0]->id_objeto.".html";
                        $total_preguntas .= file_get_contents("views/cursos/objetos/desafio/" . $preg->template . "_lectura_estatico_" . $datos_desafio[0]->id_objeto . ".html");
                    } else {
                        $total_preguntas .= file_get_contents("views/cursos/objetos/desafio/" . $preg->template . "_lectura_estatico.html");
                    }
                    //echo "6";
                }
            }
        } else {
            if ($preg->solo_lectura == 1) {
                if ($datos_desafio[0]->colspan) {
                    $contador_colspan = $contador_colspan + $datos_desafio[0]->colspan;
                    //echo "7";
                    $total_preguntas .= file_get_contents("views/cursos/objetos/desafio/" . $preg->template . "_lectura.html");
                } else {
                    //echo "8";
                    $total_preguntas .= file_get_contents("views/cursos/objetos/desafio/" . $preg->template . "_lectura_estatico.html");
                }
            } else {
                if ($datos_desafio[0]->colspan) {
                    $contador_colspan = $contador_colspan + $datos_desafio[0]->colspan;
                    $total_preguntas .= file_get_contents("views/cursos/objetos/desafio/" . $preg->template . ".html");
                    //echo "9";
                } else {
                    //echo "10";
                    $total_preguntas .= file_get_contents("views/cursos/objetos/desafio/" . $preg->template . "_estatico.html");
                }
            }
        }
        if ($preg->tabla_select) {
            $datos_select = SelectAsterisco($preg->tabla_select);
            $options      = "";
            if ($preg->tabla_select == "tbl_usuario") {
                foreach ($datos_select as $sel) {
                    if ($preg->respuesta == $sel->rut) {
                        $options .= "<option selected='selected' value='" . ($sel->rut) . "'>" . ($sel->nombre_completo) . "</option>";
                    } else {
                        $options .= "<option value='" . ($sel->rut) . "'>" . ($sel->nombre_completo) . "</option>";
                    }
                }
            } else {
                foreach ($datos_select as $sel) {
                    if ($preg->respuesta == $sel->valor) {
                        $options .= "<option selected='selected' value='" . ($sel->valor) . "'>" . ($sel->valor) . "</option>";
                    } else {
                        $options .= "<option value='" . ($sel->valor) . "'>" . ($sel->valor) . "</option>";
                    }
                }
            }
        }
        $total_preguntas = str_replace("{OPTIONS_SELECT_DINAMICO}", $options, $total_preguntas);
        $total_preguntas = str_replace("{ID}", $preg->id, $total_preguntas);
        //$total_preguntas = str_replace("{ID_CHECKBOX}",$preg->nombre_checkbox,$total_preguntas);
        if ($preg->muestra_pregunta == 1) {
            $total_preguntas = str_replace("{PREGUNTA}", "&nbsp;", $total_preguntas);
        } else {
            $total_preguntas = str_replace("{PREGUNTA}", $preg->pregunta, $total_preguntas);
        }
        if ($preg->id_pregunta_asociada) {
            //Traigo la respuesta de este usuario de esta pregunta asociada
            $respuestas_preguntas_asociadas = VerificoPReguntaDesafio($rut, $preg->id_pregunta_asociada, $preg->id_objeto_asociado, $preg->id_curso_asociado, $id_empresa, $preg->id_desafio_asociado);
            $total_preguntas                = str_replace("{VALUE}", $respuestas_preguntas_asociadas[0]->respuesta, $total_preguntas);
        } else {
            $total_preguntas = str_replace("{VALUE}", $preg->respuesta, $total_preguntas);
        }
        //$total_preguntas = str_replace("{VALUE_CHECKBOX}",$preg->id,$total_preguntas);
        if ($preg->respuesta) {
            $total_preguntas = str_replace("{CHEQUEADO}", 'checked="checked"', $total_preguntas);
        } else {
            $total_preguntas = str_replace("{CHEQUEADO}", "", $total_preguntas);
        }
        if ($preg->obligatorio == "no") {
            $total_preguntas = str_replace("{REQUIRED}", "", $total_preguntas);
        } else {
            $total_preguntas = str_replace("{REQUIRED}", 'required="required"', $total_preguntas);
        }
        if ($preg->respuesta) {
            $total_preguntas = str_replace("{BLOQUE_VER_DOCUMENTO}", file_get_contents("views/cursos/objetos/desafio/row_bloque_file_ve.html"), $total_preguntas);
        } else {
            $total_preguntas = str_replace("{BLOQUE_VER_DOCUMENTO}", "", $total_preguntas);
        }
        $total_preguntas = str_replace("{URL_ARCHIVO}", "objetos/" . $id_curso . "/" . $id_objeto . "/" . $preg->respuesta, $total_preguntas);
        if ($datos_desafio[0]->colspan) {
            $total_preguntas = str_replace("{ROW1}", "0", $total_preguntas);
            $total_preguntas = str_replace("{ROW2}", $datos_desafio[0]->colspan, $total_preguntas);
        } else {
            $total_preguntas = str_replace("{ROW1}", "1", $total_preguntas);
            $total_preguntas = str_replace("{ROW2}", "10", $total_preguntas);
        }
        $total_preguntas = str_replace("{VALUE_DESDE_BASE}", $preg->respuesta_desde_base, $total_preguntas);
        if ($contador_colspan == 12) {
            $total_preguntas .= "<br>";
            $contador_colspan = 0;
        }
    }
    return (($total_preguntas));
}

function ColocaDatosAccionesClaves($id_objeto, $id_curso, $id_empresa, $rut, $PRINCIPAL)
{
    $datos_acciones_pendientes = TieneAccionesPEndientes($rut, $id_empresa, $id_curso, $id_objeto);
    $PRINCIPAL                 = str_replace("{COMENTARIO_TAREA}", ($datos_acciones_pendientes[0]->comentario), $PRINCIPAL);
    $PRINCIPAL                 = str_replace("{LINK_DESCARGA_TAREA}", "objetos/$id_curso/$id_objeto/tareas/" . $datos_acciones_pendientes[0]->nombre_documento, $PRINCIPAL);
    return ($PRINCIPAL);
}
function LMS_ConsultaRutSegunEmail($email, $id_empresa)
{
    $arrayKey = LMS_ConsultaRutSegunEmail_data($email, $id_empresa);
    //print_r($arrayKey);
    $key      = $arrayKey[0]->rut;
    //echo "<br><br>key $key";
    //exit();
    return $key;
}

function colocarComentariosFinalesMedioCiclo($PRINCIPAL, $evaluado, $rut_session, $id_empresa, $id_proceso)
{
    //Verifico si el evaluado finalizo el proceso
    $esta_finalizado_Etapa1 = EstaFinalizadoEpata1($evaluado, $id_proceso, $id_empresa);
    if ($esta_finalizado_Etapa1) {
        if ($evaluado == $rut_session) {
            //bloque evaluado
            if ($esta_finalizado_Etapa1[0]->comentario_evaluado) {
                $PRINCIPAL = str_replace("{BLOQUE_COMENTARIOS_FINALES}", file_get_contents("views/sgd/objetivos/dimensiones/bloque_comentario_final_evaluado_texto.html"), $PRINCIPAL);
                $PRINCIPAL = str_replace("{COMENTARIO}", ($esta_finalizado_Etapa1[0]->comentario_evaluado), $PRINCIPAL);
                $PRINCIPAL = str_replace("{COMENTARIO_EVALUADO}", ($esta_finalizado_Etapa1[0]->comentario_evaluado), $PRINCIPAL);
                $PRINCIPAL = str_replace("{ROL}", "Colaborador", $PRINCIPAL);
            } else {
                $PRINCIPAL = str_replace("{BLOQUE_COMENTARIOS_FINALES}", file_get_contents("views/sgd/objetivos/dimensiones/bloque_comentario_final_evaluado.html"), $PRINCIPAL);
                $PRINCIPAL = str_replace("{COMENTARIO_EVALUADO}", ($esta_finalizado_Etapa1[0]->comentario_evaluado), $PRINCIPAL);
            }
        } else {
            //bloque evaluador
            if ($esta_finalizado_Etapa1[0]->comentario_evaluador) {
                $PRINCIPAL = str_replace("{BLOQUE_COMENTARIOS_FINALES}", file_get_contents("views/sgd/objetivos/dimensiones/bloque_comentario_final_evaluado_texto.html"), $PRINCIPAL);
                $PRINCIPAL = str_replace("{COMENTARIO}", ($esta_finalizado_Etapa1[0]->comentario_evaluador), $PRINCIPAL);
                $PRINCIPAL = str_replace("{ROL}", "Jefatura", $PRINCIPAL);
            } else {
                $PRINCIPAL = str_replace("{BLOQUE_COMENTARIOS_FINALES}", file_get_contents("views/sgd/objetivos/dimensiones/bloque_comentario_final_evaluador.html"), $PRINCIPAL);
            }
        }
        $PRINCIPAL = str_replace("{ID_PROCESO_ENCODEADO}", Encodear3($id_proceso), $PRINCIPAL);
        $PRINCIPAL = str_replace("{ID_EMPRESA_ENCODEADO}", Encodear3($id_empresa), $PRINCIPAL);
        $PRINCIPAL = str_replace("{RUT_EVALUADO_ENCODEADO}", Encodear3($evaluado), $PRINCIPAL);
    } else {
        $PRINCIPAL = str_replace("{BLOQUE_COMENTARIOS_FINALES}", "", $PRINCIPAL);
    }
    return ($PRINCIPAL);
}
function ColocaColaboradoresResumenObjetivosMedioCiclo($PRINCIPAL, $rut_fijador, $id_empresa, $rut_validador, $id_proceso)
{
    if ($id_proceso) {
        //$evaluados=TraeRelacionesSinAe($rut_fijador, $id_proceso);
        $evaluados = TraeRelacionesSinAeConDatos($rut_fijador, $id_proceso);
    } else {
        $evaluados = TraeRelacionesSinAeSinProceso($rut_fijador);
    }
    $datos_fijador                = UsuarioEnBasePersonas($rut_fijador);
    $PRINCIPAL                    = str_replace("{NOMBRE_FIJADOR}", ($datos_fijador[0]->nombre_completo), $PRINCIPAL);
    $dimensiones_por_empresa      = DimensionesObjetivosPorEmpresa($id_empresa);
    $total_dimensiones            = 0;
    $total_fijaciones_finalizadas = 0;
    $total_validadas              = 0;
    if ($rut_validador) {
        $row_html = file_get_contents("views/sgd/objetivos/row_colaboradores_lista_resumen_validador.html");
    } else {
        $row_html = file_get_contents("views/sgd/objetivos/row_colaboradores_lista_resumen_mediociclo.html");
    }
    //Bloque Mi PERFIL
    $evaluados_miperfil = TraeRelacionesSoloAeConDatos($_SESSION["user_"], $id_proceso);
    foreach ($evaluados_miperfil as $eva) {
        $PRINCIPAL = str_replace("{MI_PERFIL}", file_get_contents("views/sgd/objetivos/row_colaboradores_lista_resumen_mediociclo.html"), $PRINCIPAL);
        $PRINCIPAL = str_replace("{NOMBRE}", ($eva->nombre_completo), $PRINCIPAL);
        $PRINCIPAL = str_replace("{PERFIL_COMPETENCIAS}", ($eva->perfil_competencia), $PRINCIPAL);
        $PRINCIPAL = str_replace("{JEFE}", ($eva->nombre_evaluador), $PRINCIPAL);
        $PRINCIPAL = str_replace("{JEFE_DEL_JEFE}", $eva->nombre_validador, $PRINCIPAL);
        $PRINCIPAL = str_replace("{CARGO}", ($eva->cargo_evaluado), $PRINCIPAL);
        $PRINCIPAL = str_replace("{FECHA_INGRESO}", $eva->fecha_ingreso_evaluado, $PRINCIPAL);
        $PRINCIPAL = str_replace("{RUT_EVALUADO}", $eva->evaluado, $PRINCIPAL);
        $PRINCIPAL = str_replace("{RUT_EVALUADO_ENCODEADO}", Encodear3($eva->evaluado), $PRINCIPAL);
        $PRINCIPAL = str_replace("{URL_PERSONA}", VerificaFotoPersonal($eva->evaluado), $PRINCIPAL);
        foreach ($dimensiones_por_empresa as $dimen) {
            if ($dimen->id == 24) {
                continue;
            }
            $row_dimensiones .= file_get_contents("views/sgd/objetivos/row_resumen_por_dimension_evaluado.html");
            $row_dimensiones = str_replace("{NOMBRE_DIMENSION}", $dimen->nombre, $row_dimensiones);
            //Verifico si est? finalizada esta dimension para este evaluado
            $finalizado      = EstaFinalizadoEpata1($eva->evaluado, $id_proceso, $id_empresa);
            if ($finalizado) {
                $row_dimensiones = str_replace("{ESTADO}", '<span class="etiquetaPrograma etiquetaPrograma-aprobado pull-left"><i class="fas fa-check-square"></i>&nbsp;&nbsp;Finalizado</span>', $row_dimensiones);
            } else {
                $row_dimensiones = str_replace("{ESTADO}", '<span class="etiquetaPrograma etiquetaPrograma-noiniciado pull-left"><i class="far fa-times-circle"></i>&nbsp;&nbsp;Pendiente</span>', $row_dimensiones);
            }
            if ($finalizado[0]->comentario_evaluado && $finalizado[0]->comentario_evaluador) {
                $row_dimensiones = str_replace("{ESTADO_VALIDACION}", '<span class="etiquetaPrograma etiquetaPrograma-aprobado pull-left"><i class="fas fa-check-square"></i>&nbsp;&nbsp;Finalizado</span>', $row_dimensiones);
            } else {
                $row_dimensiones = str_replace("{ESTADO_VALIDACION}", '<span class="etiquetaPrograma etiquetaPrograma-noiniciado pull-left"><i class="far fa-times-circle"></i>&nbsp;&nbsp;Pendiente</span>', $row_dimensiones);
            }
        }
        $PRINCIPAL = str_replace("{ROW_RESUMEN_POR_EVALUADO}", ($row_dimensiones), $PRINCIPAL);
    }
    foreach ($evaluados as $eva) {
        //$dimensiones_por_empresa=DimensionesObjetivosPorEmpresaCruceFinalizados($id_empresa, $eva->evaluado);
        $row .= $row_html;
        //ACA Verifico si es que est? o no validado
        $objetivos_validados = VerificaSiObjetivosEstanValidadosDadoEvaluadorIdProcesoEvaluado($rut_fijador, $id_proceso, $eva->evaluado);
        if ($objetivos_validados or $eva->objetivos_masivos == 1) {
            if ($rut_validador) {
                $row = str_replace("{BOTON_VE_INFORME}", file_get_contents("views/sgd/objetivos/boton_descarga_informe_desde_validador.html"), $row);
            } else {
                //$row = str_replace("{BOTON_VE_INFORME}",file_get_contents("views/sgd/objetivos/boton_descarga_informe.html"),$row);
                if ($eva->objetivos_masivos == 1) {
                    $row = str_replace("{BOTON_VE_INFORME}", file_get_contents("views/sgd/objetivos/boton_descarga_informe_solo_texto.html"), $row);
                } else {
                    $row = str_replace("{BOTON_VE_INFORME}", file_get_contents("views/sgd/objetivos/boton_descarga_informe.html"), $row);
                }
            }
            //Veo si esta descargado este informe, si es asi, coloco texto finalizado
            $esta_finalizado_proceso = OBJETIVOS_InformesDescargadosPorEvaluadorProcesoEmpresaEvaluado($eva->evaluado, $eva->evaluador, $id_proceso, $id_empresa);
            if ($esta_finalizado_proceso) {
                //$texto_a_mostrar=file_get_contents("views/sgd/objetivos/texto_proceso_finalizado.html");
                $texto_a_mostrar = "";
            } else {
                $texto_a_mostrar = "";
            }
            if ($eva->objetivos_masivos == 1) {
                $texto_a_mostrar .= file_get_contents("views/sgd/objetivos/texto_carga_masiva.html");
            }
            $row = str_replace("{TEXTO_PROCESO_FINALIZADO}", $texto_a_mostrar, $row);
            $row = str_replace("{BOTON_VER_DETALLE}", "", $row);
        } else {
            $row = str_replace("{BOTON_VE_INFORME}", "", $row);
            if ($rut_validador) {
                $row = str_replace("{BOTON_VER_DETALLE}", file_get_contents("views/sgd/objetivos/boton_ver_detalle_evaluado.html"), $row);
            } else {
                $row = str_replace("{BOTON_VER_DETALLE}", file_get_contents("views/sgd/objetivos/boton_ver_detalle_evaluado_desde_evaluador.html"), $row);
            }
        }
        $row             = str_replace("{NOMBRE}", $eva->nombre_completo, $row);
        $row             = str_replace("{PERFIL_COMPETENCIAS}", $eva->perfil_competencia, $row);
        $row             = str_replace("{JEFE}", $eva->nombre_evaluador, $row);
        $row             = str_replace("{JEFE_DEL_JEFE}", $eva->nombre_validador, $row);
        $row             = str_replace("{CARGO}", $eva->cargo_evaluado, $row);
        $row             = str_replace("{FECHA_INGRESO}", $eva->fecha_ingreso_evaluado, $row);
        $row             = str_replace("{RUT_EVALUADO}", $eva->evaluado, $row);
        $row             = str_replace("{RUT_EVALUADO_ENCODEADO}", Encodear3($eva->evaluado), $row);
        $row             = str_replace("{URL_PERSONA}", VerificaFotoPersonal($eva->evaluado), $row);
        //Por cada colaborador, armo el menu de resumen
        $row_dimensiones = "";
        foreach ($dimensiones_por_empresa as $dimen) {
            if ($dimen->id == 24) {
                continue;
            }
            $row_dimensiones .= file_get_contents("views/sgd/objetivos/row_resumen_por_dimension_evaluado.html");
            $row_dimensiones = str_replace("{NOMBRE_DIMENSION}", $dimen->nombre, $row_dimensiones);
            //Verifico para esta dimension, para este evaluado, si est? o no finalizado.
            $finalizado      = EstaFinalizadoEpata1($eva->evaluado, $id_proceso, $id_empresa);
            if ($finalizado) {
                $row_dimensiones = str_replace("{ESTADO}", '<span class="etiquetaPrograma etiquetaPrograma-aprobado pull-left"><i class="fas fa-check-square"></i>&nbsp;&nbsp;Finalizado</span>', $row_dimensiones);
            } else {
                $row_dimensiones = str_replace("{ESTADO}", '<span class="etiquetaPrograma etiquetaPrograma-noiniciado pull-left"><i class="far fa-times-circle"></i>&nbsp;&nbsp;Pendiente</span>', $row_dimensiones);
            }
            //verifico para esta dimension, para este evaluado, si esta ok la etapa de cierre
            if ($finalizado[0]->comentario_evaluado && $finalizado[0]->comentario_evaluador) {
                $row_dimensiones = str_replace("{ESTADO_VALIDACION}", '<span class="etiquetaPrograma etiquetaPrograma-aprobado pull-left"><i class="fas fa-check-square"></i>&nbsp;&nbsp;Finalizado</span>', $row_dimensiones);
            } else {
                $row_dimensiones = str_replace("{ESTADO_VALIDACION}", '<span class="etiquetaPrograma etiquetaPrograma-noiniciado pull-left"><i class="far fa-times-circle"></i>&nbsp;&nbsp;Pendiente</span>', $row_dimensiones);
            }
            $total_dimensiones++;
            $matris_datos_generales[$dimen->id]["total"]++;
            //Esto implica si esta finalizado o no.
            if ($estado_dimension[1] == 1) {
                $total_fijaciones_finalizadas++;
                $matris_datos_generales[$dimen->id]["finalizado"]++;
            }
        }
        $row = str_replace("{ROW_RESUMEN_POR_EVALUADO}", $row_dimensiones, $row);
    }
    $PRINCIPAL = str_replace("{LISTADO_COLABORADORES}", ($row), $PRINCIPAL);
    $PRINCIPAL = str_replace("{AVANCE_EVALUADOS}", EntregaPorcentaje($total_dimensiones, $total_fijaciones_finalizadas), $PRINCIPAL);
    foreach ($dimensiones_por_empresa as $dimen) {
        $row_dimensiones_gen .= file_get_contents("views/sgd/objetivos/row_resumen_por_dimension.html");
        $row_dimensiones_gen = str_replace("{NOMBRE_DIMENSION}", $dimen->nombre, $row_dimensiones_gen);
        $row_dimensiones_gen = str_replace("{AVANCE_DIMENSION}", EntregaPorcentaje($matris_datos_generales[$dimen->id]["total"], $matris_datos_generales[$dimen->id]["finalizado"]), $row_dimensiones_gen);
        $row_dimensiones_gen = str_replace("{AVANCE_DIMENSION_VALIDACION}", EntregaPorcentaje($matris_datos_generales[$dimen->id]["total"], $matriz_total_validadas[$dimen->id]["validadas"]), $row_dimensiones_gen);
    }
    $PRINCIPAL = str_replace("{ROW_LISTADO_RESUMEN}", ($row_dimensiones_gen), $PRINCIPAL);
    return ($PRINCIPAL);
}
function FormularioMedioCiclo($PRINCIPAL, $rut_fijador, $rut_evaluado, $id_empresa, $id_proceso, $id_objetivo, $rut_validador)
{
    //$datos_evaluado=UsuarioEnBasePersonas($rut_evaluado);
    $datos_evaluado          = UsuarioEnBasePersonasConEvaluadorValidador($rut_evaluado);
    $dimensiones_por_empresa = DimensionesObjetivosPorEmpresa($id_empresa);
    $PRINCIPAL               = str_replace("{BLOQUE_RESUMEN_COLABORADOR}", file_get_contents("views/sgd/objetivos/row_colaboradores_lista_resumen_superior.html"), $PRINCIPAL);
    $PRINCIPAL               = str_replace("{NOMBRE}", ($datos_evaluado[0]->nombre_completo), $PRINCIPAL);
    $PRINCIPAL               = str_replace("{PERFIL_COMPETENCIAS}", ($datos_evaluado[0]->perfil_competencia), $PRINCIPAL);
    $PRINCIPAL               = str_replace("{JEFE}", ($datos_evaluado[0]->nombre_evaluador), $PRINCIPAL);
    $PRINCIPAL               = str_replace("{JEFE_DEL_JEFE}", ($datos_evaluado[0]->nombre_validador), $PRINCIPAL);
    $PRINCIPAL               = str_replace("{CARGO}", ($datos_evaluado[0]->cargo), $PRINCIPAL);
    $PRINCIPAL               = str_replace("{FECHA_INGRESO}", ($datos_evaluado[0]->fecha_ingreso), $PRINCIPAL);
    $PRINCIPAL               = str_replace("{URL_PERSONA}", VerificaFotoPersonal($rut_evaluado), $PRINCIPAL);
    $row_dimensiones         = "";
    foreach ($dimensiones_por_empresa as $dimen) {
        if ($dimen->id == 24)
            continue;
        $row_dimensiones .= file_get_contents("views/sgd/objetivos/row_resumen_por_dimension_evaluado.html");
        $row_dimensiones = str_replace("{NOMBRE_DIMENSION}", $dimen->nombre, $row_dimensiones);
        $finalizado      = EstaFinalizadoEpata1($rut_evaluado, $id_proceso, $id_empresa);
        if ($finalizado) {
            $row_dimensiones = str_replace("{ESTADO}", '<span class="etiquetaPrograma etiquetaPrograma-aprobado pull-left"><i class="fas fa-check-square"></i>&nbsp;&nbsp;Finalizado</span>', $row_dimensiones);
        } else {
            $row_dimensiones = str_replace("{ESTADO}", '<span class="etiquetaPrograma etiquetaPrograma-noiniciado pull-left"><i class="far fa-times-circle"></i>&nbsp;&nbsp;Pendiente</span>', $row_dimensiones);
        }
        //verifico para esta dimension, para este evaluado, si esta ok la etapa de cierre
        if ($finalizado[0]->comentario_evaluado && $finalizado[0]->comentario_evaluador) {
            $row_dimensiones = str_replace("{ESTADO_VALIDACION}", '<span class="etiquetaPrograma etiquetaPrograma-aprobado pull-left"><i class="fas fa-check-square"></i>&nbsp;&nbsp;Finalizado</span>', $row_dimensiones);
        } else {
            $row_dimensiones = str_replace("{ESTADO_VALIDACION}", '<span class="etiquetaPrograma etiquetaPrograma-noiniciado pull-left"><i class="far fa-times-circle"></i>&nbsp;&nbsp;Pendiente</span>', $row_dimensiones);
        }
    }
    $PRINCIPAL = str_replace("{ROW_RESUMEN_POR_EVALUADO}", ($row_dimensiones), $PRINCIPAL);
    //Por cada dimension, armo el formulario
    foreach ($dimensiones_por_empresa as $dimen) {
        //$estado_dimension=VerificaEstadoDimensionesObjetivos($rut_evaluado, $dimen->id, $id_empresa);
        //$estado_dimension=VerificaEstadoDimensionesObjetivosParaValidacion($rut_evaluado, $dimen->id, $id_empresa);
        $esta_finalizado_Etapa1 = EstaFinalizadoEpata1($rut_evaluado, $id_proceso, $id_empresa);
        //if($estado_dimension[1]<>3){
        if ($esta_finalizado_Etapa1) {
            $formularios .= file_get_contents("views/sgd/objetivos/dimensiones/" . $dimen->template_lectura);
            $row_html                 = file_get_contents("views/sgd/objetivos/dimensiones/" . $dimen->row_lectura_medio_ciclo);
            $comentario_por_dimension = TieneComentariosObjetivosPorDimension($dimen->id, $rut_evaluado);
            if ($comentario_por_dimension) {
                $formularios .= file_get_contents("views/sgd/objetivos/dimensiones/bloque_comentario_por_dimension.html");
                $formularios = str_replace("{VALUE_COMENTARIO_DIMEN}", ($comentario_por_dimension[0]->comentario), $formularios);
            }
            $dimensiones_finalizadas++;
        } else {
            if ($_SESSION["user_"] == $rut_evaluado) {
                $formularios .= file_get_contents("views/sgd/objetivos/dimensiones/" . $dimen->template_lectura . "");
            } else {
                $formularios .= file_get_contents("views/sgd/objetivos/dimensiones/" . $dimen->template_medio_ciclo);
            }
            $formularios              = str_replace("{ID_DIMENSION}", $dimen->id, $formularios);
            $formularios              = str_replace("{RUT_EVALUADO}", $rut_evaluado, $formularios);
            $comentario_por_dimension = TieneComentariosObjetivosPorDimension($dimen->id, $rut_evaluado);
            $formularios              = str_replace("{VALUE_COMENTARIO_DIMEN}", ($comentario_por_dimension[0]->comentario), $formularios);
            if ($comentario_por_dimension[0]->comentario) {
                $total_comentarios_ingresados++;
            }
            if ($_SESSION["user_"] == $rut_evaluado) {
                $row_html = file_get_contents("views/sgd/objetivos/dimensiones/" . $dimen->medio_ciclo_ae);
            } else {
                $row_html = file_get_contents("views/sgd/objetivos/dimensiones/" . $dimen->row_medio_ciclo);
            }
        }
        //$formularios.=file_get_contents("views/sgd/objetivos/dimensiones/".$dimen->template);
        //$row_html=file_get_contents("views/sgd/objetivos/dimensiones/".$dimen->row);
        //Aca veo si hay comentarios de esta dimension o no
        $tiene_comentarios = VerificaComentariosPorDimension($rut_fijador, $rut_evaluado, $dimen->id, $id_empresa);
        if ($tiene_comentarios) {
            $formularios = str_replace("{VALUE_ACCIONES_REALIZADAS}", ($tiene_comentarios[0]->acciones_realizadas), $formularios);
            $formularios = str_replace("{VALUE_IMPACTO}", ($tiene_comentarios[0]->impacto), $formularios);
            $formularios = str_replace("{CASE_FORM_COMEN_DIMENSION}", "updComDim", $formularios);
        } else {
            $formularios = str_replace("{VALUE_ACCIONES_REALIZADAS}", "", $formularios);
            $formularios = str_replace("{VALUE_IMPACTO}", "", $formularios);
            $formularios = str_replace("{CASE_FORM_COMEN_DIMENSION}", "saveComDim", $formularios);
        }
        $formularios               = str_replace("{NUMERO}", $dimen->orden, $formularios);
        $formularios               = str_replace("{NOMBRE_DIMENSION}", ($dimen->nombre), $formularios);
        //$formularios = str_replace("{CASE_FORM}",$dimen->case."&val=1",$formularios);
        $formularios               = str_replace("{CASE_FORM}", "saveobjv23Jefe&val=1", $formularios);
        //$formularios = str_replace("{BOTON1}",file_get_contents("views/sgd/objetivos/BotonJefeJefeValida.html"),$formularios);
        $formularios               = str_replace("{BOTON1}", "", $formularios);
        $formularios               = str_replace("{ID_DIMENSION_ENCODEADO}", $dimen->id, $formularios);
        $formularios               = str_replace("{OPTIONS_PONDERACIONES}", PondObjetivos2(""), $formularios);
        $formularios               = str_replace("{OPTIONS_COMPETENCIAS}", (ComboBoxCompetenciasPorPerfil($datos_evaluado[0]->id_perfil_competencia, "")), $formularios);
        //Por cada formulario, veo si existen objetivos ingresados en esta dimension
        //$objetivos_ingresados=ObjetivosPodDimensionEmpresaUsuario($rut_evaluado, $id_empresa, $dimen->id);
        //Por cada formulario, veo si existen objetivos ingresados en esta dimension
        $objetivos_ingresados      = ObjetivosPodDimensionEmpresaUsuario($rut_evaluado, $id_empresa, $dimen->id, $datos_evaluado[0]->id_perfil_competencia);
        $suma_objetivos_ingresados = ObjetivosPodDimensionEmpresaUsuarioSumaPonderacion($rut_evaluado, $id_empresa, $dimen->id);
        if ($dimen->tiene_ponderacion == 1) {
            if (count($objetivos_ingresados) >= $dimen->minimo && count($objetivos_ingresados) <= $dimen->maximo && $suma_objetivos_ingresados[0]->suma_ponderaciones == 100) {
                $muestra_boton_envia_a_jefe++;
            }
        } else {
            if (count($objetivos_ingresados) >= $dimen->minimo && count($objetivos_ingresados) <= $dimen->maximo) {
                $muestra_boton_envia_a_jefe++;
            }
        }
        if ($objetivos_ingresados) {
            $formularios                = str_replace("{BLOQUE_LISTADO_OBJETIVOS_INGRESADOS}", file_get_contents("views/sgd/objetivos/dimensiones/" . $dimen->entornoLecturaForm), $formularios);
            $total_objetivos_ingresados = "";
            $k                          = 0;
            $suma_ponderacion           = 0;
            foreach ($objetivos_ingresados as $obj_ing) {
                $k++;
                //$total_objetivos_ingresados.=file_get_contents("views/sgd/objetivos/dimensiones/".$dimen->row);
                if ($id_objetivo == $obj_ing->id) {
                    $total_objetivos_ingresados .= file_get_contents("views/sgd/objetivos/dimensiones/edita_" . $dimen->row);
                } else {
                    $total_objetivos_ingresados .= $row_html;
                }
                //$total_objetivos_ingresados.=$row_html;
                $total_objetivos_ingresados = str_replace("{NUMERO}", $k, $total_objetivos_ingresados);
                $total_objetivos_ingresados = str_replace("{ID_DIMENSION}", $dimen->id, $total_objetivos_ingresados);
                $total_objetivos_ingresados = str_replace("{ID_DIMENSION_ENCODEADA}", Encodear3($dimen->id), $total_objetivos_ingresados);
                $total_objetivos_ingresados = str_replace("{PARAMETROS_VAL}", "&rval=" . $rut_validador, $total_objetivos_ingresados);
                $total_objetivos_ingresados = str_replace("{OBJETIVO}", ($obj_ing->descripcion_objetivo), $total_objetivos_ingresados);
                $total_objetivos_ingresados = str_replace("{RUT_EVALUADO}", ($rut_evaluado), $total_objetivos_ingresados);
                $total_objetivos_ingresados = str_replace("{RUT}", ($rut_evaluado), $total_objetivos_ingresados);
                $total_objetivos_ingresados = str_replace("{ID_OBJETIVO_ENCODEADO}", Encodear3($obj_ing->id), $total_objetivos_ingresados);
                $total_objetivos_ingresados = str_replace("{ID_OBJETIVO}", ($obj_ing->id), $total_objetivos_ingresados);
                $total_objetivos_ingresados = str_replace("{ACCION}", ($obj_ing->accion_clave), $total_objetivos_ingresados);
                //$total_objetivos_ingresados = str_replace("{CONDUCTA_CRITICA}",($obj_ing->conducta_critica),$total_objetivos_ingresados);
                //$total_objetivos_ingresados = str_replace("{CONDUCTA_CRITICA}",($obj_ing->nombre_competencia),$total_objetivos_ingresados);
                $total_objetivos_ingresados = str_replace("{CONDUCTA_CRITICA}", ($obj_ing->nombre_conducta), $total_objetivos_ingresados);
                $total_objetivos_ingresados = str_replace("{COMPETENCIA}", ($obj_ing->nombre_competencia), $total_objetivos_ingresados);
                $total_objetivos_ingresados = str_replace("{COMENTARIO_MEDIO_CICLO}", ($obj_ing->comentario_medio_ciclo), $total_objetivos_ingresados);
                $total_objetivos_ingresados = str_replace("{NOTA_MEDIO_CICLO_JEFE}", ($obj_ing->nota_medio_ciclo_jefe), $total_objetivos_ingresados);
                $total_objetivos_ingresados = str_replace("{NOTA_MEDIO_CICLO_AE}", ($obj_ing->nota_medio_ciclo_ae), $total_objetivos_ingresados);
                $total_objetivos_ingresados = str_replace("{COMENTARIO}", ($obj_ing->comentarios), $total_objetivos_ingresados);
                $total_objetivos_ingresados = str_replace("{ACCION_DESARROLLO}", ($obj_ing->acciones_desarrollo), $total_objetivos_ingresados);
                $total_objetivos_ingresados = str_replace("{RESPONSABLE}", ($obj_ing->responsable), $total_objetivos_ingresados);
                $total_objetivos_ingresados = str_replace("{FECHA}", ($obj_ing->fecha_limite), $total_objetivos_ingresados);
                $total_objetivos_ingresados = str_replace("{ENV_EDITAR}", "updobjetivoV2Val", $total_objetivos_ingresados);
                $total_objetivos_ingresados = str_replace("{PONDERACION}", ($obj_ing->ponderacion) . "%", $total_objetivos_ingresados);
                $total_objetivos_ingresados = str_replace("{OPTIONS_PONDERACIONES_INGRESADO}", PondObjetivos2($obj_ing->ponderacion) . "%", $total_objetivos_ingresados);
                //$total_objetivos_ingresados  = str_replace("{OPTIONS_COMPETENCIAS_INGRESADO}",(ComboBoxCompetenciasPorPerfil($datos_evaluado[0]->id_perfil_competencia, $obj_ing->conducta_critica)),$total_objetivos_ingresados );
                $total_objetivos_ingresados = str_replace("{OPTIONS_COMPETENCIAS_INGRESADO}", (ComboBoxCompetenciasPorPerfil($datos_evaluado[0]->id_perfil_competencia, $obj_ing->competencia)), $total_objetivos_ingresados);
                $total_objetivos_ingresados = str_replace("{OPTIONS_CONDUCTAS_CRITICAS}", (ComboBoxConductasCriticasDadoPerfilYCompetencias($datos_evaluado[0]->id_perfil_competencia, $obj_ing->competencia, $obj_ing->conducta_critica)), $total_objetivos_ingresados);
                $total_objetivos_ingresados = str_replace("{ACCIONES_REALIZADAS}", ($obj_ing->acciones_realizadas), $total_objetivos_ingresados);
                $total_objetivos_ingresados = str_replace("{IMPACTO}", ($obj_ing->impacto), $total_objetivos_ingresados);
                $total_objetivos_ingresados = str_replace("{TIPO_ACCION}", ($obj_ing->tipo_accion), $total_objetivos_ingresados);
                $total_objetivos_ingresados = str_replace("{SELECTED_" . ($obj_ing->tipo_accion) . "}", "selected", $total_objetivos_ingresados);
                $suma_ponderacion           = $suma_ponderacion + $obj_ing->ponderacion;
            }
            $formularios = str_replace("{ROW_INGRESADOS}", $total_objetivos_ingresados, $formularios);
            $formularios = str_replace("{TOTAL_PONDERACION}", $suma_ponderacion . "%", $formularios);
            $formularios = str_replace("{ID_PERFIL_COMPETENCIAS}", $datos_evaluado[0]->id_perfil_competencia, $formularios);
            if ($suma_ponderacion == 100) {
                $formularios = str_replace("{CLASE_PONDERACION}", "pond_correcto", $formularios);
            } else {
                $formularios = str_replace("{CLASE_PONDERACION}", "pond_alerta", $formularios);
            }
        } else {
            $formularios = str_replace("{ROW_INGRESADOS}", "NO", $formularios);
        }
    }
    //$PRINCIPAL = str_replace("{BOTON_ENVIA_A_VALIDAR_OBJETIVOS}",file_get_contents("views/sgd/objetivos/BotonJefeJefeValida.html"),$PRINCIPAL);
    if ($total_comentarios_ingresados == 2) {
        //$PRINCIPAL = str_replace("{BOTON_JEFE_FINALIZA__MEDIO_CICLO}",file_get_contents("views/sgd/objetivos/BotonJefeFinaliza1MedioCiclo.html"),$PRINCIPAL);
    } else {
        //$PRINCIPAL = str_replace("{BOTON_JEFE_FINALIZA__MEDIO_CICLO}","",$PRINCIPAL);
    }
    if ($_SESSION["user_"] == $rut_evaluado) {
        $PRINCIPAL = str_replace("{BOTON_JEFE_FINALIZA__MEDIO_CICLO}", "", $PRINCIPAL);
    } else {
        $esta_finalizado_Etapa1 = EstaFinalizadoEpata1($rut_evaluado, $id_proceso, $id_empresa);
        if ($esta_finalizado_Etapa1) {
            $PRINCIPAL = str_replace("{BOTON_JEFE_FINALIZA__MEDIO_CICLO}", "", $PRINCIPAL);
        } else {
            $PRINCIPAL = str_replace("{BOTON_JEFE_FINALIZA__MEDIO_CICLO}", file_get_contents("views/sgd/objetivos/BotonJefeFinaliza1MedioCiclo.html"), $PRINCIPAL);
        }
    }
    $PRINCIPAL = str_replace("{NUMERO_PASO}", count($dimensiones_por_empresa) + 1, $PRINCIPAL);
    $PRINCIPAL = str_replace("{BLOQUE_FORMULARIOS_POR_DIMENSIONES}", $formularios, $PRINCIPAL);
    $PRINCIPAL = str_replace("{RUT_EVALUADO_ENCODEADO}", Encodear3($rut_evaluado), $PRINCIPAL);
    $PRINCIPAL = str_replace("{RUT_EVALUADO}", ($rut_evaluado), $PRINCIPAL);
    $PRINCIPAL = str_replace("{ID_PROCESO}", ($id_proceso), $PRINCIPAL);
    return ($PRINCIPAL);
}
function SubidaCVMovimientoInternos($FILES, $extension_doc, $prefijo, $ruta, $numero)
{
    //echo "$extension_archivo, $prefijo, $ruta";exit;
    //$ruta_con_archivo=$ruta."/".$prefijo."_BK.".$extension_archivo;
    $ruta_con_archivo = $ruta . "/" . $prefijo . "." . $extension_doc;
    copy($FILES['archivo']['tmp_name'], $ruta_con_archivo);
    $nombre_imagen_video = $prefijo . "." . $extension_doc;
    //RedimensionarImagenSlider($ruta_con_archivo, $nombre_imagen_slider);
    //Devuelvol un arreglo, con datos del archivo subido
    $arreglo[0]          = $ruta_con_archivo; //Ruta Completa
    $arreglo[1]          = $prefijo . "." . $extension_doc; //Nombre del Archivo
    $arreglo[2]          = $ruta . "/" . $prefijo; //Ruta del Objeto sin el index
    return ($arreglo);
}
function FormularioPostula($PRINCIPAL, $rut, $id_oferta)
{
    $detalle_postulacion = DetalleMovimientoInterno($id_oferta);
    $PRINCIPAL           = str_replace("{NOMBRE_CARGO}", ($detalle_postulacion[0]->cargo), $PRINCIPAL);
    $PRINCIPAL           = str_replace("{OBJETIVO_CARGO}", ($detalle_postulacion[0]->objetivo_cargo), $PRINCIPAL);
    $PRINCIPAL           = str_replace("{REQUISITOS_CARGO}", ($detalle_postulacion[0]->requisito_cargo), $PRINCIPAL);
    $PRINCIPAL           = str_replace("{ID_PUBLICACION}", Encodear3($id_oferta), $PRINCIPAL);
    return ($PRINCIPAL);
}
function ColocaListadoMovimientosInternos($PRINCIPAL, $id_empresa, $rut)
{
    //Traigo total de los movimientos internos
    $listado = ListadoMovimientosInternos($id_empresa, $rut);
    foreach ($listado as $list) {
        $row .= file_get_contents("views/movimientos_internos/row_MovimientosInternos.html");
        $row = str_replace("{NOMBRE_CARGO}", $list->cargo, $row);
        $row = str_replace("{FECHA_PUBLICACION}", $list->fecha_publicacion, $row);
        $row = str_replace("{FECHA_EXPIRACION}", $list->fecha_expiracion, $row);
        if ($list->fecha_postulacion) {
            $row = str_replace("{ACCION}", "<span  class='btn btn-info'>Ya Postulaste</span>", $row);
        } else {
            $row = str_replace("{ACCION}", "<a class='btn btn-info' href='?sw=postulaMovInt&i=" . Encodear3($list->id) . "'>Postula</a>", $row);
        }
    }
    $PRINCIPAL = str_replace("{LISTADO_MOVIMIENTOS_INTERNOS}", ($row), $PRINCIPAL);
    return ($PRINCIPAL);
}
function ColocaDatosBiografiaProfesional($id_objeto, $rut, $PRINCIPAL)
{
    $datos_objeto = DatosObjeto($id_objeto);
    $datos        = TraeDatosBiografiaProfesional($rut, $id_objeto);
    $PRINCIPAL    = str_replace("{pareja}", ($datos[0]->pareja), $PRINCIPAL);
    $PRINCIPAL    = str_replace("{emfermedades_importantes}", ($datos[0]->emfermedades_importantes), $PRINCIPAL);
    $PRINCIPAL    = str_replace("{nombre_contacto_emergencia}", ($datos[0]->nombre_contacto_emergencia), $PRINCIPAL);
    $PRINCIPAL    = str_replace("{telefono_contacto_emergencia}", ($datos[0]->telefono_contacto_emergencia), $PRINCIPAL);
    $PRINCIPAL    = str_replace("{estudios}", ($datos[0]->estudios), $PRINCIPAL);
    $PRINCIPAL    = str_replace("{profesion}", ($datos[0]->profesion), $PRINCIPAL);
    $PRINCIPAL    = str_replace("{cantidad_hijos}", ($datos[0]->cantidad_hijos), $PRINCIPAL);
    $PRINCIPAL    = str_replace("{edad_hijos}", ($datos[0]->edad_hijos), $PRINCIPAL);
    $PRINCIPAL    = str_replace("{sexo_hijos}", ($datos[0]->sexo_hijos), $PRINCIPAL);
    $PRINCIPAL    = str_replace("{ultima_empresa}", ($datos[0]->ultima_empresa), $PRINCIPAL);
    $PRINCIPAL    = str_replace("{cargo_ultima_empresa}", ($datos[0]->cargo_ultima_empresa), $PRINCIPAL);
    $PRINCIPAL    = str_replace("{tiempo_ultima_empresa}", ($datos[0]->tiempo_ultima_empresa), $PRINCIPAL);
    $PRINCIPAL    = str_replace("{motivacion}", ($datos[0]->motivacion), $PRINCIPAL);
    $PRINCIPAL    = str_replace("{que_esperas_jefatura}", ($datos[0]->que_esperas_jefatura), $PRINCIPAL);
    $PRINCIPAL    = str_replace("{que_esperas_cargo}", ($datos[0]->que_esperas_cargo), $PRINCIPAL);
    $PRINCIPAL    = str_replace("{metas}", ($datos[0]->metas), $PRINCIPAL);
    $PRINCIPAL    = str_replace("{capacitacion}", ($datos[0]->capacitacion), $PRINCIPAL);
    $PRINCIPAL    = str_replace("{talla_camisa}", ($datos[0]->talla_camisa), $PRINCIPAL);
    $PRINCIPAL    = str_replace("{talla_pantalon}", ($datos[0]->talla_pantalon), $PRINCIPAL);
    $PRINCIPAL    = str_replace("{talla_chaqueta}", ($datos[0]->talla_chaqueta), $PRINCIPAL);
    $PRINCIPAL    = str_replace("{talla_falda}", ($datos[0]->talla_falda), $PRINCIPAL);
    $PRINCIPAL    = str_replace("{titulo_principal}", ($datos_objeto[0]->titulo_principal), $PRINCIPAL);
    $PRINCIPAL    = str_replace("{pregunta_principal}", ($datos_objeto[0]->pregunta_principal), $PRINCIPAL);
    $PRINCIPAL    = str_replace("{bajada_principal}", ($datos_objeto[0]->bajada_principal), $PRINCIPAL);
    $PRINCIPAL    = str_replace("{titulo_secundario}", ($datos_objeto[0]->titulo_secundario), $PRINCIPAL);
    $PRINCIPAL    = str_replace("{bajada_secundario}", ($datos_objeto[0]->bajada_secundario), $PRINCIPAL);
    $PRINCIPAL    = str_replace("{subtitulo_principal}", ($datos_objeto[0]->subtitulo_principal), $PRINCIPAL);
    $PRINCIPAL    = str_replace("{bajada_subtitulo_principal}", ($datos_objeto[0]->bajada_subtitulo_principal), $PRINCIPAL);
    if ($_GET["idvideo"]) {
        //Obtengo el Video con el id
        $datos_video = DatosArchivoImagenCruceObjeto($_GET["idvideo"]);
        $PRINCIPAL   = str_replace("{BLOQUE_REPRODUCTOR_VIDEO}", file_get_contents("views/cursos/objetos/subirVideos/reproductor_video.html"), $PRINCIPAL);
        $PRINCIPAL   = str_replace("{URL_VIDEO}", "img/objetos/" . $datos_video[0]->archivo, $PRINCIPAL);
        $PRINCIPAL   = str_replace("{TITULO_VIDEO}", $datos_video[0]->titulo_video, $PRINCIPAL);
        $PRINCIPAL   = str_replace("{DESCRIPCION_VIDEO}", $datos_video[0]->descripcion_video, $PRINCIPAL);
    } else {
        $PRINCIPAL = str_replace("{BLOQUE_REPRODUCTOR_VIDEO}", file_get_contents("views/cursos/objetos/subirVideos/mensaje_seleccione_video.html"), $PRINCIPAL);
    }
    if ($datos) {
        $PRINCIPAL = str_replace("{STYLO_MUESTRA_BOTON2}", "", $PRINCIPAL);
        //$PRINCIPAL = str_replace("{STYLO_MUESTRA_BOTON1}",'style="display:none;"',$PRINCIPAL);
        $PRINCIPAL = str_replace("{STYLO_MUESTRA_BOTON1}", '', $PRINCIPAL);
    } else {
        $PRINCIPAL = str_replace("{STYLO_MUESTRA_BOTON1}", "", $PRINCIPAL);
        $PRINCIPAL = str_replace("{STYLO_MUESTRA_BOTON2}", 'style="display:none;"', $PRINCIPAL);
    }
    return ($PRINCIPAL);
}
function FinalizaObjetoPorUsuario($rut, $id_objeto, $id_empresa)
{
    $datos_objeto = DatosObjeto($id_objeto);
    $puntos       = $datos_objeto[0]->puntos;
    $medalla      = $datos_objeto[0]->medallas;
    FinalizaObjetoFullDatos($rut, $id_objeto, $id_empresa);
}
function BuscaUserBci($email, $id_empresa)
{
    //echo "$email, $id_empresa";
    $key        = buscaUserBciData($email, $id_empresa);
    $entregarut = $key[0]->rut;
    return $entregarut;
}
function EnviaCorreoAccionesPendientes($rut_colaborador, $rut_jefatura, $id_empresa)
{
    //echo "$rut_destinatario,$nombre, $id_estado, $id_empresa, $tipo_correo, $tiporecipiente, $id_mp";
    $datos_empresa      = DatosEmpresa($id_empresa);
    $datos_colaborador  = UsuarioEnBasePersonas($rut_colaborador);
    $datos_jefatura     = UsuarioEnBasePersonas($rut_jefatura);
    $nombre_colaborador = $datos_colaborador[0]->nombre_completo;
    $nombre_jefatura    = $datos_jefatura[0]->nombre_completo;
    $email_jefatura     = $datos_jefatura[0]->email;
    $template_correo    = file_get_contents("views/correos/61_correo_a_jefe.html");
    $template_correo    = str_replace("{NOMBRE_JEFE}", ($nombre_jefatura), $template_correo);
    $template_correo    = str_replace("{NOMBRE_COLABORADOR}", ($nombre_colaborador), $template_correo);
    //$template_correo = str_replace("{PRACTICA}",($nombre_practica),$template_correo);
    $mail               = new PHPMailer;
    //Tell PHPMailer to use SMTP
    $mail->isSMTP(); //Enable SMTP debugging
    // 0 = off (for production use)
    // 1 = client messages
    // 2 = client and server messages
    $mail->SMTPDebug   = 1;
    //Ask for HTML-friendly debug output
    $mail->Debugoutput = 'error_log';
    //Set the hostname of the mail server
    $mail->Host        = $datos_empresa[0]->server;
    //Set the SMTP port number - likely to be 25, 465 or 587
    $mail->Port        = 25;
    //Whether to use SMTP authentication
    $mail->SMTPAuth    = true;
    //Username to use for SMTP authentication
    $mail->Username    = $datos_empresa[0]->envio_correos;
    //Password to use for SMTP authentication
    $mail->Password    = $datos_empresa[0]->envio_correos_pass;
    //Set who the message is to be sent from
    $mail->setFrom($datos_empresa[0]->envio_correos, "RF");
    $mail->addAddress("daniel@gop.cl", $datos_destinatario[0]->nombre_completo);
    $mail->addAddress("rod@gop.cl", $datos_destinatario[0]->nombre_completo);
    //Set the subject line
    $mail->Subject = "Jefe debes validar el Pasaporte";
    //Read an HTML message body from an external file, convert referenced images to embedded,
    //convert HTML into a basic plain-text alternative body
    $mail->msgHTML($template_correo, dirname(__FILE__));
    //Replace the plain text body with one created manually
    $mail->AltBody = 'Si no puedes visualizar este correo ....';
    //Attach an image file
    //$mail->addAttachment('images/phpmailer_mini.png');
    //send the message, check for errors
    if (!$mail->send()) {
        //echo "Mailer Error: " . $mail->ErrorInfo;
    } else {
        //echo "Message sent!";
    }
    //exit;
}
function MuestraInformeSoloMensaje($PRINCIPAL, $id_empresa, $id_encuesta, $id_objeto, $id_curso)
{
    $html .= file_get_contents("views/encuesta/" . $id_empresa . "_template_enc_mensaje_final.html");
    $PRINCIPAL      = str_replace("{BLOQUE_ENCUESTA}", ($html), $PRINCIPAL);
    $datos_encuesta = DDatosEncSatis($id_encuesta);
    $PRINCIPAL      = str_replace("{TITULO}", ($datos_encuesta[0]->nombre), $PRINCIPAL);
    $PRINCIPAL      = str_replace("{ID_CURSO_ENCODEADO}", Encodear3($id_curso), $PRINCIPAL);
    return ($PRINCIPAL);
}
function VerificoEvalCursos($id_objeto, $rut)
{
    $datos_objeto = DatosObjeto($id_objeto);
    if ($datos_objeto[0]->preguntas_aleatorias > 0) {
        //$datos_preguntas=PreguntasDadoIdObjetoaleatorio($id_objeto, $rut);
        $datos_preguntas = EVALUACION_PreguntasDadoIdObjetoaleatorio($id_objeto, $rut);
    } else {
        //$datos_preguntas=PreguntasDadoIdObjeto($id_objeto);
        $datos_preguntas = EVALUACION_PreguntasDadoIdObjeto($id_objeto);
    }
    $PRINCIPAL       = str_replace("{NOMBRE_OBJETO}", ($datos_objeto[0]->titulo), $PRINCIPAL);
    $datos_usuario   = UsuarioEnBasePersonas($rut);
    $PRINCIPAL       = str_replace("{NOMBRE_USUARIO}", ($datos_usuario[0]->nombre_completo), $PRINCIPAL);
    $total_preguntas = "";
    $i               = 1;
    $correctas       = 0;
    foreach ($datos_preguntas as $preg) {
        $total_preguntas .= file_get_contents("views/cursos/informe/" . $_SESSION["id_empresa"] . "_row_informe_eval_preguntas.html");
        $total_preguntas   = str_replace("{N}", $i, $total_preguntas);
        $total_preguntas   = str_replace("{PREGUNTA}", $preg->pregunta, $total_preguntas);
        //Verifico si la respuesta que ingreso el usuario para eta pregunta es correcta o no
        $respuesta_usuario = ObtenerRespuestaDeUsuario($preg->id, $rut);
        //print_r($respuesta_usuario);
        $total_preguntas   = str_replace("{TURESPUESTA}", $respuesta_usuario[0]->alternativa, $total_preguntas);
        if ($respuesta_usuario[0]->correcta == "1") {
            $total_preguntas = str_replace("{COLOR_FONDO}", "color_aprobado_text", $total_preguntas);
            $total_preguntas = str_replace("{ICONO_INFORME_PREGUNTAS}", "fas fa-check-square", $total_preguntas);
            $total_preguntas = str_replace("{RESPUESTA_CORRECTA}", "", $total_preguntas);
            $correctas++;
        } else {
            $total_preguntas = str_replace("{COLOR_FONDO}", "color_reprobado_text", $total_preguntas);
            $total_preguntas = str_replace("{ICONO_INFORME_PREGUNTAS}", "far fa-times-circle", $total_preguntas);
            if ($_SESSION["id_empresa"] <> 57) {
                $total_preguntas = str_replace("{RESPUESTA_CORRECTA}", file_get_contents("views/cursos/informe/row_respuesta_correcta.html"), $total_preguntas);
            } else {
                $total_preguntas = str_replace("{RESPUESTA_CORRECTA}", "", $total_preguntas);
            }
            $total_preguntas = str_replace("{CORRECTA}", $respuesta_usuario[0]->alternativa_correcta, $total_preguntas);
        }
        $i++;
    }
    //NotaFinal
    $nota_final = ($correctas * 100) / count($datos_preguntas);
    if ($_SESSION["id_empresa"] == 57) {
        if ($nota_final == 100) {
            $arreglo[0] = "aprobado";
        } else if ($nota_final >= 0 and $nota_final < 100) {
            $arreglo[0] = "reprobado";
        }
    } else if ($_SESSION["id_empresa"] == 53) {
        if ($nota_final >= 75) {
            $arreglo[0] = "aprobado";
        } else {
            $arreglo[0] = "reprobado";
        }
    } else {
        //Veo si tiene nota de aprobacion el objeto
        $nota_aprobacion_objeto = $datos_objeto[0]->nota_aprobacion;
        if ($nota_aprobacion_objeto) {
            if ($nota_final >= $nota_aprobacion_objeto) {
                $arreglo[0] = "aprobado";
            } else {
                $arreglo[0] = "reprobado";
            }
        } else {
            if ($nota_final == 100) {
                $arreglo[0] = "aprobado";
            } else {
                $arreglo[0] = "reprobado";
            }
        }
    }
    return ($arreglo);
}
function ColocaPReguntasPorEval($id_objeto)
{
    //traigo las preguntas
    $preguntas = PreguntasEvalDadoIdObjeto($id_objeto);
    foreach ($preguntas as $preg) {
        $bloque_preguntas .= file_get_contents("views/cursos/objetos/preguntas/row_pregunta.html");
        $bloque_preguntas  = str_replace("{PREGUNTA}", ($preg->pregunta), $bloque_preguntas);
        $bloque_preguntas  = str_replace("{NUMERO_PREGUNTA}", ($preg->orden_preguntas), $bloque_preguntas);
        //Por cada pregunta, traigo las alternativas
        $alternativas      = AlternativasDadoId($preg->id_grupo_alternativas);
        $html_alternativas = "";
        foreach ($alternativas as $alt) {
            $html_alternativas .= file_get_contents("views/cursos/objetos/preguntas/row_alternativa.html");
            $html_alternativas = str_replace("{ALTERNATIVA}", ($alt->alternativa), $html_alternativas);
            if ($alt->correcta == 1) {
                $html_alternativas = str_replace("{CORRECTA}", "<img src='img/correcta.png'>", $html_alternativas);
            } else if ($alt->correcta == 0) {
                $html_alternativas = str_replace("{CORRECTA}", "<img src='img/incorrecta.png'>", $html_alternativas);
            }
        }
        $bloque_preguntas = str_replace("{ROW_ALTERNATIVAS}", ($html_alternativas), $bloque_preguntas);
    }
    return (($bloque_preguntas));
}
function ColocaObjetosPorCursoSiNotiene($id_empresa, $id_curso, $codigo_imparticion)
{
    $tiene_objeto = CHECK_ObjetosPorCurso($id_curso);
    if (!$tiene_objeto) {
        //Inserto los objetos en la tabla objeto, por este curso
        $objetos = CHECK_TraeObjetosPAraIngresar();
        $orden   = 1;
        foreach ($objetos as $obj) {
            //Inserto el objeto
            //InsertoObjetoCheckin($obj, $id_empresa, $id_curso, $orden);
            if ($codigo_imparticion) {
                InsertoObjetoCheckin($obj, $id_empresa, $codigo_imparticion, $orden, $id_curso);
            } else {
                InsertoObjetoCheckin($obj, $id_empresa, $id_curso, $orden);
            }
            $orden++;
            if ($obj->extension_objeto == "18") {
                if ($codigo_imparticion) {
                    $id_evaluacion = CreoEvaluacionPorObjeto($id_empresa, $codigo_imparticion, $codigo_imparticion . "_" . $obj->id);
                } else {
                    $id_evaluacion = CreoEvaluacionPorObjeto($id_empresa, $id_curso, $id_curso . "_" . $obj->id);
                }
            }
        }
    }
}
function ColocaBloqueComentariosPorObjetoConReplay($id_objeto, $rut, $rut_colaborador_vista_jefe)
{
    //Veo si hay documentos por Objeto
    //echo " rut $rut  ----  desde jefe $rut_colaborador_vista_jefe";
    //$comentarios=ComentariosPorObjeto($id_objeto);
    //echo $rut_colaborador_vista_jefe." rut col desde vista jefe";
    if ($rut_colaborador_vista_jefe) {
        $comentarios = ComentariosPorObjetoPorColaborador($id_objeto, $rut_colaborador_vista_jefe);
    } else {
        $comentarios = ComentariosPorObjetoPorColaborador($id_objeto, $rut);
    }
    $bloque_comentarios = "";
    if ($comentarios) {
        $total = "";
        foreach ($comentarios as $unico) {
            $bloque_comentarios = file_get_contents("views/cursos/objetos/foro_prod/bloque_comentario.html");
            $bloque_comentarios = str_replace("{URL_IMAGEN_PERSONA}", VerificaFotoPersonal($unico->rut), $bloque_comentarios);
            $bloque_comentarios = str_replace("{NOMBRE}", ($unico->nombre_persona), $bloque_comentarios);
            $bloque_comentarios = str_replace("{COMENTARIO}", ($unico->comentario), $bloque_comentarios);
            $bloque_comentarios = str_replace("{RUT_ENCODEADO_AUTOR_COMENTARIO}", Encodear3($unico->rut), $bloque_comentarios);
            $bloque_comentarios = str_replace("{FECHA}", FechaTipoSpa($unico->fecha . " " . $unico->hora), $bloque_comentarios);
            $tiene_megusta      = MegustaPorComentarioRut($unico->id, $rut);
            if ($unico->rut == $rut) {
                $bloque_comentarios = str_replace("{BLOQUE_MEGUSTA}", file_get_contents("views/cursos/objetos/foro_prod/bloque_comentario_micomentario.html"), $bloque_comentarios);
            } else {
                if ($tiene_megusta) {
                    $bloque_comentarios = str_replace("{BLOQUE_MEGUSTA}", file_get_contents("views/cursos/objetos/foro_prod/bloque_comentario_yamegusta.html"), $bloque_comentarios);
                } else {
                    $bloque_comentarios = str_replace("{BLOQUE_MEGUSTA}", file_get_contents("views/cursos/objetos/foro_prod/bloque_comentario_megusta.html"), $bloque_comentarios);
                }
            }
            $bloque_comentarios             = str_replace("{ID_COMENTARIO}", $unico->id, $bloque_comentarios);
            // $bloque_comentarios = str_replace("{ID_OBJETO_ENCODEADO}",$id_objeto,$bloque_comentarios);
            $bloque_comentarios             = str_replace("{ID_COMENTARIO_MEGUSTA}", $unico->id, $bloque_comentarios);
            //Verifico si este comentario ya tiene un me gusta, si ya tiene, le muestro un bloque de me gusta,
            //sino el bloque de Yamegusta
            //Veo cuantos ME GUSTA tiene este comentario
            $cantidad_megusta_porcomentario = MegustaPorComentario($unico->id);
            $bloque_comentarios             = str_replace("{XMEGUSTA}", count($cantidad_megusta_porcomentario), $bloque_comentarios);
            //Aca veo si tiene REPLYS
            $replys                         = ReplysPorComentarios($unico->id);
            $bloque_comentarios             = str_replace("{NUM_RESP}", count($replys), $bloque_comentarios);
            if ($replys) {
                foreach ($replys as $repl) {
                    $replys_html .= file_get_contents("views/cursos/objetos/foro_prod/bloque_comentario_replay.html");
                    $replys_html             = str_replace("{URL_IMAGEN_PERSONA}", VerificaFotoPersonal($repl->rut), $replys_html);
                    $replys_html             = str_replace("{NOMBRE}", ($repl->nombre_completo), $replys_html);
                    $replys_html             = str_replace("{COMENTARIO}", ($repl->comentario), $replys_html);
                    $replys_html             = str_replace("{RUT_ENCODEADO_AUTOR_COMENTARIO}", Encodear3($repl->rut), $replys_html);
                    $replys_html             = str_replace("{FECHA}", FechaTipoSpa($repl->fecha . " " . $repl->hora), $replys_html);
                    $tiene_megusta_por_reply = MegustaPorComentarioRutReply($repl->id, $rut);
                    if ($repl->rut == $rut) {
                        $replys_html = str_replace("{BLOQUE_MEGUSTA_REPLY}", file_get_contents("views/cursos/objetos/foro_prod/bloque_comentario_reply_micomentario.html"), $replys_html);
                    } else {
                        if ($tiene_megusta_por_reply) {
                            $replys_html = str_replace("{BLOQUE_MEGUSTA_REPLY}", file_get_contents("views/cursos/objetos/foro_prod/bloque_comentario_reply_yamegusta.html"), $replys_html);
                        } else {
                            $replys_html = str_replace("{BLOQUE_MEGUSTA_REPLY}", file_get_contents("views/cursos/objetos/foro_prod/bloque_comentario_reply_megusta.html"), $replys_html);
                        }
                    }
                    $replys_html                         = str_replace("{ID_COMENTARIO_REPLY}", ($repl->id), $replys_html);
                    $cantidad_megusta_porcomentarioReply = MegustaPorComentarioReply($repl->id);
                    $replys_html                         = str_replace("{XMEGUSTAREPLY}", count($cantidad_megusta_porcomentarioReply), $replys_html);
                }
                $bloque_comentarios = str_replace("{LISTADO_REPLY_POR_COMENTARIO}", $replys_html, $bloque_comentarios);
            } else {
                $bloque_comentarios = str_replace("{LISTADO_REPLY_POR_COMENTARIO}", "", $bloque_comentarios);
            }
            $total .= $bloque_comentarios;
        }
    } else {
    }
    return (($total));
}
function ColocaBloqueComparte($PRINCIPAL, $id_empresa, $id_malla, $rut, $tipo)
{
    if ($tipo == "home") {
        $limit_total = "3";
        $html        = file_get_contents("views/cursos/objetos/foro_cat/formulario.html");
    } else if ($tipo == "todo") {
        $limit_total = "";
        $html        = file_get_contents("views/cursos/objetos/foro_cat/formulario_completo.html");
    }
    $html             = str_replace("{URL_MIPERFIL}", VerificaFotoPersonal($rut), $html);
    $html             = str_replace("{ID_MALLA_ENCODEADO}", Encodear3($id_malla), $html);
    //Dado la malla, traigo los cursos
    $cursos_por_malla = ObtenerCursosDadoMalla2($id_malla);
    $options_cursos   = "";
    foreach ($cursos_por_malla as $curso) {
        $options_cursos .= "<option value='" . $curso->id . "'>" . $curso->nombre . "</option>";
    }
    $html                = str_replace("{OPTIONS}", ($options_cursos), $html);
    $html                = str_replace("{ID_MALLA_ENCODEADA}", Encodear3($id_malla), $html);
    //Aca traigo los ultimos 3 comentarios con m?s me gusta
    $ultimos_comentarios = ComentariosPorMallaEmpresa($id_malla, $id_empresa, $limit_total);
    $html_comentarios    = "";
    foreach ($ultimos_comentarios as $comen) {
        $html_comentarios .= file_get_contents("views/cursos/objetos/foro_cat/row_reciente.html");
        $html_comentarios = str_replace("{NOMBRE_COMPLETO}", $comen->nombre_completo, $html_comentarios);
        $html_comentarios = str_replace("{COMENTARIO}", $comen->comentario, $html_comentarios);
        $html_comentarios = str_replace("{CATEGORIA}", $comen->valor_categoria, $html_comentarios);
        $html_comentarios = str_replace("{URL_PERSONA}", VerificaFotoPersonal($comen->rut), $html_comentarios);
        $html_comentarios = str_replace("{TIEMPO}", ($comen->fecha), $html_comentarios);
        $tiene_megusta    = MegustaPorComentarioRut($comen->id, $rut);
        if ($comean->rut == $rut) {
            $html_comentarios = str_replace("{BLOQUE_MEGUSTA}", file_get_contents("views/cursos/objetos/foro_cat/bloque_comentario_micomentario.html"), $html_comentarios);
        } else {
            if ($tiene_megusta) {
                $html_comentarios = str_replace("{BLOQUE_MEGUSTA}", file_get_contents("views/cursos/objetos/foro_cat/bloque_comentario_yamegusta.html"), $html_comentarios);
            } else {
                $html_comentarios = str_replace("{BLOQUE_MEGUSTA}", file_get_contents("views/cursos/objetos/foro_cat/bloque_comentario_megusta.html"), $html_comentarios);
            }
        }
        $html_comentarios               = str_replace("{ID_COMENTARIO_MEGUSTA}", ($comen->id), $html_comentarios);
        $cantidad_megusta_porcomentario = MegustaPorComentario($comen->id);
        $html_comentarios               = str_replace("{XMEGUSTA}", count($cantidad_megusta_porcomentario), $html_comentarios);
    }
    $ultimos_comentarios_ingresados = ComentariosPorMallaEmpresaLimit($id_malla, $id_empresa, $limit_total);
    foreach ($ultimos_comentarios_ingresados as $comen) {
        $html_comentarios_ultimos .= file_get_contents("views/cursos/objetos/foro_cat/row_reciente.html");
        $html_comentarios_ultimos = str_replace("{NOMBRE_COMPLETO}", $comen->nombre_completo, $html_comentarios_ultimos);
        $html_comentarios_ultimos = str_replace("{COMENTARIO}", $comen->comentario, $html_comentarios_ultimos);
        $html_comentarios_ultimos = str_replace("{CATEGORIA}", $comen->valor_categoria, $html_comentarios_ultimos);
        $html_comentarios_ultimos = str_replace("{URL_PERSONA}", VerificaFotoPersonal($comen->rut), $html_comentarios_ultimos);
        $html_comentarios_ultimos = str_replace("{TIEMPO}", ($comen->fecha), $html_comentarios_ultimos);
        $tiene_megusta            = MegustaPorComentarioRut($comen->id, $rut);
        if ($comean->rut == $rut) {
            $html_comentarios_ultimos = str_replace("{BLOQUE_MEGUSTA}", file_get_contents("views/cursos/objetos/foro_cat/bloque_comentario_micomentario.html"), $html_comentarios_ultimos);
        } else {
            if ($tiene_megusta) {
                $html_comentarios_ultimos = str_replace("{BLOQUE_MEGUSTA}", file_get_contents("views/cursos/objetos/foro_cat/bloque_comentario_yamegusta.html"), $html_comentarios_ultimos);
            } else {
                $html_comentarios_ultimos = str_replace("{BLOQUE_MEGUSTA}", file_get_contents("views/cursos/objetos/foro_cat/bloque_comentario_megusta.html"), $html_comentarios_ultimos);
            }
        }
        $html_comentarios_ultimos       = str_replace("{ID_COMENTARIO_MEGUSTA}", ($comen->id), $html_comentarios_ultimos);
        $cantidad_megusta_porcomentario = MegustaPorComentario($comen->id);
        $html_comentarios_ultimos       = str_replace("{XMEGUSTA}", count($cantidad_megusta_porcomentario), $html_comentarios_ultimos);
    }
    $html      = str_replace("{LISTADO_COMENTARIOS}", ($html_comentarios), $html);
    $html      = str_replace("{LISTADO_COMENTARIOS_RECIENTES}", ($html_comentarios_ultimos), $html);
    $PRINCIPAL = str_replace("{BLOQUE_COMPARTE}", $html, $PRINCIPAL);
    return ($PRINCIPAL);
}
function ColocaRankingTopHomeInicial($PRINCIPAL, $id_empresa, $id_malla)
{
    $limit            = 10;
    //Por default ejecuta en base a avance de la malla
    $listado_usuarios = ObtenerRankigPorAvanceMallaempresa($limit, $id_empresa, $id_malla);
    $i                = 1;
    foreach ($listado_usuarios as $unico) {
        $listado .= file_get_contents("views/cursos/capacitacion/" . $id_empresa . "_row_ranking_individual_home.html");
        $listado = str_replace("{NOMBRE_COMPLETO}", $unico->nombre_completo, $listado);
        $listado = str_replace("{CARGO}", $unico->cargo, $listado);
        $listado = str_replace("{URL_PERSONA}", ColocaImagenVerificaAvatar($unico->rut), $listado);
        $listado = str_replace("{RANK}", $i, $listado);
        $listado = str_replace("{VALOR}", FormatearPorcentajes($unico->valor), $listado);
        $listado = str_replace("{medallas}", ($unico->cuentamedallas), $listado);
        $listado = str_replace("{PUNTOS_CONSOLIDADOS}", ($unico->cuentapuntos), $listado);
        $i++;
    }
    $PRINCIPAL = str_replace("{ROW_LISTADO_RANKING_Individual}", $listado, $PRINCIPAL);
    $PRINCIPAL = str_replace("{ROW_LISTADO_RANKING_HOME}", $listado, $PRINCIPAL);
    return ($PRINCIPAL);
}
function ColocaRankingTopHomeInicialIndividual($PRINCIPAL, $id_empresa, $id_malla)
{
    $limit            = 10;
    //Por default ejecuta en base a avance de la malla
    $listado_usuarios = ObtenerRankigPorAvanceMallaempresaIndividual($limit, $id_empresa, $id_malla);
    $i                = 1;
    foreach ($listado_usuarios as $unico) {
        $listado .= file_get_contents("views/cursos/capacitacion/" . $id_empresa . "_row_ranking_individual_home.html");
        $listado = str_replace("{NOMBRE_COMPLETO}", $unico->nombre_completo, $listado);
        $listado = str_replace("{CARGO}", $unico->cargo, $listado);
        $listado = str_replace("{URL_PERSONA}", ColocaImagenVerificaAvatar($unico->rut), $listado);
        $listado = str_replace("{RANK}", $i, $listado);
        $listado = str_replace("{VALOR}", ($unico->puntos), $listado);
        $i++;
    }
    $PRINCIPAL = str_replace("{ROW_LISTADO_RANKING_Individual}", $listado, $PRINCIPAL);
    return ($PRINCIPAL);
}
function PuntosPersonalesHomeBciRev($id_empresa, $id_malla, $rut, $PRINCIPAL)
{
    $limit            = 10;
    //Por default ejecuta en base a avance de la malla
    $listado_usuarios = PuntosPersonalesHomeBciRev_data($id_empresa, $id_malla, $rut);
    $i                = 1;
    //print_r($listado_usuarios);
    foreach ($listado_usuarios as $unico) {
        $listado .= file_get_contents("views/cursos/capacitacion/" . $id_empresa . "_row_ranking_individual_home.html");
        $listado = str_replace("{NOMBRE_COMPLETO}", $unico->nombre_completo, $listado);
        $listado = str_replace("{CARGO}", $unico->cargo, $listado);
        $listado = str_replace("{URL_PERSONA}", ColocaImagenVerificaAvatar($unico->rut), $listado);
        $listado = str_replace("{RANK}", $i, $listado);
        $listado = str_replace("{VALOR}", FormatearPorcentajes($unico->valor), $listado);
        $i++;
    }
    $PRINCIPAL = str_replace("{REV_MUESTRA_PUNTOS_TOTALES}", $listado, $PRINCIPAL);
    return (FormatearPorcentajes($unico->valor));
}
function ColocarBLOQUEDATOSUsuarios2($total, $id_empresa, $rut)
{
    $total                   = str_replace("{BLOQUE_DATOS_PERSONALES}", file_get_contents("views/cursos/capacitacion/" . $id_empresa . "_mi_perfil_bloque_datos.html"), $total);
    $total                   = str_replace("{RANK}", $i, $total);
    $total                   = str_replace("{NOMBRE_COMPLETO}", $usu->nombre_completo, $total);
    $total                   = str_replace("{CARGO}", $usu->cargo, $total);
    $total                   = str_replace("{PUNTOS_CONSOLIDADOS}", $usu->puntosconsolidados, $total);
    $total                   = str_replace("{medallas}", $usu->medallas, $total);
    $total                   = str_replace("{URL_PERSONA}", ColocaImagenVerificaAvatar($usu->rut), $total);
    $total                   = str_replace("{RUT_ENCODEADO}", Encodear3($usu->rut), $total);
    $total                   = str_replace("{RUT}", ($usu->rut), $total);
    $total_imagenes_medallas = ColocaImagenesMedallas($usu->medallas, $imagen_medalla);
    $total                   = str_replace("{IMAGENMEDALLAS}", $total_imagenes_medallas, $total);
    $total                   = str_replace("{CAMPO1}", ($usu->campo1), $total);
    $total                   = str_replace("{CAMPO2}", ($usu->campo2), $total);
    $total                   = str_replace("{CAMPO3}", ($usu->campo3), $total);
    $total                   = str_replace("{NOMBRE_COMPLETO}", "hol", $total);
    return ($total);
}
function Lms_Muestra_Objetos_Comunidades($PRINCIPAL, $id_malla, $id_empresa)
{
    $Lms_Trae_Comunidades = Lms_Trae_Comunidades_Objeto_Malla_empresa($id_malla, $id_empresa);
    //print_r($Lms_Trae_Comunidades);
    if ($Lms_Trae_Comunidades) {
        foreach ($Lms_Trae_Comunidades as $Lms_Trae_Comunidad) {
            //print_r($Lms_Trae_Comunidad);
            $PRINCIPAL = ComunidadObjeto($PRINCIPAL, $Lms_Trae_Comunidad->template, $Lms_Trae_Comunidad->id_objeto, $Lms_Trae_Comunidad->numerorows, $Lms_Trae_Comunidad->orden, $Lms_Trae_Comunidad->lectura, $Lms_Trae_Comunidad->volver, $Lms_Trae_Comunidad->sinboton, $Lms_Trae_Comunidad->textoboton);
        }
    } else {
        echo "No hay objetos cargados en las comunidades";
    }
    return $PRINCIPAL;
}
function ColocaBloqueCompromisosMasVotados($PRINCIPAL, $id_objeto)
{
    //obtengo comentarios dado id_objeto
    $total_compromisos = ObtenerCompromisosDadoIdObjeto($id_objeto);
    if ($total_compromisos) {
        foreach ($total_compromisos as $comp) {
            $row_html .= file_get_contents("views/cursos/objetos/compromisos/row_reciente.html");
            $row_html = str_replace("{NOMBRE_COMPLETO}", $comp->nombre_completo, $row_html);
            $row_html = str_replace("{COMPROMISO}", $comp->compromiso, $row_html);
            $row_html = str_replace("{PA1}", $comp->pa1, $row_html);
            $row_html = str_replace("{PC1}", $comp->pc1, $row_html);
            $row_html = str_replace("{PA2}", $comp->pa2, $row_html);
            $row_html = str_replace("{PC2}", $comp->pc2, $row_html);
            $row_html = str_replace("{PA3}", $comp->pa3, $row_html);
            $row_html = str_replace("{PC3}", $comp->pc3, $row_html);
            $row_html = str_replace("{TIEMPO}", FechaTipoSpa($comp->fecha . " " . $comp->hora), $row_html);
            $row_html = str_replace("{CANTIDAD_MEGUSTA}", $comp->total_megusta, $row_html);
            $row_html = str_replace("{URL_PERSONA}", VerificaFotoPersonal($comp->rut), $row_html);
        }
        $PRINCIPAL = str_replace("{BLOQUE_COMPROMISOS_MAS_VOTADOS}", ($row_html), $PRINCIPAL);
    } else {
        $PRINCIPAL = str_replace("{BLOQUE_COMPROMISOS_MAS_VOTADOS}", "", $PRINCIPAL);
    }
    return ($PRINCIPAL);
}
function ColocaCompromisosPorObjeto($id_objeto, $rut)
{
    //Veo si hay documentos por Objeto
    $compromisos        = CompromisosPorObjetosDatos($id_objeto);
    $bloque_compromisos = "";
    if ($compromisos) {
        $total = "";
        foreach ($compromisos as $unico) {
            $bloque_compromisos = file_get_contents("views/cursos/objetos/compromisos/bloque_compromiso.html");
            $bloque_compromisos = str_replace("{URL_IMAGEN_PERSONA}", VerificaFotoPersonal($unico->rut), $bloque_compromisos);
            $bloque_compromisos = str_replace("{NOMBRE}", ($unico->nombre_completo), $bloque_compromisos);
            $bloque_compromisos = str_replace("{COMPROMISO}", ($unico->compromiso), $bloque_compromisos);
            $bloque_compromisos = str_replace("{PA1}", ($unico->pa1), $bloque_compromisos);
            $bloque_compromisos = str_replace("{PC1}", ($unico->pc1), $bloque_compromisos);
            $bloque_compromisos = str_replace("{PA2}", ($unico->pa1), $bloque_compromisos);
            $bloque_compromisos = str_replace("{PC2}", ($unico->pc1), $bloque_compromisos);
            $bloque_compromisos = str_replace("{PA3}", ($unico->pa1), $bloque_compromisos);
            $bloque_compromisos = str_replace("{PC3}", ($unico->pc1), $bloque_compromisos);
            $bloque_compromisos = str_replace("{META}", ($unico->meta), $bloque_compromisos);
            $bloque_compromisos = str_replace("{PLAN}", ($unico->plan), $bloque_compromisos);
            $bloque_compromisos = str_replace("{RUT_ENCODEADO_AUTOR_COMENTARIO}", Encodear3($unico->rut), $bloque_compromisos);
            $bloque_compromisos = str_replace("{FECHA}", FechaTipoSpa($unico->fecha . " " . $unico->hora), $bloque_compromisos);
            $tiene_megusta      = MegustaPorCompromisoRut($unico->id, $rut);
            /* if($unico->rut==$rut){
            $bloque_compromisos = str_replace("{BLOQUE_MEGUSTA}",file_get_contents("views/cursos/objetos/compromisos/bloque_micompromiso.html"),$bloque_compromisos);
            }else{
            if($tiene_megusta){
            $bloque_compromisos = str_replace("{BLOQUE_MEsGUSTA}",file_get_contents("views/cursos/objetos/compromisos/bloque_yamegusta.html"),$bloque_compromisos);
            }else{
            $bloque_compromisos = str_replace("{BLOQUE_MEGUdSTA}",file_get_contents("views/cursos/objetos/compromisos/bloque_megusta.html"),$bloque_compromisos);
            }
            }
            * */
            if ($tiene_megusta) {
                $bloque_compromisos = str_replace("{BLOQUE_MEGUSTA}", file_get_contents("views/cursos/objetos/compromisos/bloque_yamegusta.html"), $bloque_compromisos);
            } else {
                $bloque_compromisos = str_replace("{BLOQUE_MEGUSTA}", file_get_contents("views/cursos/objetos/compromisos/bloque_megusta.html"), $bloque_compromisos);
            }
            $bloque_compromisos             = str_replace("{ID_COMPROMISO}", $unico->id, $bloque_compromisos);
            $bloque_compromisos             = str_replace("{ID_COMPROMISO_MEGUSTA}", $unico->id, $bloque_compromisos);
            //Verifico si este comentario ya tiene un me gusta, si ya tiene, le muestro un bloque de me gusta,
            //sino el bloque de Yamegusta
            //Veo cuantos ME GUSTA tiene este comentario
            $cantidad_megusta_porcompromiso = MegustaPorCompromiso($unico->id);
            $bloque_compromisos             = str_replace("{XMEGUSTA}", count($cantidad_megusta_porcompromiso), $bloque_compromisos);
            $total .= $bloque_compromisos;
        }
    } else {
    }
    return (($total));
}
function MuestraInformeEnc($PRINCIPAL, $id_encuesta, $id_empresa, $id_objeto, $id_curso)
{
    //dada la id de la encuestra, traigo las dimesiones
    $dimensiones_por_encuesta = ENC_TraigoDimensionesPorEncuesta($id_empresa, $id_encuesta);
    $html .= file_get_contents("views/encuesta/" . $id_empresa . "_template_enc_informe.html");
    foreach ($dimensiones_por_encuesta as $dimen) {
        $row .= file_get_contents("views/encuesta/" . $id_empresa . "_row_dimension_informe.html");
        $row                     = str_replace("{GRAFICO}", file_get_contents("views/encuesta/" . $id_empresa . "_barra1.html"), $row);
        $row                     = str_replace("{CODIGO_GRAFICO}", ($dimen->iddimension), $row);
        $row                     = str_replace("{NOMBRE_DIMENSION}", ($dimen->dimension), $row);
        //Por cada dimension traigo las preguntas
        $preguntas_por_dimension = ENC_TraigoPreguntaDadaDimenion($dimen->iddimension);
        $acumulador_notas        = 0;
        $acumulador_rojo         = 0;
        $acumulador_amarillo     = 0;
        $acamulador_verde        = 0;
        $acumulador_cuenta       = 0;
        $acumulador_1            = 0;
        $acumulador_2            = 0;
        $acumulador_3            = 0;
        $acumulador_4            = 0;
        $acumulador_5            = 0;
        $acumulador_6            = 0;
        $acumulador_7            = 0;
        $acumulador_T            = 0;
        //echo $dimen->dimension."<br>";
        foreach ($preguntas_por_dimension as $preg) {
            $promedio_por_preg = ENC_CuentaDeRespuestasPorPregunta7op($id_empresa, $id_encuesta, $preg->idpregunta, $id_objeto);
            //echo "<pre>";
            //print_r($promedio_por_preg);
            $acumulador_notas  = $acumulador_notas + $promedio_por_preg[0]->promedio_pregunta;
            ++$numpreg;
            $acumulador_1 = $promedio_por_preg[0]->cuenta1 + $acumulador_1;
            $acumulador_2 = $promedio_por_preg[0]->cuenta2 + $acumulador_2;
            $acumulador_3 = $promedio_por_preg[0]->cuenta3 + $acumulador_3;
            $acumulador_4 = $promedio_por_preg[0]->cuenta4 + $acumulador_4;
            $acumulador_5 = $promedio_por_preg[0]->cuenta5 + $acumulador_5;
            $acumulador_6 = $promedio_por_preg[0]->cuenta6 + $acumulador_6;
            $acumulador_7 = $promedio_por_preg[0]->cuenta7 + $acumulador_7;
            $acumulador_T = $promedio_por_preg[0]->cuentatodas + $acumulador_T;
        }
        //echo "$acumulador_1 $acumulador_2 $acumulador_3 $acumulador_4 $acumulador_5 $acumulador_6 $acumulador_7 <br>";
        $promedio_1 = round(100 * $acumulador_1 / $acumulador_T, 1);
        $promedio_2 = round(100 * $acumulador_2 / $acumulador_T, 1);
        $promedio_3 = round(100 * $acumulador_3 / $acumulador_T, 1);
        $promedio_4 = round(100 * $acumulador_4 / $acumulador_T, 1);
        $promedio_5 = round(100 * $acumulador_5 / $acumulador_T, 1);
        $promedio_6 = round(100 * $acumulador_6 / $acumulador_T, 1);
        $promedio_7 = round(100 * $acumulador_7 / $acumulador_T, 1);
        $row        = str_replace("{VALUE1}", round($promedio_1, 0), $row);
        $row        = str_replace("{VALUE2}", round($promedio_2, 0), $row);
        $row        = str_replace("{VALUE3}", round($promedio_3, 0), $row);
        $row        = str_replace("{VALUE4}", round($promedio_4, 0), $row);
        $row        = str_replace("{VALUE5}", round($promedio_5, 0), $row);
        $row        = str_replace("{VALUE6}", round($promedio_6, 0), $row);
        $row        = str_replace("{VALUE7}", round($promedio_7, 0), $row);
    }
    $html = str_replace("{LISTADO_DIMENSIONES}", ($row), $html);
    //$comentarios=ComentariosFinalesEncSatis($id_objeto, $id_empresa);
    foreach ($comentarios as $comentario) {
        $row_comentario .= file_get_contents("views/encuesta/" . $id_empresa . "_row_comentario_informe.html");
        $row_comentario = str_replace("{COMENTARIO}", ($comentario->comentario), $row_comentario);
    }
    $html      = str_replace("{LISTADO_COMENTARIOS}", ($row_comentario), $html);
    $PRINCIPAL = str_replace("{BLOQUE_ENCUESTA}", ($html), $PRINCIPAL);
    return ($PRINCIPAL);
}
function TransformaEscalaBase100($promedio_por_dimension, $max, $min)
{
    $resto = $max - $min;
    $saldo = round(100 / $resto);
    $valor = round(($promedio_por_dimension - 1) * $saldo);
    return $valor;
}
function FinalizaObjetoFullDatos($rut, $id_objeto, $id_empresa, $nota_sugerida)
{
    //echo "<br> -  $rut, $id_objeto, $id_empresa <br>";
    $datos_objeto = DatosObjeto($id_objeto);
    //$id_curso     = $_SESSION["id_curso"];
        $id_curso = $datos_objeto[0]->id_curso;
   //print_r($datos_objeto); sleep(5);
    if (!$id_curso) {
        $id_curso = $datos_objeto[0]->id_curso;
    }
    //IngresoObjetoFinalizado($rut, $id_objeto, "", "", "", $datos_objeto[0]->id_curso);
    IngresoObjetoFinalizado($rut, $id_objeto, "", $nota_sugerida, "", $id_curso);
    //VerificaFinalizaCurso($datos_objeto[0]->id_curso, $rut);
    VerificaFinalizaCurso($id_curso, $rut);
    //$datos_siguiente_objeto=DatosObjetoDadoRutCursoyOrden($datos_objeto[0]->id_curso, $datos_objeto[0]->orden+1);
    $datos_siguiente_objeto = DatosObjetoDadoRutCursoyOrden($id_curso, $datos_objeto[0]->orden + 1);
    $id_objeto_siguiente    = $datos_siguiente_objeto[0]->id;
    //$tiene_cierre_curso=TieneInscripcionCierreDadoRutYCursoEmpresa($rut, $datos_objeto[0]->id_curso, $id_empresa);
    $tiene_cierre_curso     = TieneInscripcionCierreDadoRutYCursoEmpresa($rut, $id_curso, $id_empresa);
    if (!$tiene_cierre_curso) {
        InsertarInsripcionCierre($rut, $id_curso, $id_empresa);
    }
    //ActualizoEstadoInscripcionCierre($datos_objeto[0]->id_curso, $rut, $id_empresa);
    ActualizoEstadoInscripcionCierre($id_curso, $rut, $id_empresa);
    $tips = LeoTipsGanados($id_objeto, $id_empresa);
    ActualizoTipsGanados($id_objeto, $tips[0]->id_tip, $rut, $id_empresa);
    //$tiene_puntos=GAMIFICACIONTienePuntosPorCursoObjetoRutEmpresa($rut, $id_objeto, $datos_objeto[0]->id_curso, $id_empresa);
    $tiene_puntos = GAMIFICACIONTienePuntosPorCursoObjetoRutEmpresa($rut, $id_objeto, $id_curso, $id_empresa);
    //$tiene_puntos=GAMIFICACIONTienePuntosPorCursoObjetoRutEmpresa($rut, $id_objeto, $datos_objeto[0]->id_curso, $id_empresa);
    $tiene_puntos = GAMIFICACIONTienePuntosPorCursoObjetoRutEmpresa($rut, $id_objeto, $id_curso, $id_empresa);
    if (!$tiene_puntos) {
        //GAMIFICACIONInsertaPuntosPorObjeto($rut, $id_objeto, $datos_objeto[0]->id_curso, $id_empresa, $datos_objeto[0]->puntos);
        GAMIFICACIONInsertaPuntosPorObjeto($rut, $id_objeto, $id_curso, $id_empresa, $datos_objeto[0]->puntos);
        $tiene_puntos_acumulados = GAMIFICACIONTienePuntosAcumuladosPorRutEmpresa($rut, $id_empresa);
        if ($tiene_puntos_acumulados) {
            $suma_puntos = $tiene_puntos_acumulados[0]->puntos + $datos_objeto[0]->puntos;
            GAMIFICACIONActualizarDatosConsolidados($rut, $id_empresa, $datos_objeto[0]->puntos, $tiene_puntos_acumulados[0]->nivel);
        } else {
            GAMIFICACIONInsertaPuntosAcumulados($rut, $id_empresa, $datos_objeto[0]->puntos);
        }
    } else {
        $tiene_consolidado_puntos = GAMIFICACIONTienePuntosAcumuladosPorRutEmpresa($rut, $id_empresa);
        if ($tiene_consolidado_puntos) {
            $puntos_para_consolidado = $tiene_consolidado_puntos[0]->puntos;
            GAMIFICACIONActualizarDatosConsolidados($rut, $id_empresa, $puntos_para_consolidado + $datos_objeto[0]->puntos, $tiene_consolidado_puntos[0]->nivel, $medallas);
        } else {
            GAMIFICACIONInsertaPuntosAcumulados($rut, $id_empresa, $puntos_para_consolidado, $tiene_consolidado_puntos[0]->nivel, $medallas);
        }
    }
    if (!$id_objeto_siguiente) {
        $datos_malla = CAPACITACION_malla_porUsuario($rut);
        GAMIFICACION_ActualizaNivelVersion2($datos_malla[0]->id_malla, $id_empresa, $rut);
    }
}
function ColocaListadoParticipantesPorcurso($PRINCIPAL, $id_curso, $id_empresa)
{
    //$listadp_participantes=ListadoParticipantesDadoCursiEmpresa($id_curso, $id_empresa);
    $listadp_participantes = ListadoParticipantesDadoCursiEmpresaSinRelator($id_curso, $id_empresa);
    $datos_usuario         = UsuarioEnBasePersonas($_SESSION["user_"]);
    $PRINCIPAL             = str_replace("{NOMBRE_USUARIO}", ($datos_usuario[0]->nombre_completo), $PRINCIPAL);
    foreach ($listadp_participantes as $unico) {
        $row .= file_get_contents("views/cursos/objetos/check/row_listado_participantes.html");
        $row = str_replace("{NOMBRE}", $unico->nombre_completo, $row);
        $row = str_replace("{CARGO}", $unico->cargo, $row);
        $row = str_replace("{URL_MIPERFIL}", VerificaFotoPersonal($unico->rut), $row);
    }
    $PRINCIPAL = str_replace("{LISTADO_USUARIOS}", ($row), $PRINCIPAL);
    $PRINCIPAL = str_replace("{CODIGO_CURSO_ENCODEADO}", Encodear3($id_curso), $PRINCIPAL);
    return ($PRINCIPAL);
}
function ColocaListadoParticipantesPorinscripcion($PRINCIPAL, $id_inscripcion, $id_empresa)
{
    //$listadp_participantes=ListadoParticipantesDadoCursiEmpresa($id_curso, $id_empresa);
    //$listadp_participantes=ListadoParticipantesDadoCursiEmpresaSinRelator($id_curso, $id_empresa);
    //echo "<br>$id_inscripcion, $id_empresa";
    $listadp_participantes = ListadoParticipantesDadoInscripcionEmpresaSinRelator($id_inscripcion, $id_empresa);
    $datos_usuario         = UsuarioEnBasePersonas($_SESSION["user_"]);
    $PRINCIPAL             = str_replace("{NOMBRE_USUARIO}", ($datos_usuario[0]->nombre_completo), $PRINCIPAL);
    foreach ($listadp_participantes as $unico) {
        $row .= file_get_contents("views/cursos/objetos/check/row_listado_participantes.html");
        $row = str_replace("{NOMBRE}", $unico->nombre_completo, $row);
        $row = str_replace("{CARGO}", $unico->cargo, $row);
        $row = str_replace("{URL_MIPERFIL}", VerificaFotoPersonal($unico->rut), $row);
    }
    $PRINCIPAL = str_replace("{LISTADO_USUARIOS}", ($row), $PRINCIPAL);
    $PRINCIPAL = str_replace("{CODIGO_CURSO_ENCODEADO}", Encodear3($id_curso), $PRINCIPAL);
    return ($PRINCIPAL);
}
function ColocaObjetosDadoCurso($PRINCIPAL, $id_curso, $id_empresa, $rut)
{
    //dado el curso, traigo los objetos
    //echo $id_empresa;
    //$objetos=TraeObjetosDadoCursoCheck($id_curso, $id_empresa);
    $objetos          = ObjetosDadoCurso($id_curso, $rut);
    //verifico los datos para este usuario y para este curso
    $usuario_en_curso = CI_verificausuariocurso($rut, $id_curso, $id_empresa);
    foreach ($objetos as $ob) {
        $row .= file_get_contents("views/checkin/CI_row_entorno_home_actividades.html");
        if ($usuario_en_curso[0]->relator == 1) {
            $row = str_replace("{NOMBRE}", $ob->titulo_relator, $row);
        } else {
            $row = str_replace("{NOMBRE}", $ob->titulo, $row);
        }
        $row = str_replace("{IMAGEN}", $ob->imagen, $row);
        if ($ob->extension_objeto == 11) {
            $total_archivos = TodasFotosPorObjetoEmpresa($ob->id, $id_empresa);
            $row            = str_replace("{PARTICIPANTES}", count($total_archivos), $row);
        } else if ($ob->id_encuesta) {
            //veo el total de finalizados dado el id de la encuesta
            $total_finalizados_encuesta = VerificoEncuestaFinalizadaCheckin($ob->id_encuesta, $ob->id, $id_empresa);
            $row                        = str_replace("{PARTICIPANTES}", count($total_finalizados_encuesta), $row);
        } else if ($ob->extension_objeto == 9) {
            //veo el total de finalizados dado el id de la encuesta
            $total_comentarios = TotalComentariosDadoIdObjetoEmpresa($ob->id);
            $row               = str_replace("{PARTICIPANTES}", count($total_comentarios), $row);
        } else if ($ob->extension_objeto == 18) {
            //veo el total de finalizados dado el id de la encuesta
            $total_preguntas = TotalPreguntasDadoIdObjetoEmpresa($ob->id);
            $row             = str_replace("{PARTICIPANTES}", $total_preguntas[0]->cuenta, $row);
        } else if ($ob->tipo_de_objeto == 8) {
            //veo el total de finalizados dado el id de la encuesta
            $total_participantes = ListadoParticipantesDadoCursiEmpresaSinRelator($ob->id_curso, $id_empresa);
            $row                 = str_replace("{PARTICIPANTES}", count($total_participantes), $row);
        } else if ($ob->tipo_de_objeto == 10) {
            //veo el total de finalizados dado el id de la encuesta
            $total_mensajes = TotalMensajerPorObjetoMensajeria($ob->id);
            $row            = str_replace("{PARTICIPANTES}", count($total_mensajes), $row);
        } else {
            $row = str_replace("{PARTICIPANTES}", "-", $row);
        }
        if ($ob->id_evaluacion) {
            if ($usuario_en_curso[0]->relator == 1) {
                $row = str_replace("{AMBIENTE}", $ob->ambiente, $row);
            } else {
                $row = str_replace("{AMBIENTE}", "intro_eval", $row);
            }
        } else {
            $row = str_replace("{AMBIENTE}", $ob->ambiente, $row);
        }
        $row = str_replace("{ID_OBJETO_ENCODEADO}", Encodear3($ob->id), $row);
        $row = str_replace("{ID_CURSO_ENCODEADO}", Encodear3($id_curso), $row);
        $row = str_replace("{ID_ENCUESTA_ENCODEADO}", Encodear3($ob->id_encuesta), $row);
    }
    $PRINCIPAL = str_replace("{LISTADO_OBJETOS_CHECKIN}", ($row), $PRINCIPAL);
    return ($PRINCIPAL);
}
function ColocaObjetosDadoImparticion($PRINCIPAL, $id_inscripcion, $id_empresa, $rut)
{
    //echo "$id_inscripcion";
    //dado el curso, traigo los objetos
    //echo $id_empresa;
    //$objetos=TraeObjetosDadoCursoCheck($id_curso, $id_empresa);
    $objetos          = ObjetosDadoInscripcion($id_inscripcion, $rut);
    //verifico los datos para este usuario y para este curso
    $usuario_en_curso = CI_verificausuariocurso($rut, $id_inscripcion, $id_empresa);
    //print_r($usuario_en_curso);
    foreach ($objetos as $ob) {
        $row .= file_get_contents("views/checkin/CI_row_entorno_home_actividades.html");
        if ($usuario_en_curso[0]->relator == 1) {
            $row = str_replace("{NOMBRE}", $ob->titulo_relator, $row);
        } else {
            $row = str_replace("{NOMBRE}", $ob->titulo, $row);
        }
        $row = str_replace("{IMAGEN}", $ob->imagen, $row);
        if ($ob->extension_objeto == 11) {
            $total_archivos = TodasFotosPorObjetoEmpresa($ob->id, $id_empresa);
            $row            = str_replace("{PARTICIPANTES}", count($total_archivos), $row);
        } else if ($ob->id_encuesta) {
            //veo el total de finalizados dado el id de la encuesta
            $total_finalizados_encuesta = VerificoEncuestaFinalizadaCheckin($ob->id_encuesta, $ob->id, $id_empresa);
            $row                        = str_replace("{PARTICIPANTES}", count($total_finalizados_encuesta), $row);
        } else if ($ob->extension_objeto == 9) {
            //veo el total de finalizados dado el id de la encuesta
            $total_comentarios = TotalComentariosDadoIdObjetoEmpresa($ob->id);
            $row               = str_replace("{PARTICIPANTES}", count($total_comentarios), $row);
        } else if ($ob->extension_objeto == 18) {
            //veo el total de finalizados dado el id de la encuesta
            $total_preguntas = TotalPreguntasDadoIdObjetoEmpresa($ob->id);
            $row             = str_replace("{PARTICIPANTES}", $total_preguntas[0]->cuenta, $row);
        } else if ($ob->tipo_de_objeto == 8) {
            //veo el total de finalizados dado el id de la encuesta
            $total_participantes = ListadoParticipantesDadoInscripcionEmpresaSinRelator($ob->id_curso, $id_empresa);
            $row                 = str_replace("{PARTICIPANTES}", count($total_participantes), $row);
        } else if ($ob->tipo_de_objeto == 10) {
            //veo el total de finalizados dado el id de la encuesta
            $total_mensajes = TotalMensajerPorObjetoMensajeria($ob->id);
            $row            = str_replace("{PARTICIPANTES}", count($total_mensajes), $row);
        } else {
            $row = str_replace("{PARTICIPANTES}", "-", $row);
        }
        if ($ob->id_evaluacion) {
            if ($usuario_en_curso[0]->relator == 1) {
                //    echo "hola1";exit();
                $row = str_replace("{AMBIENTE}", $ob->ambiente, $row);
            } else {
                $row = str_replace("{AMBIENTE}", "intro_eval", $row);
                //    echo "hola2";exit();
            }
        } else {
            //echo "hola3";exit();
            $row = str_replace("{AMBIENTE}", $ob->ambiente, $row);
        }
        $row = str_replace("{ID_OBJETO_ENCODEADO}", Encodear3($ob->id), $row);
        $row = str_replace("{ID_CURSO_ENCODEADO}", Encodear3($id_curso), $row);
        $row = str_replace("{ID_ENCUESTA_ENCODEADO}", Encodear3($ob->id_encuesta), $row);
        $row = str_replace("{CODIGO_INSCRIPCION_ENCODEADO}", Encodear3($id_inscripcion), $row);
    }
    $PRINCIPAL = str_replace("{LISTADO_OBJETOS_CHECKIN}", ($row), $PRINCIPAL);
    return ($PRINCIPAL);
}
function ConsultaWebService($rut, $id_objeto, $verifica)
{
    $id_empresa      = $_SESSION["id_empresa"];
    $datos_objeto    = DatosObjeto($id_objeto);
    $datos_usuario   = UsuarioEnBasePersonas($rut);
    $link_webservice = ($datos_objeto[0]->llamada_webservice);
    //$datos_usuario[0]->email="pamela.bizama@bci.cl";
    $link_webservice = str_replace("{CORREO}", $datos_usuario[0]->email, $link_webservice);
    //print_r($link_webservice);
    $JsonSource      = $link_webservice;
    $json            = json_decode(file_get_contents($JsonSource));
    $status          = $json->info->status;
    $resultado       = $json->info->resutl;
    //$status="OK";
    //$status="ERROR";
    if ($verifica == 1) {
        if ($id_objeto == "br_m1c5m5") {
            $status = "OK";
        }
        ;
        if ($id_objeto == "br_m1c5m6") {
            $status = "OK";
        }
        ;
        if ($id_objeto == "br_m2m29") {
            $status = "OK";
        }
        ;
        if ($id_objeto == "br_m2m30") {
            $status = "OK";
        }
        ;
    }
    if ($status == "OK" or $id_objeto == "br_m1c1m3") {
        /*$tiene_punto_objeto=GAMIFICACIONTienePuntosPorCursoObjetoRutEmpresa($rut, $id_objeto, $datos_objeto[0]->id_curso, $_SESSION["id_empresa"]);
        if($tiene_punto_objeto){
        $objeto_finalizado=ObjetoFinalizadoDadoIdYRut($rut ,$id_objeto);
        if(!$objeto_finalizado){
        IngresoObjetoFinalizado($rut, $id_objeto, "", "", "", $datos_objeto[0]->id_curso);
        VerificaFinalizaCurso($datos_objeto[0]->id_curso, $rut);
        CAPACITACIONActualizarDatosCierre($id_curso, $rut, $_SESSION["id_empresa"], "");
        }
        }else{
        if($datos_objeto[0]->gamificado==1){
        IngresoObjetoFinalizado($rut, $id_objeto, $tiempo_navegado, "", "", $datos_objeto[0]->id_curso);
        VerificaFinalizaCurso($datos_objeto[0]->id_curso, $rut);
        }
        }
        */
        FinalizaObjetoFullDatos($rut, $id_objeto, $id_empresa);
        $bloque_finalizado = file_get_contents("views/cursos/objetos/WebService/bloqueRealizado.html");
        $arreglo[0]        = $bloque_finalizado;
    } else {
        if ($verifica == 1) {
            //$bloque_finalizado.=file_get_contents("views/cursos/objetos/WebService/bloqueError.html");
            //Inserto registro en tabla de objetos no finalizados
            InsertaRegistroTblRegistrosNofinalizados($rut, $id_empresa, $id_malla, $datos_objeto[0]->id_curso, $id_objeto);
            $bloque_finalizado .= file_get_contents("views/cursos/objetos/WebService/bloqueNoRealizadoConAlert.html");
            $bloque_finalizado = str_replace("{ID_CURSO_ENCODEADO}", Encodear3($datos_objeto[0]->id_curso), $bloque_finalizado);
        } else {
            $bloque_finalizado .= file_get_contents("views/cursos/objetos/WebService/bloqueNoRealizado.html");
        }
        //$bloque_finalizado = str_replace("{URL}",$link_webservice,$bloque_finalizado);
        $arreglo[0] = $bloque_finalizado;
    }
    return ($arreglo);
}
function ObtenerDatosMoodle($arreglo_datos_curso, $HTML, $bloque, $id_scorm, $rut_usuario)
{
    if ($rut_usuario) {
        $datos_usuario = UsuarioEnBasePersonas($rut_usuario);
    } else {
        $datos_usuario = UsuarioEnBasePersonas($_SESSION["user_"]);
    }
    $userid_moodle = $datos_usuario[0]->userid_moodle;
    $id_curso      = $arreglo_datos_curso->id_curso;
    //$id_scorm=$arreglo_datos_curso->id_scorm;
    $link2         = mysql_connect("gopartners.cl", "gopartne_moodle", "GMknehSNTpSR");
    mysql_select_db("gopartne_moodle26", $link2);
    $sql2                 = "SELECT * FROM mdl_scorm_scoes where scorm='$id_scorm' and scormtype='sco'";
    //echo $sql2;
    $result2              = mysql_query($sql2, $link2);
    //esta correspnde a la cantidad de modulos por ese scorm
    $cantidad_scorm       = mysql_num_rows($result2);
    //echo $cantidad_scorm;echo "<br>";
    //$sql3="select * from mdl_scorm_scoes_track where userid='$userid_moodle' and value>='0' and value <='100' and scormid='$id_scorm'";
    //$sql3="select * from mdl_scorm_scoes_track where userid='$userid_moodle' and value='completed'   and scormid='$id_scorm'";
    $sql3                 = "select * from mdl_scorm_scoes_track where userid='$userid_moodle' and (value='completed' or value='passed' or value='failed')  and scormid='$id_scorm'";
    //echo "<br>";
    //echo $sql3;
    //exit;
    $result3              = mysql_query($sql3, $link2);
    $cantidad_finalizados = mysql_num_rows($result3);
    //echo $cantidad_finalizados;exit;
    //PORCENTAJE DE AVANCE
    $porcentaje_avance    = round(($cantidad_finalizados * 100) / $cantidad_scorm);
    //porcentaje de avance
    $arreglo[0]           = $porcentaje_avance;
    //echo $porcentaje_avance."<br><br>";
    //Ahora obtengo la nota mas alta
    $sql4                 = "select *  from mdl_scorm_scoes_track where userid='$userid_moodle' and element='cmi.core.score.raw' and scormid='$id_scorm' order by value desc limit 1";
    $result4              = mysql_query($sql4, $link2);
    while ($row = mysql_fetch_array($result4)) {
        $nota = $row['value'];
    }
    //devuelvo la nota
    $arreglo[1]      = $nota;
    //devuelvo el total de modulos
    $arreglo[2]      = $cantidad_scorm;
    //devuelvo el total de finalizados
    $arreglo[3]      = $cantidad_finalizados;
    $HTML            = str_replace("{TOTAL_MODULOS}", $arreglo[2], $HTML);
    $HTML            = str_replace("{TOTAL_MODULOS_PENDIENTES}", $arreglo[2] - $arreglo[3], $HTML);
    $HTML            = str_replace("{TOTAL_MODULOS_FINALIZADOS}", $arreglo[3], $HTML);
    $HTML            = str_replace("{NOTA_OBTENIDA}", $arreglo[1], $HTML);
    $arreglo[4]      = $HTML;
    $row_curso_nivel = file_get_contents("views/cursos/capacitacion/" . $_SESSION["id_empresa"] . "_row_bloque_niveles_curso.html");
    $row_curso_nivel = str_replace("{TOTAL_MODULOS_PENDIENTES}", $arreglo[2] - $arreglo[3], $row_curso_nivel);
    $row_curso_nivel = str_replace("{TOTAL_MODULOS_FINALIZADOS}", $arreglo[3], $row_curso_nivel);
    $row_curso_nivel = str_replace("{NOMBRE_CURSO_MOODLE}", ($arreglo_datos_curso->nombre_curso), $row_curso_nivel);
    $arreglo[5]      = $row_curso_nivel;
    return ($arreglo);
}
function MPColocaOtrasPracticas($id_mp, $tipo, $id_empresa, $limit)
{
    //trae el total de interacciones por mp
    $total_practicas_leidas = MPOtrasPracticas($id_mp, $tipo, $id_empresa, $limit);
    //echo "<br>$id_mp, $tipo, $id_empresa, $limit<br>";
    //print_r($total_practicas);
    if ($total_practicas_leidas) {
        foreach ($total_practicas_leidas as $total_practica) {
            $total_practicas .= file_get_contents("views/mejorespracticas/mp_row_otraspracticas.html");
            $total_practicas = str_replace("{NOMBRE_PRACTICA}", $total_practica->nombre, $total_practicas);
            $total_practicas = str_replace("{ID_MP}", $total_practica->id_mp, $total_practicas);
            $total_practicas = str_replace("{FOTO_AUTOR}", VerificaFotoPersonal($total_practica->rut), $total_practicas);
            $datos_usuario   = UsuarioEnBasePersonas($total_practica->rut);
            $total_practicas = str_replace("{NOMBRE_AUTOR}", $datos_usuario[0]->nombre_completo, $total_practicas);
            //$total_practicas = str_replace("{LINK}",VerificaFotoPersonal($total_practica->rut),$total_practicas);
        }
    } else {
        $total_practicas = "No existen pr&aacute;cticas";
    }
    //print_r($total_practicas);
    //$PRINCIPAL = str_replace("{INTERACCIONES}",$listado_interacciones,$PRINCIPAL);
    return (($total_practicas));
}
function MPColocaPreguntasPracticas($id_empresa, $limit)
{
    $total_practicas_leidas = MPPreguntas($id_empresa, $limit);
    //echo "<br>$id_empresa, $limit<br>";
    //print_r($total_practicas);
    if ($total_practicas_leidas) {
        foreach ($total_practicas_leidas as $total_practica) {
            $total_practicas .= file_get_contents("views/mejorespracticas/mp_row_preguntaspracticas.html");
            $total_practicas = str_replace("{NOMBRE_PRACTICA}", $total_practica->pregunta, $total_practicas);
            $total_practicas = str_replace("{ID_MP}", $total_practica->id_mp, $total_practicas);
            $total_practicas = str_replace("{RUT_AUTOR}", $total_practica->autor_pregunta, $total_practicas);
            $total_practicas = str_replace("{FOTO_AUTOR}", VerificaFotoPersonal($total_practica->autor_pregunta), $total_practicas);
            $datos_usuario   = UsuarioEnBasePersonas($total_practica->autor_pregunta);
            $total_practicas = str_replace("{NOMBRE_AUTOR}", $datos_usuario[0]->nombre_completo, $total_practicas);
            //$total_practicas = str_replace("{LINK}",VerificaFotoPersonal($total_practica->rut),$total_practicas);
        }
    } else {
        $total_practicas = "No existen preguntas";
    }
    //$PRINCIPAL = str_replace("{INTERACCIONES}",$listado_interacciones,$PRINCIPAL);
    return (($total_practicas));
}
function MPColocaBloqueInteracciones($id_mp, $id_empresa, $pdf)
{
    //trae el total de interacciones por mp
    $total_interacciones = MPTotalInteraccionesPorMP($id_mp, $id_empresa);
    if ($total_interacciones) {
        foreach ($total_interacciones as $tot) {
            if ($pdf == "pdf") {
                $listado_interacciones .= file_get_contents("views/mejorespracticas/mp_interaccion_ingresada_pdf.html");
            } else {
                $listado_interacciones .= file_get_contents("views/mejorespracticas/mp_interaccion_ingresada.html");
            }
            $listado_interacciones = str_replace("{NOMBRE_COMPLETO}", $tot->nombre_completo, $listado_interacciones);
            $listado_interacciones = str_replace("{COMENTARIO}", $tot->contenido, $listado_interacciones);
            $listado_interacciones = str_replace("{TIEMPO}", formatearFechaCompleta($tot->fecha), $listado_interacciones);
            $listado_interacciones = str_replace("{URL_PERSONA}", VerificaFotoPersonal($tot->rut), $listado_interacciones);
        }
    } else {
        $total_interacciones = "No existen interacciones";
    }
    //$PRINCIPAL = str_replace("{INTERACCIONES}",$listado_interacciones,$PRINCIPAL);
    return (($listado_interacciones));
}
function MPColocaBloqueComentario($id_mp, $id_empresa, $rut)
{
    //echo "$id_mp, $id_empresa, $rut";
    $html          = file_get_contents("views/mejorespracticas/mp_interaccion_comentario.html");
    $html          = str_replace("{FOTO_AUTOR}", VerificaFotoPersonal($rut), $html);
    $datos_usuario = UsuarioEnBasePersonas($rut);
    //print_r($datos_usuario);
    //echo "nombre ".$datos_usuario[0]->nombre_completo;
    $html          = str_replace("{NOMBRE_AUTOR}", $datos_usuario[0]->nombre_completo, $html);
    $html          = str_replace("{ID_MP_ENCODEADO}", Encodear3($id_mp), $html);
    return ($html);
}
function SubirArchivosGenericos($FILES, $extension_doc, $prefijo, $ruta, $numero, $nombre_file)
{
    //echo "$extension_archivo, $prefijo, $ruta";exit;
    //$ruta_con_archivo=$ruta."/".$prefijo."_BK.".$extension_archivo;
    $ruta_con_archivo = $ruta . "/" . $prefijo . "." . $extension_doc;
    copy($FILES[$nombre_file]['tmp_name'], $ruta_con_archivo);
    $nombre_imagen_video = $prefijo . "." . $extension_doc;
    //RedimensionarImagenSlider($ruta_con_archivo, $nombre_imagen_slider);
    //Devuelvol un arreglo, con datos del archivo subido
    $arreglo[0]          = $ruta_con_archivo; //Ruta Completa
    $arreglo[1]          = $prefijo . "." . $extension_doc; //Nombre del Archivo
    $arreglo[2]          = $ruta . "/" . $prefijo; //Ruta del Objeto sin el index
    return ($arreglo);
}
function SubirImagenfondo($FILES, $extension_doc, $prefijo, $ruta, $numero)
{
    //echo "$extension_archivo, $prefijo, $ruta";exit;
    //$ruta_con_archivo=$ruta."/".$prefijo."_BK.".$extension_archivo;
    $ruta_con_archivo = $ruta . "/" . $prefijo . "." . $extension_doc;
    copy($FILES['imagen_fondo']['tmp_name'], $ruta_con_archivo);
    $nombre_imagen_video = $prefijo . "." . $extension_doc;
    //RedimensionarImagenSlider($ruta_con_archivo, $nombre_imagen_slider);
    //Devuelvol un arreglo, con datos del archivo subido
    $arreglo[0]          = $ruta_con_archivo; //Ruta Completa
    $arreglo[1]          = $prefijo . "." . $extension_doc; //Nombre del Archivo
    $arreglo[2]          = $ruta . "/" . $prefijo; //Ruta del Objeto sin el index
    return ($arreglo);
}
function SubirArchivos($FILES, $extension_doc, $prefijo, $ruta, $numero)
{
    //echo "$extension_archivo, $prefijo, $ruta";exit;
    //$ruta_con_archivo=$ruta."/".$prefijo."_BK.".$extension_archivo;
    $ruta_con_archivo = $ruta . "/" . $prefijo . "." . $extension_doc;
    copy($FILES['archivo'.$numero]['tmp_name'], $ruta_con_archivo);
    $nombre_imagen_video = $prefijo . "." . $extension_doc;
    //RedimensionarImagenSlider($ruta_con_archivo, $nombre_imagen_slider);
    //Devuelvol un arreglo, con datos del archivo subido
    $arreglo[0]          = $ruta_con_archivo; //Ruta Completa
    $arreglo[1]          = $prefijo . "." . $extension_doc; //Nombre del Archivo
    $arreglo[2]          = $ruta . "/" . $prefijo; //Ruta del Objeto sin el index
    return ($arreglo);
}
function SubirArchivos2($FILES, $extension_doc, $prefijo, $ruta, $numero)
{
    //echo "$extension_archivo, $prefijo, $ruta";exit;
    //$ruta_con_archivo=$ruta."/".$prefijo."_BK.".$extension_archivo;
    $ruta_con_archivo = $ruta . "/" . $prefijo . "." . $extension_doc;
    copy($FILES['archivo2']['tmp_name'], $ruta_con_archivo);
    $nombre_imagen_video = $prefijo . "." . $extension_doc;
    //RedimensionarImagenSlider($ruta_con_archivo, $nombre_imagen_slider);
    //Devuelvol un arreglo, con datos del archivo subido
    $arreglo[0]          = $ruta_con_archivo; //Ruta Completa
    $arreglo[1]          = $prefijo . "." . $extension_doc; //Nombre del Archivo
    $arreglo[2]          = $ruta . "/" . $prefijo; //Ruta del Objeto sin el index
    return ($arreglo);
}
function EnviarCorreosCial($evaluador, $tipo, $evaluado)
{
    $tipo_correo     = ObtengoTipoCorreo($tipo);
    $datos_evaluador = UsuarioEnBasePersonas($evaluador);
    $datos_evaluado  = UsuarioEnBasePersonas($evaluado);
    $plantilla       = $tipo_correo[0]->texto;
    $plantilla       = str_replace("{NOMBRE_EVALUADOR}", htmlentities($datos_evaluador[0]->nombre_completo), $plantilla);
    $plantilla       = str_replace("{NOMBRE_EVALUADO}", htmlentities($datos_evaluado[0]->nombre_completo), $plantilla);
    //echo $plantilla;
    $mail            = new PHPMailer;
    //Set who the message is to be sent from
    $mail->setFrom($tipo_correo[0]->from_correo, $tipo_correo[0]->from);
    //Set an alternative reply-to address
    //$mail->addReplyTo('replyto@example.com', 'First Last');
    //Set who the message is to be sent to
    //$mail->addAddress($datos_usuario[0]->email, $datos_usuario[0]->nombre_completo);
    //$mail->addAddress('Jaime.Roca@cialalimentos.cl', $datos_usuario[0]->nombre_completo);
    //$mail->addAddress('rod@gop.cl', $datos_usuario[0]->nombre_completo);
    $mail->addAddress('daniel@gop.cl', $datos_usuario[0]->nombre_completo);
    $mail->AddBCC("backup@sgd.cl", "BCC: " . $datos_usuario[0]->nombre_completo);
    //Set the subject line
    $mail->Subject = $tipo_correo[0]->titulo;
    //Read an HTML message body from an external file, convert referenced images to embedded,
    //convert HTML into a basic plain-text alternative body
    $mail->msgHTML($plantilla, dirname(__FILE__));
    //Replace the plain text body with one created manually
    $mail->AltBody = 'Alt Body';
    //Attach an image file
    //$mail->addAttachment('img/Prop_Intranet_TNT.docx');
    //send the message, check for errors
    if (!$mail->send()) {
        echo "Mailer Error: " . $mail->ErrorInfo;
    } else {
        //echo "Message sent!";
    }
    //exit;
}
function ConectaLDAP($user, $pass, $dominio)
{
    // ejemplo de autenticación
    $ldaprdn  = $user . '@' . $dominio; // ldap rdn or dn
    $ldappass = $pass; // associated password
    //echo "user:". $ldaprdn;
    //echo "<br>";
    //echo "pass:". $ldappass;
    //exit;
    // conexiÃ³n al servidor LDAP
    if ($dominio == "cl.minvest.net") {
        $ldapconn = ldap_connect("172.26.22.5") or die("Could not connect to LDAP server.");
    } else if ($dominio == "gildemeister.local") {
        $ldapconn = ldap_connect("193.9.200.120") or die("Could not connect to LDAP server.");
    }
    if ($ldapconn) {
        // realizando la autenticaciÃ³n
        $ldapbind = ldap_bind($ldapconn, $ldaprdn, $ldappass);
        // verificaciÃ³n del enlace
        if ($ldapbind) {
            // echo "LDAP bind successful...";
            return ("si");
        } else {
            // echo "LDAP bind failed...";
            return ("no");
        }
    }
}
function encryptMoodleAula($string, $key)
{
    $key    = "fb22a3635eaae749279313c23bc40429";
    $result = '';
    for ($i = 0; $i < strlen($string); $i++) {
        $char    = substr($string, $i, 1);
        $keychar = substr($key, ($i % strlen($key)) - 1, 1);
        $char    = chr(ord($char) + ord($keychar));
        $result .= $char;
    }
    return base64_encode($result);
}
function ColocaPreguntaConcurso($PRINCIPAL, $id_empresa, $rut)
{
    $PRINCIPAL             = str_replace("{RUT}", Encodear3($rut), $PRINCIPAL);
    $datos_pregunta_activa = TraePreguntaActivaConcurso($id_empresa);
    $PRINCIPAL             = str_replace("{PREGUNTA_ACTIVA}", ($datos_pregunta_activa[0]->pregunta), $PRINCIPAL);
    $PRINCIPAL             = str_replace("{ID_PREGUNTA}", Encodear3($datos_pregunta_activa[0]->id), $PRINCIPAL);
    return ($PRINCIPAL);
}
function ColocaAvanceDadoMP($PRINCIPAL, $id_mp, $rut, $id_empresa)
{
    $avance_mp    = DatosMPDadoId($id_mp);
    $participants = MP_UsuariosPorMPYUsuario($id_empresa, $id_mp);
    if (count($participants) > 0) {
        $PRINCIPAL = str_replace("{PORCENTAJE_AVANCE_MP}", "100", $PRINCIPAL);
        $PRINCIPAL = str_replace("{ACTIVE_PASO4}", ' class="active"', $PRINCIPAL);
    } else if ($avance_mp[0]->contenido && $avance_mp[0]->tag) {
        $PRINCIPAL = str_replace("{PORCENTAJE_AVANCE_MP}", "75", $PRINCIPAL);
        $PRINCIPAL = str_replace("{ACTIVE_PASO4}", ' class="active"', $PRINCIPAL);
    } else if ($avance_mp[0]->nombre) {
        $PRINCIPAL = str_replace("{PORCENTAJE_AVANCE_MP}", "50", $PRINCIPAL);
        $PRINCIPAL = str_replace("{ACTIVE_PASO3}", ' class="active"', $PRINCIPAL);
    } else if ($avance_mp[0]->id_categoria) {
        $PRINCIPAL = str_replace("{PORCENTAJE_AVANCE_MP}", "25", $PRINCIPAL);
        $PRINCIPAL = str_replace("{ACTIVE_PASO2}", ' class="active"', $PRINCIPAL);
    } else {
        $PRINCIPAL = str_replace("{PORCENTAJE_AVANCE_MP}", "0", $PRINCIPAL);
        $PRINCIPAL = str_replace("{ACTIVE_PASO1}", ' class="active"', $PRINCIPAL);
    }
    return ($PRINCIPAL);
}
function ListadoMejoresPracticas($PRINCIPAL, $id_empresa, $rut, $ord_by, $filt_by, $filt_cat, $vp)
{
    $todas         = MPObtengoTodasDadoRut($id_empresa, $rut, $ord_by, $filt_by, $filt_cat, $vp);
    $total_listado = "";
    //echo "<pre>";
    //print_r($todas);
    foreach ($todas as $unico) {
        //echo $unico->id_estado;
        if ($unico->id_estado == 1 or $unico->id_estado == 4 or $unico->id_estado == 6) {
            $link_MP = "PrevMejPrac";
        } else {
            $link_MP = "VistaMejPrac";
        }
        $total_listado .= file_get_contents("views/mejorespracticas/mp_row_listado.html");
        $total_listado = str_replace("{ID_MP}", $unico->id_mp, $total_listado);
        $total_listado = str_replace("{LINK}", $link_MP, $total_listado);
        $total_listado = str_replace("{CATEGORIA_MP}", ($unico->categoria), $total_listado);
        $total_listado = str_replace("{DESCRIPCION_CATEGORIA}", ($unico->descripcion_categoria), $total_listado);
        $total_listado = str_replace("{NOMBRE}", ($unico->nombre), $total_listado);
        $total_listado = str_replace("{CONTENIDO}", limit_text($unico->contenido, 25), $total_listado);
        $total_listado = str_replace("{FECHA}", formatearFechaSmall($unico->fecha), $total_listado);
        $total_listado = str_replace("{ESTADO}", ($unico->estado), $total_listado);
        $total_listado = str_replace("{DESCRIPCION_ESTADO}", ($unico->descripcion_estado), $total_listado);
        $total_listado = str_replace("{RUT_AUTOR}", ($unico->rut), $total_listado);
        $total_listado = str_replace("{NOMBRE_AUTOR}", ($unico->nombre_autor), $total_listado);
        $total_listado = str_replace("{FOTO_AUTOR}", VerificaFotoPersonal($unico->rut), $total_listado);
        $total_listado = str_replace("{NUMVISITAS}", round($unico->numvisitas), $total_listado);
        $total_listado = str_replace("{NUMMEGUSTA}", ($unico->nummegusta), $total_listado);
        $total_listado = str_replace("{NUMCOMPARTIDA}", ($unico->numcompartido), $total_listado);
        $total_listado = str_replace("{NUMCOMENTARIO}", ($unico->numcomentarios), $total_listado);
        $total_listado = str_replace("{ESTILOESTADO}", ($unico->estilo), $total_listado);
        $total_listado = str_replace("{ICONOESTADO}", ($unico->icono_estado), $total_listado);
        $total_listado = str_replace("{ESTILOCATEGORIA}", ($unico->style), $total_listado);
        $total_listado = str_replace("{ICONOCATEGORIA}", ($unico->icono), $total_listado);
        $total_listado = str_replace("{CATEGORIA_MP}", ($unico->categoria), $total_listado);
    }
    $agrup_categorias      = MPObtengoCategoriasNumero($id_empresa);
    $total_agrup_categoria = "";
    foreach ($agrup_categorias as $agrup_categoria) {
        $total_agrup_categoria .= file_get_contents("views/mejorespracticas/mp_row_agrupacion_categoria_ambito.html");
        $total_agrup_categoria = str_replace("{ITEM}", ($agrup_categoria->categoria), $total_agrup_categoria);
        $total_agrup_categoria = str_replace("{NUM}", ($agrup_categoria->cuenta), $total_agrup_categoria);
        $link_cat_amb          = "?sw=listMejPrac&ord_by=" . $ord_by . "&filt_cat=cat-" . $agrup_categoria->id_categoria . "#lista";
        $total_agrup_categoria = str_replace("{LINK}", $link_cat_amb, $total_agrup_categoria);
        //    echo $agrup_categoria->categoria;
    }
    $limit                           = 3;
    $listado_mas                     = MPObtengoMasInteracciones($id_empresa, "MASPARTICIPATIVO", $limit);
    $total_listado_mas_participativo = "";
    foreach ($listado_mas as $listado_mas_unico) {
        $total_listado_mas_participativo .= file_get_contents("views/mejorespracticas/mp_row_participantes_mas.html");
        $datos_usuario                   = UsuarioEnBasePersonas($listado_mas_unico->rut);
        $total_listado_mas_participativo = str_replace("{FOTO_AUTOR}", VerificaFotoPersonal($listado_mas_unico->rut), $total_listado_mas_participativo);
        $total_listado_mas_participativo = str_replace("{NOMBRE_AUTOR}", ($datos_usuario[0]->nombre_completo), $total_listado_mas_participativo);
        $total_listado_mas_participativo = str_replace("{NUM}", ($listado_mas_unico->cuenta), $total_listado_mas_participativo);
        $total_listado_mas_participativo = str_replace("{NUMTEXT}", " Interacciones", $total_listado_mas_participativo);
        $link                            = "?sw=listMejPrac&filt_by=" . $datos_usuario[0]->rut . "&vp=1#lista";
        $total_listado_mas_participativo = str_replace("{LINK}", $link, $total_listado_mas_participativo);
    }
    $listado_mas                   = MPObtengoMasInteracciones($id_empresa, "MASCOLABORATIVO", $limit);
    $total_listado_mas_colaborador = "";
    foreach ($listado_mas as $listado_mas_unico) {
        $total_listado_mas_colaborador .= file_get_contents("views/mejorespracticas/mp_row_participantes_mas.html");
        $datos_usuario                 = UsuarioEnBasePersonas($listado_mas_unico->rut);
        $total_listado_mas_colaborador = str_replace("{FOTO_AUTOR}", VerificaFotoPersonal($listado_mas_unico->rut), $total_listado_mas_colaborador);
        $total_listado_mas_colaborador = str_replace("{NOMBRE_AUTOR}", ($datos_usuario[0]->nombre_completo), $total_listado_mas_colaborador);
        $total_listado_mas_colaborador = str_replace("{NUM}", ($listado_mas_unico->cuenta), $total_listado_mas_colaborador);
        $total_listado_mas_colaborador = str_replace("{NUMTEXT}", " Colaboraciones", $total_listado_mas_colaborador);
        $link                          = "?sw=listMejPrac&filt_by=" . $datos_usuario[0]->rut . "&vp=1#lista";
        $total_listado_mas_colaborador = str_replace("{LINK}", $link, $total_listado_mas_colaborador);
    }
    $listado_mas                = MPObtengoMasInteracciones($id_empresa, "MASAPOYADOR", $limit);
    $total_listado_mas_apoyador = "";
    foreach ($listado_mas as $listado_mas_unico) {
        $total_listado_mas_apoyador .= file_get_contents("views/mejorespracticas/mp_row_participantes_mas.html");
        $datos_usuario              = UsuarioEnBasePersonas($listado_mas_unico->rut);
        $total_listado_mas_apoyador = str_replace("{FOTO_AUTOR}", VerificaFotoPersonal($listado_mas_unico->rut), $total_listado_mas_apoyador);
        $total_listado_mas_apoyador = str_replace("{NOMBRE_AUTOR}", ($datos_usuario[0]->nombre_completo), $total_listado_mas_apoyador);
        $total_listado_mas_apoyador = str_replace("{NUM}", ($listado_mas_unico->cuenta), $total_listado_mas_apoyador);
        $total_listado_mas_apoyador = str_replace("{NUMTEXT}", " Me Gusta y Favoritas", $total_listado_mas_apoyador);
        $link                       = "?sw=listMejPrac&filt_by=" . $datos_usuario[0]->rut . "&vp=1#lista";
        $total_listado_mas_apoyador = str_replace("{LINK}", $link, $total_listado_mas_apoyador);
    }
    $listado_mas                   = MPObtengoMasInteracciones($id_empresa, "MASPROPOSITIVO", $limit);
    $total_listado_mas_propositivo = "";
    foreach ($listado_mas as $listado_mas_unico) {
        $total_listado_mas_propositivo .= file_get_contents("views/mejorespracticas/mp_row_participantes_mas.html");
        $datos_usuario                 = UsuarioEnBasePersonas($listado_mas_unico->rut);
        $total_listado_mas_propositivo = str_replace("{FOTO_AUTOR}", VerificaFotoPersonal($listado_mas_unico->rut), $total_listado_mas_propositivo);
        $total_listado_mas_propositivo = str_replace("{NOMBRE_AUTOR}", ($datos_usuario[0]->nombre_completo), $total_listado_mas_propositivo);
        $total_listado_mas_propositivo = str_replace("{NUM}", ($listado_mas_unico->cuenta), $total_listado_mas_propositivo);
        $total_listado_mas_propositivo = str_replace("{NUMTEXT}", " Pr&aacute;cticas Publicadas", $total_listado_mas_propositivo);
        $link                          = "?sw=listMejPrac&filt_by=" . $datos_usuario[0]->rut . "&vp=1#lista";
        $total_listado_mas_propositivo = str_replace("{LINK}", $link, $total_listado_mas_propositivo);
    }
    $listado_mas              = MPObtengoMasInteracciones($id_empresa, "MASMASTER", $limit);
    $total_listado_mas_master = "";
    foreach ($listado_mas as $listado_mas_unico) {
        $total_listado_mas_master .= file_get_contents("views/mejorespracticas/mp_row_participantes_mas.html");
        $datos_usuario            = UsuarioEnBasePersonas($listado_mas_unico->rut);
        $total_listado_mas_master = str_replace("{FOTO_AUTOR}", VerificaFotoPersonal($listado_mas_unico->rut), $total_listado_mas_master);
        $total_listado_mas_master = str_replace("{NOMBRE_AUTOR}", ($datos_usuario[0]->nombre_completo), $total_listado_mas_master);
        $total_listado_mas_master = str_replace("{NUM}", round($listado_mas_unico->cuenta), $total_listado_mas_master);
        $total_listado_mas_master = str_replace("{NUMTEXT}", " Puntos Ponderados", $total_listado_mas_master);
        $link                     = "?sw=listMejPrac&filt_by=" . $datos_usuario[0]->rut . "&vp=1#lista";
        $total_listado_mas_master = str_replace("{LINK}", $link, $total_listado_mas_master);
    }
    $total_listado_tags      = TraeTagCloudPorEmpresa($id_empresa);
    $total_listado_tag_cloud = "";
    foreach ($total_listado_tags as $total_listado_tag_unico) {
        $total_listado_tag_cloud .= file_get_contents("views/mejorespracticas/mp_row_tag_cloud.html");
        $total_listado_tag_cloud = str_replace("{TAG}", $total_listado_tag_unico->tag, $total_listado_tag_cloud);
        $total_listado_tag_cloud = str_replace("{NUM}", $total_listado_tag_unico->cuenta, $total_listado_tag_cloud);
        $link                    = "?sw=listMejPrac&filt_by=" . $total_listado_tag_unico->tag . "&vp=tag#lista";
        $total_listado_tag_cloud = str_replace("{LINK}", $link, $total_listado_tag_cloud);
    }
    $PRINCIPAL = str_replace("{NUM_FAV}", MPbuscaFav($rut, $id_empresa), $PRINCIPAL);
    $PRINCIPAL = str_replace("{NUM_MISPR}", MPbuscaMp($rut, $id_empresa), $PRINCIPAL);
    $PRINCIPAL = str_replace("{INSIGNIA}", "", $PRINCIPAL);
    $PRINCIPAL = str_replace("{ROW_LISTADO_RECIENTES}", ($total_listado), $PRINCIPAL);
    $PRINCIPAL = str_replace("{AGRUPACION_CATEGORIAS}", ($total_agrup_categoria), $PRINCIPAL);
    $PRINCIPAL = str_replace("{AGRUPACION_AMBITOS}", ($total_agrup_ambito), $PRINCIPAL);
    $PRINCIPAL = str_replace("{MAS_PROPOSITIVOS}", ($total_listado_mas_propositivo), $PRINCIPAL);
    $PRINCIPAL = str_replace("{MAS_COLABORADORES}", ($total_listado_mas_colaborador), $PRINCIPAL);
    $PRINCIPAL = str_replace("{MAS_APOYADORES}", ($total_listado_mas_apoyador), $PRINCIPAL);
    $PRINCIPAL = str_replace("{MAS_PARTICIPATIVOS}", ($total_listado_mas_participativo), $PRINCIPAL);
    $PRINCIPAL = str_replace("{MAS_MASTER}", ($total_listado_mas_master), $PRINCIPAL);
    $PRINCIPAL = str_replace("{TAG_CLOUD}", ($total_listado_tag_cloud), $PRINCIPAL);
    return ($PRINCIPAL);
}
function VistaMejorPractica($PRINCIPAL, $id_empresa, $id_mp, $pdf)
{
    //echo     "<br>$id_empresa, $id_mp";
    $todas = MPObtengoMejorPractica($id_empresa, $id_mp);
    //$total_listado="";
    //echo "<pre>";
    //print_r($todas);
    foreach ($todas as $unico) {
        if ($pdf == "pdf") {
            $total_listado .= file_get_contents("views/mejorespracticas/mp_vista_practica_pdf.html");
        } else {
            $total_listado .= file_get_contents("views/mejorespracticas/mp_vista_practica.html");
        }
        $total_listado = str_replace("{ID_CATEGORIA_MP}", ($unico->id_categoria), $total_listado);
        $total_listado = str_replace("{CATEGORIA_MP}", ($unico->categoria), $total_listado);
        $total_listado = str_replace("{DESCRIPCION_CATEGORIA}", ($unico->descripcion_categoria), $total_listado);
        $total_listado = str_replace("{NOMBRE}", ($unico->nombre), $total_listado);
        $total_listado = str_replace("{OBJETIVO}", ($unico->objetivo), $total_listado);
        $total_listado = str_replace("{IMPACTO}", ($unico->impacto), $total_listado);
        $total_listado = str_replace("{CONTENIDO}", $unico->contenido, $total_listado);
        $total_listado = str_replace("{FECHA}", formatearFechaSmall($unico->fecha), $total_listado);
        $total_listado = str_replace("{ESTADO}", ($unico->estado), $total_listado);
        $total_listado = str_replace("{DESCRIPCION_ESTADO}", ($unico->descripcion_estado), $total_listado);
        $total_listado = str_replace("{RUT_AUTOR}", ($unico->rut), $total_listado);
        $total_listado = str_replace("{NOMBRE_AUTOR}", ($unico->nombre_autor), $total_listado);
        $total_listado = str_replace("{FOTO_AUTOR}", VerificaFotoPersonal($unico->rut), $total_listado);
        if ($unico->rut == $_SESSION["user_"] AND $unico->id_estado == 1) {
            $total_listado = str_replace("{BLOQUE_EDITAR}", file_get_contents("views/mejorespracticas/mp_bloque_edita.html"), $total_listado);
        } elseif ($unico->rut == $_SESSION["user_"] AND $unico->id_estado == 6) {
            $total_listado = str_replace("{BLOQUE_EDITAR}", file_get_contents("views/mejorespracticas/mp_bloque_edita.html"), $total_listado);
        } elseif ($unico->rut == $_SESSION["user_"] AND $unico->id_estado == 4) {
            $total_listado = str_replace("{BLOQUE_EDITAR}", file_get_contents("views/mejorespracticas/mp_bloque_edita.html"), $total_listado);
        } else {
            $total_listado = str_replace("{BLOQUE_EDITAR}", "", $total_listado);
        }
        $total_listado = str_replace("{ID_MP}", ($unico->id_mp), $total_listado);
        $total_listado = str_replace("{ID_MP_ENCODEADO}", Encodear3($unico->id_mp), $total_listado);
        //INSIGNIA DE CADA UUSUARIO
        //echo "hola ".$unico->numvisitas;
        $total_listado = str_replace("{NUMVISITAS}", round($unico->numvisitas), $total_listado);
        $total_listado = str_replace("{NUMMEGUSTA}", ($unico->nummegusta), $total_listado);
        $total_listado = str_replace("{NUMCOMPARTIDA}", ($unico->numcompartido), $total_listado);
        $total_listado = str_replace("{NUMCOMENTARIO}", ($unico->numcomentarios), $total_listado);
        $total_listado = str_replace("{NUMVISITAS}", round($unico->numvisitas), $total_listado);
        $total_listado = str_replace("{ESTILOESTADO}", ($unico->estilo), $total_listado);
        $total_listado = str_replace("{ICONOESTADO}", ($unico->icono_estado), $total_listado);
        $total_listado = str_replace("{ESTILOCATEGORIA}", ($unico->style), $total_listado);
        $total_listado = str_replace("{ICONOCATEGORIA}", ($unico->icono), $total_listado);
        $total_listado = str_replace("{AMBITO}", ($unico->ambitonombre), $total_listado);
        $total_listado = str_replace("{ESTILOAMBITO}", ($unico->ambitostyle), $total_listado);
        $total_listado = str_replace("{ICONOAMBITO}", ($unico->ambitoicono), $total_listado);
        $total_listado = str_replace("{CATEGORIA_MP}", ($unico->categoria), $total_listado);
        $archivo       = $unico->archivo;
        $trozos        = explode(".", $archivo);
        $extension     = end($trozos);
        //echo "$archivo= $extension";
        if ($extension <> "") {
            $total_listado = str_replace("{BLOQUE_ARCHIVO}", file_get_contents("views/mejorespracticas/mp_vista_practica_bloque_archivo.html"), $total_listado);
            $total_listado = str_replace("{NOMBRE_ARCHIVO}", $unico->archivo, $total_listado);
        } else {
            $total_listado = str_replace("{BLOQUE_ARCHIVO}", "", $total_listado);
        }
        $total_listado = utf8_decode(ColocaListadoColaboradoresPorMP($total_listado, $id_empresa, "", $id_mp));
        if ($unico->id_estado >= 5) {
            $textocomentario    = "
            <br><hr><div class='row'>
            <div class='col-xs-12 mp_ayudaamejorar'>
            Colabora y  ayuda a " . $unico->nombre_autor . " a mejorar su pr?ctica
            </div>
            </div><br>";
            $textointeracciones = "
            <br><hr><div class='row'>
            <div class='col-xs-12 mp_ayudaamejorar pull-left'>
            Colaboraciones
            </div>
            </div><br>";
            $total_listado      = str_replace("{TEXTO_COMENTARIO}", utf8_decode($textocomentario), $total_listado);
            $total_listado      = str_replace("{TEXTO_INTERACCIONES}", utf8_decode($textointeracciones), $total_listado);
            $total_listado      = str_replace("{PRACTICA_MEGUSTA}", ColocaMeGustaApoyoInt($id_mp, "id_mp", $id_empresa, $_SESSION["user_"], "", $id_mp), $total_listado);
            $total_listado      = str_replace("{PRACTICA_FAVORITA}", ColocaFavoritoInt($id_mp, "id_mp", $id_empresa, $_SESSION["user_"], "", $id_mp), $total_listado);
            $total_listado      = str_replace("{PRACTICA_PDF}", ColocaPDFInt($id_mp, "id_mp", $id_empresa, $_SESSION["user_"], "", $id_mp), $total_listado);
        } else {
            $total_listado = str_replace("{PRACTICA_MEGUSTA}", "", $total_listado);
            $total_listado = str_replace("{TEXTO_COMENTARIO}", "", $total_listado);
            $total_listado = str_replace("{TEXTO_INTERACCIONES}", "", $total_listado);
            $total_listado = str_replace("{COMPARTIR}", "", $total_listado);
            $total_listado = str_replace("{PRACTICA_PDF}", "", $total_listado);
            $total_listado = str_replace("{PRACTICA_FAVORITA}", "", $total_listado);
        }
    }
    $PRINCIPAL = str_replace("{ROW_LISTADO_RECIENTES}", ($total_listado), $PRINCIPAL);
    $PRINCIPAL = str_replace("{GALERIAIMAGENES}", "", $PRINCIPAL);
    $PRINCIPAL = str_replace("{INSIGNIA}", "", $PRINCIPAL);
    return ($PRINCIPAL);
}
function limit_text($text, $limit)
{
    if (str_word_count($text, 0) > $limit) {
        $words = str_word_count($text, 2);
        $pos   = array_keys($words);
        $text  = substr($text, 0, $pos[$limit]) . '...';
    }
    return strip_tags($text);
}
function EnviaCorreoBuenasPracticas($rut_destinatario, $nombre, $id_estado, $id_empresa, $tipo_correo, $tiporecipiente, $id_mp)
{
    //echo "$rut_destinatario,$nombre, $id_estado, $id_empresa, $tipo_correo, $tiporecipiente, $id_mp";
    $datos_empresa   = DatosEmpresa($id_empresa);
    $datos_practica  = MPObtengoMejorPractica($id_empresa, $id_mp);
    $nombre_practica = $datos_practica[0]->nombre;
    $nombre_autor    = $datos_practica[0]->nombre_autor;
    $rut_autor       = $datos_practica[0]->rut;
    $datos_autor     = UsuarioEnBasePersonas($rut_autor);
    $datos_admin     = UsuarioAdminEmpresa($id_empresa);
    //print_r($datos_autor);
    $nombre_autor    = $datos_autor[0]->nombre_completo;
    $email_autor     = $datos_autor[0]->email;
    $datos_Estado    = MP_ObtengoDatosEstadoPorEmpresa($id_empresa, $id_estado);
    $template_correo = file_get_contents("views/mejorespracticas/correos/" . $datos_Estado[0]->{$tipo_correo});
    $template_correo = str_replace("{NOMBRE}", ($nombre_autor), $template_correo);
    $template_correo = str_replace("{PRACTICA}", ($nombre_practica), $template_correo);
    $asunto          = $datos_Estado[0]->{$tiporecipiente};
    //print_r($datos_Estado);
    //echo "<br>asunto $asunto";
    if ($tipo_correo == "template_email_autor") {
        $nombre_envio = $datos_autor[0]->nombre_completo;
        $email_envio  = $datos_autor[0]->email;
        //echo "<br><br>usuario $rut_destinatario,$nombre, $id_estado, $id_empresa, $tipo_correo, $tiporecipiente,  $id_mp,
        //nombrepractica $nombre_practica, rut_autor $rut_autor,  nombre_autor $nombre_autor, email_autor $email_autor    ";
    }
    if ($tipo_correo == "template_email_admin") {
        //print_r($datos_admin);
        foreach ($datos_admin as $datos_admin_usuario) {
            $email_admin = $datos_admin_usuario->email;
        }
        $nombre_envio = "Administrador";
        $email_envio  = $email_admin;
        //$email_envio="rod.arancibia@gmail.cl";
        //echo "<br><br>admin $rut_destinatario,$nombre, $id_estado, $id_empresa, $tipo_correo, $tiporecipiente,  $id_mp,
        //nombrepractica $nombre_practica, rut_autor $rut_autor,  nombre_autor $nombre_autor, email_autor $email_autor, email_admin $email_admin  <br>
        //$nombre_envio<br>
        // $email_admin ";   exit();
    }
    if ($id_estado > 1) {
        $mail = new PHPMailer;
        //Tell PHPMailer to use SMTP
        $mail->isSMTP(); //Enable SMTP debugging
        // 0 = off (for production use)
        // 1 = client messages
        // 2 = client and server messages
        $mail->SMTPDebug   = 1;
        //Ask for HTML-friendly debug output
        $mail->Debugoutput = 'error_log';
        //Set the hostname of the mail server
        $mail->Host        = $datos_empresa[0]->server;
        //Set the SMTP port number - likely to be 25, 465 or 587
        $mail->Port        = 25;
        //Whether to use SMTP authentication
        $mail->SMTPAuth    = true;
        //Username to use for SMTP authentication
        $mail->Username    = $datos_empresa[0]->envio_correos;
        //Password to use for SMTP authentication
        $mail->Password    = $datos_empresa[0]->envio_correos_pass;
        //Set who the message is to be sent from
        $mail->setFrom($datos_empresa[0]->envio_correos, $datos_empresa[0]->envio_correos);
        //Set an alternative reply-to address
        //$mail->addReplyTo('replyto@example.com', 'First Last');
        //Set who the message is to be sent to
        //$mail->addAddress($datos_destinatario[0]->email, $datos_destinatario[0]->nombre_completo);
        //$mail->addAddress("daniel@gop.cl", $datos_destinatario[0]->nombre_completo);
        $mail->addAddress($email_envio, $nombre_envio);
        //$mail->addAddress("francisco.lopez@tnt.com", $datos_destinatario[0]->nombre_completo);
        //$mail->addAddress("rod@gop.cl", $datos_destinatario[0]->nombre_completo);
        //$mail->AddBCC("backup@sgd.cl","BCC: ".$datos_destinatario[0]->nombre_completo);
        //Set the subject line
        $mail->Subject = $asunto;
        //Read an HTML message body from an external file, convert referenced images to embedded,
        //convert HTML into a basic plain-text alternative body
        $mail->msgHTML($template_correo, dirname(__FILE__));
        //Replace the plain text body with one created manually
        $mail->AltBody = 'Si no puedes visualizar este correo ....';
        //Attach an image file
        //$mail->addAttachment('images/phpmailer_mini.png');
        //send the message, check for errors
        if (!$mail->send()) {
            echo "Mailer Error: " . $mail->ErrorInfo;
        } else {
            echo "Message sent!";
        }
    }
    //exit;
}
function ColocaListadoColaboradoresPorMP($PRINCIPAL, $id_empresa, $rut, $id_mp)
{
    $usuarios = MP_UsuariosPorMPYUsuario($id_mp, $id_empresa);
    if ($usuarios) {
        $total_colaboradores = "";
        foreach ($usuarios as $usu) {
            $total_colaboradores .= file_get_contents("views/mejorespracticas/mp_row_colaboradores.html");
            $total_colaboradores = str_replace("{NOMBRE}", $usu->nombre_completo, $total_colaboradores);
            $total_colaboradores = str_replace("{CARGO}", $usu->cargo, $total_colaboradores);
            $total_colaboradores = str_replace("{ROL}", $usu->rol, $total_colaboradores);
        }
        $PRINCIPAL = str_replace("{LISTADO_USUARIOS}", ($total_colaboradores), $PRINCIPAL);
    } else {
        $PRINCIPAL = str_replace("{LISTADO_USUARIOS}", "", $PRINCIPAL);
    }
    return ($PRINCIPAL);
}
function allPersonasPorNombrePorEmpresaGenerico($buscar, $id_empresa, $rut)
{
    $datos_usuario = UsuarioEnBasePersonas($rut);
    $dataPersonas  = allPersonasPorEmpresa($buscar, $id_empresa);
    if ($dataPersonas) {
        foreach ($dataPersonas as $dataPersonas_aux) {
            echo ($dataPersonas_aux->nombre) . " " . ($dataPersonas_aux->apaterno) . " " . ($dataPersonas_aux->amaterno) . " " . "|" . $dataPersonas_aux->rut . "\n";
            //echo ($dataPersonas_aux->nombre)."\n";
        }
    } else {
        $data = 'No Existe este nombre';
    }
    return $data;
}
function ColocaTitulosPorPaso($PRINCIPAL, $id_empresa)
{
    $pasos = MP_TraigoPasosPorEmpresa($id_empresa);
    $i     = 1;
    foreach ($pasos as $pas) {
        $PRINCIPAL = str_replace("{NUMPASO$i}", $i, $PRINCIPAL);
        $PRINCIPAL = str_replace("{NOMBREPASO$i}", ($pas->paso), $PRINCIPAL);
        $PRINCIPAL = str_replace("{DESCRIPCION$i}", ($pas->descripcion), $PRINCIPAL);
        $PRINCIPAL = str_replace("{TEXTO$i}", ($pas->texto), $PRINCIPAL);
        $i++;
    }
    return ($PRINCIPAL);
}
function FormularioBuenasPracticas($PRINCIPAL, $id_empresa, $rut, $id_mp)
{
    //Coloco combobox, de categorias.
    //$categorias=TraeCategoriasMejoresPracticas($id_empresa);
    $categorias = TraeCategoriasMejoresPracticasParaCombo($id_empresa);
    $datos_mp   = DatosMPDadoId($id_mp);
    $ambitos    = TraeAmbitosMejoresPracticas($id_empresa);
    if ($id_mp) {
        if ($datos_mp[0]->muestra == 1) {
            $PRINCIPAL = str_replace("{STYLE_BLOQUE_OTRA_OPOR}", '', $PRINCIPAL);
        } else {
            $PRINCIPAL = str_replace("{STYLE_BLOQUE_OTRA_OPOR}", 'style="display:none;"', $PRINCIPAL);
        }
    } else {
        $PRINCIPAL = str_replace("{STYLE_BLOQUE_OTRA_OPOR}", 'style="display:none;"', $PRINCIPAL);
    }
    $categoria_options     = "";
    $listado_colaboradores = TotalUsuariosPorempresa($id_empresa);
    foreach ($listado_colaboradores as $list) {
        $html_colaboradores .= "<option value='" . $list->rut . "'>" . $list->nombre_completo . "</option>";
    }
    foreach ($categorias as $cat) {
        if ($datos_mp[0]->id_categoria == $cat->id_categoria) {
            $categoria_options .= "<option selected='selected' value='" . $cat->id_categoria . "'>" . $cat->categoria . "</option>";
        } else if ($datos_mp[0]->muestra == "1" and $cat->id_categoria == "0") {
            $categoria_options .= "<option selected='selected' value='" . $cat->id_categoria . "'>" . $cat->categoria . "</option>";
        } else {
            $categoria_options .= "<option value='" . $cat->id_categoria . "'>" . $cat->categoria . "</option>";
        }
    }
    $ambito_options = "";
    foreach ($ambitos as $amb) {
        if ($datos_mp[0]->id_ambito == $amb->id_ambito) {
            $ambito_options .= "<option selected='selected' value='" . $amb->id_ambito . "'>" . $amb->ambito . "</option>";
        } else {
            $ambito_options .= "<option value='" . $amb->id_ambito . "'>" . $amb->ambito . "</option>";
        }
    }
    if ($id_mp) {
        $PRINCIPAL = str_replace("{ID_MP}", $id_mp, $PRINCIPAL);
        $PRINCIPAL = str_replace("{ID_MP_ENCODEADO}", Encodear3($id_mp), $PRINCIPAL);
    } else {
        $PRINCIPAL = str_replace("{ID_MP}", "", $PRINCIPAL);
        $PRINCIPAL = str_replace("{ID_MP_ENCODEADO}", "", $PRINCIPAL);
    }
    $PRINCIPAL = str_replace("{OPTIONS_CATEGORIAS_MEJORES_PRACTICAS}", ($categoria_options), $PRINCIPAL);
    $PRINCIPAL = str_replace("{OPTIONS_AMBITOS_MEJORES_PRACTICAS}", ($ambito_options), $PRINCIPAL);
    $PRINCIPAL = str_replace("{OPTION_LISTADO_COLABORADORES}", ($html_colaboradores), $PRINCIPAL);
    $PRINCIPAL = str_replace("{VALUE_NOMBRE}", ($datos_mp[0]->nombre), $PRINCIPAL);
    $PRINCIPAL = str_replace("{VALUE_OBJETIVO}", ($datos_mp[0]->objetivo), $PRINCIPAL);
    $PRINCAL   = str_replace("{VALUE_APLICACION}", ($datos_mp[0]->aplicacion), $PRINCIPAL);
    $PRINCIPAL = str_replace("{VALUE_METRICA}", ($datos_mp[0]->metrica), $PRINCIPAL);
    $PRINCIPAL = str_replace("{VALUE_IMPACTO}", ($datos_mp[0]->impacto), $PRINCIPAL);
    $PRINCIPAL = str_replace("{VALUE_PROBLEMA}", ($datos_mp[0]->problema), $PRINCIPAL);
    $PRINCIPAL = str_replace("{VALUE_KPI_AFECTADO}", ($datos_mp[0]->kpi_afectado), $PRINCIPAL);
    $PRINCIPAL = str_replace("{VALUE_CUANTIFICACION}", ($datos_mp[0]->cuantificacion), $PRINCIPAL);
    $PRINCIPAL = str_replace("{VALUE_COACH}", ($datos_mp[0]->coach), $PRINCIPAL);
    $PRINCIPAL = str_replace("{CONTENIDO_INGRESADO}", ($datos_mp[0]->contenido), $PRINCIPAL);
    $PRINCIPAL = str_replace("{VALUE_TAGS}", ($datos_mp[0]->tag), $PRINCIPAL);
    if ($datos_mp[0]->muestra == 1) {
        $PRINCIPAL = str_replace("{NOMBRE_CATEGORIA}", ($datos_mp[0]->nombre_categoria), $PRINCIPAL);
    } else {
        $PRINCIPAL = str_replace("{NOMBRE_CATEGORIA}", "", $PRINCIPAL);
    }
    //coloca listado de Usuarios por ID_MP
    $PRINCIPAL = ColocaListadoColaboradoresPorMP($PRINCIPAL, $id_empresa, $rut, $id_mp);
    return ($PRINCIPAL);
}
function ColocaDatosHomeSGD($PRINCIPAL, $id_empresa)
{
    $datos_home = ObtenerContenidosInicialSGDPorEmpresa($id_empresa);
    $PRINCIPAL  = str_replace("{TITULO}", ($datos_home[0]->titulo), $PRINCIPAL);
    $PRINCIPAL  = str_replace("{TEXTO_INTRODUCCION}", ($datos_home[0]->introduccion), $PRINCIPAL);
    $PRINCIPAL  = str_replace("{TEXTO_TRANSVERSALES}", ($datos_home[0]->competencias_transversales), $PRINCIPAL);
    $PRINCIPAL  = str_replace("{TEXTO_LIDERAZGO}", ($datos_home[0]->competencias_liderazgo), $PRINCIPAL);
    $PRINCIPAL  = str_replace("{IMAGEN_LOGIN}", ($datos_home[0]->imagen_home), $PRINCIPAL);
    $importante = ObtenerContenidosBloqueImportante($id_empresa);
    foreach ($importante as $imp) {
        $row_importante_home .= '<tr>
                                <td  valign="top"><span class="color_cafeemiliana"><i class="fa fa-angle-right padRight10px"></i></span></td>
                                <td><span class="color_cafeemiliana">' . $imp->texto . '</td>
                            </tr>
                            <tr><td colspan="2"><br></td></tr>';
    }
    $PRINCIPAL = str_replace("{ROW_IMPORTANTES}", ($row_importante_home), $PRINCIPAL);
    $tips      = ObtenerContenidosBloqueTips($id_empresa);
    foreach ($tips as $imp) {
        $row_tips_home .= '<tr>
                                <td  valign="top"><span class="color_cafeemiliana"><i class="fa fa-angle-right padRight10px"></i></span></td>
                                <td><span class="color_cafeemiliana">' . $imp->texto . '</td>
                            </tr>
                            <tr><td colspan="2"><br></td></tr>
                            ';
    }
    $PRINCIPAL = str_replace("{ROW_TIPS}", ($row_tips_home), $PRINCIPAL);
    return ($PRINCIPAL);
}
function ColocaPaginacionDeNoticias($pagina, $id_empresa, $noticas_por_pagina, $id_categoria)
{
    //$imagenes=FotosPorObjeto($id_objeto, $_SESSION["id_empresa"], "no");
    $noticias = TraeNoticiasTodas($id_empresa, $id_categoria);
    if (!$pagina) {
        $pagina = 1;
    }
    $total_noticias = count($noticias);
    $paginacion     = file_get_contents("views/noticias/entorno_paginacion.html");
    $total_paginas  = ceil($total_noticias / $noticas_por_pagina);
    //echo "$imagenes_por_pagina, $total_imagenes, $total_paginas";
    for ($i = 1; $i <= $total_paginas; $i++) {
        $row .= file_get_contents("views/noticias/row_paginacion.html");
        $row = str_replace("{NUMERO_PAGINA}", $i, $row);
        $row = str_replace("{PAGINA}", $i, $row);
        if ($pagina == $i) {
            $row = str_replace("{CLASE_ACTIVO}", "class='active'", $row);
        } else {
            $row = str_replace("{CLASE_ACTIVO}", "", $row);
        }
    }
    $paginacion = str_replace("{ROW_PAGINACION}", $row, $paginacion);
    return ($paginacion);
}
function ObtenerNotaDeEvaluacionSuma($id_objeto, $rut)
{
    $respuestas      = RespuestasDadoRutObjeto($rut, $id_objeto);
    $suma_respuestas = 0;
    foreach ($respuestas as $res) {
        $suma_respuestas = $suma_respuestas + $res->puntaje;
    }
    return ($suma_respuestas);
}
function ColocarFormularioPorImagenSubida($PRINCIPAL, $rut, $id_empresa, $id_imagen)
{
    $datos_imagen = ObtenerImagenDadoID($id_imagen);
    $PRINCIPAL    = str_replace("{URL_FOTO}", $datos_imagen[0]->archivo, $PRINCIPAL);
    $PRINCIPAL    = str_replace("{ID_IMAGEN_ENCODEADA}", Encodear3($id_imagen), $PRINCIPAL);
    $PRINCIPAL    = str_replace("{COMENTARIOS}", ($datos_imagen[0]->comentarios), $PRINCIPAL);
    if ($datos_imagen[0]->modalidad == 1) {
        $PRINCIPAL = str_replace("{DESCCATEGORIA}", "Mi Mam?", $PRINCIPAL);
        $PRINCIPAL = str_replace("{SEL1}", "selected='selected'", $PRINCIPAL);
    } else if ($datos_imagen[0]->modalidad == 2) {
        $PRINCIPAL = str_replace("{DESCCATEGORIA}", "La Mam? de mis hijos", $PRINCIPAL);
        $PRINCIPAL = str_replace("{SEL2}", "selected='selected'", $PRINCIPAL);
    } else if ($datos_imagen[0]->modalidad == 3) {
        $PRINCIPAL = str_replace("{DESCCATEGORIA}", "Yo como Mam?", $PRINCIPAL);
        $PRINCIPAL = str_replace("{SEL3}", "selected='selected'", $PRINCIPAL);
    }
    return ($PRINCIPAL);
}
function ColocaObjetivoPorGerencia($PRINCIPAL, $id_empresa, $rut)
{
    $datos     = DNCObtengoObjetivoPorEmpresa($rut, $id_empresa);
    $PRINCIPAL = str_replace("{OBJETIVO_POR_GERENCIA}", ($datos[0]->objetivo), $PRINCIPAL);
    return ($PRINCIPAL);
}
function GAMIFICACIONResultadosPorCursoMalla($rut, $id_curso, $id_malla, $id_empresa)
{
    if ($id_curso && $id_malla) {
        $nota_por_curso = GAMIFICACION_NotaPorCursoUsuarioEmpresa($rut, $id_curso, $id_empresa, $id_malla);
        $nota           = round($nota_por_curso[0]->nota_por_curso);
    } else if ($id_malla && !$id_curso) {
        $nota_por_malla = GAMIFICACION_NotaPorMallaUsuarioEmpresa($rut, $id_malla, $id_empresa);
        $nota           = round($nota_por_malla[0]->nota_por_malla);
    }
    return ($nota);
}
function GAMIFICACIONResultadosPorSoloCurso($rut, $id_curso, $id_empresa)
{
    $nota_por_curso = GAMIFICACION_NotaPorSoloCursoUsuarioEmpresa($rut, $id_curso, $id_empresa);
    $nota           = $nota_por_curso[0]->nota_por_curso;
    return ($nota);
}
function GAMIFICACION_ActualizaNivelVersion2($id_malla, $id_empresa, $rut)
{
    //Primero traigo el nivel actual.
    $datos_puntos_consolidado = TienePuntosConsolidadosPorMalla($rut, $id_empresa, $id_malla);
    $id_nivel                 = $datos_puntos_consolidado[0]->nivel;
    //dado el nivel, traigo el curso
    $datos_curso              = GAMIFICACION_ObtengoCursoDadoNivel($id_nivel, $id_empresa);
    $id_curso                 = $datos_curso[0]->idcurso;
    $datos_objeto_por_curso   = GAMIFICACIONTraeDatosObjetosPorCurso($rut, $id_curso);
    if ($datos_objeto_por_curso[0]->total_objetos == $datos_objeto_por_curso[0]->total_objetos_finalizados) {
        //Si la cantidad de objetos del curso, mas la cantidad de objetos finalizados,
        //significa que el nivel se paso, por ende se actualiza
        $orden_actual        = $datos_curso[0]->idorden;
        $orden_proximo_nivel = $orden_actual + 1;
        //ahora obtengo nivel, dado la malla y el orden
        $datos_nuevo_nivel   = GAMIFICACION_TraigoNivelDadoOrdenYMalla($id_malla, $orden_proximo_nivel);
        GAMIFICACION_ActualizaSoloNivel($datos_nuevo_nivel[0]->idnivel, $id_empresa, $rut, $id_malla);
    }
}
function ColocaPaginacionDeImagenes($pagina, $id_objeto, $rut, $id_malla, $cantidad_imagenes_galeria)
{
    //$imagenes=FotosPorObjeto($id_objeto, $_SESSION["id_empresa"], "no");
    //echo "$pagina, $id_objeto, $rut, idmalla $id_malla";
    $imagenes = FotosPorObjeto($id_objeto, $_SESSION["id_empresa"], "no", $id_malla);
    if (!$pagina) {
        $pagina = 1;
    }
    $imagenes_por_pagina = $cantidad_imagenes_galeria;
    $total_imagenes      = count($imagenes);
    $paginacion          = file_get_contents("views/cursos/objetos/subirFotos/entorno_paginacion.html");
    $total_paginas       = ceil($total_imagenes / $imagenes_por_pagina);
    //echo "$imagenes_por_pagina, $total_imagenes, $total_paginas";
    for ($i = 1; $i <= $total_paginas; $i++) {
        $row .= file_get_contents("views/cursos/objetos/subirFotos/row_paginacion.html");
        $row = str_replace("{NUMERO_PAGINA}", $i, $row);
        $row = str_replace("{PAGINA}", $i, $row);
        if ($pagina == $i) {
            $row = str_replace("{CLASE_ACTIVO}", "class='active'", $row);
        } else {
            $row = str_replace("{CLASE_ACTIVO}", "", $row);
        }
    }
    $paginacion = str_replace("{ROW_PAGINACION}", $row, $paginacion);
    return ($paginacion);
}
function RedimensionarImagenParaGaleria($rutaImagenOriginal, $nombre_imagen, $ext, $nombre_nuevo_archivo, $id_empresa)
{
    //echo "$rutaImagenOriginal, $nombre_imagen, $ext, $nombre_nuevo_archivo, $id_empresa";exit;
    //Ruta de la imagen original
    //$rutaImagenOriginal="./imagen/i2.jpg";
    //Creamos una variable imagen a partir de la imagen original
    if ($ext == "gif") {
        $img_original = imagecreatefromgif($rutaImagenOriginal);
    } else if ($ext == "png") {
        $img_original = imagecreatefrompng($rutaImagenOriginal);
    } else {
        $img_original = imagecreatefromjpeg($rutaImagenOriginal);
    }
    //echo $rutaImagenOriginal;exit;
    //Se define el maximo ancho o alto que tendra la imagen final
    //$alto_orig=imagesy($img_original);
    //$ancho_orig=imagesx($img_original);
    $max_ancho = 1000;
    $max_alto  = 1000;
    //Ancho y alto de la imagen original
    list($ancho, $alto) = getimagesize($rutaImagenOriginal);
    //Se calcula ancho y alto de la imagen final
    $x_ratio = $max_ancho / $ancho;
    $y_ratio = $max_alto / $alto;
    //Si el ancho y el alto de la imagen no superan los maximos,
    //ancho final y alto final son los que tiene actualmente
    if (($ancho <= $max_ancho) && ($alto <= $max_alto)) { //Si ancho
        $ancho_final = $ancho;
        $alto_final  = $alto;
    }
    /*
     * si proporcion horizontal*alto mayor que el alto maximo,
     * alto final es alto por la proporcion horizontal
     * es decir, le quitamos al alto, la misma proporcion que
     * le quitamos al alto
     *
     */
    elseif (($x_ratio * $alto) < $max_alto) {
        $alto_final  = ceil($x_ratio * $alto);
        $ancho_final = $max_ancho;
    }
    /*
     * Igual que antes pero a la inversa
     */
    else {
        $ancho_final = ceil($y_ratio * $ancho);
        $alto_final  = $max_alto;
    }
    if ($ancho > $alto) {
        $alto_final  = $max_alto;
        $ancho_final = ceil($y_ratio * $ancho);
    } else if ($alto > $ancho) {
        $alto_final  = ceil($x_ratio * $alto);
        $ancho_final = $max_ancho;
    }
    //Creamos una imagen en blanco de tamaño $ancho_final  por $alto_final .
    $tmp = imagecreatetruecolor($ancho_final, $alto_final);
    //Copiamos $img_original sobre la imagen que acabamos de crear en blanco ($tmp)
    imagecopyresampled($tmp, $img_original, 0, 0, 0, 0, $ancho_final, $alto_final, $ancho, $alto);
    //Se destruye variable $img_original para liberar memoria
    imagedestroy($img_original);
    //Definimos la calidad de la imagen final
    $calidad = 95;
    //Se crea la imagen final en el directorio indicado
    //imagejpeg($tmp,"../front/img/noticias/thum/".$nombre_imagen,$calidad);
    if ($ext == "gif") {
        imagegif($tmp, "../../front/galeria/" . $nombre_nuevo_archivo);
    } else if ($ext == "png") {
        imagepng($tmp, "../../front/galeria/" . $nombre_nuevo_archivo);
    } else {
        imagejpeg($tmp, "../../front/galeria/" . $nombre_nuevo_archivo);
    }
    /* SI QUEREMOS MOSTRAR LA IMAGEN EN EL NAVEGADOR
     *
     * descomentamos las lineas 64 ( Header("Content-type: image/jpeg"); ) y 65 ( imagejpeg($tmp); )
     * y comentamos la linea 57 ( imagejpeg($tmp,"./imagen/retoque.jpg",$calidad); )
     */
    //Header("Content-type: image/jpeg");
    //imagejpeg($tmp);
}
function OptionsCompetenciasDadoPerfil($perfil_evaluacion, $seleccionado)
{
    $competencias = ObtengoCompetenciasDadoPerfilConNombreCompetencia($perfil_evaluacion);
    foreach ($competencias as $comp) {
        if ($seleccionado == $comp->id_competencia) {
            $options .= "<option selected='selected' value='" . $comp->id_competencia . "'>" . $comp->nombre_competencia . "</option>";
        } else {
            $options .= "<option value='" . $comp->id_competencia . "'>" . $comp->nombre_competencia . "</option>";
        }
    }
    return (($options));
}
function getRutDV($rut)
{
    $rut = strrev($rut);
    $aux = 1;
    for ($i = 0; $i < strlen($rut); $i++) {
        $aux++;
        $s += intval($rut[$i]) * $aux;
        if ($aux == 7) {
            $aux = 1;
        }
    }
    $digit = 11 - $s % 11;
    if ($digit == 11) {
        $d = 0;
    } elseif ($digit == 10) {
        $d = "K";
    } else {
        $d = $digit;
    }
    return $d;
}
function ObtieneNotaObjetivosSinTablaRespuesta($evaluado, $evaluador, $id_proceso, $id_dimension)
{
    //$objetivos=ObjetivosEspecificosConRespuestaEvaluadoEvaluadorProceso($evaluado, $evaluador, $id_proceso);
    $objetivos  = NotasObjetivosPorDimension($evaluado, $evaluador, $id_proceso);
    $pond_total = 100;
    $i          = 0;
    foreach ($objetivos as $ob) {
        $acumulador = $acumulador + (($ob->nota_promediada * $ob->ponderacion) / $pond_total);
        $i++;
    }
    //echo "acumulador $acumulador <br>";
    //exit;
    return ($acumulador);
}
function ColocaBloqueMasMeGustaFotos($PRINCIPAL, $id_objeto, $id_malla)
{
    //obtengo comentarios dado id_objeto
    //$total_galerias=ObtenerFotosMasMegusta($id_objeto, $_SESSION["id_empresa"]);
    $total_galerias = ObtenerFotosMasMegustaPorMalla($id_objeto, $_SESSION["id_empresa"], $id_malla);
    if ($total_galerias) {
        foreach ($total_galerias as $arch) {
            $row_html .= file_get_contents("views/cursos/objetos/subirFotos/62_lista_archivos_bloque.html");
            $row_html = str_replace("{URL_IMAGEN_ARCHIVO}", $arch->archivo, $row_html);
            $row_html = str_replace("{URL_IMAGEN_PERSONA}", VerificaFotoPersonal($arch->rut_autor), $row_html);
            $row_html = str_replace("{DESCRIPCION}", ($arch->nombre_completo), $row_html);
            $row_html = str_replace("{MEGUSTA}", ColocaMeGusta($arch->id, "id_imagen_galeria", $_SESSION["id_empresa"], $arch->rut_autor, "autor", $id_objeto), $row_html);
        }
        $PRINCIPAL = str_replace("{BLOQUE_FOTOS_MAS_MEGUSTA}", ($row_html), $PRINCIPAL);
    } else {
        $PRINCIPAL = str_replace("{BLOQUE_FOTOS_MAS_MEGUSTA}", "", $PRINCIPAL);
    }
    return ($PRINCIPAL);
}
function RedimensionarImagenSubirObjetos($rutaImagenOriginal, $nombre_imagen, $ext, $nombre_nuevo_archivo, $id_empresa)
{
    //Ruta de la imagen original
    //$rutaImagenOriginal="./imagen/i2.jpg";
    //Creamos una variable imagen a partir de la imagen original
    if ($ext == "gif") {
        $img_original = imagecreatefromgif($rutaImagenOriginal);
    } else if ($ext == "png") {
        $img_original = imagecreatefrompng($rutaImagenOriginal);
    } else {
        $img_original = imagecreatefromjpeg($rutaImagenOriginal);
    }
    //Se define el maximo ancho o alto que tendra la imagen final
    //$alto_orig=imagesy($img_original);
    //$ancho_orig=imagesx($img_original);
    $max_ancho = 800;
    $max_alto  = 800;
    //Ancho y alto de la imagen original
    list($ancho, $alto) = getimagesize($rutaImagenOriginal);
    //Se calcula ancho y alto de la imagen final
    $x_ratio = $max_ancho / $ancho;
    $y_ratio = $max_alto / $alto;
    //Si el ancho y el alto de la imagen no superan los maximos,
    //ancho final y alto final son los que tiene actualmente
    //if( ($ancho >= $max_ancho) && ($alto >= $max_alto) ){//Si ancho
    if ($ancho >= $alto and $ancho > 50) {
        //Horizontal
        if ($ancho >= $max_alto) {
            $ancho_final = $max_ancho;
            //$alto_final = $alto;
            $alto_final  = round(($x_ratio * $alto), 0);
            //echo "ancho ".$ancho_final." ".$alto_final;exit;
        }
    } else if ($ancho < $alto and $ancho > 50) {
        //Vertical
        if ($alto >= $max_ancho) {
            //$ancho_final = $ancho;
            $alto_final  = $max_alto;
            $ancho_final = round(($y_ratio * $ancho), 0);
        }
    } else {
        echo "<script>
                    window.history.back();
                    </script>";
        exit;
    }
    /*if($ancho >= $max_alto){
    $ancho_final = $max_ancho;
    //$alto_final = $alto;
    $alto_final = ceil($x_ratio * $alto);
    //echo "ancho ".$ancho_final." ".$alto_final;exit;
    } else if($alto >= $max_ancho){
    //$ancho_final = $ancho;
    $alto_final = $max_alto;
    $ancho_final = ceil($y_ratio * $ancho);
    }else{
    $alto_final = 800;
    $ancho_final = 800;
    }
    /*if( ($ancho >= $max_alto) && ($alto >= $max_ancho) ){
    $ancho_final = $ancho;
    $alto_final = $alto;
    }
    * */
    /*
     * si proporcion horizontal*alto mayor que el alto maximo,
     * alto final es alto por la proporcion horizontal
     * es decir, le quitamos al alto, la misma proporcion que
     * le quitamos al alto
     *
     */
    /*elseif (($x_ratio * $alto) < $max_alto){
    $alto_final = ceil($x_ratio * $alto);
    $ancho_final = $max_ancho;
    }
    * */
    /*
     * Igual que antes pero a la inversa
     */
    /*else{
    $ancho_final = ceil($y_ratio * $ancho);
    $alto_final = $max_alto;
    }
    *
    * */
    /*if($ancho>$alto){
    $alto_final=$max_alto;
    $ancho_final=ceil($y_ratio * $ancho);
    }else if($alto>$ancho){
    $alto_final=ceil($x_ratio * $alto);
    $ancho_final=$max_ancho;
    }
    *
    * */
    //Creamos una imagen en blanco de tamaño $ancho_final  por $alto_final .
    $tmp = imagecreatetruecolor($ancho_final, $alto_final);
    //Copiamos $img_original sobre la imagen que acabamos de crear en blanco ($tmp)
    imagecopyresampled($tmp, $img_original, 0, 0, 0, 0, $ancho_final, $alto_final, $ancho, $alto);
    //Se destruye variable $img_original para liberar memoria
    imagedestroy($img_original);
    //Definimos la calidad de la imagen final
    $calidad = 95;
    //Se crea la imagen final en el directorio indicado
    //imagejpeg($tmp,"../front/img/noticias/thum/".$nombre_imagen,$calidad);
    if ($ext == "gif") {
        imagegif($tmp, "img/objetos/" . $nombre_nuevo_archivo);
    } else if ($ext == "png") {
        imagepng($tmp, "img/objetos/" . $nombre_nuevo_archivo);
    } else {
        imagejpeg($tmp, "img/objetos/" . $nombre_nuevo_archivo);
    }
    /* SI QUEREMOS MOSTRAR LA IMAGEN EN EL NAVEGADOR
     *
     * descomentamos las lineas 64 ( Header("Content-type: image/jpeg"); ) y 65 ( imagejpeg($tmp); )
     * y comentamos la linea 57 ( imagejpeg($tmp,"./imagen/retoque.jpg",$calidad); )
     */
    //Header("Content-type: image/jpeg");
    //imagejpeg($tmp);
}
function ColocaBloqueDerechoCursosNiveles($PRINCIPAL, $rut, $id_empresa, $id_clasificacion, $id_malla)
{
    $PRINCIPAL = str_replace("{BLOQUE_CURSOS_NIVELES}", file_get_contents("views/cursos/capacitacion/" . $id_empresa . "_bloque_niveles_curso.html"), $PRINCIPAL);
    if ($id_clasificacion && $id_malla) {
        $cursos = CAPACITACION_cursosPorClasificacionMalla($id_malla, $id_clasificacion);
        //exit;
    } else if ($id_malla) {
        $cursos = CAPACITACION_cursosPorClasificacionMalla($id_malla, null);
    }
    $total_avance                     = 0;
    $total_puntajes_maximos_por_curso = 0;
    foreach ($cursos as $cur) {
        $row_curso .= file_get_contents("views/cursos/capacitacion/" . $id_empresa . "_row_bloque_niveles_curso.html");
        $avances                          = ColocaAvanceCursoPorPuntosDeObjetos($row_curso, $cur->id_curso, $rut, $id_empresa);
        $row_curso                        = $avances[0];
        $total_avance                     = $total_avance + $avances[1];
        $total_puntajes_maximos_por_curso = $total_puntajes_maximos_por_curso + $cur->puntos_maximo;
    }
    $promedio  = (100 * $total_avance) / $total_puntajes_maximos_por_curso;
    //echo $total_avance." - ".$total_puntajes_maximos_por_curso;
    $PRINCIPAL = str_replace("{AVANCE_MALLA_POR_OBJETOS}", FormatearPorcentajes($promedio), $PRINCIPAL);
    $PRINCIPAL = str_replace("{ROW_CURSOS_RESUMENES}", $row_curso, $PRINCIPAL);
    return ($PRINCIPAL);
}
//$directorio_galerias='../admin/img/galerias/';
function ColocaAvanceCursoPorPuntosDeObjetos($html, $id_curso, $rut, $id_empresa)
{
    $datos_puntos = TienePuntosConsolidadosPorCurso($rut, $id_empresa, $id_curso);
    $grafico      = file_get_contents("views/cursos/capacitacion/" . $id_empresa . "_grafico_avance_curso_por_objeto.html");
    $html         = str_replace("{GRAFICO_AVANCE_CURSO_POR_OBJETOS}", $grafico, $html);
    $html         = str_replace("{TOTAL_PUNTOS_POR_OBJETOS}", $datos_puntos[0]->puntos_maximo, $html);
    $html         = str_replace("{NOMBRE_CURSO}", ($datos_puntos[0]->nombre_curso), $html);
    $html         = str_replace("{ID_CURSO}", $id_curso, $html);
    $html         = str_replace("{BRECHA_COMPLETADOS_VS_NOCOMPLETADOS}", $datos_puntos[0]->puntos_maximo - $datos_puntos[0]->suma_puntos_por_curso, $html);
    //if($datos_puntos[0]->suma_puntos_por_curso){
    //    $html = str_replace("{TOTAL_COMPLETADOS}",50,$html);
    //}else{
    //    $html = str_replace("{TOTAL_COMPLETADOS}",0,$html);
    //}
    $html         = str_replace("{TOTAL_COMPLETADOS}", $datos_puntos[0]->suma_puntos_por_curso, $html);
    $arreglo[0]   = $html;
    $arreglo[1]   = $datos_puntos[0]->suma_puntos_por_curso;
    return ($arreglo);
}
function RedimensionarImagenPerfil($rutaImagenOriginal, $nombre_imagen, $ext, $nombre_nuevo_archivo, $id_empresa)
{
    //Ruta de la imagen original
    //$rutaImagenOriginal="./imagen/i2.jpg";
    //Creamos una variable imagen a partir de la imagen original
    if ($ext == "gif") {
        $img_original = imagecreatefromgif($rutaImagenOriginal);
    } else if ($ext == "png") {
        $img_original = imagecreatefrompng($rutaImagenOriginal);
    } else {
        $img_original = imagecreatefromjpeg($rutaImagenOriginal);
    }
    //Se define el maximo ancho o alto que tendra la imagen final
    //$alto_orig=imagesy($img_original);
    //$ancho_orig=imagesx($img_original);
    $max_ancho = 250;
    $max_alto  = 250;
    //Ancho y alto de la imagen original
    list($ancho, $alto) = getimagesize($rutaImagenOriginal);
    //Se calcula ancho y alto de la imagen final
    $x_ratio = $max_ancho / $ancho;
    $y_ratio = $max_alto / $alto;
    //Si el ancho y el alto de la imagen no superan los maximos,
    //ancho final y alto final son los que tiene actualmente
    if (($ancho <= $max_ancho) && ($alto <= $max_alto)) { //Si ancho
        $ancho_final = $ancho;
        $alto_final  = $alto;
    }
    /*
     * si proporcion horizontal*alto mayor que el alto maximo,
     * alto final es alto por la proporcion horizontal
     * es decir, le quitamos al alto, la misma proporcion que
     * le quitamos al alto
     *
     */
    elseif (($x_ratio * $alto) < $max_alto) {
        $alto_final  = ceil($x_ratio * $alto);
        $ancho_final = $max_ancho;
    }
    /*
     * Igual que antes pero a la inversa
     */
    else {
        $ancho_final = ceil($y_ratio * $ancho);
        $alto_final  = $max_alto;
    }
    if ($ancho > $alto) {
        $alto_final  = $max_alto;
        $ancho_final = ceil($y_ratio * $ancho);
    } else if ($alto > $ancho) {
        $alto_final  = ceil($x_ratio * $alto);
        $ancho_final = $max_ancho;
    }
    //Creamos una imagen en blanco de tamaño $ancho_final  por $alto_final .
    $tmp = imagecreatetruecolor($ancho_final, $alto_final);
    //Copiamos $img_original sobre la imagen que acabamos de crear en blanco ($tmp)
    imagecopyresampled($tmp, $img_original, 0, 0, 0, 0, $ancho_final, $alto_final, $ancho, $alto);
    //Se destruye variable $img_original para liberar memoria
    imagedestroy($img_original);
    //Definimos la calidad de la imagen final
    $calidad = 95;
    //Se crea la imagen final en el directorio indicado
    //imagejpeg($tmp,"../front/img/noticias/thum/".$nombre_imagen,$calidad);
    if ($ext == "gif") {
        imagegif($tmp, "img/avatars/" . $id_empresa . "/thum_" . $nombre_nuevo_archivo);
    } else if ($ext == "png") {
        imagepng($tmp, "img/avatars/" . $id_empresa . "/thum_" . $nombre_nuevo_archivo);
    } else {
        imagejpeg($tmp, "img/avatars/" . $id_empresa . "/thum_" . $nombre_nuevo_archivo);
    }
    /* SI QUEREMOS MOSTRAR LA IMAGEN EN EL NAVEGADOR
     *
     * descomentamos las lineas 64 ( Header("Content-type: image/jpeg"); ) y 65 ( imagejpeg($tmp); )
     * y comentamos la linea 57 ( imagejpeg($tmp,"./imagen/retoque.jpg",$calidad); )
     */
    //Header("Content-type: image/jpeg");
    //imagejpeg($tmp);
}
function ColocaImagenVerificaAvatar($rut, $desde_admin)
{
    //Debo traer los datos del usuario, para ver si la foto esta con guion
    if ($_SESSION["id_empresa"] == 28) {
        $datos_usuario = UsuarioEnBasePersonas($rut);
        $numero_sap    = $datos_usuario[0]->codigo_sap;
        $rut           = $numero_sap;
        $rut_completo  = $numero_sap;
        if ($desde_admin == "admin") {
            $ruta              = "img/personas/28/" . $rut;
            $ruta_rut_completo = "img/personas/28/" . $rut_completo;
        } else {
            $ruta              = "img/personas/28/" . $rut;
            $ruta_rut_completo = "img/personas/28/" . $rut_completo;
        }
    } else {
        $datos_usuario = UsuarioEnBasePersonas($rut);
        $rut_completo  = $datos_usuario[0]->rut_completo;
        if ($desde_admin == "admin") {
            $ruta              = "../front/img/personas/" . $rut;
            $ruta_rut_completo = "../front/img/personas/" . $rut_completo;
        } else {
            $ruta              = "img/personas/" . $rut;
            $ruta_rut_completo = "img/personas/" . $rut_completo;
        }
    }
    if ($datos_usuario[0]->avatar) {
        if ($_SESSION["id_empresa"] == 59 or $_SESSION["id_empresa"] == 75 or $_SESSION["id_empresa"] == 22) {
            $imagen = $datos_usuario[0]->avatar;
            //    echo $imagen."<br><br>";
        } else {
            $imagen = "img/avatars/" . $_SESSION["id_empresa"] . "/" . $datos_usuario[0]->avatar;
        }
    } else {
        if (file_exists($ruta . ".jpg")) {
            $imagen = $ruta . ".jpg";
        } else if (file_exists($ruta . ".JPG")) {
            $imagen = $ruta . ".JPG";
        } else if (file_exists($ruta . ".gif")) {
            $imagen = $ruta . ".gif";
        } else if (file_exists($ruta_rut_completo . ".jpg")) {
            $imagen = $ruta_rut_completo . ".jpg";
        } else if (file_exists($ruta_rut_completo . ".JPG")) {
            $imagen = $ruta_rut_completo . ".JPG";
        } else if (file_exists($ruta_rut_completo . ".gif")) {
            $imagen = $ruta_rut_completo . ".gif";
        } else {
            $imagen = "img/sinfoto.png";
        }
    }
    return ($imagen);
}
function ColocaImagenesMedallas($total_medallas, $imagen_medalla)
{
    for ($tot = 1; $tot <= $total_medallas; $tot++) {
        $html_medallas .= "<img src='img/bci_elviaje_medalla.jpg'>";
    }
    return ($html_medallas);
}
function colocaImagenesPorObjeto($id_objeto, $rut, $id_empresa, $pagina, $id_malla, $cantidad_imagenes_galeria)
{
    //echo "$id_objeto, $id_empresa, $pagina, $id_malla)";
    $imagenes = FotosPorObjetoPorMalla($id_objeto, $id_empresa, $pagina, $id_malla, $cantidad_imagenes_galeria);
    $j        = 1;
    foreach ($imagenes as $img) {
        if ($j == 1) {
            $row_html .= "<div class='row'>";
        }
        $row_html .= file_get_contents("views/cursos/objetos/subirFotos/" . $id_empresa . "_lista_archivos.html");
        if ($j == 3) {
            $row_html .= "</div>";
            $j = 1;
        } else {
            $j++;
        }
        $figura   = '<a href="galeria/' . $img->archivo . '" title="' . $img->descripcion . '" onclick="vista_galeria(' . $img->id . ')"  data-gallery><img src="img/objetos/' . $img->archivo . '""></a>';
        $row_html = str_replace("{FIGURA}", $figura, $row_html);
        $row_html = str_replace("{URL_IMAGEN_ARCHIVO}", "img/objetos/" . $img->archivo . "", $row_html);
        $row_html = str_replace("{DESCRIPCION}", ($img->nombre_completo), $row_html);
        $row_html = str_replace("{COMENTARIO}", ($img->comentarios), $row_html);
        $row_html = str_replace("{URL_IMAGEN_PERSONA}", VerificaFotoPersonal($img->rut_autor), $row_html);
        if ($img->rut_autor == $rut) {
            $row_html = str_replace("{MEGUSTA}", ColocaMeGusta($img->id, "id_imagen_galeria", $id_empresa, $rut, "autor"), $row_html);
            $row_html = str_replace("{DELETE}", file_get_contents("views/cursos/objetos/subirFotos/" . $id_empresa . "_delete_imagen.html"), $row_html);
            $row_html = str_replace("{ID_IMAGEN_ENCODEADA}", Encodear3($img->id), $row_html);
        } else {
            $row_html = str_replace("{MEGUSTA}", ColocaMeGusta($img->id, "id_imagen_galeria", $id_empresa, $rut), $row_html);
            $row_html = str_replace("{DELETE}", "", $row_html);
        }
        $row_html = str_replace("{VISITAS}", 0, $row_html);
        if ($img->modalidad == 1) {
            $row_html = str_replace("{CATEGORIA}", "Mi Mam?", $row_html);
        } else if ($img->modalidad == 2) {
            $row_html = str_replace("{CATEGORIA}", "La Mam? de mis hijos", $row_html);
        } else if ($img->modalidad == 3) {
            $row_html = str_replace("{CATEGORIA}", "Yo como Mam?", $row_html);
        }
    }
    if ($j == 2 or $j == 3) {
        $row_html .= "</div>";
    }
    return ($row_html);
}
function ColocaBloqueRecienteForo($PRINCIPAL, $id_objeto)
{
    //obtengo comentarios dado id_objeto
    $total_comentarios = ObtenerComentariosDadoIdObjeto($id_objeto);
    if ($total_comentarios) {
        foreach ($total_comentarios as $come) {
            $row_html .= file_get_contents("views/cursos/objetos/foro/bloque_comentario_destacado.html");
            $row_html = str_replace("{NOMBRE_COMPLETO}", $come->nombre_completo, $row_html);
            $row_html = str_replace("{COMENTARIO}", $come->comentario, $row_html);
            $row_html = str_replace("{CANTIDAD_MEGUSTA}", $come->total_megusta, $row_html);
            $row_html = str_replace("{TIEMPO}", FechaTipoSpa($come->fecha . " " . $come->hora), $row_html);
            $row_html = str_replace("{URL_PERSONA}", VerificaFotoPersonal($come->rut), $row_html);
        }
        $PRINCIPAL = str_replace("{BLOQUE_DESTACADOS}", ($row_html), $PRINCIPAL);
    } else {
        $PRINCIPAL = str_replace("{BLOQUE_DESTACADOS}", "", $PRINCIPAL);
    }
    return ($PRINCIPAL);
}
function colocaBloqueHomeObjetos1($PRINCIPAL, $id_objeto, $limit)
{
    //obtengo comentarios dado id_objeto
    $total_comentarios = ObtenerComentariosDadoIdObjeto($id_objeto, "", $limit);
    if ($total_comentarios) {
        foreach ($total_comentarios as $come) {
            $row_html .= file_get_contents("views/cursos/objetos/foro/row_reciente.html");
            $row_html = str_replace("{NOMBRE_COMPLETO}", $come->nombre_completo, $row_html);
            $row_html = str_replace("{COMENTARIO}", $come->comentario, $row_html);
            $row_html = str_replace("{CANTIDAD_MEGUSTA}", $come->total_megusta, $row_html);
            $row_html = str_replace("{TIEMPO}", FechaTipoSpa($come->fecha . " " . $come->hora), $row_html);
            $row_html = str_replace("{URL_PERSONA}", VerificaFotoPersonal($come->rut), $row_html);
        }
        $PRINCIPAL = str_replace("{BLOQUE_DESTACADOS1}", ($row_html), $PRINCIPAL);
    } else {
        $PRINCIPAL = str_replace("{BLOQUE_DESTACADOS1}", "", $PRINCIPAL);
    }
    return ($PRINCIPAL);
}
function colocaBloqueHomeObjetos2($PRINCIPAL, $id_objeto, $limit)
{
    //obtengo comentarios dado id_objeto
    $total_comentarios = ObtenerComentariosDadoIdObjeto($id_objeto, "", $limit);
    if ($total_comentarios) {
        foreach ($total_comentarios as $come) {
            $row_html .= file_get_contents("views/cursos/objetos/foro/row_reciente.html");
            $row_html = str_replace("{NOMBRE_COMPLETO}", $come->nombre_completo, $row_html);
            $row_html = str_replace("{COMENTARIO}", $come->comentario, $row_html);
            $row_html = str_replace("{CANTIDAD_MEGUSTA}", $come->total_megusta, $row_html);
            $row_html = str_replace("{TIEMPO}", FechaTipoSpa($come->fecha . " " . $come->hora), $row_html);
            $row_html = str_replace("{URL_PERSONA}", VerificaFotoPersonal($come->rut), $row_html);
        }
        $PRINCIPAL = str_replace("{BLOQUE_DESTACADOS2}", ($row_html), $PRINCIPAL);
    } else {
        $PRINCIPAL = str_replace("{BLOQUE_DESTACADOS2}", "", $PRINCIPAL);
    }
    $PRINCIPAL = str_replace("{BLOQUE_DESTACADOS2}", "2222", $PRINCIPAL);
    return ($PRINCIPAL);
}
function ColocaMPEstadisticas($PRINCIPAL, $id_empresa)
{
    $total_estadisticas = MPEstadisticasporEstado($id_empresa);
    //print_r($total_estadisticas);
    foreach ($total_estadisticas as $total_estadistica) {
        $row_html .= file_get_contents("views/mejorespracticas/mp_row_estadisticas.html");
        $row_html = str_replace("{NUM}", $total_estadistica->cuenta, $row_html);
        $row_html = str_replace("{ITEM}", ($total_estadistica->estado), $row_html);
    }
    $PRINCIPAL = str_replace("{ESTADISTICAS_MP}", $row_html, $PRINCIPAL);
    return ($PRINCIPAL);
}
function GAMIFICACIONColocaEnvironmentBotonModulos($PRINCIPAL, $rut, $id_objetivo, $orden, $id_curso, $id_empresa)
{
    $datos_objeto_por_curso = GAMIFICACIONTraeDatosObjetosPorCurso($rut, $id_curso);
    if ($datos_objeto_por_curso[0]->total_objetos == $datos_objeto_por_curso[0]->total_objetos_finalizados) {
        $PRINCIPAL = str_replace("{ENVIRONMENT_AMBIENTE}", "FinNivel", $PRINCIPAL);
    } else {
        $PRINCIPAL = str_replace("{ENVIRONMENT_AMBIENTE}", "interPant", $PRINCIPAL);
    }
    return ($PRINCIPAL);
}
function ActualizoEstadoInscripcionCierre($id_curso, $rut, $id_empresa)
{
    //
    $datos                     = GAMIFICACIONTraeDatosObjetosPorCurso($rut, $id_curso);
    $total_objetos             = $datos[0]->total_objetos;
    $total_objetos_finalizados = $datos[0]->total_objetos_finalizados;
    $promedio_por_curso        = $datos[0]->promedio_por_curso;
   // print_r($datos);
    $porcentaje_Avance         = ColocaDecimalesNotasFinales(0, (($total_objetos_finalizados * 100) / $total_objetos), $tipo);
    if ($porcentaje_Avance == 100) {

            $estado = 1;

    } else if ($porcentaje_Avance >= 0 or $porcentaje_Avance < 100 and ($total_objetos <> $total_objetos_finalizados)) {
        //en proceso
        $estado = 3;
    }
    //ahora actualizo el porcentaje de avance de la tabla inscripcion cierre
    //ahora,
    $array_malla = BuscaMallaapartirRutCursoObjeto($id_curso, $rut, $id_empresa);
    //print_r($array_malla);
    GAMIFICACIONActualizarDatosCierre($id_curso, $rut, $id_empresa, $porcentaje_Avance, $estado, $promedio_por_curso);
}
function ActualizoEstadoInscripcionCierreObjeto($id_objeto, $id_curso, $rut, $id_empresa, $id_inscripcion)
{

    //echo "$id_objeto, $id_curso, $rut, $id_empresa, $id_inscripcion";
    //
    //echo "hola";
    $datos                     = GAMIFICACIONTraeDatosObjetosPorCurso($rut, $id_curso);
    $total_objetos             = $datos[0]->total_objetos;
    $total_objetos_finalizados = $datos[0]->total_objetos_finalizados;
    $promedio_por_curso        = $datos[0]->promedio_por_curso;
    $datos_objeto              = DatosObjeto($id_objeto);
       // print_r($datos_objeto);
    $porcentaje_Avance         = ColocaDecimalesNotasFinales(0, (($total_objetos_finalizados * 100) / $total_objetos), $tipo);
    if ($porcentaje_Avance == 100) {
        //finalizado
        /*if($id_empresa==61){
        if($promedio_por_curso<75){
        $estado=0;
        }else{
        $estado=1;
        }
        }else{
        */

        if ($datos_objeto[0]->nota_aprobacion <> '' and $promedio_por_curso < $datos_objeto[0]->nota_aprobacion and $datos_objeto[0]->cm <> "OPCIONAL") {
            //REPROBADO
            //$estado=0;
            $estado             = 1;
            $estado_descripcion = "REPROBADO";
        }else if(!$datos_objeto[0]->nota_aprobacion and $promedio_por_curso<100){
            $estado             = 1;
            $estado_descripcion = "REPROBADO";
        }


        else {
            //APROBADO
            $estado             = 1;
            $estado_descripcion = "APROBADO";
        }
        //}
    } else if ($porcentaje_Avance >= 0 or $porcentaje_Avance < 100 and ($total_objetos <> $total_objetos_finalizados)) {
        //en proceso
        $estado = 3;
    }
    //ahora actualizo el porcentaje de avance de la tabla inscripcion cierre
    //ahora,
    $array_malla = BuscaMallaapartirRutCursoObjeto($id_curso, $rut, $id_empresa);
    //print_r($array_malla);
    GAMIFICACIONActualizarDatosCierre($id_curso, $rut, $id_empresa, $porcentaje_Avance, $estado, $promedio_por_curso, $estado_descripcion,$id_inscripcion);
}




function ActualizoTipsGanados($id_objeto, $id_tip, $rut, $id_empresa)
{
    InsertUpdateTipsGanados($id_objeto, $id_tip, $rut, $id_empresa);
}
function GamificacionPuntos($rut, $id_empresa, $id_objeto, $id_curso, $malla, $puntos, $medallas)
{
    //Primero veo si tiene o no en la tabla de puntos
    $tiene_puntos_objeto = GAMIFICACIONTienePuntosPorCursoObjetoRutEmpresa($rut, $id_objeto, $id_curso, $id_empresa);
    if (!$tiene_puntos_objeto) {
        GAMIFICACIONInsertaPuntosPorObjeto($rut, $id_objeto, $id_curso, $id_empresa, $puntos, $medallas);
        $tiene_consolidado_puntos = GAMIFICACIONTienePuntosAcumuladosPorRutEmpresa($rut, $id_empresa);
        if ($tiene_consolidado_puntos) {
            $puntos_para_consolidado = $tiene_consolidado_puntos[0]->puntos + $puntos;
            GAMIFICACIONActualizarDatosConsolidados($rut, $id_empresa, $puntos_para_consolidado, $tiene_consolidado_puntos[0]->nivel, $medallas);
        } else {
            GAMIFICACIONInsertaPuntosAcumulados($rut, $id_empresa, $puntos_para_consolidado, $tiene_consolidado_puntos[0]->nivel, $medallas);
        }
    } else {
        $tiene_consolidado_puntos = GAMIFICACIONTienePuntosAcumuladosPorRutEmpresa($rut, $id_empresa);
        if ($tiene_consolidado_puntos) {
            $puntos_para_consolidado = $tiene_consolidado_puntos[0]->puntos;
            GAMIFICACIONActualizarDatosConsolidados($rut, $id_empresa, $puntos_para_consolidado, $tiene_consolidado_puntos[0]->nivel, $medallas);
        } else {
            GAMIFICACIONInsertaPuntosAcumulados($rut, $id_empresa, $puntos_para_consolidado, $tiene_consolidado_puntos[0]->nivel, $medallas);
        }
    }
    //veo si tiene puntos consolidados
}
function ColocaBloqueDeComentariosFinalesEvaluado($PRINCIPAL, $evaluado, $evaluador, $id_proceso)
{
    $esta_validado_el_evaluado = VerificaSiObjetivosEstanValidadosDadoEvaluadorIdProcesoEvaluado($evaluador, $id_proceso, $evaluado);
    if ($esta_validado_el_evaluado) {
        $html = file_get_contents("views/sgd/objetivos/preguntas_finales_evaluado_evaluado.html");
    } else {
        $finalizado_evaluado = TienePReguntasFinalesEvaluado($evaluado);
        if ($finalizado_evaluado) {
            $html = file_get_contents("views/sgd/objetivos/preguntas_finales_evaluado_lectura.html");
            $html = str_replace("{CORP}", $finalizado_evaluado[0]->conocimiento_corporativo, $html);
            $html = str_replace("{AREA}", $finalizado_evaluado[0]->conocimiento_area, $html);
            $html = str_replace("{INDIVIDUAL}", $finalizado_evaluado[0]->conocimiento_objetivos_individual, $html);
            $html = str_replace("{COMPETENCIAS}", $finalizado_evaluado[0]->conocimiento_competencias, $html);
            $html = str_replace("{TUVE_FEEDBACK}", $finalizado_evaluado[0]->tuve_reunion, $html);
            $html = str_replace("{COMENTARIO}", $finalizado_evaluado[0]->comentarios, $html);
        } else {
            $html = file_get_contents("views/sgd/objetivos/preguntas_finales_evaluado.html");
        }
    }
    $PRINCIPAL = str_replace("{BLOQUE_VALIDACION_EVALUADO}", $html, $PRINCIPAL);
    return ($PRINCIPAL);
}
function ColocarRankingPorCamposPorPuntos($PRINCIPAL, $id_empresa, $rut)
{
    $datos_empresa          = DatosEmpresa($id_empresa);
    //Campo1
    $datos_usuario_campo123 = UsuarioEnBaseDePersonasInnerEmpresa($rut);
    $datos                  = GAMIFICACION_TodosLosConsolidadosPorCampoEmpresa($id_empresa, $datos_empresa[0]->campo1);
    if ($datos) {
        $i     = 1;
        $total = file_get_contents("views/cursos/capacitacion/" . $id_empresa . "_row_ranking_grupal_titulo.html");
        $total = str_replace("{NOMBRE_CRITERIO}", $datos_empresa[0]->campo1, $total);
        foreach ($datos as $uni) {
            $total .= file_get_contents("views/cursos/capacitacion/" . $id_empresa . "_row_ranking_grupal.html");
            $total = str_replace("{RANK}", $i, $total);
            if ($datos_usuario_campo123[0]->{$datos_usuario_campo123[0]->campo1} == $uni->valor_campo) {
                $total = str_replace("{CLASE_COMOVOY}", "lms_miranking", $total);
            } else {
                $total = str_replace("{CLASE_COMOVOY}", "", $total);
            }
            $total = str_replace("{NOMBRE}", $uni->valor_campo, $total);
            $total = str_replace("{PUNTOS}", $uni->suma_puntos, $total);
            $total = str_replace("{MEDALLAS}", $uni->suma_medallas, $total);
            $i++;
        }
    }
    $datos = GAMIFICACION_TodosLosConsolidadosPorCampoEmpresa($id_empresa, $datos_empresa[0]->campo2);
    if ($datos) {
        $i = 1;
        $total .= file_get_contents("views/cursos/capacitacion/" . $id_empresa . "_row_ranking_grupal_titulo.html");
        $total = str_replace("{NOMBRE_CRITERIO}", $datos_empresa[0]->campo2, $total);
        foreach ($datos as $uni) {
            $total .= file_get_contents("views/cursos/capacitacion/" . $id_empresa . "_row_ranking_grupal.html");
            $total = str_replace("{RANK}", $i, $total);
            if ($datos_usuario_campo123[0]->{$datos_usuario_campo123[0]->campo2} == $uni->valor_campo) {
                $total = str_replace("{CLASE_COMOVOY}", "lms_miranking", $total);
            } else {
                $total = str_replace("{CLASE_COMOVOY}", "", $total);
            }
            $total = str_replace("{NOMBRE}", $uni->valor_campo, $total);
            $total = str_replace("{PUNTOS}", $uni->suma_puntos, $total);
            $total = str_replace("{MEDALLAS}", $uni->suma_medallas, $total);
            $i++;
        }
    }
    $datos = GAMIFICACION_TodosLosConsolidadosPorCampoEmpresa($id_empresa, $datos_empresa[0]->campo3);
    if ($datos) {
        $i = 1;
        $total .= file_get_contents("views/cursos/capacitacion/" . $id_empresa . "_row_ranking_grupal_titulo.html");
        $total = str_replace("{NOMBRE_CRITERIO}", $datos_empresa[0]->campo3, $total);
        foreach ($datos as $uni) {
            $total .= file_get_contents("views/cursos/capacitacion/" . $id_empresa . "_row_ranking_grupal.html");
            $total = str_replace("{RANK}", $i, $total);
            if ($datos_usuario_campo123[0]->{$datos_usuario_campo123[0]->campo3} == $uni->valor_campo) {
                $total = str_replace("{CLASE_COMOVOY}", "lms_miranking", $total);
            } else {
                $total = str_replace("{CLASE_COMOVOY}", "", $total);
            }
            $total = str_replace("{NOMBRE}", $uni->valor_campo, $total);
            $total = str_replace("{PUNTOS}", $uni->suma_puntos, $total);
            $total = str_replace("{MEDALLAS}", $uni->suma_medallas, $total);
            $i++;
        }
    }
    $PRINCIPAL = str_replace("{ROW_RANKING}", ($total), $PRINCIPAL);
    return ($PRINCIPAL);
}
function OBJETIVOS_AvanceEvaluador($rut_evaluador, $id_proceso, $id_empresa)
{
    $total_evaluados             = TraeRelacionesSinAeConDatos($rut_evaluador, $id_proceso);
    //Ahora traigo el total de evaluados finalizados en la tabla objetivos_individuales_finalizados
    $total_evaluados_finalizados = VerificoEvaluadosFinalizadosPorEvaluador($rut_evaluador, $id_proceso, $id_empresa);
    //echo count($total_evaluados)."<br>".count($total_evaluados_finalizados);
    if (count($total_evaluados) == count($total_evaluados_finalizados)) {
        $arreglo[0] = 1;
        $arreglo[1] = "Finalizados";
    } else {
        $arreglo[0] = 0;
        $arreglo[1] = "Pendientes";
    }
    return ($arreglo);
}
function ColocarRankingUsuariosPorPuntos($PRINCIPAL, $id_empresa, $id_malla)
{
    //echo "$id_empresa, $id_malla";
    //$total_usuarios=GAMIFICACION_TodosLosConsolidados($id_empresa);
    $total_usuarios = GAMIFICACION_TodosLosConsolidados($id_empresa, $id_malla);
    $i              = 1;
    //print_r($total_usuarios);
    foreach ($total_usuarios as $usu) {
        $total .= file_get_contents("views/cursos/capacitacion/" . $id_empresa . "_row_ranking_individual.html");
        $total = str_replace("{BLOQUE_DATOS_PERSONALES_VE}", file_get_contents("views/cursos/capacitacion/" . $id_empresa . "_ve_perfil_bloque_datos.html"), $total);
        $total = str_replace("{RANK}", $i, $total);
        $total = str_replace("{NOMBRE_COMPLETO}", $usu->nombre_completo, $total);
        $total = str_replace("{CARGO}", $usu->cargo, $total);
        $total = str_replace("{PUNTOS}", $usu->puntos, $total);
        $total = str_replace("{PUNTOS_CONSOLIDADOS}", $usu->puntosconsolidados, $total);
        $total = str_replace("{medallas}", $usu->medallas, $total);
        //$total = str_replace("{URL_PERSONA}",VerificaFotoPersonal($usu->rut),$total);
        if ($_SESSION["user_"] == $usu->rut) {
            $total = str_replace("{CLASE_COMOVOY}", "lms_miranking", $total);
        } else {
            $total = str_replace("{CLASE_COMOVOY}", "", $total);
        }
        $total                   = str_replace("{URL_PERSONA}", ColocaImagenVerificaAvatar($usu->rut), $total);
        $total                   = str_replace("{RUT_ENCODEADO}", Encodear3($usu->rut), $total);
        $total                   = str_replace("{RUT}", ($usu->rut), $total);
        $total_imagenes_medallas = ColocaImagenesMedallas($usu->medallas, $imagen_medalla);
        $total                   = str_replace("{IMAGENMEDALLAS_USUARIOS}", $total_imagenes_medallas, $total);
        $total                   = str_replace("{CAMPO1}", ($usu->campo1), $total);
        $total                   = str_replace("{CAMPO2}", ($usu->campo2), $total);
        $total                   = str_replace("{CAMPO3}", ($usu->campo3), $total);
        $i++;
    }
    $PRINCIPAL = str_replace("{ROW_RANKING}", ($total), $PRINCIPAL);
    return ($PRINCIPAL);
}
function ColocarBLOQUEDATOSUsuarios($PRINCIPAL, $id_empresa, $rut)
{
    $total                   = str_replace("{BLOQUE_DATOS_PERSONALES}", file_get_contents("views/cursos/capacitacion/" . $id_empresa . "_mi_perfil_bloque_datos.html"), $total);
    $total                   = str_replace("{RANK}", $i, $total);
    $total                   = str_replace("{NOMBRE_COMPLETO}", $usu->nombre_completo, $total);
    $total                   = str_replace("{CARGO}", $usu->cargo, $total);
    $total                   = str_replace("{PUNTOS_CONSOLIDADOS}", $usu->puntosconsolidados, $total);
    $total                   = str_replace("{medallas}", $usu->medallas, $total);
    $total                   = str_replace("{URL_PERSONA}", ColocaImagenVerificaAvatar($usu->rut), $total);
    $total                   = str_replace("{RUT_ENCODEADO}", Encodear3($usu->rut), $total);
    $total                   = str_replace("{RUT}", ($usu->rut), $total);
    $total_imagenes_medallas = ColocaImagenesMedallas($usu->medallas, $imagen_medalla);
    $total                   = str_replace("{IMAGENMEDALLAS_USUARIOS}", $total_imagenes_medallas, $total);
    $total                   = str_replace("{CAMPO1}", ($usu->campo1), $total);
    $total                   = str_replace("{CAMPO2}", ($usu->campo2), $total);
    $total                   = str_replace("{CAMPO3}", ($usu->campo3), $total);
    $total                   = str_replace("{NOMBRE_COMPLETO}", "hol", $total);
    print_r($total);
    return ($total);
}
function GAMIFICACION_ActualizaNivel($id_malla, $id_empresa, $rut)
{
    $datos_nivel = GAMIFICACION_ObtenerNivelesPorMallaEmpresa($id_malla, $id_empresa);
    //ahora que tengo los datos, hago un ciclo, para ver si cada curs esta o no finalizado
    foreach ($datos_nivel as $unico) {
        $estado_por_curso = CAPACITACION_ObtenerEstadoAvanceCurso($rut, $unico->idcurso, "", $id_empresa);
        $curso_finalizado = VErificaCursoFinalizado($unico->idcurso, $rut);
        if ($curso_finalizado)
            continue;
        if ($estado_por_curso[4] == 0) {
            //Verifico si la cantidad de modulos del curso=nivel es igual a los modulos finalizados de este curso=nivel
            $datos_objeto_por_curso = GAMIFICACIONTraeDatosObjetosPorCurso($rut, $id_curso);
            $detalle_nivel          = GAMIFICACION_ObtenerDescripcionNivelesPorIdEmpresa($unico->idnivel, $id_empresa);
            //veo si tiene acumulado los puntos
            $tiene_puntos           = GAMIFICACIONTienePuntosAcumuladosPorRutEmpresa($rut, $id_empresa);
            if ($tiene_puntos) {
                GAMIFICACIONActualizarDatosConsolidados($rut, $id_empresa, $tiene_puntos[0]->puntos, $unico->idnivel, $tiene_puntos[0]->medallas + $unico->medallas);
            } else {
                GAMIFICACIONInsertaPuntosAcumulados($rut, $id_empresa, 0, $unico->idnivel, 0);
            }
            break;
        }
    }
}
function MuestraContenidoCap($PRINCIPAL, $id_objeto, $rut, $pagina, $tipo_template, $id_malla, $rut_colaborador_desde_vista_jefe)
{
    //echo "<br>$id_objeto, $rut, $pagina, $tipo_template, $id_malla, $rut_colaborador_desde_vista_jefe";
    $datos_usuario = UsuarioEnBasePersonas($rut);
    $id_empresa    = $_SESSION["id_empresa"];
    $PRINCIPAL     = str_replace("{NOMBRE_USUARIO}", ($datos_usuario[0]->nombre_completo), $PRINCIPAL);
    $datos_objeto  = DatosObjeto($id_objeto);
    if ($datos_objeto[0]->id == "bci_v2017_cm5") {
        $finalizado = ObjetoFinalizadoDadoIdYRut($rut, $datos_objeto[0]->id);
        if ($finalizado) {
            echo "<script>alert('Ya finalizaste el Juego');</script>";
            echo "<script>window.history.back();</script>";
            //exit;
        }
    }
    //print_r($datos_objeto);
    $PRINCIPAL = str_replace("{URL_VOLVER_CHECKIN}", ($datos_objeto[0]->url_volver_checkin), $PRINCIPAL);
    if ($_SESSION["id_curso"]) {
        $PRINCIPAL = str_replace("{ID_CURSO_ENCODEADO}", Encodear3($_SESSION["id_curso"]), $PRINCIPAL);
    }
    $objeto_tiene_puntos = GAMIFICACIONTienePuntosPorCursoObjetoRutEmpresa($rut, $id_objeto, $datos_objeto[0]->id_curso, $_SESSION["id_empresa"]);
    $datos_curso         = DetalleCurso($datos_objeto[0]->id_curso);
    $datos_malla         = GAMIFICACIONObtengoDatosMallaCursoDadoRutEmpresa($rut, $_SESSION["id_empresa"]);
    $datos_usuario_malla = ObtenerDatosRelMallaUsuarioDadoRut($rut, $_SESSION["id_empresa"]);
    $objeto_finalizado   = VerObjetoFinalizado($id_objeto, $rut);
    if ($id_malla) {
        $datos_empresa = DatosEmpresa($_SESSION["id_empresa"]);
        //$PRINCIPAL = str_replace("{BLOQUE_OBJETO}",file_get_contents("views/cursos/objetos/foro_cat/formulario_completo.html"),$PRINCIPAL);
        $PRINCIPAL     = ColocaBloqueComparte($PRINCIPAL, $_SESSION["id_empresa"], $id_malla, $rut, "todo");
        $PRINCIPAL     = str_replace("{ENV_HOME}", $datos_empresa[0]->case_home, $PRINCIPAL);
        //$PRINCIPAL = str_replace("{ID_MALLA_ENCODEADA}",$id_malla,$PRINCIPAL);
    }
    if ($datos_objeto[0]->extension_objeto) {
        //Esto quiere decir que tiene algun tipo de extension el objeto
        $datos_extension = DatosExtensionDeObjeto($datos_objeto[0]->extension_objeto);
        $deviceipad      = strtolower($_SERVER[""]);
        $deviceipod      = strtolower($_SERVER[""]);
        if ($datos_objeto[0]->id_template) {
            if (file_exists("views/pagina/" . $datos_malla[0]->id_malla . "_" . ($datos_objeto[0]->template_para_entorno))) {
                $template_objeto = "views/pagina/" . $datos_malla[0]->id_malla . "_" . ($datos_objeto[0]->template_para_entorno);
            } else {
                if ($tipo_template == 11) {
                    ;
                    $template_objeto = "views/pagina/" . ($datos_extension[0]->template_lectura);
                } else {
                    $template_objeto = "views/pagina/" . ($datos_objeto[0]->template_para_entorno);
                }
            }
        } else {
            if ($tipo_template == 1) {
                $template_objeto = ($datos_extension[0]->template_lectura);
            } else {
                //checkin
                if ($datos_objeto[0]->checkin == 1 or $_GET["checkin"] == 1) {
                    $template_objeto = ($datos_extension[0]->template_check);
                    //echo "1";
                } else {
                    if ($datos_objeto[0]->extension_objeto == 21 or $datos_objeto[0]->extension_objeto == 20) {
                        //echo "2";
                        $esta_finalizado = TieneAccionesPEndientes($rut, $_SESSION["id_empresa"], $datos_objeto[0]->id_curso, $id_objeto);
                        if ($esta_finalizado) {
                            //echo "3";
                            $template_objeto = ($datos_extension[0]->template_lectura);
                        } else {
                            //echo "4";
                            $template_objeto = ($datos_extension[0]->template);
                        }
                    } else {
                        if ($objeto_finalizado) {
                            //echo "5";
                            //$template_objeto=($datos_extension[0]->template);
                            $datos_desafio = TraeDatosDesafioDadoId($datos_objeto[0]->id_desafio);
                            //if($datos_desafio[0]->modificable=="si"){
                            if ($_GET["edidesa"] == 1) {
                                if ($datos_desafio[0]->id_objeto) {
                                    //echo "<br>5.1";
                                    $template_objeto = "views/cursos/objetos/desafio/index_" . $datos_desafio[0]->id_objeto . ".html";
                                } else {
                                    //echo "<br>5.2";
                                    $template_objeto = ($datos_extension[0]->template);
                                }
                            } else {
                                $datos_desafio = TraeDatosDesafioDadoId($datos_objeto[0]->id_desafio);
                                if ($datos_desafio[0]->id_objeto) {
                                    //echo "<br>5.3";
                                    $template_objeto = "views/cursos/objetos/desafio/index_lectura_" . $datos_desafio[0]->id_objeto . ".html";
                                } else {
                                    //echo "<br>5.4";
                                    $template_objeto = ($datos_extension[0]->template_lectura);
                                }
                            }
                        } else {
                            //echo "6";
                            //Si es desafio, veo si tiene un template distinto
                            $datos_desafio = TraeDatosDesafioDadoId($datos_objeto[0]->id_desafio);
                            if ($datos_desafio[0]->id_objeto) {
                                $template_objeto = "views/cursos/objetos/desafio/index_" . $datos_desafio[0]->id_objeto . ".html";
                            } else {
                                //echo "cursos/objetos/desafio/".$id_empresa."_".$datos_extension[0]->template;exit;
                                //echo $datos_extension[0]->template;exit;
                                if(file_exists("cursos/objetos/desafio/".$id_empresa."_".$datos_extension[0]->template)){
                                        $template_objeto = $id_empresa."_".$datos_extension[0]->template;
                                }else{
                                    $template_objeto = ($datos_extension[0]->template);
                                }

                            }
                        }
                    }
                }
            }
        }

        //echo $datos_extension[0]->template;
        //echo $template_objeto;
        //exit;
        //$PRINCIPAL = str_replace("{BLOQUE_OBJETO}",file_get_contents($template_objeto),$PRINCIPAL);
        if ($datos_objeto[0]->extension_objeto == 150) {
            $PRINCIPAL = str_replace("{BLOQUE_OBJETO}", '<iframe class="embed-responsive-item" width="100%"  src="' . $datos_objeto[0]->url_objeto . '"></iframe>', $PRINCIPAL);
        } else {
            $PRINCIPAL = str_replace("{BLOQUE_OBJETO}", file_get_contents($template_objeto), $PRINCIPAL);
        }
        $PRINCIPAL           = str_replace("{URL_OBJETO}", $datos_extension[0]->template, $PRINCIPAL);
        //$PRINCIPAL = str_replace("{BLOQUE_OBJETO}",$template_objeto,$PRINCIPAL);
        $PRINCIPAL           = str_replace("{NOMBRE_DOCUMENTO}", $datos_objeto[0]->url_objeto, $PRINCIPAL);
        $PRINCIPAL           = str_replace("{NOMBRE_VIDEO_MP4}", $datos_objeto[0]->url_objeto, $PRINCIPAL);
        //echo Encodear($datos_objeto[0]->url_objeto);
        //$PRINCIPAL = str_replace("{NOMBRE_VIDEO_MP4_ENCODEADA}",Encodear3($datos_objeto[0]->url_objeto),$PRINCIPAL);
        $token_fecha_hora    = Encodear(date("Y-m-d") . "" . date("H:i:s") . "-" . $rut);
        $_SESSION["veVideo"] = $token_fecha_hora;
        $PRINCIPAL           = str_replace("{URL_OBJETO_LINK}", $datos_objeto[0]->url_objeto, $PRINCIPAL);
        $PRINCIPAL           = str_replace("{EXTENSION_OBJETO}", $datos_objeto[0]->duracion_video, $PRINCIPAL);
        $PRINCIPAL           = str_replace("{SESION_VIDEO_ENCODEADO}", $token_fecha_hora, $PRINCIPAL);
        if ($datos_objeto[0]->id_desafio) {
            if ($rut_colaborador_desde_vista_jefe) {
                $PRINCIPAL = str_replace("{ROW_PREGUNTAS}", ColocaPreguntasorDesafio($datos_objeto[0]->id_desafio, $rut_colaborador_desde_vista_jefe, $id_objeto, $datos_objeto[0]->id_curso, $datos_objeto[0]->id_desafio, $_SESSION["id_empresa"]), $PRINCIPAL);
            } else {
                $PRINCIPAL = str_replace("{ROW_PREGUNTAS}", ColocaPreguntasorDesafio($datos_objeto[0]->id_desafio, $rut, $id_objeto, $datos_objeto[0]->id_curso, $datos_objeto[0]->id_desafio, $_SESSION["id_empresa"]), $PRINCIPAL);
            }
            $PRINCIPAL        = str_replace("{ROW_BLOQUE_TEXTOS}", ColocaBloqueTextoDesafio($datos_objeto[0]->id_desafio, $rut, $id_objeto, $datos_objeto[0]->id_curso, $datos_objeto[0]->id_desafio, $_SESSION["id_empresa"]), $PRINCIPAL);
            $PRINCIPAL        = str_replace("{ID_DESAFIO_ENCODEADO}", Encodear3($datos_objeto[0]->id_desafio), $PRINCIPAL);
            $tiene_respuestas = VerificoDesafioPorObjeto($rut, $id_objeto, $datos_objeto[0]->id_curso, $_SESSION["id_empresa"], $datos_objeto[0]->id_desafio);
            if ($tiene_respuestas) {
                //$PRINCIPAL = str_replace("{STYLO_MUESTRA_BOTON1}",'style="display:none;"',$PRINCIPAL);
                if ($_GET["edidesa"] == 1) {
                    $PRINCIPAL = str_replace("{STYLO_MUESTRA_BOTON2_DESAFIOS}", 'style="display:none;"', $PRINCIPAL);
                } else {
                    $PRINCIPAL = str_replace("{STYLO_MUESTRA_BOTON2_DESAFIOS}", "", $PRINCIPAL);
                }
                $PRINCIPAL = str_replace("{STYLO_MUESTRA_BOTON1_DESAFIOS}", '', $PRINCIPAL);
            } else {
                $PRINCIPAL = str_replace("{STYLO_MUESTRA_BOTON1_DESAFIOS}", "", $PRINCIPAL);
                $PRINCIPAL = str_replace("{STYLO_MUESTRA_BOTON2_DESAFIOS}", 'style="display:none;"', $PRINCIPAL);
            }
            $datos_desafio = TraeDatosDesafioDadoId($datos_objeto[0]->id_desafio);
            $PRINCIPAL     = str_replace("{titulo_principal_desafio}", ($datos_desafio[0]->titulo_principal_desafio), $PRINCIPAL);
            $PRINCIPAL     = str_replace("{bajada_principal_desafio}", ($datos_desafio[0]->bajada_principal_desafio), $PRINCIPAL);
        }
        //PARA SESSIONS
        $PRINCIPAL = str_replace("{TITULO}", ($datos_objeto[0]->titulo), $PRINCIPAL);
        $PRINCIPAL = str_replace("{TEXTO_BAJADA}", ($datos_objeto[0]->texto_bajada), $PRINCIPAL);
        $PRINCIPAL = str_replace("{BAJADA}", ($datos_objeto[0]->bajada), $PRINCIPAL);
        $PRINCIPAL = str_replace("{URL_VIDEO}", ($datos_objeto[0]->video), $PRINCIPAL);
        $PRINCIPAL = str_replace("{PDF}", ($datos_objeto[0]->archivo), $PRINCIPAL);
        $PRINCIPAL = str_replace("{TRANSCRIPCION}", ($datos_objeto[0]->transcripcion), $PRINCIPAL);
        $PRINCIPAL = str_replace("{titulo_principal}", ($datos_objeto[0]->titulo_principal), $PRINCIPAL);
        $PRINCIPAL = str_replace("{pregunta_principal}", ($datos_objeto[0]->pregunta_principal), $PRINCIPAL);
        $PRINCIPAL = str_replace("{bajada_principal}", ($datos_objeto[0]->bajada_principal), $PRINCIPAL);
        $PRINCIPAL = str_replace("{titulo_secundario}", ($datos_objeto[0]->titulo_secundario), $PRINCIPAL);
        $PRINCIPAL = str_replace("{bajada_secundario}", ($datos_objeto[0]->bajada_secundario), $PRINCIPAL);
        $PRINCIPAL = str_replace("{subtitulo_principal}", ($datos_objeto[0]->subtitulo_principal), $PRINCIPAL);
        $PRINCIPAL = str_replace("{bajada_subtitulo_principal}", ($datos_objeto[0]->bajada_subtitulo_principal), $PRINCIPAL);
        if ($datos_objeto[0]->rut_relator) {
            $PRINCIPAL = str_replace("{BLOQUE_RELATOR}", file_get_contents("views/cursos/contenidos/bloque_relator_con_link.html"), $PRINCIPAL);
            $PRINCIPAL = str_replace("{RUT_RELATOR_ENCODEADO}", Encodear3($datos_objeto[0]->rut_relator), $PRINCIPAL);
        } else {
            $PRINCIPAL = str_replace("{BLOQUE_RELATOR}", file_get_contents("views/cursos/contenidos/bloque_relator_sin_link.html"), $PRINCIPAL);
        }
        $PRINCIPAL = str_replace("{BIO_RELATOR}", ($datos_objeto[0]->bio_relator), $PRINCIPAL);
        $PRINCIPAL = str_replace("{URL_IMAGEN_RELATOR}", ($datos_objeto[0]->foto_relator), $PRINCIPAL);
        $PRINCIPAL = str_replace("{URL_MIPERFIL}", VerificaFotoPersonal($rut), $PRINCIPAL);
        //Bloque con textos
        $PRINCIPAL = str_replace("{RESUMEN_EJECUTIVO}", ColocaBloqueTextosPorObjeto($datos_objeto[0]->id), $PRINCIPAL);
        //Bloque con citas
        $PRINCIPAL = str_replace("{ENTORNO_CITA}", ColocaBloqueCitasPorObjeto($datos_objeto[0]->id), $PRINCIPAL);
        //BLOQUE MP3
        $PRINCIPAL = str_replace("{ENTORNO_DOCUMENTOS}", ColocaBloqueDocumentosPorObjeto($datos_objeto[0]->id), $PRINCIPAL);
        //Bloque Biograf?a Profesional
        if ($rut_colaborador_desde_vista_jefe) {
            $PRINCIPAL = ColocaDatosBiografiaProfesional($datos_objeto[0]->id, $rut_colaborador_desde_vista_jefe, $PRINCIPAL);
        } else {
            $PRINCIPAL = ColocaDatosBiografiaProfesional($datos_objeto[0]->id, $rut, $PRINCIPAL);
        }
        //Bloque para Documentos
        $PRINCIPAL                             = str_replace("{ENTORNO_MP3}", ColocaBloqueMP3PorObjeto($datos_objeto[0]->id), $PRINCIPAL);
        //Bloque para Pregunta
        $PRINCIPAL                             = str_replace("{ENTORNO_PREGUNTA}", ColocaBloquePreguntaPorObjeto($datos_objeto[0]->id, $rut, 1), $PRINCIPAL);
        $PRINCIPAL                             = str_replace("{ENTORNO_PREGUNTA_UNICA_POR_OBJETO}", ColocaBloquePreguntaPorObjetoUnicaRadio($datos_objeto[0]->id, $rut, 1), $PRINCIPAL);
        //Bloque para Comentarios - Post
        $PRINCIPAL                             = str_replace("{LISTADO_COMENTARIOS}", ColocaBloqueComentariosPorObjeto($datos_objeto[0]->id, $rut), $PRINCIPAL);
        $PRINCIPAL                             = str_replace("{GALERIA_VIDEOS_USUARIOS_}", colocaVideosPorObjeto($datos_objeto[0]->id, $rut, $_SESSION["id_empresa"], $pagina, $datos_malla[0]->id_malla), $PRINCIPAL);
        //Bloque para Compromisos
        $PRINCIPAL                             = str_replace("{LISTADO_COMPROMISOS_POR_OBJETO}", ColocaCompromisosPorObjeto($datos_objeto[0]->id, $rut), $PRINCIPAL);
        //Bloque para Comentarios - Con Reply
        $PRINCIPAL                             = str_replace("{LISTADO_COMENTARIOS_CON_REPLY}", ColocaBloqueComentariosPorObjetoConReplay($datos_objeto[0]->id, $rut, $rut_colaborador_desde_vista_jefe), $PRINCIPAL);
        //Verifico si el colaborador, esta finalizado con su desafio, si es asi, no muestro los botones
        $esta_finalizado_por_agente_el_desafio = EstaFinalizadoDesafio($rut_colaborador_desde_vista_jefe, $datos_objeto[0]->id, $datos_objeto[0]->id_curso, $_SESSION["id_empresa"]);
        if ($esta_finalizado_por_agente_el_desafio) {
            $PRINCIPAL = str_replace("{BOTON_VALIDA}", file_get_contents("views/cursos/objetos/desafio/boton_validado_desafio.html"), $PRINCIPAL);
        } else {
            $PRINCIPAL = str_replace("{BOTON_VALIDA}", file_get_contents("views/cursos/objetos/desafio/boton_valida_desafio_final.html"), $PRINCIPAL);
        }
        $estavalidado_vistacolaborador = EstaFinalizadoDesafio($rut, $datos_objeto[0]->id, $datos_objeto[0]->id_curso, $_SESSION["id_empresa"]);
        if ($estavalidado_vistacolaborador) {
            $PRINCIPAL = str_replace("{BOTON_MODIFICAR_VISTA_COLABORADOR}", file_get_contents("views/cursos/objetos/desafio/boton_validado_desafio.html"), $PRINCIPAL);
        } else {
            $PRINCIPAL = str_replace("{BOTON_MODIFICAR_VISTA_COLABORADOR}", file_get_contents("views/cursos/objetos/desafio/boton_modifica_desafio.html"), $PRINCIPAL);
        }
        //Bloque para Comentarios - Con Reply Por USUARIO
        //$PRINCIPAL = str_replace("{LISTADO_COMENTARIOS_CON_REPLY}",ColocaBloqueComentariosPorObjetoConReplayPorUsuario($datos_objeto[0]->id, $rut, $rut_colaborador_desde_vista_jefe), $PRINCIPAL);
        //Bloque para Pregunta 2
        $PRINCIPAL = str_replace("{ENTORNO_PREGUNTA_2}", ColocaBloquePreguntaPorObjeto($datos_objeto[0]->id, $rut, 2), $PRINCIPAL);
        //Coloca datos de la linea de tiempo del Desafio
        $PRINCIPAL = str_replace("{FECHA_CREACION_DESAFIO}", ColocaFechaCreacionDesafio($datos_objeto[0]->id, $rut, $rut_colaborador_desde_vista_jefe), $PRINCIPAL);
        $PRINCIPAL = str_replace("{GALERIA_FOTOS_USUARIOS_}", colocaImagenesPorObjeto($datos_objeto[0]->id, $rut, $_SESSION["id_empresa"], $pagina, $datos_usuario_malla[0]->id_malla, 12), $PRINCIPAL);
        $PRINCIPAL = str_replace("{GALERIA_FOTOS_USUARIOS_DESDE_MULTIMEDIA}", colocaImagenesPorObjeto($datos_objeto[0]->id, $rut, $_SESSION["id_empresa"], $pagina, $datos_usuario_malla[0]->id_malla, 12), $PRINCIPAL);
        $PRINCIPAL = str_replace("{PAGINACION_GALERIA_IMAGENES}", ColocaPaginacionDeImagenes($pagina, $datos_objeto[0]->id, $rut, $datos_malla[0]->id_malla), $PRINCIPAL);
        //Bloque para Listado de preguntas creadas por el relator. CHECKIN
        $PRINCIPAL = str_replace("{LISTADO_PREGUNTAS_POR_EVAL}", ColocaPReguntasPorEval($datos_objeto[0]->id), $PRINCIPAL);
        //Bloque para olocar datos de las Acciones Pendientes
        if ($rut_colaborador_desde_vista_jefe) {
            $PRINCIPAL = ColocaDatosAccionesClaves($datos_objeto[0]->id, $datos_objeto[0]->id_curso, $_SESSION["id_empresa"], $rut_colaborador_desde_vista_jefe, $PRINCIPAL);
        } else {
            $PRINCIPAL = ColocaDatosAccionesClaves($datos_objeto[0]->id, $datos_objeto[0]->id_curso, $_SESSION["id_empresa"], $rut, $PRINCIPAL);
        }
        //Arma paginacion para GALERIA DE IMAGENES
    } else if ($datos_objeto[0]->id_encuesta) {
        echo "encuesta";
    } else {
        $PRINCIPAL = str_replace("{BLOQUE_OBJETO}", file_get_contents("views/cursos/contenidos/bloque_iframe.html"), $PRINCIPAL);
        $PRINCIPAL = str_replace("{URL_OBJETO}", $datos_objeto[0]->url, $PRINCIPAL);
        $PRINCIPAL = str_replace("{EXTENSION_OBJETO}", $datos_objeto[0]->duracion_video, $PRINCIPAL);
    }
    //Dado la extension del objeto, traigo el template a utilizar por el tipo de objeto.
    //DESCARGABLES
    if ($datos_objeto[0]->transcripcion <> '') {
        $descargable = "
    <div class='subtituloSeccionMiEquipo'>
    <div class='icon-block half bg-orange-300'>
        <span aria-hidden='true' class='text-white_icon icon-cloud-download'></span>
    </div>
Material Complementario
</div><br>
    <div class='alert alert-info' role='alert'>
     <a href='" . $datos_objeto[0]->transcripcion . "' class='btn btn-success' target='_blank'><span class='blanco'> Descarga aqu? documento complementario del curso.</span></a></div>";
    } else {
        $descargable = "";
    }
    $PRINCIPAL = str_replace("{NOMBRE_OBJETO}", ($datos_objeto[0]->titulo), $PRINCIPAL);
    $PRINCIPAL = str_replace("{NUMERO_OBJETO}", ($datos_objeto[0]->orden), $PRINCIPAL);
    $PRINCIPAL = str_replace("{DESCARGABLE}", ($descargable), $PRINCIPAL);
    //Interacciones
    if ($datos_objeto[0]->paramasinfo == "interacciones") {
        $PRINCIPAL   = str_replace("{TITULO_INTERACCIONES}", file_get_contents("views/cursos/contenidos/bloque_titulo_interacciones.html"), $PRINCIPAL);
        $PRINCIPAL   = str_replace("{BLOQUE_INTERACCIONES}", file_get_contents("views/cursos/contenidos/bloque_interacciones.html"), $PRINCIPAL);
        $PRINCIPAL   = str_replace("{ID_OBJETO}", ($id_objeto), $PRINCIPAL);
        $PRINCIPAL   = str_replace("{USUARIO_EMBAJADOR}", ($rut), $PRINCIPAL);
        $comentarios = ColocaComentariosInterraccionesGenericoObjetos($id_empresa, $id_objeto, $rut);
        $PRINCIPAL   = str_replace("{BLOQUE_COMENTARIOS_INGRESADOS" . $datos_objeto[0]->id . "}", ($comentarios), $PRINCIPAL);
    } else {
        $PRINCIPAL = str_replace("{TITULO_INTERACCIONES}", "", $PRINCIPAL);
        $PRINCIPAL = str_replace("{BLOQUE_INTERACCIONES}", "", $PRINCIPAL);
    }
    //Seccion del Cronometro
    $PRINCIPAL = BarraNavegacion($PRINCIPAL, "contenido");
    $PRINCIPAL = str_replace("{CRONOMETRO_PARA_CONTENIDOS}", file_get_contents("views/cursos/contenidos/cronometro.html"), $PRINCIPAL);
    //Verifico si esta finalizado o no este objetos
    if ($objeto_tiene_puntos) {
        $PRINCIPAL = str_replace("{BOTON_MATERIAL_OK}", "", $PRINCIPAL);
    } else {
        $PRINCIPAL = str_replace("{BOTON_MATERIAL_OK}", file_get_contents("views/cursos/contenidos/" . $_SESSION["id_empresa"] . "_boton_ok_material.html"), $PRINCIPAL);
    }
    //if($objeto_finalizado && $datos_objeto[0]->opcional<>1){
    if ($datos_objeto[0]->opcional == 1 && $datos_objeto[0]->extension_objeto <> 25) {
        $PRINCIPAL = str_replace("{BOTON_VOLVER}", file_get_contents("views/cursos/contenidos/boton_volver_curso.html"), $PRINCIPAL);
        $PRINCIPAL = str_replace("{ID_CURSO_ENCODEADO_VOLVER}", Encodear3($datos_objeto[0]->id_curso), $PRINCIPAL);
        $PRINCIPAL = str_replace("{ENVBOTON}", "backcont", $PRINCIPAL);
        $PRINCIPAL = str_replace("{BOTON_FINALIZAR}", file_get_contents("views/cursos/contenidos/boton_siguiente_curso_v2.html"), $PRINCIPAL);
    } else {
        if ($_SESSION["id_empresa"] == 59) {
            $PRINCIPAL = str_replace("{BOTON_FINALIZAR}", file_get_contents("views/cursos/contenidos/59_boton_finaliza_curso.html"), $PRINCIPAL);
        } else {
            if ($objeto_finalizado && $datos_objeto[0]->id_desafio <> '') {
                $PRINCIPAL = str_replace("{BOTON_FINALIZAR}", "", $PRINCIPAL);
            } else {
                $PRINCIPAL = str_replace("{BOTON_FINALIZAR}", file_get_contents("views/cursos/contenidos/boton_finaliza_curso.html"), $PRINCIPAL);
            }
        }
        $PRINCIPAL = str_replace("{ID_OBJETIVO_ENCODEADO}", Encodear3($id_objeto), $PRINCIPAL);
        $PRINCIPAL = str_replace("{ENVBOTON}", "fincont", $PRINCIPAL);
        $PRINCIPAL = str_replace("{ID_CURSO_ENCODEADO}", Encodear3($datos_objeto[0]->id_curso), $PRINCIPAL);
        $PRINCIPAL = str_replace("{BOTON_VOLVER}", file_get_contents("views/cursos/contenidos/CAP_boton_volver_curso.html"), $PRINCIPAL);
        $PRINCIPAL = str_replace("{ID_CURSO_ENCODEADO_VOLVER}", Encodear3($datos_objeto[0]->id_curso), $PRINCIPAL);
        $PRINCIPAL = str_replace("{ENVBOTON}", "backcont", $PRINCIPAL);
    }
    $PRINCIPAL                        = str_replace("{RUT_ENCODEADO}", Encodear3($rut), $PRINCIPAL);
    $PRINCIPAL                        = str_replace("{ID_OBJETO}", ($id_objeto), $PRINCIPAL);
    $PRINCIPAL                        = str_replace("{ID_OBJETO_ENCODEADO}", Encodear3($id_objeto), $PRINCIPAL);
    //ACA OBTENGO EL SIGUIENTE OBJETO
    $datos_siguiente_objeto           = DatosObjetoDadoRutCursoyOrden($datos_objeto[0]->id_curso, $datos_objeto[0]->orden + 1);
    $PRINCIPAL                        = str_replace("{ID_SIGUIENTE_OBJETO_ENCODEADO}", Encodear3($datos_siguiente_objeto[0]->id), $PRINCIPAL);
    //total de navegacion para esteobjeto, rut y curso
    $suma_navegacion_por_curso_objeto = SumaNavegacionesDadoRutYObjeto($rut, $id_objeto, $datos_objeto[0]->id_curso);
    if ($suma_navegacion_por_curso_objeto[0]->total_tiempo) {
        $PRINCIPAL = str_replace("{SUMA_NAVEGACION}", ($suma_navegacion_por_curso_objeto[0]->total_tiempo), $PRINCIPAL);
    } else {
        $PRINCIPAL = str_replace("{SUMA_NAVEGACION}", "00:00:00", $PRINCIPAL);
    }
    //echo $datos_objeto[0]->id_curso;
    $PRINCIPAL = str_replace("{CODIGO_CURSO_ENCODEADO}", Encodear3($datos_objeto[0]->id_curso), $PRINCIPAL);
    $PRINCIPAL = str_replace("{RUT_JEFATURA}", Encodear3($datos_usuario[0]->jefe), $PRINCIPAL);
    $PRINCIPAL = str_replace("{RUT_JEFATURA_DESDE_VISTA_JEFE}", Encodear3($rut), $PRINCIPAL);
    $PRINCIPAL = str_replace("{RUT_ENCODEADO_DESDE_VISTA_JEFE}", Encodear3($rut_colaborador_desde_vista_jefe), $PRINCIPAL);
    $PRINCIPAL = str_replace("{BLOQUE_OBJETO-PDF}", file_get_contents("dflip/examples/entorno_objeto.html"), $PRINCIPAL);
    $PRINCIPAL = str_replace("{BLOQUE_OBJETO-PDF-URL}", "dflip/examples/entorno_objeto.html", $PRINCIPAL);
    $PRINCIPAL = str_replace("{PDF}", $datos_objeto[0]->url, $PRINCIPAL);
    return ($PRINCIPAL);
}
function comprimir_pagina($buffer)
{
    $busca     = array(
        '/\>[^\S ]+/s',
        '/[^\S ]+\</s',
        '/(\s)+/s'
    );
    $reemplaza = array(
        '>',
        '<',
        '\\1'
    );
    return preg_replace($busca, $reemplaza, $buffer);
}
function MuestraContenidoCapBK17012017($PRINCIPAL, $id_objeto, $rut, $pagina, $tipo_template, $id_malla, $rut_colaborador_desde_vista_jefe)
{
    $cantidad_imagenes_galeria = 9;
    //echo "$id_objeto, $rut, $pagina, $tipo_template, $id_malla, $rut_colaborador_desde_vista_jefe";
    $datos_usuario             = UsuarioEnBasePersonas($rut);
    $PRINCIPAL                 = str_replace("{NOMBRE_USUARIO}", ($datos_usuario[0]->nombre_completo), $PRINCIPAL);
    $datos_objeto              = DatosObjeto($id_objeto);
    //print_r($datos_objeto);
    $PRINCIPAL                 = str_replace("{URL_VOLVER_CHECKIN}", ($datos_objeto[0]->url_volver_checkin), $PRINCIPAL);
    if ($_SESSION["id_curso"]) {
        $PRINCIPAL = str_replace("{ID_CURSO_ENCODEADO}", Encodear3($_SESSION["id_curso"]), $PRINCIPAL);
    }
    $objeto_tiene_puntos = GAMIFICACIONTienePuntosPorCursoObjetoRutEmpresa($rut, $id_objeto, $datos_objeto[0]->id_curso, $_SESSION["id_empresa"]);
    $datos_curso         = DetalleCurso($datos_objeto[0]->id_curso);
    $datos_malla         = GAMIFICACIONObtengoDatosMallaCursoDadoRutEmpresa($rut, $_SESSION["id_empresa"]);
    $datos_usuario_malla = ObtenerDatosRelMallaUsuarioDadoRut($rut, $_SESSION["id_empresa"]);
    $objeto_finalizado   = VerObjetoFinalizado($id_objeto, $rut);
    if ($id_malla) {
        $datos_empresa = DatosEmpresa($_SESSION["id_empresa"]);
        //$PRINCIPAL = str_replace("{BLOQUE_OBJETO}",file_get_contents("views/cursos/objetos/foro_cat/formulario_completo.html"),$PRINCIPAL);
        $PRINCIPAL     = ColocaBloqueComparte($PRINCIPAL, $_SESSION["id_empresa"], $id_malla, $rut, "todo");
        $PRINCIPAL     = str_replace("{ENV_HOME}", $datos_empresa[0]->case_home, $PRINCIPAL);
        //$PRINCIPAL = str_replace("{ID_MALLA_ENCODEADA}",$id_malla,$PRINCIPAL);
    }
    if ($datos_objeto[0]->extension_objeto) {
        //Esto quiere decir que tiene algun tipo de extension el objeto
        $datos_extension = DatosExtensionDeObjeto($datos_objeto[0]->extension_objeto);
        $deviceipad      = strtolower($_SERVER[""]);
        $deviceipod      = strtolower($_SERVER[""]);
        if ($datos_objeto[0]->id_template) {
            if (file_exists("views/pagina/" . $datos_malla[0]->id_malla . "_" . ($datos_objeto[0]->template_para_entorno))) {
                $template_objeto = "views/pagina/" . $datos_malla[0]->id_malla . "_" . ($datos_objeto[0]->template_para_entorno);
            } else {
                if ($tipo_template == 11) {
                    ;
                    $template_objeto = "views/pagina/" . ($datos_extension[0]->template_lectura);
                } else {
                    $template_objeto = "views/pagina/" . ($datos_objeto[0]->template_para_entorno);
                }
            }
        } else {
            if ($tipo_template == 1) {
                $template_objeto = ($datos_extension[0]->template_lectura);
            } else {
                //checkin
                if ($datos_objeto[0]->checkin == 1 or $_GET["checkin"] == 1) {
                    $template_objeto = ($datos_extension[0]->template_check);
                    //echo "1";
                } else {
                    if ($datos_objeto[0]->extension_objeto == 21 or $datos_objeto[0]->extension_objeto == 20) {
                        //echo "2";
                        $esta_finalizado = TieneAccionesPEndientes($rut, $_SESSION["id_empresa"], $datos_objeto[0]->id_curso, $id_objeto);
                        if ($esta_finalizado) {
                            //echo "3";
                            $template_objeto = ($datos_extension[0]->template_lectura);
                        } else {
                            //echo "4";
                            $template_objeto = ($datos_extension[0]->template);
                        }
                    } else {
                        if ($objeto_finalizado) {
                            //$template_objeto=($datos_extension[0]->template);
                            //$template_objeto=($datos_extension[0]->template_lectura);
                            $datos_desafio = TraeDatosDesafioDadoId($datos_objeto[0]->id_desafio);
                            //if($datos_desafio[0]->modificable=="si"){
                            if ($_GET["edidesa"] == 1) {
                                if ($datos_desafio[0]->id_objeto) {
                                    $template_objeto = "views/cursos/objetos/desafio/index_" . $datos_desafio[0]->id_objeto . ".html";
                                } else {
                                    $template_objeto = ($datos_extension[0]->template);
                                }
                            } else {
                                $template_objeto = ($datos_extension[0]->template_lectura);
                            }
                        } else {
                            //$template_objeto=($datos_extension[0]->template);
                            $datos_desafio = TraeDatosDesafioDadoId($datos_objeto[0]->id_desafio);
                            if ($datos_desafio[0]->id_objeto) {
                                $template_objeto = "views/cursos/objetos/desafio/index_" . $datos_desafio[0]->id_objeto . ".html";
                            } else {
                                $template_objeto = ($datos_extension[0]->template);
                            }
                        }
                    }
                }
            }
        }
        //echo $datos_extension[0]->template;
        $PRINCIPAL = str_replace("{BLOQUE_OBJETO}", file_get_contents($template_objeto), $PRINCIPAL);
        $PRINCIPAL = str_replace("{URL_OBJETO}", $datos_extension[0]->template, $PRINCIPAL);
        //$PRINCIPAL = str_replace("{BLOQUE_OBJETO}",$template_objeto,$PRINCIPAL);
        $PRINCIPAL = str_replace("{NOMBRE_DOCUMENTO}", $datos_objeto[0]->url_objeto, $PRINCIPAL);
        $PRINCIPAL = str_replace("{NOMBRE_VIDEO_MP4}", $datos_objeto[0]->url_objeto, $PRINCIPAL);
        $PRINCIPAL = str_replace("{URL_OBJETO_LINK}", $datos_objeto[0]->url_objeto, $PRINCIPAL);
        $PRINCIPAL = str_replace("{EXTENSION_OBJETO}", $datos_objeto[0]->duracion_video, $PRINCIPAL);
        if ($datos_objeto[0]->id_desafio) {
            if ($rut_colaborador_desde_vista_jefe) {
                $PRINCIPAL = str_replace("{ROW_PREGUNTAS}", ColocaPreguntasorDesafio($datos_objeto[0]->id_desafio, $rut_colaborador_desde_vista_jefe, $id_objeto, $datos_objeto[0]->id_curso, $datos_objeto[0]->id_desafio, $_SESSION["id_empresa"]), $PRINCIPAL);
            } else {
                $PRINCIPAL = str_replace("{ROW_PREGUNTAS}", ColocaPreguntasorDesafio($datos_objeto[0]->id_desafio, $rut, $id_objeto, $datos_objeto[0]->id_curso, $datos_objeto[0]->id_desafio, $_SESSION["id_empresa"]), $PRINCIPAL);
            }
            $PRINCIPAL        = str_replace("{ROW_BLOQUE_TEXTOS}", ColocaBloqueTextoDesafio($datos_objeto[0]->id_desafio, $rut, $id_objeto, $datos_objeto[0]->id_curso, $datos_objeto[0]->id_desafio, $_SESSION["id_empresa"]), $PRINCIPAL);
            $PRINCIPAL        = str_replace("{ID_DESAFIO_ENCODEADO}", Encodear3($datos_objeto[0]->id_desafio), $PRINCIPAL);
            $tiene_respuestas = VerificoDesafioPorObjeto($rut, $id_objeto, $datos_objeto[0]->id_curso, $_SESSION["id_empresa"], $datos_objeto[0]->id_desafio);
            /*if($tiene_respuestas){
            $PRINCIPAL = str_replace("{STYLO_MUESTRA_BOTON2_DESAFIOS}","",$PRINCIPAL);
            $PRINCIPAL = str_replace("{STYLO_MUESTRA_BOTON1_DESAFIOS}",'',$PRINCIPAL);
            }else{
            $PRINCIPAL = str_replace("{STYLO_MUESTRA_BOTON1_DESAFIOS}","",$PRINCIPAL);
            $PRINCIPAL = str_replace("{STYLO_MUESTRA_BOTON2_DESAFIOS}",'style="display:none;"',$PRINCIPAL);
            }*/
            if ($tiene_respuestas) {
                //$PRINCIPAL = str_replace("{STYLO_MUESTRA_BOTON1}",'style="display:none;"',$PRINCIPAL);
                if ($_GET["edidesa"] == 1) {
                    $PRINCIPAL = str_replace("{STYLO_MUESTRA_BOTON2_DESAFIOS}", 'style="display:none;"', $PRINCIPAL);
                } else {
                    $PRINCIPAL = str_replace("{STYLO_MUESTRA_BOTON2_DESAFIOS}", "", $PRINCIPAL);
                }
                $PRINCIPAL = str_replace("{STYLO_MUESTRA_BOTON1_DESAFIOS}", '', $PRINCIPAL);
            } else {
                $PRINCIPAL = str_replace("{STYLO_MUESTRA_BOTON1_DESAFIOS}", "", $PRINCIPAL);
                $PRINCIPAL = str_replace("{STYLO_MUESTRA_BOTON2_DESAFIOS}", 'style="display:none;"', $PRINCIPAL);
            }
            $datos_desafio = TraeDatosDesafioDadoId($datos_objeto[0]->id_desafio);
            $PRINCIPAL     = str_replace("{titulo_principal_desafio}", ($datos_desafio[0]->titulo_principal_desafio), $PRINCIPAL);
            $PRINCIPAL     = str_replace("{bajada_principal_desafio}", ($datos_desafio[0]->bajada_principal_desafio), $PRINCIPAL);
        }
        //PARA SESSIONS
        $PRINCIPAL = str_replace("{TITULO}", ($datos_objeto[0]->titulo), $PRINCIPAL);
        $PRINCIPAL = str_replace("{TEXTO_BAJADA}", ($datos_objeto[0]->texto_bajada), $PRINCIPAL);
        $PRINCIPAL = str_replace("{BAJADA}", ($datos_objeto[0]->bajada), $PRINCIPAL);
        $PRINCIPAL = str_replace("{URL_VIDEO}", ($datos_objeto[0]->video), $PRINCIPAL);
        $PRINCIPAL = str_replace("{PDF}", ($datos_objeto[0]->archivo), $PRINCIPAL);
        $PRINCIPAL = str_replace("{TRANSCRIPCION}", ($datos_objeto[0]->transcripcion), $PRINCIPAL);
        $PRINCIPAL = str_replace("{titulo_principal}", ($datos_objeto[0]->titulo_principal), $PRINCIPAL);
        $PRINCIPAL = str_replace("{pregunta_principal}", ($datos_objeto[0]->pregunta_principal), $PRINCIPAL);
        $PRINCIPAL = str_replace("{bajada_principal}", ($datos_objeto[0]->bajada_principal), $PRINCIPAL);
        $PRINCIPAL = str_replace("{titulo_secundario}", ($datos_objeto[0]->titulo_secundario), $PRINCIPAL);
        $PRINCIPAL = str_replace("{bajada_secundario}", ($datos_objeto[0]->bajada_secundario), $PRINCIPAL);
        $PRINCIPAL = str_replace("{subtitulo_principal}", ($datos_objeto[0]->subtitulo_principal), $PRINCIPAL);
        $PRINCIPAL = str_replace("{bajada_subtitulo_principal}", ($datos_objeto[0]->bajada_subtitulo_principal), $PRINCIPAL);
        if ($datos_objeto[0]->rut_relator) {
            $PRINCIPAL = str_replace("{BLOQUE_RELATOR}", file_get_contents("views/cursos/contenidos/bloque_relator_con_link.html"), $PRINCIPAL);
            $PRINCIPAL = str_replace("{RUT_RELATOR_ENCODEADO}", Encodear3($datos_objeto[0]->rut_relator), $PRINCIPAL);
        } else {
            $PRINCIPAL = str_replace("{BLOQUE_RELATOR}", file_get_contents("views/cursos/contenidos/bloque_relator_sin_link.html"), $PRINCIPAL);
        }
        $PRINCIPAL = str_replace("{BIO_RELATOR}", ($datos_objeto[0]->bio_relator), $PRINCIPAL);
        $PRINCIPAL = str_replace("{URL_IMAGEN_RELATOR}", ($datos_objeto[0]->foto_relator), $PRINCIPAL);
        $PRINCIPAL = str_replace("{URL_MIPERFIL}", VerificaFotoPersonal($rut), $PRINCIPAL);
        //Bloque con textos
        $PRINCIPAL = str_replace("{RESUMEN_EJECUTIVO}", ColocaBloqueTextosPorObjeto($datos_objeto[0]->id), $PRINCIPAL);
        //Bloque con citas
        $PRINCIPAL = str_replace("{ENTORNO_CITA}", ColocaBloqueCitasPorObjeto($datos_objeto[0]->id), $PRINCIPAL);
        //BLOQUE MP3
        $PRINCIPAL = str_replace("{ENTORNO_DOCUMENTOS}", ColocaBloqueDocumentosPorObjeto($datos_objeto[0]->id), $PRINCIPAL);
        //Bloque Biograf?a Profesional
        if ($rut_colaborador_desde_vista_jefe) {
            $PRINCIPAL = ColocaDatosBiografiaProfesional($datos_objeto[0]->id, $rut_colaborador_desde_vista_jefe, $PRINCIPAL);
        } else {
            $PRINCIPAL = ColocaDatosBiografiaProfesional($datos_objeto[0]->id, $rut, $PRINCIPAL);
        }
        //Bloque para Documentos
        $PRINCIPAL                             = str_replace("{ENTORNO_MP3}", ColocaBloqueMP3PorObjeto($datos_objeto[0]->id), $PRINCIPAL);
        //Bloque para Pregunta
        $PRINCIPAL                             = str_replace("{ENTORNO_PREGUNTA}", ColocaBloquePreguntaPorObjeto($datos_objeto[0]->id, $rut, 1), $PRINCIPAL);
        $PRINCIPAL                             = str_replace("{ENTORNO_PREGUNTA_UNICA_POR_OBJETO}", ColocaBloquePreguntaPorObjetoUnicaRadio($datos_objeto[0]->id, $rut, 1), $PRINCIPAL);
        //Bloque para Comentarios - Post
        $PRINCIPAL                             = str_replace("{LISTADO_COMENTARIOS}", ColocaBloqueComentariosPorObjeto($datos_objeto[0]->id, $rut, $pagina, $cantidad_imagenes_galeria), $PRINCIPAL);
        //PAginacion para los FORO
        $PRINCIPAL                             = str_replace("{PAGINACION_COMENTARIOS}", ColocaPaginacionDeComentarios($pagina, $datos_objeto[0]->id, $rut, $datos_malla[0]->id_malla, $cantidad_imagenes_galeria), $PRINCIPAL);
        //Bloque para Compromisos
        $PRINCIPAL                             = str_replace("{LISTADO_COMPROMISOS_POR_OBJETO}", ColocaCompromisosPorObjeto($datos_objeto[0]->id, $rut), $PRINCIPAL);
        //Bloque para Comentarios - Con Reply
        $PRINCIPAL                             = str_replace("{LISTADO_COMENTARIOS_CON_REPLY}", ColocaBloqueComentariosPorObjetoConReplay($datos_objeto[0]->id, $rut), $PRINCIPAL);
        $esta_finalizado_por_agente_el_desafio = EstaFinalizadoDesafio($rut_colaborador_desde_vista_jefe, $datos_objeto[0]->id, $datos_objeto[0]->id_curso, $_SESSION["id_empresa"]);
        if ($esta_finalizado_por_agente_el_desafio) {
            $PRINCIPAL = str_replace("{BOTON_VALIDA}", file_get_contents("views/cursos/objetos/desafio/boton_validado_desafio.html"), $PRINCIPAL);
        } else {
            $PRINCIPAL = str_replace("{BOTON_VALIDA}", file_get_contents("views/cursos/objetos/desafio/boton_valida_desafio_final.html"), $PRINCIPAL);
        }
        $estavalidado_vistacolaborador = EstaFinalizadoDesafio($rut, $datos_objeto[0]->id, $datos_objeto[0]->id_curso, $_SESSION["id_empresa"]);
        if ($estavalidado_vistacolaborador) {
            $PRINCIPAL = str_replace("{BOTON_MODIFICAR_VISTA_COLABORADOR}", file_get_contents("views/cursos/objetos/desafio/boton_validado_desafio.html"), $PRINCIPAL);
        } else {
            $PRINCIPAL = str_replace("{BOTON_MODIFICAR_VISTA_COLABORADOR}", file_get_contents("views/cursos/objetos/desafio/boton_modifica_desafio.html"), $PRINCIPAL);
        }
        //Bloque para Pregunta 2
        $PRINCIPAL = str_replace("{ENTORNO_PREGUNTA_2}", ColocaBloquePreguntaPorObjeto($datos_objeto[0]->id, $rut, 2), $PRINCIPAL);
        //Coloca datos de la linea de tiempo del Desafio
        $PRINCIPAL = str_replace("{FECHA_CREACION_DESAFIO}", ColocaFechaCreacionDesafio($datos_objeto[0]->id, $rut, $rut_colaborador_desde_vista_jefe), $PRINCIPAL);
        $PRINCIPAL = str_replace("{GALERIA_FOTOS_USUARIOS_}", colocaImagenesPorObjeto($datos_objeto[0]->id, $rut, $_SESSION["id_empresa"], $pagina, $datos_usuario_malla[0]->id_malla, $cantidad_imagenes_galeria), $PRINCIPAL);
        $PRINCIPAL = str_replace("{PAGINACION_GALERIA_IMAGENES}", ColocaPaginacionDeImagenes($pagina, $datos_objeto[0]->id, $rut, $datos_malla[0]->id_malla, $cantidad_imagenes_galeria), $PRINCIPAL);
        //Bloque para Listado de preguntas creadas por el relator. CHECKIN
        $PRINCIPAL = str_replace("{LISTADO_PREGUNTAS_POR_EVAL}", ColocaPReguntasPorEval($datos_objeto[0]->id), $PRINCIPAL);
        //Bloque para olocar datos de las Acciones Pendientes
        if ($rut_colaborador_desde_vista_jefe) {
            $PRINCIPAL = ColocaDatosAccionesClaves($datos_objeto[0]->id, $datos_objeto[0]->id_curso, $_SESSION["id_empresa"], $rut_colaborador_desde_vista_jefe, $PRINCIPAL);
        } else {
            $PRINCIPAL = ColocaDatosAccionesClaves($datos_objeto[0]->id, $datos_objeto[0]->id_curso, $_SESSION["id_empresa"], $rut, $PRINCIPAL);
        }
        //Arma paginacion para GALERIA DE IMAGENES
    } else if ($datos_objeto[0]->id_encuesta) {
        echo "encuesta";
    } else {
        $PRINCIPAL = str_replace("{BLOQUE_OBJETO}", file_get_contents("views/cursos/contenidos/bloque_iframe.html"), $PRINCIPAL);
        $PRINCIPAL = str_replace("{URL_OBJETO}", $datos_objeto[0]->url, $PRINCIPAL);
        $PRINCIPAL = str_replace("{EXTENSION_OBJETO}", $datos_objeto[0]->duracion_video, $PRINCIPAL);
    }
    //Dado la extension del objeto, traigo el template a utilizar por el tipo de objeto.
    $PRINCIPAL = str_replace("{NOMBRE_OBJETO}", ($datos_objeto[0]->titulo), $PRINCIPAL);
    $PRINCIPAL = str_replace("{NUMERO_OBJETO}", ($datos_objeto[0]->orden), $PRINCIPAL);
    //Seccion del Cronometro
    $PRINCIPAL = BarraNavegacion($PRINCIPAL, "contenido");
    $PRINCIPAL = str_replace("{CRONOMETRO_PARA_CONTENIDOS}", file_get_contents("views/cursos/contenidos/cronometro.html"), $PRINCIPAL);
    //Verifico si esta finalizado o no este objetos
    if ($objeto_tiene_puntos) {
        $PRINCIPAL = str_replace("{BOTON_MATERIAL_OK}", "", $PRINCIPAL);
    } else {
        $PRINCIPAL = str_replace("{BOTON_MATERIAL_OK}", file_get_contents("views/cursos/contenidos/" . $_SESSION["id_empresa"] . "_boton_ok_material.html"), $PRINCIPAL);
    }
    //if($objeto_finalizado && $datos_objeto[0]->opcional<>1){
    if ($datos_objeto[0]->opcional == 1) {
        $PRINCIPAL = str_replace("{BOTON_VOLVER}", file_get_contents("views/cursos/contenidos/boton_volver_curso.html"), $PRINCIPAL);
        $PRINCIPAL = str_replace("{ID_CURSO_ENCODEADO_VOLVER}", Encodear3($datos_objeto[0]->id_curso), $PRINCIPAL);
        $PRINCIPAL = str_replace("{ENVBOTON}", "backcont", $PRINCIPAL);
        $PRINCIPAL = str_replace("{BOTON_FINALIZAR}", file_get_contents("views/cursos/contenidos/boton_siguiente_curso_v2.html"), $PRINCIPAL);
    } else {
        if ($_SESSION["id_empresa"] == 59) {
            $PRINCIPAL = str_replace("{BOTON_FINALIZAR}", file_get_contents("views/cursos/contenidos/59_boton_finaliza_curso.html"), $PRINCIPAL);
        } else {
            $PRINCIPAL = str_replace("{BOTON_FINALIZAR}", file_get_contents("views/cursos/contenidos/boton_finaliza_curso.html"), $PRINCIPAL);
        }
        $PRINCIPAL = str_replace("{ID_OBJETIVO_ENCODEADO}", Encodear3($id_objeto), $PRINCIPAL);
        $PRINCIPAL = str_replace("{ENVBOTON}", "fincont", $PRINCIPAL);
        $PRINCIPAL = str_replace("{ID_CURSO_ENCODEADO}", Encodear3($datos_objeto[0]->id_curso), $PRINCIPAL);
        $PRINCIPAL = str_replace("{BOTON_VOLVER}", file_get_contents("views/cursos/contenidos/CAP_boton_volver_curso.html"), $PRINCIPAL);
        $PRINCIPAL = str_replace("{ID_CURSO_ENCODEADO_VOLVER}", Encodear3($datos_objeto[0]->id_curso), $PRINCIPAL);
        $PRINCIPAL = str_replace("{ENVBOTON}", "backcont", $PRINCIPAL);
    }
    $PRINCIPAL                        = str_replace("{RUT_ENCODEADO}", Encodear3($rut), $PRINCIPAL);
    $PRINCIPAL                        = str_replace("{ID_OBJETO}", ($id_objeto), $PRINCIPAL);
    $PRINCIPAL                        = str_replace("{ID_OBJETO_ENCODEADO}", Encodear3($id_objeto), $PRINCIPAL);
    //ACA OBTENGO EL SIGUIENTE OBJETO
    $datos_siguiente_objeto           = DatosObjetoDadoRutCursoyOrden($datos_objeto[0]->id_curso, $datos_objeto[0]->orden + 1);
    $PRINCIPAL                        = str_replace("{ID_SIGUIENTE_OBJETO_ENCODEADO}", Encodear3($datos_siguiente_objeto[0]->id), $PRINCIPAL);
    //total de navegacion para esteobjeto, rut y curso
    $suma_navegacion_por_curso_objeto = SumaNavegacionesDadoRutYObjeto($rut, $id_objeto, $datos_objeto[0]->id_curso);
    if ($suma_navegacion_por_curso_objeto[0]->total_tiempo) {
        $PRINCIPAL = str_replace("{SUMA_NAVEGACION}", ($suma_navegacion_por_curso_objeto[0]->total_tiempo), $PRINCIPAL);
    } else {
        $PRINCIPAL = str_replace("{SUMA_NAVEGACION}", "00:00:00", $PRINCIPAL);
    }
    //echo $datos_objeto[0]->id_curso;
    $PRINCIPAL = str_replace("{CODIGO_CURSO_ENCODEADO}", Encodear3($datos_objeto[0]->id_curso), $PRINCIPAL);
    $PRINCIPAL = str_replace("{RUT_JEFATURA}", Encodear3($datos_usuario[0]->jefe), $PRINCIPAL);
    $PRINCIPAL = str_replace("{RUT_JEFATURA_DESDE_VISTA_JEFE}", Encodear3($rut), $PRINCIPAL);
    $PRINCIPAL = str_replace("{RUT_ENCODEADO_DESDE_VISTA_JEFE}", Encodear3($rut_colaborador_desde_vista_jefe), $PRINCIPAL);
    $PRINCIPAL = str_replace("{BLOQUE_OBJETO-PDF}", file_get_contents("dflip/examples/entorno_objeto.html"), $PRINCIPAL);
    $PRINCIPAL = str_replace("{BLOQUE_OBJETO-PDF-URL}", "dflip/examples/entorno_objeto.html", $PRINCIPAL);
    $PRINCIPAL = str_replace("{PDF}", $datos_objeto[0]->url, $PRINCIPAL);
    return ($PRINCIPAL);
}
function CAPACITACION_ObtenerEstadoAvanceCurso($rut, $id_curso, $id_inscripcion, $id_empresa)
{

//echo "<br>CAPACITACION_ObtenerEstadoAvanceCurso($rut, $id_curso, $id_inscripcion, $id_empresa";

    if ($id_inscripcion) {

    //echo "id inscripcion";
    //TIENE INSCRIPCION EN ELEARNING

     $datos_inscripcion_cierre = TieneInscripcionCierreDadoRutYCursoEmpresaInscripcion($rut, $id_curso, $id_inscripcion, $id_empresa);

        if ($datos_inscripcion_cierre[0]->estado == 1 and $datos_inscripcion_cierre[0]->estado_descripcion == "") {
            //echo "___1.1";exit();
            $arreglo[0]  = '<span class="etiquetaPrograma etiquetaPrograma-aprobado pull-left"><i class="fas fa-check-square"></i>&nbsp;&nbsp;Aprobado</span>';
            $arreglo[1]  = 'success';
            $arreglo[2]  = '<i class="fas fa-check-square"></i>';
            $arreglo[3]  = 100;
            //avance de tabla cierre
            $arreglo[4]  = $datos_inscripcion_cierre[0]->avance;
            $arreglo[5]  = $datos_inscripcion_cierre[0]->navegacionminutos;
            $arreglo[6]  = $datos_inscripcion_cierre[0]->estado;
            $arreglo[7]  = $datos_inscripcion_cierre[0]->nota;
            $arreglo[8]  = $datos_inscripcion_cierre[0]->fecha_termino;
            $arreglo[9]  = '<span class="etiquetaPrograma etiquetaPrograma-aprobado pull-left"><i class="fas fa-check-square"></i>&nbsp;&nbsp;Aprobado&nbsp;' . $datos_inscripcion_cierre[0]->nota . '</span>';
            $arreglo[10] = $datos_inscripcion_cierre[0]->porcentaje_asistencia;
            $arreglo[11] = '<i class="fa fa-check" aria-hidden="true"></i>';
            $arreglo[12] = 'vr_color_verde';
            $arreglo[13] = $datos_inscripcion_cierre[0]->caso_especial;
        } else if ($datos_inscripcion_cierre[0]->estado === '0') {
            //echo "___2.1";exit();
            $arreglo[0]  = '<span class="etiquetaPrograma etiquetaPrograma-reprobado pull-left"><i class="far fa-times-circle"></i>&nbsp;&nbsp;Reprobado</span>';
            $arreglo[1]  = 'danger';
            $arreglo[2]  = '<i class="far fa-times-circle"></i>';
            $arreglo[3]  = 100;
            $arreglo[4]  = $datos_inscripcion_cierre[0]->avance;
            $arreglo[5]  = $datos_inscripcion_cierre[0]->navegacionminutos;
            $arreglo[6]  = $datos_inscripcion_cierre[0]->estado;
            $arreglo[7]  = $datos_inscripcion_cierre[0]->nota;
            $arreglo[8]  = $datos_inscripcion_cierre[0]->fecha_termino;
            $arreglo[9]  = '<span class="etiquetaPrograma etiquetaPrograma-reprobado pull-left"><i class="far fa-times-circle"></i>&nbsp;&nbsp;Reprobado&nbsp;' . $datos_inscripcion_cierre[0]->nota . '</span>';
            $arreglo[10] = $datos_inscripcion_cierre[0]->porcentaje_asistencia;
            $arreglo[11] = '<i class="fa fa-times" aria-hidden="true"></i>';
            $arreglo[12] = 'vr_color_rojo';
            $arreglo[13] = $datos_inscripcion_cierre[0]->caso_especial;
        } else if ($datos_inscripcion_cierre[0]->estado == 3) {
            //echo "___3.1";exit();
            $arreglo[0]  = '<span class="etiquetaPrograma etiquetaPrograma-proceso pull-left"><i class="fas fa-spinner"></i>&nbsp;En Proceso</span>';
            $arreglo[1]  = 'danger';
            $arreglo[2]  = '<i class="icon-hourglass icons"></i>';
            $arreglo[3]  = 100;
            $arreglo[4]  = $datos_inscripcion_cierre[0]->avance;
            $arreglo[5]  = $datos_inscripcion_cierre[0]->navegacionminutos;
            $arreglo[6]  = $datos_inscripcion_cierre[0]->estado;
            $arreglo[7]  = $datos_inscripcion_cierre[0]->nota;
            $arreglo[8]  = $datos_inscripcion_cierre[0]->fecha_termino;
            $arreglo[9]  = '<span class="etiquetaPrograma etiquetaPrograma-proceso pull-left"><i class="fas fa-spinner"></i>&nbsp;En Proceso&nbsp;' . $datos_inscripcion_cierre[0]->nota . '</span>';
            $arreglo[10] = $datos_inscripcion_cierre[0]->porcentaje_asistencia;
            $arreglo[11] = '<i class="fa fa-clock-o" aria-hidden="true"></i>';
            $arreglo[12] = 'vr_color_amarillo';
            $arreglo[13] = $datos_inscripcion_cierre[0]->caso_especial;
        } else if ($datos_inscripcion_cierre[0]->estado == 4) {
            //   echo "___4.1";exit();
            $arreglo[0]  = '<span class="etiquetaPrograma etiquetaPrograma-noiniciado pull-left"><i class="far fa-times-circle"></i>&nbsp;&nbsp;No Iniciado </span>';
            $arreglo[1]  = 0;
            $arreglo[2]  = '<i class="icon-frame icons"></i>';
            $arreglo[3]  = 0;
            $arreglo[4]  = $datos_inscripcion_cierre[0]->avance;
            $arreglo[5]  = $datos_inscripcion_cierre[0]->navegacionminutos;
            $arreglo[6]  = $datos_inscripcion_cierre[0]->estado;
            $arreglo[7]  = $datos_inscripcion_cierre[0]->nota;
            $arreglo[8]  = $datos_inscripcion_cierre[0]->fecha_termino;
            $arreglo[9]  = '<span class="etiquetaPrograma etiquetaPrograma-noiniciado pull-left"><i class="far fa-times-circle"></i>&nbsp;&nbsp;No Iniciado </span>';
            $arreglo[10] = $datos_inscripcion_cierre[0]->porcentaje_asistencia;
            $arreglo[11] = '<i class="fa fa-circle-thin" aria-hidden="true"></i>';
            $arreglo[12] = 'vr_color_gris';
            $arreglo[13] = $datos_inscripcion_cierre[0]->caso_especial;
        } else if (count($datos_inscripcion_cierre) == 0) {
            //echo "___5.1";exit();
            $arreglo[0]  = '<span class="etiquetaPrograma etiquetaPrograma-noiniciado pull-left"><i class="far fa-times-circle"></i>&nbsp;&nbsp;No Iniciado </span>';
            $arreglo[1]  = 0;
            $arreglo[2]  = '<i class="icon-frame icons"></i>';
            $arreglo[3]  = 0;
            $arreglo[4]  = 0;
            $arreglo[5]  = 0;
            $arreglo[6]  = $datos_inscripcion_cierre[0]->estado;
            $arreglo[7]  = $datos_inscripcion_cierre[0]->nota;
            $arreglo[8]  = $datos_inscripcion_cierre[0]->fecha_termino;
            $arreglo[9]  = '<span class="etiquetaPrograma etiquetaPrograma-noiniciado pull-left"><i class="far fa-times-circle"></i>&nbsp;&nbsp;No Iniciado </span>';
            $arreglo[10] = $datos_inscripcion_cierre[0]->porcentaje_asistencia;
            $arreglo[11] = '<i class="fa fa-circle-thin" aria-hidden="true"></i>';
            $arreglo[12] = 'vr_color_gris';
            $arreglo[13] = $datos_inscripcion_cierre[0]->caso_especial;
        } else if ($datos_inscripcion_cierre[0]->estado == 1 and $datos_inscripcion_cierre[0]->estado_descripcion == "Aprueba") {
            //echo "___6.1";exit();
            $arreglo[0]  = '<span class="etiquetaPrograma etiquetaPrograma-aprobado pull-left"><i class="far fa-times-circle"></i>&nbsp;&nbsp;Aprueba </span>';
            $arreglo[1]  = 0;
            $arreglo[2]  = '<i class="icon-frame icons"></i>';
            $arreglo[3]  = 100;
            $arreglo[4]  = $datos_inscripcion_cierre[0]->avance;
            $arreglo[5]  = $datos_inscripcion_cierre[0]->navegacionminutos;
            $arreglo[6]  = $datos_inscripcion_cierre[0]->estado;
            $arreglo[7]  = $datos_inscripcion_cierre[0]->nota;
            $arreglo[8]  = $datos_inscripcion_cierre[0]->fecha_termino;
            $arreglo[9]  = '<span class="etiquetaPrograma etiquetaPrograma-aprobado pull-left"><i class="far fa-times-circle"></i>&nbsp;&nbsp;Aprueba </span>';
            $arreglo[10] = $datos_inscripcion_cierre[0]->porcentaje_asistencia;
            $arreglo[11] = '<i class="fa fa-check" aria-hidden="true"></i>';
            $arreglo[12] = 'vr_color_verde';
            $arreglo[13] = $datos_inscripcion_cierre[0]->caso_especial;
        } else if ($datos_inscripcion_cierre[0]->estado == 1 and $datos_inscripcion_cierre[0]->estado_descripcion == "APROBADO") {
            //   echo "___7.1";exit();
            $arreglo[0]  = '<span class="etiquetaPrograma etiquetaPrograma-aprobado pull-left"><i class="far fa-times-circle"></i>&nbsp;&nbsp;APROBADO </span>';
            $arreglo[1]  = 0;
            $arreglo[2]  = '<i class="icon-frame icons"></i>';
            $arreglo[3]  = 100;
            $arreglo[4]  = $datos_inscripcion_cierre[0]->avance;
            $arreglo[5]  = $datos_inscripcion_cierre[0]->navegacionminutos;
            $arreglo[6]  = $datos_inscripcion_cierre[0]->estado;
            $arreglo[7]  = $datos_inscripcion_cierre[0]->nota;
            $arreglo[8]  = $datos_inscripcion_cierre[0]->fecha_termino;
            $arreglo[9]  = '<span class="etiquetaPrograma etiquetaPrograma-aprobado pull-left"><i class="far fa-times-circle"></i>&nbsp;&nbsp;APROBADO </span>';
            $arreglo[10] = $datos_inscripcion_cierre[0]->porcentaje_asistencia;
            $arreglo[11] = '<i class="fa fa-check" aria-hidden="true"></i>';
            $arreglo[12] = 'vr_color_verde';
            $arreglo[13] = $datos_inscripcion_cierre[0]->caso_especial;
        } else if ($datos_inscripcion_cierre[0]->estado == 1 and $datos_inscripcion_cierre[0]->estado_descripcion == "Reprueba") {
            //echo "___8.1";exit();
            $arreglo[0]  = '<span class="etiquetaPrograma etiquetaPrograma-reprobado pull-left"><i class="far fa-times-circle"></i>&nbsp;&nbsp;Reprueba </span>';
            $arreglo[1]  = 0;
            $arreglo[2]  = '<i class="icon-frame icons"></i>';
            $arreglo[3]  = 100;
            $arreglo[4]  = $datos_inscripcion_cierre[0]->avance;
            $arreglo[5]  = $datos_inscripcion_cierre[0]->navegacionminutos;
            $arreglo[6]  = $datos_inscripcion_cierre[0]->estado;
            $arreglo[7]  = $datos_inscripcion_cierre[0]->nota;
            $arreglo[8]  = $datos_inscripcion_cierre[0]->fecha_termino;
            $arreglo[9]  = '<span class="etiquetaPrograma etiquetaPrograma-reprobado pull-left"><i class="far fa-times-circle"></i>&nbsp;&nbsp;Reprueba </span>';
            $arreglo[10] = $datos_inscripcion_cierre[0]->porcentaje_asistencia;
            $arreglo[11] = '<i class="fa fa-check" aria-hidden="true"></i>';
            $arreglo[12] = 'vr_color_rojo';
            $arreglo[13] = $datos_inscripcion_cierre[0]->caso_especial;
        } else if ($datos_inscripcion_cierre[0]->estado == 1 and $datos_inscripcion_cierre[0]->estado_descripcion == "REPROBADO") {
            //echo "___9.1";exit();
            $arreglo[0]  = '<span class="etiquetaPrograma etiquetaPrograma-reprobado pull-left"><i class="far fa-times-circle"></i>&nbsp;&nbsp;REPROBADO </span>';
            $arreglo[1]  = 0;
            $arreglo[2]  = '<i class="icon-frame icons"></i>';
            $arreglo[3]  = 100;
            $arreglo[4]  = $datos_inscripcion_cierre[0]->avance;
            $arreglo[5]  = $datos_inscripcion_cierre[0]->navegacionminutos;
            $arreglo[6]  = $datos_inscripcion_cierre[0]->estado;
            $arreglo[7]  = $datos_inscripcion_cierre[0]->nota;
            $arreglo[8]  = $datos_inscripcion_cierre[0]->fecha_termino;
            $arreglo[9]  = '<span class="etiquetaPrograma etiquetaPrograma-reprobado pull-left"><i class="far fa-times-circle"></i>&nbsp;&nbsp;REPROBADO </span>';
            $arreglo[10] = $datos_inscripcion_cierre[0]->porcentaje_asistencia;
            $arreglo[11] = '<i class="fa fa-check" aria-hidden="true"></i>';
            $arreglo[12] = 'vr_color_rojo';
            $arreglo[13] = $datos_inscripcion_cierre[0]->caso_especial;
        }



    } else {
        $datos_inscripcion_cierre = TieneInscripcionCierreDadoRutYCursoEmpresa($rut, $id_curso, $id_empresa);
//        print_r($datos_inscripcion_cierre);

        if ($datos_inscripcion_cierre[0]->estado == 1 and $datos_inscripcion_cierre[0]->estado_descripcion == "") {
            //echo "___1.1";exit();
            $arreglo[0]  = '<span class="etiquetaPrograma etiquetaPrograma-aprobado pull-left"><i class="fas fa-check-square"></i>&nbsp;&nbsp;Aprobado</span>';
            $arreglo[1]  = 'success';
            $arreglo[2]  = '<i class="fas fa-check-square"></i>';
            $arreglo[3]  = 100;
            //avance de tabla cierre
            $arreglo[4]  = $datos_inscripcion_cierre[0]->avance;
            $arreglo[5]  = $datos_inscripcion_cierre[0]->navegacionminutos;
            $arreglo[6]  = $datos_inscripcion_cierre[0]->estado;
            $arreglo[7]  = $datos_inscripcion_cierre[0]->nota;
            $arreglo[8]  = $datos_inscripcion_cierre[0]->fecha_termino;
            $arreglo[9]  = '<span class="etiquetaPrograma etiquetaPrograma-aprobado pull-left"><i class="fas fa-check-square"></i>&nbsp;&nbsp;Aprobado&nbsp;' . $datos_inscripcion_cierre[0]->nota . '</span>';
            $arreglo[10] = $datos_inscripcion_cierre[0]->porcentaje_asistencia;
            $arreglo[11] = '<i class="fa fa-check" aria-hidden="true"></i>';
            $arreglo[12] = 'vr_color_verde';
            $arreglo[13] = $datos_inscripcion_cierre[0]->caso_especial;
        } else if ($datos_inscripcion_cierre[0]->estado === '0') {
            //echo "___2.1";exit();
            $arreglo[0]  = '<span class="etiquetaPrograma etiquetaPrograma-reprobado pull-left"><i class="far fa-times-circle"></i>&nbsp;&nbsp;Reprobado</span>';
            $arreglo[1]  = 'danger';
            $arreglo[2]  = '<i class="far fa-times-circle"></i>';
            $arreglo[3]  = 100;
            $arreglo[4]  = $datos_inscripcion_cierre[0]->avance;
            $arreglo[5]  = $datos_inscripcion_cierre[0]->navegacionminutos;
            $arreglo[6]  = $datos_inscripcion_cierre[0]->estado;
            $arreglo[7]  = $datos_inscripcion_cierre[0]->nota;
            $arreglo[8]  = $datos_inscripcion_cierre[0]->fecha_termino;
            $arreglo[9]  = '<span class="etiquetaPrograma etiquetaPrograma-reprobado pull-left"><i class="far fa-times-circle"></i>&nbsp;&nbsp;Reprobado&nbsp;' . $datos_inscripcion_cierre[0]->nota . '</span>';
            $arreglo[10] = $datos_inscripcion_cierre[0]->porcentaje_asistencia;
            $arreglo[11] = '<i class="fa fa-times" aria-hidden="true"></i>';
            $arreglo[12] = 'vr_color_rojo';
            $arreglo[13] = $datos_inscripcion_cierre[0]->caso_especial;
        } else if ($datos_inscripcion_cierre[0]->estado == 3) {
            //echo "___3.1";exit();
            $arreglo[0]  = '<span class="etiquetaPrograma etiquetaPrograma-proceso pull-left"><i class="fas fa-spinner"></i>&nbsp;En Proceso</span>';
            $arreglo[1]  = 'danger';
            $arreglo[2]  = '<i class="icon-hourglass icons"></i>';
            $arreglo[3]  = 100;
            $arreglo[4]  = $datos_inscripcion_cierre[0]->avance;
            $arreglo[5]  = $datos_inscripcion_cierre[0]->navegacionminutos;
            $arreglo[6]  = $datos_inscripcion_cierre[0]->estado;
            $arreglo[7]  = $datos_inscripcion_cierre[0]->nota;
            $arreglo[8]  = $datos_inscripcion_cierre[0]->fecha_termino;
            $arreglo[9]  = '<span class="etiquetaPrograma etiquetaPrograma-proceso pull-left"><i class="fas fa-spinner"></i>&nbsp;En Proceso&nbsp;' . $datos_inscripcion_cierre[0]->nota . '</span>';
            $arreglo[10] = $datos_inscripcion_cierre[0]->porcentaje_asistencia;
            $arreglo[11] = '<i class="fa fa-clock-o" aria-hidden="true"></i>';
            $arreglo[12] = 'vr_color_amarillo';
            $arreglo[13] = $datos_inscripcion_cierre[0]->caso_especial;
        } else if ($datos_inscripcion_cierre[0]->estado == 4) {
            //   echo "___4.1";exit();
            $arreglo[0]  = '<span class="etiquetaPrograma etiquetaPrograma-noiniciado pull-left"><i class="far fa-times-circle"></i>&nbsp;&nbsp;No Iniciado </span>';
            $arreglo[1]  = 0;
            $arreglo[2]  = '<i class="icon-frame icons"></i>';
            $arreglo[3]  = 0;
            $arreglo[4]  = $datos_inscripcion_cierre[0]->avance;
            $arreglo[5]  = $datos_inscripcion_cierre[0]->navegacionminutos;
            $arreglo[6]  = $datos_inscripcion_cierre[0]->estado;
            $arreglo[7]  = $datos_inscripcion_cierre[0]->nota;
            $arreglo[8]  = $datos_inscripcion_cierre[0]->fecha_termino;
            $arreglo[9]  = '<span class="etiquetaPrograma etiquetaPrograma-noiniciado pull-left"><i class="far fa-times-circle"></i>&nbsp;&nbsp;No Iniciado </span>';
            $arreglo[10] = $datos_inscripcion_cierre[0]->porcentaje_asistencia;
            $arreglo[11] = '<i class="fa fa-circle-thin" aria-hidden="true"></i>';
            $arreglo[12] = 'vr_color_gris';
            $arreglo[13] = $datos_inscripcion_cierre[0]->caso_especial;
        } else if (count($datos_inscripcion_cierre) == 0) {
            //echo "___5.1";exit();
            $arreglo[0]  = '<span class="etiquetaPrograma etiquetaPrograma-noiniciado pull-left"><i class="far fa-times-circle"></i>&nbsp;&nbsp;No Iniciado </span>';
            $arreglo[1]  = 0;
            $arreglo[2]  = '<i class="icon-frame icons"></i>';
            $arreglo[3]  = 0;
            $arreglo[4]  = 0;
            $arreglo[5]  = 0;
            $arreglo[6]  = $datos_inscripcion_cierre[0]->estado;
            $arreglo[7]  = $datos_inscripcion_cierre[0]->nota;
            $arreglo[8]  = $datos_inscripcion_cierre[0]->fecha_termino;
            $arreglo[9]  = '<span class="etiquetaPrograma etiquetaPrograma-noiniciado pull-left"><i class="far fa-times-circle"></i>&nbsp;&nbsp;No Iniciado </span>';
            $arreglo[10] = $datos_inscripcion_cierre[0]->porcentaje_asistencia;
            $arreglo[11] = '<i class="fa fa-circle-thin" aria-hidden="true"></i>';
            $arreglo[12] = 'vr_color_gris';
            $arreglo[13] = $datos_inscripcion_cierre[0]->caso_especial;
        } else if ($datos_inscripcion_cierre[0]->estado == 1 and $datos_inscripcion_cierre[0]->estado_descripcion == "Aprueba") {
            //echo "___6.1";exit();
            $arreglo[0]  = '<span class="etiquetaPrograma etiquetaPrograma-aprobado pull-left"><i class="far fa-times-circle"></i>&nbsp;&nbsp;Aprueba </span>';
            $arreglo[1]  = 0;
            $arreglo[2]  = '<i class="icon-frame icons"></i>';
            $arreglo[3]  = 100;
            $arreglo[4]  = $datos_inscripcion_cierre[0]->avance;
            $arreglo[5]  = $datos_inscripcion_cierre[0]->navegacionminutos;
            $arreglo[6]  = $datos_inscripcion_cierre[0]->estado;
            $arreglo[7]  = $datos_inscripcion_cierre[0]->nota;
            $arreglo[8]  = $datos_inscripcion_cierre[0]->fecha_termino;
            $arreglo[9]  = '<span class="etiquetaPrograma etiquetaPrograma-aprobado pull-left"><i class="far fa-times-circle"></i>&nbsp;&nbsp;Aprueba </span>';
            $arreglo[10] = $datos_inscripcion_cierre[0]->porcentaje_asistencia;
            $arreglo[11] = '<i class="fa fa-check" aria-hidden="true"></i>';
            $arreglo[12] = 'vr_color_verde';
            $arreglo[13] = $datos_inscripcion_cierre[0]->caso_especial;
        } else if ($datos_inscripcion_cierre[0]->estado == 1 and $datos_inscripcion_cierre[0]->estado_descripcion == "APROBADO") {
            //   echo "___7.1";exit();
            $arreglo[0]  = '<span class="etiquetaPrograma etiquetaPrograma-aprobado pull-left"><i class="far fa-times-circle"></i>&nbsp;&nbsp;APROBADO </span>';
            $arreglo[1]  = 0;
            $arreglo[2]  = '<i class="icon-frame icons"></i>';
            $arreglo[3]  = 100;
            $arreglo[4]  = $datos_inscripcion_cierre[0]->avance;
            $arreglo[5]  = $datos_inscripcion_cierre[0]->navegacionminutos;
            $arreglo[6]  = $datos_inscripcion_cierre[0]->estado;
            $arreglo[7]  = $datos_inscripcion_cierre[0]->nota;
            $arreglo[8]  = $datos_inscripcion_cierre[0]->fecha_termino;
            $arreglo[9]  = '<span class="etiquetaPrograma etiquetaPrograma-aprobado pull-left"><i class="far fa-times-circle"></i>&nbsp;&nbsp;APROBADO </span>';
            $arreglo[10] = $datos_inscripcion_cierre[0]->porcentaje_asistencia;
            $arreglo[11] = '<i class="fa fa-check" aria-hidden="true"></i>';
            $arreglo[12] = 'vr_color_verde';
            $arreglo[13] = $datos_inscripcion_cierre[0]->caso_especial;
        } else if ($datos_inscripcion_cierre[0]->estado == 1 and $datos_inscripcion_cierre[0]->estado_descripcion == "Reprueba") {
            //echo "___8.1";exit();
            $arreglo[0]  = '<span class="etiquetaPrograma etiquetaPrograma-reprobado pull-left"><i class="far fa-times-circle"></i>&nbsp;&nbsp;Reprueba </span>';
            $arreglo[1]  = 0;
            $arreglo[2]  = '<i class="icon-frame icons"></i>';
            $arreglo[3]  = 100;
            $arreglo[4]  = $datos_inscripcion_cierre[0]->avance;
            $arreglo[5]  = $datos_inscripcion_cierre[0]->navegacionminutos;
            $arreglo[6]  = $datos_inscripcion_cierre[0]->estado;
            $arreglo[7]  = $datos_inscripcion_cierre[0]->nota;
            $arreglo[8]  = $datos_inscripcion_cierre[0]->fecha_termino;
            $arreglo[9]  = '<span class="etiquetaPrograma etiquetaPrograma-reprobado pull-left"><i class="far fa-times-circle"></i>&nbsp;&nbsp;Reprueba </span>';
            $arreglo[10] = $datos_inscripcion_cierre[0]->porcentaje_asistencia;
            $arreglo[11] = '<i class="fa fa-check" aria-hidden="true"></i>';
            $arreglo[12] = 'vr_color_rojo';
            $arreglo[13] = $datos_inscripcion_cierre[0]->caso_especial;
        } else if ($datos_inscripcion_cierre[0]->estado == 1 and $datos_inscripcion_cierre[0]->estado_descripcion == "REPROBADO") {
            //echo "___9.1";exit();
            $arreglo[0]  = '<span class="etiquetaPrograma etiquetaPrograma-reprobado pull-left"><i class="far fa-times-circle"></i>&nbsp;&nbsp;REPROBADO </span>';
            $arreglo[1]  = 0;
            $arreglo[2]  = '<i class="icon-frame icons"></i>';
            $arreglo[3]  = 100;
            $arreglo[4]  = $datos_inscripcion_cierre[0]->avance;
            $arreglo[5]  = $datos_inscripcion_cierre[0]->navegacionminutos;
            $arreglo[6]  = $datos_inscripcion_cierre[0]->estado;
            $arreglo[7]  = $datos_inscripcion_cierre[0]->nota;
            $arreglo[8]  = $datos_inscripcion_cierre[0]->fecha_termino;
            $arreglo[9]  = '<span class="etiquetaPrograma etiquetaPrograma-reprobado pull-left"><i class="far fa-times-circle"></i>&nbsp;&nbsp;REPROBADO </span>';
            $arreglo[10] = $datos_inscripcion_cierre[0]->porcentaje_asistencia;
            $arreglo[11] = '<i class="fa fa-check" aria-hidden="true"></i>';
            $arreglo[12] = 'vr_color_rojo';
            $arreglo[13] = $datos_inscripcion_cierre[0]->caso_especial;
        }
    }
    return ($arreglo);
}
function ColocaFiltros3Campos($PRINCIPAL, $id_empresa, $arreglo_post)
{
    $datos_empresa = DatosEmpresa($id_empresa);
    $PRINCIPAL     = str_replace("{CAMPO1}", $datos_empresa[0]->campo1, $PRINCIPAL);
    $campo1        = CriteriosParaTablaResumenReporteAvanceParaReportesSGD($id_empresa, $datos_empresa[0]->campo1);
    foreach ($campo1 as $val) {
        if ($arreglo_post[$datos_empresa[0]->campo1] == $val->campo) {
            $options_campo1 .= "<option selected value='" . $val->campo . "'>" . $val->campo . "</option>";
        } else {
            $options_campo1 .= "<option value='" . $val->campo . "'>" . $val->campo . "</option>";
        }
    }
    $PRINCIPAL = str_replace("{OPTIONS_CAMPO1}", ($options_campo1), $PRINCIPAL);
    $PRINCIPAL = str_replace("{CAMPO2}", $datos_empresa[0]->campo2, $PRINCIPAL);
    $campo2    = CriteriosParaTablaResumenReporteAvanceParaReportesSGD($id_empresa, $datos_empresa[0]->campo2);
    foreach ($campo2 as $val) {
        if ($arreglo_post[$datos_empresa[0]->campo2] == $val->campo) {
            $options_campo2 .= "<option selected value='" . $val->campo . "'>" . $val->campo . "</option>";
        } else {
            $options_campo2 .= "<option value='" . $val->campo . "'>" . $val->campo . "</option>";
        }
    }
    $PRINCIPAL = str_replace("{OPTIONS_CAMPO2}", ($options_campo2), $PRINCIPAL);
    $PRINCIPAL = str_replace("{CAMPO3}", $datos_empresa[0]->campo3, $PRINCIPAL);
    $campo3    = CriteriosParaTablaResumenReporteAvanceParaReportesSGD($id_empresa, $datos_empresa[0]->campo3);
    foreach ($campo3 as $val) {
        if ($arreglo_post[$datos_empresa[0]->campo3] == $val->campo) {
            $options_campo3 .= "<option selected value='" . $val->campo . "'>" . $val->campo . "</option>";
        } else {
            $options_campo3 .= "<option value='" . $val->campo . "'>" . $val->campo . "</option>";
        }
    }
    $PRINCIPAL = str_replace("{OPTIONS_CAMPO3}", ($options_campo3), $PRINCIPAL);
    if ($arreglo_post["rutevaluador"] && $arreglo_post["evaluador"]) {
        $PRINCIPAL = str_replace("{FILTRO_RUTEVALUADOR}", $arreglo_post["rutevaluador"], $PRINCIPAL);
        $PRINCIPAL = str_replace("{FILTRO_NOMBREEVALUADOR}", $arreglo_post["evaluador"], $PRINCIPAL);
    } else {
        $PRINCIPAL = str_replace("{FILTRO_RUTEVALUADOR}", "", $PRINCIPAL);
        $PRINCIPAL = str_replace("{FILTRO_NOMBREEVALUADOR}", "", $PRINCIPAL);
    }
    if ($arreglo_post["rutcalibrador"] && $arreglo_post["calibrador"]) {
        $PRINCIPAL = str_replace("{FILTRO_RUTCALIBRADOR}", $arreglo_post["rutcalibrador"], $PRINCIPAL);
        $PRINCIPAL = str_replace("{FILTRO_NOMBRECALIBRADOR}", $arreglo_post["calibrador"], $PRINCIPAL);
    } else {
        $PRINCIPAL = str_replace("{FILTRO_RUTCALIBRADOR}", "", $PRINCIPAL);
        $PRINCIPAL = str_replace("{FILTRO_NOMBRECALIBRADOR}", "", $PRINCIPAL);
    }
    return ($PRINCIPAL);
}
function GraficoArana($matriz)
{
    for ($i = 1; $i <= count($matriz); $i++) {
        $nombres .= "'" . $matriz[$i - 1]["nombre"] . "' ";
        $notas_jefe .= $matriz[$i - 1]["nota"];
        if ($matriz[$i - 1]["nota_ae"]) {
            $notas_ae .= $matriz[$i - 1]["nota_ae"];
        } else {
            $notas_ae .= "0";
        }
        if ($i < count($matriz)) {
            $nombres .= ", ";
            $notas_jefe .= ", ";
            $notas_ae .= ", ";
        }
    }
    $grafico       = file_get_contents("views/sgd/graficos/graficoAranaAeJefe.html");
    $datos_empresa = DatosEmpresa($_SESSION["id_empresa"]);
    $grafico       = str_replace("{COLOR_GRAFICO}", $datos_empresa[0]->color_grafico1, $grafico);
    $grafico       = str_replace("{COMPETENCIAS}", ($nombres), $grafico);
    $grafico       = str_replace("{NOTAS_DESCENDENTE}", ($notas_jefe), $grafico);
    //$grafico = str_replace("{NOTAS_AUTOEVALUACION}",($notas_ae),$grafico);
    $grafico       = str_replace("{NOTAS_AUTOEVALUACION}", ($notas_ae), $grafico);
    return ($grafico);
}
function ColocaDatosUsuarioSGD($html, $rut, $texto_mensaje, $rut_evaluador, $id_proceso)
{
    $html           = str_replace("{SECCION_DATOS_USUARIO}", file_get_contents("views/sgd/datos_superior_usuario.html"), $html);
    $datos          = DatosUsuarioConDatosEvaluadorPorProceso($rut, $rut_evaluador, $id_proceso);
    //exit;
    $datos_proceso_ = TraeDatosProcesoAnualDadoProcesoEval($id_proceso);
    if ($datos[0]->nombre_evaluador) {
        //$html = str_replace("{EVALUADOR}",($datos[0]->nombrecompletojefe),$html);
        $html = str_replace("{EVALUADOR}", ($datos[0]->nombrecompletojefe), $html);
        $html = str_replace("{CARGO_EVALUADOR}", ($datos[0]->cargo_evaluador), $html);
        $html = str_replace("{NOMBRE_CALIBRADOR}", ($datos[0]->nombrecompletocalibrador), $html);
        $html = str_replace("{CARGO_CALIBRADOR}", ($datos[0]->cargo_calibrador), $html);
        $html = str_replace("{NOMBRE_VALIDADOR}", ($datos[0]->nombrecompletovalidador), $html);
        $html = str_replace("{CARGO_VALIDADOR}", ($datos[0]->cargo_validador), $html);
        $html = str_replace("{AGNO_PROCESO}", ($datos_proceso_[0]->agno_proceso), $html);
    } else {
        $html = str_replace("{EVALUADOR}", "Sin Evaluador", $html);
        $html = str_replace("{CARGO_EVALUADOR}", "Sin Evaluador", $html);
    }
    //SECCION NOMBRE EVALUADO
    if ($datos[0]->nombre && $datos[0]->apaterno && $datos[0]->amaterno) {
        $html = str_replace("{NOMBRE_EVALUADO}", ($datos[0]->nombre . " " . $datos[0]->apaterno . " " . $datos[0]->amaterno), $html);
    } else if ($datos[0]->nombre_completo) {
        $html = str_replace("{NOMBRE_EVALUADO}", ($datos[0]->nombre_completo), $html);
    } else if ($datos[0]->nombre) {
        $html = str_replace("{NOMBRE_EVALUADO}", ($datos[0]->nombre), $html);
    } else {
        $html = str_replace("{NOMBRE_EVALUADO}", "Sin Nombre", $html);
    }
    if ($datos[0]->nombre && $datos[0]->apaterno && $datos[0]->amaterno) {
        $html = str_replace("{NOMBRE}", ($datos[0]->nombre . " " . $datos[0]->apaterno . " " . $datos[0]->amaterno), $html);
    } else {
        $html = str_replace("{NOMBRE}", ($datos[0]->nombre_completo), $html);
    }
    //SECCION NOMBRE JEFATURA - ESTE SE LEE DESDE LA TABLA TBL_USUARIO, CAMPO JEFE DEL USUARIO
    if ($datos[0]->nombre && $datos[0]->apaterno && $datos[0]->amaterno) {
        $html = str_replace("{NOMBRE_EVALUADO}", ($datos[0]->nombre . " " . $datos[0]->apaterno . " " . $datos[0]->amaterno), $html);
    } else {
        $html = str_replace("{NOMBRE_EVALUADO}", ($datos[0]->nombre_completo), $html);
    }
    if ($datos[0]->nombre_jefatura_tabla_usuario && $datos[0]->apaterno_jefatura_tabla_usuario && $datos[0]->amaterno_jefatura_tabla_usuario) {
        $html = str_replace("{NOMBRE_JEFATURA_TBL_USUARIO}", ($datos[0]->nombre_jefatura_tabla_usuario . " " . $datos[0]->apaterno_jefatura_tabla_usuario . " " . $datos[0]->amaterno_jefatura_tabla_usuario), $html);
    } else {
        $html = str_replace("{NOMBRE_JEFATURA_TBL_USUARIO}", ($datos[0]->nombre_completo_jefatura_tabla_usuario), $html);
    }
    //$html = str_replace("{NOMBRE}",($datos[0]->nombre_completo),$html);
    $html = str_replace("{CARGO_EVALUADO}", ($datos[0]->cargo), $html);
    $html = str_replace("{CARGO}", ($datos[0]->cargo), $html);
    $html = str_replace("{PERFIL_EVALUACION}", ($datos[0]->nombre_perfil), $html);
    $html = str_replace("{IMAGEN_EVALUADO}", VerificaFotoPersonal($datos[0]->rut), $html);
    $html = str_replace("{IMG_FOTO}", VerificaFotoPersonal($datos[0]->rut), $html);
    if ($texto_mensaje == 1) {
        $html = str_replace("{MENSAJE}", file_get_contents("views/sgd/validacion/texto_no_validacion.html"), $html);
    } elseif ($texto_mensaje == 2) {
        $html = str_replace("{MENSAJE}", file_get_contents("views/sgd/texto_no_objetivos_jefe.html"), $html);
    } elseif ($texto_mensaje == "bitacora") {
        $html = str_replace("{MENSAJE}", file_get_contents("views/sgd/bitacora/boton_ingreso_formulario.html"), $html);
    } elseif ($texto_mensaje == "planes") {
        $html = str_replace("{MENSAJE}", file_get_contents("views/sgd/planes/boton_ingreso_formulario.html"), $html);
    } elseif ($texto_mensaje == "graficoFrecuenciaCompetencia ") {
        $html = str_replace("{MENSAJE}", "", $html);
    } elseif ($texto_mensaje == "sinmensaje") {
        $html = str_replace("{MENSAJE}", "", $html);
    } else {
        $html = str_replace("{MENSAJE}", "", $html);
    }
    //Verifico si el usuario es JEfe, si es asi, coloca boton Mi Equipo
    $es_evaluador = VerSiEsEvaluador($rut);
    if ($es_evaluador) {
        $html = str_replace("{EQUIPO}", '<a href="?sw=sgd2_e&er=' . Encodear3($rut) . '"><button class="btnver btn-gray btn-sm"><i class="fa fa-users pad_r"></i>Ver Equipo</button></a>', $html);
    } else {
        $html = str_replace("{EQUIPO}", "", $html);
    }
    if (file_exists("docs/dc/" . $rut . ".pdf")) {
        $html = str_replace("{DESCRIPCIONCARGO}", file_get_contents("views/sgd/boton_descripcion_cargo.html"), $html);
        $html = str_replace("{RUT}", $rut, $html);
    } else {
        $html = str_replace("{DESCRIPCIONCARGO}", "", $html);
    }
    return ($html);
}
function BloqueCursosPendientes($bloque, $rut, $id_malla)
{
    $cursos_no_iniciados = CursosNoIniciados($rut, $id_malla);
    foreach ($cursos_no_iniciados as $otros) {
        $rows_cursos .= file_get_contents("views/cursos/capacitacion/row_cursos_pendientes_malla.html");
        ;
        $rows_cursos = str_replace("{NOMBRE_CURSO}", ($otros->nombre_curso), $rows_cursos);
    }
    $bloque = str_replace("{ROW_CURSOS_PENDIENTES}", $rows_cursos, $bloque);
    return ($bloque);
}
function OtrosCursosRealizados($PRINCIPAL, $rut, $id_malla)
{
    //echo "<br>$rut, $id_malla";
    //Funcion que trae datos de lso cursos que estan en inscripcion cierre pero que no estan en rel malla
    $otros_cursos = OtrosCursosNoMalla($rut, $id_malla);
    foreach ($otros_cursos as $otros) {
        $rows_cursos .= file_get_contents("views/cursos/capacitacion/row_listado_otros_cursos.html");
        ;
        $rows_cursos = str_replace("{NOMBRE_CURSO}", ($otros->nombre_curso), $rows_cursos);
        if ($otros->estado == 1) {
            $rows_cursos = str_replace("{ESTADO}", '<span class="etiquetaPrograma etiquetaPrograma-aprobado pull-left"><i class="fas fa-check-square"></i>&nbsp;&nbsp;Aprobado</span>', $rows_cursos);
            $rows_cursos = str_replace("{BARRA_ESTADO}", 'success', $rows_cursos);
            $rows_cursos = str_replace("{ICONO_ESTADO_CURSO}", '<i class="fas fa-check-square"></i>', $rows_cursos);
            $rows_cursos = str_replace("{AVANCE_CURSO}", 100, $rows_cursos);
            $cantidad_cursos_aprobados_por_clasificacion++;
        } else if ($otros->estado === '0') {
            $rows_cursos = str_replace("{ESTADO}", '<span class="etiquetaPrograma etiquetaPrograma-reprobado pull-left"><i class="far fa-times-circle"></i>&nbsp;&nbsp;Reprobado</span>', $rows_cursos);
            $rows_cursos = str_replace("{BARRA_ESTADO}", 'danger', $rows_cursos);
            $rows_cursos = str_replace("{ICONO_ESTADO_CURSO}", '<i class="far fa-times-circle"></i>', $rows_cursos);
            $rows_cursos = str_replace("{AVANCE_CURSO}", 100, $rows_cursos);
        } else if ($otros->estado == 3) {
            $rows_cursos = str_replace("{ESTADO}", '<span class="etiquetaPrograma etiquetaPrograma-proceso pull-left"><i class="fas fa-spinner"></i>&nbsp;En Proceso</span>', $rows_cursos);
            $rows_cursos = str_replace("{BARRA_ESTADO}", 'danger', $rows_cursos);
            $rows_cursos = str_replace("{ICONO_ESTADO_CURSO}", '<i class="icon-hourglass icons"></i>', $rows_cursos);
            $rows_cursos = str_replace("{AVANCE_CURSO}", 100, $rows_cursos);
        } else {
            $rows_cursos = str_replace("{ESTADO}", '<span class="etiquetaPrograma etiquetaPrograma-noiniciado pull-left"><i class="far fa-times-circle"></i>&nbsp;&nbsp;No Iniciado</span>', $rows_cursos);
            $rows_cursos = str_replace("{AVANCE_CURSO}", 0, $rows_cursos);
            $rows_cursos = str_replace("{ICONO_ESTADO_CURSO}", '<i class="icon-frame icons"></i>', $rows_cursos);
        }
    }
    if ($otros_cursos) {
        $PRINCIPAL = str_replace("{BLOQUE_OTROS_CURSOS_REALIZADOS}", file_get_contents("views/cursos/capacitacion/titulo_otros_cursos_realizados_malla.html"), $PRINCIPAL);
    } else {
        $PRINCIPAL = str_replace("{BLOQUE_OTROS_CURSOS_REALIZADOS}", "", $PRINCIPAL);
    }
    $PRINCIPAL = str_replace("{ROW_LISTADO_OTROS_CURSOS}", $rows_cursos, $PRINCIPAL);
    return ($PRINCIPAL);
}
function ColocarAvanceValidacionDadoRutValidador($PRINCIPAL, $rut_validador, $id_empresa)
{
    $evaluadores                  = TraeEvaluadoresDadoValidadorFijObjetivos($rut_validador, $id_empresa);
    $dimensiones_por_empresa      = DimensionesObjetivosPorEmpresa($id_empresa);
    $total_dimensiones            = 0;
    $total_fijaciones_finalizadas = 0;
    $total_fijaciones_proceso     = 0;
    $total_fijaciones_pendientes  = 0;
    $total_validadas              = 0;
    foreach ($evaluadores as $eva) {
        $total_dimensiones_evaluador            = 0;
        $total_fijaciones_finalizadas_evaluador = 0;
        $total_fijaciones_proceso_evaluador     = 0;
        $total_fijaciones_pendientes_evaluador  = 0;
        //$total_validadas_evaluador=0;
        unset($matriz_estados_generales_validador);
        $row .= file_get_contents("views/sgd/objetivos/row_evaluadores_lista_resumen.html");
        $row       = str_replace("{NOMBRE}", $eva->nombre_completo, $row);
        $row       = str_replace("{CARGO}", $eva->cargo, $row);
        $row       = str_replace("{RUT_EVALUADOR_ENCODEADO}", Encodear3($eva->evaluador), $row);
        $row       = str_replace("{URL_PERSONA}", VerificaFotoPersonal($eva->evaluador), $row);
        //Por cada colaborador, armo el menu de resumen
        $evaluados = TraeRelacionesSinAeSinProceso($eva->evaluador);
        foreach ($evaluados as $rut_eva) {
            //Por cada Evaluado, hago un foreach de dimensiones, y por cada dimension, veo si est? finalizada o no
            foreach ($dimensiones_por_empresa as $dimen) {
                $total_dimensiones++;
                $total_dimensiones_evaluador++;
                //Aca verifico si este evaluado para esta dimension est? finalizada o no.
                $estado_evaluado = VerificaEstadoDimensionesObjetivos($rut_eva->evaluado, $dimen->id, $id_empresa);
                $estado_validado = VerificaEstadoDimensionesObjetivosParaValidacion($rut_eva->evaluado, $dimen->id, $id_empresa);
                $matriz_estados_generales_validador[0]["total_total"]++;
                $matriz_validados_evaluador[0][total_total]++;
                if ($estado_validado[1] == 3) {
                    $total_validadas_evaluador[$dimen->id]["validadas"]++;
                    $total_fijaciones_validadas++;
                }
                if ($estado_evaluado[1] == 1) {
                    $total_fijaciones_finalizadas++;
                    $total_fijaciones_finalizadas_evaluador++;
                    $matriz_estados_generales_validador[$dimen->id]["estado_ingreso_finalizado"]++;
                }
                if ($estado_evaluado[1] == 2) {
                    $total_fijaciones_proceso++;
                    $total_fijaciones_proceso_evaluador++;
                    $matriz_estados_generales_validador[$dimen->id]["estado_enproceso_fijacion"]++;
                }
                if ($estado_evaluado[1] == 0) {
                    $total_fijaciones_pendientes++;
                    $total_fijaciones_pendientes_evaluador++;
                    $matriz_estados_generales_validador[$dimen->id]["estado_pendiente_fijacion"]++;
                }
            }
        }
        $row_dimensiones = "";
        //echo "echo $total_dimensiones_evaluador
        //<pre>";
        // print_r($matriz_estados_generales_validador);
        foreach ($dimensiones_por_empresa as $dimen) {
            $row_dimensiones .= file_get_contents("views/sgd/objetivos/row_resumen_por_dimension_evaluado.html");
            $row_dimensiones = str_replace("{NOMBRE_DIMENSION}", $dimen->nombre, $row_dimensiones);
            if ($matriz_estados_generales_validador[$dimen->id]["estado_ingreso_finalizado"] == $total_dimensiones_evaluador / 3) {
                $row_dimensiones = str_replace("{ESTADO}", '<span class="etiquetaPrograma etiquetaPrograma-aprobado pull-left"><i class="fas fa-check-square"></i>&nbsp;&nbsp;Ingresado</span>', $row_dimensiones);
            } else if ($matriz_estados_generales_validador[$dimen->id]["estado_enproceso_fijacion"] > 0 or $matriz_estados_generales_validador[$dimen->id]["estado_ingreso_finalizado"] < $total_dimensiones_evaluador) {
                $row_dimensiones = str_replace("{ESTADO}", '<span class="etiquetaPrograma etiquetaPrograma-proceso pull-left"><i class="far fa-times-circle"></i>&nbsp;&nbsp;Pendiente</span>', $row_dimensiones);
            } else {
                $row_dimensiones = str_replace("{ESTADO}", '<span class="etiquetaPrograma etiquetaPrograma-pendiente pull-left"><i class="far fa-times-circle"></i>&nbsp;&nbsp;Pendiente</span>', $row_dimensiones);
            }
            if ($total_validadas_evaluador[$dimen->id]["validadas"] == $total_dimensiones_evaluador / 3) {
                $row_dimensiones = str_replace("{ESTADO_VALIDACION}", '<span class="etiquetaPrograma etiquetaPrograma-aprobado pull-left"><i class="fas fa-check-square"></i>&nbsp;&nbsp;Validado</span>', $row_dimensiones);
            } else {
                $row_dimensiones = str_replace("{ESTADO_VALIDACION}", '<span class="etiquetaPrograma etiquetaPrograma-pendiente pull-left"><i class="far fa-times-circle"></i>&nbsp;&nbsp;Pendiente</span>', $row_dimensiones);
            }
        }
        $row = str_replace("{ROW_RESUMEN_POR_EVALUADO}", $row_dimensiones, $row);
    }
    $PRINCIPAL  = str_replace("{LISTADO_COLABORADORES}", ($row), $PRINCIPAL);
    //Avance Validador
    $arreglo[0] = EntregaPorcentaje($total_dimensiones, $total_fijaciones_validadas);
    $PRINCIPAL  = str_replace("{AVANCE_VALIDADOR_ETAPA}", $arreglo[0] . "%", $PRINCIPAL);
    return ($PRINCIPAL);
}
function EnviaCorreoAJefeDesdeValidador($rut_emisor, $rut_destinatario, $id_empresa)
{
    $datos_destinatario = UsuarioEnBasePersonas($destinatario);
    //print_r($datos_destinatario);exit;
    $datos_emisor       = UsuarioEnBasePersonas($rut_emisor);
    $datos_destinatario = UsuarioEnBasePersonas($rut_destinatario);
    $template_correo    = file_get_contents("views/sgd/objetivos/correos/email_a_jefe_de_validador.html");
    $template_correo    = str_replace("{NOMBRE_JEFE}", ($datos_destinatario[0]->nombre_completo), $template_correo);
    $template_correo    = str_replace("{NOMBRE_DEL_JEFE_DE_JEFE}", ($datos_emisor[0]->nombre_completo), $template_correo);
    $template_correo    = str_replace("{texto_mensaje}", ($mensaje), $template_correo);
    $asunto_mensaje     = TraeAsuntoDeMensaje($tipo_mensaje);
    $datos_empresa      = DatosEmpresa($id_empresa);
    $mail               = new PHPMailer;
    //Tell PHPMailer to use SMTP
    $mail->isSMTP(); //Enable SMTP debugging
    // 0 = off (for production use)
    // 1 = client messages
    // 2 = client and server messages
    $mail->SMTPDebug   = 1;
    //Ask for HTML-friendly debug output
    $mail->Debugoutput = 'error_log';
    //Set the hostname of the mail server
    $mail->Host        = $datos_empresa[0]->server;
    //Set the SMTP port number - likely to be 25, 465 or 587
    $mail->Port        = 25;
    //Whether to use SMTP authentication
    $mail->SMTPAuth    = true;
    //Username to use for SMTP authentication
    $mail->Username    = $datos_empresa[0]->envio_correos;
    //Password to use for SMTP authentication
    $mail->Password    = $datos_empresa[0]->envio_correos_pass;
    //Set who the message is to be sent from
    $mail->setFrom($datos_empresa[0]->envio_correos, $datos_empresa[0]->envio_correos);
    //Set an alternative reply-to address
    //$mail->addReplyTo('replyto@example.com', 'First Last');
    //Set who the message is to be sent to
    //$mail->addAddress($datos_destinatario[0]->email, $datos_destinatario[0]->nombre_completo);
    $mail->addAddress("daniel@gop.cl", $datos_destinatario[0]->nombre_completo);
    //$mail->addAddress("rod@gop.cl", $datos_destinatario[0]->nombre_completo);
    //$mail->addAddress("francisco.lopez@tnt.com", $datos_destinatario[0]->nombre_completo);
    //$mail->addAddress("rod@gop.cl", $datos_destinatario[0]->nombre_completo);
    $mail->AddBCC("backup@sgd.cl", "BCC: " . $datos_destinatario[0]->nombre_completo);
    //Set the subject line
    $mail->Subject = "" . $datos_emisor[0]->nombre_completo . " ha validado tu Fijacion de Objetivos";
    //Read an HTML message body from an external file, convert referenced images to embedded,
    //convert HTML into a basic plain-text alternative body
    $mail->msgHTML($template_correo, dirname(__FILE__));
    //Replace the plain text body with one created manually
    $mail->AltBody = 'Si no puedes visualizar este correo ....';
    //Attach an image file
    //$mail->addAttachment('images/phpmailer_mini.png');
    //send the message, check for errors
    if (!$mail->send()) {
        //echo "Mailer Error: " . $mail->ErrorInfo;
    } else {
        //echo "Message sent!";
    }
    //exit;
}
function EnviaCorreoAJefeDelJefeParaValidar($rut_emisor, $rut_destinatario, $id_empresa)
{
    $datos_destinatario = UsuarioEnBasePersonas($destinatario);
    //print_r($datos_destinatario);exit;
    $datos_emisor       = UsuarioEnBasePersonas($rut_emisor);
    $datos_destinatario = UsuarioEnBasePersonas($rut_destinatario);
    $template_correo    = file_get_contents("views/sgd/objetivos/correos/email_a_jefe_de_jefe.html");
    $template_correo    = str_replace("{NOMBRE_JEFE}", ($datos_emisor[0]->nombre_completo), $template_correo);
    $template_correo    = str_replace("{NOMBRE_DEL_JEFE_DE_JEFE}", ($datos_destinatario[0]->nombre_completo), $template_correo);
    $template_correo    = str_replace("{texto_mensaje}", ($mensaje), $template_correo);
    $asunto_mensaje     = TraeAsuntoDeMensaje($tipo_mensaje);
    $datos_empresa      = DatosEmpresa($id_empresa);
    $mail               = new PHPMailer;
    //Tell PHPMailer to use SMTP
    $mail->isSMTP(); //Enable SMTP debugging
    // 0 = off (for production use)
    // 1 = client messages
    // 2 = client and server messages
    $mail->SMTPDebug   = 1;
    //Ask for HTML-friendly debug output
    $mail->Debugoutput = 'error_log';
    //Set the hostname of the mail server
    $mail->Host        = $datos_empresa[0]->server;
    //Set the SMTP port number - likely to be 25, 465 or 587
    $mail->Port        = 25;
    //Whether to use SMTP authentication
    $mail->SMTPAuth    = true;
    //Username to use for SMTP authentication
    $mail->Username    = $datos_empresa[0]->envio_correos;
    //Password to use for SMTP authentication
    $mail->Password    = $datos_empresa[0]->envio_correos_pass;
    //Set who the message is to be sent from
    $mail->setFrom($datos_empresa[0]->envio_correos, $datos_empresa[0]->envio_correos);
    //Set an alternative reply-to address
    //$mail->addReplyTo('replyto@example.com', 'First Last');
    //Set who the message is to be sent to
    //$mail->addAddress($datos_destinatario[0]->email, $datos_destinatario[0]->nombre_completo);
    $mail->addAddress("daniel@gop.cl", $datos_destinatario[0]->nombre_completo);
    //$mail->addAddress("rod@gop.cl", $datos_destinatario[0]->nombre_completo);
    //$mail->addAddress("francisco.lopez@tnt.com", $datos_destinatario[0]->nombre_completo);
    //$mail->addAddress("rod@gop.cl", $datos_destinatario[0]->nombre_completo);
    $mail->AddBCC("backup@sgd.cl", "BCC: " . $datos_destinatario[0]->nombre_completo);
    //Set the subject line
    $mail->Subject = "" . $datos_emisor[0]->nombre_completo . " solicita validar Fijacion de Objetivos";
    //Read an HTML message body from an external file, convert referenced images to embedded,
    //convert HTML into a basic plain-text alternative body
    $mail->msgHTML($template_correo, dirname(__FILE__));
    //Replace the plain text body with one created manually
    $mail->AltBody = 'Si no puedes visualizar este correo ....';
    //Attach an image file
    //$mail->addAttachment('images/phpmailer_mini.png');
    //send the message, check for errors
    if (!$mail->send()) {
        //echo "Mailer Error: " . $mail->ErrorInfo;
    } else {
        //echo "Message sent!";
    }
    //exit;
}
function ComboBoxConductasCriticasDadoPerfilYCompetencias($id_perfil, $competencia, $conducta_seleccionada)
{
    $conducta = TraeConductasDadaIdCompetencia($competencia, $id_perfil);
    foreach ($conducta as $con) {
        if ($conducta_seleccionada == $con->id_conducta) {
            $options .= "<option selected value='" . $con->id_conducta . "'>" . $con->conducta . "</option>";
        } else {
            $options .= "<option value='" . $con->id_conducta . "'>" . $con->conducta . "</option>";
        }
    }
    return ($options);
}
function ComboBoxCompetenciasPorPerfil($id_perfil, $seleccionado)
{
    $competencias = CompetenciasDadoPerfilParaObjetivos($id_perfil);
    foreach ($competencias as $comp) {
        if ($seleccionado == $comp->id_componente_reporte) {
            $options .= "<option selected value='" . $comp->id_componente_reporte . "'>" . $comp->nombre . "</option>";
        } else {
            $options .= "<option value='" . $comp->id_componente_reporte . "'>" . $comp->nombre . "</option>";
        }
    }
    return ($options);
}
function VerificaEstadoDimensionesObjetivosParaValidacion($evaluado, $id_dimension, $id_empresa)
{
    //Verifico si se encuentra validado
    $objetivos_por_dimension_validados = VerificaSiObjetivosEstanValidadosPorDimension($evaluado, $id_dimension, $id_empresa);
    if ($objetivos_por_dimension_validados) {
        $arreglo[0] = '<span class="etiquetaPrograma etiquetaPrograma-aprobado pull-left"><i class="fas fa-check-square"></i>&nbsp;&nbsp;Validado</span>';
        $arreglo[1] = 3;
    } else {
        $datos_finalizado = VerificaDimensionFinalizadaObjetivos($evaluado, $id_dimension, $id_empresa);
        $arreglo[0]       = '<span class="etiquetaPrograma etiquetaPrograma-pendiente pull-left"><i class="far fa-times-circle"></i>&nbsp;&nbsp;Pendiente</span>';
        $arreglo[1]       = 2;
    }
    return ($arreglo);
}
function FormularioValidacionObjetivosV2($PRINCIPAL, $rut_fijador, $rut_evaluado, $id_empresa, $id_proceso, $id_objetivo, $rut_validador)
{
    $muestra_boton_envia_a_jefe = 0;
    //$datos_evaluado=UsuarioEnBasePersonas($rut_evaluado);
    $datos_evaluado             = UsuarioEnBasePersonasConEvaluadorValidador($rut_evaluado);
    $dimensiones_por_empresa    = DimensionesObjetivosPorEmpresa($id_empresa);
    $PRINCIPAL                  = str_replace("{BLOQUE_RESUMEN_COLABORADOR}", file_get_contents("views/sgd/objetivos/row_colaboradores_lista_resumen_superior.html"), $PRINCIPAL);
    $PRINCIPAL                  = str_replace("{NOMBRE}", ($datos_evaluado[0]->nombre_completo), $PRINCIPAL);
    $PRINCIPAL                  = str_replace("{PERFIL_COMPETENCIAS}", ($datos_evaluado[0]->perfil_competencia), $PRINCIPAL);
    $PRINCIPAL                  = str_replace("{JEFE}", ($datos_evaluado[0]->nombre_evaluador), $PRINCIPAL);
    $PRINCIPAL                  = str_replace("{JEFE_DEL_JEFE}", ($datos_evaluado[0]->nombre_validador), $PRINCIPAL);
    $PRINCIPAL                  = str_replace("{CARGO}", ($datos_evaluado[0]->cargo), $PRINCIPAL);
    $PRINCIPAL                  = str_replace("{FECHA_INGRESO}", ($datos_evaluado[0]->fecha_ingreso), $PRINCIPAL);
    $PRINCIPAL                  = str_replace("{URL_PERSONA}", VerificaFotoPersonal($rut_evaluado), $PRINCIPAL);
    $row_dimensiones            = "";
    foreach ($dimensiones_por_empresa as $dimen) {
        $row_dimensiones .= file_get_contents("views/sgd/objetivos/row_resumen_por_dimension_evaluado.html");
        $row_dimensiones             = str_replace("{NOMBRE_DIMENSION}", $dimen->nombre, $row_dimensiones);
        $estado_dimension            = VerificaEstadoDimensionesObjetivos($rut_evaluado, $dimen->id, $id_empresa);
        $row_dimensiones             = str_replace("{ESTADO}", $estado_dimension[0], $row_dimensiones);
        $estado_dimension_validacion = VerificaEstadoDimensionesObjetivosParaValidacion($rut_evaluado, $dimen->id, $id_empresa);
        $row_dimensiones             = str_replace("{ESTADO_VALIDACION}", $estado_dimension_validacion[0], $row_dimensiones);
    }
    $PRINCIPAL = str_replace("{ROW_RESUMEN_POR_EVALUADO}", ($row_dimensiones), $PRINCIPAL);
    //Por cada dimension, armo el formulario
    foreach ($dimensiones_por_empresa as $dimen) {
        //$estado_dimension=VerificaEstadoDimensionesObjetivos($rut_evaluado, $dimen->id, $id_empresa);
        $estado_dimension = VerificaEstadoDimensionesObjetivosParaValidacion($rut_evaluado, $dimen->id, $id_empresa);
        if ($estado_dimension[1] <> 3) {
            $formularios .= file_get_contents("views/sgd/objetivos/dimensiones/" . $dimen->template);
            $row_html = file_get_contents("views/sgd/objetivos/dimensiones/" . $dimen->row);
            $dimensiones_finalizadas++;
        } else {
            $formularios .= file_get_contents("views/sgd/objetivos/dimensiones/" . $dimen->template_lectura);
            $row_html = file_get_contents("views/sgd/objetivos/dimensiones/" . $dimen->row_lectura);
        }
        //$formularios.=file_get_contents("views/sgd/objetivos/dimensiones/".$dimen->template);
        //$row_html=file_get_contents("views/sgd/objetivos/dimensiones/".$dimen->row);
        //Aca veo si hay comentarios de esta dimension o no
        $tiene_comentarios = VerificaComentariosPorDimension($rut_fijador, $rut_evaluado, $dimen->id, $id_empresa);
        if ($tiene_comentarios) {
            $formularios = str_replace("{VALUE_ACCIONES_REALIZADAS}", ($tiene_comentarios[0]->acciones_realizadas), $formularios);
            $formularios = str_replace("{VALUE_IMPACTO}", ($tiene_comentarios[0]->impacto), $formularios);
            $formularios = str_replace("{CASE_FORM_COMEN_DIMENSION}", "updComDim", $formularios);
        } else {
            $formularios = str_replace("{VALUE_ACCIONES_REALIZADAS}", "", $formularios);
            $formularios = str_replace("{VALUE_IMPACTO}", "", $formularios);
            $formularios = str_replace("{CASE_FORM_COMEN_DIMENSION}", "saveComDim", $formularios);
        }
        $formularios               = str_replace("{NUMERO}", $dimen->orden, $formularios);
        $formularios               = str_replace("{NOMBRE_DIMENSION}", ($dimen->nombre), $formularios);
        $formularios               = str_replace("{CASE_FORM}", $dimen->case . "&val=1", $formularios);
        //$formularios = str_replace("{BOTON1}",file_get_contents("views/sgd/objetivos/BotonJefeJefeValida.html"),$formularios);
        $formularios               = str_replace("{BOTON1}", "", $formularios);
        $formularios               = str_replace("{ID_DIMENSION_ENCODEADO}", $dimen->id, $formularios);
        $formularios               = str_replace("{OPTIONS_PONDERACIONES}", PondObjetivos2(""), $formularios);
        $formularios               = str_replace("{OPTIONS_COMPETENCIAS}", (ComboBoxCompetenciasPorPerfil($datos_evaluado[0]->id_perfil_competencia, "")), $formularios);
        //Por cada formulario, veo si existen objetivos ingresados en esta dimension
        //$objetivos_ingresados=ObjetivosPodDimensionEmpresaUsuario($rut_evaluado, $id_empresa, $dimen->id);
        //Por cada formulario, veo si existen objetivos ingresados en esta dimension
        $objetivos_ingresados      = ObjetivosPodDimensionEmpresaUsuario($rut_evaluado, $id_empresa, $dimen->id, $datos_evaluado[0]->id_perfil_competencia);
        $suma_objetivos_ingresados = ObjetivosPodDimensionEmpresaUsuarioSumaPonderacion($rut_evaluado, $id_empresa, $dimen->id);
        if ($dimen->tiene_ponderacion == 1) {
            if (count($objetivos_ingresados) >= $dimen->minimo && count($objetivos_ingresados) <= $dimen->maximo && $suma_objetivos_ingresados[0]->suma_ponderaciones == 100) {
                $muestra_boton_envia_a_jefe++;
            }
        } else {
            if (count($objetivos_ingresados) >= $dimen->minimo && count($objetivos_ingresados) <= $dimen->maximo) {
                $muestra_boton_envia_a_jefe++;
            }
        }
        if ($objetivos_ingresados) {
            $formularios                = str_replace("{BLOQUE_LISTADO_OBJETIVOS_INGRESADOS}", file_get_contents("views/sgd/objetivos/dimensiones/" . $dimen->entornoLecturaForm), $formularios);
            $total_objetivos_ingresados = "";
            $k                          = 0;
            $suma_ponderacion           = 0;
            foreach ($objetivos_ingresados as $obj_ing) {
                $k++;
                //$total_objetivos_ingresados.=file_get_contents("views/sgd/objetivos/dimensiones/".$dimen->row);
                if ($id_objetivo == $obj_ing->id) {
                    $total_objetivos_ingresados .= file_get_contents("views/sgd/objetivos/dimensiones/edita_" . $dimen->row);
                } else {
                    $total_objetivos_ingresados .= $row_html;
                }
                //$total_objetivos_ingresados.=$row_html;
                $total_objetivos_ingresados = str_replace("{NUMERO}", $k, $total_objetivos_ingresados);
                $total_objetivos_ingresados = str_replace("{ID_DIMENSION}", $dimen->id, $total_objetivos_ingresados);
                $total_objetivos_ingresados = str_replace("{ID_DIMENSION_ENCODEADA}", Encodear3($dimen->id), $total_objetivos_ingresados);
                $total_objetivos_ingresados = str_replace("{PARAMETROS_VAL}", "&rval=" . $rut_validador, $total_objetivos_ingresados);
                $total_objetivos_ingresados = str_replace("{OBJETIVO}", ($obj_ing->descripcion_objetivo), $total_objetivos_ingresados);
                $total_objetivos_ingresados = str_replace("{ID_OBJETIVO_ENCODEADO}", Encodear3($obj_ing->id), $total_objetivos_ingresados);
                $total_objetivos_ingresados = str_replace("{ID_OBJETIVO}", ($obj_ing->id), $total_objetivos_ingresados);
                $total_objetivos_ingresados = str_replace("{ACCION}", ($obj_ing->accion_clave), $total_objetivos_ingresados);
                //$total_objetivos_ingresados = str_replace("{CONDUCTA_CRITICA}",($obj_ing->conducta_critica),$total_objetivos_ingresados);
                //$total_objetivos_ingresados = str_replace("{CONDUCTA_CRITICA}",($obj_ing->nombre_competencia),$total_objetivos_ingresados);
                $total_objetivos_ingresados = str_replace("{CONDUCTA_CRITICA}", ($obj_ing->nombre_conducta), $total_objetivos_ingresados);
                $total_objetivos_ingresados = str_replace("{COMPETENCIA}", ($obj_ing->nombre_competencia), $total_objetivos_ingresados);
                $total_objetivos_ingresados = str_replace("{COMENTARIO}", ($obj_ing->comentarios), $total_objetivos_ingresados);
                $total_objetivos_ingresados = str_replace("{ACCION_DESARROLLO}", ($obj_ing->acciones_desarrollo), $total_objetivos_ingresados);
                $total_objetivos_ingresados = str_replace("{RESPONSABLE}", ($obj_ing->responsable), $total_objetivos_ingresados);
                $total_objetivos_ingresados = str_replace("{FECHA}", ($obj_ing->fecha_limite), $total_objetivos_ingresados);
                $total_objetivos_ingresados = str_replace("{ENV_EDITAR}", "updobjetivoV2Val", $total_objetivos_ingresados);
                $total_objetivos_ingresados = str_replace("{PONDERACION}", ($obj_ing->ponderacion) . "%", $total_objetivos_ingresados);
                $total_objetivos_ingresados = str_replace("{OPTIONS_PONDERACIONES_INGRESADO}", PondObjetivos2($obj_ing->ponderacion) . "%", $total_objetivos_ingresados);
                //$total_objetivos_ingresados  = str_replace("{OPTIONS_COMPETENCIAS_INGRESADO}",(ComboBoxCompetenciasPorPerfil($datos_evaluado[0]->id_perfil_competencia, $obj_ing->conducta_critica)),$total_objetivos_ingresados );
                $total_objetivos_ingresados = str_replace("{OPTIONS_COMPETENCIAS_INGRESADO}", (ComboBoxCompetenciasPorPerfil($datos_evaluado[0]->id_perfil_competencia, $obj_ing->competencia)), $total_objetivos_ingresados);
                $total_objetivos_ingresados = str_replace("{OPTIONS_CONDUCTAS_CRITICAS}", (ComboBoxConductasCriticasDadoPerfilYCompetencias($datos_evaluado[0]->id_perfil_competencia, $obj_ing->competencia, $obj_ing->conducta_critica)), $total_objetivos_ingresados);
                $total_objetivos_ingresados = str_replace("{ACCIONES_REALIZADAS}", ($obj_ing->acciones_realizadas), $total_objetivos_ingresados);
                $total_objetivos_ingresados = str_replace("{IMPACTO}", ($obj_ing->impacto), $total_objetivos_ingresados);
                $total_objetivos_ingresados = str_replace("{TIPO_ACCION}", ($obj_ing->tipo_accion), $total_objetivos_ingresados);
                $total_objetivos_ingresados = str_replace("{SELECTED_" . ($obj_ing->tipo_accion) . "}", "selected", $total_objetivos_ingresados);
                $suma_ponderacion           = $suma_ponderacion + $obj_ing->ponderacion;
            }
            $formularios = str_replace("{ROW_INGRESADOS}", $total_objetivos_ingresados, $formularios);
            $formularios = str_replace("{TOTAL_PONDERACION}", $suma_ponderacion . "%", $formularios);
            $formularios = str_replace("{ID_PERFIL_COMPETENCIAS}", $datos_evaluado[0]->id_perfil_competencia, $formularios);
            if ($suma_ponderacion == 100) {
                $formularios = str_replace("{CLASE_PONDERACION}", "pond_correcto", $formularios);
            } else {
                $formularios = str_replace("{CLASE_PONDERACION}", "pond_alerta", $formularios);
            }
        } else {
            $formularios = str_replace("{ROW_INGRESADOS}", "NO", $formularios);
        }
    }
    //$PRINCIPAL = str_replace("{BOTON_ENVIA_A_VALIDAR_OBJETIVOS}",file_get_contents("views/sgd/objetivos/BotonJefeJefeValida.html"),$PRINCIPAL);
    if ($muestra_boton_envia_a_jefe == count($dimensiones_por_empresa) && $estado_dimension[1] <> 3) {
        $PRINCIPAL = str_replace("{BOTON_ENVIA_A_VALIDAR_OBJETIVOS}", file_get_contents("views/sgd/objetivos/BotonJefeJefeValida.html"), $PRINCIPAL);
    } else {
        $PRINCIPAL = str_replace("{BOTON_ENVIA_A_VALIDAR_OBJETIVOS}", "", $PRINCIPAL);
    }
    $PRINCIPAL = str_replace("{NUMERO_PASO}", count($dimensiones_por_empresa) + 1, $PRINCIPAL);
    $PRINCIPAL = str_replace("{BLOQUE_FORMULARIOS_POR_DIMENSIONES}", $formularios, $PRINCIPAL);
    $PRINCIPAL = str_replace("{RUT_EVALUADO_ENCODEADO}", Encodear3($rut_evaluado), $PRINCIPAL);
    return ($PRINCIPAL);
}
function LimpiaRutFront($rut)
{
        //echo "<br>-> LimpiaRutFront $rut";
    $rut         = str_replace(".", "", $rut);
    $rut         = str_replace(",", "", $rut);
    $arreglo_rut = explode("-", $rut);
        //print_r($arreglo_rut);

    $rut         = intval(preg_replace('/[^0-9]+/', '', $arreglo_rut[0]), 10);
        // echo "rut $rut";
    return ($rut);
}
function colocarColaboradoresPorRutSoloClick($PRINCIPAL, $id_empresa, $rut)
{
    $listado_colaboradores = TotalUsuariosPorRutJefe($rut);
    foreach ($listado_colaboradores as $unico) {
        $array_Reco_Gracias = BuscaDatosReconocimientoAgradecimientos($unico->rut, $id_empresa);
        //print_r($array_Reco_Gracias);
        if ($array_Reco_Gracias[0]->num_gracias > 0) {
            $num_gracias = $array_Reco_Gracias[0]->num_gracias;
        } else {
            $num_gracias = 0;
        }
        if ($array_Reco_Gracias[0]->num_reconocimientos > 0) {
            $num_reconocimientos = $array_Reco_Gracias[0]->num_reconocimientos;
        } else {
            $num_reconocimientos = 0;
        }
        // print_r($unico);
        //$row.=file_get_contents("views/miperfil/row_colaboradores_miperfil.html");
        //$row.=file_get_contents("views/mi_equipo_lms/row_equipo_resumen.html");
        //echo "" . $id_empresa . "_row_equipo_resumen_soloclick.html";

        $row .= file_get_contents("views/mi_equipo_lider/" . $id_empresa . "_row_equipo_resumen_soloclick.html");
        //$row = str_replace("{MEDALLAS}",$datos_consolidados[0]->medallas,$row);
        $row                              = str_replace("{MEDALLAS}", $medallas, $row);
        $row                              = str_replace("{NOMBRE}", $unico->nombre . " " . $unico->apaterno . " " . $unico->amaterno, $row);
        $row                              = str_replace("{CARGO}", $unico->cargo, $row);
        $row                              = str_replace("{GERENCIA}", $unico->gerencia, $row);
        $row                              = str_replace("{FECHA_CUMPLEANOS}", formatearFecha($unico->fecha_nacimiento), $row);
        $row                              = str_replace("{URL_PERSONA}", VerificaFotoPersonal($unico->rut), $row);
        $row                              = str_replace("{RUT_ENCODEADO}", Encodear3($unico->rut), $row);
        $row                              = str_replace("{RUT_COL}", ($unico->rut), $row);
        $row                              = str_replace("{NUM_RECONOCIMIENTOS}", $num_reconocimientos, $row);
        $row                              = str_replace("{NUM_GRACIAS}", $num_gracias, $row);
        $row                              = str_replace("{ACCION}", ($accion), $row);
        $acumulador_visitas_colaboradores = $acumulador_visitas_colaboradores + $total_visitas[0]->total_visitas;
        $cuenta_colaborador++;
    }
    $lms_graf_acciones_verde = $sum_verde;
    $PRINCIPAL               = str_replace("{NUM_PERSONAS_MI_EQUIPO}", count($listado_colaboradores), $PRINCIPAL);
    $PRINCIPAL               = str_replace("{PROMEDIO_EQUIPO}", round($acumulador_avance_colaboradores / count($listado_colaboradores)), $PRINCIPAL);
    $PRINCIPAL               = str_replace("{NUM_VISITAS_MI_EQUIPO}", $acumulador_visitas_colaboradores, $PRINCIPAL);
    $PRINCIPAL               = str_replace("{BLOQUE_COLABORADORES}", ($row), $PRINCIPAL);
    $PRINCIPAL               = str_replace("{LMS_GRAFICO_1COLOR}", file_get_contents("views/mi_equipo_lms/" . $id_empresa . "_barra_1color.html"), $PRINCIPAL);
    $PRINCIPAL               = str_replace("{LMS_AVANCEEQUIPO}", $lms_avance_equipo, $PRINCIPAL);
    $PRINCIPAL               = str_replace("{LMS_GRAFICO_3COLORES}", file_get_contents("views/mi_equipo_lms/" . $id_empresa . "_barra_3colores.html"), $PRINCIPAL);
    $PRINCIPAL               = str_replace("{VALUEVERDE}", $lms_graf_acciones_verde, $PRINCIPAL);
    $PRINCIPAL               = str_replace("{VALUEAMARILLO}", $lms_graf_acciones_amarillo, $PRINCIPAL);
    $PRINCIPAL               = str_replace("{VALUEROJO}", $lms_graf_acciones_rojo, $PRINCIPAL);
    $PRINCIPAL               = str_replace("{LMS_NUM_PENDIENTES}", $num_acciones_pendientes, $PRINCIPAL);
    return ($PRINCIPAL);
}

function colocarNotificacionesEncuestas($PRINCIPAL, $id_empresa, $rut, $hoy)
{
    $listado_notificacionesEncuestas = NotificacionesEncuestasPendientes($rut, $hoy, $id_empresa);
    //print_r($listado_notificacionesEncuestas);
    $cuenta_pendientes=0;
    foreach ($listado_notificacionesEncuestas as $unico) {


        if($unico->respuestas>=$unico->preguntas){
            //echo "listo";


        } else {
            //echo "pendiente";
            $cuenta_pendientes++;


        }
    }


    if($cuenta_pendientes>0){
    $AlertaNotificar="
        <div class='alert alert-warning' role='alert'>
            <strong>Encuestas Pendientes</strong>: Tienes una encuesta pendiente de realizar.
            <a href='?sw=medicion_encuestas' class='btn btn-info btn-sm'>Ingresa aqu?</a>
        </div>";

    } else {
    $AlertaNotificar="
        ";


    }

    $lms_graf_acciones_verde = $sum_verde;

    $PRINCIPAL               = str_replace("{NOTIFICACIONES_PENDIENTES}", ($AlertaNotificar), $PRINCIPAL);

    return ($PRINCIPAL);
}



function OfertaAbierta_Dimensiones($PRINCIPAL, $id_empresa)
{
    $listado = OfertaAbiertaDimensionData($id_empresa);
    //print_r($listado);
    foreach ($listado as $unico) {

        $row_ULTIMOS .= file_get_contents("views/oferta_abierta/" . $id_empresa . "_row_dimension.html");
        $row_ULTIMOS = str_replace("{ID_DIMENSION}", $unico->id, $row_ULTIMOS);
        $row_ULTIMOS = str_replace("{DIMENSION}",      $unico->text, $row_ULTIMOS);

    }
    $PRINCIPAL = str_replace("{DIMENSIONES_OFERTA_ABIERTA_LMS_DIMENSIONES_CURSOS}", ($row_ULTIMOS), $PRINCIPAL);
    return ($PRINCIPAL);
}

function OfertaAbierta_Cursos($PRINCIPAL, $id_empresa)
{
    $listado = OfertaAbiertaCursosDimensionData($id_empresa);
    foreach ($listado as $unico) {

        $row_ULTIMOS .= file_get_contents("views/oferta_abierta/" . $id_empresa . "_row_cursos.html");
        $row_ULTIMOS = str_replace("{ID_DIMENSION}", $unico->id_dimension, $row_ULTIMOS);
        $row_ULTIMOS = str_replace("{IMAGEN}", $unico->imagen, $row_ULTIMOS);
        $row_ULTIMOS = str_replace("{NOMBRE_CURSO}", $unico->curso, $row_ULTIMOS);
        $row_ULTIMOS = str_replace("{DIMENSION}", $unico->dimension, $row_ULTIMOS);

        $cuenta_colaborador++;
    }
    $PRINCIPAL = str_replace("{DIMENSIONES_OFERTA_ABIERTA_LMS_CURSOS}", ($row_ULTIMOS), $PRINCIPAL);
    return ($PRINCIPAL);
}

function OfertaAbierta_Dimension_Cursos($PRINCIPAL, $rut, $id_dimension, $id_empresa)
{
    $listado = OfertaAbiertaCursosEventosDimensionData($id_dimension,$id_empresa);


foreach ($listado as $unico) {

        $EstoyInscrito=OfertaAbierta_miinscripcion($rut, $unico->codigo, $id_empresa);
        //echo  "EstoyInscrito $EstoyInscrito";

        $row_ULTIMOS .= file_get_contents("views/oferta_abierta/" . $id_empresa . "_row_cursos.html");
        $row_ULTIMOS = str_replace("{ID_DIMENSION}", $unico->id_dimension, $row_ULTIMOS);
        $row_ULTIMOS = str_replace("{IMAGEN}", $unico->imagen, $row_ULTIMOS);
        $row_ULTIMOS = str_replace("{NOMBRE_POSTULABLE}", $unico->nombre, $row_ULTIMOS);
        $row_ULTIMOS = str_replace("{DESCRIPCION_POSTULABLE}", $unico->descripcion, $row_ULTIMOS);
        $row_ULTIMOS = str_replace("{INSTRUCCION}", $unico->instruccion, $row_ULTIMOS);

        $row_ULTIMOS = str_replace("{CUPOS}", $unico->cupos, $row_ULTIMOS);
        $row_ULTIMOS = str_replace("{DISPONIBLES}", $unico->disponibles, $row_ULTIMOS);
        $row_ULTIMOS = str_replace("{FICHA_CURSO}", "", $row_ULTIMOS);
        $row_ULTIMOS = str_replace("{FICHA}", $unico->ficha, $row_ULTIMOS);

        $row_ULTIMOS = str_replace("{DATO1}", "", $row_ULTIMOS);
        $row_ULTIMOS = str_replace("{TXTO_FALTAN}", "", $row_ULTIMOS);
        $row_ULTIMOS = str_replace("{MENU_SECUNDARIO}", "", $row_ULTIMOS);
        $row_ULTIMOS = str_replace("{INSCRITOS}", $unico->inscritos, $row_ULTIMOS);
        $row_ULTIMOS = str_replace("{ICONO}", $unico->icono, $row_ULTIMOS);
               $cupos=$unico->cupos;
               $inscritos= $unico->inscritos;
        $disponibles= ($cupos-$inscritos);

        //echo "<br>disponibles $disponibles, $cupos - $inscritos";
        $row_ULTIMOS = str_replace("{CUPOS_DISPONIBLES}", $disponibles, $row_ULTIMOS);


  //BOTON inscribirme o ya estoy inscrito y desistir
            $codigo_enc=Encodear3($unico->codigo);

  if($EstoyInscrito==0){
      if($disponibles>0){
     $inscribirme="

     <br /><a href='?sw=save_inscripcion_evento_inscribete&id_postulable=" . $codigo_enc . "'
        class='btn btn-info' style='padding:10px'><span class='blanco'>Quiero Asistir</span></a><br />
          ";             } else {
      $inscribirme="<span class='badge badge-warning badge-lg'><span class='blanco'><i class='fas fa-check-circle'></i> Cupos Completos</span></span>";

          }
  }   else {

    $inscribirme="
    <span class='badge badge-success badge-lg'><span class='blanco'><i class='fas fa-check-circle'></i> Ya est&aacute;s inscrito</span></span>

    <br><br><a href='?sw=save_inscripcion_evento_inscribete_delete&id_postulable=" . $codigo_enc . "'
        class='btn btn-danger btn-sm'><span class='blanco'>desistir de Postulaci&oacute;n</span></a>
       ";

  }

        $row_ULTIMOS = str_replace("{INSCRIBIRME}", $inscribirme, $row_ULTIMOS);

        $row_ULTIMOS = str_replace("{DIMENSION}", $unico->dimension, $row_ULTIMOS);

        $cuenta_colaborador++;
    }
    $PRINCIPAL = str_replace("{DIMENSIONES_OFERTA_ABIERTA_LMS_CURSOS}", ($row_ULTIMOS), $PRINCIPAL);
    return ($PRINCIPAL);
}


function formacion_continua_modalidad($PRINCIPAL, $id_empresa)
{
    $listado = FormacionContinua_ModalidadData($id_empresa);
    //print_r($listado);
    foreach ($listado as $unico) {

        $row_ULTIMOS .= file_get_contents("views/formacion_continua/" . $id_empresa . "_row_agrupacion.html");
        $row_ULTIMOS = str_replace("{ID_AGRUPACION}",      $unico->id_agrupacion, $row_ULTIMOS);
        $row_ULTIMOS = str_replace("{AGRUPACION}",      $unico->agrupacion, $row_ULTIMOS);

    }
    $PRINCIPAL = str_replace("{FORMACION_CONTINUA_MODALIDAD}", ($row_ULTIMOS), $PRINCIPAL);
    return ($PRINCIPAL);
}

function formacion_continua_agrupaciones($PRINCIPAL, $id_empresa)
{
    $listado = FormacionContinua_AgrupacionData($id_empresa);
    //print_r($listado);
    foreach ($listado as $unico) {

        $row_ULTIMOS .= file_get_contents("views/formacion_continua/" . $id_empresa . "_row_agrupacion.html");
        $row_ULTIMOS = str_replace("{ID_AGRUPACION}",      $unico->id_agrupacion, $row_ULTIMOS);
        $row_ULTIMOS = str_replace("{AGRUPACION}",      $unico->agrupacion, $row_ULTIMOS);

    }
    $PRINCIPAL = str_replace("{FORMACION_CONTINUA_AGRUPACIONES}", ($row_ULTIMOS), $PRINCIPAL);
    return ($PRINCIPAL);
}

function formacion_continua_competencias($PRINCIPAL, $id_empresa)
{
    $listado = FormacionContinua_CompetenciasData($id_empresa);
    //print_r($listado);
    foreach ($listado as $unico) {

        $row_ULTIMOS .= file_get_contents("views/formacion_continua/" . $id_empresa . "_row_competencias.html");
        $row_ULTIMOS = str_replace("{ID_COMPETENCIA}",      $unico->id_competencia, $row_ULTIMOS);
        $row_ULTIMOS = str_replace("{COMPETENCIA}",      $unico->competencia, $row_ULTIMOS);

    }
    $PRINCIPAL = str_replace("{FORMACION_CONTINUA_COMPETENCIAS}", ($row_ULTIMOS), $PRINCIPAL);
    return ($PRINCIPAL);
}


function formacion_continua_cursos($PRINCIPAL, $id_empresa)
{

    $rut=$_SESSION["user_"];
    $array_usuario=TraeDatosBiografiayUsuario($rut, $id_empresa);
    //print_r($array_usuario);
    $esjefe=EsJefetblUsuario($rut, $id_empresa);
    if($id_empresa=="75"){
        $listado = FormacionContinua_CursosDataRUT($id_empresa, $array_usuario[0]->regional, $esjefe, $rut);

    }   else {
       $listado = FormacionContinua_CursosData($id_empresa, $array_usuario[0]->regional, $esjefe);

    }
    //print_r($listado);

    foreach ($listado as $unico) {
        //echo "<br><br>rut ".$unico->rut;

        if($unico->cuenta==0){continue;}

        $row_ULTIMOS .= file_get_contents("views/formacion_continua/" . $id_empresa . "_row_cursos.html");
        $row_ULTIMOS = str_replace("{ID_AGRUPACION1}",         $unico->id_agrupacion1, $row_ULTIMOS);
        $row_ULTIMOS = str_replace("{ID_AGRUPACION2}",         $unico->id_agrupacion2, $row_ULTIMOS);
        $row_ULTIMOS = str_replace("{ID_AGRUPACION3}",         $unico->id_agrupacion3, $row_ULTIMOS);

        $row_ULTIMOS = str_replace("{ID_COMPETENCIA1}",     $unico->id_competencia1, $row_ULTIMOS);
        $row_ULTIMOS = str_replace("{ID_COMPETENCIA2}",     $unico->id_competencia2, $row_ULTIMOS);
        $row_ULTIMOS = str_replace("{ID_COMPETENCIA3}",         $unico->id_competencia3, $row_ULTIMOS);

        $row_ULTIMOS = str_replace("{ID_MODALIDAD}", $unico->id_modalidad, $row_ULTIMOS);

        $row_ULTIMOS = str_replace("{IMAGEN}", $unico->imagen, $row_ULTIMOS);
        $row_ULTIMOS = str_replace("{NOMBRE}", $unico->dimension, $row_ULTIMOS);
        $row_ULTIMOS = str_replace("{ID_CURSO_ENCODEADO}",     Encodear3($unico->id_dimension), $row_ULTIMOS);

        $cuenta_colaborador++;
    }
    $PRINCIPAL = str_replace("{FORMACION_CONTINUA_CURSOS}", ($row_ULTIMOS), $PRINCIPAL);
    return ($PRINCIPAL);
}

function playbook_paginas($PRINCIPAL, $id_empresa, $home){

    $array_paginas=playbook_paginas_data($id_empresa, $home);
    //print_r($array_paginas);
    foreach($array_paginas as $unico ){
            $row .= file_get_contents("views/playbook/" . $id_empresa . "_pagina_row.html");
            $row = str_replace("{ID_PAGINA}",               $unico->id_pagina, $row);
            $row = str_replace("{ID_TEMA_ENCODEADO}",       Encodear3($home), $row);
            $row = str_replace("{NOMBRE_PAGINA}",           $unico->nombre, $row);
            $url="?sw=playbook_pagina&id_p=".Encodear3($unico->id_pagina);
            $row = str_replace("{URL}",                     $url, $row);
            $row_sc="";
            $array_seccion=playbook_secciones_de_pagina_data($unico->id_pagina, $id_empresa);
                //print_r($array_seccion);
                foreach($array_seccion as $unico2 ){
                        $row_sc .= file_get_contents("views/playbook/" . $id_empresa . "_seccion_row.html");
                        $row_sc = str_replace("{ID_PAGINA}",             $unico->id_pagina, $row_sc);
                        $row_sc = str_replace("{NOMBRE_SECCION}",        $unico2->nombre, $row_sc);
                        $row_sc = str_replace("{CONTENIDO_SECCION}",     $unico2->contenido, $row_sc);
                        $url_SC="?sw=playbook_pagina&id_p=".Encodear3($unico->id_pagina)."#".$unico2->id_seccion;
                        $row_sc = str_replace("{URL_SECCION}",                   $url_SC, $row_sc);

                }
             $row = str_replace("{LINK_SECCION}",                     $row_sc, $row);
    }
    $PRINCIPAL = str_replace("{HOME_LISTA_PAGINAS}", ($row), $PRINCIPAL);
    return ($PRINCIPAL);

}

function playbook_temas($PRINCIPAL, $id_empresa, $home){

    $array_temas=playbook_temas_data($id_empresa, $home);
    //print_r($array_temas);
    foreach($array_temas as $unico ){
            $row .= file_get_contents("views/playbook/" . $id_empresa . "_row_temas.html");
            $row = str_replace("{ID_TEMA}",               Encodear3($unico->id_home), $row);
            $row = str_replace("{NOMBRE_TEMA}",           $unico->nombre, $row);
            $row = str_replace("{URL}",                   $url, $row);


            //$array_seccion=playbook_secciones_de_pagina_data($unico->id_pagina, $id_empresa);

    }
    $PRINCIPAL = str_replace("{HOME_LISTA_TEMAS}", ($row), $PRINCIPAL);
    return ($PRINCIPAL);
}

function PlayBook_busca_Menu_Pagina($PRINCIPAL, $id_empresa,$id_home){

    $array_paginas=playbook_pagina_menu_data($id_pagina, $id_empresa,$id_home);
    //print_r($array_paginas);
    foreach($array_paginas as $unico ){
            $row_sc .= file_get_contents("views/playbook/" . $id_empresa . "_row_home.html");


            $row_sc = str_replace("{URL}",               "?sw=playbook_pagina&id_p=".Encodear3($unico->id_pagina)."", $row_sc);
            $row_sc = str_replace("{TITULO}",           $unico->nombre, $row_sc);
            $row_sc = str_replace("{DESCRIPCION}",      $unico->descripcion, $row_sc);
            $row_sc = str_replace("{ID_TEMA_ENCODEADO}",    Encodear3($id_home), $row_sc);
            $row_sc = str_replace("{ID_PAGINA_ENCODEADO}",  Encodear3($unico->id_pagina), $row_sc);
            $row_sc = str_replace("{TITULO}",           $unico->nombre, $row_sc);

    }
    $PRINCIPAL = str_replace("{LISTA_PAGINAS_BOTONES_MENU}", ($row_sc), $PRINCIPAL);
    return ($PRINCIPAL);

}

function PlayBook_busca_Pagina($PRINCIPAL, $id_pagina, $id_empresa){

    $array_seccion=playbook_secciones_de_pagina_data($id_pagina, $id_empresa);
    //print_r($array_seccion);
    foreach($array_seccion as $unico ){
            $row_sc .= file_get_contents("views/playbook/" . $id_empresa . "_seccion.html");

             if($unico->imagen<>''){
                $row_sc = str_replace("{IMAGEN_SECCION}",               "<img src='multimedia/".$unico->imagen."' width='350px'>", $row_sc);
             } else {
                $row_sc = str_replace("{IMAGEN_SECCION}",               "", $row_sc);
             }
            $row_sc = str_replace("{ID_PAGINA}",                            $unico->id_pagina, $row_sc);
            $row_sc = str_replace("{ID_PAGINA_ENCODEADO}",                  Encodear3($unico->id_pagina), $row_sc);
            $row_sc = str_replace("{ID_SECCION}",                           $unico->id_seccion, $row_sc);
            $row_sc = str_replace("{ID_SECCION_ENCODEADO}",                 Encodear3($unico->id_seccion), $row_sc);
            $row_sc = str_replace("{NOMBRE_SECCION}",                       $unico->nombre, $row_sc);
            $row_sc = str_replace("{CONTENIDO_SECCION}",                    $unico->contenido, $row_sc);
            $url="?sw=playbook_pagina&id_p=".Encodear3($unico->id_pagina);
            $row_sc = str_replace("{URL}",                     $url, $row_sc);

    }
    $PRINCIPAL = str_replace("{HOME_LISTA_SECCIONES}", ($row_sc), $PRINCIPAL);
    return ($PRINCIPAL);

}

function PlayBook_busca_Menu_SubPagina($PRINCIPAL, $id_pagina, $id_empresa){

    $array_subpaginas=playbook_paginas_de_pagina_data($id_pagina, $id_empresa);
    //print_r($array_seccion);
    foreach($array_subpaginas as $unico ){
            $row_sc .= file_get_contents("views/playbook/" . $id_empresa . "_row_menu_subpagina.html");
            $row_sc = str_replace("{ID_PAGINA}",                    $unico->id_home, $row_sc);
            $row_sc = str_replace("{ID_SUBPAGINA}",                 $unico->id_pagina, $row_sc);
            $row_sc = str_replace("{NOMBRE_PAGINA}",                $unico->nombre, $row_sc);
            $url="?sw=playbook_pagina_sub&id_p=".Encodear3($unico->id_home)."&id_subp=".Encodear3($unico->id_pagina);
            $row_sc = str_replace("{URL}",                          $url, $row_sc);
    }
    $PRINCIPAL = str_replace("{URL_SUBPAGINA_MENU}", ($row_sc), $PRINCIPAL);
    return ($PRINCIPAL);

}

function PlayBook_busca_Menu_Seccion($PRINCIPAL, $id_pagina, $id_empresa){

    $array_menusecciones=playbook_menu_secciones_de_pagina_data($id_pagina, $id_empresa);
    //print_r($array_menusecciones);
    foreach($array_menusecciones as $unico ){
            $row_sc .= file_get_contents("views/playbook/" . $id_empresa . "_row_menu_secciones.html");
            $row_sc = str_replace("{ID_PAGINA}",                    $unico->id_pagina, $row_sc);
            $row_sc = str_replace("{NOMBRE_PAGINA}",                $unico->nombre, $row_sc);
            //$url="?sw=playbook_pagina_sub&id_p=".Encodear3($unico->id_home)."&id_subp=".Encodear3($unico->id_pagina);
            $url="?sw=playbook_pagina&id_p=".Encodear3($unico->id_pagina)."#".$unico->id_seccion;
            $row_sc = str_replace("{URL}",                          $url, $row_sc);
    }
    $PRINCIPAL = str_replace("{URL_SUBPAGINA_SECCIONES}", ($row_sc), $PRINCIPAL);
    return ($PRINCIPAL);

}

function SkillMuestraTxt($id_curso, $id_empresa){

   //echo "<br>$id_curso, $id_empresa";

    $array_curso    =Skill_Info_id_Curso($id_curso, $id_empresa);
    //print_r($array_curso);

    $plataforma =$array_curso[0]->plataforma;
    $url        =$array_curso[0]->url;
    $proveedor  =$array_curso[0]->proveedor;
    $curso          =($array_curso[0]->curso);

    $array_mensaje  =SkillBuscaMensaje($plataforma, $url, $id_empresa);

    //print_r($array_mensaje);
    if($url<>'PROXIMAMENTE'){
        $mensaje=($array_mensaje[0]->mensaje);
    } else {
        $mensaje=($array_mensaje[0]->mensaje_proximamente);
        $url="";
    }
        $textoboton=($array_mensaje[0]->textoboton);
    //echo "<br>$plataforma, $url, $proveedor, mensaje $mensaje, textoboton $textoboton";//exit();
    $arreglo[0]=$curso;
    $arreglo[1]=$plataforma;
    $arreglo[2]=$url;
    $arreglo[3]=$proveedor;
    $arreglo[4]=$mensaje;
    $arreglo[5]=$textoboton;

    return ($arreglo);
}

function formacion_continua_cursos_skills($PRINCIPAL, $rut, $parametro,$id_empresa)
{

    $rut=$_SESSION["user_"];
    $array_usuario=TraeDatosBiografiayUsuario($rut, $id_empresa);
    $esjefe=EsJefetblUsuario($rut, $id_empresa);
    $array_skill=Ass_Busca_Equipo_con_RutCol_Cargo_skill($rut, $id_empresa);

   // print_r($array_skill);
    //echo "<br>";
    $listado = FormacionContinua_Cursos_SkillsData($id_empresa, $rut, $parametro, $array_skill[0]->id_cargo);

    //print_r($listado);

if($parametro=="full"){
         $row_ULTIMOS .= file_get_contents("views/formacion_continua/" . $id_empresa . "_row_cursos_skill.html");

     foreach ($listado as $unico) {
            // echo "<br>hola".$unico->PROYECTO;
      if($unico->proveedor=="PROYECTO"){
               //echo "<br>A<br>";
            $row_ULTIMOS2.= file_get_contents("views/formacion_continua/" . $id_empresa . "_row_lista_cursos_skill_proyecto_".$unico->nom_nivel_skill.".html");
            //echo "views/formacion_continua/" . $id_empresa . "_row_lista_cursos_skill_proyecto_".$unico->nom_nivel_skill.".html";
                                         } else {  // echo "<br>B<br>";
            $row_ULTIMOS2.= file_get_contents("views/formacion_continua/" . $id_empresa . "_row_lista_cursos_skill.html");
                                         }
            //$row_ULTIMOS2.= file_get_contents("views/formacion_continua/" . $id_empresa . "_row_lista_cursos_skill.html");

            $url_texto="Ir al Curso";
            $url_texto2="Ver Info del Curso";
            $estado_url_texto="primary";
            $url="?sw=formacion_continua_skills&idus=".Encodear3($unico->id_curso);
            $url2="".$unico->Id_Skill_url."";
            $row_ULTIMOS2 = str_replace("{ICONO}",          "<i class='fas fa-chevron-circle-right'></i>", $row_ULTIMOS2);
            $row_ULTIMOS2 = str_replace("{NOMBRE_CURSO}",   ($unico->curso), $row_ULTIMOS2);
            $row_ULTIMOS2 = str_replace("{DESCRIPCION}",    ($unico->descripcion_curso), $row_ULTIMOS2);
            $row_ULTIMOS2 = str_replace("{PLATAFORMA}",     ($unico->plataforma), $row_ULTIMOS2);
            $row_ULTIMOS2 = str_replace("{LINK}",           ($url), $row_ULTIMOS2);
            $row_ULTIMOS2 = str_replace("{LINK_TEXT}",           ($url_texto), $row_ULTIMOS2);
            $row_ULTIMOS2 = str_replace("{ESTADO_TEXT}",           ($estado_url_texto), $row_ULTIMOS2);
            $row_ULTIMOS2 = str_replace("{ID_SKILL}", ($unico->id_skill), $row_ULTIMOS2);

            $row_ULTIMOS2 = str_replace("{LINK2}",           ($url2), $row_ULTIMOS2);
            $row_ULTIMOS2 = str_replace("{LINK_TEXT2}",           ($url_texto2), $row_ULTIMOS2);
            $row_ULTIMOS2 = str_replace("{ESTADO_TEXT2}",           ("primary"), $row_ULTIMOS2);


            //echo "<br>".$row_ULTIMOS2;
            //exit() ;
            $row_ULTIMOS2 = str_replace("{CURSO_INSCRITO}",     "", $row_ULTIMOS2);
            $row_ULTIMOS2 = str_replace("{CONVALIDADO_EXIMIDA}","", $row_ULTIMOS2);


     }
    $row_ULTIMOS = str_replace("{LISTA_CURSOS_SKILLS_PERSONAL}",     $row_ULTIMOS2, $row_ULTIMOS);


}   else {


    foreach ($listado as $unico) {
        //echo "<br>hola";
        //echo "<br>hola".$unico->proyecto;
        $row_ULTIMOS .= file_get_contents("views/formacion_continua/" . $id_empresa . "_row_cursos_skill.html");



        $row_ULTIMOS = str_replace("{IMAGEN}", "img/iddim_01.jpg", $row_ULTIMOS);
        $row_ULTIMOS = str_replace("{NOMBRE}", ($unico->Skill), $row_ULTIMOS);
        //$row_ULTIMOS = str_replace("{ID_SKILL}", ($unico->Id_Skill), $row_ULTIMOS);
        $row_ULTIMOS = str_replace("{ID_CURSO_ENCODEADO}",     Encodear3($unico->id_dimension), $row_ULTIMOS);
        if($unico->opcion_por_desarrollar=="Skill Eximida" or $unico->opcion_por_desarrollar=="Skill Convalidada"){
            $row_ULTIMOS = str_replace("{CONVALIDADO_EXIMIDA}",     "<span class='badge badge-success'><span class='blanco'>".$unico->opcion_por_desarrollar."</span></span>", $row_ULTIMOS);
        } else {
            $row_ULTIMOS = str_replace("{CONVALIDADO_EXIMIDA}",     "", $row_ULTIMOS);
        }

        // busca cursos especificos
        $lista_cursos= FormacionContinua_Cursos_Por_SkillsData($id_empresa, $rut, $array_skill[0]->id_cargo, $unico->id_skill, $unico->nivel );
        //print_r($lista_cursos);
        $row_ULTIMOS2="";
        foreach ($lista_cursos as $unico2){
            //PRINT_R($unico2);

            //echo "<br>".$unico2->inscripcion;
        //echo "<br>hola ".$unico2->proveedor;
        if($unico2->proveedor=="PROYECTO"){        //echo "<br>A<br>";
            $row_ULTIMOS2.= file_get_contents("views/formacion_continua/" . $id_empresa . "_row_lista_cursos_skill_proyecto_".$unico2->nom_nivel_skill.".html");
            //echo "views/formacion_continua/" . $id_empresa . "_row_lista_cursos_skill_proyecto_".$unico2->nom_nivel_skill.".html";
                                         } else {  // echo "<br>B<br>";
            $row_ULTIMOS2.= file_get_contents("views/formacion_continua/" . $id_empresa . "_row_lista_cursos_skill.html");
                                         }

            if($unico2->idinscripcion>0){
                $url_texto="Ir al Curso";
                $estado_url_texto="primary";
            }
            else {
                $url_texto="Ir al Curso";
                $estado_url_texto="primary";
            }
                        $url_texto2="Ver Info del Curso";
                                    $url2="".$unico->Id_Skill_url."";

            //echo "$url_texto $estado_url_texto";
            $url="?sw=formacion_continua_skills&idus=".Encodear3($unico2->id_curso);
            $row_ULTIMOS2 = str_replace("{ICONO}",          "<i class='fas fa-chevron-circle-right'></i>", $row_ULTIMOS2);
            $row_ULTIMOS2 = str_replace("{NOMBRE_CURSO}",   ($unico2->curso), $row_ULTIMOS2);
            $row_ULTIMOS2 = str_replace("{DESCRIPCION}",    ($unico2->descripcion_curso), $row_ULTIMOS2);
            $row_ULTIMOS2 = str_replace("{PLATAFORMA}",     ($unico2->plataforma), $row_ULTIMOS2);
            $row_ULTIMOS2 = str_replace("{LINK}",           ($url), $row_ULTIMOS2);
            $row_ULTIMOS2 = str_replace("{LINK_TEXT}",           ($url_texto), $row_ULTIMOS2);
            $row_ULTIMOS2 = str_replace("{ESTADO_TEXT}",           ($estado_url_texto), $row_ULTIMOS2);
            $row_ULTIMOS2 = str_replace("{ID_SKILL}", ($unico->Id_Skill), $row_ULTIMOS2);
            $row_ULTIMOS2 = str_replace("{LINK2}",           ($url2), $row_ULTIMOS2);
            $row_ULTIMOS2 = str_replace("{LINK_TEXT2}",           ($url_texto2), $row_ULTIMOS2);
            $row_ULTIMOS2 = str_replace("{ESTADO_TEXT2}",           ("primary"), $row_ULTIMOS2);

        if($unico->opcion_por_desarrollar=="Skill Eximida" or $unico->opcion_por_desarrollar=="Skill Convalidada"){
            $row_ULTIMOS2 = str_replace("{CONVALIDADO_EXIMIDA}",     "<span class='badge badge-success'><span class='blanco'>".$unico->opcion_por_desarrollar."</span></span>", $row_ULTIMOS2);
        } else {
            $row_ULTIMOS2 = str_replace("{CONVALIDADO_EXIMIDA}",     "", $row_ULTIMOS2);
        }

        if($unico2->idinscripcion>0){
            $row_ULTIMOS2 = str_replace("{CURSO_INSCRITO}",     "<span class='badge badge-warning'><span class='blanco'>Curso Inscrito</span></span>", $row_ULTIMOS2);
        } else {
            $row_ULTIMOS2 = str_replace("{CURSO_INSCRITO}",     "", $row_ULTIMOS2);
        }


        }
        //exit();
        $row_ULTIMOS = str_replace("{LISTA_CURSOS_SKILLS_PERSONAL}",     $row_ULTIMOS2, $row_ULTIMOS);

        $cuenta_colaborador++;
    }

}

    $PRINCIPAL = str_replace("{FORMACION_CONTINUA_CURSOS_SKILL}", ($row_ULTIMOS), $PRINCIPAL);
    return ($PRINCIPAL);
}

function formacion_continua_lista_eventos($PRINCIPAL,$idc, $id_empresa){


    $hoy=date("Y-m-d");

    $listado = FormacionContinua_EventosCursosData($idc,$id_empresa);
   // print_r($listado);
    foreach ($listado as $unico) {

    $date1 = new DateTime($hoy);         $date2 = new DateTime($unico->fecha);    $diff = $date1->diff($date2);
    if($diff->days<20 and $unico->fecha<>''){
       // ActualizaFCInvisibleItem($unico->id_postulable,$id_empresa);
       //         continue;
    }

    $dias_quedan=  $diff->days-20;     $txt_quedan="";
    if($dias_quedan<=20 and $unico->fecha<>''){      $txt_quedan="<span class='badge badge-warning'><i class='fas fa-exclamation-circle'></i>".$dias_quedan." d?as para postular </span>";}


//        $fecha=  $unico->fecha;
//          $interval = $fecha->diff($hoy);
//echo $interval->format('%R%a d?as');


        $row_ULTIMOS .= file_get_contents("views/formacion_continua/" . $id_empresa . "_row_lista_eventos_cursos.html");
        $row_ULTIMOS = str_replace("{DATO1}",                     $unico->dato1, $row_ULTIMOS);
        $row_ULTIMOS = str_replace("{DATO2}",               $unico->dato2, $row_ULTIMOS);
        $row_ULTIMOS = str_replace("{IMAGEN}",          $unico->imagen, $row_ULTIMOS);

        $row_ULTIMOS = str_replace("{DESCRIPCION_POSTULABLE}",     $unico->descripcion, $row_ULTIMOS);
        $row_ULTIMOS = str_replace("{DATO3}",                     $unico->dato3, $row_ULTIMOS);
        $row_ULTIMOS = str_replace("{NOMBRE_POSTULABLE}",         $unico->nombre, $row_ULTIMOS);
        $row_ULTIMOS = str_replace("{MODALIDAD}",                 $unico->modalidad, $row_ULTIMOS);
        $row_ULTIMOS = str_replace("{ID_EVENTO_ENCODEADO}",     Encodear3($unico->id_postulable), $row_ULTIMOS);
        $row_ULTIMOS = str_replace("{ID_CURSO_ENCODEADO}",         Encodear3($unico->id_dimension), $row_ULTIMOS);
        $row_ULTIMOS = str_replace("{FICHA_CURSO}",                     ($unico->ficha), $row_ULTIMOS);
        $row_ULTIMOS = str_replace("{TXTO_FALTAN}",                     ($txt_quedan), $row_ULTIMOS);
        $row_ULTIMOS = str_replace("{NUM_INSCRITOS}",                     $unico->inscritos, $row_ULTIMOS);
        $row_ULTIMOS = str_replace("{NUM_INSCRITOS_REAL}",                     $unico->inscritosreal, $row_ULTIMOS);

        $cuenta_colaborador++;
    }

    $listado = FormacionContinua_EventosCursosDataModalidad($idc,"Presencial",$id_empresa);
    $cuenta_colaborador_presencial=0;
    foreach ($listado as $unico) {
                  //print_r($unico);
    //Busca si tiene Regoion
   // echo "cuenta inscrito ".$unico->inscritos;

    //echo "<br> Region ".$unico->region." - Usuario ".$datos_usuario[0]->region;
    //Busca si tiene jefe

    $date1 = new DateTime($hoy);         $date2 = new DateTime($unico->fecha);    $diff = $date1->diff($date2);
    if($diff->days<20 and $unico->fecha<>''){
        //ActualizaFCInvisibleItem($unico->id_postulable,$id_empresa);
        //continue;
    }

    $dias_quedan=  $diff->days-20;     $txt_quedan="";

   // echo "dias $dias_quedan"; echo "fecha ".$unico->fecha;
    if($dias_quedan<=20 and $unico->fecha<>'' and $dias_quedan>=0){
        $txt_quedan="<br><span class='badge badge-warning'><span class='blanco'><i class='fas fa-exclamation-circle'></i>
        Restan ".$dias_quedan." d&iacute;as para postular</span> </span>";}
          //echo "txt_quedan $txt_quedan";

    if($unico->region <>''){
        $rut=$_SESSION["user_"];
        $id_empresa=$_SESSION["id_empresa"];
        $datos_usuario=TraeDatosBiografiayUsuario($rut, $id_empresa);
        //echo "<br> Region ".$unico->regional." - Usuario ".$datos_usuario[0]->region;
        if($datos_usuario[0]->regional <> $unico->region){
            continue;
        }

    }

    if($unico->jefatura <>''){
        $rut=$_SESSION["user_"];
        $id_empresa=$_SESSION["id_empresa"];
        $esjefe=rutesjefe($rut, $id_empresa);

        if($esjefe[0]->cuenta==0){
            continue;
        }

    }  //echo  $unico->invisible;
    if($unico->invisible<>1 or $unico->invisible==""){
                $row_ULTIMOS_PRES .= file_get_contents("views/formacion_continua/" . $id_empresa . "_row_lista_eventos_cursos.html");

    }   else {
                $row_ULTIMOS_PRES .= file_get_contents("views/formacion_continua/" . $id_empresa . "_row_lista_eventos_cursos_solo_vista.html");

    }
        //$row_ULTIMOS_PRES .= file_get_contents("views/formacion_continua/" . $id_empresa . "_row_lista_eventos_cursos.html");
        $row_ULTIMOS_PRES = str_replace("{DATO1}",                     $unico->dato1, $row_ULTIMOS_PRES);
        $row_ULTIMOS_PRES = str_replace("{DESCRIPCION_POSTULABLE}",     $unico->descripcion, $row_ULTIMOS_PRES);
        $row_ULTIMOS_PRES = str_replace("{DATO3}",                     $unico->dato3, $row_ULTIMOS_PRES);
       $row_ULTIMOS_PRES = str_replace("{DATO2}",               $unico->dato2, $row_ULTIMOS_PRES);
        $row_ULTIMOS_PRES = str_replace("{IMAGEN}",          $unico->imagen, $row_ULTIMOS_PRES);        $row_ULTIMOS_PRES = str_replace("{NUM_INSCRITOS}",                     $unico->inscritos, $row_ULTIMOS_PRES);
        $row_ULTIMOS_PRES = str_replace("{NOMBRE_POSTULABLE}",         $unico->nombre, $row_ULTIMOS_PRES);
        $row_ULTIMOS_PRES = str_replace("{MODALIDAD}",                 $unico->modalidad, $row_ULTIMOS_PRES);
        $row_ULTIMOS_PRES = str_replace("{ID_EVENTO_ENCODEADO}",     Encodear3($unico->id_postulable), $row_ULTIMOS_PRES);
        $row_ULTIMOS_PRES = str_replace("{ID_CURSO_ENCODEADO}",         Encodear3($unico->id_dimension), $row_ULTIMOS_PRES);

if($unico->ficha<>''){$ficha="<a href='docs/".$unico->ficha."' target='_blank' class='btn btn-primary'>Descargar Ficha Curso</a>";
} else {$ficha="";}

        $row_ULTIMOS_PRES = str_replace("{FICHA_CURSO}",                     ($ficha), $row_ULTIMOS_PRES);
        $row_ULTIMOS_PRES = str_replace("{TXTO_FALTAN}",                     ($txt_quedan), $row_ULTIMOS_PRES);
        $row_ULTIMOS_PRES = str_replace("{NUM_INSCRITOS_REAL}",                     ($unico->inscritosreal), $row_ULTIMOS_PRES);

        $cuenta_colaborador_presencial++;
    }
    $listado = FormacionContinua_EventosCursosDataModalidad($idc,"Elearning",$id_empresa);

//print_r($listado);
$cuenta_colaborador_elearning=0;
    foreach ($listado as $unico) {

    $date1 = new DateTime($hoy);         $date2 = new DateTime($unico->fecha);    $diff = $date1->diff($date2);
    if($diff->days<20 and $unico->fecha<>''){
        //ActualizaFCInvisibleItem($unico->id_postulable,$id_empresa);
        //continue;
    }

    $dias_quedan=  $diff->days-20;     $txt_quedan="";

   // echo "dias $dias_quedan"; echo "fecha ".$unico->fecha;
    if($dias_quedan<=20 and $unico->fecha<>''  and $dias_quedan>=0){
        $txt_quedan="<br><span class='badge badge-warning'><span class='blanco'><i class='fas fa-exclamation-circle'></i>
        Restan ".$dias_quedan." d&iacute;as para postular</span> </span>";}
if($unico->invisible<>1 or $unico->invisible==""){
         //echo "/";
         //echo $unico->link;
        if($unico->link=="SI"){
        $row_ULTIMOS_ELEA .= file_get_contents("views/formacion_continua/" . $id_empresa . "_row_lista_eventos_cursos_autoinscripcion.html");

        }   else {
                $row_ULTIMOS_ELEA .= file_get_contents("views/formacion_continua/" . $id_empresa . "_row_lista_eventos_cursos.html");

       // echo ",";
       }

    }   else {
                $row_ULTIMOS_ELEA .= file_get_contents("views/formacion_continua/" . $id_empresa . "_row_lista_eventos_cursos_solo_vista.html");
          //echo ".";
    }
        $row_ULTIMOS_ELEA = str_replace("{DATO1}",                      $unico->dato1, $row_ULTIMOS_ELEA);
        $row_ULTIMOS_ELEA = str_replace("{DESCRIPCION_POSTULABLE}",     $unico->descripcion, $row_ULTIMOS_ELEA);
        $row_ULTIMOS_ELEA = str_replace("{DATO3}",                      $unico->dato3, $row_ULTIMOS_ELEA);
       $row_ULTIMOS_ELEA = str_replace("{DATO2}",                       $unico->dato2, $row_ULTIMOS_ELEA);
        $row_ULTIMOS_ELEA = str_replace("{IMAGEN}",                     $unico->imagen, $row_ULTIMOS_ELEA);        $row_ULTIMOS_ELEA = str_replace("{NUM_INSCRITOS}",                     $unico->inscritos, $row_ULTIMOS_ELEA);
        $row_ULTIMOS_ELEA = str_replace("{NOMBRE_POSTULABLE}",          $unico->nombre, $row_ULTIMOS_ELEA);
        $row_ULTIMOS_ELEA = str_replace("{MODALIDAD}",                  $unico->modalidad, $row_ULTIMOS_ELEA);
        $row_ULTIMOS_ELEA = str_replace("{ID_EVENTO_ENCODEADO}",        Encodear3($unico->id_postulable), $row_ULTIMOS_ELEA);
        $row_ULTIMOS_ELEA = str_replace("{ID_CURSO_ENCODEADO}",         Encodear3($unico->id_dimension), $row_ULTIMOS_ELEA);
        $row_ULTIMOS_ELEA = str_replace("{LINK_POSTULABLE}",            ($unico->link), $row_ULTIMOS_ELEA);
         $row_ULTIMOS_ELEA = str_replace("{NUM_INSCRITOS_REAL}",                     ($unico->inscritosreal), $row_ULTIMOS_ELEA);

if($unico->ficha<>''){$ficha="<a href='docs/".$unico->ficha."' target='_blank' class='btn btn-primary btn-sm'>Descargar Ficha Curso</a>";
} else {$ficha="";}

        $row_ULTIMOS_ELEA = str_replace("{FICHA_CURSO}",                     ($ficha), $row_ULTIMOS_ELEA);
        $row_ULTIMOS_ELEA = str_replace("{TXTO_FALTAN}",                     ($txt_quedan), $row_ULTIMOS_ELEA);
        $cuenta_colaborador_elearning++;
    }

        if($cuenta_colaborador_presencial==0){
$Despliegue_presencial=utf8_decode("<center><br><br><span class='badge badge-pill badge-light'>Este curso s?lo se dicta en modalidad Elearning</span></center>");

        } else {
            $Despliegue_presencial=$row_ULTIMOS_PRES;
        }

        if($cuenta_colaborador_elearning==0){
$Despliegue_elearning=utf8_decode("<center><br><br><span class='badge badge-pill badge-light'>Este curso s?lo se dicta en modalidad Presencial</span></center>");
        } else {
            $Despliegue_elearning=$row_ULTIMOS_ELEA;
        }



    if($cuenta_colaborador_elearning==0 and $cuenta_colaborador_presencial==0){
    $Despliegue_elearning=utf8_decode("<center><br><br><span class='badge badge-pill badge-light'>No existen actividades para este curso.</span></center>");
    $Despliegue_presencial=utf8_decode("<center><br><br><span class='badge badge-pill badge-light'>No existen actividades para este curso.</span></center>");

    }

    $PRINCIPAL = str_replace("{NOMBRE_CURSO}", ($unico->dimension), $PRINCIPAL);
    $PRINCIPAL = str_replace("{DESCRIPCION_CURSO}", ($unico->descripcion), $PRINCIPAL);
    $PRINCIPAL = str_replace("{IMAGEN_CURSO}", ($unico->imagen), $PRINCIPAL);
    $PRINCIPAL = str_replace("{LINK_CURSO}", ($unico->link), $PRINCIPAL);

    $PRINCIPAL = str_replace("{FORMACION_CONTINUA_LISTA_EVENTOS_CURSOS}", ($row_ULTIMOS), $PRINCIPAL);
    $PRINCIPAL = str_replace("{FORMACION_CONTINUA_LISTA_EVENTOS_CURSOS_PRESENCIAL}", ($Despliegue_presencial), $PRINCIPAL);
    $PRINCIPAL = str_replace("{FORMACION_CONTINUA_LISTA_EVENTOS_CURSOS_ELEARNING}", ($Despliegue_elearning), $PRINCIPAL);

    return ($PRINCIPAL);

}


function colocarColaboradoresPorRutConDatos_lms($PRINCIPAL, $id_empresa, $rut)
{

//echo "id empresa $id_empresa, $rut";
    $listado_colaboradores = TotalUsuariosPorRutJefe($rut);
    foreach ($listado_colaboradores as $unico) {
       // print_r($unico);
        //$row.=file_get_contents("views/miperfil/row_colaboradores_miperfil.html");
        //$row.=file_get_contents("views/mi_equipo_lms/row_equipo_resumen.html");
        $row .= file_get_contents("views/mi_equipo_lms/" . $id_empresa . "_row_equipo_resumen.html");
        $datos_mallapersona = buscamalla($unico->rut, $id_empresa);
        $datos_mallapersona[0]->id_malla;
        $datos_malla        = DatosMalla($datos_mallapersona[0]->id_malla);
        //print_r($datos_malla);
        $datos_consolidados = TienePuntosConsolidadosPorMalla($unico->rut, $id_empresa, $datos_mallapersona[0]->id_malla);
        $row                = str_replace("{PUNTOS}", $datos_consolidados[0]->puntos, $row);
        $promedio_trivias   = PromedioTrivias($unico->rut, $id_empresa);
        if (!$promedio_trivias[0]->promedio_trivias) {
            $row = str_replace("{PROMEDIO}", "0", $row);
        } else {
            $row = str_replace("{PROMEDIO}", round($promedio_trivias[0]->promedio_trivias), $row);
        }
        if ($promedio_trivias[0]->promedio_trivias > 0) {
            $row = str_replace("{PODERES}", "<img src='img/61_rf_badges_5.png' width='20'>", $row);
        } else {
            $row = str_replace("{PODERES}", "", $row);
        }
        $medallas = "";
        for ($k = 1; $k <= $datos_consolidados[0]->medallas; $k++) {
            $medallas .= "<img src='img/rf_medal.png'>";
        }
        //$row = str_replace("{MEDALLAS}",$datos_consolidados[0]->medallas,$row);
        $row = str_replace("{MEDALLAS}", $medallas, $row);
        $row = str_replace("{NOMBRE}", $unico->nombre . " " . $unico->apaterno . " " . $unico->amaterno, $row);
        $row = str_replace("{CARGO}", $unico->cargo, $row);
        $row = str_replace("{GERENCIA}", $unico->gerencia, $row);
        $row = str_replace("{FECHA_CUMPLEANOS}", formatearFecha($unico->fecha_nacimiento), $row);
        $row = str_replace("{URL_PERSONA}", VerificaFotoPersonal($unico->rut), $row);
        $row = str_replace("{RUT_ENCODEADO}", Encodear3($unico->rut), $row);
        $row = str_replace("{RUT_COL}", ($unico->rut), $row);
        $row = str_replace("{MALLA}", ($datos_malla[0]->nombre), $row);
        list($total_inscripciones, $total_aprobados, $total_reprobados, $total_en_proceso) = CAPACITACION_DatosGeneralesPorUsuario($unico->rut);
        $estado                  = EntregaEstadoAvanceBarraMalla(EntregaPorcentaje($total_inscripciones, $total_aprobados));
        $listado_colaborador_sub = TotalUsuariosPorRutJefe($unico->rut);
        $num_reportes_sub        = count($listado_colaborador_sub);
        if ($num_reportes_sub > 0) {
            $num_reportes_template = "<br>
            <a href='?sw=mi_equipo_lms&rutenc=" . Encodear3($unico->rut) . "'
            class='btn btn-lg btn-flat border-white
            text-white text-uppercase text-size-small text-semibold content-group'>
            Equipo ($num_reportes_sub)</a>";
            $row                   = str_replace("{SUBREPORTES}", $num_reportes_template, $row);
        } else {
            $row = str_replace("{SUBREPORTES}", "", $row);
        }
        $accion                           = Lms_Busca_Acciones_Pendientes($rut, $unico->rut, $id_empresa);
        $row                              = str_replace("{ACCION}", ($accion), $row);
        $row                              = str_replace("{COMPROMISO}", ColocaBotonCompromisosPorcolaborador($id_empresa), $row);
        $row                              = str_replace("{TRIVIAS}", ("Trivia"), $row);
        $avance                           = round(EntregaPorcentaje($total_inscripciones, $total_aprobados));
        //    echo "<br>$avance";
        $acumulador_avance_colaboradores  = $acumulador_avance_colaboradores + EntregaPorcentaje($total_inscripciones, $total_aprobados);
        $PRINCIPAL                        = str_replace("{NUMERO_AVANCE}", round(EntregaPorcentaje($total_inscripciones, $total_aprobados)), $PRINCIPAL);
        $PRINCIPAL                        = str_replace("{COLOR_PROGRESS_BAR}", $estado[0], $PRINCIPAL);
        $row                              = str_replace("{AVANCE_COLABORADOR}", EntregaPorcentaje($total_inscripciones, $total_aprobados), $row);
        //$total_visitas=TotalVisitasDadoRutCaseEmpresaFront($unico->rut, $id_empresa, "home_minvest");
        $row                              = str_replace("{NUM_VISITAS_COLABORADOR}", $total_visitas[0]->total_visitas, $row);
        $acumulador_visitas_colaboradores = $acumulador_visitas_colaboradores + $total_visitas[0]->total_visitas;
        $cuenta_colaborador++;
    }
    $accionesPendiente          = Lms_Cuenta_Acciones_Pendientes_data($rut, $id_empresa);
    $num_acciones_pendientes    = $accionesPendiente[0]->cuenta;
    $num_acciones_realizadas    = $cuenta_colaborador - $num_acciones_pendientes;
    //echo "cuentacolaborador $cuenta_colaborador, nun acciones $num_acciones_pendientes, $num_acciones_realizadas";
    //echo "100*$acumulador_avance_colaboradores/$cuenta_colaborador";
    $sum_verde                  = round(100 * $num_acciones_realizadas / $cuenta_colaborador);
    $sum_amarillo               = 0;
    $sum_rojo                   = round(100 * $num_acciones_pendientes / $cuenta_colaborador);
    $sum_avanceequipo           = round($acumulador_avance_colaboradores / $cuenta_colaborador);
    $lms_avance_equipo          = $sum_avanceequipo;
    $lms_graf_acciones_rojo     = $sum_rojo;
    $lms_graf_acciones_amarillo = $sum_amarillo;
    $lms_graf_acciones_verde    = $sum_verde;
    $PRINCIPAL                  = str_replace("{NUM_PERSONAS_MI_EQUIPO}", count($listado_colaboradores), $PRINCIPAL);
    $PRINCIPAL                  = str_replace("{PROMEDIO_EQUIPO}", round($acumulador_avance_colaboradores / count($listado_colaboradores)), $PRINCIPAL);
    $PRINCIPAL                  = str_replace("{NUM_VISITAS_MI_EQUIPO}", $acumulador_visitas_colaboradores, $PRINCIPAL);
    $PRINCIPAL                  = str_replace("{BLOQUE_COLABORADORES}", ($row), $PRINCIPAL);
    $PRINCIPAL                  = str_replace("{LMS_GRAFICO_1COLOR}", file_get_contents("views/mi_equipo_lms/" . $id_empresa . "_barra_1color.html"), $PRINCIPAL);
    $PRINCIPAL                  = str_replace("{LMS_AVANCEEQUIPO}", $lms_avance_equipo, $PRINCIPAL);
    $PRINCIPAL                  = str_replace("{LMS_GRAFICO_3COLORES}", file_get_contents("views/mi_equipo_lms/" . $id_empresa . "_barra_3colores.html"), $PRINCIPAL);
    $PRINCIPAL                  = str_replace("{VALUEVERDE}", $lms_graf_acciones_verde, $PRINCIPAL);
    $PRINCIPAL                  = str_replace("{VALUEAMARILLO}", $lms_graf_acciones_amarillo, $PRINCIPAL);
    $PRINCIPAL                  = str_replace("{VALUEROJO}", $lms_graf_acciones_rojo, $PRINCIPAL);
    $PRINCIPAL                  = str_replace("{LMS_NUM_PENDIENTES}", $num_acciones_pendientes, $PRINCIPAL);
    return ($PRINCIPAL);
}
function colocarColaboradoresPorRutConDatos_lms_liderBK2($PRINCIPAL, $id_empresa, $rut, $id_programa_bbdd, $id_curso, $id_objeto)
{
    $listado_colaboradores = TotalUsuariosPorRutJefe($rut);
    if (count($listado_colaboradores) == 0) {
        $listado_colaboradores = TotalUsuariosPorRutJefeResponsable($rut);
    }
    foreach ($listado_colaboradores as $unico) {
        //print_r($unico);
        //$row.=file_get_contents("views/miperfil/row_colaboradores_miperfil.html");
        //$row.=file_get_contents("views/mi_equipo_lms/row_equipo_resumen.html");
        //$datos_integracion = lms_integracion_programas($unico->rut, $id_empresa, "equipo", $id_programa_bbdd, $id_curso, $id_objeto);
        //$row = str_replace("{ROW_LISTA_PROGRAMAS}",utf8_decode($datos_integracion[0]),$row);
        //$row.=file_get_contents("views/mi_equipo_lider/".$id_empresa."_row_equipo_resumen.html");
        //$row = str_replace("{TRIVIAS}",$datos_integracion[2]." &nbsp;&nbsp;Ver Ficha <a href='?sw=fichasTrivias'>aca</a>",$row);
        //print_r($datos_integracion);}
        $row .= file_get_contents("views/mi_equipo_lider/" . $id_empresa . "_row_equipo_resumen.html");
        $row = str_replace("{ROW_LISTA_PROGRAMAS}", utf8_decode($datos_integracion[0]), $row);
        if ($datos_integracion[2]) {
            $row = str_replace("{TRIVIAS}", file_get_contents("views/mi_equipo_lider/" . $id_empresa . "_boton_ver_trivias.html"), $row);
            if ($id_objeto) {
                $datos_objeto = DatosObjeto($id_objeto);
                $row          = str_replace("{OBJETO}", $datos_objeto[0]->titulo, $row);
            } else {
                $row = str_replace("{OBJETO}", "", $row);
            }
            $row = str_replace("{PROMEDIO_TRIVIAS_POR_PROGRAMA}", $datos_integracion[2], $row);
            $row = str_replace("{PROMEDIO_TRIVIAS_POR_PROGRAMA_1A7}", ColocaNotaConvertidaTrivia($datos_integracion[2]), $row);
            $row = str_replace("{RUT_COLABORADOR_ENCODADO}", Encodear3($unico->rut), $row);
        } else {
            $row = str_replace("{TRIVIAS}", "", $row);
        }
        $datos_mallapersona = buscamalla($unico->rut, $id_empresa);
        $datos_mallapersona[0]->id_malla;
        $datos_malla        = DatosMalla($datos_mallapersona[0]->id_malla);
        $datos_consolidados = TienePuntosConsolidadosPorMalla($unico->rut, $id_empresa, $datos_mallapersona[0]->id_malla);
        $row                = str_replace("{PUNTOS}", $datos_consolidados[0]->puntos, $row);
        $promedio_trivias   = PromedioTrivias($unico->rut, $id_empresa);
        if (!$promedio_trivias[0]->promedio_trivias) {
            $row = str_replace("{PROMEDIO}", "0", $row);
        } else {
            $row = str_replace("{PROMEDIO}", round($promedio_trivias[0]->promedio_trivias), $row);
        }
        if ($promedio_trivias[0]->promedio_trivias > 0) {
            $row = str_replace("{PODERES}", "<img src='img/61_rf_badges_5.png' width='20'>", $row);
        } else {
            $row = str_replace("{PODERES}", "", $row);
        }
        $medallas = "";
        for ($k = 1; $k <= $datos_consolidados[0]->medallas; $k++) {
            $medallas .= "<img src='img/rf_medal.png'>";
        }
        //$row = str_replace("{MEDALLAS}",$datos_consolidados[0]->medallas,$row);
        $row = str_replace("{MEDALLAS}", $medallas, $row);
        $row = str_replace("{NOMBRE}", $unico->nombre . " " . $unico->apaterno . " " . $unico->amaterno, $row);
        $row = str_replace("{CARGO}", $unico->cargo, $row);
        $row = str_replace("{GERENCIA}", $unico->gerencia, $row);
        $row = str_replace("{FECHA_CUMPLEANOS}", formatearFecha($unico->fecha_nacimiento), $row);
        $row = str_replace("{URL_PERSONA}", VerificaFotoPersonal($unico->rut), $row);
        $row = str_replace("{RUT_ENCODEADO}", Encodear3($unico->rut), $row);
        $row = str_replace("{MALLA}", ($datos_malla[0]->nombre), $row);
        $row = str_replace("{RUT_COL}", ($unico->rut), $row);
        list($total_inscripciones, $total_aprobados, $total_reprobados, $total_en_proceso) = CAPACITACION_DatosGeneralesPorUsuario($unico->rut);
        $estado                           = EntregaEstadoAvanceBarraMalla(EntregaPorcentaje($total_inscripciones, $total_aprobados));
        $listado_colaborador_sub          = TotalUsuariosPorRutJefe($unico->rut);
        $num_reportes_sub                 = count($listado_colaborador_sub);
        $accion                           = Lms_Busca_Acciones_Pendientes($rut, $unico->rut, $id_empresa);
        $preguntaspendientes              = Lms_Busca_Preguntas_Pendientes($rut, $unico->rut, $id_empresa);
        //echo "<pre>";
        //print_r($preguntaspendientes);
        //$row = str_replace("{TRIVIAS}",("TRIVIAS"),$row);
        $row                              = str_replace("{ACCION}", ($accion), $row);
        $row                              = str_replace("{PREGUNTAS}", ($preguntaspendientes), $row);
        //Desafios Finaliados
        $desafios_finalizados             = TraigoDesafiosFinalizados($unico->rut, $id_empresa);
        $row                              = str_replace("{DESAFIOS_FINALIZADOS}", count($desafios_finalizados), $row);
        $avance                           = round(EntregaPorcentaje($total_inscripciones, $total_aprobados));
        //    echo "<br>$avance";
        $acumulador_avance_colaboradores  = $acumulador_avance_colaboradores + EntregaPorcentaje($total_inscripciones, $total_aprobados);
        $PRINCIPAL                        = str_replace("{NUMERO_AVANCE}", round(EntregaPorcentaje($total_inscripciones, $total_aprobados)), $PRINCIPAL);
        $PRINCIPAL                        = str_replace("{COLOR_PROGRESS_BAR}", $estado[0], $PRINCIPAL);
        $row                              = str_replace("{AVANCE_COLABORADOR}", EntregaPorcentaje($total_inscripciones, $total_aprobados), $row);
        //$total_visitas=TotalVisitasDadoRutCaseEmpresaFront($unico->rut, $id_empresa, "home_minvest");
        $row                              = str_replace("{NUM_VISITAS_COLABORADOR}", $total_visitas[0]->total_visitas, $row);
        $acumulador_visitas_colaboradores = $acumulador_visitas_colaboradores + $total_visitas[0]->total_visitas;
        $cuenta_colaborador++;
        $preguntasPendiente       = Lms_Cuenta_Preguntas_Pendientes_data($unico->rut, $id_empresa);
        $num_preguntas_pendientes = $preguntasPendiente[0]->pendientes + $num_preguntas_pendientes;
        //print_r($preguntasPendiente);
        //echo "<br>num_preguntas_pendientes $num_preguntas_pendientes";
        $num_preguntas_realizadas = $preguntasPendiente[0]->realizadas + $num_preguntas_realizadas;
    }
    $accionesPendiente          = Lms_Cuenta_Acciones_Pendientes_data_lider($rut, $id_empresa);
    $num_acciones_pendientes    = $accionesPendiente[0]->pendientes;
    $num_acciones_realizadas    = $accionesPendiente[0]->realizadas;
    //echo "cuentacolaborador $cuenta_colaborador, nun acciones $num_acciones_pendientes, $num_acciones_realizadas";
    //echo "100*$acumulador_avance_colaboradores/$cuenta_colaborador";
    $sum_verde                  = round(100 * $num_acciones_realizadas / $cuenta_colaborador);
    $sum_amarillo               = 0;
    $sum_rojo                   = round(100 * $num_acciones_pendientes / $cuenta_colaborador);
    $sum_avanceequipo           = round($acumulador_avance_colaboradores / $cuenta_colaborador);
    $lms_avance_equipo          = $sum_avanceequipo;
    $lms_graf_acciones_rojo     = $sum_rojo;
    $lms_graf_acciones_amarillo = $sum_amarillo;
    $lms_graf_acciones_verde    = $sum_verde;
    $PRINCIPAL                  = str_replace("{NUM_PERSONAS_MI_EQUIPO}", count($listado_colaboradores), $PRINCIPAL);
    $PRINCIPAL                  = str_replace("{PROMEDIO_EQUIPO}", round($acumulador_avance_colaboradores / count($listado_colaboradores)), $PRINCIPAL);
    $PRINCIPAL                  = str_replace("{NUM_VISITAS_MI_EQUIPO}", $acumulador_visitas_colaboradores, $PRINCIPAL);
    $PRINCIPAL                  = str_replace("{BLOQUE_COLABORADORES}", ($row), $PRINCIPAL);
    $PRINCIPAL                  = str_replace("{LMS_GRAFICO_1COLOR}", file_get_contents("views/mi_equipo_lms/" . $id_empresa . "_barra_1color.html"), $PRINCIPAL);
    $PRINCIPAL                  = str_replace("{LMS_AVANCEEQUIPO}", $lms_avance_equipo, $PRINCIPAL);
    $PRINCIPAL                  = str_replace("{LMS_GRAFICO_3COLORES}", file_get_contents("views/mi_equipo_lms/" . $id_empresa . "_barra_3colores.html"), $PRINCIPAL);
    $PRINCIPAL                  = str_replace("{VALUEVERDE}", $lms_graf_acciones_verde, $PRINCIPAL);
    $PRINCIPAL                  = str_replace("{VALUEAMARILLO}", $lms_graf_acciones_amarillo, $PRINCIPAL);
    $PRINCIPAL                  = str_replace("{VALUEROJO}", $lms_graf_acciones_rojo, $PRINCIPAL);
    $PRINCIPAL                  = str_replace("{LMS_NUM_PENDIENTES}", $num_acciones_pendientes, $PRINCIPAL);
    $PRINCIPAL                  = str_replace("{LMS_NUM_REALIZADOS}", $num_acciones_realizadas, $PRINCIPAL);
    $listaProgramas_Select      = lms_integracion_lista_programasSinRut($id_empresa, $rut);
    $options_select_programa    = "";
    foreach ($listaProgramas_Select as $prog) {
        if ($id_programa_bbdd == $prog->id_programa) {
            $options_select_programa .= "<option value='" . $prog->id_programa . "' selected='selected'>" . $prog->nombre_programa . "</option>";
        } else {
            $options_select_programa .= "<option value='" . $prog->id_programa . "'>" . $prog->nombre_programa . "</option>";
        }
    }
    $PRINCIPAL = str_replace("{OPTIONS_PROGRAMAS_BBDD}", ($options_select_programa), $PRINCIPAL);
    if ($id_programa_bbdd) {
        $arreglo_post   = $_POST;
        $cursos         = REL_MALLA_CURSO_TraeCursosDadoPrograma2($id_empresa, $arreglo_post);
        $options_cursos = "";
        foreach ($cursos as $prog) {
            if ($prog->id_curso == $id_curso) {
                $options_cursos .= "<option value='" . $prog->id_curso . "' selected>" . $prog->nombre . " (" . $prog->id_curso . ")</option>";
            } else {
                $options_cursos .= "<option value='" . $prog->id_curso . "'>" . $prog->nombre . " (" . $prog->id_curso . ")</option>";
            }
        }
    }
    $PRINCIPAL = str_replace("{OPTIONS_CURSOS}", ($options_cursos), $PRINCIPAL);
    //Objetos
    if ($id_curso) {
        $objetos = CHECK_ObjetosPorCurso($arreglo_post["cursos"]);
        $options = "";
        foreach ($objetos as $obj) {
            if ($obj->id == $id_objeto) {
                $options .= "<option selected value='" . $obj->id . "'>" . $obj->titulo . "</option>";
            } else {
                $options .= "<option value='" . $obj->id . "'>" . $obj->titulo . "</option>";
            }
        }
        $PRINCIPAL = str_replace("{OPTIONS_OBJETOS}", ($options), $PRINCIPAL);
    }
    //Mensajes_por Agente
    $total_respondidas    = 0;
    $total_no_respondidas = 0;
    $mensajes_por_Agente  = TraeMensajesPorAgente($rut, $id_empresa);
    foreach ($mensajes_por_Agente as $mensaje) {
        if ($mensaje->total_respuestas_agente > 0) {
            $total_respondidas++;
        } else {
            $total_no_respondidas++;
        }
    }
    //$PRINCIPAL = str_replace("{LMS_NUM_PREGUNTAS_PENDIENTES}",$num_preguntas_pendientes,$PRINCIPAL);
    //$PRINCIPAL = str_replace("{LMS_NUM_PREGUNTAS_REALIZADOS}",$num_preguntas_realizadas,$PRINCIPAL);
    $PRINCIPAL = str_replace("{LMS_NUM_PREGUNTAS_PENDIENTES}", $total_no_respondidas, $PRINCIPAL);
    $PRINCIPAL = str_replace("{LMS_NUM_PREGUNTAS_REALIZADOS}", $total_respondidas, $PRINCIPAL);
    return ($PRINCIPAL);
}
function colocarColaboradoresPorRutConDatos_lms_lider_ejecutivos($PRINCIPAL, $id_empresa, $rut, $id_programa_bbdd, $id_curso, $id_objeto, $ajax)
{
    $listado_colaboradores = TotalUsuariosPorRutLiderEjecutivos($rut);
    if ($_GET["sw"] == "mi_perfil_esc") {
        $listado_colaboradores = TotalUsuariosMiRut($rut);
    }
    $acumulador_nota_final  = 0;
    $contador_colaboradores = 0;
    foreach ($listado_colaboradores as $unico) {
        //print_r($unico);
        //$row.=file_get_contents("views/miperfil/row_colaboradores_miperfil.html");
        //$row.=file_get_contents("views/mi_equipo_lms/row_equipo_resumen.html");
        //ActualizaTablatblLmsReportePorRut($unico->rut);
        $datos_integracion     = lms_integracion_programas($unico->rut, $id_empresa, "equipo", $id_programa_bbdd, $id_curso, $id_objeto);
        $acumulador_nota_final = $acumulador_nota_final + $datos_integracion[1];
        $contador_colaboradores++;
        //$row = str_replace("{ROW_LISTA_PROGRAMAS}",utf8_decode($datos_integracion[0]),$row);
        //$row.=file_get_contents("views/mi_equipo_lider/".$id_empresa."_row_equipo_resumen.html");
        //$row = str_replace("{TRIVIAS}",$datos_integracion[2]." &nbsp;&nbsp;Ver Ficha <a href='?sw=fichasTrivias'>aca</a>",$row);
        //echo "<br>".$unico->rut." ".$id_programa_bbdd;
        //print_r($datos_integracion[2]);
        if ($ajax == "ajax") {
            $row .= file_get_contents("views/mi_equipo_ejecutivos/" . $id_empresa . "_row_equipo_resumen_ajax.html");
        } else {
            $row .= file_get_contents("views/mi_equipo_ejecutivos/" . $id_empresa . "_row_equipo_resumen.html");
        }
        $row = str_replace("{ROW_LISTA_PROGRAMAS_mi_equipo_lider}", utf8_decode($datos_integracion[0]), $row);
        $row = str_replace("{RUT_JEFE}", $unico->rut, $row);
        if ($datos_integracion[2]) {
            $row = str_replace("{TRIVIAS}", file_get_contents("views/mi_equipo_ejecutivos/" . $id_empresa . "_boton_ver_trivias.html"), $row);
            if ($id_objeto) {
                $datos_objeto = DatosObjeto($id_objeto);
                $row          = str_replace("{OBJETO}", $datos_objeto[0]->titulo, $row);
            } else {
                $row = str_replace("{OBJETO}", "", $row);
            }
            $row = str_replace("{PROMEDIO_TRIVIAS_POR_PROGRAMA}", $datos_integracion[2], $row);
            $row = str_replace("{PROMEDIO_TRIVIAS_POR_PROGRAMA_1A7}", ColocaNotaConvertidaTrivia($datos_integracion[2]), $row);
            $row = str_replace("{RUT_COLABORADOR_ENCODADO}", Encodear3($unico->rut), $row);
        } else {
            $row = str_replace("{TRIVIAS}", "", $row);
        }
        $datos_mallapersona = buscamalla($unico->rut, $id_empresa);
        $datos_mallapersona[0]->id_malla;
        $datos_malla        = DatosMalla($datos_mallapersona[0]->id_malla);
        $datos_consolidados = TienePuntosConsolidadosPorMalla($unico->rut, $id_empresa, $datos_mallapersona[0]->id_malla);
        $row                = str_replace("{PUNTOS}", $datos_consolidados[0]->puntos, $row);
        $promedio_trivias   = PromedioTrivias($unico->rut, $id_empresa);
        if (!$promedio_trivias[0]->promedio_trivias) {
            $row = str_replace("{PROMEDIO}", "0", $row);
        } else {
            $row = str_replace("{PROMEDIO}", round($promedio_trivias[0]->promedio_trivias), $row);
        }
        if ($promedio_trivias[0]->promedio_trivias > 0) {
            $row = str_replace("{PODERES}", "<img src='img/61_rf_badges_5.png' width='20'>", $row);
        } else {
            $row = str_replace("{PODERES}", "", $row);
        }
        $medallas = "";
        for ($k = 1; $k <= $datos_consolidados[0]->medallas; $k++) {
            $medallas .= "<img src='img/rf_medal.png'>";
        }
        //$row = str_replace("{MEDALLAS}",$datos_consolidados[0]->medallas,$row);
        $row               = str_replace("{MEDALLAS}", $medallas, $row);
        $arreglo_subequipo = TotalUsuariosPorRutJefe($unico->rut);
        $num_subequipo     = count($arreglo_subequipo);
        if ($num_subequipo > 0) {
            $mi_equipo_ver_equipo = "<span class='label-small label-small-info  pull-right'>Ver Equipo <span class='badge'>" . $num_subequipo . " <i class='icon-people icons'></i></span> </span>";
        } else {
            $mi_equipo_ver_equipo = "";
        }
        $row = str_replace("{NOMBRE}", $unico->nombre . " " . $unico->apaterno . " " . $unico->amaterno, $row);
        $row = str_replace("{CARGO}", $unico->cargo, $row);
        $row = str_replace("{GERENCIA}", $unico->gerencia, $row);
        $row = str_replace("{FECHA_CUMPLEANOS}", formatearFecha($unico->fecha_nacimiento), $row);
        $row = str_replace("{URL_PERSONA}", VerificaFotoPersonal($unico->rut), $row);
        $row = str_replace("{RUT_ENCODEADO}", Encodear3($unico->rut), $row);
        $row = str_replace("{MALLA}", ($datos_malla[0]->nombre), $row);
        $row = str_replace("{MIEQUIPO_VER_EQUIPO}", ($mi_equipo_ver_equipo), $row);
        $row = str_replace("{MIEQUIPO_VER_EQUIPO_CLICK}", ($mi_equipo_ver_equipo), $row);
        $row = str_replace("{NUM_MIEQUIPO_VER_EQUIPO}", ($num_subequipo), $row);
        $row = str_replace("{RUT_COL}", ($unico->rut), $row);
        list($total_inscripciones, $total_aprobados, $total_reprobados, $total_en_proceso) = CAPACITACION_DatosGeneralesPorUsuario($unico->rut);
        $estado                           = EntregaEstadoAvanceBarraMalla(EntregaPorcentaje($total_inscripciones, $total_aprobados));
        $listado_colaborador_sub          = TotalUsuariosPorRutJefe($unico->rut);
        $num_reportes_sub                 = count($listado_colaborador_sub);
        $accion                           = Lms_Busca_Acciones_Pendientes($rut, $unico->rut, $id_empresa);
        $preguntaspendientes              = Lms_Busca_Preguntas_Pendientes($rut, $unico->rut, $id_empresa);
        //echo "<pre>";
        //print_r($preguntaspendientes);
        //$row = str_replace("{TRIVIAS}",("TRIVIAS"),$row);
        $row                              = str_replace("{ACCION}", ($accion), $row);
        $row                              = str_replace("{PREGUNTAS}", ($preguntaspendientes), $row);
        //Desafios Finaliados
        $desafios_finalizados             = TraigoDesafiosFinalizados($unico->rut, $id_empresa);
        $row                              = str_replace("{DESAFIOS_FINALIZADOS}", count($desafios_finalizados), $row);
        $avance                           = round(EntregaPorcentaje($total_inscripciones, $total_aprobados));
        //    echo "<br>$avance";
        $acumulador_avance_colaboradores  = $acumulador_avance_colaboradores + EntregaPorcentaje($total_inscripciones, $total_aprobados);
        $PRINCIPAL                        = str_replace("{NUMERO_AVANCE}", round(EntregaPorcentaje($total_inscripciones, $total_aprobados)), $PRINCIPAL);
        $PRINCIPAL                        = str_replace("{COLOR_PROGRESS_BAR}", $estado[0], $PRINCIPAL);
        $row                              = str_replace("{AVANCE_COLABORADOR}", EntregaPorcentaje($total_inscripciones, $total_aprobados), $row);
        //$total_visitas=TotalVisitasDadoRutCaseEmpresaFront($unico->rut, $id_empresa, "home_minvest");
        $row                              = str_replace("{NUM_VISITAS_COLABORADOR}", $total_visitas[0]->total_visitas, $row);
        $acumulador_visitas_colaboradores = $acumulador_visitas_colaboradores + $total_visitas[0]->total_visitas;
        $cuenta_colaborador++;
        $preguntasPendiente       = Lms_Cuenta_Preguntas_Pendientes_data($unico->rut, $id_empresa);
        $num_preguntas_pendientes = $preguntasPendiente[0]->pendientes + $num_preguntas_pendientes;
        //print_r($preguntasPendiente);
        //echo "<br>num_preguntas_pendientes $num_preguntas_pendientes";
        $num_preguntas_realizadas = $preguntasPendiente[0]->realizadas + $num_preguntas_realizadas;
    }
    $accionesPendiente          = Lms_Cuenta_Acciones_Pendientes_data_lider($rut, $id_empresa);
    $num_acciones_pendientes    = $accionesPendiente[0]->pendientes;
    $num_acciones_realizadas    = $accionesPendiente[0]->realizadas;
    //echo "cuentacolaborador $cuenta_colaborador, nun acciones $num_acciones_pendientes, $num_acciones_realizadas";
    //echo "100*$acumulador_avance_colaboradores/$cuenta_colaborador";
    $sum_verde                  = round(100 * $num_acciones_realizadas / $cuenta_colaborador);
    $sum_amarillo               = 0;
    $sum_rojo                   = round(100 * $num_acciones_pendientes / $cuenta_colaborador);
    $sum_avanceequipo           = round($acumulador_avance_colaboradores / $cuenta_colaborador);
    $lms_avance_equipo          = $sum_avanceequipo;
    $lms_graf_acciones_rojo     = $sum_rojo;
    $lms_graf_acciones_amarillo = $sum_amarillo;
    $lms_graf_acciones_verde    = $sum_verde;
    $promedio_final             = $acumulador_nota_final / $contador_colaboradores;
    $PRINCIPAL                  = str_replace("{VALOR_PROMEDIO}", round($promedio_final), $PRINCIPAL);
    $PRINCIPAL                  = str_replace("{NUM_PERSONAS_MI_EQUIPO}", count($listado_colaboradores), $PRINCIPAL);
    $PRINCIPAL                  = str_replace("{PROMEDIO_EQUIPO}", round($acumulador_avance_colaboradores / count($listado_colaboradores)), $PRINCIPAL);
    $PRINCIPAL                  = str_replace("{NUM_VISITAS_MI_EQUIPO}", $acumulador_visitas_colaboradores, $PRINCIPAL);
    $PRINCIPAL                  = str_replace("{BLOQUE_COLABORADORES}", ($row), $PRINCIPAL);
    $PRINCIPAL                  = str_replace("{LMS_GRAFICO_1COLOR}", file_get_contents("views/mi_equipo_lms/" . $id_empresa . "_barra_1color.html"), $PRINCIPAL);
    $PRINCIPAL                  = str_replace("{LMS_AVANCEEQUIPO}", $lms_avance_equipo, $PRINCIPAL);
    $PRINCIPAL                  = str_replace("{LMS_GRAFICO_3COLORES}", file_get_contents("views/mi_equipo_lms/" . $id_empresa . "_barra_3colores.html"), $PRINCIPAL);
    $PRINCIPAL                  = str_replace("{VALUEVERDE}", $lms_graf_acciones_verde, $PRINCIPAL);
    $PRINCIPAL                  = str_replace("{VALUEAMARILLO}", $lms_graf_acciones_amarillo, $PRINCIPAL);
    $PRINCIPAL                  = str_replace("{VALUEROJO}", $lms_graf_acciones_rojo, $PRINCIPAL);
    $PRINCIPAL                  = str_replace("{LMS_NUM_PENDIENTES}", $num_acciones_pendientes, $PRINCIPAL);
    $PRINCIPAL                  = str_replace("{LMS_NUM_REALIZADOS}", $num_acciones_realizadas, $PRINCIPAL);
    $listaProgramas_Select      = lms_integracion_lista_programasSinRut($id_empresa, $rut);
    $options_select_programa    = "";
    foreach ($listaProgramas_Select as $prog) {
        if ($id_programa_bbdd == $prog->id_programa) {
            $options_select_programa .= "<option value='" . $prog->id_programa . "' selected='selected'>" . $prog->nombre_programa . "</option>";
        } else {
            $options_select_programa .= "<option value='" . $prog->id_programa . "'>" . $prog->nombre_programa . "</option>";
        }
    }
    $PRINCIPAL = str_replace("{OPTIONS_PROGRAMAS_BBDD}", ($options_select_programa), $PRINCIPAL);
    if ($id_programa_bbdd) {
        $arreglo_post   = $_POST;
        $cursos         = REL_MALLA_CURSO_TraeCursosDadoPrograma2($id_empresa, $arreglo_post);
        $options_cursos = "";
        foreach ($cursos as $prog) {
            if ($prog->id_curso == $id_curso) {
                $options_cursos .= "<option value='" . $prog->id_curso . "' selected>" . $prog->nombre . " (" . $prog->id_curso . ")</option>";
            } else {
                $options_cursos .= "<option value='" . $prog->id_curso . "'>" . $prog->nombre . " (" . $prog->id_curso . ")</option>";
            }
        }
    }
    $PRINCIPAL = str_replace("{OPTIONS_CURSOS}", ($options_cursos), $PRINCIPAL);
    //Objetos
    if ($id_curso) {
        $objetos = CHECK_ObjetosPorCurso($arreglo_post["cursos"]);
        $options = "";
        foreach ($objetos as $obj) {
            if ($obj->id == $id_objeto) {
                $options .= "<option selected value='" . $obj->id . "'>" . $obj->titulo . "</option>";
            } else {
                $options .= "<option value='" . $obj->id . "'>" . $obj->titulo . "</option>";
            }
        }
        $PRINCIPAL = str_replace("{OPTIONS_OBJETOS}", ($options), $PRINCIPAL);
    }
    //Mallas
    $mallas = MallasPorEmpresa2($id_empresa);
    foreach ($mallas as $mal) {
        if ($mal->nombre <> '') {
            $options_mallas .= "<option value='" . $mal->id . "'>" . $mal->nombre . "</option>";
        }
    }
    $PRINCIPAL            = str_replace("{OPTIONS_MALLAS}", ($options_mallas), $PRINCIPAL);
    //Mensajes_por Agente
    $total_respondidas    = 0;
    $total_no_respondidas = 0;
    $mensajes_por_Agente  = TraeMensajesPorAgente($rut, $id_empresa);
    foreach ($mensajes_por_Agente as $mensaje) {
        if ($mensaje->total_respuestas_agente > 0) {
            $total_respondidas++;
        } else {
            $total_no_respondidas++;
        }
    }
    //$PRINCIPAL = str_replace("{LMS_NUM_PREGUNTAS_PENDIENTES}",$num_preguntas_pendientes,$PRINCIPAL);
    //$PRINCIPAL = str_replace("{LMS_NUM_PREGUNTAS_REALIZADOS}",$num_preguntas_realizadas,$PRINCIPAL);
    $PRINCIPAL = str_replace("{LMS_NUM_PREGUNTAS_PENDIENTES}", $total_no_respondidas, $PRINCIPAL);
    $PRINCIPAL = str_replace("{LMS_NUM_PREGUNTAS_REALIZADOS}", $total_respondidas, $PRINCIPAL);
    return ($PRINCIPAL);
}

function colocarColaboradoresPorRutConDatos_lms_lider($PRINCIPAL, $id_empresa, $rut, $id_programa_bbdd, $id_curso, $id_objeto, $ajax)
{

//echo       // "<br>colocarColaboradoresPorRutConDatos_lms_lider  $id_programa_bbdd, $id_curso ";

    $listado_colaboradores = TotalUsuariosPorRutJefe($rut);
    if (count($listado_colaboradores) == 0) {
        $listado_colaboradores = TotalUsuariosPorRutJefeResponsable($rut);
    }
    if ($_GET["sw"] == "mi_perfil_esc") {
        $listado_colaboradores = TotalUsuariosMiRut($rut);
    }
    $acumulador_nota_final  = 0;
    $contador_colaboradores = 0;

    foreach ($listado_colaboradores as $unico) {
      //print_r($unico);
        //$row.=file_get_contents("views/miperfil/row_colaboradores_miperfil.html");
        //$row.=file_get_contents("views/mi_equipo_lms/row_equipo_resumen.html");
        //ActualizaTablatblLmsReportePorRut($unico->rut);
        $datos_integracion     = lms_integracion_programas($unico->rut, $id_empresa, "equipo", $id_programa_bbdd, $id_curso, $id_objeto);
        //print_r($datos_integracion);
        $acumulador_nota_final = $acumulador_nota_final + $datos_integracion[1];
        $contador_colaboradores++;
        //$row = str_replace("{ROW_LISTA_PROGRAMAS}",utf8_decode($datos_integracion[0]),$row);
        //$row.=file_get_contents("views/mi_equipo_lider/".$id_empresa."_row_equipo_resumen.html");
        //$row = str_replace("{TRIVIAS}",$datos_integracion[2]." &nbsp;&nbsp;Ver Ficha <a href='?sw=fichasTrivias'>aca</a>",$row);
        //echo "<br>".$unico->rut." ".$id_programa_bbdd;
        //print_r($datos_integracion[2]);
        if ($ajax == "ajax") {
                $row .= file_get_contents("views/mi_equipo_lider/" . $id_empresa . "_row_equipo_resumen_ajax.html");
        } else {
                $row .= file_get_contents("views/mi_equipo_lider/" . $id_empresa . "_row_equipo_resumen.html");
        }
         //echo "<br>hola1";
        $buscaCursosHistoricosAprobados=VistaCursosHistoricosResumenData($unico->rut, $id_empresa);
        $cuentaApro=0;$cuentaCursos=0;
        foreach ($buscaCursosHistoricosAprobados as $unicoRow)

        {
                if($unicoRow->estado=="APROBADO"){
                    $cuentaApro++;
                }
                $cuentaCursos++;
        }
        $rut_enco=Encodear3($unico->rut);
        $row_historicos="

                            <span class='badge badge-info'><span class='blanco'>".$cuentaCursos."</span> </span> <span class=' font-blue'> cursos realizados</span>
                            <span class='badge badge-primary'><span class='blanco'>     ".$cuentaApro."</span> </span><span class=' font-blue'>  cursos aprobados</span>
                            <a href='?sw=lms_lista_historicos&rut_enc=".$rut_enco."' class='btn btn-info btn-sm' ><span class='blanco'>Ver Cursos Hist?ricos</span></a>
                            <br>
                        ";

        $row                = str_replace("{ROW_HISTORICOS}", utf8_decode($row_historicos), $row);

        $row                = str_replace("{ROW_LISTA_PROGRAMAS_mi_equipo_lider}", utf8_decode($datos_integracion[0]), $row);
        //echo "<br>hola2";

        $row                = str_replace("{RUT_JEFE}", $unico->rut, $row);
        $array_Reco_Gracias = BuscaDatosReconocimientoAgradecimientos($unico->rut, $id_empresa);
        if ($array_Reco_Gracias[0]->num_gracias > 0) {
            $num_gracias = $array_Reco_Gracias[0]->num_gracias;
        } else {
            $num_gracias = 0;
        }
        if ($array_Reco_Gracias[0]->num_reconocimientos > 0) {
            $num_reconocimientos = $array_Reco_Gracias[0]->num_reconocimientos;
        } else {
            $num_reconocimientos = 0;
        }
        $row = str_replace("{NUM_RECONOCIMIENTOS}", $num_reconocimientos, $row);
        $row = str_replace("{NUM_GRACIAS}", $num_gracias, $row);
        if ($datos_integracion[2]) {
            $row = str_replace("{TRIVIAS}", file_get_contents("views/mi_equipo_lider/" . $id_empresa . "_boton_ver_trivias.html"), $row);
            if ($id_objeto) {
                $datos_objeto = DatosObjeto($id_objeto);
                $row          = str_replace("{OBJETO}", $datos_objeto[0]->titulo, $row);
            } else {
                $row = str_replace("{OBJETO}", "", $row);
            }
            $row = str_replace("{PROMEDIO_TRIVIAS_POR_PROGRAMA}", $datos_integracion[2], $row);
            $row = str_replace("{PROMEDIO_TRIVIAS_POR_PROGRAMA_1A7}", ColocaNotaConvertidaTrivia($datos_integracion[2]), $row);
            $row = str_replace("{RUT_COLABORADOR_ENCODADO}", Encodear3($unico->rut), $row);
        } else {
            $row = str_replace("{TRIVIAS}", "", $row);
        }
        $datos_mallapersona = buscamalla($unico->rut, $id_empresa);
        $datos_mallapersona[0]->id_malla;
        $datos_malla        = DatosMalla($datos_mallapersona[0]->id_malla);
        $datos_consolidados = TienePuntosConsolidadosPorMalla($unico->rut, $id_empresa, $datos_mallapersona[0]->id_malla);
        $row                = str_replace("{PUNTOS}", $datos_consolidados[0]->puntos, $row);
        $promedio_trivias   = PromedioTrivias($unico->rut, $id_empresa);
        if (!$promedio_trivias[0]->promedio_trivias) {
            $row = str_replace("{PROMEDIO}", "0", $row);
        } else {
            $row = str_replace("{PROMEDIO}", round($promedio_trivias[0]->promedio_trivias), $row);
        }
        if ($promedio_trivias[0]->promedio_trivias > 0) {
            $row = str_replace("{PODERES}", "<img src='img/61_rf_badges_5.png' width='20'>", $row);
        } else {
            $row = str_replace("{PODERES}", "", $row);
        }
        $medallas = "";
        for ($k = 1; $k <= $datos_consolidados[0]->medallas; $k++) {
            $medallas .= "<img src='img/rf_medal.png'>";
        }
        //$row = str_replace("{MEDALLAS}",$datos_consolidados[0]->medallas,$row);
        $row               = str_replace("{MEDALLAS}", $medallas, $row);
        $arreglo_subequipo = TotalUsuariosPorRutJefe($unico->rut);
        $num_subequipo     = count($arreglo_subequipo);
        if ($num_subequipo > 0) {
            $mi_equipo_ver_equipo = "<span class='label-small label-small-info  pull-right'>Ver Equipo <span class='badge'>" . $num_subequipo . " <i class='icon-people icons'></i></span> </span>";
        } else {
            $mi_equipo_ver_equipo = "";
        }
        $row = str_replace("{NOMBRE}", $unico->nombre . " " . $unico->apaterno . " " . $unico->amaterno, $row);
        $row = str_replace("{CARGO}", $unico->cargo, $row);
        $row = str_replace("{GERENCIA}", $unico->gerencia, $row);
        $row = str_replace("{FECHA_CUMPLEANOS}", formatearFecha($unico->fecha_nacimiento), $row);
        $row = str_replace("{URL_PERSONA}", VerificaFotoPersonal($unico->rut), $row);
        $row = str_replace("{RUT_ENCODEADO}", Encodear3($unico->rut), $row);
        $row = str_replace("{MALLA}", ($datos_malla[0]->nombre), $row);
        $row = str_replace("{MIEQUIPO_VER_EQUIPO}", ($mi_equipo_ver_equipo), $row);
        $row = str_replace("{NUM_MIEQUIPO_VER_EQUIPO}", ($num_subequipo), $row);
        $row = str_replace("{RUT_COL}", ($unico->rut), $row);

    //echo "<br>hola3";


 list($total_inscripciones, $total_aprobados, $total_reprobados, $total_en_proceso) = CAPACITACION_DatosGeneralesPorUsuario($unico->rut);
        $estado                           = EntregaEstadoAvanceBarraMalla(EntregaPorcentaje($total_inscripciones, $total_aprobados));
        $listado_colaborador_sub          = TotalUsuariosPorRutJefe($unico->rut);
        $num_reportes_sub                 = count($listado_colaborador_sub);
        $accion                           = Lms_Busca_Acciones_Pendientes($rut, $unico->rut, $id_empresa);
        $preguntaspendientes              = Lms_Busca_Preguntas_Pendientes($rut, $unico->rut, $id_empresa);
        //echo "<pre>";
        //print_r($preguntaspendientes);
        //$row = str_replace("{TRIVIAS}",("TRIVIAS"),$row);
        $row                              = str_replace("{ACCION}", ($accion), $row);
        $row                              = str_replace("{PREGUNTAS}", ($preguntaspendientes), $row);
        //Desafios Finaliados
        $desafios_finalizados             = TraigoDesafiosFinalizados($unico->rut, $id_empresa);
        $row                              = str_replace("{DESAFIOS_FINALIZADOS}", count($desafios_finalizados), $row);
        $avance                           = round(EntregaPorcentaje($total_inscripciones, $total_aprobados));
        //    echo "<br>$avance";
        $acumulador_avance_colaboradores  = $acumulador_avance_colaboradores + EntregaPorcentaje($total_inscripciones, $total_aprobados);
        $PRINCIPAL                        = str_replace("{NUMERO_AVANCE}", round(EntregaPorcentaje($total_inscripciones, $total_aprobados)), $PRINCIPAL);
        $PRINCIPAL                        = str_replace("{COLOR_PROGRESS_BAR}", $estado[0], $PRINCIPAL);
        $row                              = str_replace("{AVANCE_COLABORADOR}", EntregaPorcentaje($total_inscripciones, $total_aprobados), $row);
        //$total_visitas=TotalVisitasDadoRutCaseEmpresaFront($unico->rut, $id_empresa, "home_minvest");
        $row                              = str_replace("{NUM_VISITAS_COLABORADOR}", $total_visitas[0]->total_visitas, $row);
        $acumulador_visitas_colaboradores = $acumulador_visitas_colaboradores + $total_visitas[0]->total_visitas;
        $cuenta_colaborador++;
        $preguntasPendiente       = Lms_Cuenta_Preguntas_Pendientes_data($unico->rut, $id_empresa);
        $num_preguntas_pendientes = $preguntasPendiente[0]->pendientes + $num_preguntas_pendientes;
        //print_r($preguntasPendiente);
        //echo "<br>num_preguntas_pendientes $num_preguntas_pendientes";
        $num_preguntas_realizadas = $preguntasPendiente[0]->realizadas + $num_preguntas_realizadas;
    }


    $accionesPendiente          = Lms_Cuenta_Acciones_Pendientes_data_lider($rut, $id_empresa);
    $num_acciones_pendientes    = $accionesPendiente[0]->pendientes;
    $num_acciones_realizadas    = $accionesPendiente[0]->realizadas;
    //echo "<br>hola4";

    //echo "cuentacolaborador $cuenta_colaborador, nun acciones $num_acciones_pendientes, $num_acciones_realizadas";
    //echo "100*$acumulador_avance_colaboradores/$cuenta_colaborador";
    $sum_verde                  = round(100 * $num_acciones_realizadas / $cuenta_colaborador);
    $sum_amarillo               = 0;
    $sum_rojo                   = round(100 * $num_acciones_pendientes / $cuenta_colaborador);
    $sum_avanceequipo           = round($acumulador_avance_colaboradores / $cuenta_colaborador);
    $lms_avance_equipo          = $sum_avanceequipo;
    $lms_graf_acciones_rojo     = $sum_rojo;
    $lms_graf_acciones_amarillo = $sum_amarillo;
    $lms_graf_acciones_verde    = $sum_verde;
    $promedio_final             = $acumulador_nota_final / $contador_colaboradores;
    $PRINCIPAL                  = str_replace("{VALOR_PROMEDIO}", round($promedio_final), $PRINCIPAL);
    $PRINCIPAL                  = str_replace("{NUM_PERSONAS_MI_EQUIPO}", count($listado_colaboradores), $PRINCIPAL);
    $PRINCIPAL                  = str_replace("{PROMEDIO_EQUIPO}", round($acumulador_avance_colaboradores / count($listado_colaboradores)), $PRINCIPAL);
    $PRINCIPAL                  = str_replace("{NUM_VISITAS_MI_EQUIPO}", $acumulador_visitas_colaboradores, $PRINCIPAL);
    $PRINCIPAL                  = str_replace("{BLOQUE_COLABORADORES}", ($row), $PRINCIPAL);
    $PRINCIPAL                  = str_replace("{LMS_GRAFICO_1COLOR}", file_get_contents("views/mi_equipo_lms/" . $id_empresa . "_barra_1color.html"), $PRINCIPAL);
    $PRINCIPAL                  = str_replace("{LMS_AVANCEEQUIPO}", $lms_avance_equipo, $PRINCIPAL);
    $PRINCIPAL                  = str_replace("{LMS_GRAFICO_3COLORES}", file_get_contents("views/mi_equipo_lms/" . $id_empresa . "_barra_3colores.html"), $PRINCIPAL);
    $PRINCIPAL                  = str_replace("{VALUEVERDE}", $lms_graf_acciones_verde, $PRINCIPAL);
    $PRINCIPAL                  = str_replace("{VALUEAMARILLO}", $lms_graf_acciones_amarillo, $PRINCIPAL);
    $PRINCIPAL                  = str_replace("{VALUEROJO}", $lms_graf_acciones_rojo, $PRINCIPAL);
    $PRINCIPAL                  = str_replace("{LMS_NUM_PENDIENTES}", $num_acciones_pendientes, $PRINCIPAL);
    $PRINCIPAL                  = str_replace("{LMS_NUM_REALIZADOS}", $num_acciones_realizadas, $PRINCIPAL);
    //AVANCE GLOBAL Y POR C1,C2, C3, C4
    $arra_usu                   = busca_c1_c2_c3_c4_jefe($rut, $id_empresa);
    //print_r($arra_usu);
    $c1                         = $arra_usu[0]->c1;
    $c2                         = $arra_usu[0]->c2;
    $c3                         = $arra_usu[0]->c3;
    $c4                         = $arra_usu[0]->c4;
    $jefe                       = $arra_usu[0]->jefe;
    //echo "<br>c1 $c1, c2 $c2, c3 $c3, c4 $c4, jefe $jefe<br>";
    $data_array_avance          = lms_avance_promedio_c1_c2_c3_c4_jefe($rut, $c1, $c2, $c3, $c4, $jefe, $programa, $curso, $id_empresa);
    //print_r($data_array_avance);
    $PRINCIPAL                  = str_replace("{AVANCE_PROM_TOTAL}", round($data_array_avance[5], 0), $PRINCIPAL);
    $PRINCIPAL                  = str_replace("{AVANCE_PROM_JEFE}", round($data_array_avance[4], 0), $PRINCIPAL);
    $PRINCIPAL                  = str_replace("{AVANCE_PROM_C1}", round($data_array_avance[0], 0), $PRINCIPAL);
    $PRINCIPAL                  = str_replace("{AVANCE_PROM_C2}", round($data_array_avance[1], 0), $PRINCIPAL);
    $PRINCIPAL                  = str_replace("{AVANCE_PROM_C3}", round($data_array_avance[2], 0), $PRINCIPAL);
    $PRINCIPAL                  = str_replace("{AVANCE_PROM_C4}", round($data_array_avance[3], 0), $PRINCIPAL);
    $PRINCIPAL                  = str_replace("{AVANCE_PROM_IND}", round($data_array_avance[6], 0), $PRINCIPAL);

  $listaProgramas_Select      = lms_integracion_lista_programasSinRut($id_empresa, $rut);
    $options_select_programa    = "";
    foreach ($listaProgramas_Select as $prog) {
        if ($id_programa_bbdd == $prog->id_programa) {
            $options_select_programa .= "<option value='" . $prog->id_programa . "' selected='selected'>" . $prog->nombre_programa . "</option>";
        } else {
            $options_select_programa .= "<option value='" . $prog->id_programa . "'>" . $prog->nombre_programa . "</option>";
        }
    }
    $PRINCIPAL = str_replace("{OPTIONS_PROGRAMAS_BBDD}", ($options_select_programa), $PRINCIPAL);
    if ($id_programa_bbdd) {
        $arreglo_post   = $_POST;
        $cursos         = REL_MALLA_CURSO_TraeCursosDadoPrograma2($id_empresa, $arreglo_post);
        $options_cursos = "";
        foreach ($cursos as $prog) {
            if ($prog->id_curso == $id_curso) {
                $options_cursos .= "<option value='" . $prog->id_curso . "' selected>" . $prog->nombre . " (" . $prog->id_curso . ")</option>";
            } else {
                $options_cursos .= "<option value='" . $prog->id_curso . "'>" . $prog->nombre . " (" . $prog->id_curso . ")</option>";
            }
        }
    }
    $PRINCIPAL = str_replace("{OPTIONS_CURSOS}", ($options_cursos), $PRINCIPAL);
    //Objetos
    if ($id_curso) {
        $objetos = CHECK_ObjetosPorCurso($arreglo_post["cursos"]);
        $options = "";
        foreach ($objetos as $obj) {
            if ($obj->id == $id_objeto) {
                $options .= "<option selected value='" . $obj->id . "'>" . $obj->titulo . "</option>";
            } else {
                $options .= "<option value='" . $obj->id . "'>" . $obj->titulo . "</option>";
            }
        }
        $PRINCIPAL = str_replace("{OPTIONS_OBJETOS}", ($options), $PRINCIPAL);
    }
    //Mallas
    $mallas = MallasPorEmpresa2($id_empresa);
    foreach ($mallas as $mal) {
        if ($mal->nombre <> '') {
            $options_mallas .= "<option value='" . $mal->id . "'>" . $mal->nombre . "</option>";
        }
    }
    $PRINCIPAL            = str_replace("{OPTIONS_MALLAS}", ($options_mallas), $PRINCIPAL);
    //Mensajes_por Agente
    $total_respondidas    = 0;
    $total_no_respondidas = 0;
    $mensajes_por_Agente  = TraeMensajesPorAgente($rut, $id_empresa);
    foreach ($mensajes_por_Agente as $mensaje) {
        if ($mensaje->total_respuestas_agente > 0) {
            $total_respondidas++;
        } else {
            $total_no_respondidas++;
        }
    }
    //$PRINCIPAL = str_replace("{LMS_NUM_PREGUNTAS_PENDIENTES}",$num_preguntas_pendientes,$PRINCIPAL);
    //$PRINCIPAL = str_replace("{LMS_NUM_PREGUNTAS_REALIZADOS}",$num_preguntas_realizadas,$PRINCIPAL);
    $array_Reco_Gracias = BuscaDatosReconocimientoAgradecimientos($unico->rut, $id_empresa);
    if ($array_Reco_Gracias[0]->num_gracias > 0) {
        $num_gracias = $array_Reco_Gracias[0]->num_gracias;
    } else {
        $num_gracias = 0;
    }
    if ($array_Reco_Gracias[0]->num_reconocimientos > 0) {
        $num_reconocimientos = $array_Reco_Gracias[0]->num_reconocimientos;
    } else {
        $num_reconocimientos = 0;
    }
    $PRINCIPAL = str_replace("{NUM_RECONOCIMIENTOS}", $num_reconocimientos, $PRINCIPAL);
    $PRINCIPAL = str_replace("{NUM_GRACIAS}", $num_gracias, $PRINCIPAL);
    $PRINCIPAL = str_replace("{LMS_NUM_PREGUNTAS_PENDIENTES}", $total_no_respondidas, $PRINCIPAL);
    $PRINCIPAL = str_replace("{LMS_NUM_PREGUNTAS_REALIZADOS}", $total_respondidas, $PRINCIPAL);
    return ($PRINCIPAL);
}

function Busca_Cursos_historicos($PRINCIPAL, $id_empresa, $rut)
{
    $cursos_historicos = VistaCursosHistoricosData($rut, $id_empresa);
    // print_r($cursos_historicos);
    foreach($cursos_historicos as $unico) {
        if ($unico->estado == "APROBADO") {
            $estado_curso = "<span class='label label-sm label-success'> Aprobado </span>";
            $txt_estado = "APROBADO";
        }
        elseif ($unico->estado <> "APROBADO" and $unico->avance2 > 0 and $unico->avance2 < 100) {
            $txt_estado = "EN_PROCESO";
            $estado_curso = "<span class='label label-sm label-warning'> En Proceso </span>";
        }
        elseif ($unico->estado <> "APROBADO" and $unico->avance2 > 0 and $unico->avance2 < 100) {
            $txt_estado = "EN_PROCESO";
            $estado_curso = "<span class='label label-sm label-warning'> En Proceso </span>";
        }
        else {
            $txt_estado = "REPROBADO";
            $estado_curso = "";
        }
        if ($unico->modalidad == "1") {
            $modalidad = "Elearning";
        }
        else {
            $modalidad = "Presencial";
        }
        if ($unico->avance <> '') {
            $avance = $unico->avance . "%";
        }
        else {
            if ($unico->avance2 <> '') {
                $avance = $unico->avance2 . "%";
            }
            else {
                $avance = "-";
            }
        }
        if ($unico->nota <> '') {
            $nota = $unico->nota;
        }
        else {
            if ($unico->nota2 <> '') {
                $nota = $unico->nota2;
            }
            else {
                $nota = "-";
            }
        }
        //    <td>".($unico->id_inscripcion)."</td>
        if ($txt_estado == "APROBADO") {
            $rows.= "<tr>
    <td style='text-transform: uppercase;'>" . ($unico->curso) . "</td>
    <td>" . ($modalidad) . "</td>
    <td>" . ($unico->fecha_inicio) . "</td>
    <td>" . ($unico->fecha_termino) . "</td>
    <td>" . ($estado_curso) . "</td>
    <td>" . ($avance) . "</td>
    <td>" . ($nota) . "</td>
    <td><center><input type='checkbox' name='" . $unico->id_inscripcion . "' value='" . $unico->id_inscripcion . "'></center></td>
</tr>";
        }
        else if ($txt_estado == "EN_PROCESO") {
            $rows.= "<tr>
    <td style='text-transform: uppercase;'>" . ($unico->curso) . "</td>
    <td>" . ($modalidad) . "</td>
    <td>" . ($unico->fecha_inicio) . "</td>
    <td>" . ($unico->fecha_termino) . "</td>
    <td>" . ($estado_curso) . "</td>
    <td>" . ($avance) . "</td>
    <td>" . ($nota) . "</td>
    <td></td>
</tr>";
        }
        else if ($txt_estado == "REPROBADO") {
            $rows.= "<tr>
    <td style='text-transform: uppercase;'>" . ($unico->curso) . "</td>
    <td >" . ($modalidad) . "</td>
    <td>" . ($unico->fecha_inicio) . "</td>
    <td>" . ($unico->fecha_termino) . "</td>
    <td>" . ($estado_curso) . "</td>
    <td>" . ($avance) . "</td>
    <td>" . ($nota) . "</td>
    <td></td>
</tr>";
        }
        // echo "$options";
    }
    return ($rows);
}

function Busca_Certificados_Cursos_lmsReportes($PRINCIPAL, $id_empresa, $rut, $id_modalidad)
{
    $cursos_certificados = VistaCursosLmsReporte_Certificado_Data($rut, $id_empresa,$id_modalidad);
     //print_r($cursos_certificados);
    foreach($cursos_certificados as $unico) {

    if($unico->avance<>100){continue;}
    if($unico->curso==""){continue;}

     if ($unico->estado_descripcion == "APROBADO") {
            $estado_curso = "<span class='label label-sm label-success'><span class='blanco'> Aprobado </span></span>";
            $txt_estado = "APROBADO";
        }
        elseif ($unico->estado_descripcion <> "APROBADO" and $unico->avance2 > 0 and $unico->avance2 < 100) {
            $txt_estado = "EN_PROCESO";
            $estado_curso = "<span class='label label-sm label-warning'><span class='blanco'> En Proceso </span></span>";
        }
        elseif ($unico->estado_descripcion <> "APROBADO" and $unico->avance2 > 0 and $unico->avance2 < 100) {
            $txt_estado = "EN_PROCESO";
            $estado_curso = "<span class='label label-sm label-warning'><span class='blanco'> En Proceso </span></span>";
        }
        elseif ($unico->estado_descripcion =="REPROBADO") {
            $txt_estado = "REPROBADO";
            $estado_curso = "<span class='label label-sm label-danger'><span class='blanco'> Reprobado </span></span>";
        }
         elseif ($unico->estado_descripcion =="" and $unico->estado_reportes=="REPROBADO") {
            $txt_estado = "REPROBADO";
            $estado_curso = "<span class='label label-sm label-danger'><span class='blanco'> Reprobado </span></span>";
        }
       elseif ($unico->estado_descripcion =="" and $unico->estado_reportes=="APROBADO") {
            $txt_estado = "APROBADO";
            $estado_curso = "<span class='label label-sm label-success'><span class='blanco'> APROBADO </span></span>";
        }
        else {
            $txt_estado = "REPROBADO";
            $estado_curso = "";
        }
        if ($unico->modalidad == "1") {
            $modalidad = "Elearning";
        }
        elseif($unico->modalidad == "2") {
            $modalidad = "Presencial";
        }
        elseif($unico->modalidad == "3") {
            $modalidad = "Blended";
        }
        elseif($unico->modalidad == "4") {
            $modalidad = "Elearning";
        }

        if ($unico->avance <> '') {
            $avance = $unico->avance . "%";
        }
        else {
            if ($unico->avance2 <> '') {
                $avance = $unico->avance2 . "%";
            }
            else {
                $avance = "-";
            }
        }
        if ($unico->nota <> '') {
            $nota = $unico->nota;
        }
        else {
            if ($unico->nota2 <> '') {
                $nota = $unico->nota2;
            }
            else {
                $nota = "-";
            }
        }



        $fecha=$unico->fecha_Curso_Id_Inscripcion;


        if($fecha==""){
                 $fecha=$unico->fecha_Curso_Id_Inscripcion;

        }
        if($fecha==""){
                 $fecha=$unico->fecha_Curso_Id_Inscripcion_respuestas;

        }

if($id_empresa=="61"){

        if ($txt_estado == "APROBADO") {
            $rows.= "<tr>
    <td style='text-transform: uppercase; padding: 10px; vertical-align: middle;'> <i class='fas fa-angle-right'></i> " . ($unico->programa) . " " . ($unico->curso) . "</td>
    <td style='text-transform: uppercase; padding: 10px; vertical-align: middle;'>" . ($modalidad) . "</td>
    <td style='text-transform: uppercase; padding: 10px; vertical-align: middle;'>" . ($fecha) . "</td>
    <td style='text-transform: uppercase; padding: 10px; vertical-align: middle;'>" . ($estado_curso) . "</td>
    <td style='text-transform: uppercase; padding: 10px; vertical-align: middle;'><center>" . ($avance) . "</center></td>
    <td style='text-transform: uppercase; padding: 10px; vertical-align: middle;'>" . ($nota) . "</td>
    <td style='text-transform: uppercase; padding: 10px; vertical-align: middle;'><center><input type='checkbox' name='" . $unico->id_inscripcion . "' value='" . $unico->id_inscripcion . "'></center></td>
    <td style='text-transform: uppercase; padding: 10px; vertical-align: middle;'><center><a href='?sw=lms_diploma_curso_generico&rut_enc=".Encodear3($rut)."&text_curso=".Encodear3($unico->curso)."&pdf=1' target='_blank' class='btn btn-info'><span class='blanco'>Ver Diploma</span></a></td>
</tr>";
        }
        else if ($txt_estado == "EN_PROCESO") {
            $rows.= "<tr>
    <td style='text-transform: uppercase; padding: 10px; vertical-align: middle;'> <i class='fas fa-angle-right'></i> " . ($unico->curso) . "</td>
    <td style='text-transform: uppercase; padding: 10px; vertical-align: middle;'>" . ($modalidad) . "</td>
    <td style='text-transform: uppercase; padding: 10px; vertical-align: middle;'>" . ($fecha) . "</td>
    <td style='text-transform: uppercase; padding: 10px; vertical-align: middle;'>" . ($estado_curso) . "</td>
    <td style='text-transform: uppercase; padding: 10px; vertical-align: middle;'><center>" . ($avance) . "</center></td>
    <td style='text-transform: uppercase; padding: 10px; vertical-align: middle;'>" . ($nota) . "</td>
    <td style='text-transform: uppercase; padding: 10px; vertical-align: middle;'></td>
    <td></td>
</tr>";
        }
        else if ($txt_estado == "REPROBADO") {
            $rows.= "<tr>
    <td style='text-transform: uppercase; padding: 10px; vertical-align: middle;'> <i class='fas fa-angle-right'></i> " . ($unico->curso) . "</td>
    <td style='text-transform: uppercase; padding: 10px; vertical-align: middle;'>" . ($modalidad) . "</td>
    <td style='text-transform: uppercase; padding: 10px; vertical-align: middle;'>" . ($fecha) . "</td>
    <td style='text-transform: uppercase; padding: 10px; vertical-align: middle;'>" . ($estado_curso) . "</td>
    <td style='text-transform: uppercase; padding: 10px; vertical-align: middle;'><center>" . ($avance) . "</center></td>
    <td style='text-transform: uppercase; padding: 10px; vertical-align: middle;'>" . ($nota) . "</td>
    <td style='text-transform: uppercase; padding: 10px; vertical-align: middle;'></td>
    <td></td>
</tr>";
        }
     }

else if($id_empresa=="75"){

        if ($txt_estado == "APROBADO") {
            $rows.= "<tr>
    <td style='text-transform: uppercase; padding: 10px; vertical-align: middle;'> <i class='fas fa-angle-right'></i> " . ($unico->curso) . "</td>
    <td style='text-transform: uppercase; padding: 10px; vertical-align: middle;'>" . ($modalidad) . "</td>
    <td style='text-transform: uppercase; padding: 10px; vertical-align: middle;'>" . ($fecha) . "</td>
    <td style='text-transform: uppercase; padding: 10px; vertical-align: middle;'>" . ($estado_curso) . "</td>
    <td style='text-transform: uppercase; padding: 10px; vertical-align: middle;'><center>" . ($avance) . "</center></td>
    <td style='text-transform: uppercase; padding: 10px; vertical-align: middle;'>" . ($nota) . "</td>
    <td style='text-transform: uppercase; padding: 10px; vertical-align: middle;'><center><a href='?sw=lms_diploma_curso_generico&rut_enc=".Encodear3($rut)."&text_curso=".Encodear3($unico->curso)."&text_curso2=".Encodear3($unico->nota)."&text_curso3=".Encodear3($nota)."&pdf=1' target='_blank' class='btn btn-info'><span class='blanco'>Ver Diploma</span></a></td>
</tr>";
        }
        else if ($txt_estado == "EN_PROCESO") {
            $rows.= "<tr>
    <td style='text-transform: uppercase; padding: 10px; vertical-align: middle;'> <i class='fas fa-angle-right'></i> " . ($unico->curso) . "</td>
    <td style='text-transform: uppercase; padding: 10px; vertical-align: middle;'>" . ($modalidad) . "</td>
    <td style='text-transform: uppercase; padding: 10px; vertical-align: middle;'>" . ($fecha) . "</td>
    <td style='text-transform: uppercase; padding: 10px; vertical-align: middle;'>" . ($estado_curso) . "</td>
    <td style='text-transform: uppercase; padding: 10px; vertical-align: middle;'><center>" . ($avance) . "</center></td>
    <td style='text-transform: uppercase; padding: 10px; vertical-align: middle;'>" . ($nota) . "</td>

    <td></td>
</tr>";
        }
        else if ($txt_estado == "REPROBADO") {
            $rows.= "<tr>
    <td style='text-transform: uppercase; padding: 10px; vertical-align: middle;'> <i class='fas fa-angle-right'></i> " . ($unico->curso) . "</td>
    <td style='text-transform: uppercase; padding: 10px; vertical-align: middle;'>" . ($modalidad) . "</td>
    <td style='text-transform: uppercase; padding: 10px; vertical-align: middle;'>" . ($fecha) . "</td>
    <td style='text-transform: uppercase; padding: 10px; vertical-align: middle;'>" . ($estado_curso) . "</td>
    <td style='text-transform: uppercase; padding: 10px; vertical-align: middle;'><center>" . ($avance) . "</center></td>
    <td style='text-transform: uppercase; padding: 10px; vertical-align: middle;'>" . ($nota) . "</td>

    <td></td>
</tr>";
        }

}   else {
        //    <td>".($unico->id_inscripcion)."</td>
        if ($txt_estado == "APROBADO") {
            $rows.= "<tr>
    <td style='text-transform: uppercase; padding: 10px; vertical-align: middle;'> <i class='fas fa-angle-right'></i> " . ($unico->curso) . "</td>
    <td style='text-transform: uppercase; padding: 10px; vertical-align: middle;'>" . ($modalidad) . "</td>
    <td style='text-transform: uppercase; padding: 10px; vertical-align: middle;'>" . ($fecha) . "</td>
    <td style='text-transform: uppercase; padding: 10px; vertical-align: middle;'>" . ($estado_curso) . "</td>
    <td style='text-transform: uppercase; padding: 10px; vertical-align: middle;'><center>" . ($avance) . "</center></td>
    <td style='text-transform: uppercase; padding: 10px; vertical-align: middle;'>" . ($nota) . "</td>
    <td style='text-transform: uppercase; padding: 10px; vertical-align: middle;'><center><input type='checkbox' name='" . $unico->id_inscripcion . "' value='" . $unico->id_inscripcion . "'></center></td>
    <td style='text-transform: uppercase; padding: 10px; vertical-align: middle;'><center><a href='?sw=lms_diploma_curso_generico&rut_enc=".Encodear3($rut)."&text_curso=".Encodear3($unico->curso)."&text_curso2=".Encodear3($unico->nota)."&text_curso3=".Encodear3($nota)."&pdf=1' target='_blank' class='btn btn-info'><span class='blanco'>Ver Diploma</span></a></td>

</tr>";
        }
        else if ($txt_estado == "EN_PROCESO") {
            $rows.= "<tr>
    <td style='text-transform: uppercase; padding: 10px; vertical-align: middle;'> <i class='fas fa-angle-right'></i> " . ($unico->curso) . "</td>
    <td style='text-transform: uppercase; padding: 10px; vertical-align: middle;'>" . ($modalidad) . "</td>
    <td style='text-transform: uppercase; padding: 10px; vertical-align: middle;'>" . ($fecha) . "</td>
    <td style='text-transform: uppercase; padding: 10px; vertical-align: middle;'>" . ($estado_curso) . "</td>
    <td style='text-transform: uppercase; padding: 10px; vertical-align: middle;'><center>" . ($avance) . "</center></td>
    <td style='text-transform: uppercase; padding: 10px; vertical-align: middle;'>" . ($nota) . "</td>
    <td style='text-transform: uppercase; padding: 10px; vertical-align: middle;'></td>
<td></td></tr>";
        }
        else if ($txt_estado == "REPROBADO") {
            $rows.= "<tr>
    <td style='text-transform: uppercase; padding: 10px; vertical-align: middle;'> <i class='fas fa-angle-right'></i> " . ($unico->curso) . "</td>
    <td style='text-transform: uppercase; padding: 10px; vertical-align: middle;'>" . ($modalidad) . "</td>
    <td style='text-transform: uppercase; padding: 10px; vertical-align: middle;'>" . ($fecha) . "</td>
    <td style='text-transform: uppercase; padding: 10px; vertical-align: middle;'>" . ($estado_curso) . "</td>
    <td style='text-transform: uppercase; padding: 10px; vertical-align: middle;'><center>" . ($avance) . "</center></td>
    <td style='text-transform: uppercase; padding: 10px; vertical-align: middle;'>" . ($nota) . "</td>
    <td style='text-transform: uppercase; padding: 10px; vertical-align: middle;'></td>
<td></td></tr>";
        }
        // echo "$options";

        }
    }
    return ($rows);
}



function BacBus_FILTRO_TIPO($PRINCIPAL, $id_empresa, $dato)
{
    if ($dato <> '') {
        $options .= "<option value='" . $dato . "'>" . ($dato) . "</option>";
    }
    $options .= "<option value=''>Todos</option>";
    $options .= "<option value='BAC'>IRP</option>";
    $options .= "<option value='BUS'>IRU</option>";
    $options .= "<option value='DCR'>IRA</option>";
    return ($options);
}
function BacBus_FILTRO_ESTADO($PRINCIPAL, $id_empresa, $dato)
{
    if ($dato <> '') {
        $options .= "<option value='" . $dato . "'>" . ($dato) . "</option>";
    }
    $options .= "<option value=''>Todos</option>";
    $options .= "<option value='Sin Iniciar'>Sin Iniciar</option>";
    $options .= "<option value='En Proceso'>En Proceso</option>";
    $options .= "<option value='Demora'>Demora</option>";
    $options .= "<option value='Cerrada'>Cerrada</option>";
    return ($options);
}
function BacBus_FILTRO_CUI($PRINCIPAL, $id_empresa, $dato)
{
    if ($dato <> '') {
        $options .= "<option value='" . $dato . "'>" . ($dato) . "</option>";
    }
    $options .= "<option value=''>Todos</option>";
    $dash_id_gerencias = BAC_buscaCuiAgrupado($id_empresa);
    foreach ($dash_id_gerencias as $unico) {
        $options .= "<option value='" . $unico->id_cui_col . "'>" . ($unico->id_cui_col) . "</option>";
    }
    //echo "$options";
    return ($options);
}
function Dashboard_Full_filtro_gerencia($PRINCIPAL, $id_empresa, $id_gerencia)
{
    $buscadato_seleccionado = dash_buscadatocampo('dato10', 'dato138', $id_gerencia, $id_empresa);
    $options .= "<option value='" . $buscadato_seleccionado[0]->campo2 . "'>" . ($buscadato_seleccionado[0]->campo) . "</option>";
    $dash_id_gerencias = dash_busca_id_gerencia($id_empresa);
    foreach ($dash_id_gerencias as $unico) {
        $options .= "<option value='" . $unico->dato138 . "'>" . ($unico->dato10) . "</option>";
    }
    //echo "$options";
    return ($options);
}
function Dashboard_Full_filtro_departamento($PRINCIPAL, $id_empresa, $id_departamento)
{
    $buscadato_seleccionado = dash_buscadatocampo('dato7', 'dato9', $id_departamento, $id_empresa);
    $options .= "<option value='" . $buscadato_seleccionado[0]->campo2 . "'>" . ($buscadato_seleccionado[0]->campo) . "</option>";
    $dash_id_gerencias = dash_busca_id_departamento($id_empresa);
    foreach ($dash_id_gerencias as $unico) {
        $options .= "<option value='" . $unico->dato9 . "'>" . ($unico->dato7) . "</option>";
    }
    return ($options);
}
function Dashboard_Full_filtro_zona($PRINCIPAL, $id_empresa, $id_zona)
{
    $buscadato_seleccionado = dash_buscadatocampo('dato12', 'dato13', $id_zona, $id_empresa);
    $options .= "<option value='" . $buscadato_seleccionado[0]->campo2 . "'>" . ($buscadato_seleccionado[0]->campo) . "</option>";
    $dash_id_gerencias = dash_busca_id_zona($id_empresa);
    foreach ($dash_id_gerencias as $unico) {
        $options .= "<option value='" . $unico->dato13 . "'>" . ($unico->dato12) . "</option>";
    }
    //echo "$options";
    return ($options);
}

function Dashboard_Full_filtro_zona_depto($PRINCIPAL, $id_empresa)
{
    $buscadato_seleccionado = dash_busca_zona_depto($id_empresa);
    $options .= "<option value=''>Todos</option>";
    foreach ($buscadato_seleccionado as $unico) {
        $options .= "<option value='" . $unico->campo . "'>" . ($unico->campo) . "</option>";
    }
  //  echo "$options";
    return ($options);
}


function Dashboard_Full_filtro_dotacion_gerencia($PRINCIPAL, $id_empresa, $id_gerencia, $id_departamento, $id_zona)
{
    $dash_dotaciones = dash_busca_dotacion($id_gerencia, $id_departamento, $id_zona, $id_empresa);
    return ($dash_dotaciones);
}
function colocarColaboradoresPorRutConDatos_lms_liderBK($PRINCIPAL, $id_empresa, $rut)
{
    $listado_colaboradores = TotalUsuariosPorRutJefe($rut);
    foreach ($listado_colaboradores as $unico) {
        $row .= file_get_contents("views/mi_equipo_lider/" . $id_empresa . "_row_equipo_resumen.html");
        $datos_mallapersona = buscamalla($unico->rut, $id_empresa);
        $datos_mallapersona[0]->id_malla;
        $datos_malla        = DatosMalla($datos_mallapersona[0]->id_malla);
        $datos_consolidados = TienePuntosConsolidadosPorMalla($unico->rut, $id_empresa, $datos_mallapersona[0]->id_malla);
        $row                = str_replace("{PUNTOS}", $datos_consolidados[0]->puntos, $row);
        $promedio_trivias   = PromedioTrivias($unico->rut, $id_empresa);
        if (!$promedio_trivias[0]->promedio_trivias) {
            $row = str_replace("{PROMEDIO}", "0", $row);
        } else {
            $row = str_replace("{PROMEDIO}", round($promedio_trivias[0]->promedio_trivias), $row);
        }
        if ($promedio_trivias[0]->promedio_trivias > 0) {
            $row = str_replace("{PODERES}", "<img src='img/61_rf_badges_5.png' width='20'>", $row);
        } else {
            $row = str_replace("{PODERES}", "", $row);
        }
        $medallas = "";
        for ($k = 1; $k <= $datos_consolidados[0]->medallas; $k++) {
            $medallas .= "<img src='img/rf_medal.png'>";
        }
        //$row = str_replace("{MEDALLAS}",$datos_consolidados[0]->medallas,$row);
        $row = str_replace("{MEDALLAS}", $medallas, $row);
        $row = str_replace("{NOMBRE}", $unico->nombre . " " . $unico->apaterno . " " . $unico->amaterno, $row);
        $row = str_replace("{CARGO}", $unico->cargo, $row);
        $row = str_replace("{FECHA_CUMPLEANOS}", formatearFecha($unico->fecha_nacimiento), $row);
        $row = str_replace("{URL_PERSONA}", VerificaFotoPersonal($unico->rut), $row);
        $row = str_replace("{RUT_ENCODEADO}", Encodear3($unico->rut), $row);
        $row = str_replace("{MALLA}", ($datos_malla[0]->nombre), $row);
        $row = str_replace("{RUT_COL}", ($unico->rut), $row);
        list($total_inscripciones, $total_aprobados, $total_reprobados, $total_en_proceso) = CAPACITACION_DatosGeneralesPorUsuario($unico->rut);
        $estado                           = EntregaEstadoAvanceBarraMalla(EntregaPorcentaje($total_inscripciones, $total_aprobados));
        $listado_colaborador_sub          = TotalUsuariosPorRutJefe($unico->rut);
        $num_reportes_sub                 = count($listado_colaborador_sub);
        $accion                           = Lms_Busca_Acciones_Pendientes($rut, $unico->rut, $id_empresa);
        $preguntaspendientes              = Lms_Busca_Preguntas_Pendientes($rut, $unico->rut, $id_empresa);
        //echo "<pre>";
        //print_r($preguntaspendientes);
        $row                              = str_replace("{ACCION}", ($accion), $row);
        $row                              = str_replace("{PREGUNTAS}", ($preguntaspendientes), $row);
        $avance                           = round(EntregaPorcentaje($total_inscripciones, $total_aprobados));
        //    echo "<br>$avance";
        $acumulador_avance_colaboradores  = $acumulador_avance_colaboradores + EntregaPorcentaje($total_inscripciones, $total_aprobados);
        $PRINCIPAL                        = str_replace("{NUMERO_AVANCE}", round(EntregaPorcentaje($total_inscripciones, $total_aprobados)), $PRINCIPAL);
        $PRINCIPAL                        = str_replace("{COLOR_PROGRESS_BAR}", $estado[0], $PRINCIPAL);
        $row                              = str_replace("{AVANCE_COLABORADOR}", EntregaPorcentaje($total_inscripciones, $total_aprobados), $row);
        //$total_visitas=TotalVisitasDadoRutCaseEmpresaFront($unico->rut, $id_empresa, "home_minvest");
        $row                              = str_replace("{NUM_VISITAS_COLABORADOR}", $total_visitas[0]->total_visitas, $row);
        $acumulador_visitas_colaboradores = $acumulador_visitas_colaboradores + $total_visitas[0]->total_visitas;
        $cuenta_colaborador++;
        $preguntasPendiente       = Lms_Cuenta_Preguntas_Pendientes_data($unico->rut, $id_empresa);
        $num_preguntas_pendientes = $preguntasPendiente[0]->pendientes + $num_preguntas_pendientes;
        //print_r($preguntasPendiente);
        //echo "<br>num_preguntas_pendientes $num_preguntas_pendientes";
        $num_preguntas_realizadas = $preguntasPendiente[0]->realizadas + $num_preguntas_realizadas;
    }
    $accionesPendiente          = Lms_Cuenta_Acciones_Pendientes_data_lider($rut, $id_empresa);
    $num_acciones_pendientes    = $accionesPendiente[0]->pendientes;
    $num_acciones_realizadas    = $accionesPendiente[0]->realizadas;
    //echo "cuentacolaborador $cuenta_colaborador, nun acciones $num_acciones_pendientes, $num_acciones_realizadas";
    //echo "100*$acumulador_avance_colaboradores/$cuenta_colaborador";
    $sum_verde                  = round(100 * $num_acciones_realizadas / $cuenta_colaborador);
    $sum_amarillo               = 0;
    $sum_rojo                   = round(100 * $num_acciones_pendientes / $cuenta_colaborador);
    $sum_avanceequipo           = round($acumulador_avance_colaboradores / $cuenta_colaborador);
    $lms_avance_equipo          = $sum_avanceequipo;
    $lms_graf_acciones_rojo     = $sum_rojo;
    $lms_graf_acciones_amarillo = $sum_amarillo;
    $lms_graf_acciones_verde    = $sum_verde;
    $PRINCIPAL                  = str_replace("{NUM_PERSONAS_MI_EQUIPO}", count($listado_colaboradores), $PRINCIPAL);
    $PRINCIPAL                  = str_replace("{PROMEDIO_EQUIPO}", round($acumulador_avance_colaboradores / count($listado_colaboradores)), $PRINCIPAL);
    $PRINCIPAL                  = str_replace("{NUM_VISITAS_MI_EQUIPO}", $acumulador_visitas_colaboradores, $PRINCIPAL);
    $PRINCIPAL                  = str_replace("{BLOQUE_COLABORADORES}", ($row), $PRINCIPAL);
    $PRINCIPAL                  = str_replace("{LMS_GRAFICO_1COLOR}", file_get_contents("views/mi_equipo_lms/" . $id_empresa . "_barra_1color.html"), $PRINCIPAL);
    $PRINCIPAL                  = str_replace("{LMS_AVANCEEQUIPO}", $lms_avance_equipo, $PRINCIPAL);
    $PRINCIPAL                  = str_replace("{LMS_GRAFICO_3COLORES}", file_get_contents("views/mi_equipo_lms/" . $id_empresa . "_barra_3colores.html"), $PRINCIPAL);
    $PRINCIPAL                  = str_replace("{VALUEVERDE}", $lms_graf_acciones_verde, $PRINCIPAL);
    $PRINCIPAL                  = str_replace("{VALUEAMARILLO}", $lms_graf_acciones_amarillo, $PRINCIPAL);
    $PRINCIPAL                  = str_replace("{VALUEROJO}", $lms_graf_acciones_rojo, $PRINCIPAL);
    $PRINCIPAL                  = str_replace("{LMS_NUM_PENDIENTES}", $num_acciones_pendientes, $PRINCIPAL);
    $PRINCIPAL                  = str_replace("{LMS_NUM_REALIZADOS}", $num_acciones_realizadas, $PRINCIPAL);
    $PRINCIPAL                  = str_replace("{LMS_NUM_PREGUNTAS_PENDIENTES}", $num_preguntas_pendientes, $PRINCIPAL);
    $PRINCIPAL                  = str_replace("{LMS_NUM_PREGUNTAS_REALIZADOS}", $num_preguntas_realizadas, $PRINCIPAL);
    return ($PRINCIPAL);
}
function Lms_Busca_Acciones_PendientesBK($rut, $rut_colaborador, $id_empresa)
{
    $Busca_pendientes = Lms_Busca_Acciones_Pendientes_data($rut, $rut_colaborador, $id_empresa);
    if ($Busca_pendientes[0]->estado === "0") {
        $objeto    = $Busca_pendientes[0]->nombre_objeto;
        $curso     = $Busca_pendientes[0]->nombrecurso;
        $fecha     = $Busca_pendientes[0]->fecha;
        $id_objeto = $Busca_pendientes[0]->id_objeto;
        if ($Busca_pendientes[0]->inscripcion_curso == 1) {
            $accion            = utf8_decode(file_get_contents("views/mi_equipo_lms/" . $id_empresa . "_jefe_boton_inscripcion_pendiente.html"));
            $accion            = str_replace("{RUT_COLABORADOR_ENCODEADO}", Encodear3($rut_colaborador), $accion);
            $accion            = str_replace("{ID_ACCION_PENDIENTE}", $Busca_pendientes[0]->id, $accion);
            $accion            = str_replace("{ID_CURSO_ENCODEADO}", Encodear3($Busca_pendientes[0]->id_curso), $accion);
            $accion            = str_replace("{CODIGO_INSCRIPCION}", Encodear3($Busca_pendientes[0]->codigo_inscripcion), $accion);
            $accion            = str_replace("{FECHA}", ($Busca_pendientes[0]->fecha), $accion);
            $datos_curso       = ListaCursosDisponibleYDatosPorCursoInscripcion($rut_colaborador, $id_empresa, $Busca_pendientes[0]->id_curso, $Busca_pendientes[0]->codigo_inscripcion);
            $accion            = str_replace("{NOMBRE_CURSO}", ($datos_curso[0]->nombre_curso), $accion);
            $accion            = str_replace("{IMAGEN_CURSO}", $datos_curso[0]->imagen_curso, $accion);
            $fecha_inicio      = $datos_curso[0]->fecha_inicio;
            $dia               = date('d', strtotime($datos_curso[0]->fecha_inicio));
            $mes               = date('m', strtotime($datos_curso[0]->fecha_inicio));
            $mestxt            = mes_3letras($mes);
            $num_inscritos     = $datos_curso[0]->Inscritos;
            $num_preinscritos  = $datos_curso[0]->Preinscritos;
            $num_listaespera   = $datos_curso[0]->ListaEspera;
            $cupos_inscritos   = $num_inscritos + $num_preinscritos;
            $cupos_espera      = $num_listaespera;
            $cupos_disponibles = $datos_curso[0]->cupos - $cupos_inscritos;
            if ($cupos_disponibles <= 0) {
                $cupos_disponibles = 0;
            }
            if ($cupos_disponibles > 0) {
                $texto_inscripcion = "Cupos Disponibles";
                $link_icono        = '<i class="fas fa-check-square"></i>';
                $label             = "label-success";
                $boton_llamada     = "btn btn-success";
                $texto_llamada     = "Postular";
            }
            if ($cupos_disponibles <= 0) {
                $texto_inscripcion = "No hay Cupos, S?lo lista Espera";
                $link_icono        = '<i class="icon-calendar-empty"></i>';
                $label             = "label-warning";
                $boton_llamada     = "btn btn-warning";
                $texto_llamada     = "Dejarme en Lista de Espera";
            }
            $accion = str_replace("{ID}", $datos_curso[0]->id, $accion);
            $accion = str_replace("{DIA}", $dia, $accion);
            $accion = str_replace("{MES}", $mestxt, $accion);
            $accion = str_replace("{CUPOS}", $ListaCurso->cupos, $accion);
            $accion = str_replace("{HORARIO}", $datos_curso[0]->comentarios, $accion);
            $accion = str_replace("{CUPOSINSCRIPCIONES}", $cupos_inscritos, $accion);
            $accion = str_replace("{CUPOSDISPONIBLES}", $cupos_disponibles, $accion);
            $accion = str_replace("{LABEL_INSCRIPCION}", $label, $accion);
            $accion = str_replace("{TEXTO_INSCRIPCION}", $texto_inscripcion, $accion);
            $accion = str_replace("{LINK_INSCRIPCION}", $cupos_inscritos, $accion);
            $accion = str_replace("{LINK_ICONO}", $link_icono, $accion);
            $accion = str_replace("{LINK_LLAMADA}", $texto_llamada, $accion);
            $accion = str_replace("{LINK_MODAL_CURSO}", $cupos_inscritos, $accion);
            $accion = str_replace("{BOTON_LLAMADA}", $boton_llamada, $accion);
            $accion = str_replace("{HORAINICIO}", $datos_curso[0]->horainicio, $accion);
            $accion = str_replace("{HORATERMINADA}", $datos_curso[0]->horatermino, $accion);
            $accion = str_replace("{DIRECCION}", $datos_curso[0]->direccion, $accion);
            $accion = str_replace("{DESCRIPCION}", ($datos_curso[0]->descripcion), $accion);
            $accion = str_replace("{DESCRIPTOR}", ($datos_curso[0]->descriptor), $accion);
            $accion = str_replace("{ACERCADE}", ($datos_curso[0]->acercade), $accion);
            $accion = str_replace("{OBJETIVO_CURSO}", ($datos_curso[0]->objetivo_curso), $accion);
        } else {
            $accion = "
                        <div class='col1'>
                                <div class='cont'>
                                    <div class='cont-col1'>
                                        <div class='label label-sm label-danger'>
                                            <i class='fa fa-bolt'></i>
                                        </div>
                                    </div>
                                    <div class='cont-col2'>
                                        <div class='desc'> $objeto<br>$curso
                                       <a href='?sw=contenido&i=" . Encodear3($id_objeto) . "&rc=" . Encodear3($rut_colaborador) . "&checkin=1'> <span class='btn btn-info'> Realizar Tarea1
                                                <i class='fa fa-share'></i>
                                            </span>
                                            </a>
                                        </div>
                                    </div>
                                </div>
                        </div>
                            <div class='col2'>
                                <div class='date'> $fecha </div>
                            </div>
        ";
        }
    } else {
        $accion == "";
    }
    return $accion;
}
function Lms_Busca_Acciones_Pendientes($rut, $rut_colaborador, $id_empresa)
{
    //$Busca_pendientes=Lms_Busca_Acciones_Pendientes_data($rut, $rut_colaborador, $id_empresa);
    $Busca_pendientes = Lms_Busca_Acciones_Pendientes_dataVistaAgente($rut, $rut_colaborador, $id_empresa);
    //if($Busca_pendientes[0]->estado==="0")    {
    if ($Busca_pendientes[0]->estado === "1") {
        $objeto    = $Busca_pendientes[0]->nombre_objeto;
        $curso     = $Busca_pendientes[0]->nombrecurso;
        $fecha     = $Busca_pendientes[0]->fecha;
        $id_objeto = $Busca_pendientes[0]->id_objeto;
        if ($Busca_pendientes[0]->inscripcion_curso == 1) {
            $accion            = utf8_decode(file_get_contents("views/mi_equipo_lms/" . $id_empresa . "_jefe_boton_inscripcion_pendiente.html"));
            $accion            = str_replace("{RUT_COLABORADOR_ENCODEADO}", Encodear3($rut_colaborador), $accion);
            $accion            = str_replace("{ID_ACCION_PENDIENTE}", $Busca_pendientes[0]->id, $accion);
            $accion            = str_replace("{ID_CURSO_ENCODEADO}", Encodear3($Busca_pendientes[0]->id_curso), $accion);
            $accion            = str_replace("{CODIGO_INSCRIPCION}", Encodear3($Busca_pendientes[0]->codigo_inscripcion), $accion);
            $accion            = str_replace("{FECHA}", ($Busca_pendientes[0]->fecha), $accion);
            $datos_curso       = ListaCursosDisponibleYDatosPorCursoInscripcion($rut_colaborador, $id_empresa, $Busca_pendientes[0]->id_curso, $Busca_pendientes[0]->codigo_inscripcion);
            $accion            = str_replace("{NOMBRE_CURSO}", ($datos_curso[0]->nombre_curso), $accion);
            $accion            = str_replace("{IMAGEN_CURSO}", $datos_curso[0]->imagen_curso, $accion);
            $fecha_inicio      = $datos_curso[0]->fecha_inicio;
            $dia               = date('d', strtotime($datos_curso[0]->fecha_inicio));
            $mes               = date('m', strtotime($datos_curso[0]->fecha_inicio));
            $mestxt            = mes_3letras($mes);
            $num_inscritos     = $datos_curso[0]->Inscritos;
            $num_preinscritos  = $datos_curso[0]->Preinscritos;
            $num_listaespera   = $datos_curso[0]->ListaEspera;
            $cupos_inscritos   = $num_inscritos + $num_preinscritos;
            $cupos_espera      = $num_listaespera;
            $cupos_disponibles = $datos_curso[0]->cupos - $cupos_inscritos;
            if ($cupos_disponibles <= 0) {
                $cupos_disponibles = 0;
            }
            if ($cupos_disponibles > 0) {
                $texto_inscripcion = "Cupos Disponibles";
                $link_icono        = '<i class="fas fa-check-square"></i>';
                $label             = "label-success";
                $boton_llamada     = "btn btn-success";
                $texto_llamada     = "Postular";
            }
            if ($cupos_disponibles <= 0) {
                $texto_inscripcion = "No hay Cupos, S?lo lista Espera";
                $link_icono        = '<i class="icon-calendar-empty"></i>';
                $label             = "label-warning";
                $boton_llamada     = "btn btn-warning";
                $texto_llamada     = "Dejarme en Lista de Espera";
            }
            $accion = str_replace("{ID}", $datos_curso[0]->id, $accion);
            $accion = str_replace("{DIA}", $dia, $accion);
            $accion = str_replace("{MES}", $mestxt, $accion);
            $accion = str_replace("{CUPOS}", $ListaCurso->cupos, $accion);
            $accion = str_replace("{HORARIO}", $datos_curso[0]->comentarios, $accion);
            $accion = str_replace("{CUPOSINSCRIPCIONES}", $cupos_inscritos, $accion);
            $accion = str_replace("{CUPOSDISPONIBLES}", $cupos_disponibles, $accion);
            $accion = str_replace("{LABEL_INSCRIPCION}", $label, $accion);
            $accion = str_replace("{TEXTO_INSCRIPCION}", $texto_inscripcion, $accion);
            $accion = str_replace("{LINK_INSCRIPCION}", $cupos_inscritos, $accion);
            $accion = str_replace("{LINK_ICONO}", $link_icono, $accion);
            $accion = str_replace("{LINK_LLAMADA}", $texto_llamada, $accion);
            $accion = str_replace("{LINK_MODAL_CURSO}", $cupos_inscritos, $accion);
            $accion = str_replace("{BOTON_LLAMADA}", $boton_llamada, $accion);
            $accion = str_replace("{HORAINICIO}", $datos_curso[0]->horainicio, $accion);
            $accion = str_replace("{HORATERMINADA}", $datos_curso[0]->horatermino, $accion);
            $accion = str_replace("{DIRECCION}", $datos_curso[0]->direccion, $accion);
            $accion = str_replace("{DESCRIPCION}", ($datos_curso[0]->descripcion), $accion);
            $accion = str_replace("{DESCRIPTOR}", ($datos_curso[0]->descriptor), $accion);
            $accion = str_replace("{ACERCADE}", ($datos_curso[0]->acercade), $accion);
            $accion = str_replace("{OBJETIVO_CURSO}", ($datos_curso[0]->objetivo_curso), $accion);
        } else {
            $accionBK1           = "
                        <div class='col1'>
                                <div class='cont'>
                                    <div class='cont-col1'>
                                        <div class='label label-sm label-danger'>
                                            <i class='fa fa-bolt'></i>
                                        </div>
                                    </div>
                                    <div class='cont-col2'>
                                        <div class='desc'> $objeto<br>$curso
                                       <a href='?sw=contenido&i=" . Encodear3($id_objeto) . "&rc=" . Encodear3($rut_colaborador) . "&checkin=1'> <span class='btn btn-info'> Ver Desafios
                                                <i class='fa fa-share'></i>
                                            </span>
                                            </a>
                                        </div>
                                    </div>
                                </div>
                        </div>
                            <div class='col2'>
                                <div class='date'> $fecha </div>
                            </div>
        ";
            $accionBK2           = "
                        <div class='col1'>
                                <div class='cont'>
                                    <div class='cont-col1'>
                                        <div class='label label-sm label-danger'>
                                            <i class='fa fa-bolt'></i>
                                        </div>
                                    </div>
                                    <div class='cont-col2'>
                                        <div class='desc'> $objeto<br>$curso
                                       <a href='?sw=malla_resumen&i=" . Encodear3($id_objeto) . "&rutenc=" . Encodear3($rut_colaborador) . "&checkin=1'> <span class='btn btn-info'> Ver Desafios
                                                <i class='fa fa-share'></i>
                                            </span>
                                            </a>
                                        </div>
                                    </div>
                                </div>
                        </div>
                            <div class='col2'>
                                <div class='date'> $fecha </div>
                            </div>
        ";
            $accion              = file_get_contents("views/mi_equipo_lms/" . $id_empresa . "_boton_ver_desafios.html");
            $desafios_pendientes = utf8_decode(ColocaNotificacionesBannerJefe($rut, $id_empresa, $rut_colaborador));
            if ($desafios_pendientes) {
                $accion = str_replace("{BLOQUE_CANTIDAD_DESAFIOS_PENDIENTES}", file_get_contents("views/home/index_bci_capacitacionbci20_entorno_alertas.html"), $accion);
                $accion = str_replace("{BLOQUE_BANNER_NOTIFICACIONES}", "", $accion);
                $accion = str_replace("{BLOQUE_BANNER_NOTIFICACIONES_JEFE}", $desafios_pendientes, $accion);
            } else {
                $accion = str_replace("{BLOQUE_CANTIDAD_DESAFIOS_PENDIENTES}", "", $accion);
            }
            $accion = str_replace("{ID_OBJETO_ENCODEADO}", Encodear3($id_objeto), $accion);
            $accion = str_replace("{FECHA_}", $fecha, $accion);
            $accion = str_replace("{RUT_COLABORADOR_ENCODADO}", Encodear3($rut_colaborador), $accion);
        }
    } else {
        $accion == "";
    }
    return $accion;
}
function Lms_Busca_Preguntas_Pendientes($rut, $rut_colaborador, $id_empresa)
{
    $Busca_pendientes_pregunta = Lms_Busca_Preguntas_Pendientes_data($rut, $rut_colaborador, $id_empresa);
    if ($Busca_pendientes_pregunta[0]->estado === "0") {
        $pregunta = $Busca_pendientes[0]->mensaje;
        $id       = $Busca_pendientes[0]->id;
        $accion   = "
                        <div class='col1'>
                                <div class='cont'>
                                    <div class='cont-col1'>
                                        <div class='label label-sm label-danger'>
                                            <i class='fa fa-bolt'></i>
                                        </div>
                                    </div>
                                    <div class='cont-col2'>
                                        <div class='desc'> $objeto<br>$curso
                                       <a href='?sw=home_mensajeria&i=" . Encodear3($id_objeto) . "&rc=" . Encodear3($rut_colaborador) . "&checkin=1&jefe=1&ragente=" . Encodear3($rut) . "'> <span class='btn btn-info'> Responder Pregunta
                                                <i class='fa fa-share'></i>
                                            </span>
                                            </a>
                                        </div>
                                    </div>
                                </div>
                        </div>
                            <div class='col2'>
                                <div class='date'> $fecha </div>
                            </div>
        ";
        $accion   = file_get_contents("views/mi_equipo_lms/" . $id_empresa . "_boton_ver_preguntas.html");
        $accion   = str_replace("{ID_OBJETO_ENCODEADO}", Encodear3($id_objeto), $accion);
        $accion   = str_replace("{RUT_COLABORADOR_ENCODEADO}", Encodear3($rut_colaborador), $accion);
        $accion   = str_replace("{RUT_AGENTE_ENCODEADO}", Encodear3($rut), $accion);
        $accion   = str_replace("{FECHA_}", ($fecha), $accion);
    } else {
        $accion == "";
    }
    return $accion;
}
function Lms_Busca_Preguntas_PendientesBK($rut, $rut_colaborador, $id_empresa)
{
    $Busca_pendientes_pregunta = Lms_Busca_Preguntas_Pendientes_data($rut, $rut_colaborador, $id_empresa);
    if ($Busca_pendientes_pregunta[0]->estado === "0") {
        $pregunta = $Busca_pendientes[0]->mensaje;
        $id       = $Busca_pendientes[0]->id;
        $accion   = "
                        <div class='col1'>
                                <div class='cont'>
                                    <div class='cont-col1'>
                                        <div class='label label-sm label-danger'>
                                            <i class='fa fa-bolt'></i>
                                        </div>
                                    </div>
                                    <div class='cont-col2'>
                                        <div class='desc'> $objeto<br>$curso
                                       <a href='?sw=home_mensajeria&i=" . Encodear3($id_objeto) . "&rc=" . Encodear3($rut_colaborador) . "&checkin=1&jefe=1&ragente=" . Encodear3($rut) . "'> <span class='btn btn-info'> Responder Pregunta
                                                <i class='fa fa-share'></i>
                                            </span>
                                            </a>
                                        </div>
                                    </div>
                                </div>
                        </div>
                            <div class='col2'>
                                <div class='date'> $fecha </div>
                            </div>
        ";
    } else {
        $accion == "";
    }
    return $accion;
}
function conectaBaseMinvest()
{
    $serverName     = "AGRRHH"; //serverName\instanceName
    $connectionInfo = array(
        "Database" => "Intranet",
        "UID" => "usr_intranet",
        "PWD" => "1ntr4n3t.2016"
    );
    $conn           = sqlsrv_connect($serverName, $connectionInfo);
    if ($conn) {
        echo "Conexi?n establecida.<br />";
    } else {
        echo "Conexi?n no se pudo establecer.<br />";
        die(print_r(sqlsrv_errors(), true));
    }
}
function ColocaIndicadoresVarios($PRINCIPAL)
{
    //$xmlSource = "http://indicadoresdeldia.cl/webservice/indicadores.xml";
    //$xml = simplexml_load_file($xmlSource);
    /*
    echo $xml->santoral->ayer;
    echo $xml->santoral->hoy;
    echo $xml->santoral->maniana;
    echo $xml->moneda->dolar;
    echo $xml->moneda->euro;
    echo $xml->moneda->dolar_clp; //Dolar interbancario
    echo $xml->indicador->ivp;
    echo $xml->indicador->uf;
    echo $xml->indicador->ipc;
    echo $xml->indicador->utm;
    echo $xml->indicador->imacec;
    echo $xml->bolsa->ipsa;
    echo $xml->bolsa->igpa;
    echo $xml->bolsa->banca;
    echo $xml->bolsa->commodities;
    echo $xml->bolsa->retail;
    echo $xml->bolsa->consumo;
    echo $xml->bolsa->utilities;
    */
    //Traigo los indicadores del dia
    $indicadores_del_dia = TraeIndicadoresDelDia();
    $PRINCIPAL           = str_replace("{VALOR_UF}", $indicadores_del_dia[0]->uf, $PRINCIPAL);
    $PRINCIPAL           = str_replace("{VALOR_DOLAR}", $indicadores_del_dia[0]->dolar, $PRINCIPAL);
    $PRINCIPAL           = str_replace("{VALOR_UTM}", $indicadores_del_dia[0]->utm, $PRINCIPAL);
    $PRINCIPAL           = str_replace("{VALOR_IVP}", $indicadores_del_dia[0]->ivp, $PRINCIPAL);
    $PRINCIPAL           = str_replace("{VALOR_IPC}", $indicadores_del_dia[0]->ipc, $PRINCIPAL);
    $PRINCIPAL           = str_replace("{SANTORAL_DIA}", $indicadores_del_dia[0]->santoral_hoy, $PRINCIPAL);
    return ($PRINCIPAL);
}
function ListadoColaboradoresObjetivos($html, $evaluador, $rut_evaluado, $id_bitacora, $sgd_version, $id_proceso)
{
    $evaluados                     = TraeRelacionesSinAe($evaluador, $id_proceso);
    $total_html                    = file_get_contents("views/sgd/bitacora/entorno_bloque_principal_chilquinta.html");
    $row_template                  = file_get_contents("views/sgd/listado_colaboradores/row_colaboradores_objetivo.html");
    $row                           = "";
    $ok_finalizado                 = 0;
    $html                          = str_replace("{SECCION_EQUIPO_CONSOLIDADO}", file_get_contents("views/sgd/bitacora/vista_consolidada_equipo.html"), $html);
    $html                          = str_replace("{GRAFICO}", file_get_contents("views/sgd/graficos/graficoBarraBitacora.html"), $html);
    $total_positivas_por_evaluador = 0;
    $total_negativas_por_evaluador = 0;
    foreach ($evaluados as $evaluado) {
        $row .= $row_template;
        $objetivos_validados_por_validador = VerificaSiObjetivosEstanValidados($evaluado->evaluado);
        //$row=FormularioIngresaObjetivos($row, $evaluado->evaluado, $evaluador);
        $row                               = ColocaDatosUsuario($row, $evaluado->evaluado, "bitacora");
        $row                               = str_replace("{BOTON_BITACORA}", file_get_contents("views/sgd/listado_colaboradores/boton_ingresa_objetivos.html"), $row);
        //$valores_objetivos=ListadoObjetivosAValidar($evaluado->evaluado, $evaluador, $id_objetivo, "jefe");
        $valores_objetivos                 = ListadoIngresoBitacoras($evaluado->evaluado, $evaluador, $id_bitacora, "jefe");
        $row                               = str_replace("{LISTADO_OBJETIVOS_A_EVALUAR}", $valores_objetivos, $row);
        $row                               = str_replace("{ID_PROCESO_ENCODEADO}", Encodear3($id_proceso), $row);
        $ponderaciones_bases               = DevuelvePonderacionesPorEvaluado($evaluado->evaluado);
        $verifica_evaluado_validado        = VerificaSiObjetivosEstanAjustados($evaluado->evaluado);
        if ($rut_evaluado == $evaluado->evaluado) {
            $row = str_replace("{FORMULARIO_INGRESO}", file_get_contents("views/sgd/objetivos/formulario.html"), $row);
            $row = str_replace("{OPTIONS_VALORES}", OptionsGenericoNombreDadoValoresPorEmpresa("tbl_bitacora_valores", "", "valor", "id", "order by valor asc", $_SESSION["id_empresa"]), $row);
        } else {
            $row = str_replace("{FORMULARIO_INGRESO}", "", $row);
        }
        $row                           = str_replace("{RUT_ENCODEADO}", Encodear3($evaluado->evaluado), $row);
        $row                           = str_replace("{RUT_EVALUADO}", ($evaluado->evaluado), $row);
        //Veo cuantas posotivas y cuantas negativas tiene
        $positivas                     = VerificaBitacorasPositivasNegativas($evaluado->evaluado, "si");
        $negativas                     = VerificaBitacorasPositivasNegativas($evaluado->evaluado, "no");
        $row                           = str_replace("{X_POSITIVAS}", count($positivas), $row);
        $row                           = str_replace("{X_NEGATIVAS}", count($negativas), $row);
        $total_positivas_por_evaluador = $total_positivas_por_evaluador + count($positivas);
        $total_negativas_por_evaluador = $total_negativas_por_evaluador + count($negativas);
        $row                           = str_replace("{CANTIDAD}", count($positivas) + count($negativas), $row);
        $row                           = str_replace("{BOTON_JEFE_VALIDA_OBJETIVOS}", "", $row);
        $row                           = str_replace("{TOTAL_SUMA_PONDERACION}", $valores_objetivos[1], $row);
        $row                           = str_replace("{PONDERACION_OBJETIVOS_INDIVIDUALES}", $ponderaciones_bases[2], $row);
        if ($valores_objetivos[1] == $ponderaciones_bases[2]) {
            $row = str_replace("{OK}", "OK", $row);
        } else {
            $row = str_replace("{OK}", "", $row);
        }
        $row = str_replace("{RUT_EVALUADO_ENCODEADO}", Encodear3($evaluado->evaluado), $row);
        if ($valores_objetivos[1] == $ponderaciones_bases[2]) {
            $ok_finalizado++;
        }
        //ACA veo si es que tiene comentarios de rechazo
        $comentarios           = ObtenerObjetivosDeRechazoUltimo($evaluado->evaluado);
        $comentarios_validador = "";
        foreach ($comentarios as $com) {
            $comentarios_validador .= $com->comentario . "<br>";
        }
        $row = str_replace("{COMENTARIOS_VALIDADOR}", $comentarios_validador, $row);
    }
    $total_total = ($total_negativas_por_evaluador + $total_positivas_por_evaluador);
    $html        = str_replace("{TOTAL_POSITIVAS}", ColocaDecimalesNotasFinales(0, ($total_positivas_por_evaluador * 100) / $total_total), $html);
    $html        = str_replace("{TOTAL_NEGATIVAS}", ColocaDecimalesNotasFinales(0, ($total_negativas_por_evaluador * 100) / $total_total), $html);
    $html        = str_replace("{TOTAL_POR_EVALUADOR}", $total_total, $html);
    $html        = str_replace("{TOTAL_EVALUADOR_POSITIVAS}", ($total_positivas_por_evaluador), $html);
    $html        = str_replace("{TOTAL_EVALUADOR_NEGATIVAS}", ($total_negativas_por_evaluador), $html);
    $total_html  = str_replace("{LISTADO_COLABORADORES}", ($row), $total_html);
    $html        = str_replace("{ENTORNO_LISTADO_EVALUACION}", ($total_html), $html);
    return ($html);
}
function EntregaEstadoAvanceBarraMalla($valor)
{
    if ($valor < 50) {
        $arreglo[0] = "etiquetaPrograma-reprobado";
    } else if ($valor < 75) {
        $arreglo[0] = "etiquetaPrograma-proceso";
    } else if ($valor >= 75) {
        $arreglo[0] = "etiquetaPrograma-aprobado";
    }
    return ($arreglo);
}
function EntregaPorcentaje($total, $valor)
{
    return (FormatearPorcentajes(($valor * 100) / $total));
}
function ColocaDatosCampusPuntos($PRINCIPAL, $rut, $id_empresa, $tipo_llamada, $filtro_desde_admin)
{
    //La variable tipo_llamada, se utiliza para cuando se llama desde el administrador
    $puntos = 0;
    //echo "<br><br>2724 ColocaDatosCampusPuntos tipo llamada $tipo_llamada, $filtro_desde_Admin";
    $datos  = GAMIFICACIONTienePuntosAcumuladosPorRutEmpresa($rut, $id_empresa, $filtro_desde_admin);
    //print_r($datos); exit();
    if ($datos[0]->avatar) {
        if ($id_empresa == '59' or $id_empresa == '75' or $id_empresa == '22') {
            $PRINCIPAL = str_replace("{URL_PERSONA}", "" . $datos[0]->avatar, $PRINCIPAL);
        } else {
            $PRINCIPAL = str_replace("{URL_PERSONA}", "img/avatars/$id_empresa/" . $datos[0]->avatar, $PRINCIPAL);
        }
    } else {
        $PRINCIPAL = str_replace("{URL_PERSONA}", VerificaFotoPersonal($rut), $PRINCIPAL);
    }
    for ($tot = 1; $tot <= $datos[0]->medallas; $tot++) {
        //$html_medallas.="<img src='img/".$datos[0]->imagenmedalla."'>";
        $imagen_medalla = $datos[0]->imagenmedalla;
        if ($imagen_medalla == "") {
            $imagen_medalla_array = buscaimagenmedallamalla($rut, $id_empresa);
            $imagen_medalla       = $imagen_medalla_array[0]->imagenmedallamalla;
            $html_medallas .= "<img src='img/$imagen_medalla' width='24' height='24'>";
        } else {
            $html_medallas .= "<img src='img/$imagen_medalla'  width='24' height='24'>";
        }
    }
    $PRINCIPAL = str_replace("{IMAGENMEDALLAS}", $html_medallas, $PRINCIPAL);
    if ($datos[0]->puntosconsolidados === 0 or $datos[0]->puntosconsolidados > 0) {
        $puntos = $datos[0]->puntosconsolidados;
    }
    if ($puntos === 0 and $datos[0]->puntos > 0) {
        $puntos = $datos[0]->puntos;
    }
    //$PRINCIPAL = str_replace("{PUNTOS}",$datos[0]->puntos,$PRINCIPAL);
    //$PRINCIPAL = str_replace("{PUNTOS}",$datos[0]->puntosconsolidados,$PRINCIPAL);
    $PRINCIPAL     = str_replace("{PUNTOS}", $puntos, $PRINCIPAL);
    $PRINCIPAL     = str_replace("{NUMNIVEL}", $datos[0]->numnivel, $PRINCIPAL);
    $PRINCIPAL     = str_replace("{NOMBRENIVELPERSONA}", $datos[0]->descripcion_nivel, $PRINCIPAL);
    $PRINCIPAL     = str_replace("{DESCRIPCIONNIVEL}", ($datos[0]->texto_descripcion_nivel), $PRINCIPAL);
    $PRINCIPAL     = str_replace("{TEXTOACCION}", ($datos[0]->textoaccion), $PRINCIPAL);
    $PRINCIPAL     = str_replace("{IMAGENNIVEL}", ($datos[0]->imagenmiperfil), $PRINCIPAL);
    $PRINCIPAL     = str_replace("{RANKING}", "-", $PRINCIPAL);
    $PRINCIPAL     = str_replace("{MEDALLAS}", $datos[0]->medallas, $PRINCIPAL);
    $PRINCIPAL     = str_replace("{CAMPO1}", ($datos[0]->campo1), $PRINCIPAL);
    $PRINCIPAL     = str_replace("{CAMPO2}", $datos[0]->campo2, $PRINCIPAL);
    $PRINCIPAL     = str_replace("{CAMPO3}", $datos[0]->campo3, $PRINCIPAL);
    $PRINCIPAL     = str_replace("{CAMPO4}", $datos[0]->campo4, $PRINCIPAL);
    $PRINCIPAL     = str_replace("{EMAIL}", $datos[0]->email, $PRINCIPAL);
    //echo "rut $rut, c3".$datos[0]->campo3." c4 ".$datos[0]->campo4;
    $PRINCIPAL     = str_replace("{RUT_EVALUADO}", $rut, $PRINCIPAL);
    $PRINCIPAL     = str_replace("{NOMBRE_COMPLETO}", ($datos[0]->nombre_completo), $PRINCIPAL);
    $PRINCIPAL     = str_replace("{RUT_COMPLETO_EVALUADO}", $datos[0]->rut_completo_evaluado, $PRINCIPAL);
    $PRINCIPAL     = str_replace("{PORCENTAJE_BARRA_NIVEL}", $datos[0]->porcentajebarranivel, $PRINCIPAL);
    $PRINCIPAL     = str_replace("{NUMDESAFIOS}", $datos[0]->total_objetos_por_curso_actual - $datos[0]->totalobjetos_finalizados, $PRINCIPAL);
    $PRINCIPAL     = str_replace("{CARGO}", ($datos[0]->cargo_usuario), $PRINCIPAL);
    $total_avatars = GAMIFICACION_AvatarsPorEmpresa($id_empresa);
    $cont_rows     = 0;
    foreach ($total_avatars as $avatar) {
        $cont_rows++;
        $total_avatars_html .= file_get_contents("views/cursos/capacitacion/row_avatar.html");
        $total_avatars_html = str_replace("{NOMBRE_ARCHIVO}", $avatar->nombre_archivo, $total_avatars_html);
        $total_avatars_html = str_replace("{CARPETA_AVATARS}", $id_empresa, $total_avatars_html);
        $total_avatars_html = str_replace("{ID_AVATAR}", $avatar->nombre_archivo, $total_avatars_html);
        $total_avatars_html = str_replace("{ID}", $avatar->id, $total_avatars_html);
        if ($cont_rows == 2) {
            $total_avatars_html .= "<div class='row'></div>";
            $cont_rows = 0;
        } else {
            $cont_rows++;
        }
    }
    $PRINCIPAL    = str_replace("{ID_EMPRESA}", $id_empresa, $PRINCIPAL);
    $PRINCIPAL    = str_replace("{ROWS_AVATARS}", $total_avatars_html, $PRINCIPAL);
    //Aca traigo el listado de los puntos
    $total_puntos = GAMIFICACIONTotalPuntosPorObjetoDadoRutEmpresa($rut, $id_empresa);
    foreach ($total_puntos as $pun) {
        $row_por_puntos .= file_get_contents("views/cursos/capacitacion/" . $id_empresa . "_mi_perfil_row_puntos_por_objeto.html");
        $row_por_puntos = str_replace("{MODULO}", ($pun->titulo), $row_por_puntos);
        $row_por_puntos = str_replace("{TOTAL_PUNTOS}", $pun->puntos, $row_por_puntos);
        $row_por_puntos = str_replace("{FECHA}", formatearFechaSmall($pun->fecha), $row_por_puntos);
        if ($pun->rut_autor_megusta) {
            //$row_por_puntos = str_replace("{MEGUSTA_ROW}","+1 ".$pun->nombre_autor_megusta,$row_por_puntos);
            $row_por_puntos = str_replace("{MEGUSTA_ROW}", "<br>Me Gusta", $row_por_puntos);
        } else {
            $row_por_puntos = str_replace("{MEGUSTA_ROW}", "", $row_por_puntos);
        }
        $imagen_medalla = "";
        $html_medallas  = "";
        for ($tott = 1; $tott <= $pun->medallas; $tott++) {
            //$html_medallas.="<img src='img/".$datos[0]->imagenmedalla."'>";
            $imagen_medalla = $datos[0]->imagenmedalla;
            if ($imagen_medalla == "") {
                //echo "hola";
                $imagen_medalla_array = buscaimagenmedallamalla($rut, $id_empresa);
                $imagen_medalla       = $imagen_medalla_array[0]->imagenmedallamalla;
                $html_medallas .= "<img src='img/$imagen_medalla'>";
            } else {
                $html_medallas .= "<img src='img/$imagen_medalla'>";
            }
        }
        if ($html_medallas) {
            $row_por_puntos = str_replace("{MEDALLA_ROW}", "<br>" . $html_medallas, $row_por_puntos);
        } else {
            $row_por_puntos = str_replace("{MEDALLA_ROW}", "", $row_por_puntos);
        }
    }
    $PRINCIPAL = str_replace("{LISTADO_DETALLE_PUNTOS}", $row_por_puntos, $PRINCIPAL);
    //print_r($datos);exit();
    if ($tipo_llamada == "admin") {
        //Rut Completo Usuario
        $arreglo[0] = $datos[0]->rut_completo_evaluado;
        //Nombre Completo
        $arreglo[1] = ($datos[0]->nombre_completo);
        //CARGO
        $arreglo[2] = ($datos[0]->cargo_usuario);
        //Campo 1
        $arreglo[3] = ($datos[0]->campo1);
        //Campo 2
        $arreglo[4] = ($datos[0]->campo2);
        //Campo 3
        $arreglo[5] = ($datos[0]->campo3);
        //Puntos
        //$arreglo[6]=$datos[0]->puntosconsolidados;
        $arreglo[6] = $puntos;
        //Medallas
        $arreglo[7] = $datos[0]->medallas;
        if ($datos[0]->ingresocurso > 0) {
            $ingreso = 1;
        } else {
            $ingreso = 0;
        }
        $arreglo[8]  = $ingreso;
        $arreglo[9]  = ($datos[0]->email_usuario);
        $arreglo[10] = ($datos[0]->campo4);
        //    print_r($arreglo);
        return ($arreglo);
        //return($PRINCIPAL);
    } else {
        return ($PRINCIPAL);
    }
}


function ColocaDatosMallaCapacitacion($PRINCIPAL, $rut, $id_empresa, $id_clasificacion, $tipo_llamada, $filtro_desde_admin, $opcional, $tipo_reporte_desde_admin, $id_malla)
{


// echo "<br />coloca datos $rut, $id_empresa, $id_clasificacion, $tipo_llamada, $filtro_desde_admin, $opcional, $tipo_reporte_desde_admin, malla $id_malla";
// echo "<br />ColocaDatosMallaCapacitacion<br />";
// La variable, Tipo de Llamada, es para ver si es que es llamada desde
// admin o desde el front
// La variable $filtro_Desde_Admin, es para cuando se ejecuta desde el administrador, y se filtra por curso la queri
// echo "<br />ColocaDatosMallaCapacitacion rut $rut, tipollamada $tipo_llamada, filtro $filtro_desde_admin, opcional $opcional, id_clasificacion $id_clasificacion, id malla $id_malla";
$datos_empresa = DatosEmpresa($id_empresa);
// COMENTADO 22022018
// list($total_inscripciones, $total_aprobados, $total_reprobados, $total_en_proceso) = CAPACITACION_DatosGeneralesPorUsuario($rut, $filtro_desde_admin);
$PRINCIPAL      = str_replace("{BLOQUE_DATOS_PERSONALES}", file_get_contents("views/cursos/capacitacion/" . $id_empresa . "_mi_perfil_bloque_datos.html") , $PRINCIPAL);
$datos_malla    = CAPACITACION_malla_porUsuario($rut, $id_malla, $id_empresa);
//print_r($datos_malla);
// GAMIFICACION_ActualizaNivel($datos_malla[0]->id_malla, $id_empresa, $rut);
$datos_puntos_acumulados = GAMIFICACIONTienePuntosAcumuladosPorRutEmpresa($rut, $id_empresa, $filtro_desde_admin);
$nivel_actual   = $datos_puntos_acumulados[0]->numnivel;
$estado         = EntregaEstadoAvanceBarraMalla(EntregaPorcentaje($total_inscripciones, $total_aprobados));
if (!$tipo_llamada) {
    // $PRINCIPAL=ColocarRankingUsuariosPorPuntos($PRINCIPAL, $id_empresa,$datos_malla[0]->id_malla);
}
// print_r($datos_malla);
// Funcionalidad para Asignar Niveles  a Cursos
if ($tipo_llamada) {
    $datos_usuario_para_admin = ColocaDatosCampusPuntos($PRINCIPAL, $rut, $id_empresa, $tipo_llamada, $filtro_desde_admin);
}
else {
    $PRINCIPAL = ColocaDatosCampusPuntos($PRINCIPAL, $rut, $id_empresa, $tipo_llamada, "");
}
if ($datos_malla) {
    /*if($id_empresa==52){
    }else{
    $PRINCIPAL = str_replace("{BLOQUE_TITULO_MALLA}",file_get_contents("views/cursos/capacitacion/titulo_nombre_malla.html"),$PRINCIPAL);
    }*/
    if ($id_clasificacion) {
        if (file_exists("views/cursos/capacitacion/" . $id_empresa . "_titulo_nombre_malla.html")) {
            $PRINCIPAL = str_replace("{BLOQUE_TITULO_MALLA}", file_get_contents("views/cursos/capacitacion/" . $id_empresa . "_titulo_nombre_malla.html") , $PRINCIPAL);
        }
        else {
            $PRINCIPAL = str_replace("{BLOQUE_TITULO_MALLA}", file_get_contents("views/cursos/capacitacion/titulo_nombre_malla.html") , $PRINCIPAL);
        }
        // $PRINCIPAL = str_replace("{BLOQUE_TITULO_MALLA}",file_get_contents("views/cursos/capacitacion/".$id_empresa."_titulo_nombre_malla.html"),$PRINCIPAL);
    }
    else {
        if (file_exists("views/cursos/capacitacion/" . $id_empresa . "_titulo_nombre_malla_sin_imagen.html")) {
            $PRINCIPAL = str_replace("{BLOQUE_TITULO_MALLA}", file_get_contents("views/cursos/capacitacion/" . $id_empresa . "_titulo_nombre_malla_sin_imagen.html") , $PRINCIPAL);
        }
        else {
            $PRINCIPAL = str_replace("{BLOQUE_TITULO_MALLA}", file_get_contents("views/cursos/capacitacion/titulo_nombre_malla_sin_imagen.html") , $PRINCIPAL);
        }
    }
    if (!$id_clasificacion) {
        $PRINCIPAL = str_replace("{DESCRIPCION_CLASIFICACION}", ($datos_malla[0]->descripcion_malla) , $PRINCIPAL);
    }
    $PRINCIPAL = str_replace("{NOMBRE_MALLA}", ($datos_malla[0]->nombre_malla) , $PRINCIPAL);
    $datos_clasificacion_unica = DatosClasificacionPorCurso($id_clasificacion, $id_empresa);
    $PRINCIPAL = str_replace("{NOMBRE_CLASIFICACION}", ($datos_clasificacion_unica[0]->nombre_clasificacion) , $PRINCIPAL);
    $PRINCIPAL = str_replace("{DESCRIPCION__MALLA}", $datos_malla[0]->descripcion_malla, $PRINCIPAL);
    $PRINCIPAL = str_replace("{BLOQUE_CURSOS_PENDIENTES}", BloqueCursosPendientes(file_get_contents("views/cursos/capacitacion/titulo_cursos_pendientes_malla.html") , $rut, $datos_malla->id_malla) , $PRINCIPAL);
    if (file_exists("views/cursos/capacitacion/" . $id_empresa . "_titulo_avance_malla.html")) {
        $PRINCIPAL = str_replace("{BLOQUE_AVANCE_MALLA}", file_get_contents("views/cursos/capacitacion/" . $id_empresa . "_titulo_avance_malla.html") , $PRINCIPAL);
    }
    else {
        $PRINCIPAL = str_replace("{BLOQUE_AVANCE_MALLA}", file_get_contents("views/cursos/capacitacion/titulo_avance_malla.html") , $PRINCIPAL);
    }
    $PRINCIPAL = OtrosCursosRealizados($PRINCIPAL, $rut, $datos_malla[0]->id_malla);
}
else {
    $PRINCIPAL = str_replace("{BLOQUE_TITULO_MALLA}", "", $PRINCIPAL);
    $PRINCIPAL = str_replace("{BLOQUE_CURSOS_PENDIENTES}", "", $PRINCIPAL);
    $PRINCIPAL = str_replace("{BLOQUE_AVANCE_MALLA}", "", $PRINCIPAL);
    // $PRINCIPAL = str_replace("{BLOQUE_OTROS_CURSOS_REALIZADOS}",file_get_contents("views/cursos/capacitacion/titulo_otros_cursos_realizados_malla.html"),$PRINCIPAL);
    $PRINCIPAL = OtrosCursosRealizados($PRINCIPAL, $rut, $datos_malla[0]->id_malla);
}
$porcentaje_avance_por_usuario = 0;
$PRINCIPAL = str_replace("{NUMERO_AVANCE}", round(EntregaPorcentaje($total_inscripciones, $total_aprobados)) , $PRINCIPAL);
$porcentaje_avance_por_usuario = $datos_puntos_acumulados[0]->avanceobjetos;
// echo "<br />108091 $porcentaje_avance_por_usuario";
// si no tiene avance por objetos ve si hay avance por curso
if ($porcentaje_avance_por_usuario == 0) {
    $porcentaje_avance_por_usuario = 100 * $datos_puntos_acumulados[0]->avancecurso;
}
// echo "<br />hol";
// echo "<br />108092 $porcentaje_avance_por_usuario";
// echo "<br /><br />";
//    print_r($datos_puntos_acumulados);
// echo "<br /><br />";
$PRINCIPAL = str_replace("{COLOR_PROGRESS_BAR}", $estado[0], $PRINCIPAL);
$PRINCIPAL = str_replace("{TOTAL_APROBADOS}", $total_aprobados, $PRINCIPAL);
$PRINCIPAL = str_replace("{TOTAL_REPROBADOS}", $total_reprobados, $PRINCIPAL);
$PRINCIPAL = str_replace("{TOTAL_EN_PROCESO}", $total_en_proceso, $PRINCIPAL);
$PRINCIPAL = str_replace("{TOTAL_NO_INICIADOS}", $total_inscripciones - ($total_aprobados + $total_reprobados + $total_en_proceso) , $PRINCIPAL);
// TRaigo la malla del usuario
$codigo_malla = $datos_malla[0]->id_malla;
// echo "<br />codigo_malla $codigo_malla";
// Con el id malla, traigo las clasificaciones
// $clasificaciones=CAPACITACION_clasificacionesPorMallaRut($rut, $codigo_malla);
// Voy a  pasar el id de clasificacion, esto es para cuando se quiere mostrar solo los cursos de una clasificacion.
// echo "<br />opcional $opcional";
if ($tipo_reporte_desde_admin <> "detallado") {
    if ($opcional == 1) {
        // echo "1.1";
        // exit;
        $clasificaciones = CAPACITACION_clasificacionesPorMallaClasificacionOpcional($codigo_malla, $id_empresa, $id_clasificacion);
    }
    else {
       // echo "1.2"; ;
        $clasificaciones = CAPACITACION_clasificacionesPorMalla($codigo_malla, $id_empresa, $id_clasificacion);
    }
    if (count($clasificaciones) == 0) {
       // echo "1.3";
        $clasificaciones = CAPACITACION_clasificacionesPorInscripcionUsuario($rut, $id_clasificacion);
    }
}
if ($tipo_reporte_desde_admin <> "detallado") {
    $total_clasificaciones = "";
    $i = 0;
    $numero_cursos_total = 0;
    $PRINCIPAL = str_replace("{NUM_CLASIFICACIONES}", count($clasificaciones) , $PRINCIPAL);
    $clasificaciones_entorno = file_get_contents("views/cursos/capacitacion/" . $id_empresa . "_row_programas_capacitacion.html");
    $curso_entorno = file_get_contents("views/cursos/capacitacion/" . $id_empresa . "_row_cursos_por_programas_capacitacion.html");
    $classrow = 3;
    $avance_clasificaciones_entorno = file_get_contents("views/cursos/capacitacion/" . $id_empresa . "_row_avance_clasificacion.html");
    if (count($clasificaciones) == 1) {
        if ($datos_malla[0]->template_malla) {
            $template_malla = "_" . $datos_malla[0]->template_malla;
        }
        else {
            $template_malla = "";
        }
        $clasificaciones_entorno = file_get_contents("views/cursos/capacitacion/" . $id_empresa . "_row_programas_capacitacion_unico" . $template_malla . ".html");
        $curso_entorno = file_get_contents("views/cursos/capacitacion/" . $id_empresa . "_row_cursos_por_programas_capacitacion_unico" . $template_malla . ".html");
        $PRINCIPAL = str_replace("{DESCRIPCION_CLASIFICACION}", ($clasificaciones[0]->descripcion_clasificacion) , $PRINCIPAL);
        $PRINCIPAL = str_replace("{IMAGEN_CLASIFICACION}", ($clasificaciones[0]->imagen) , $PRINCIPAL);
        $PRINCIPAL = str_replace("{COLOR_CLASIFICACION}", ($clasificaciones[0]->color) , $PRINCIPAL);
    }
    if ($id_clasificacion) {
        // echo "<br />pilates";
        // echo "<br />template  $template_malla";
        $clasificaciones_entorno = file_get_contents("views/cursos/capacitacion/" . $id_empresa . "_row_programas_capacitacion_unico" . $template_malla . ".html");
        $curso_entorno = file_get_contents("views/cursos/capacitacion/" . $id_empresa . "_row_cursos_por_programas_capacitacion_unico" . $template_malla . ".html");
        $avance_clasificaciones_entorno = file_get_contents("views/cursos/capacitacion/" . $id_empresa . "_row_avance_clasificacion.html");
    }
}
if ($tipo_reporte_desde_admin <> "detallado") {
    $con_row = 1;
    $contador_arreglo_clasificaciones = 0;
    // print_r($clasificaciones);
    foreach($clasificaciones as $cla) {
        // echo "<br />cla pilta";
        // $html_cla=file_get_contents("views/cursos/row_programas_capacitacion.html");
        $html_cla = $clasificaciones_entorno;
        $avance_cla = $avance_clasificaciones_entorno;
        // $html_cla = str_replace("{ID_CLASIFICACION}",$cla->clasificacion,$html_cla);
        // print_r($cla);
        if ($cla->inactivo == 1) {
            $html_cla = str_replace("{LINK}", "", $html_cla);
            $html_cla = str_replace("{CLASSIMGBCK}", "img_bn_grasycale", $html_cla);
        }
        else {
            $html_cla = str_replace("{LINK}", "<a href='?sw=CurXClas&icl={ID_CLASIFICACION_ENCODEADO}'>", $html_cla);
            $html_cla = str_replace("{CLASSIMGBCK}", "", $html_cla);
        }
        $html_cla = str_replace("{LINK}", $cla->id_clasificacion, $html_cla);
        $html_cla = str_replace("{CLASSIMGBCK}", $cla->id_clasificacion, $html_cla);
        $html_cla = str_replace("{ID_CLASIFICACION}", $cla->id_clasificacion, $html_cla);
        $html_cla = str_replace("{ID_CLASIFICACION_ENCODEADO}", Encodear3($cla->id_clasificacion) , $html_cla);
        $avance_cla = str_replace("{ID_CLASIFICACION}", $cla->id_clasificacion, $avance_cla);
        $avance_cla = str_replace("{ID_CLASIFICACION_ENCODEADO}", Encodear3($cla->id_clasificacion) , $avance_cla);
        $html_cla = str_replace("{NOMBRE_CLASIFICACION}", $cla->nombre_clasificacion, $html_cla);
        $html_cla = str_replace("{DESCRIPCION_CLASIFICACION}", $cla->descripcion_clasificacion, $html_cla);
        $html_cla = str_replace("{IMAGEN_NIVEL_CLASIFICACION}", $cla->imagennivel, $html_cla);
        $html_cla = str_replace("{TEXTO_NIVEL_CLASIFICACION}", $cla->textonivel, $html_cla);
        $html_cla = str_replace("{DESCRIPCION_NIVEL_CLASIFICACION}", $cla->descripcionnivel, $html_cla);
        $html_cla = str_replace("{COLOR2}", $cla->color2, $html_cla);
        $html_cla = str_replace("{COLOR}", $cla->color, $html_cla);
        $html_cla = str_replace("{IMAGEN_BACK}", $cla->imagen_back, $html_cla);
        $html_cla = str_replace("{IMAGEN}", $cla->imagen, $html_cla);
        // Por cada clasificacion, traigo los cursos
        // $cursos_por_clasificacion=CAPACITACION_cursosPorClasificacion($rut, $codigo_malla, $cla->id_clasificacion);
        // $cursos_por_clasificacion_desde_malla=CAPACITACION_cursosPorClasificacionMalla($codigo_malla, $cla->clasificacion, $filtro_desde_admin);
        $cursos_por_clasificacion_desde_malla = CAPACITACION_cursosPorClasificacionMalla($codigo_malla, $cla->id_clasificacion, $filtro_desde_admin);
        // $avance_cursos_por_clasificacion_desde_malla=CAPACITACION_cursosPorClasificacionMalla($codigo_malla, $cla->id_clasificacion, $filtro_desde_admin);
        // echo "<br />".count($cursos_por_clasificacion_desde_malla);
        if (count($cursos_por_clasificacion_desde_malla) == 0) {
            $cursos_por_clasificacion_desde_malla = CAPACITACION_cursosPorClasificacionRut($rut, $cla->id_clasificacion);
        }
        // echo "<br />".count($cursos_por_clasificacion_desde_malla);
        // exit();
        // print_R($cursos_por_clasificacion_desde_malla);
        // echo "aca";
        $html_cla = str_replace("{CANTIDAD_CURSOS}", count($cursos_por_clasificacion) , $html_cla);
        $html_cla = str_replace("{CANTIDAD_CURSOS_MALLA}", count($cursos_por_clasificacion_desde_malla) , $html_cla);
        $total_cursos = "";
        $cantidad_cursos_aprobados_por_clasificacion = 0;
        foreach($cursos_por_clasificacion as $curso_unico) {
            $numero_cursos_total_up++;
        }
        foreach($cursos_por_clasificacion_desde_malla as $curso_unico) {
            $numero_cursos_total_desdemalla_up++;
        }
        // echo  "<br /> cursos_por_clasificacion ".count($cursos_por_clasificacion). " , cursos_por_clasificacion_desde_malla ".count($cursos_por_clasificacion_desde_malla);
        if (count($cursos_por_clasificacion) >= count($cursos_por_clasificacion_desde_malla)) {
            // si num cursos es inferior a inscripciones
            $contador_div_rows = 1;
            foreach($cursos_por_clasificacion as $curso_unico) {
                $numero_cursos_total++;
                // $row_curso=file_get_contents("views/cursos/row_cursos_por_programas_capacitacion.html");
                // echo $curso_unico->id_curso."<br />";
                $row_curso = $curso_entorno;
                $row_curso = str_replace("{ID_CURSO}", $curso_unico->id_curso, $row_curso);
                $row_curso = str_replace("{NOMBRE_CURSO}", $curso_unico->nombre_curso, $row_curso);
                $row_curso = str_replace("{FECHA_INICIO}", $curso_unico->fecha_inicio_insc, $row_curso);
                $row_curso = str_replace("{IMAGEN}", $curso_unico->imagen, $row_curso);
                $row_curso = str_replace("{DESCRIPCION_CURSO}", $curso_unico->descripcion_curso, $row_curso);
                $row_curso = str_replace("{DESCRIPTOR_CURSO}", $curso_unico->descriptor_curso, $row_curso);
                $row_curso = str_replace("{FECHA_TERMINO}", $curso_unico->fecha_termino_insc, $row_curso);
                $row_curso = str_replace("{ASISTENCIA}", $curso_unico->porcentaje_asistencia, $row_curso);
                if ($curso_unico->proveedor_curso == "OL") {
                    // $tiempo     = time();
                    // print_r($curso_unico);   //echo "<br /><br />";
                    // $id_curso_test="13HY13"; //echo "$rut - $tiempo - ".$curso_unico->codigo_curso." - ".$curso_unico->nombre_curso."<br />";
                    // $string_var = encryptMoodleAula($rut . "||" . $tiempo . "||" . $curso_unico->codigo_curso, "");
                    // $string_var=encryptMoodleAula($rut."||".$tiempo."||".$id_curso_test, "");
                    // echo $string_var."<br />";
                    // $string_var = encryptMoodleAula($rut . "||" . $tiempo . "||" . $id_curso_test, "");
                    // print_r($curso_unico);exit;
                    // echo $string_var;exit;
                    // $row_curso  = str_replace("{LINK_CURSO}", '<a target="_blank"  href="http://aula.openl.cl/local/minvest/login.php?token=' . $string_var . '">', $row_curso);
                    // $row_curso = str_replace("{LINK_CURSO}",'<a href="javascript: alert(\'Curso Cerrado\');">',$row_curso);
                    // $row_curso  = str_replace("{/LINK_CURSO}", '</a>', $row_curso);
                }
                else if ($curso_unico->modalidad <> 2) {
                    $row_curso = str_replace("{LINK_CURSO}", '<a href="?sw=detalle_cursoCap&idc={ID_CURSO_ENCODEADO}&idinsc={ID_INSCRIPCION_ENCODEADO}">', $row_curso);
                    $row_curso = str_replace("{/LINK_CURSO}", '</a>', $row_curso);
                    $row_curso = str_replace("{LINK_CURSO_JUSTURL}", '?sw=detalle_cursoCap&idc={ID_CURSO_ENCODEADO}&idinsc={ID_INSCRIPCION_ENCODEADO}', $row_curso);
                }
                else {
                    $row_curso = str_replace("{LINK_CURSO}", "", $row_curso);
                    $row_curso = str_replace("{/LINK_CURSO}", "", $row_curso);
                }
                // $row_curso = str_replace("{ID_CURSO_ENCODEADO}",Encodear3($curso_unico->id_curso),$row_curso);
                $row_curso = str_replace("{ID_CURSO_ENCODEADO}", Encodear3($curso_unico->codigo_curso) , $row_curso);
                list($estado, $porcentaje_asistencia, $nota) = CAPACITACION_VE_ESTADO($rut, $curso_unico->codigo_curso, $curso_unico->id_inscripcion, $id_empresa);
                $estado_por_curso = CAPACITACION_ObtenerEstadoAvanceCurso($rut, $curso_unico->codigo_curso, "", $id_empresa);
                $row_curso = str_replace("{ESTADO}", $estado_por_curso[0], $row_curso);
                $row_curso = str_replace("{ESTADO}", $estado_por_curso[1], $row_curso);
                $row_curso = str_replace("{ICONO_ESTADO_CURSO}", $estado_por_curso[2], $row_curso);
                // $row_curso = str_replace("{AVANCE_CURSO}",$estado_por_curso[3],$row_curso);
                $row_curso = str_replace("{AVANCE_CURSO}", $estado_por_curso[4], $row_curso);
                $total_cursos.= $row_curso;
            }
        }
        else {
            $cantidad_cursos_por_clasificacion = 0;
            $cla_sum_avance = 0;
            // si num cursos es igual o superior a inscripciones               // echo "<br /><pre>";
            // print_r($cursos_por_clasificacion_desde_malla);
            $contador_div_rows = 1;
            foreach($cursos_por_clasificacion_desde_malla as $curso_unico) {


            if($id_empresa=="52" and $rut<>"sabad" and $rut<>"fmancilla" and $curso_unico->id_curso=="wa_desafio_91"){
               continue;
            }
//           echo "<br /><pre>";    print_r($curso_unico);
           //echo "<br>id curso ".$curso_unico->id_curso;
                ReparaInconsistenciasAvanceCurso($rut, $curso_unico->id_curso, $id_empresa);
                // modalidad 4
                if ($curso_unico->cuentaCursos > 1) {
                    //echo "<br />".$curso_unico->id_curso." CURSO >1";
                    $array_InscripcionesModalidad4 = BuscaCantidadInstanciasInscripcionUsuario($curso_unico->id_curso, $codigo_malla, $id_empresa, $rut);
                    // print_r($array_InscripcionesModalidad4);
                    foreach($array_InscripcionesModalidad4 as $unico) {
                        $estado_por_curso = CAPACITACION_ObtenerEstadoAvanceCurso($rut, $curso_unico->id_curso, $unico->id_inscripcion, $id_empresa);

                        // echo "<br>$rut, ".$curso_unico->id_curso." $id_empresa";
                        //print_r($estado_por_curso);
                        //echo "<br>";
                        // echo "<br />".$unico->id_curso." CURSO id inscripcion ".$unico->id_inscripcion;
                        $curso_entorno = file_get_contents("views/cursos/capacitacion/" . $id_empresa . "_row_cursos_por_programas_capacitacion_unico" . $template_malla . ".html");
                        $numero_cursos_total_desdemalla++;
                        // $row_curso=file_get_contents("views/cursos/row_cursos_por_programas_capacitacion.html");
                        $row_curso = $curso_entorno;
                        // echo "<br /><br /><br /> INACTIVO curso_unico->inactivo_curso ".$curso_unico->inactivo_curso-" or curso_unico->inactivo ".$curso_unico->inactivo;
                        if ($curso_unico->inactivo_curso == 1 or $curso_unico->inactivo == 1) {
                            //                echo "hola inactivo";
                            $row_curso = file_get_contents("views/cursos/capacitacion/" . $id_empresa . "_row_cursos_por_programas_capacitacion_inactivo" . $template_malla . ".html");
                            //                echo "views/cursos/capacitacion/".$id_empresa."_row_cursos_por_programas_capacitacion_inactivo".$template_malla.".html"
                        }
                        if ($curso_unico->scoid == "CERTIFICACION") {
                            $row_curso = file_get_contents("views/cursos/capacitacion/" . $id_empresa . "_row_cursos_por_programas_capacitacion_certificacion.html");
                        }
                        // echo "1";
                        if ($curso_unico->valortotal == "CURSO_POR_FECHAS" or $curso_unico->modalidad == "4") {
                            // echo "<br />.2";
                            $inscripcion_curso = TraigoInscripcionUsuarioPorCursoEmpresaUsuarioImparticiones($id_empresa, $rut, $curso_unico->id_curso, $unico->id_inscripcion);
                            $fecha_actual = date("Y-m-d");
                            $hora_actual = date("H:i:s");
                            // echo "hora actual $hora_actual <br />";
                            // echo $inscripcion_curso[0]->hora_inicio."<br />";
                            // echo $inscripcion_curso[0]->hora_termino."<br />";
                            // echo $inscripcion_curso[0]->fecha_inicio."<br />";
                            // echo $inscripcion_curso[0]->fecha_termino."<br />";
                            $datos_objeto = TraeObjetosPorCurso($curso_unico->id_curso, $id_empresa);
                            $respuestas_por_objeto = RespuestasDadoRutObjeto($rut, $datos_objeto[0]->id);
                            // Traigo el total de preguntas para este objeto
                            if ($datos_objeto[0]->preguntas_aleatorias > 0) {
                                // Traigo el total de preguntas desde asociacion_preguntas
                                $total_preguntas = EVALUACION_PreguntasDadoIdObjetoaleatorio($datos_objeto[0]->id, $rut);
                            }
                            else {
                                // Traigo el total de preguntas, dado el id de la evaluacion
                                $total_preguntas = EVALUACION_PreguntasDadoIdObjeto($datos_objeto[0]->id);
                            }
                            if (count($respuestas_por_objeto) > 0 && count($respuestas_por_objeto) < count($total_preguntas)) {
                                $row_curso = file_get_contents("views/cursos/capacitacion/" . $id_empresa . "_row_cursos_por_programas_capacitacion_unico" . $template_malla . ".html");
                                // echo $unico->id_curso;echo "<br /><br />";
                                if ($unico->id_inscripcion) {
                                    $row_curso = str_replace("{PARAMETROS_AUTOEVAL_SGD}", "ii=" . Encodear3($unico->id_inscripcion) . "", $row_curso);
                                }
                                else {
                                    $row_curso = str_replace("{PARAMETROS_AUTOEVAL_SGD}", "", $row_curso);
                                }
                            }
                            else if ($fecha_actual < $inscripcion_curso[0]->fecha_inicio) {
                                $row_curso = file_get_contents("views/cursos/capacitacion/" . $id_empresa . "_row_cursos_por_programas_capacitacion_unico_sin_link" . $template_malla . ".html");
                                $mensaje_objeto="";
                                $mensaje_objeto.= "<small><strong>El curso se encuentra desactivado</strong>.<br /> La fecha de aplicaci&oacute;n es el " . $inscripcion_curso[0]->fecha_inicio . " y el horario de activaci&oacute;n es entre las " . $inscripcion_curso[0]->hora_inicio . " y " . $inscripcion_curso[0]->hora_termino . "</small>
                                <br><br><div class='alert alert-danger'><center>Recuerda presionar F5 al momento que llegue la hora para activar la Certificaci&oacute;n</center></div>";

                                $row_curso = str_replace("{MENSAJE_}", $mensaje_objeto, $row_curso);
                            }
                            else if ($fecha_actual > $inscripcion_curso[0]->fecha_termino) {
                                $row_curso = file_get_contents("views/cursos/capacitacion/" . $id_empresa . "_row_cursos_por_programas_capacitacion_unico_sin_link" . $template_malla . ".html");
                                $mensaje_objeto="";
                                $mensaje_objeto.= "<small><strong>El curso se encuentra desactivado</strong>.<br /> La fecha de aplicaci&oacute;n es el " . $inscripcion_curso[0]->fecha_inicio . " y el horario de activaci&oacute;n es entre las " . $inscripcion_curso[0]->hora_inicio . " y " . $inscripcion_curso[0]->hora_termino . "</small>
                                <br><br><div class='alert alert-danger'><center>Recuerda presionar F5 al momento que llegue la hora para activar la Certificaci&oacute;n</center></div>";

                                $row_curso = str_replace("{MENSAJE_}", $mensaje_objeto, $row_curso);
                            }
                            else if ($fecha_actual >= $inscripcion_curso[0]->fecha_inicio && $fecha_actual <= $inscripcion_curso[0]->fecha_termino) {
                                if ($fecha_actual == $inscripcion_curso[0]->fecha_inicio and $fecha_actual <> $inscripcion_curso[0]->fecha_termino) {
                                    // echo "es hoy inicio";
                                    if ($hora_actual < $inscripcion_curso[0]->hora_inicio) {
                                        $row_curso = file_get_contents("views/cursos/capacitacion/" . $id_empresa . "_row_cursos_por_programas_capacitacion_unico_sin_link" . $template_malla . ".html");
                                        $mensaje_objeto="";
                                        $mensaje_objeto.= "<small><strong>El curso se encuentra desactivado</strong>.<br /> La fecha de aplicaci&oacute;n es el " . $inscripcion_curso[0]->fecha_inicio . " y el horario de activaci&oacute;n es entre las " . $inscripcion_curso[0]->hora_inicio . " y " . $inscripcion_curso[0]->hora_termino . "</small>
<br><br><div class='alert alert-danger'><center>Recuerda presionar F5 al momento que llegue la hora para activar la Certificaci&oacute;n</center></div>";
                                        $row_curso = str_replace("{MENSAJE_}", $mensaje_objeto, $row_curso);
                                    }
                                }
                                elseif ($fecha_actual == $inscripcion_curso[0]->fecha_termino and $fecha_actual <> $inscripcion_curso[0]->fecha_inicio) {
                                    if ($hora_actual > $inscripcion_curso[0]->hora_termino) {
                                        exit;
                                        $row_curso = file_get_contents("views/cursos/capacitacion/" . $id_empresa . "_row_cursos_por_programas_capacitacion_unico_sin_link" . $template_malla . ".html");
                                        $mensaje_objeto="";
                                        $mensaje_objeto.= "<small><strong>El curso se encuentra desactivado</strong>.<br /> La fecha de aplicaci&oacute;n es el " . $inscripcion_curso[0]->fecha_inicio . " y el horario de activaci&oacute;n es entre las " . $inscripcion_curso[0]->hora_inicio . " y " . $inscripcion_curso[0]->hora_termino . "</small>
<br><br><div class='alert alert-danger'><center>Recuerda presionar F5 al momento que llegue la hora para activar la Certificaci&oacute;n</center></div>";
                                        $row_curso = str_replace("{MENSAJE_}", $mensaje_objeto, $row_curso);
                                    }
                                }
                                elseif ($fecha_actual == $inscripcion_curso[0]->fecha_termino and $fecha_actual == $inscripcion_curso[0]->fecha_inicio) {
                                    // echo "es hoy termino e iniciohora ahora es ".$hora_actual." hora termino ".$unico->hora_termino." hora inicio".$unico->hora_inicio;
                                    if ($hora_actual > $inscripcion_curso[0]->hora_termino or $hora_actual < $inscripcion_curso[0]->hora_inicio) {
                                        $row_curso = file_get_contents("views/cursos/capacitacion/" . $id_empresa . "_row_cursos_por_programas_capacitacion_unico_sin_link" . $template_malla . ".html");
                                        $mensaje_objeto="";
                                        $mensaje_objeto.= "<small><strong>El curso se encuentra desactivado</strong>.<br /> La fecha de aplicaci&oacute;n es el " . $inscripcion_curso[0]->fecha_inicio . " y el horario de activaci&oacute;n es entre las " . $inscripcion_curso[0]->hora_inicio . " y " . $inscripcion_curso[0]->hora_termino . "</small>
<br><br><div class='alert alert-danger'><center>Recuerda presionar F5 al momento que llegue la hora para activar la Certificaci&oacute;n</center></div>";
                                        $row_curso = str_replace("{MENSAJE_}", $mensaje_objeto, $row_curso);
                                    }
                                }
                            }
                            else {
                                $row_curso = file_get_contents("views/cursos/capacitacion/" . $id_empresa . "_row_cursos_por_programas_capacitacion_unico" . $template_malla . ".html");
                            }
                            // echo $id_empresa."_row_cursos_por_programas_capacitacion_inactivo".$template_malla.".html";
                        }
                        $row_curso = str_replace("{NOMBRE_CURSO}", $curso_unico->nombre_curso . "", $row_curso);
                        $row_curso = ListadoObjetosCapacitacionCert2017($row_curso, $curso_unico->id_curso, $_SESSION["user_"], "", $unico->id_inscripcion, $id_empresa, $template_malla, $back_home, $im, $id_programa, $id_nivel);
                        $row_curso = ListadoObjetosCapacitacionSecuencial2017($row_curso, $curso_unico->id_curso, $_SESSION["user_"], "", $id_inscripcion, $id_empresa, $template_malla, $back_home, $im, $id_programa, $id_nivel);
                        if ($unico->id_inscripcion) {
                            $row_curso = str_replace("{PARAMETROS_AUTOEVAL_SGD}", "ii=" . Encodear3($unico->id_inscripcion) . "", $row_curso);
                        }
                        else {
                            $row_curso = str_replace("{PARAMETROS_AUTOEVAL_SGD}", "", $row_curso);
                        }
                        $avances_cursos = ColocaAvanceCursoPorPuntosDeObjetos($row_curso, $curso_unico->id_curso, $rut, $id_empresa);
                        $row_curso = $avances_cursos[0];
                        $row_curso = str_replace("{ID_CURSO}", $curso_unico->id_curso, $row_curso);
                        $row_curso = str_replace("{IMAGEN_BACK}", $curso_unico->imagen_back, $row_curso);
                        $row_curso = str_replace("{IMAGEN}", $curso_unico->imagen, $row_curso);
                        $row_curso = str_replace("{DESCRIPCION_CURSO}", $curso_unico->descripcion_curso, $row_curso);
                        $row_curso = str_replace("{DESCRIPTOR_CURSO}", $curso_unico->descriptor_curso, $row_curso);
                        $row_curso = str_replace("{FECHA_INICIO}", $curso_unico->fecha_inicio_insc, $row_curso);
                        $row_curso = str_replace("{FECHA_TERMINO}", $curso_unico->fecha_termino_insc, $row_curso);
                        // $row_curso = str_replace("{FECHA_TERMINO_INSC}",$curso_unico->fecha_termino,$row_curso);
                        $row_curso = str_replace("{FECHA_TERMINO_INSC}", formatearFechaSmall($curso_unico->fecha_termino) , $row_curso);
                        $row_curso = str_replace("{FECHA_INICIO_INSC}", $curso_unico->fecha_inicio, $row_curso);
                        $row_curso = str_replace("{ASISTENCIA}", $curso_unico->porcentaje_asistencia, $row_curso);
                        if ($curso_unico->modalidad <> 2) {
                            if ($curso_unico->proveedor_curso == "OL") {
                            }
                            else {
                                $row_curso = str_replace("{LINK_CURSO}", '<a href="?sw=detalle_cursoCap&idc={ID_CURSO_ENCODEADO}">', $row_curso);
                                $row_curso = str_replace("{/LINK_CURSO}", '</a>', $row_curso);
                                $row_curso = str_replace("{LINK_CURSO_JUSTURL}", '?sw=detalle_cursoCap&idc={ID_CURSO_ENCODEADO}&idinsc={ID_INSCRIPCION_ENCODEADO}', $row_curso);
                            }
                        }
                        else {
                            $row_curso = str_replace("{LINK_CURSO}", "", $row_curso);
                            $row_curso = str_replace("{/LINK_CURSO}", "", $row_curso);
                        }
                        list($estado, $porcentaje_asistencia, $nota) = CAPACITACION_VE_ESTADO($rut, $curso_unico->codigo_curso, $curso_unico->id_inscripcion, $id_empresa);
                        $row_curso = str_replace("{ID_CURSO_ENCODEADO}", Encodear3($curso_unico->id_curso) , $row_curso);
                        $row_curso = str_replace("{ID_INSCRIPCION_ENCODEADO}", Encodear3($curso_unico->id_inscripcion) , $row_curso);
                        $row_curso = str_replace("{ESTADO}", $estado_por_curso[0], $row_curso);
                        $row_curso = str_replace("{ESTADO_CON_NOTA}", $estado_por_curso[9], $row_curso);
                        $row_curso = str_replace("{ASISTENCIA}", $estado_por_curso[0], $row_curso);
                        if ($estado_por_curso[10]) {
                            $row_curso = str_replace("{PORC_ASISTENCIA}", $estado_por_curso[10] . "%", $row_curso);
                        }
                        else {
                            $row_curso = str_replace("{PORC_ASISTENCIA}", "-", $row_curso);
                        }
                        $row_curso = str_replace("{ESTADO}", $estado_por_curso[1], $row_curso);
                        if ($estado_por_curso[13]) {
                            $row_curso = str_replace("{NOTA}", $estado_por_curso[7], $row_curso);
                            $row_curso = str_replace("{NOTA_porcentaje}", "" . $estado_por_curso[7] . "%", $row_curso);
                            if ($estado_por_curso[13] == "") {
                                if ($estado_por_curso[7] <> '') {
                                    $nota_decimal = $estado_por_curso[7] . "%";
                                }
                                else {
                                    $nota_decimal = "-";
                                }
                                $row_curso = str_replace("{NOTA_porcentaje_decimales}", "" . $nota_decimal, $row_curso);
                            }
                            else {
                                if ($estado_por_curso[7] <> '') {
                                    $nota_decimal = $estado_por_curso[7] . "%";
                                }
                                else {
                                    $nota_decimal = "-";
                                }
                                $row_curso = str_replace("{NOTA_porcentaje_decimales}", "" . $nota_decimal, $row_curso);
                            }
                            $row_curso = str_replace("{AVANCE_CURSO}", ($estado_por_curso[13]) , $row_curso);
                            $row_curso = str_replace("{AVANCE_CURSO2}", ($estado_por_curso[7]) , $row_curso);
                            /*$row_curso = str_replace("{BARRA_SIN_PORCENTAJE}","<div class='progress'>
                            <div class='progress-bar progress-bar-success progress-bar-striped progress-animation'
                            role='progressbar' aria-valuenow='".$estado_por_curso[7]."' aria-valuemin='0'
                            aria-valuemax='100' style='width: ".$estado_por_curso[7]."%'></div>
                            </div>",$row_curso);*/
                            $row_curso = str_replace("{BARRA_SIN_PORCENTAJE}", "", $row_curso);
                        }
                        else {
                            if ($estado_por_curso[7] <> "") {
                                if ($estado_por_curso[7] <> '') {
                                    $nota_decimal = $estado_por_curso[7] . "%";
                                }
                                else {
                                    $nota_decimal = "-";
                                }
                                $row_curso = str_replace("{NOTA_porcentaje_decimales}", "" . $nota_decimal, $row_curso);
                            }
                            else {
                                if ($estado_por_curso[7] <> '') {
                                    $nota_decimal = $estado_por_curso[7] . "%";
                                }
                                else {
                                    $nota_decimal = "-";
                                }
                                $row_curso = str_replace("{NOTA_porcentaje_decimales}", "" . $nota_decimal, $row_curso);
                            }
                            $row_curso = str_replace("{NOTA}", "-", $row_curso);
                            $row_curso = str_replace("{NOTA_SIN_PORCENTAJE}", "-", $row_curso);
                            $row_curso = str_replace("{NOTA_porcentaje}", "", $row_curso);
                            $row_curso = str_replace("{BARRA_SIN_PORCENTAJE}", "", $row_curso);
                        }
                        if ($estado_por_curso[8]) {
                            $row_curso = str_replace("{FECHA_FIN}", $estado_por_curso[8], $row_curso);
                        }
                        else {
                            $row_curso = str_replace("{FECHA_FIN}", "-", $row_curso);
                        }
                        $row_curso = str_replace("{ICONO_ESTADO_CURSO}", $estado_por_curso[2], $row_curso);
                        // $row_curso = str_replace("{AVANCE_CURSO}",$estado_por_curso[3],$row_curso);
                        if ($curso_unico->modalidad == 2) {
                            $row_curso = str_replace("{AVANCE_CURSO}", $estado_por_curso[3], $row_curso);
                            $row_curso = str_replace("{AVANCE_CURSO2}", $estado_por_curso[3], $row_curso);
                            if ($curso_unico->opcional <> 1 and $curso_unico->inactivo <> 1) {
                                $acumula_avance_curso = $estado_por_curso[3] + $acumula_avance_curso;
                            }
                        }
                        else {
                            $row_curso = str_replace("{AVANCE_CURSO}", $estado_por_curso[4], $row_curso);
                            $row_curso = str_replace("{AVANCE_CURSO2}", $estado_por_curso[4], $row_curso);
                            if ($curso_unico->opcional <> 1 and $curso_unico->inactivo <> 1) {
                                $acumula_avance_curso = $estado_por_curso[4] + $acumula_avance_curso;
                            }
                        }
                        if ($curso_unico->opcional <> 1 and $curso_unico->inactivo <> 1) {
                            $acumula_cursos++;
                        }
                        // Funcion para colocar Avance de Curso, Tipo Ultramar, en base a los puntos de los objetos.
                        // echo  "<br />".print_r($estado_por_curso);
                        if ($estado_por_curso[6] == 1) {
                            $cantidad_cursos_aprobados_por_clasificacion++;
                        }
                        // suma avance
                        $cla_sum_avance = $cla_sum_avance + $estado_por_curso[4];
                        // echo "<pre>";
                        //    print_r($estado_por_curso);
                        $cantidad_cursos_por_clasificacion++;
                        // AVANCE GLOBAL
                        $cla_sum_avance_total = $cla_sum_avance_total + $cla_sum_avance;
                        $cla_cantidad_cursos_por_clasificacion_total = $cla_cantidad_cursos_por_clasificacion_total + $cantidad_cursos_por_clasificacion;
                        // echo $total_cursos;
                        $total_cursos.= $row_curso;
                        // echo "<br />id curso ".$curso_unico->id_curso." estado ".$estado_por_curso;
                        // print_r($estado_por_curso);
                        if ($estado_por_curso[4] >= 100) {
                            $total_cursos_aprobados.= $row_curso;
                        }
                        else {
                            $total_cursos_pendientes.= $row_curso;
                        }
                        if ($curso_unico->inactivo == "1") {
                            $total_cursos_inactivos.= $row_curso;
                        }
                        else {
                            $total_cursos_activos.= $row_curso;
                        }
                    }
                }
                else {

                //$start = microtime(true);
                    //echo "<br />".$curso_unico->id_curso." CURSO =0, fecha inicio".$curso_unico->fecha_inicio;
                    // echo "<br /><pre>";
                    // echo "<br /> template $template_malla";
                    // $estado_por_curso=CAPACITACION_ObtenerEstadoAvanceCurso($rut, $curso_unico->codigo_curso, "", $id_empresa);
                      $estado_por_curso = CAPACITACION_ObtenerEstadoAvanceCurso($rut, $curso_unico->id_curso, "", $id_empresa);
                    // print_r($estado_por_curso);echo "<br />";
                    // echo "nivel ".$nivel_actual." - ".$curso_unico->numnivel."<br /><br />";
                    // echo "rut $rut ".$curso_unico->codigo_curso.", -, ".$curso_unico->id_curso." ".$id_empresa;
                    // echo "<br /><br />";
                    // echo "<br />nivel $nivel_actual curso ".$curso_unico->numnivel;
                    // echo "1";
                    $curso_entorno = file_get_contents("views/cursos/capacitacion/" . $id_empresa . "_row_cursos_por_programas_capacitacion_unico" . $template_malla . ".html");
                    // echo "views/cursos/capacitacion/" . $id_empresa . "_row_cursos_por_programas_capacitacion_unico" . $template_malla . ".html";
                    //
                    // echo "hola";
                    $numero_cursos_total_desdemalla++;
                    // $row_curso=file_get_contents("views/cursos/row_cursos_por_programas_capacitacion.html");
                    $row_curso = $curso_entorno;
                    // echo "<br /><br /><br /> INACTIVO curso_unico->inactivo_curso ".$curso_unico->inactivo_curso-" or curso_unico->inactivo ".$curso_unico->inactivo;
                    if ($curso_unico->inactivo_curso == 1 or $curso_unico->inactivo == 1) {
                        //                echo "hola inactivo";
                        $row_curso = file_get_contents("views/cursos/capacitacion/" . $id_empresa . "_row_cursos_por_programas_capacitacion_inactivo" . $template_malla . ".html");
                        //                echo "views/cursos/capacitacion/".$id_empresa."_row_cursos_por_programas_capacitacion_inactivo".$template_malla.".html"
                    }
                    if ($curso_unico->scoid == "CERTIFICACION") {
                        $row_curso = file_get_contents("views/cursos/capacitacion/" . $id_empresa . "_row_cursos_por_programas_capacitacion_certificacion.html");
                    }
                    // echo "1";
                    if ($curso_unico->valortotal == "CURSO_POR_FECHAS" or $curso_unico->modalidad == "4") {
                        // echo "2";
                        $inscripcion_curso = TraigoInscripcionUsuarioPorCursoEmpresaUsuario($id_empresa, $rut, $curso_unico->id_curso);
                        $fecha_actual = date("Y-m-d");
                        $hora_actual = date("H:i:s");
                        // echo "hora actual $hora_actual <br />";
                        // echo $inscripcion_curso[0]->hora_inicio."<br />";
                        // echo $inscripcion_curso[0]->hora_termino."<br />";
                        // echo $inscripcion_curso[0]->fecha_inicio."<br />";
                        // echo $inscripcion_curso[0]->fecha_termino."<br />";
                        if ($fecha_actual < $inscripcion_curso[0]->fecha_inicio) {
                            $row_curso = file_get_contents("views/cursos/capacitacion/" . $id_empresa . "_row_cursos_por_programas_capacitacion_unico_sin_link" . $template_malla . ".html");
                            $mensaje_objeto="";
                            $mensaje_objeto.= "<small><strong>El curso se encuentra desactivado</strong>.<br /> La fecha de aplicaci&oacute;n es el " . $inscripcion_curso[0]->fecha_inicio . " y el horario de activaci&oacute;n es entre las " . $inscripcion_curso[0]->hora_inicio . " y " . $inscripcion_curso[0]->hora_termino . "</small>
                            <br><br><div class='alert alert-danger'><center>Recuerda presionar F5 al momento que llegue la hora para activar la Certificaci&oacute;n</center></div>";
                            $row_curso = str_replace("{MENSAJE_}", $mensaje_objeto, $row_curso);
                        }
                        else if ($fecha_actual > $inscripcion_curso[0]->fecha_termino) {
                            $row_curso = file_get_contents("views/cursos/capacitacion/" . $id_empresa . "_row_cursos_por_programas_capacitacion_unico_sin_link" . $template_malla . ".html");
                            $mensaje_objeto="";
                            $mensaje_objeto.= "<small><strong>El curso se encuentra desactivado</strong>.<br /> La fecha de aplicaci&oacute;n es el " . $inscripcion_curso[0]->fecha_inicio . " y el horario de activaci&oacute;n es entre las " . $inscripcion_curso[0]->hora_inicio . " y " . $inscripcion_curso[0]->hora_termino . "</small>
                            <br><br><div class='alert alert-danger'><center>Recuerda presionar F5 al momento que llegue la hora para activar la Certificaci&oacute;n</center></div>";
                            $row_curso = str_replace("{MENSAJE_}", $mensaje_objeto, $row_curso);
                        }
                        else if ($fecha_actual >= $inscripcion_curso[0]->fecha_inicio && $fecha_actual <= $inscripcion_curso[0]->fecha_termino) {
                            if ($fecha_actual == $inscripcion_curso[0]->fecha_inicio and $fecha_actual <> $inscripcion_curso[0]->fecha_termino) {
                                // echo "es hoy inicio";
                                if ($hora_actual < $inscripcion_curso[0]->hora_inicio) {
                                    $row_curso = file_get_contents("views/cursos/capacitacion/" . $id_empresa . "_row_cursos_por_programas_capacitacion_unico_sin_link" . $template_malla . ".html");
                                    $mensaje_objeto="";
                                    $mensaje_objeto.= "<small><strong>El curso se encuentra desactivado</strong>.<br /> La fecha de aplicaci&oacute;n es el " . $inscripcion_curso[0]->fecha_inicio . " y el horario de activaci&oacute;n es entre las " . $inscripcion_curso[0]->hora_inicio . " y " . $inscripcion_curso[0]->hora_termino . "</small>
                                    <br><br><div class='alert alert-danger'><center>Recuerda presionar F5 al momento que llegue la hora para activar la Certificaci&oacute;n</center></div>";
                                    $row_curso = str_replace("{MENSAJE_}", $mensaje_objeto, $row_curso);
                                }
                            }
                            elseif ($fecha_actual == $inscripcion_curso[0]->fecha_termino and $fecha_actual <> $inscripcion_curso[0]->fecha_inicio) {
                                if ($hora_actual > $inscripcion_curso[0]->hora_termino) {
                                    exit;
                                    $row_curso = file_get_contents("views/cursos/capacitacion/" . $id_empresa . "_row_cursos_por_programas_capacitacion_unico_sin_link" . $template_malla . ".html");
                                    $mensaje_objeto="";
                                    $mensaje_objeto.= "<small><strong>El curso se encuentra desactivado</strong>.<br /> La fecha de aplicaci&oacute;n es el " . $inscripcion_curso[0]->fecha_inicio . " y el horario de activaci&oacute;n es entre las " . $inscripcion_curso[0]->hora_inicio . " y " . $inscripcion_curso[0]->hora_termino . "</small>
                                    <br><br><div class='alert alert-danger'><center>Recuerda presionar F5 al momento que llegue la hora para activar la Certificaci&oacute;n</center></div>";
                                    $row_curso = str_replace("{MENSAJE_}", $mensaje_objeto, $row_curso);
                                }
                            }
                            elseif ($fecha_actual == $inscripcion_curso[0]->fecha_termino and $fecha_actual == $inscripcion_curso[0]->fecha_inicio) {
                                // echo "es hoy termino e iniciohora ahora es ".$hora_actual." hora termino ".$unico->hora_termino." hora inicio".$unico->hora_inicio;
                                if ($hora_actual > $inscripcion_curso[0]->hora_termino or $hora_actual < $inscripcion_curso[0]->hora_inicio) {
                                    $row_curso = file_get_contents("views/cursos/capacitacion/" . $id_empresa . "_row_cursos_por_programas_capacitacion_unico_sin_link" . $template_malla . ".html");
                                    $mensaje_objeto="";
                                    $mensaje_objeto.= "<small><strong>El curso se encuentra desactivado</strong>.<br /> La fecha de aplicaci&oacute;n es el " . $inscripcion_curso[0]->fecha_inicio . " y el horario de activaci&oacute;n es entre las " . $inscripcion_curso[0]->hora_inicio . " y " . $inscripcion_curso[0]->hora_termino . "</small>
                                    <br><br><div class='alert alert-danger'><center>Recuerda presionar F5 al momento que llegue la hora para activar la Certificaci&oacute;n</center></div>";
                                    $row_curso = str_replace("{MENSAJE_}", $mensaje_objeto, $row_curso);
                                }
                            }
                        }
                        else {
                            $row_curso = file_get_contents("views/cursos/capacitacion/" . $id_empresa . "_row_cursos_por_programas_capacitacion_unico" . $template_malla . ".html");
                        }
                        // echo $id_empresa."_row_cursos_por_programas_capacitacion_inactivo".$template_malla.".html";
                    }
                    $row_curso = str_replace("{NOMBRE_CURSO}", $curso_unico->nombre_curso . "", $row_curso);
                    if($id_empresa=="62"){
                        $row_curso = ListadoObjetosCapacitacionCert2017($row_curso, $curso_unico->id_curso, $_SESSION["user_"], "", $id_inscripcion, $id_empresa, $template_malla, $back_home, $im, $id_programa, $id_nivel);
                        $row_curso = ListadoObjetosCapacitacionSecuencial2017($row_curso, $curso_unico->id_curso, $_SESSION["user_"], "", $id_inscripcion, $id_empresa, $template_malla, $back_home, $im, $id_programa, $id_nivel);
                     }
                     $avances_cursos = ColocaAvanceCursoPorPuntosDeObjetos($row_curso, $curso_unico->id_curso, $rut, $id_empresa);
                    $row_curso = $avances_cursos[0];
                    $row_curso = str_replace("{ID_CURSO}", $curso_unico->id_curso, $row_curso);
                    $row_curso = str_replace("{IMAGEN_BACK}", $curso_unico->imagen_back, $row_curso);
                    $row_curso = str_replace("{FECHA_INICIO}", $curso_unico->fecha_inicio, $row_curso);
                    $row_curso = str_replace("{IMAGEN}", $curso_unico->imagen, $row_curso);
                    $row_curso = str_replace("{DESCRIPCION_CURSO}", $curso_unico->descripcion_curso, $row_curso);
                    $row_curso = str_replace("{DESCRIPTOR_CURSO}", $curso_unico->descriptor_curso, $row_curso);
                    $row_curso = str_replace("{FECHA_INICIO}", $curso_unico->fecha_inicio_insc, $row_curso);
                    $row_curso = str_replace("{FECHA_TERMINO}", $curso_unico->fecha_termino_insc, $row_curso);
                    // $row_curso = str_replace("{FECHA_TERMINO_INSC}",$curso_unico->fecha_termino,$row_curso);
                    $row_curso = str_replace("{FECHA_TERMINO_INSC}", formatearFechaSmall($curso_unico->fecha_termino) , $row_curso);
                    $row_curso = str_replace("{FECHA_INICIO_INSC}", $curso_unico->fecha_inicio, $row_curso);
                    $row_curso = str_replace("{ASISTENCIA}", $curso_unico->porcentaje_asistencia, $row_curso);
                                            $row_curso = str_replace("{NOTA_raw}", $estado_por_curso[7]."%", $row_curso);

                    if ($curso_unico->modalidad <> 2) {
                        if ($curso_unico->proveedor_curso == "OL") {
                        }
                        else {
                            $row_curso = str_replace("{LINK_CURSO}", '<a href="?sw=detalle_cursoCap&idc={ID_CURSO_ENCODEADO}">', $row_curso);
                            $row_curso = str_replace("{/LINK_CURSO}", '</a>', $row_curso);
                            $row_curso = str_replace("{LINK_CURSO_JUSTURL}", '?sw=detalle_cursoCap&idc={ID_CURSO_ENCODEADO}&idinsc={ID_INSCRIPCION_ENCODEADO}', $row_curso);
                        }
                    }
                    else {
                        $row_curso = str_replace("{LINK_CURSO}", "", $row_curso);
                        $row_curso = str_replace("{/LINK_CURSO}", "", $row_curso);
                    }
                    // ROD&nbsp; list($estado, $porcentaje_asistencia, $nota) = CAPACITACION_VE_ESTADO($rut, $curso_unico->codigo_curso, $curso_unico->id_inscripcion, $id_empresa);
                    $row_curso = str_replace("{ID_CURSO_ENCODEADO}", Encodear3($curso_unico->id_curso) , $row_curso);
                    $row_curso = str_replace("{ID_INSCRIPCION_ENCODEADO}", Encodear3($curso_unico->id_inscripcion) , $row_curso);
                    $row_curso = str_replace("{ESTADO}", $estado_por_curso[0], $row_curso);
                    $row_curso = str_replace("{ESTADO_CON_NOTA}", $estado_por_curso[9], $row_curso);
                    $row_curso = str_replace("{ASISTENCIA}", $estado_por_curso[0], $row_curso);
                    if ($estado_por_curso[10]) {
                        $row_curso = str_replace("{PORC_ASISTENCIA}", $estado_por_curso[10] . "%", $row_curso);
                    }
                    else {
                        $row_curso = str_replace("{PORC_ASISTENCIA}", "-", $row_curso);
                    }
                    $row_curso = str_replace("{ESTADO}", $estado_por_curso[1], $row_curso);
                    if ($estado_por_curso[13]) {
                        $row_curso = str_replace("{NOTA}", $estado_por_curso[7], $row_curso);
                        $row_curso = str_replace("{NOTA_porcentaje}", "" . $estado_por_curso[7] . "%", $row_curso);
                        if ($estado_por_curso[13] == "") {
                            if ($estado_por_curso[7] <> '') {
                                $nota_decimal = $estado_por_curso[7] . "%";
                            }
                            else {
                                $nota_decimal = "-";
                            }
                            $row_curso = str_replace("{NOTA_porcentaje_decimales}", "" . $nota_decimal, $row_curso);
                        }
                        else {
                            if ($estado_por_curso[7] <> '') {
                                $nota_decimal = $estado_por_curso[7] . "%";
                            }
                            else {
                                $nota_decimal = "-";
                            }
                            $row_curso = str_replace("{NOTA_porcentaje_decimales}", "" . $nota_decimal, $row_curso);
                        }
                        $row_curso = str_replace("{AVANCE_CURSO}", ($estado_por_curso[13]) , $row_curso);
                        $row_curso = str_replace("{AVANCE_CURSO2}", ($estado_por_curso[7]) , $row_curso);
                        /*$row_curso = str_replace("{BARRA_SIN_PORCENTAJE}","<div class='progress'>
                        <div class='progress-bar progress-bar-success progress-bar-striped progress-animation'
                        role='progressbar' aria-valuenow='".$estado_por_curso[7]."' aria-valuemin='0'
                        aria-valuemax='100' style='width: ".$estado_por_curso[7]."%'></div>
                        </div>",$row_curso);*/
                        $row_curso = str_replace("{BARRA_SIN_PORCENTAJE}", "", $row_curso);
                    }
                    else {
                        if ($estado_por_curso[7] <> "") {
                            if ($estado_por_curso[7] <> '') {
                                $nota_decimal = $estado_por_curso[7] . "%";
                            }
                            else {
                                $nota_decimal = "-";
                            }
                            $row_curso = str_replace("{NOTA_porcentaje_decimales}", "" . $nota_decimal, $row_curso);
                        }
                        else {
                            if ($estado_por_curso[7] <> '') {
                                $nota_decimal = $estado_por_curso[7] . "%";
                            }
                            else {
                                $nota_decimal = "-";
                            }
                            $row_curso = str_replace("{NOTA_porcentaje_decimales}", "" . $nota_decimal, $row_curso);
                        }
                        $row_curso = str_replace("{NOTA}", "-", $row_curso);
                        $row_curso = str_replace("{NOTA_SIN_PORCENTAJE}", "-", $row_curso);
                        $row_curso = str_replace("{NOTA_porcentaje}", "", $row_curso);
                        $row_curso = str_replace("{BARRA_SIN_PORCENTAJE}", "", $row_curso);
                    }
                    if ($estado_por_curso[8]) {
                        $row_curso = str_replace("{FECHA_FIN}", $estado_por_curso[8], $row_curso);
                    }
                    else {
                        $row_curso = str_replace("{FECHA_FIN}", "-", $row_curso);
                    }
                    $row_curso = str_replace("{ICONO_ESTADO_CURSO}", $estado_por_curso[2], $row_curso);
                    // $row_curso = str_replace("{AVANCE_CURSO}",$estado_por_curso[3],$row_curso);
                    if ($curso_unico->modalidad == 2) {
                        $row_curso = str_replace("{AVANCE_CURSO}", $estado_por_curso[3], $row_curso);
                        $row_curso = str_replace("{AVANCE_CURSO2}", $estado_por_curso[3], $row_curso);
                        if ($curso_unico->opcional <> 1 and $curso_unico->inactivo <> 1) {
                            $acumula_avance_curso = $estado_por_curso[3] + $acumula_avance_curso;
                        }
                    }
                    else {
                        $row_curso = str_replace("{AVANCE_CURSO}", $estado_por_curso[4], $row_curso);
                        $row_curso = str_replace("{AVANCE_CURSO2}", $estado_por_curso[4], $row_curso);
                        if ($curso_unico->opcional <> 1 and $curso_unico->inactivo <> 1) {
                            $acumula_avance_curso = $estado_por_curso[4] + $acumula_avance_curso;
                        }
                    }
                    if ($curso_unico->opcional <> 1 and $curso_unico->inactivo <> 1) {
                        $acumula_cursos++;
                    }
                    // Funcion para colocar Avance de Curso, Tipo Ultramar, en base a los puntos de los objetos.
                    // echo  "<br />".print_r($estado_por_curso);
                    if ($estado_por_curso[6] == 1) {
                        $cantidad_cursos_aprobados_por_clasificacion++;
                    }
                    // suma avance
                    $cla_sum_avance = $cla_sum_avance + $estado_por_curso[4];
                    // echo "<pre>";
                    //    print_r($estado_por_curso);
                    $cantidad_cursos_por_clasificacion++;
                    // AVANCE GLOBAL
                    $cla_sum_avance_total = $cla_sum_avance_total + $cla_sum_avance;
                    $cla_cantidad_cursos_por_clasificacion_total = $cla_cantidad_cursos_por_clasificacion_total + $cantidad_cursos_por_clasificacion;
                    // echo $total_cursos;
                    $total_cursos.= $row_curso;
                    // echo "<br />id curso ".$curso_unico->id_curso." estado ".$estado_por_curso;
                    // print_r($estado_por_curso);
                    if ($estado_por_curso[4] >= 100) {
                        $total_cursos_aprobados.= $row_curso;
                    }
                    else {
                        $total_cursos_pendientes.= $row_curso;
                    }
                    if ($curso_unico->inactivo == "1") {
                        $total_cursos_inactivos.= $row_curso;
                    }
                    else {
                        $total_cursos_activos.= $row_curso;
                    }

                    //$time_elapsed_secs = microtime(true) - $start;
                    //$time_elapsed= gmdate("H:i:s", $time_elapsed_secs);
                    //echo "<br>VP finalizados y pendientes  : $time_elapsed<br><br>";

                }
            }
        }
        // VISTA AVANCE POR CLASIFICACION REAL POR OBJETO
        $avance_de_clasificacion = round($cla_sum_avance / $cantidad_cursos_por_clasificacion);
        $arreglo_avances_clasificaciones[$contador_arreglo_clasificaciones] = $avance_de_clasificacion;
        $contador_arreglo_clasificaciones++;
        $avance_cla = str_replace("{CLAS_IMG_NIVEL}", "img/" . $cla->imagennivel, $avance_cla);
        $avance_cla = str_replace("{CLAS_AVANCE}", $avance_de_clasificacion, $avance_cla);
        // $avance_cla = str_replace("{NOMBRE_CLASIFICACION}",$avance_de_clasificacion,$avance_cla);
        $avance_cla = str_replace("{NOMBRE_CLASIFICACION}", $cla->nombre_clasificacion, $avance_cla);
        if ($avance_de_clasificacion == 100) {
            $clase_estilo_img = "";
            $clase_estado_icono = "fas fa-check-squares";
            $clase_estado_estilo = "etiquetaPrograma-aprobado";
            $cla_estado = "Finalizada";
            // Aca inserto Poder por clasificacion
            InsertaPoder($rut, $id_empresa, $codigo_malla, $cla->id_clasificacion);
        }
        elseif ($avance_de_clasificacion < 100 and $avance_de_clasificacion > 0) {
            $clase_estilo_img = "img_bn_grasycale";
            $clase_estado_icono = "icon-note icons";
            $clase_estado_estilo = "etiquetaPrograma-proceso ";
            $cla_estado = "En Proceso";
        }
        else {
            $clase_estilo_img = "img_bn_grasycale";
            $clase_estado_icono = "far fa-times-circle";
            $clase_estado_estilo = "etiquetaPrograma-noiniciado ";
            $cla_estado = "No Iniciado";
        }
        $avance_cla = str_replace("{CLAS_ESTADO_ESTILO}", $clase_estado_estilo, $avance_cla);
        $avance_cla = str_replace("{CLAS_ESTADO_ICONO}", $clase_estado_icono, $avance_cla);
        $avance_cla = str_replace("{ESTILO_IMG_CLAS_AVANCE}", $clase_estilo_img, $avance_cla);
        $avance_cla = str_replace("{CLAS_ESTADO}", $cla_estado, $avance_cla);
        // VISTA AVANCE POR CLASIFICACION REAL POR OBJETO
        $html_cla = str_replace("{CANTIDAD_APROBADOS_MALLA}", $cantidad_cursos_aprobados_por_clasificacion, $html_cla);
        $html_cla = str_replace("{AVANCEMALLA}", "10", $html_cla);
        $html_cla = str_replace("{LISTADO_CURSOS_POR_CLASIFICACION}", ($total_cursos) , $html_cla);
        $html_cla = str_replace("{LISTADO_CURSOS_POR_CLASIFICACION_APROBADOS}", ($total_cursos_aprobados) , $html_cla);
        $html_cla = str_replace("{LISTADO_CURSOS_POR_CLASIFICACION_PENDIENTES}", ($total_cursos_pendientes) , $html_cla);
        $html_cla = str_replace("{LISTADO_CURSOS_POR_CLASIFICACION_ACTIVOS}", ($total_cursos_activos) , $html_cla);
        $html_cla = str_replace("{LISTADO_CURSOS_POR_CLASIFICACION_INACTIVOS}", ($total_cursos_inactivos) , $html_cla);
        // echo "<br /><br />hola cantidad_cursos_aprobados_por_clasificacion $cantidad_cursos_aprobados_por_clasificacion , cursos clasificacion $cantidad_cursos_por_clasificacion";
        // echo "<br />$acumula_avance_curso $acumula_cursos";
        $html_cla = str_replace("{APROBACION_CURSOS_PROGRAMA}", round(($cantidad_cursos_aprobados_por_clasificacion * 100) / $cantidad_cursos_por_clasificacion) . "%", $html_cla);
        $total_clasificaciones.= $html_cla;
        $avance_clasificaciones.= $avance_cla;
        $i++;
        if ($classrow) {
            if ($i == $classrow) {
                $total_clasificaciones.= "<div class='row'></div>";
                $i = 0;
            }
        }
        else {
            if ($i == 2) {
                $total_clasificaciones.= "<div class='row'></div>";
                $i = 0;
            }
        }
    }
    // en este arreglo, tengotodos los datos de los avances porclasificacion
    $arreglo_con_avances2 = $arreglo_avances_clasificaciones;
    // aca los ordeno de manera descendente. Si el primero es 0, implica que solo el primer queda abierto
    rsort($arreglo_con_avances2);
    $cont_2 = 1;
    $abierto = "";
    foreach($clasificaciones as $cla) {
        // echo $arreglo_avances_clasificaciones[$cont_2-2]." ".$arreglo_avances_clasificaciones[$cont_2-1]."<br /><br />";
        $id_clasificacion = $cla->id_clasificacion;
        if ($arreglo_con_avances2[0] == 0) {
            $abierto = 1;
        }
        // echo "<pre>";
        // print_r($arreglo_avances_clasificaciones);
        if ($cont_2 == $abierto) {
            // echo "{BLOQUE_JS_ABIERTO_CERRADO_".$id_clasificacion."}";exit;
            $total_clasificaciones = str_replace("{BLOQUE_JS_ABIERTO_CERRADO_" . $id_clasificacion . "}", "", $total_clasificaciones);
        }
        // echo $arreglo_avances_clasificaciones[$cont_2-1]."  ".$arreglo_avances_clasificaciones[$cont_2]." -<br />";
        if (($arreglo_avances_clasificaciones[$cont_2 - 2] == 100 && $arreglo_avances_clasificaciones[$cont_2 - 1] < 100) or ($arreglo_avances_clasificaciones[$cont_2 - 2] === "" && $arreglo_avances_clasificaciones[$cont_2 - 1] < 100)) {
            $total_clasificaciones = str_replace("{BLOQUE_JS_ABIERTO_CERRADO_" . $id_clasificacion . "}", "", $total_clasificaciones);
            $total_clasificaciones = str_replace("{LINK_ABRE_CIERRA_" . $id_clasificacion . "}", "show_hide" . $id_clasificacion, $total_clasificaciones);
        }
        else if ($arreglo_avances_clasificaciones[$cont_2 - 1] < 100 && $arreglo_avances_clasificaciones[$cont_2 - 1] > 0 && $arreglo_avances_clasificaciones[$cont_2] == 0) {
            $total_clasificaciones = str_replace("{BLOQUE_JS_ABIERTO_CERRADO_" . $id_clasificacion . "}", "", $total_clasificaciones);
            $total_clasificaciones = str_replace("{LINK_ABRE_CIERRA_" . $id_clasificacion . "}", "show_hide" . $id_clasificacion, $total_clasificaciones);
        }
        else {
            $total_clasificaciones = str_replace("{BLOQUE_JS_ABIERTO_CERRADO_" . $id_clasificacion . "}", '$(".slidingDiv' . $id_clasificacion . '").hide();', $total_clasificaciones);
            $total_clasificaciones = str_replace("{LINK_ABRE_CIERRA_" . $id_clasificacion . "}", "", $total_clasificaciones);
        }
        $cont_2++;
    }
}
// echo "$cla_sum_avance_total $cla_cantidad_cursos_por_clasificacion_total";
$avance_real = round($cla_sum_avance_total / $cla_cantidad_cursos_por_clasificacion_total);
$lms_medalla_tips = lms_medalla_tips($rut, $id_empresa);
$avance_real_malla = round(100 * $acumula_avance_curso / $acumula_cursos / 100);
// $PRINCIPAL = str_replace("{NUMERO_AVANCE_REAL}",$avance_real_malla,$PRINCIPAL);
$PRINCIPAL = str_replace("{NUMERO_AVANCE_REAL}", $avance_real_malla, $PRINCIPAL);
$PRINCIPAL = str_replace("{LMS_NUM_TIPS}", $lms_medalla_tips[0]->cuentatips, $PRINCIPAL);
$PRINCIPAL = str_replace("{LMS_NUM_MEDALLAS}", $lms_medalla_tips[0]->cuentamedallas, $PRINCIPAL);
$PRINCIPAL = str_replace("{ROW_CURSOS_RESUMENES2}", $resumen_niveles_curso, $PRINCIPAL);
$PRINCIPAL = str_replace("{APROBACION_CURSOS_PROGRAMA}", round(($cantidad_cursos_aprobados_por_clasificacion * 100) / $cantidad_cursos_por_clasificacion) , $PRINCIPAL);
$PRINCIPAL = str_replace("{NUM_INSCRIPCIONES}", ($numero_cursos_total_up) , $PRINCIPAL);
$PRINCIPAL = str_replace("{NUM_CURSOS}", ($numero_cursos_total_desdemalla_up) , $PRINCIPAL);
$PRINCIPAL = str_replace("{ROWS_CLASIFICACIONES}", ($total_clasificaciones) , $PRINCIPAL);
$PRINCIPAL = str_replace("{ROWS_CLASIFICACIONES_ACTIVOS}", ($total_cursos_activos) , $PRINCIPAL);
$PRINCIPAL = str_replace("{ROWS_CLASIFICACIONES_INACTIVOS}", ($total_cursos_inactivos) , $PRINCIPAL);
// echo $total_clasificaciones;
$PRINCIPAL = str_replace("{BLOQUE_AVANCE_CLASIFICACIONES}", ($avance_clasificaciones) , $PRINCIPAL);
if ($tipo_llamada == "admin") {
    $arreglo[0] = $PRINCIPAL;
    $arreglo[1] = $porcentaje_avance_por_usuario;
    $arreglo[2] = $datos_usuario_para_admin;
    // Numero de cursos
    $arreglo[3] = $numero_cursos_total_desdemalla_up;
    // echo "<br /> 11588";
    // print_r($arreglo);
    return ($arreglo);
}
elseif ($tipo_llamada == "avance") {
    $arreglo = $avance_real_malla;
    return ($arreglo);
}
else {
    return ($PRINCIPAL);
}

}
function ListadoObjetosCapacitacionSecuencial2017($PRINCIPAL, $id_curso, $rut, $tipo, $id_inscripcion, $id_empresa, $id_template, $back_home, $im, $id_programa, $id_nivel)
{
    //echo "<br><br><br>$id_curso, $rut, $tipo, $id_inscripcion, $id_empresa, $id_template, $back_home, $im, $id_programa, $id_nivel";
    $objetos = ObjetosDadoCurso($id_curso, $rut);
    //print_r($objetos);
    if ($id_template <> '') {
        $template = "" . $id_template;
    } else {
        $template = "";
    }
    //echo $template;
    foreach ($objetos as $unico) {
        //Primero verifico si la anterior esta finalizada y todo esto solo si es mayor a 1
        if ($unico->fecha_finalizacion) {
            $fila = file_get_contents("views/cursos/" . $id_empresa . "_row_objeto" . $template . "_finalizado.html");
        } else {
            //Primero vei si tiene objeto anterion utilizando el campo orden
            $numero_anterior = $unico->orden - 1;
            if ($numero_anterior === 0) {
                $fila = file_get_contents("views/cursos/" . $id_empresa . "_row_objeto" . $template . ".html");
            } else {
                $objeto_anterior_finalizado = VerificoObjetoAnteriorFinalizado($rut, $id_curso, $numero_anterior);
                if ($objeto_anterior_finalizado) {
                    $fila = file_get_contents("views/cursos/" . $id_empresa . "_row_objeto" . $template . ".html");
                } else {
                    $fila = file_get_contents("views/cursos/" . $id_empresa . "_row_objeto" . $template . "_pendiente.html");
                }
            }
        }
        $fila        = str_replace("{TIEMPOMODULO_O_NUM_PREGUNTAS}", "", $fila);
        $fila        = str_replace("{NOMBRE_OBJETO}", ($unico->titulo), $fila);
        $fila        = str_replace("{TIPO_OBJETO}", $unico->tipo_objeto, $fila);
        $fila        = str_replace("{CLASE_ICONO}", $unico->icono, $fila);
        $fila        = str_replace("{BAJADA1}", $unico->bajada, $fila);
        $fila        = str_replace("{BAJADA2}", $unico->texto_bajada, $fila);
        $fila        = str_replace("{TEXTO_BAJADA}", $unico->texto_bajada, $fila);
        $fila        = str_replace("{IMAGEN_MODULO}", "img/" . $unico->imagen, $fila);
        $fila        = str_replace("{IMAGEN_MODULO_ACTIVO}", "img/" . $unico->imagen . "_activo.png", $fila);
        $fila        = str_replace("{IMAGEN_MODULO_PASIVO}", "img/" . $unico->imagen . "_desactivo.png", $fila);
        $fila        = str_replace("{IMAGEN_MODULO_VISTO}", "img/" . $unico->imagen . "_visto.png", $fila);
        $fila        = str_replace("{IMAGEN_MODULO_DINAMICO}", "" . $unico->imagen, $fila);
        $fila        = str_replace("{IMAGEN_TEXTOMODULO}", $unico->imagentexto, $fila);
        $fila        = str_replace("{PORC_AVANC}", $porcentaje_Avance_de_Este_modulo . "%", $fila);
        $fila        = str_replace("{AMBIENTE}", $unico->ambiente, $fila);
        $fila        = str_replace("{ID_OBJETO_ENCODEADO}", Encodear3($unico->id), $fila);
        $fila        = str_replace("{ID_OBJETO}", ($unico->id), $fila);
        $fila        = str_replace("{RUT_MOODLE}", $rut, $fila);
        $fila        = str_replace("{PASS_MOODLE}", "Gop.123456", $fila);
        $fila        = str_replace("{ID_MOODLE}", $unico->idmoodle, $fila);
        $fila        = str_replace("{CURRENTORG}", $unico->currentorg, $fila);
        $fila        = str_replace("{SCOID}", $unico->scoid, $fila);
        $fila        = str_replace("{CM}", $unico->cm, $fila);
        $fila        = str_replace("{ACTION}", $unico->urlmoodle, $fila);
        $rut_enc_md5 = md5($rut);
        $fila        = str_replace("{RUT_ENC_MD5}", $rut_enc_md5, $fila);
        $estado      = EstadoObjeto($unico->id, $rut);
        //Estados
        if ($estado[1] == "si") {
            $total_finalizados++;
        }
        $fila = str_replace("{ICONO_ESTADO}", $estado[0], $fila);
        if ($unico->total_tiempo) {
            $fila = str_replace("{TIEMPO_NAVEGACION}", "<i class='fa fa-clock-o'></i>&nbsp;" . $unico->total_tiempo, $fila);
        } else if ($unico->nota_objeto >= "0") {
            $aprobado_reprobado = ApruebaReprueba($unico->nota_objeto);
            $fila               = str_replace("{TIEMPO_NAVEGACION}", "<img width='20%' src='img/" . $aprobado_reprobado[1] . "'>
<span ><br><b>Nota: " . number_format($unico->nota_objeto, 0) . "%</b></span>
", $fila);
        } else {
            $fila = str_replace("{TIEMPO_NAVEGACION}", "", $fila);
        }
        if ($unico->nota_objeto >= "0") {
            $total_notas++;
            $acum_notas = $acum_notas + $unico->nota_objeto;
        }
        $total_html .= $fila;
    }
    if ($total_notas > 0) {
        $PRINCIPAL = str_replace("{PROMEDIO_NOTAS_POR_CURSO}", number_format($acum_notas / $total_notas, 0), $PRINCIPAL);
    } else {
        $PRINCIPAL = str_replace("{PROMEDIO_NOTAS_POR_CURSO}", "0", $PRINCIPAL);
    }
    $porcentaje_avance_curso = (100 * $total_finalizados) / count($objetos);
    $PRINCIPAL               = str_replace("{PORCENTAJE_AVANCE_CURSO}", number_format($porcentaje_avance_curso, 0), $PRINCIPAL);
    $PRINCIPAL               = str_replace("{LISTADO_OBJETOS_SECUENCIAL}", ($total_html), $PRINCIPAL);
    $detalle_curso           = DetalleCurso($id_curso);
    $PRINCIPAL               = str_replace("{NOMBRE_CURSO}", ($detalle_curso[0]->nombre), $PRINCIPAL);
    $PRINCIPAL               = str_replace("{CANTIDAD_OBJETOS}", count($objetos), $PRINCIPAL);
    //Total NAvegacion por Curso.
    $navegacion_por_curso    = SumaNavegacionesDadoRutYCurso($rut, $id_curso);
    $PRINCIPAL               = str_replace("{TOTAL_NAVEGACION_CURSO}", $navegacion_por_curso[0]->total_tiempo, $PRINCIPAL);
    return ($PRINCIPAL);
}
function ListadoObjetosCapacitacionCert2017($PRINCIPAL, $id_curso, $rut, $tipo, $id_inscripcion, $id_empresa, $id_template, $back_home, $im, $id_programa, $id_nivel)
{
    //echo $id_inscripcion."<br>";
    //echo "<br><br><br>$id_curso, $rut, $tipo, $id_inscripcion, $id_empresa, $id_template, $back_home, $im, $id_programa, $id_nivel";
    $objetos = ObjetosDadoCurso($id_curso, $rut);
    //print_r($objetos);
    if ($id_template <> '') {
        $template = "" . $id_template;
    } else {
        $template = "";
    }
    //echo $template;

    foreach ($objetos as $unico) {
        //echo "views/cursos/" . $id_empresa . "_row_objeto" . $template . ".html";exit;
        //Primero verifico si la anterior esta finalizada y todo esto solo si es mayor a 1
        $esta_en_cierre=EstaEnInscripcionCierreConImparticion($rut, $id_curso, $id_empresa, $id_inscripcion);
        if($esta_en_cierre){
            //$fila = file_get_contents("views/cursos/" . $id_empresa . "_row_objeto" . $template . "_cert_finalizada.html");
            $fila = file_get_contents("views/cursos/" . $id_empresa . "_row_objeto" . $template . ".html");
        }else{
            $fila = file_get_contents("views/cursos/" . $id_empresa . "_row_objeto" . $template . ".html");
        }


        if ($unico->extension_objeto == "zip") {

            $fila = file_get_contents("views/cursos/" . $id_empresa . "_row_objeto_zip" . $template . ".html");
        }
        if ($unico->extension_objeto == "boost") {
            $fila = file_get_contents("views/cursos/" . $id_empresa . "_row_objeto_boost" . $template . ".html");
        }
        if ($unico->opcional == 1 or $unico->opcional == 2) {
            $fila = file_get_contents("views/cursos/" . $id_empresa . "_row_objeto_desactivado" . $template . ".html");
        }
        if ($unico->tipo_de_objeto == "3") {
            $fila = str_replace("{TIEMPOMODULO_O_NUM_PREGUNTAS}", $unico->duracion_video, $fila);
        } else if ($unico->tipo_de_objeto == "5") {
            $fila = str_replace("{TIEMPOMODULO_O_NUM_PREGUNTAS}", "<b>Cantidad Preguntas: " . $unico->total_preguntas_por_objeto . "</b>", $fila);
        }
        $fila        = str_replace("{TIEMPOMODULO_O_NUM_PREGUNTAS}", "", $fila);
        $fila        = str_replace("{NOMBRE_OBJETO}", ($unico->titulo), $fila);
        $fila        = str_replace("{TIPO_OBJETO}", $unico->tipo_objeto, $fila);
        $fila        = str_replace("{CLASE_ICONO}", $unico->icono, $fila);
        $fila        = str_replace("{BAJADA1}", $unico->bajada, $fila);
        $fila        = str_replace("{BAJADA2}", $unico->texto_bajada, $fila);
        $fila        = str_replace("{TEXTO_BAJADA}", $unico->texto_bajada, $fila);
        $fila        = str_replace("{IMAGEN_MODULO}", "img/" . $unico->imagen, $fila);
        $fila        = str_replace("{IMAGEN_MODULO_ACTIVO}", "img/" . $unico->imagen . "_activo.png", $fila);
        $fila        = str_replace("{IMAGEN_MODULO_PASIVO}", "img/" . $unico->imagen . "_desactivo.png", $fila);
        $fila        = str_replace("{IMAGEN_MODULO_VISTO}", "img/" . $unico->imagen . "_visto.png", $fila);
        $fila        = str_replace("{IMAGEN_MODULO_DINAMICO}", "" . $unico->imagen, $fila);
        $fila        = str_replace("{IMAGEN_TEXTOMODULO}", $unico->imagentexto, $fila);
        $fila        = str_replace("{PORC_AVANC}", $porcentaje_Avance_de_Este_modulo . "%", $fila);
        $fila        = str_replace("{AMBIENTE}", $unico->ambiente, $fila);
        $fila        = str_replace("{ID_OBJETO_ENCODEADO}", Encodear3($unico->id), $fila);
        $fila        = str_replace("{ID_OBJETO}", ($unico->id), $fila);
        $fila        = str_replace("{RUT_MOODLE}", $rut, $fila);
        $fila        = str_replace("{PASS_MOODLE}", "Gop.123456", $fila);
        $fila        = str_replace("{ID_MOODLE}", $unico->idmoodle, $fila);
        $fila        = str_replace("{CURRENTORG}", $unico->currentorg, $fila);
        $fila        = str_replace("{SCOID}", $unico->scoid, $fila);
        $fila        = str_replace("{CM}", $unico->cm, $fila);
        $fila        = str_replace("{ACTION}", $unico->urlmoodle, $fila);
        $rut_enc_md5 = md5($rut);
        $fila        = str_replace("{RUT_ENC_MD5}", $rut_enc_md5, $fila);
        $estado      = EstadoObjeto($unico->id, $rut);
        //Estados
        if ($estado[1] == "si") {
            $total_finalizados++;
        }
        $fila = str_replace("{ICONO_ESTADO}", $estado[0], $fila);
        if ($unico->total_tiempo) {
            $fila = str_replace("{TIEMPO_NAVEGACION}", "<i class='fa fa-clock-o'></i>&nbsp;" . $unico->total_tiempo, $fila);
        } else if ($unico->nota_objeto >= "0") {
            $aprobado_reprobado = ApruebaReprueba($unico->nota_objeto);
            $fila               = str_replace("{TIEMPO_NAVEGACION}", "<img width='20%' src='img/" . $aprobado_reprobado[1] . "'>
<span ><br><b>Nota: " . number_format($unico->nota_objeto, 0) . "%</b></span>
", $fila);
        } else {
            $fila = str_replace("{TIEMPO_NAVEGACION}", "", $fila);
        }
        if ($unico->nota_objeto >= "0") {
            $total_notas++;
            $acum_notas = $acum_notas + $unico->nota_objeto;
        }
        $total_html .= $fila;
    }
    if ($total_notas > 0) {
        $PRINCIPAL = str_replace("{PROMEDIO_NOTAS_POR_CURSO}", number_format($acum_notas / $total_notas, 0), $PRINCIPAL);
    } else {
        $PRINCIPAL = str_replace("{PROMEDIO_NOTAS_POR_CURSO}", "0", $PRINCIPAL);
    }
    $porcentaje_avance_curso = (100 * $total_finalizados) / count($objetos);
    $PRINCIPAL               = str_replace("{PORCENTAJE_AVANCE_CURSO}", number_format($porcentaje_avance_curso, 0), $PRINCIPAL);
    $PRINCIPAL               = str_replace("{LISTADO_OBJETOS}", ($total_html), $PRINCIPAL);
    $detalle_curso           = DetalleCurso($id_curso);
    $PRINCIPAL               = str_replace("{NOMBRE_CURSO}", ($detalle_curso[0]->nombre), $PRINCIPAL);
    $PRINCIPAL               = str_replace("{CANTIDAD_OBJETOS}", count($objetos), $PRINCIPAL);
    //Total NAvegacion por Curso.
    $navegacion_por_curso    = SumaNavegacionesDadoRutYCurso($rut, $id_curso);
    $PRINCIPAL               = str_replace("{TOTAL_NAVEGACION_CURSO}", $navegacion_por_curso[0]->total_tiempo, $PRINCIPAL);
    return ($PRINCIPAL);
}
function ColocaDatosMallaCapacitacion_vr($PRINCIPAL, $rut, $id_empresa, $id_clasificacion, $tipo_llamada, $filtro_desde_admin, $opcional, $tipo_reporte_desde_admin, $id_malla)
{
    //echo "$rut, $id_empresa";
    $datos_empresa = DatosEmpresa($id_empresa);
    list($total_inscripciones, $total_aprobados, $total_reprobados, $total_en_proceso) = CAPACITACION_DatosGeneralesPorUsuario($rut, $filtro_desde_admin);
    $PRINCIPAL               = str_replace("{BLOQUE_DATOS_PERSONALES}", file_get_contents("views/cursos/capacitacion/" . $id_empresa . "_mi_perfil_bloque_datos.html"), $PRINCIPAL);
    $datos_colaborador       = UsuarioEnBasePersonas($rut);
    $PRINCIPAL               = str_replace("{NOMBRE_USUARIO}", ($datos_colaborador[0]->nombre_completo), $PRINCIPAL);
    $PRINCIPAL               = str_replace("{CARGO}", ($datos_colaborador[0]->cargo), $PRINCIPAL);
    $PRINCIPAL               = str_replace("{EMAIL}", ($datos_colaborador[0]->email), $PRINCIPAL);
    $PRINCIPAL               = str_replace("{TELEFONO}", ($datos_colaborador[0]->telefono), $PRINCIPAL);
    $PRINCIPAL               = str_replace("{URL_IMAGEN}", (VerificaFotoPersonal($datos_colaborador[0]->rut)), $PRINCIPAL);
    $datos_malla             = CAPACITACION_malla_porUsuario($rut, $id_malla);
    //GAMIFICACION_ActualizaNivel($datos_malla[0]->id_malla, $id_empresa, $rut);
    $datos_puntos_acumulados = GAMIFICACIONTienePuntosAcumuladosPorRutEmpresa($rut, $id_empresa, $filtro_desde_admin);
    //print_r($datos_malla);
    $nivel_actual            = $datos_puntos_acumulados[0]->numnivel;
    $estado                  = EntregaEstadoAvanceBarraMalla(EntregaPorcentaje($total_inscripciones, $total_aprobados));
    if (!$tipo_llamada) {
        $PRINCIPAL = ColocarRankingUsuariosPorPuntos($PRINCIPAL, $id_empresa, $datos_malla[0]->id_malla);
    }
    //Funcionalidad para Asignar Niveles  a Cursos
    if ($tipo_llamada) {
        $datos_usuario_para_admin = ColocaDatosCampusPuntos($PRINCIPAL, $rut, $id_empresa, $tipo_llamada, $filtro_desde_admin);
    } else {
        $PRINCIPAL = ColocaDatosCampusPuntos($PRINCIPAL, $rut, $id_empresa, $tipo_llamada, "");
    }
    if ($datos_malla) {
        /*if($id_empresa==52){
        }else{
        $PRINCIPAL = str_replace("{BLOQUE_TITULO_MALLA}",file_get_contents("views/cursos/capacitacion/titulo_nombre_malla.html"),$PRINCIPAL);
        }*/
        if ($id_clasificacion) {
            if (file_exists("views/cursos/capacitacion/" . $id_empresa . "_titulo_nombre_malla.html")) {
                $PRINCIPAL = str_replace("{BLOQUE_TITULO_MALLA}", file_get_contents("views/cursos/capacitacion/" . $id_empresa . "_vr_titulo_avance_malla.html"), $PRINCIPAL);
            } else {
                $PRINCIPAL = str_replace("{BLOQUE_TITULO_MALLA}", file_get_contents("views/cursos/capacitacion/vr_titulo_nombre_malla.html"), $PRINCIPAL);
            }
            //$PRINCIPAL = str_replace("{BLOQUE_TITULO_MALLA}",file_get_contents("views/cursos/capacitacion/".$id_empresa."_titulo_nombre_malla.html"),$PRINCIPAL);
        } else {
            if (file_exists("views/cursos/capacitacion/" . $id_empresa . "_titulo_nombre_malla_sin_imagen.html")) {
                $PRINCIPAL = str_replace("{BLOQUE_TITULO_MALLA}", file_get_contents("views/cursos/capacitacion/" . $id_empresa . "_vr_titulo_nombre_malla_sin_imagen.html"), $PRINCIPAL);
            } else {
                $PRINCIPAL = str_replace("{BLOQUE_TITULO_MALLA}", file_get_contents("views/cursos/capacitacion/vr_titulo_nombre_malla_sin_imagen.html"), $PRINCIPAL);
            }
        }
        if (!$id_clasificacion) {
            $PRINCIPAL = str_replace("{DESCRIPCION_CLASIFICACION}", ($datos_malla[0]->descripcion_malla), $PRINCIPAL);
        }
        $PRINCIPAL                 = str_replace("{NOMBRE_MALLA}", ($datos_malla[0]->nombre_malla), $PRINCIPAL);
        $datos_clasificacion_unica = DatosClasificacionPorCurso($id_clasificacion, $id_empresa);
        $PRINCIPAL                 = str_replace("{NOMBRE_CLASIFICACION}", "- " . ($datos_clasificacion_unica[0]->nombre_clasificacion), $PRINCIPAL);
        $PRINCIPAL                 = str_replace("{DESCRIPCION__MALLA}", $datos_malla[0]->descripcion_malla, $PRINCIPAL);
        $PRINCIPAL                 = str_replace("{BLOQUE_CURSOS_PENDIENTES}", BloqueCursosPendientes(file_get_contents("views/cursos/capacitacion/titulo_cursos_pendientes_malla.html"), $rut, $datos_malla->id_malla), $PRINCIPAL);
        if (file_exists("views/cursos/capacitacion/" . $id_empresa . "_titulo_avance_malla.html")) {
            $PRINCIPAL = str_replace("{BLOQUE_AVANCE_MALLA}", file_get_contents("views/cursos/capacitacion/" . $id_empresa . "_titulo_avance_malla.html"), $PRINCIPAL);
        } else {
            $PRINCIPAL = str_replace("{BLOQUE_AVANCE_MALLA}", file_get_contents("views/cursos/capacitacion/titulo_avance_malla.html"), $PRINCIPAL);
        }
        $PRINCIPAL = OtrosCursosRealizados($PRINCIPAL, $rut, $datos_malla[0]->id_malla);
    } else {
        $PRINCIPAL = str_replace("{BLOQUE_TITULO_MALLA}", "", $PRINCIPAL);
        $PRINCIPAL = str_replace("{BLOQUE_CURSOS_PENDIENTES}", "", $PRINCIPAL);
        $PRINCIPAL = str_replace("{BLOQUE_AVANCE_MALLA}", "", $PRINCIPAL);
        //$PRINCIPAL = str_replace("{BLOQUE_OTROS_CURSOS_REALIZADOS}",file_get_contents("views/cursos/capacitacion/titulo_otros_cursos_realizados_malla.html"),$PRINCIPAL);
        $PRINCIPAL = OtrosCursosRealizados($PRINCIPAL, $rut, $datos_malla[0]->id_malla);
    }
    $PRINCIPAL                     = str_replace("{NUMERO_AVANCE}", round(EntregaPorcentaje($total_inscripciones, $total_aprobados)), $PRINCIPAL);
    //$porcentaje_avance_por_usuario=round(EntregaPorcentaje($total_inscripciones, $total_aprobados));
    $porcentaje_avance_por_usuario = $datos_puntos_acumulados[0]->avanceobjetos;
    //si no tiene avance por objetos ve si hay avance por curso
    if ($porcentaje_avance_por_usuario == 0) {
        $porcentaje_avance_por_usuario = 100 * $datos_puntos_acumulados[0]->avancecurso;
    }
    //echo "<br>2932 ".$estado[0]." / ".$estado_por_curso[3];
    $PRINCIPAL    = str_replace("{COLOR_PROGRESS_BAR}", $estado[0], $PRINCIPAL);
    $PRINCIPAL    = str_replace("{TOTAL_APROBADOS}", $total_aprobados, $PRINCIPAL);
    $PRINCIPAL    = str_replace("{TOTAL_REPROBADOS}", $total_reprobados, $PRINCIPAL);
    $PRINCIPAL    = str_replace("{TOTAL_EN_PROCESO}", $total_en_proceso, $PRINCIPAL);
    $PRINCIPAL    = str_replace("{TOTAL_NO_INICIADOS}", $total_inscripciones - ($total_aprobados + $total_reprobados + $total_en_proceso), $PRINCIPAL);
    //TRaigo la malla del usuario
    $codigo_malla = $datos_malla[0]->id_malla;
    //echo $codigo_malla;
    //Con el id malla, traigo las clasificaciones
    //$clasificaciones=CAPACITACION_clasificacionesPorMallaRut($rut, $codigo_malla);
    //Voy a  pasar el id de clasificacion, esto es para cuando se quiere mostrar solo los cursos de una clasificacion.
    //        echo "opcional $opcional";
    if ($tipo_reporte_desde_admin <> "detallado") {
        if ($opcional == 1) {
            $clasificaciones = CAPACITACION_clasificacionesPorMallaClasificacionOpcional($codigo_malla, $id_empresa, $id_clasificacion);
        } else {
            $clasificaciones = CAPACITACION_clasificacionesPorMalla($codigo_malla, $id_empresa, $id_clasificacion);
        }
        //    print_r($clasificaciones);
        if (count($clasificaciones) == 0) {
            //Voy a  pasar el id de clasificacion, esto es para cuando se quiere mostrar solo los cursos de una clasificacion.
            $clasificaciones = CAPACITACION_clasificacionesPorInscripcionUsuario($rut, $id_clasificacion);
            //echo "hola np";
            //print_r($clasificaciones);
        }
    }
    //print_r($clasificaciones);
    if ($tipo_reporte_desde_admin <> "detallado") {
        $total_clasificaciones          = "";
        $i                              = 0;
        $numero_cursos_total            = 0;
        $PRINCIPAL                      = str_replace("{NUM_CLASIFICACIONES}", count($clasificaciones), $PRINCIPAL);
        $clasificaciones_entorno        = file_get_contents("views/cursos/capacitacion/" . $id_empresa . "_vr_row_programas_capacitacion.html");
        $curso_entorno                  = file_get_contents("views/cursos/capacitacion/" . $id_empresa . "_vr_row_cursos_por_programas_capacitacion.html");
        $classrow                       = 3;
        $avance_clasificaciones_entorno = file_get_contents("views/cursos/capacitacion/" . $id_empresa . "_vr_row_avance_clasificacion.html");
        if (count($clasificaciones) == 1) {
            //echo "hola1";
            $clasificaciones_entorno = file_get_contents("views/cursos/capacitacion/" . $id_empresa . "_vr_row_programas_capacitacion_unico.html");
            $curso_entorno           = file_get_contents("views/cursos/capacitacion/" . $id_empresa . "_vr_row_cursos_por_programas_capacitacion_unico.html");
            $PRINCIPAL               = str_replace("{DESCRIPCION_CLASIFICACION}", ($clasificaciones[0]->descripcion_clasificacion), $PRINCIPAL);
            $PRINCIPAL               = str_replace("{IMAGEN_CLASIFICACION}", ($clasificaciones[0]->imagen), $PRINCIPAL);
            $PRINCIPAL               = str_replace("{COLOR_CLASIFICACION}", ($clasificaciones[0]->color), $PRINCIPAL);
        }
        if ($id_clasificacion) {
            $clasificaciones_entorno        = file_get_contents("views/cursos/capacitacion/" . $id_empresa . "_vr_row_programas_capacitacion_unico.html");
            $curso_entorno                  = file_get_contents("views/cursos/capacitacion/" . $id_empresa . "_vr_row_cursos_por_programas_capacitacion_unico.html");
            $avance_clasificaciones_entorno = file_get_contents("views/cursos/capacitacion/" . $id_empresa . "_vr_row_avance_clasificacion.html");
        }
    }
    if ($tipo_reporte_desde_admin <> "detallado") {
        $con_row                          = 1;
        $contador_arreglo_clasificaciones = 0;
        foreach ($clasificaciones as $cla) {
            //$html_cla=file_get_contents("views/cursos/row_programas_capacitacion.html");
            $html_cla   = $clasificaciones_entorno;
            $avance_cla = $avance_clasificaciones_entorno;
            //$html_cla = str_replace("{ID_CLASIFICACION}",$cla->clasificacion,$html_cla);
            //print_r($cla);
            if ($cla->inactivo == 1) {
                $html_cla = str_replace("{LINK}", "", $html_cla);
                $html_cla = str_replace("{CLASSIMGBCK}", "img_bn_grasycale", $html_cla);
            } else {
                $html_cla = str_replace("{LINK}", "<a href='?sw=CurXClas&icl={ID_CLASIFICACION_ENCODEADO}'>", $html_cla);
                $html_cla = str_replace("{CLASSIMGBCK}", "", $html_cla);
            }
            $html_cla                             = str_replace("{LINK}", $cla->id_clasificacion, $html_cla);
            $html_cla                             = str_replace("{CLASSIMGBCK}", $cla->id_clasificacion, $html_cla);
            $html_cla                             = str_replace("{ID_CLASIFICACION}", $cla->id_clasificacion, $html_cla);
            $html_cla                             = str_replace("{ID_CLASIFICACION_ENCODEADO}", Encodear3($cla->id_clasificacion), $html_cla);
            $avance_cla                           = str_replace("{ID_CLASIFICACION}", $cla->id_clasificacion, $avance_cla);
            $avance_cla                           = str_replace("{ID_CLASIFICACION_ENCODEADO}", Encodear3($cla->id_clasificacion), $avance_cla);
            $html_cla                             = str_replace("{NOMBRE_CLASIFICACION}", $cla->nombre_clasificacion . "", $html_cla);
            $html_cla                             = str_replace("{DESCRIPCION_CLASIFICACION}", $cla->descripcion_clasificacion, $html_cla);
            $html_cla                             = str_replace("{IMAGEN_NIVEL_CLASIFICACION}", $cla->imagennivel, $html_cla);
            $html_cla                             = str_replace("{TEXTO_NIVEL_CLASIFICACION}", $cla->textonivel, $html_cla);
            $html_cla                             = str_replace("{DESCRIPCION_NIVEL_CLASIFICACION}", $cla->descripcionnivel, $html_cla);
            $html_cla                             = str_replace("{COLOR2}", $cla->color2, $html_cla);
            $html_cla                             = str_replace("{COLOR}", $cla->color, $html_cla);
            $html_cla                             = str_replace("{IMAGEN_BACK}", $cla->imagen_back, $html_cla);
            $html_cla                             = str_replace("{IMAGEN}", $cla->imagen, $html_cla);
            //Por cada clasificacion, traigo los cursos
            $cursos_por_clasificacion             = CAPACITACION_cursosPorClasificacion($rut, $codigo_malla, $cla->id_clasificacion);
            //$cursos_por_clasificacion_desde_malla=CAPACITACION_cursosPorClasificacionMalla($codigo_malla, $cla->clasificacion, $filtro_desde_admin);
            $cursos_por_clasificacion_desde_malla = CAPACITACION_cursosPorClasificacionMalla($codigo_malla, $cla->id_clasificacion, $filtro_desde_admin);
            //$avance_cursos_por_clasificacion_desde_malla=CAPACITACION_cursosPorClasificacionMalla($codigo_malla, $cla->id_clasificacion, $filtro_desde_admin);
            //echo "<br>".count($cursos_por_clasificacion_desde_malla);
            if (count($cursos_por_clasificacion_desde_malla) == 0) {
                $cursos_por_clasificacion_desde_malla = CAPACITACION_cursosPorClasificacionRut($rut, $cla->id_clasificacion);
            }
            $html_cla                                    = str_replace("{CANTIDAD_CURSOS}", count($cursos_por_clasificacion), $html_cla);
            $html_cla                                    = str_replace("{CANTIDAD_CURSOS_MALLA}", count($cursos_por_clasificacion_desde_malla), $html_cla);
            $total_cursos                                = "";
            $cantidad_cursos_aprobados_por_clasificacion = 0;
            foreach ($cursos_por_clasificacion as $curso_unico) {
                $numero_cursos_total_up++;
            }
            foreach ($cursos_por_clasificacion_desde_malla as $curso_unico) {
                $numero_cursos_total_desdemalla_up++;
            }
            //    echo  "<br> cursos_por_clasificacion ".count($cursos_por_clasificacion). " , cursos_por_clasificacion_desde_malla ".count($cursos_por_clasificacion_desde_malla);
            if (count($cursos_por_clasificacion) >= count($cursos_por_clasificacion_desde_malla)) {
                //si num cursos es inferior a inscripciones
                $contador_div_rows = 1;
                foreach ($cursos_por_clasificacion as $curso_unico) {
                    $numero_cursos_total++;
                    //$row_curso=file_get_contents("views/cursos/row_cursos_por_programas_capacitacion.html");
                    //$row_curso=$curso_entorno;
                    $row_curso = str_replace("{ID_CURSO}", $curso_unico->id_curso, $row_curso);
                    $row_curso = str_replace("{NOMBRE_CURSO}", $curso_unico->nombre_curso . "aca", $row_curso);
                    $row_curso = str_replace("{FECHA_INICIO}", $curso_unico->fecha_inicio_insc, $row_curso);
                    $row_curso = str_replace("{IMAGEN}", $curso_unico->imagen, $row_curso);
                    $row_curso = str_replace("{DESCRIPCION_CURSO}", $curso_unico->descripcion_curso, $row_curso);
                    $row_curso = str_replace("{DESCRIPTOR_CURSO}", $curso_unico->descriptor_curso, $row_curso);
                    $row_curso = str_replace("{FECHA_TERMINO}", $curso_unico->fecha_termino_insc, $row_curso);
                    $row_curso = str_replace("{ASISTENCIA}", $curso_unico->porcentaje_asistencia, $row_curso);
                    if ($curso_unico->proveedor_curso == "OL") {
                        $tiempo     = time();
                        //print_r($curso_unico);
                        //echo "<br><br>";
                        //$id_curso_test="13HY13";
                        //echo "$rut - $tiempo - ".$curso_unico->codigo_curso." - ".$curso_unico->nombre_curso."<br>";
                        $string_var = encryptMoodleAula($rut . "||" . $tiempo . "||" . $curso_unico->codigo_curso, "");
                        //$string_var=encryptMoodleAula($rut."||".$tiempo."||".$id_curso_test, "");
                        //echo $string_var."<br>";
                        $string_var = encryptMoodleAula($rut . "||" . $tiempo . "||" . $id_curso_test, "");
                        //print_r($curso_unico);exit;
                        //echo $string_var;exit;
                        $row_curso  = str_replace("{LINK_CURSO}", '<a target="_blank"  href="http://aula.openl.cl/local/minvest/login.php?token=' . $string_var . '">', $row_curso);
                        //$row_curso = str_replace("{LINK_CURSO}",'<a href="javascript: alert(\'Curso Cerrado\');">',$row_curso);
                        $row_curso  = str_replace("{/LINK_CURSO}", '</a>', $row_curso);
                    } else if ($curso_unico->modalidad <> 2) {
                        $row_curso = str_replace("{LINK_CURSO}", '<a href="?sw=detalle_cursoCap&idc={ID_CURSO_ENCODEADO}&idinsc={ID_INSCRIPCION_ENCODEADO}">', $row_curso);
                        $row_curso = str_replace("{/LINK_CURSO}", '</a>', $row_curso);
                        $row_curso = str_replace("{LINK_CURSO_JUSTURL}", '?sw=detalle_cursoCap&idc={ID_CURSO_ENCODEADO}&idinsc={ID_INSCRIPCION_ENCODEADO}', $row_curso);
                    } else {
                        $row_curso = str_replace("{LINK_CURSO}", "", $row_curso);
                        $row_curso = str_replace("{/LINK_CURSO}", "", $row_curso);
                    }
                    //$row_curso = str_replace("{ID_CURSO_ENCODEADO}",Encodear3($curso_unico->id_curso),$row_curso);
                    $row_curso = str_replace("{ID_CURSO_ENCODEADO}", Encodear3($curso_unico->codigo_curso), $row_curso);
                    list($estado, $porcentaje_asistencia, $nota) = CAPACITACION_VE_ESTADO($rut, $curso_unico->codigo_curso, $curso_unico->id_inscripcion, $id_empresa);
                    $estado_por_curso = CAPACITACION_ObtenerEstadoAvanceCurso($rut, $curso_unico->codigo_curso, "", $id_empresa);
                    $row_curso        = str_replace("{ESTADO}", $estado_por_curso[0], $row_curso);
                    $row_curso        = str_replace("{ESTADO}", $estado_por_curso[1], $row_curso);
                    $row_curso        = str_replace("{VR_ICON_ESTADO}", $estado_por_curso[2], $row_curso);
                    //$row_curso = str_replace("{AVANCE_CURSO}",$estado_por_curso[3],$row_curso);
                    $row_curso        = str_replace("{AVANCE_CURSO}", $estado_por_curso[4], $row_curso);
                    $total_cursos .= $row_curso;
                }
            } else {
                $cantidad_cursos_por_clasificacion = 0;
                $cla_sum_avance                    = 0;
                //echo "NP";
                //si num cursos es igual o superior a inscripciones
                //print_r($cursos_por_clasificacion_desde_malla);
                $contador_div_rows                 = 1;
                foreach ($cursos_por_clasificacion_desde_malla as $curso_unico) {
                    //echo "<br>".$curso_unico->id_curso;
                    //echo "<br>";
                    //print_r($curso_unico);
                    //echo "<br>";
                    //$estado_por_curso=CAPACITACION_ObtenerEstadoAvanceCurso($rut, $curso_unico->codigo_curso, "", $id_empresa);
                    $estado_por_curso = CAPACITACION_ObtenerEstadoAvanceCurso($rut, $curso_unico->id_curso, "", $id_empresa);
                    //print_r($estado_por_curso);echo "<br>";
                    //echo $nivel_actual." - ".$curso_unico->numnivel."<br><br>";
                    //echo "$rut, ".$curso_unico->codigo_curso.", -, $id_empresa";
                    //echo "<br><br>";
                    //$curso_entorno=file_get_contents("views/cursos/capacitacion/".$id_empresa."_vr_row_cursos_por_programas_capacitacion_unico.html");
                    $numero_cursos_total_desdemalla++;
                    //$row_curso=file_get_contents("views/cursos/row_cursos_por_programas_capacitacion.html");
                    $row_curso         = $curso_entorno;
                    $row_curso         = str_replace("{NOMBRE_CURSO}", $curso_unico->nombre_curso . "", $row_curso);
                    $avances_cursos    = ColocaAvanceCursoPorPuntosDeObjetos($row_curso, $curso_unico->id_curso, $rut, $id_empresa);
                    $row_curso         = $avances_cursos[0];
                    $row_curso         = str_replace("{ID_CURSO}", $curso_unico->id_curso, $row_curso);
                    $row_curso         = str_replace("{IMAGEN_BACK}", $curso_unico->imagen_back, $row_curso);
                    $row_curso         = str_replace("{IMAGEN}", $curso_unico->imagen, $row_curso);
                    $row_curso         = str_replace("{DESCRIPCION_CURSO}", $curso_unico->descripcion_curso, $row_curso);
                    $row_curso         = str_replace("{DESCRIPTOR_CURSO}", $curso_unico->descriptor_curso, $row_curso);
                    $row_curso         = str_replace("{FECHA_INICIO}", $curso_unico->fecha_inicio_insc, $row_curso);
                    $row_curso         = str_replace("{FECHA_TERMINO}", $curso_unico->fecha_termino_insc, $row_curso);
                    $row_curso         = str_replace("{FECHA_TERMINO_INSC}", $curso_unico->fecha_termino, $row_curso);
                    $row_curso         = str_replace("{FECHA_INICIO_INSC}", $curso_unico->fecha_inicio, $row_curso);
                    $row_curso         = str_replace("{ASISTENCIA}", $curso_unico->porcentaje_asistencia, $row_curso);
                    //aca traigo el desafio del este curso
                    $desafio_por_curso = DesafioPorCurso2($curso_unico->id_curso, $id_empresa);
                    $contador_desafios = 0;
                    if ($desafio_por_curso) {
                        foreach ($desafio_por_curso as $desa_por_curso) {
                            $contador_desafios++;
                            $desafios_pendientes = ColocaNotificacionesBannerJefe($_SESSION["user_"], $id_empresa, $rut, $desa_por_curso->id, "listadoObjetos");
                            if ($desafios_pendientes) {
                                $row_curso = str_replace("{BLOQUE_NOTIFICACION}", file_get_contents("views/home/index_bci_capacitacionbci20_entorno_alertas.html"), $row_curso);
                                $row_curso = str_replace("{BLOQUE_BANNER_NOTIFICACIONES}", "", $row_curso);
                                $row_curso = str_replace("{BLOQUE_BANNER_NOTIFICACIONES_JEFE}", utf8_decode($desafios_pendientes), $row_curso);
                            } else {
                                $row_curso = str_replace("{BLOQUE_NOTIFICACION}", "", $row_curso);
                            }
                            $accion_pendiente        = TieneAccionesPEndientes($rut, $id_empresa, $desa_por_curso->id_curso, $desa_por_curso->id);
                            $esta_finalizado_desafio = EstaFinalizadoDesafio($rut, $desa_por_curso->id, $desa_por_curso->id_curso, $id_empresa);
                            if ($accion_pendiente[0]->estado == 1) {
                                //$row_curso = str_replace("{VE_DESAFIO}",file_get_contents("views/cursos/capacitacion/".$id_empresa."_boton_ve_desafios.html"),$row_curso);
                                $template_boton_desafios .= file_get_contents("views/cursos/capacitacion/" . $id_empresa . "_boton_ve_desafios.html") . "<br><br>";
                                if ($contador_desafios > 1) {
                                    $br = "<br>";
                                } else {
                                    $br = "";
                                }
                                if ($esta_finalizado_desafio) {
                                    $template_icono .= "$br<img src='img/lms_icons_aprobado.jpg' width='30'><br>";
                                } else {
                                    $template_icono .= "$br<img src='img/lms_icons_enproceso.png' width='30'><br>";
                                }
                                $nombre_desafios .= $br . "<span class='vr_titulo_desafio'>" . $desa_por_curso->titulo . "<br></span>";
                                $template_boton_desafios = str_replace("{ID_OBJETO_ENCODEADO}", Encodear3($desa_por_curso->id), $template_boton_desafios);
                                $template_boton_desafios = str_replace("{RUT_COLABORADOR_ENCODADO}", Encodear3($rut), $template_boton_desafios);
                            } else {
                                $template_boton_desafios = str_replace("{VE_DESAFIO}", "", $template_boton_desafios);
                                $template_boton_desafios = str_replace("{ICONO_ESTADO_DESAFIO}", "", $template_boton_desafios);
                            }
                        }
                        $row_curso = str_replace("{VE_DESAFIO}", $template_boton_desafios, $row_curso);
                        $row_curso = str_replace("{ICONO_ESTADO_DESAFIO}", $template_icono, $row_curso);
                        $row_curso = str_replace("{NOMBRE_DESAFIO}", $nombre_desafios, $row_curso);
                    } else {
                        $row_curso = str_replace("{VE_DESAFIO}", "", $row_curso);
                        $row_curso = str_replace("{ICONO_ESTADO_DESAFIO}", "", $row_curso);
                        $row_curso = str_replace("{BLOQUE_NOTIFICACION}", "", $row_curso);
                        $row_curso = str_replace("{NOMBRE_DESAFIO}", "", $row_curso);
                    }
                    /*
                    $desafios_pendientes=ColocaNotificacionesBannerJefe($_SESSION["user_"], $id_empresa, $rut, $desafio_por_curso[0]->id, "listadoObjetos");
                    if($desafios_pendientes){
                    $row_curso = str_replace("{BLOQUE_NOTIFICACION}",file_get_contents("views/home/index_bci_capacitacionbci20_entorno_alertas.html"),$row_curso);
                    $row_curso = str_replace("{BLOQUE_BANNER_NOTIFICACIONES}","",$row_curso);
                    $row_curso = str_replace("{BLOQUE_BANNER_NOTIFICACIONES_JEFE}",utf8_decode($desafios_pendientes),$row_curso);
                    }else{
                    $row_curso = str_replace("{BLOQUE_NOTIFICACION}","",$row_curso);
                    }
                    $accion_pendiente=TieneAccionesPEndientes($rut, $id_empresa, $desafio_por_curso[0]->id_curso, $desafio_por_curso[0]->id);
                    $esta_finalizado_desafio=EstaFinalizadoDesafio($rut, $desafio_por_curso[0]->id, $desafio_por_curso[0]->id_curso, $id_empresa);
                    if($accion_pendiente[0]->estado==1){
                    $row_curso = str_replace("{VE_DESAFIO}",file_get_contents("views/cursos/capacitacion/".$id_empresa."_boton_ve_desafios.html"),$row_curso);
                    if($esta_finalizado_desafio){
                    $row_curso = str_replace("{ICONO_ESTADO_DESAFIO}","<img src='img/lms_icons_aprobado.jpg' width='30'>",$row_curso);
                    }else{
                    $row_curso = str_replace("{ICONO_ESTADO_DESAFIO}","<img src='img/lms_icons_enproceso.png' width='30'>",$row_curso);
                    }
                    $row_curso = str_replace("{ID_OBJETO_ENCODEADO}",Encodear3($desafio_por_curso[0]->id),$row_curso);
                    $row_curso = str_replace("{RUT_COLABORADOR_ENCODADO}",Encodear3($rut),$row_curso);
                    }else{
                    $row_curso = str_replace("{VE_DESAFIO}","",$row_curso);
                    $row_curso = str_replace("{ICONO_ESTADO_DESAFIO}","",$row_curso);
                    }
                    */
                    if ($curso_unico->modalidad <> 2) {
                        if ($curso_unico->modalidad == 4 && $curso_unico->proveedor_curso <> "OL") {
                            //Con esta funcion, obtengo los datos desde la base de moodle de este curso
                            $datos_curso_moodle = ObtenerDatosMoodle($curso_unico, $row_curso);
                            $row_curso          = $datos_curso_moodle[4];
                            $resumen_niveles_curso .= $datos_curso_moodle[5];
                            $row_curso = str_replace("{LINK_CURSO}", '<a  href="#" onclick="EjecutaExterno' . $curso_unico->id_curso . '();">', $row_curso);
                            $row_curso = str_replace("{/LINK_CURSO}", '</a>', $row_curso);
                            $row_curso = str_replace("{TOTAL_MODULOS}", $datos_curso_moodle[2], $row_curso);
                            $row_curso = str_replace("{TOTAL_MODULOS_PENDIENTES}", $datos_curso_moodle[2] - $datos_curso_moodle[3], $row_curso);
                            $row_curso = str_replace("{TOTAL_MODULOS_FINALIZADOS}", $datos_curso_moodle[3], $row_curso);
                            $row_curso = str_replace("{NOTA_OBTENIDA}", $datos_curso_moodle[1], $row_curso);
                            $row_curso = str_replace("{RUT_MOODLE}", $_SESSION["user_"], $row_curso);
                            $row_curso = str_replace("{PASS_MOODLE}", 'Gop.123456', $row_curso);
                            $row_curso = str_replace("{ACTION}", $curso_unico->urlmoodle, $row_curso);
                            $row_curso = str_replace("{ID_MOODLE}", $curso_unico->idmoodle, $row_curso);
                            $row_curso = str_replace("{CURRENTORG}", $curso_unico->currentorg, $row_curso);
                            $row_curso = str_replace("{SCOID}", $curso_unico->scoid, $row_curso);
                            $row_curso = str_replace("{CM}", $curso_unico->cm, $row_curso);
                        } else if ($curso_unico->proveedor_curso == "OL") {
                            $tiempo     = time();
                            //print_r($curso_unico);
                            //echo "<br><br>";
                            //$id_curso_test="13HY13";
                            //echo "$rut - $tiempo - ".$curso_unico->codigo_curso." - ".$curso_unico->nombre_curso."<br>";
                            $string_var = encryptMoodleAula($rut . "||" . $tiempo . "||" . $curso_unico->codigo_curso, "");
                            //$string_var=encryptMoodleAula($rut."||".$tiempo."||".$id_curso_test, "");
                            //echo $string_var."<br>";
                            $string_var = encryptMoodleAula($rut . "||" . $tiempo . "||" . $id_curso_test, "");
                            //print_r($curso_unico);exit;
                            //echo $string_var;exit;
                            $row_curso  = str_replace("{LINK_CURSO}", '<a target="_blank"  href="http://aula.openl.cl/local/minvest/login.php?token=' . $string_var . '">', $row_curso);
                            //$row_curso = str_replace("{LINK_CURSO}",'<a href="javascript: alert(\'Curso Cerrado\');">',$row_curso);
                            $row_curso  = str_replace("{/LINK_CURSO}", '</a>', $row_curso);
                        } else {
                            $row_curso = str_replace("{LINK_CURSO}", '<a href="?sw=detalle_cursoCap&idc={ID_CURSO_ENCODEADO}">', $row_curso);
                            $row_curso = str_replace("{/LINK_CURSO}", '</a>', $row_curso);
                            $row_curso = str_replace("{LINK_CURSO_JUSTURL}", '?sw=detalle_cursoCap&idc={ID_CURSO_ENCODEADO}&idinsc={ID_INSCRIPCION_ENCODEADO}', $row_curso);
                        }
                    } else {
                        $row_curso = str_replace("{LINK_CURSO}", "", $row_curso);
                        $row_curso = str_replace("{/LINK_CURSO}", "", $row_curso);
                    }
                    list($estado, $porcentaje_asistencia, $nota) = CAPACITACION_VE_ESTADO($rut, $curso_unico->codigo_curso, $curso_unico->id_inscripcion, $id_empresa);
                    $row_curso = str_replace("{ID_CURSO_ENCODEADO}", Encodear3($curso_unico->id_curso), $row_curso);
                    $row_curso = str_replace("{ESTADO}", $estado_por_curso[0], $row_curso);
                    $row_curso = str_replace("{ESTADO_CON_NOTA}", $estado_por_curso[9], $row_curso);
                    $row_curso = str_replace("{ASISTENCIA}", $estado_por_curso[0], $row_curso);
                    if ($estado_por_curso[10]) {
                        $row_curso = str_replace("{PORC_ASISTENCIA}", $estado_por_curso[10] . "%", $row_curso);
                    } else {
                        $row_curso = str_replace("{PORC_ASISTENCIA}", "-", $row_curso);
                    }
                    $row_curso = str_replace("{ESTADO}", $estado_por_curso[1], $row_curso);
                    if ($estado_por_curso[7]) {
                        $row_curso = str_replace("{NOTA}", $estado_por_curso[7], $row_curso);
                        $row_curso = str_replace("{NOTA_SIN_PORCENTAJE}", round($estado_por_curso[7]) . "%", $row_curso);
                    } else {
                        $row_curso = str_replace("{NOTA}", "-", $row_curso);
                        $row_curso = str_replace("{NOTA_SIN_PORCENTAJE}", "-", $row_curso);
                    }
                    if ($estado_por_curso[8]) {
                        $row_curso = str_replace("{FECHA_FIN}", $estado_por_curso[8], $row_curso);
                    } else {
                        $row_curso = str_replace("{FECHA_FIN}", "-", $row_curso);
                    }
                    $row_curso = str_replace("{ICONO_ESTADO_CURSO}", $estado_por_curso[2], $row_curso);
                    //$row_curso = str_replace("{AVANCE_CURSO}",$estado_por_curso[3],$row_curso);
                    if ($curso_unico->modalidad == 2) {
                        $row_curso = str_replace("{AVANCE_CURSO}", $estado_por_curso[3], $row_curso);
                    } else {
                        $row_curso = str_replace("{AVANCE_CURSO}", $estado_por_curso[4], $row_curso);
                    }
                    //Funcion para colocar Avance de Curso, Tipo Ultramar, en base a los puntos de los objetos.
                    //echo  "<br>".$estado_por_curso[6];
                    $row_curso = str_replace("{VR_COLOR_ESTADO}", $estado_por_curso[12], $row_curso);
                    $row_curso = str_replace("{VR_ICON_ESTADO}", $estado_por_curso[11], $row_curso);
                    if ($estado_por_curso[6] == 1) {
                        $cantidad_cursos_aprobados_por_clasificacion++;
                    }
                    //suma avance
                    $cla_sum_avance = $cla_sum_avance + $estado_por_curso[4];
                    //echo "<pre>";
                    //    print_r($estado_por_curso);
                    $cantidad_cursos_por_clasificacion++;
                    //AVANCE GLOBAL
                    $cla_sum_avance_total                        = $cla_sum_avance_total + $cla_sum_avance;
                    $cla_cantidad_cursos_por_clasificacion_total = $cla_cantidad_cursos_por_clasificacion_total + $cantidad_cursos_por_clasificacion;
                    $total_cursos .= $row_curso;
                }
            }
            // VISTA AVANCE POR CLASIFICACION REAL POR OBJETO
            $avance_de_clasificacion                                            = round($cla_sum_avance / $cantidad_cursos_por_clasificacion);
            $arreglo_avances_clasificaciones[$contador_arreglo_clasificaciones] = $avance_de_clasificacion;
            $contador_arreglo_clasificaciones++;
            $avance_cla = str_replace("{CLAS_IMG_NIVEL}", "img/" . $cla->imagennivel, $avance_cla);
            $avance_cla = str_replace("{CLAS_AVANCE}", $avance_de_clasificacion, $avance_cla);
            if ($avance_de_clasificacion == 100) {
                $clase_estilo_img    = "";
                $clase_estado_icono  = "fas fa-check-squares";
                $clase_estado_estilo = "etiquetaPrograma-aprobado";
                $cla_estado          = "Finalizada";
            } elseif ($avance_de_clasificacion < 100 and $avance_de_clasificacion > 0) {
                $clase_estilo_img    = "img_bn_grasycale";
                $clase_estado_icono  = "icon-note icons";
                $clase_estado_estilo = "etiquetaPrograma-proceso ";
                $cla_estado          = "En Proceso 1";
            } else {
                $clase_estilo_img    = "img_bn_grasycale";
                $clase_estado_icono  = "far fa-times-circle";
                $clase_estado_estilo = "etiquetaPrograma-noiniciado ";
                $cla_estado          = "No Iniciado";
            }
            $avance_cla = str_replace("{CLAS_ESTADO_ESTILO}", $clase_estado_estilo, $avance_cla);
            $avance_cla = str_replace("{CLAS_ESTADO_ICONO}", $clase_estado_icono, $avance_cla);
            $avance_cla = str_replace("{ESTILO_IMG_CLAS_AVANCE}", $clase_estilo_img, $avance_cla);
            $avance_cla = str_replace("{CLAS_ESTADO}", $cla_estado, $avance_cla);
            // VISTA AVANCE POR CLASIFICACION REAL POR OBJETO
            $html_cla   = str_replace("{CANTIDAD_APROBADOS_MALLA}", $cantidad_cursos_aprobados_por_clasificacion, $html_cla);
            $html_cla   = str_replace("{AVANCEMALLA}", "10", $html_cla);
            $html_cla   = str_replace("{LISTADO_CURSOS_POR_CLASIFICACION}", ($total_cursos), $html_cla);
            //echo "<br><br>hola cantidad_cursos_aprobados_por_clasificacion $cantidad_cursos_aprobados_por_clasificacion , cursos clasificacion $cantidad_cursos_por_clasificacion";
            $html_cla   = str_replace("{APROBACION_CURSOS_PROGRAMA}", round(($cantidad_cursos_aprobados_por_clasificacion * 100) / $cantidad_cursos_por_clasificacion) . "%", $html_cla);
            $total_clasificaciones .= $html_cla;
            $avance_clasificaciones .= $avance_cla;
            $i++;
            if ($classrow) {
                if ($i == $classrow) {
                    $total_clasificaciones .= "<div class='row'></div>";
                    $i = 0;
                }
            } else {
                if ($i == 2) {
                    $total_clasificaciones .= "<div class='row'></div>";
                    $i = 0;
                }
            }
        }
        //en este arreglo, tengotodos los datos de los avances porclasificacion
        $arreglo_con_avances2 = $arreglo_avances_clasificaciones;
        //aca los ordeno de manera descendente. Si el primero es 0, implica que solo el primer queda abierto
        rsort($arreglo_con_avances2);
        $cont_2  = 1;
        $abierto = "";
        foreach ($clasificaciones as $cla) {
            //echo $arreglo_avances_clasificaciones[$cont_2-2]." ".$arreglo_avances_clasificaciones[$cont_2-1]."<br><br>";
            $id_clasificacion = $cla->id_clasificacion;
            if ($arreglo_con_avances2[0] == 0) {
                $abierto = 1;
            }
            //echo "<pre>";
            //print_r($arreglo_avances_clasificaciones);
            if ($cont_2 == $abierto) {
                //echo "{BLOQUE_JS_ABIERTO_CERRADO_".$id_clasificacion."}";exit;
                $total_clasificaciones = str_replace("{BLOQUE_JS_ABIERTO_CERRADO_" . $id_clasificacion . "}", "", $total_clasificaciones);
            }
            //echo $arreglo_avances_clasificaciones[$cont_2-1]."  ".$arreglo_avances_clasificaciones[$cont_2]." -<br>";
            if (($arreglo_avances_clasificaciones[$cont_2 - 2] == 100 && $arreglo_avances_clasificaciones[$cont_2 - 1] < 100) or ($arreglo_avances_clasificaciones[$cont_2 - 2] === "" && $arreglo_avances_clasificaciones[$cont_2 - 1] < 100)) {
                $total_clasificaciones = str_replace("{BLOQUE_JS_ABIERTO_CERRADO_" . $id_clasificacion . "}", "", $total_clasificaciones);
                $total_clasificaciones = str_replace("{LINK_ABRE_CIERRA_" . $id_clasificacion . "}", "show_hide" . $id_clasificacion, $total_clasificaciones);
            } else if ($arreglo_avances_clasificaciones[$cont_2 - 1] < 100 && $arreglo_avances_clasificaciones[$cont_2 - 1] > 0 && $arreglo_avances_clasificaciones[$cont_2] == 0) {
                $total_clasificaciones = str_replace("{BLOQUE_JS_ABIERTO_CERRADO_" . $id_clasificacion . "}", "", $total_clasificaciones);
                $total_clasificaciones = str_replace("{LINK_ABRE_CIERRA_" . $id_clasificacion . "}", "show_hide" . $id_clasificacion, $total_clasificaciones);
            } else {
                $total_clasificaciones = str_replace("{BLOQUE_JS_ABIERTO_CERRADO_" . $id_clasificacion . "}", '$(".slidingDiv' . $id_clasificacion . '").hide();', $total_clasificaciones);
                $total_clasificaciones = str_replace("{LINK_ABRE_CIERRA_" . $id_clasificacion . "}", "", $total_clasificaciones);
            }
            $cont_2++;
        }
    }
    //echo "$cla_sum_avance_total $cla_cantidad_cursos_por_clasificacion_total"
    $avance_real      = round($cla_sum_avance_total / $cla_cantidad_cursos_por_clasificacion_total);
    $lms_medalla_tips = lms_medalla_tips($rut, $id_empresa);
    $PRINCIPAL        = str_replace("{NUMERO_AVANCE_REAL}", $avance_real, $PRINCIPAL);
    $PRINCIPAL        = str_replace("{LMS_NUM_TIPS}", $lms_medalla_tips[0]->cuentatips, $PRINCIPAL);
    $PRINCIPAL        = str_replace("{LMS_NUM_MEDALLAS}", $lms_medalla_tips[0]->cuentamedallas, $PRINCIPAL);
    $PRINCIPAL        = str_replace("{ROW_CURSOS_RESUMENES2}", $resumen_niveles_curso, $PRINCIPAL);
    $PRINCIPAL        = str_replace("{APROBACION_CURSOS_PROGRAMA}", round(($cantidad_cursos_aprobados_por_clasificacion * 100) / $cantidad_cursos_por_clasificacion), $PRINCIPAL);
    $PRINCIPAL        = str_replace("{NUM_INSCRIPCIONES}", ($numero_cursos_total_up), $PRINCIPAL);
    $PRINCIPAL        = str_replace("{NUM_CURSOS}", ($numero_cursos_total_desdemalla_up), $PRINCIPAL);
    $PRINCIPAL        = str_replace("{ROWS_CLASIFICACIONES}", ($total_clasificaciones), $PRINCIPAL);
    $PRINCIPAL        = str_replace("{BLOQUE_AVANCE_CLASIFICACIONES}", ($avance_clasificaciones), $PRINCIPAL);
    if ($tipo_llamada == "admin") {
        $arreglo[0] = $PRINCIPAL;
        $arreglo[1] = $porcentaje_avance_por_usuario;
        $arreglo[2] = $datos_usuario_para_admin;
        //Numero de cursos
        $arreglo[3] = $numero_cursos_total_desdemalla_up;
        return ($arreglo);
    } else {
        return ($PRINCIPAL);
    }
}
function ColocaBloqueFeedback($PRINCIPAL, $datos_evaluacion, $id_empresa)
{
    $evaluado            = $datos_evaluacion[0]->evaluado;
    $evaluador           = $datos_evaluacion[0]->evaluador;
    $id_proceso          = $datos_evaluacion[0]->id_proceso;
    $feedback_finalizado = VErificaFeedbackFinalizado($evaluado, $evaluador, $id_proceso, $id_empresa);
    if ($feedback_finalizado) {
        $html_feedback = file_get_contents("views/sgd/feedback/formulario_lectura.html");
        $feedback      = TraeDatosPorFeedback($evaluado, $evaluador, $id_proceso);
        $html_feedback = str_replace("{RECIBI_FEEDBACK}", $feedback[0]->realizado, $html_feedback);
        $html_feedback = str_replace("{PREGUNTA1}", ($feedback[0]->pregunta1), $html_feedback);
        $html_feedback = str_replace("{PREGUNTA2}", ($feedback[0]->pregunta2), $html_feedback);
        $html_feedback = str_replace("{PREGUNTA3}", ($feedback[0]->pregunta3), $html_feedback);
        $html_feedback = str_replace("{PREGUNTA4}", ($feedback[0]->pregunta4), $html_feedback);
    } else {
        $html_feedback = file_get_contents("views/sgd/feedback/formulario.html");
        $html_feedback = str_replace("{RUT_EVALUADO_ENCODEADO}", Encodear3($evaluado), $html_feedback);
        $html_feedback = str_replace("{RUT_EVALUADOR_ENCODEADO}", Encodear3($evaluador), $html_feedback);
        $html_feedback = str_replace("{ID_PROCESO_ENCODEADO}", Encodear3($id_proceso), $html_feedback);
    }
    $PRINCIPAL = str_replace("{BLOQUE_FEEDBACK}", $html_feedback, $PRINCIPAL);
    return ($PRINCIPAL);
}
function LiberadoFeedbackLiberado($evaluado, $evaluador, $calibrador, $id_proceso, $id_empresa)
{
    if ($evaluado == $evaluador) {
        $relacion   = ObtenerJefeRelPorProceso($evaluado, $id_proceso);
        $evaluador  = $relacion[0]->evaluador;
        $calibrador = $relacion[0]->calibrador;
    }
    $feedback_finalizado = VErificaFeedbackFinalizado($evaluado, $evaluador, $id_proceso, $id_empresa);
    if ($feedback_finalizado) {
        $arreglo[0] = '<span class="etiquetaSGDSello">Feedback Realizado</span>';
    } else {
        $relacion_liberada = TraeLiberadoEvaluadoEvaluadorCalibrador($evaluado, $evaluador, $calibrador, $id_proceso);
        if ($relacion_liberada) {
            $arreglo[0] = '<span class="etiquetaSGDSello">Informe Liberado</span>';
        }
    }
    return ($arreglo);
}
Function GraficoPorCompetenciasPorEvaluadorCalibrador($evaluador, $id_proceso, $calibrador, $evaluado, $origen, $arreglo_post)
{
    //la variable origen es para ver si viene desde el admin o no
    $datos_empresa = DatosEmpresa($_SESSION["id_empresa"]);
    if ($origen == "admin") {
        $grafico = file_get_contents("../front/views/sgd/graficos/barra_frecuenciaCompetencias2.html");
    } else {
        $grafico = file_get_contents("views/sgd/graficos/barra_frecuenciaCompetencias2.html");
    }
    if ($arreglo_post["rutevaluador"])
        $evaluador = $arreglo_post["rutevaluador"];
    if ($arreglo_post["rutcalibrador"])
        $evaluador = $arreglo_post["rutcalibrador"];
    if ($evaluado) {
        //$relaciones=TraeDatosRelacionEvaluadoEvaluadorProceso($evaluado, $evaluador, $id_proceso);
        $relaciones = TraeDatosRelacionEvaluadoEvaluadorProceso($evaluado, $evaluador, $id_proceso);
        $perfiles   = TotalPerfilesDadoEvaluador1PorProcesoEvaluado($evaluador, $id_proceso, $evaluado);
    } else if ($evaluador) {
        //Traigo las evaluaciones, en base al evaluador
        $relaciones = TraeRelacionesSinAe($evaluador, $id_proceso);
        $perfiles   = TotalPerfilesDadoEvaluador1PorProceso($evaluador, $id_proceso);
    } else if ($calibrador) {
        //Traigo las evaluaciones en funcion al calibrador
        $relaciones = TraeRelacionesSinAeCalibrador($calibrador, $id_proceso);
        $perfiles   = TotalPerfilesDadoEvaluador1PorProcesoPorCalibrador($calibrador, $id_proceso);
    } else if ($id_proceso) {
        //$relaciones=TraeRelacionesSoloProceso($id_proceso);
        $relaciones = TraeRelacionesSoloProcesoSinAe($id_proceso, $arreglo_post);
        $perfiles   = TotalPerfilesDadoEvaluador1SoloProceso($id_proceso, $arreglo_post);
    }
    for ($i = 0; $i < count($perfiles); $i++) {
        $sql .= " perfil_evaluacion='" . $perfiles[$i]->id_perfil_ev . "'";
        if ($perfiles[$i + 1]->id_perfil_ev)
            $sql .= " or";
    }
    $total_competencias    = TotalIdCompetenciasSoloCompetencias($sql);
    $contador_competencias = 0;
    foreach ($total_competencias as $competencia) {
        //Por cada competencia, hago el ciclo de los evaluados, para por cada uno, traer el promedio de su competencia
        $contador   = 0;
        $acumulador = 0;
        foreach ($relaciones as $rel) {
            //Por cada uno, traigo las respuestas
            $promedio_por_comp_evaluado = PromedioPorCompetenciaDadoEvaluadoEvaluadoProcesoIdCOmpReporte($rel->evaluado, $rel->evaluador, $rel->id_proceso, $competencia->id_componente_reporte);
            if ($promedio_por_comp_evaluado[0]->promedio_comp) {
                $acumulador = $acumulador + $promedio_por_comp_evaluado[0]->promedio_comp;
                $contador++;
            }
        }
        $arreglo_promedio_competencias[$contador_competencias]["id"]     = $competencia->id_componente_reporte;
        $arreglo_promedio_competencias[$contador_competencias]["nombre"] = ($competencia->nombre);
        $arreglo_promedio_competencias[$contador_competencias]["nota"]   = $acumulador / $contador;
        $arreglo_promedio_competencias[$contador_competencias]["sigla"]  = ($competencia->nombre);
        $contador_competencias++;
    }
    foreach ($arreglo_promedio_competencias as $key => $row) {
        $aux[$key] = $row['nota'];
    }
    array_multisort($aux, SORT_DESC, $arreglo_promedio_competencias);
    $contador_ = 1;
    for ($i = 0; $i < count($arreglo_promedio_competencias); $i++) {
        $datos .= "['" . $arreglo_promedio_competencias[$i]['sigla'] . "', " . ColocaDecimalesNotasFinales(2, $arreglo_promedio_competencias[$i]['nota']) . "]";
        if ($contador_ < count($arreglo_promedio_competencias))
            $datos .= ",";
        $contador_++;
    }
    $grafico = str_replace("{ARREGLO_DATOS}", $datos, $grafico);
    $grafico = str_replace("{TITULO_GRAFICO_1}", "Titulo", $grafico);
    $grafico = str_replace("{COLOR_GRAFICO}", $datos_empresa[0]->color_grafico1, $grafico);
    return ($grafico);
}
function ConsolidadoLineal($evaluador, $calibrador, $id_proceso, $id_empresa, $origen, $arreglo_post)
{
    if ($origen == "admin") {
        $grafico = file_get_contents("../front/views/sgd/graficos/" . $id_empresa . "_graficoLineas1.html");
    } else {
        $grafico = file_get_contents("views/sgd/graficos/" . $id_empresa . "_graficoLineas1.html");
    }
    if ($arreglo_post["rutevaluador"])
        $evaluador = $arreglo_post["rutevaluador"];
    if ($arreglo_post["rutcalibrador"])
        $calibrador = $arreglo_post["rutcalibrador"];
    if ($evaluador) {
        //Traigo las evaluaciones, en base al evaluador
        $relaciones = TraeRelacionesSinAe($evaluador, $id_proceso);
    } else if ($calibrador) {
        //Traigo las evaluaciones en funcion al calibrador
        $relaciones = TraeRelacionesSinAeCalibrador($calibrador, $id_proceso);
    } else if ($id_proceso) {
        $relaciones = TraeRelacionesSoloProcesoParaGrafico($id_proceso, $arreglo_post);
    }
    for ($i = 1; $i <= 17; $i++) {
        ${'rango' . $i} = 0;
    }
    foreach ($relaciones as $rel) {
        $nota = ResultadosFinales($rel->evaluado, $rel->evaluador, $id_proceso, "");
        if ($arreglo_post["tipo_reporte"] == "individuales") {
            $nota_final = $nota[31];
            //echo $nota[18]." -  ".$nota[27]."<br>";
        } else {
            //Este if lo hago solo para que tome las evaluaciones finalizadas
            if ($nota[41] == "si") {
                $nota_final = $nota[27];
            } else {
                //$nota_final=$nota[27];
                continue;
            }
        }
        //echo $nota_final." ".$rel->evaluado;
        // echo "<br>";
        if ($id_empresa == 28) {
            if ($nota_final >= 1 && $nota_final < 1.25) {
                $rango1++;
            } else if ($nota_final >= 1.25 && $nota_final < 1.5) {
                $rango2++;
            } else if ($nota_final >= 1.5 && $nota_final < 1.75) {
                $rango3++;
            } else if ($nota_final >= 1.75 && $nota_final < 2) {
                $rango4++;
            } else if ($nota_final >= 2 && $nota_final < 2.25) {
                $rango5++;
            } else if ($nota_final >= 2.25 && $nota_final < 2.5) {
                $rango6++;
            } else if ($nota_final >= 2.25 && $nota_final < 2.5) {
                $rango7++;
            } else if ($nota_final >= 2.5 && $nota_final < 2.75) {
                $rango8++;
            } else if ($nota_final >= 2.75 && $nota_final < 3) {
                $rango9++;
            } else if ($nota_final >= 3 && $nota_final < 3.25) {
                $rango10++;
            } else if ($nota_final >= 3.25 && $nota_final < 3.5) {
                $rango11++;
            } else if ($nota_final >= 3.5 && $nota_final < 3.75) {
                $rango12++;
            } else if ($nota_final >= 3.75 && $nota_final < 4) {
                $rango13++;
            } else if ($nota_final >= 4 && $nota_final < 4.25) {
                $rango14++;
            } else if ($nota_final >= 4.25 && $nota_final < 4.5) {
                $rango15++;
            } else if ($nota_final >= 4.5 && $nota_final < 4.75) {
                $rango16++;
            } else if ($nota_final >= 4.75 && $nota_final < 4.75) {
                $rango17++;
            }
        } else if ($id_empresa == 43) {
            if ($nota_final >= 1 && $nota_final < 50) {
                $rango1++;
            } else if ($nota_final >= 50 && $nota_final < 90) {
                $rango2++;
            } else if ($nota_final >= 90 && $nota_final < 110) {
                $rango3++;
            } else if ($nota_final >= 110 && $nota_final < 119) {
                $rango4++;
            } else if ($nota_final >= 119 && $nota_final < 121) {
                $rango5++;
            }
        }
    }
    for ($i = 1; $i <= 17; $i++) {
        $grafico = str_replace("{RANGO" . $i . "}", ${'rango' . $i}, $grafico);
    }
    $datos_empresa = DatosEmpresa($id_empresa);
    $grafico       = str_replace("{COLOR_GRAFICO}", $datos_empresa[0]->color_grafico1, $grafico);
    return ($grafico);
}
function AvanceDeEvaluados($evaluador, $id_proceso, $campo_criterio, $valor_criterio, $id_proceso_anual, $evaluado, $tipo_reporte, $campo1, $valorcampo1, $campo2, $valorcampo2, $campo3, $valorcampo3)
{
    if ($campo1 or $campo2 or $campo3) {
        //echo "$campo1, $valorcampo1, $campo2, $valorcampo2, $campo3, $valorcampo3";
        $rel = DAtosEvaluadoEvaluadorParaAvancePorEvaluadorPorCampo123($id_proceso, $campo1, $valorcampo1, $campo2, $valorcampo2, $campo3, $valorcampo3, $tipo_reporte);
    } else if ($valor_criterio && $campo_criterio && $id_proceso) {
        //$rel=DAtosEvaluadoEvaluadorParaAvancePorEvaluadorPorCriterios($id_proceso, $campo_criterio, $valor_criterio, $tipo_reporte);
        $rel = DAtosEvaluadoEvaluadorParaAvancePorEvaluadorPorCriteriosV2($id_proceso, $campo_criterio, $valor_criterio, $tipo_reporte);
    } else if ($evaluador && $id_proceso && !$evaluado) {
        //$rel=DAtosEvaluadoEvaluadorParaAvancePorEvaluador($evaluador, $id_proceso);
        $rel = DAtosEvaluadoEvaluadorParaAvancePorEvaluadorV2($evaluador, $id_proceso);
    } else if ($id_proceso && !$evaluado) {
        $rel = DAtosEvaluadoEvaluadorParaAvancePorSoloProceso($id_proceso);
    } else if ($id_proceso_anual && !$evaluado) {
        $rel = DAtosEvaluadoEvaluadorParaAvancePorIdProcesoAnual($id_proceso_anual);
    } else if ($evaluado && $evaluador) {
        //$rel=DAtosEvaluadoEvaluadorParaAvancePorEvaluadoEvaluador($evaluador, $id_proceso, $evaluado);
        //$rel=DAtosEvaluadoEvaluadorParaAvancePorEvaluadoEvaluadorEvalIndividual($evaluador, $id_proceso, $evaluado);
        $rel = DAtosEvaluadoEvaluadorParaAvancePorEvaluadoEvaluadorEvalIndividualV2($evaluador, $id_proceso, $evaluado);
        //if($rel[0]->pagina==$rel[0]->total_preguntas)$rel[0]->pagina=$rel[0]->pagina-1;
    }
    $contador = 0;
    foreach ($rel as $rel_unico_dato) {
        //Por cada evaluado, traigo la cantidad de preguntas que debiese tener
        //$porcentaje_individual=($rel_unico_dato->pagina*100)/$rel_unico_dato->total_preguntas;
        //echo $rel_unico_dato->total_preguntas." - ".$rel_unico_dato->pagina."<br>";
        $k                     = (100 / ($rel_unico_dato->total_preguntas - 1));
        $porcentaje_individual = ($k * $rel_unico_dato->pagina) - $k;
        if ($porcentaje_individual <= 0) {
            $porcentaje_individual = 0;
        }
        $acumulador = $acumulador + $porcentaje_individual;
        $contador++;
    }
    //$porcentaje_total[0]=FormatearPorcentajes($acumulador/$contador);
    $porcentaje_total[0] = FormatearPorcentajesCon1Decimal($acumulador / $contador);
    return ($porcentaje_total);
}
function colocarPesos($valor)
{
    $valor = number_format($valor, 0, ",", ".");
    return ($valor);
}
function FormatearPorcentajesCon1Decimal($valor)
{
    $valor = number_format($valor, 1, ",", ".");
    return ($valor);
}
function FormatearPorcentajes($valor)
{
    $valor = number_format($valor, 0, ",", ".");
    return ($valor);
}
function ListadoTotalColaboradoresObjetivos($html, $rut, $proceso_anual, $id_empresa, $id_proceso, $tipo_sgd, $id_proceso_a_evaluar)
{
    $total_evaluados = "";
    //$row=file_get_contents("views/sgd/listado_colaboradores/row_colaboradores_objetivo.html");
    $entorno         = str_replace("{SECCION_GRAFICOS_CONSOLIDADOS}", file_get_contents("views/sgd/vista_consolidada_graficos.html"), $entorno);
    $entorno         = str_replace("{GRAFICO1.1}", ConsolidadoLineal($rut, "", $id_proceso_calibrar, $id_empresa), $entorno);
    $entorno         = str_replace("{GRAFICO1.2}", GraficoPorCompetenciasPorEvaluadorCalibrador($rut, $id_proceso_calibrar, ""), $entorno);
    $html            = ColocaDatosUsuario($html, $rut);
    $html            = str_replace("{RUT_EVALUADO_ENCODEADO}", Encodear3($rut), $html);
    $datos_usuario   = UsuarioEnBasePersonas($rut);
    $html            = str_replace("{NOMBRE_DEPENDIENTE}", ($datos_usuario[0]->nombre), $html);
    $html            = str_replace("{PARAMETROS_EVAL}", Encodear3($ev->rut . ";" . $rut), $html);
    if ($tipo_sgd == 2) {
        $entorno         = file_get_contents("views/sgd/sgd2_entorno_equipo_chilquinta.html");
        $tiene_evaluados = TraeRelacionesSinAe($rut, $id_proceso);
        $entorno         = str_replace("{SECCION_EQUIPO_CONSOLIDADO}", "", $entorno);
    } else {
        $entorno = file_get_contents("views/sgd/sgd2_entorno_equipo.html");
    }
    $entorno            = str_replace("{SECCION_GRAFICOS_CONSOLIDADOS}", file_get_contents("views/sgd/vista_consolidada_graficos.html"), $entorno);
    $entorno            = str_replace("{GRAFICO1.1}", ConsolidadoLineal($rut, "", $id_proceso, $id_empresa), $entorno);
    $entorno            = str_replace("{GRAFICO1.2}", GraficoPorCompetenciasPorEvaluadorCalibrador($rut, $id_proceso, ""), $entorno);
    //valido, si es que este evaluador esta liberado para este proceso.
    //Si es asi, no muestro el boton Evaluar Equipo.
    $evaluador_liberado = TraeCantidadLiberadosPorEvaluador($rut, $id_proceso);
    if ($evaluador_liberado) {
        $entorno = str_replace("{BOTON_EVALUAR_EQUIPO}", "", $entorno);
    } else {
        $entorno = str_replace("{BOTON_EVALUAR_EQUIPO}", file_get_contents("views/sgd/" . $id_empresa . "_boton_evaluar_equipo.html"), $entorno);
    }
    $entorno   = str_replace("{TABLA_DATOS_USUARIO_SUPERIOR}", file_get_contents("views/sgd/tabla_datos_superior_usuario.html"), $entorno);
    $entorno   = ColocaDatosUsuario($entorno, $rut, "graficoFrecuenciaCompetencia");
    $evaluados = TraeEvaluadosDadoEvaluadorPorProceso2($rut, 55);
    if (!$evaluados) {
        $row_mis_objetivos = file_get_contents("views/sgd/listado_colaboradores/row_colaboradores_objetivo.html");
        $total_evaluados .= ColocaDatosUsuario($row, $rut);
        $total_evaluados         = str_replace("{BOTON_BITACORA}", file_get_contents("views/sgd/listado_colaboradores/boton_ingresa_objetivos.html"), $total_evaluados);
        $entorno                 = str_replace("{LISTADO_COLABORADORES}", ($total_evaluados), $entorno);
        $html                    = str_replace("{ENTORNO_LISTADO_COLABORADORES}", ($entorno), $html);
        $total_objetivos         = TraeObjetivosIndividualesDadoRut($rut);
        $total_evaluados         = str_replace("{CANTIDAD}", count($total_objetivos), $total_evaluados);
        $total_objetivos_conpond = TraeObjetivosIndividualesDadoRutConPond($rut);
        $total_evaluados         = str_replace("{X_VALIDADOS}", count($total_objetivos_conpond), $total_evaluados);
        $total_objetivos_sinpond = TraeObjetivosIndividualesDadoRutSinPond($rut);
        $total_evaluados         = str_replace("{X_NO_VALIDADOS}", count($total_objetivos_sinpond), $total_evaluados);
    } else {
        $total_evaluados   = "";
        $obj_fin           = 0;
        $row_mis_objetivos = file_get_contents("views/sgd/listado_colaboradores/row_colaboradores_objetivo.html");
        $total_evaluados .= ColocaDatosUsuario($row, $rut);
        $total_evaluados         = str_replace("{BOTON_BITACORA}", file_get_contents("views/sgd/listado_colaboradores/boton_ingresa_objetivos.html"), $total_evaluados);
        $total_objetivos         = TraeObjetivosIndividualesDadoRut($rut);
        $total_evaluados         = str_replace("{CANTIDAD}", count($total_objetivos), $total_evaluados);
        $total_objetivos_conpond = TraeObjetivosIndividualesDadoRutConPond($rut);
        //$total_evaluados = str_replace("{X_VALIDADOS}",count($total_objetivos_conpond),$total_evaluados);
        $total_objetivos_sinpond = TraeObjetivosIndividualesDadoRutSinPond($rut);
        $total_evaluados         = str_replace("{X_NO_VALIDADOS}", count($total_objetivos_sinpond), $total_evaluados);
        foreach ($evaluados as $ev) {
            //COMENTADO PARA OPTIMIZAR 22-11-2015
            $row = file_get_contents("views/sgd/listado_colaboradores/row_colaboradores_objetivo.html");
            $total_evaluados .= ColocaDatosUsuario($row, $ev->rut);
            $total_evaluados = str_replace("{BOTON_BITACORA}", file_get_contents("views/sgd/listado_colaboradores/boton_ve_objetivos_equipo.html"), $total_evaluados);
            if ($tipo_sgd == 2) {
                $total_evaluados   = str_replace("{TABLA_RESUMEN1}", file_get_contents("views/sgd/informe/tabla_superior_resumen/tabla_resumen1_sinareacorp_dinamico_chilquinta.html"), $total_evaluados);
                //aca verifico de manera individual si es que fue liberado o no este evaluado
                $evaluado_liberado = TraeLiberadoEvaluadoEvaluadorCalibrador($ev->rut, $rut, $ev->calibrador, $ev->id_proceso);
                if ($evaluado_liberado) {
                    $total_evaluados = str_replace("{BOTON_EVALUACION_INDIVIDUAL}", "", $total_evaluados);
                } else {
                    $total_evaluados = str_replace("{BOTON_EVALUACION_INDIVIDUAL}", file_get_contents("views/sgd/informe/tabla_superior_resumen/boton_eval_individual.html"), $total_evaluados);
                }
                $total_evaluados = str_replace("{BOTON_FEEDBACK}", "", $total_evaluados);
                $total_evaluados = str_replace("{BOTON_VE_INFORME_POR_PROCESO}", "", $total_evaluados);
                $total_evaluados = str_replace("{RUT_EVALUADO_ENCODEADO}", Encodear3($ev->rut), $total_evaluados);
                $total_evaluados = str_replace("{ID_PROCESO_ENCODEADO}", Encodear3($id_proceso), $total_evaluados);
            } else {
                $total_evaluados = str_replace("{TABLA_RESUMEN1}", file_get_contents("views/sgd/informe/tabla_superior_resumen/tabla_resumen1_sinareacorp_dinamico.html"), $total_evaluados);
            }
            $total_evaluados         = ArmaTemplareDeTablaResumen($total_evaluados, $proceso_anual, $id_empresa, $ev->perfil_evaluacion, $ev->rut, $rut);
            //total de Objetivos
            $total_objetivos         = TraeObjetivosIndividualesDadoRut($ev->rut);
            $total_evaluados         = str_replace("{CANTIDAD}", count($total_objetivos), $total_evaluados);
            $total_objetivos_conpond = TraeObjetivosIndividualesDadoRutConPond($ev->rut);
            $total_evaluados         = str_replace("{X_VALIDADOS}", count($total_objetivos_conpond), $total_evaluados);
            $total_objetivos_sinpond = TraeObjetivosIndividualesDadoRutSinPond($ev->rut);
            $total_evaluados         = str_replace("{X_NO_VALIDADOS}", count($total_objetivos_sinpond), $total_evaluados);
            //Verifico si est? finalizado este evaluado en el proceso de objetivos
            $feedback_objetivos      = TomoConocimientoEvaluado($ev->rut);
            if ($feedback_objetivos) {
                $obj_fin++;
            }
            //$total_evaluados = ColocaPonderaciones($total_evaluados, $ev->rut);
            $total_evaluados = str_replace("{RUT_EVALUADO_ENCODEADO}", Encodear3($ev->rut), $total_evaluados);
            //$total_evaluados=ColocaResultadosTablaReumen($total_evaluados, $ev->rut, $rut);
            $total_evaluados = SemaforosEstadosObjetivos($total_evaluados, $ev->rut, $_SESSION["ano_proceso_anual"]);
        }
        $nota_final_evaluados = $acummulador_notas / $contador;
        $entorno              = ObtieneResumenesNotasFinalesPorEvaluador($entorno, $rut, $id_proceso);
        //aca calculo el porcentaje de avance de objetivos de todos los colaboradores.
        $entorno              = str_replace("{POR_AVANCE_OBJ}", ($obj_fin * 100) / count($evaluados), $entorno);
        $entorno              = str_replace("{POR_AVANCE_EV_EQUIPO}", 0, $entorno);
        $entorno              = str_replace("{LISTADO_COLABORADORES}", ($total_evaluados), $entorno);
        $html                 = str_replace("{ENTORNO_LISTADO_COLABORADORES}", ($entorno), $html);
    }
    return ($html);
}
function BloqueListadoSalonFama($html, $id_empresa, $id_categoria, $ano)
{
    //Traigo el listado de usuarios para ver en Clasicos
    //$datos=TraeListadoClasicos($id_empresa, "", "order by antiguedad desc");
    //$datos=TotalReconocimientosPorCategoriaGenerico($id_categoria, $id_empresa);
    $datos       = TotalReconocimientosPorCategoriaGenericoPorAno($id_categoria, $id_empresa, $ano);
    $subtitulo   = "";
    //echo round($datos[0]->antiguedad/5);
    $valor_mayor = (round($datos[0]->antiguedad / 10) * 10);
    $html        = str_replace("{TITULO_SALON_FAMA}", ($datos[0]->titulo_pagina), $html);
    $html        = str_replace("{DESCRIPCION}", ($datos[0]->descripcion_categoria), $html);
    $valor_menor = $valor_mayor - 10;
    //echo "<br>";
    $j           = 0;
    foreach ($datos as $unico) {
        $row .= file_get_contents("views/salondelafama/row_generico.html");
        $row = str_replace("{NOMBRE}", $unico->nombre_completo, $row);
        $row = str_replace("{ANOS}", $unico->antiguedad, $row);
        $row = str_replace("{CARGO}", $unico->cargo, $row);
        $row = str_replace("{URL_PERSONA}", VerificaFotoPersonal($unico->rut), $row);
        $row = str_replace("{RUT_ENCODEADO}", Encodear3($unico->rut), $row);
    }
    $html = str_replace("{BLOQUE_LISTADO_CLASICOS}", ($row), $html);
    return ($html);
}
function ObtieneResumenesNotasFinalesPorEvaluador($entorno, $rut_evaluador, $id_proceso, $calibrador)
{
    if ($calibrador) {
        //$evaluados=TraeEvaluadosDadoEvaluadorPorProceso2PorCalibrador($calibrador, $id_proceso);
        $evaluados = TraeEvaluadosDadoEvaluadorPorProceso2PorCalibradorSinAe($calibrador, $id_proceso);
    } else {
        //$evaluados=TraeEvaluadosDadoEvaluadorPorProceso2($rut_evaluador, $id_proceso);
        $evaluados = TraeEvaluadosDadoEvaluadorPorProceso2SinAe($rut_evaluador, $id_proceso);
    }
    foreach ($evaluados as $ev) {
        $datos_resumen = ResultadosFinales($ev->rut, $ev->evaluador, $id_proceso, "");
        //PARA CHILQUINTA ES SOLO LA COMP, PARA TURBUS, EL PROMEDIO ENTRE COMP Y OBJ
        if ($datos_resumen[27] > 0) {
            $acummulador_notas = $acummulador_notas + $datos_resumen[27];
            $contador++;
        }
        //ESPECIFICOS
        if (round($datos_resumen[31]) > 0) {
            $acumulador_objetivos = $acumulador_objetivos + round($datos_resumen[31]);
            $contador_obj++;
        }
        if ($datos_resumen[32] > 0) {
            $acumulador_nota_competencias = $acumulador_nota_competencias + $datos_resumen[32];
            $contador_competencias++;
        }
        $datos_resumen_ae = ResultadosFinales($ev->rut, $ev->rut, $id_proceso, "");
        if ($datos_resumen_ae[27] > 0) {
            $acummulador_notas_ae = $acummulador_notas_ae + $datos_resumen_ae[27];
            $contador_ae++;
        }
    }
    if ($_SESSION["id_empresa"] == 43) {
        $nota_final_evaluados = (($acumulador_nota_competencias / $contador_competencias) * 0.4) + (($acumulador_objetivos / $contador_obj) * 0.6);
    } else {
        $nota_final_evaluados = $acummulador_notas / $contador;
    }
    $nota_final_objetivos    = $acumulador_objetivos / $contador_obj;
    $nota_final_competencias = $acumulador_nota_competencias / $contador_competencias;
    if ($nota_final_competencias) {
        $datos_nota_final_evaluados_competencias = ObtenerCriterioPuntajeMatrizNotaFinal($nota_final_competencias, "", 0, "nota_final", $rut_evaluador, $id_proceso);
        $entorno                                 = str_replace("{NOTA_COMP_ESPE_INT}", ColocaDecimalesNotasFinales(2, $nota_final_competencias), $entorno);
        $entorno                                 = str_replace("{CRITERIO_COMP_ESPE_INT}", $datos_nota_final_evaluados_competencias[0], $entorno);
        $entorno                                 = str_replace("{ESTILO_COMP_ESPE_INT}", $datos_nota_final_evaluados_competencias[2], $entorno);
    } else {
        $entorno = str_replace("{NOTA_COMP_ESPE_INT}", "", $entorno);
        $entorno = str_replace("{CRITERIO_COMP_ESPE_INT}", "", $entorno);
        $entorno = str_replace("{ESTILO_COMP_ESPE_INT}", "", $entorno);
    }
    if ($nota_final_objetivos) {
        $datos_nota_final_evaluados_objetivos = ObtenerCriterioPuntajeMatrizNotaFinal($nota_final_objetivos, "", 0, "nota_final", $rut_evaluador, $id_proceso);
        $entorno                              = str_replace("{NOTA_OBJ_ESP_INT}", ColocaDecimalesNotasFinales(2, $nota_final_objetivos), $entorno);
        $entorno                              = str_replace("{CRITERIO_OBJ_ESP_INT}", $datos_nota_final_evaluados_objetivos[0], $entorno);
        $entorno                              = str_replace("{ESTILO_OBJ_ESP_INT}", $datos_nota_final_evaluados_objetivos[2], $entorno);
    }
    if ($contador_competencias == count($evaluados)) {
        if ($nota_final_evaluados) {
            if ($calibrador) {
                //$datos_nota_final_evaluados=ObtenerCriterioPuntajeMatrizNotaFinal($nota_final_evaluados, $evaluados[0]->evaluador, 0, "nota_final", $evaluados[0]->evaluador, $id_proceso);
                $datos_nota_final_evaluados = ObtenerCriterioPuntajeMatrizNotaFinal($nota_final_evaluados, "", 0, "nota_final", $evaluados[0]->evaluador, $id_proceso);
            } else {
                //$datos_nota_final_evaluados=ObtenerCriterioPuntajeMatrizNotaFinal($nota_final_evaluados, $rut_evaluador, 0, "nota_final", $evaluados[0]->evaluador, $id_proceso);
                $datos_nota_final_evaluados = ObtenerCriterioPuntajeMatrizNotaFinal($nota_final_evaluados, "", 0, "nota_final", $rut_evaluador, $id_proceso);
            }
            $entorno = str_replace("{NOTA_FINAL}", ColocaDecimalesNotasFinales(2, $nota_final_evaluados), $entorno);
            $entorno = str_replace("{ESTILO_NOTA_FINAL}", $datos_nota_final_evaluados[2], $entorno);
            $entorno = str_replace("{ICONO_NOTA_FINAL}", $datos_nota_final_evaluados[3], $entorno);
            $entorno = str_replace("{CRITERIO_NOTA_FINAL}", $datos_nota_final_evaluados[0], $entorno);
        } else {
            $entorno = str_replace("{NOTA_FINAL}", "", $entorno);
            $entorno = str_replace("{ESTILO_NOTA_FINAL}", "etiquetaPrograma-pendiente", $entorno);
            $entorno = str_replace("{ICONO_NOTA_FINAL}", "circle-icon-sgd-3", $entorno);
            $entorno = str_replace("{CRITERIO_NOTA_FINAL}", "Pendiente", $entorno);
        }
    } else {
        $entorno = str_replace("{NOTA_FINAL}", "", $entorno);
        $entorno = str_replace("{ESTILO_NOTA_FINAL}", "etiquetaPrograma-pendiente", $entorno);
        $entorno = str_replace("{ICONO_NOTA_FINAL}", "circle-icon-sgd-3", $entorno);
        $entorno = str_replace("{CRITERIO_NOTA_FINAL}", "Pendiente", $entorno);
    }
    $nota_final_evaluados_ae = $acummulador_notas_ae / $contador_ae;
    if ($nota_final_evaluados_ae) {
        if ($calibrador) {
            //$datos_nota_final_evaluados_ae=ObtenerCriterioPuntajeMatrizNotaFinal($nota_final_evaluados_ae, $evaluados[0]->evaluador, 0, "nota_final", $evaluados[0]->evaluador, $id_proceso);
            $datos_nota_final_evaluados_ae = ObtenerCriterioPuntajeMatrizNotaFinal($nota_final_evaluados_ae, "", 0, "nota_final", $rut_evaluador, $id_proceso);
        } else {
            //$datos_nota_final_evaluados_ae=ObtenerCriterioPuntajeMatrizNotaFinal($nota_final_evaluados_ae, $rut_evaluador, 0, "nota_final", $evaluados[0]->evaluador, $id_proceso);
            $datos_nota_final_evaluados_ae = ObtenerCriterioPuntajeMatrizNotaFinal($nota_final_evaluados_ae, "", 0, "nota_final", $rut_evaluador, $id_proceso);
        }
        $entorno = str_replace("{NOTA_COMP_ESPE_INT_AE}", ColocaDecimalesNotasFinales(2, $nota_final_evaluados_ae), $entorno);
        $entorno = str_replace("{ESTILO_COMP_ESPE_INT_AE}", $datos_nota_final_evaluados_ae[2], $entorno);
        $entorno = str_replace("{ICONO_COMP_ESPE_INT_AE}", $datos_nota_final_evaluados_ae[3], $entorno);
        $entorno = str_replace("{CRITERIO_COMP_ESPE_INT_AE}", $datos_nota_final_evaluados_ae[0], $entorno);
    } else {
        $entorno = str_replace("{NOTA_COMP_ESPE_INT_AE}", "", $entorno);
        $entorno = str_replace("{ESTILO_COMP_ESPE_INT_AE}", "etiquetaPrograma-pendiente", $entorno);
        $entorno = str_replace("{ICONO_COMP_ESPE_INT_AE}", "circle-icon-sgd-3", $entorno);
        $entorno = str_replace("{CRITERIO_COMP_ESPE_INT_AE}", "Pendiente", $entorno);
    }
    return ($entorno);
}
function CalibraEval($html, $evaluado, $evaluador, $id_proceso, $id_empresa)
{
    $datos_proceso_evaluacion = TraeProcesosDeEvaluacionPorEmpresaYDiProceso($id_empresa, $id_proceso);
    $decimales_para_proceso   = $datos_proceso_evaluacion[0]->decimales_puntajes;
    $datos_evaluado           = UsuarioEnBasePersonas($evaluado);
    $datos_perfil_evaluacion  = UsuarioEnBasePersonas2PorProceso($evaluado, $id_proceso);
    //Bloque Resumen Superior
    $template_top             = file_get_contents("views/sgd/informe/tabla_superior_informe.html");
    //$total_evaluados.=ColocaDatosUsuario($template_top, $evaluado);
    $total_evaluados .= ColocaDatosUsuarioSGD($template_top, $evaluado, "", $evaluador, $id_proceso);
    $total_evaluados = str_replace("{TABLA_RESUMEN1}", file_get_contents("views/sgd/informe/tabla_superior_resumen/tabla_resumen1_sinareacorp_dinamico.html"), $total_evaluados);
    $total_evaluados = ArmaTemplareDeTablaResumen($total_evaluados, $_SESSION["ano_proceso_anual"], $id_empresa, $datos_perfil_evaluacion[0]->perfil_evaluacion, $evaluado, $evaluador, "no");
    $html            = str_replace("{BLOQUE_RESUMEN_EVALUADO}", $total_evaluados, $html);
    $html            = str_replace("{PASOS}", "", $html);
    //Bloque de detalle por competencias
    //$competencias=CompetenciasDadoPerfil($datos_perfil_evaluacion[0]->perfil_evaluacion, $evaluado, $evaluador);
    $competencias    = CompetenciasDadoPerfilPorProceso($datos_perfil_evaluacion[0]->perfil_evaluacion, $evaluado, $evaluador, $id_proceso);
    $html            = str_replace("{NOMBRE_INFORME_EVALUACION}", ($datos_proceso_evaluacion[0]->titulo_informes_proceso), $html);
    //Aca pregunto si es que se muestra o no el promedio de las competencias.
    if ($datos_proceso_evaluacion[0]->muestra_promedio_competencias == 1) {
        $row                      = file_get_contents("views/sgd/informe/row_informe1_comp.html");
        $row                      = str_replace("{NOMBRE}", "Promedio por Competencias", $row);
        $nota_final_competencias  = ObtieneNotaFinalCompetencias($datos_perfil_evaluacion[0]->perfil_evaluacion, $evaluado, $evaluador, $id_proceso);
        $criterios_nota_final     = ObtenerCriterioPuntajeMatrizNotaFinal($nota_final_competencias[0], $evaluado, "", "comp", $evaluador, $id_proceso);
        $row                      = str_replace("{NOMBRE}", "Promedio por Competencias", $row);
        $row                      = str_replace("{ESTILO_ETIQUETA}", $criterios_nota_final[2], $row);
        $row                      = str_replace("{ICONO}", $criterios_nota_final[3], $row);
        $row                      = str_replace("{CRITERIO}", $criterios_nota_final[0], $row);
        $row                      = str_replace("{NOTA}", FormatearPorcentajesSinDecimal($nota_final_competencias[0]) . "", $row);
        $template_row_competencia = file_get_contents("views/sgd/informe/row_informe1_comp_v2.html");
    } else {
        //$template_row_competencia=file_get_contents("views/sgd/informe/row_informe1_comp_calibra.html");
        $template_row_competencia = file_get_contents("views/sgd/informe/row_informe1_comp_calibra.html");
    }
    $i = 0;
    foreach ($competencias as $com) {
        //$row.=file_get_contents("views/sgd/informe/row_informe1_comp.html");
        $row .= $template_row_competencia;
        $criterios                          = ObtenerCriterioPuntajeMatrizNotaFinal($com->nota_promedio, $evaluado, "", "comp", $evaluador, $id_proceso);
        $row                                = str_replace("{NOMBRE}", $com->nombre_componente, $row);
        $matriz_competencias[$i]["nombre"]  = $com->sigla;
        $row                                = str_replace("{ID_COMPETENCIA_NAME}", $com->id_componente, $row);
        $row                                = str_replace("{ID_COMPETENCIA_ENCODEADO}", Encodear3($com->id_componente), $row);
        $row                                = str_replace("{DESCRIPCION}", $com->descripcion_componente, $row);
        $row                                = str_replace("{RUT_EVALUADOR_ENCODEADO}", Encodear3($evaluador), $row);
        $row                                = str_replace("{RUT_EVALUADO_ENCODEADO}", Encodear3($evaluado), $row);
        $row                                = str_replace("{ID_PROCESO_ENCODEADO}", Encodear3($id_proceso), $row);
        $row                                = str_replace("{PONDERACION}", "", $row);
        $row                                = str_replace("{ESTILO_ETIQUETA}", $criterios[2], $row);
        $row                                = str_replace("{ICONO}", $criterios[3], $row);
        $row                                = str_replace("{CRITERIO}", $criterios[0], $row);
        //$row = str_replace("{NOTA}",FormatearPorcentajesSinDecimal($com->nota_promedio)."%",$row);
        $row                                = str_replace("{NOTA}", ColocaDecimalesNotasFinales($decimales_para_proceso, $com->nota_promedio, $tipo) . "", $row);
        $matriz_competencias[$i]["nota"]    = ($com->nota_promedio);
        $row                                = str_replace("{NOTA_CALIBRA}", ColocaDecimalesNotasFinales($decimales_para_proceso, $com->nota_promedio, $tipo) . "", $row);
        //AE
        //BLOQUE PARA MOSTRAR NOTAS AE
        $competencias_ae                    = CompetenciasDadoPerfilPorCompetencia($datos_perfil_evaluacion[0]->perfil_evaluacion, $evaluado, $evaluado, $com->id_competencia);
        $criterios_ae                       = ObtenerCriterioPuntajeMatrizNotaFinal($competencias_ae[0]->nota_promedio, $evaluado, "", "comp", $evaluador, $id_proceso);
        $row                                = str_replace("{ESTILO_ETIQUETA_AE}", $criterios_ae[2], $row);
        $row                                = str_replace("{ICONO_AE}", $criterios_ae[3], $row);
        $row                                = str_replace("{CRITERIO_AE}", $criterios_ae[0], $row);
        $row                                = str_replace("{NOTA_AE}", FormatearPorcentajesSinDecimal($competencias_ae[0]->nota_promedio) . "%", $row);
        $matriz_competencias[$i]["nota_ae"] = FormatearPorcentajesSinDecimal($competencias_ae[0]->nota_promedio);
        /*$row = str_replace("{ESTILO_ETIQUETA_AE}",$criterios_ae[2],$row);
        $row = str_replace("{ICONO_AE}",$criterios_ae[3],$row);
        $row = str_replace("{CRITERIO_AE}",$criterios_ae[0],$row);
        $row = str_replace("{NOTA_AE}",FormatearPorcentajesSinDecimal($competencias_ae[0]->nota_promedio)."",$row);
        $matriz_competencias[$i]["nota_ae"]=FormatearPorcentajesSinDecimal($competencias_ae[0]->nota_promedio);
        * */
        $i++;
        //Por cada competencia veo si tiene mas de una pregunta ,si es asi, las muestra, con la
        //Respuesta correspondiente
        if ($com->muestra_preguntas_informe == 1) {
            $preguntas_por_competencias = PreguntasPorCompetenciaConRespuesta($com->id_competencia, $evaluado, $evaluador, $id_proceso);
            $row_preg                   = "";
            //echo "$evaluado $evaluador <br>";
            foreach ($preguntas_por_competencias as $preg_uni) {
                //$row_preg.=file_get_contents("views/sgd/informe/row_informe1.1_comp.html");
                $row_preg .= file_get_contents("views/sgd/informe/row_informe1.1_comp_preg_calibra.html");
                $row_preg                      = str_replace("{NOMBRE_1}", $preg_uni->pregunta, $row_preg);
                $row_preg                      = str_replace("{NOMBRE_PREGUNTA}", $preg_uni->id, $row_preg);
                $row_preg                      = str_replace("{NOMBRE_PREGUNTA_COMPUESTO}", $evaluado . "-" . $preg_uni->id, $row_preg);
                $row_preg                      = str_replace("{RUT_EVALUADO_ENCODEADO}", Encodear3($evaluado), $row_preg);
                $row_preg                      = str_replace("{RUT_EVALUADOR_ENCODEADO}", Encodear3($evaluador), $row_preg);
                $row_preg                      = str_replace("{ID_PROCESO_ENCODEADO}", Encodear3($id_proceso), $row_preg);
                $row_preg                      = str_replace("{ID_PREGUNTA_ENCODEADO}", Encodear3($preg_uni->id), $row_preg);
                $row_preg                      = str_replace("{ID_COMPETENCIA_ENCODEADO}", Encodear3($com->id_competencia), $row_preg);
                $row_preg                      = str_replace("{DESCRIPCION_1}", "", $row_preg);
                $row_preg                      = str_replace("{PONDERACION_1}", "", $row_preg);
                $criterios_detalle_preg        = ObtenerCriterioPuntajeMatrizNotaFinal($preg_uni->puntaje, $evaluado, "", "comp", $evaluador, $id_proceso);
                $row_preg                      = str_replace("{ESTILO_ETIQUETA_1}", $criterios_detalle_preg[2], $row_preg);
                $row_preg                      = str_replace("{ICONO_1}", $criterios_detalle_preg[3], $row_preg);
                $row_preg                      = str_replace("{CRITERIO_1}", $criterios_detalle_preg[0], $row_preg);
                $row_preg                      = str_replace("{NOTA_1}", FormatearPorcentajesSinDecimal($preg_uni->puntaje) . "", $row_preg);
                //PARA AE
                $preguntas_por_competencias_ae = PreguntasPorCompetenciaConRespuestaPorPregunta($com->id_competencia, $evaluado, $evaluado, $id_proceso, $preg_uni->id);
                $criterios_detalle_preg_ae     = ObtenerCriterioPuntajeMatrizNotaFinal($preguntas_por_competencias_ae[0]->puntaje, $evaluado, "", "comp", $evaluador, $id_proceso);
                $row_preg                      = str_replace("{ESTILO_ETIQUETA_1_AE}", $criterios_detalle_preg_ae[2], $row_preg);
                $row_preg                      = str_replace("{ICONO_1_AE}", $criterios_detalle_preg_ae[3], $row_preg);
                $row_preg                      = str_replace("{CRITERIO_1_AE}", $criterios_detalle_preg_ae[0], $row_preg);
                $row_preg                      = str_replace("{NOTA_1_AE}", FormatearPorcentajesSinDecimal($preguntas_por_competencias_ae[0]->puntaje) . "", $row_preg);
            }
        }
        $row .= $row_preg;
        $row .= "</form>";
    }
    $html              = str_replace("{LISTADO_COMPETENCIAS}", ($row), $html);
    $html              = str_replace("{BLOQUE_ESPECIFICOS}", "", $html);
    //Objetivos Empresa
    $objetivos_empresa = ObjetivosDeEmpresaConNota($datos_evaluado[0]->id_empresa, $id_proceso);
    if ($objetivos_empresa) {
        $html = str_replace("{BLOQUE_COORPORATIVOS}", file_get_contents("views/sgd/informe/entorno_informe_bloque_corporativo.html"), $html);
        foreach ($objetivos_empresa as $ob) {
            //$row3.=file_get_contents("views/sgd/informe/row_informe1_desactivado.html");
            $row3 .= file_get_contents("views/sgd/informe/row_informe1.html");
            $row3   = str_replace("{NOMBRE}", $ob->descripcion_objetivo, $row3);
            $row3   = str_replace("{PONDERACION}", "30%", $row3);
            $row3   = str_replace("{DESCRIPCION}", "", $row3);
            $datos3 = ObtenerCriterioPuntajeMatrizNotaFinal($ob->nota, $evaluado, "", "corp", $evaluador, $id_proceso);
            $row3   = str_replace("{NOTA}", FormatearPorcentajesSinDecimal($ob->nota) . "%", $row3);
            $row3   = str_replace("{ESTILO_ETIQUETA}", $datos3[2], $row3);
            $row3   = str_replace("{CRITERIO}", $datos3[0], $row3);
            $row3   = str_replace("{ICONO}", $datos3[3], $row3);
        }
        $html = str_replace("{LISTADO_OBJETIVOS_CORPORATIVOS}", ($row3), $html);
    } else {
        $html = str_replace("{BLOQUE_COORPORATIVOS}", "", $html);
    }
    //OBJETIVOS AREA
    $datos_usuario               = UsuarioEnBasePersonasInnerArea($evaluado);
    //con el id del area, y el id de la empresa, traigo los datos de los objetivos de area
    $html                        = str_replace("{BLOQUE_AREA}", "", $html);
    $datos_evaluacion_resultados = ResultadosFinales($evaluado, $evaluador, $id_procesoo);
    $html                        = str_replace("{ESTILO_OBJIND}", $datos_evaluacion_resultados[0], $html);
    $html                        = str_replace("{ICONO_OBJIND}", $datos_evaluacion_resultados[4], $html);
    $html                        = str_replace("{CRITERIO_OBJETIVOS_IND}", $datos_evaluacion_resultados[1], $html);
    $html                        = str_replace("{ESTILO_COMP}", $datos_evaluacion_resultados[2], $html);
    $html                        = str_replace("{ICONO_COMP}", $datos_evaluacion_resultados[5], $html);
    $html                        = str_replace("{CRITERIO_COMPETENCIAS}", $datos_evaluacion_resultados[3], $html);
    //Graficos Individuales
    $html                        = str_replace("{GRAFICO_COMPETENCIAS}", GraficoPorCompetenciasPorEvaluadorCalibrador($evaluador, $id_proceso, "", $evaluado), $html);
    //Grafico de Ara?a
    $html                        = str_replace("{GRAFICO_ARANA}", GraficoArana($matriz_competencias), $html);
    return ($html);
}
function EstadoAvanceLiberacionCalibracion($rut_calibrador, $id_proceso, $evaluador)
{
    if ($evaluador) {
        //$cantidad_calibraciones=TraeCantidadDeCalibracionesPorEvaluador($rut_calibrador, $id_proceso, $evaluador);
        $cantidad_calibraciones = TraeCantidadDeCalibracionesPorEvaluadorSinAe($rut_calibrador, $id_proceso, $evaluador);
    } else {
        //$cantidad_calibraciones=TraeCantidadDeCalibraciones($rut_calibrador, $id_proceso);
        $cantidad_calibraciones = TraeCantidadDeCalibracionesSinAe($rut_calibrador, $id_proceso);
    }
    //Veo cuantos ya he liberado
    $cantidad_liberados = TraeCantidadLiberadosPorCalibrador($rut_calibrador, $id_proceso);
    //$arreglo[0]=count($cantidad_calibraciones)-count($cantidad_liberados);
    $arreglo[0]         = count($cantidad_calibraciones);
    //echo $arreglo[0]." aca";
    if ($arreglo[0] == "") {
    }
    $arreglo[1] = count($cantidad_liberados);
    return ($arreglo);
}
function ColocaGraficoAvanceLiberados($PRINCIPAL, $rut_calibrador, $id_proceso, $id_empresa)
{
    $grafico       = file_get_contents("views/sgd/graficos/graficoTorta.html");
    //Veo cuantos debe calibrar
    $datos         = EstadoAvanceLiberacionCalibracion($rut_calibrador, $id_proceso);
    $grafico       = str_replace("{DETIPO}", "evaluaciones liberadas", $grafico);
    $grafico       = str_replace("{PIECHART_SGD}", $rut_calibrador, $grafico);
    $grafico       = str_replace("{TOTAL_PENDIENTES}", $datos[0], $grafico);
    $grafico       = str_replace("{TOTAL_LIBERADOS}", $datos[1], $grafico);
    $grafico       = str_replace("{TOTAL_MENOS_LIBERADOS}", $datos[0] - $datos[1], $grafico);
    $grafico       = str_replace("{TOTAL_MENOS_LIBERADOS}", $datos[0] - $datos[1], $grafico);
    $datos_proceso = TraeProcesosDeEvaluacionPorEmpresaYDiProceso($id_empresa, $id_proceso);
    $grafico       = str_replace("{COLOR_GRAFICO_2}", $datos_proceso[0]->color_grafico_2, $grafico);
    $PRINCIPAL     = str_replace("{GRAFICO_TORTA}", $grafico, $PRINCIPAL);
    return ($PRINCIPAL);
}
function ListadoTotalColaboradoresPreviaCalibracion($html, $rut, $proceso_anual, $id_empresa, $id_proceso, $calibrador, $id_proceso_calibrar)
{
    $entorno              = file_get_contents("views/sgd/sgd2_entorno_equipo_chilquinta_calibracion.html");
    $entorno              = str_replace("{SECCION_GRAFICOS_CONSOLIDADOS}", file_get_contents("views/sgd/vista_consolidada_graficos.html"), $entorno);
    $entorno              = str_replace("{GRAFICO1.1}", ConsolidadoLineal($rut, "", $id_proceso_calibrar, $id_empresa), $entorno);
    $entorno              = str_replace("{GRAFICO1.2}", GraficoPorCompetenciasPorEvaluadorCalibrador($rut, $id_proceso_calibrar, ""), $entorno);
    $entorno              = ObtieneResumenesNotasFinalesPorEvaluador($entorno, $rut, $id_proceso_calibrar);
    //$entorno = str_replace("{TABLA_DATOS_USUARIO_SsUPERIOR}",file_get_contents("views/sgd/tabla_datos_superior_usuario.html"),$entorno);
    $entorno              = str_replace("{GRAFICO_TORTA}", "", $entorno);
    $entorno              = ColocaDatosUsuario($entorno, $rut, "graficoFrecuenciaCompetencia");
    //Aca valido si el evaluador termino sus evaluaciones, en tabla tbl_sgd_finalizados_evaluador.
    $finalizado_evaluador = FinalizadoEvaluador($rut);
    if ($finalizado_evaluador) {
        $entorno = str_replace("{LINK_EVALUACION_EQUIPO}", "sgd2", $entorno);
    } else {
        $entorno = str_replace("{LINK_EVALUACION_EQUIPO}", "ev#pag", $entorno);
    }
    //Aca traigo ellistado total de los colaboradores
    //$evaluados=TraeEvaluadosDadoEvaluador($rut);
    //$evaluados=TraeEvaluadosDadoEvaluadorSinMiPerfil($rut);
    //$evaluados=TraeEvaluadosDadoEvaluadorPorProceso($rut);
    //$evaluados=TraeEvaluadosDadoEvaluadorPorProcesoSinAe($rut, $id_proceso_calibrar);
    $evaluados = TraeEvaluadosDadoEvaluadorPorProcesoSinAePorProceso($rut, $id_proceso_calibrar);
    //$evaluados=TraeEvaluadosDadoEvaluadorPorProceso2($rut, $id_proceso_calibrar);
    if (!$evaluados) {
        $html = str_replace("{ENTORNO_LISTADO_COLABORADORES}", "
            <div class='row'>
</div>
            ", $html);
    } else {
        $total_evaluados = "";
        $obj_fin         = 0;
        foreach ($evaluados as $ev) {
            $row = file_get_contents("views/sgd/listado_colaboradores/row_colaboradores_previa_calibracion.html");
            $total_evaluados .= ColocaDatosUsuario($row, $ev->rut);
            //COMENTADO PARA OPTIMIZAR 22-11-2015
            if ($id_empresa == 28) {
                $total_evaluados     = str_replace("{TABLA_RESUMEN1}", file_get_contents("views/sgd/informe/tabla_superior_resumen/tabla_resumen1_sinareacorp_dinamico_chilquinta.html"), $total_evaluados);
                $total_evaluados     = str_replace("{BOTON_EVALUACION_INDIVIDUAL}", file_get_contents("views/sgd/informe/tabla_superior_resumen/boton_eval_individual.html"), $total_evaluados);
                //Verifico si est? finalizada la evaluacion de este proceso
                $verifica_finalizado = FinalizadoEvaluadoEvaluador($ev->rut, $ev->evaluador, $ev->id_proceso);
                if ($verifica_finalizado) {
                    //Verifico tambien si est? liberado o no por el calibrador
                    $verifica_liberado = TraeLiberadoEvaluadoEvaluadorCalibrador($ev->rut, $ev->evaluador, $calibrador, $ev->id_proceso);
                    if ($verifica_liberado) {
                        $total_evaluados = str_replace("{BOTON}", file_get_contents("views/sgd/evaluacion/boton_ver_informe.html"), $total_evaluados);
                    } else {
                        $total_evaluados = str_replace("{BOTON}", file_get_contents("views/sgd/listado_colaboradores/boton_calibra_individual.html"), $total_evaluados);
                    }
                } else {
                    $total_evaluados = str_replace("{BOTON}", "", $total_evaluados);
                }
                $estado_liberado_feedback = LiberadoFeedbackLiberado($ev->rut, $ev->evaluador, $ev->calibrador, $ev->id_proceso, $id_empresa);
                $total_evaluados          = str_replace("{ETIQUETA_ESTADO}", $estado_liberado_feedback[0], $total_evaluados);
                $total_evaluados          = str_replace("{RUT_EVALUADO_ENCODEADO}", Encodear3($ev->rut), $total_evaluados);
                $total_evaluados          = str_replace("{RUT_EVALUADOR_ENCODEADO}", Encodear3($ev->evaluador), $total_evaluados);
                $total_evaluados          = str_replace("{ID_PROCESO_ENCODEADO}", Encodear3($ev->id_proceso), $total_evaluados);
                //Aca traigo la nota final de cadaevaluadopara acumular y mostrar en el resumen superior
                $datos_resumen            = ResultadosFinales($ev->rut, $rut, $id_proceso, "");
                if ($datos_resumen[27] > 0) {
                    $acummulador_notas = $acummulador_notas + $datos_resumen[27];
                    $contador++;
                }
            } else {
                $total_evaluados = str_replace("{TABLA_RESUMEN1}", file_get_contents("views/sgd/informe/tabla_superior_resumen/tabla_resumen1_sinareacorp_dinamico.html"), $total_evaluados);
            }
            $total_evaluados    = ArmaTemplareDeTablaResumen($total_evaluados, $proceso_anual, $id_empresa, $ev->perfil_evaluacion, $ev->rut, $rut);
            //Verifico si est? finalizado este evaluado en el proceso de objetivos
            $feedback_objetivos = TomoConocimientoEvaluado($ev->rut);
            if ($feedback_objetivos) {
                $obj_fin++;
            }
            //$total_evaluados = ColocaPonderaciones($total_evaluados, $ev->rut);
            $total_evaluados = str_replace("{RUT_EVALUADO_ENCODEADO}", Encodear3($ev->rut), $total_evaluados);
            //$total_evaluados=ColocaResultadosTablaReumen($total_evaluados, $ev->rut, $rut);
            $total_evaluados = SemaforosEstadosObjetivos($total_evaluados, $ev->rut, $_SESSION["ano_proceso_anual"]);
            //COMENTADO PARA OPTIMIZAR 22-11-2015
            //$total_evaluados = str_replace("{PARAMETROS_EVAL}",Encodear3($ev->rut.";".$rut),$total_evaluados);
        }
        $nota_final_evaluados = $acummulador_notas / $contador;
        if ($nota_final_evaluados) {
            $datos_nota_final_evaluados = ObtenerCriterioPuntajeMatrizNotaFinal($nota_final_evaluados, $rut, 0, "nota_final");
            $entorno                    = str_replace("{NOTA_FINAL}", ColocaDecimalesNotasFinales(2, $nota_final_evaluados), $entorno);
            $entorno                    = str_replace("{ESTILO_NOTA_FINAL}", $datos_nota_final_evaluados[2], $entorno);
            $entorno                    = str_replace("{ICONO_NOTA_FINAL}", $datos_nota_final_evaluados[3], $entorno);
            $entorno                    = str_replace("{CRITERIO_NOTA_FINAL}", $datos_nota_final_evaluados[0], $entorno);
        } else {
            $entorno = str_replace("{NOTA_FINAL}", "", $entorno);
            $entorno = str_replace("{ESTILO_NOTA_FINAL}", "etiquetaPrograma-pendiente", $entorno);
            $entorno = str_replace("{ICONO_NOTA_FINAL}", "circle-icon-sgd-3", $entorno);
            $entorno = str_replace("{CRITERIO_NOTA_FINAL}", "Pendiente", $entorno);
        }
        //aca calculo el porcentaje de avance de objetivos de todos los colaboradores.
        $entorno = str_replace("{POR_AVANCE_OBJ}", ($obj_fin * 100) / count($evaluados), $entorno);
        $entorno = str_replace("{POR_AVANCE_EV_EQUIPO}", 0, $entorno);
        $entorno = str_replace("{LISTADO_COLABORADORES}", ($total_evaluados), $entorno);
        $html    = str_replace("{ENTORNO_LISTADO_COLABORADORES}", ($entorno), $html);
    }
    return ($html);
}
function ColocaTitulosDinamicosPorEmpresa($PRINCIPAL, $id_empresa, $seccion)
{
    $titulos = TitulosDinamicosPorEmpresaEnv($id_empresa, $seccion);
    foreach ($titulos as $tit) {
        $PRINCIPAL = str_replace($tit->etiqueta, ($tit->titulo), $PRINCIPAL);
    }
    return ($PRINCIPAL);
}
function ListadoTotalCalibrador($html, $rut, $proceso_anual, $id_empresa, $id_proceso, $id_proceso_a_calibrar)
{
    $html                = str_replace("{RUT_EVALUADO_ENCODEADO}", Encodear3($rut), $html);
    $datos_evaluado_jefe = UsuarioEnBasePersonas($rut);
    $datos_usuario       = UsuarioEnBasePersonas($rut);
    $html                = str_replace("{NOMBRE_DEPENDIENTE}", ($datos_usuario[0]->nombre), $html);
    $html                = str_replace("{PARAMETROS_EVAL}", Encodear3($ev->rut . ";" . $rut), $html);
    $entorno             = file_get_contents("views/sgd/sgd2_entorno_equipo_chilquinta_calibracion.html");
    $entorno             = str_replace("{TABLA_DATOS_USUARIO_SUPERIOR}", file_get_contents("views/sgd/tabla_datos_superior_usuario.html"), $entorno);
    $entorno             = ColocaDatosUsuario($entorno, $rut, "graficoFrecuenciaCompetencia");
    $entorno             = str_replace("{SECCION_GRAFICOS_CONSOLIDADOS}", file_get_contents("views/sgd/vista_consolidada_graficos.html"), $entorno);
    $entorno             = str_replace("{GRAFICO1.1}", ConsolidadoLineal("", $rut, $id_proceso_a_calibrar, $id_empresa), $entorno);
    $entorno             = str_replace("{GRAFICO1.2}", GraficoPorCompetenciasPorEvaluadorCalibrador("", $id_proceso_a_calibrar, $rut), $entorno);
    $evaluadores         = TraeEvaluadoresPorProcesoDadoCalibrador($rut, $id_proceso_a_calibrar);
    if (!$evaluadores) {
        $html = str_replace("{ENTORNO_LISTADO_COLABORADORES}", "
            <div class='row'>
            </div>
            ", $html);
    } else {
        $total_evaluados = "";
        $obj_fin         = 0;
        foreach ($evaluadores as $ev) {
            $row = file_get_contents("views/sgd/listado_colaboradores/row_colaboradores_calibracion.html");
            $total_evaluados .= ColocaDatosUsuario($row, $ev->rut);
            //COMENTADO PARA OPTIMIZAR 22-11-2015
            $total_evaluados = ColocaAvanceEvaluadorDadoLosFinalizados($total_evaluados, $ev->rut, $id_proceso_a_calibrar, $id_empresa);
            if ($id_empresa == 28) {
                $total_evaluados          = str_replace("{TABLA_RESUMEN1}", file_get_contents("views/sgd/informe/tabla_superior_resumen/tabla_resumen1_sinareacorp_dinamico_chilquinta.html"), $total_evaluados);
                $total_evaluados          = str_replace("{BOTON_EVALUACION_INDIVIDUAL}", file_get_contents("views/sgd/informe/tabla_superior_resumen/boton_eval_individual.html"), $total_evaluados);
                //Verifico si est? finalizada la evaluacion de este proceso
                $verifica_eval_finalizada = FinalizadoEvaluadoEvaluador($ev->rut, $rut, $id_proceso);
                if ($verifica_eval_finalizada) {
                    $total_evaluados = str_replace("{BOTON_VE_INFORME_POR_PROCESO}", file_get_contents("views/sgd/informe/tabla_superior_resumen/boton_ve_informe.html"), $total_evaluados);
                } else {
                    $total_evaluados = str_replace("{BOTON_VE_INFORME_POR_PROCESO}", "", $total_evaluados);
                }
                $total_evaluados = str_replace("{RUT_EVALUADO_ENCODEADO}", Encodear3($ev->rut), $total_evaluados);
                $total_evaluados = str_replace("{ID_PROCESO_ENCODEADO}", Encodear3($id_proceso), $total_evaluados);
            } else {
                $total_evaluados = str_replace("{TABLA_RESUMEN1}", file_get_contents("views/sgd/informe/tabla_superior_resumen/tabla_resumen1_sinareacorp_dinamico.html"), $total_evaluados);
            }
            //$total_evaluados=ArmaTemplareDeTablaResumen($total_evaluados, $proceso_anual, $id_empresa, $ev->perfil_evaluacion, $ev->rut, $rut);
            //Verifico si est? finalizado este evaluado en el proceso de objetivos
            $feedback_objetivos = TomoConocimientoEvaluado($ev->rut);
            if ($feedback_objetivos) {
                $obj_fin++;
            }
            //$total_evaluados = ColocaPonderaciones($total_evaluados, $ev->rut);
            $verifico_si_libero = EstadoAvanceLiberacionCalibracion($rut, $id_proceso_a_calibrar, $ev->rut);
            //if($verifico_si_libero[0]==0){
            if ($verifico_si_libero[0] == $verifico_si_libero[1]) {
                //$total_evaluados = str_replace("{BOTON_LIBERAR}","",$total_evaluados);
                $total_evaluados = str_replace("{BOTON_LIBERAR}", file_get_contents("views/sgd/listado_colaboradores/boton_liberar.html"), $total_evaluados);
                $total_evaluados = str_replace("{BOTON_VER_EVALUADOS_PARA_CALIBRAR}", file_get_contents("views/sgd/listado_colaboradores/boton_ve_colaboradores.html"), $total_evaluados);
            } else {
                $total_evaluados = str_replace("{BOTON_LIBERAR}", file_get_contents("views/sgd/listado_colaboradores/boton_liberar.html"), $total_evaluados);
                //aca debo verificar si la evaluacion de este evaluado est? finalizada o no.
                $total_evaluados = str_replace("{BOTON_VER_EVALUADOS_PARA_CALIBRAR}", file_get_contents("views/sgd/listado_colaboradores/boton_ve_colaboradores_para_calibrar.html"), $total_evaluados);
            }
            $total_evaluados = str_replace("{ID_PROCESO_CALIBRAR_ENCODEADO}", Encodear3($id_proceso_a_calibrar), $total_evaluados);
            $total_evaluados = str_replace("{RUT_EVALUADO_ENCODEADO}", Encodear3($ev->rut), $total_evaluados);
            $total_evaluados = str_replace("{RUT_EVALUADOR_ENCODEADO}", Encodear3($ev->rut), $total_evaluados);
            $total_evaluados = str_replace("{RUT_CALIBRADOR_ENCODEADO}", Encodear3($rut), $total_evaluados);
            $total_evaluados = str_replace("{ID_PROCESO_CALIBRAR}", Encodear3($id_proceso_a_calibrar), $total_evaluados);
            $total_evaluados = str_replace("{ID_PROCESO}", Encodear3($id_proceso), $total_evaluados);
            $total_evaluados = ObtieneResumenesNotasFinalesPorEvaluador($total_evaluados, $ev->rut, $id_proceso_a_calibrar);
        }
        $entorno = ObtieneResumenesNotasFinalesPorEvaluador($entorno, "", $id_proceso_a_calibrar, $rut);
        //aca calculo el porcentaje de avance de objetivos de todos los colaboradores.
        $entorno = str_replace("{POR_AVANCE_OBJ}", ($obj_fin * 100) / count($evaluados), $entorno);
        $entorno = str_replace("{POR_AVANCE_EV_EQUIPO}", 0, $entorno);
        $entorno = str_replace("{LISTADO_COLABORADORES}", ($total_evaluados), $entorno);
        $html    = str_replace("{ENTORNO_LISTADO_COLABORADORES}", ($entorno), $html);
    }
    return ($html);
}
function ColocaDecimalesNotasFinales($numero_decimales, $valor, $tipo)
{
    if ($numero_decimales > 0) {
        return (number_format($valor, $numero_decimales, ".", "."));
    } else {
        return (round($valor));
    }
}
function colocarArchivosDirectores($rut, $id_empresa)
{
    $verifica = VerificoEnTablaDeDirectores($rut, $id_empresa);
    if ($verifica) {
        $template = file_get_contents("views/pagina/descarga_documentos.html");
    } else {
        $template = "";
    }
    return ($template);
}
Function PorcentajeAvanceEvaluador($evaluador, $id_proceso)
{
    //$perfiles=TotalPerfilesDadoEvaluador1PorProceso($evaluador, $id_proceso);
    //for($i=0;$i<count($perfiles);$i++){
    //        $sql.=" perfil_evaluacion='".$perfiles[$i]->id_perfil_ev."'";
    //        if($perfiles[$i+1]->id_perfil_ev) $sql.=" or";
    //    }
    //    $total_paginas=count(TotalIdCompetencias($sql));
    //Obtengo la pagina que esta el evaluador
    //    $pagina_actual=SesionSGDSoloEvaluador($evaluador, $id_proceso);
    //    $porcentaje_avance[0]=FormatearPorcentajesSinDecimal(($pagina_actual[0]->pagina*100)/$total_paginas);
    //    return($porcentaje_avance);
}
function ColocaAvanceEvaluadorDadoLosFinalizados($PRINCIPAL, $evaluador, $id_proceso, $id_empresa, $origen, $arreglo_post)
{
    if ($arreglo_post["rutevaluador"])
        $evaluador = $arreglo_post["rutevaluador"];
    if ($arreglo_post["rutcalibrador"])
        $calibrador = $arreglo_post["rutcalibrador"];
    //traigo total de evaluadores
    if ($evaluador) {
        $evaluados = TraeEvaluadosDadoEvaluadorPorProceso2SinAe($evaluador, $id_proceso);
    } else if ($id_proceso) {
        $evaluados = TraeEvaluadosDadoEvaluadorPorProceso2SinAeSoloProceso($id_proceso, $arreglo_post);
    }
    $finaliza = 0;
    foreach ($evaluados as $eva) {
        $esta_finalizado = FinalizadoEvaluadoEvaluadorProProceso($eva->rut, $eva->evaluador, $eva->id_proceso);
        if ($esta_finalizado) {
            $finaliza++;
        }
    }
    //total evaluaciones
    $arreglo[0] = count($evaluados);
    $arreglo[1] = $finaliza;
    if ($origen == "admin") {
        $grafico = file_get_contents("../front/views/sgd/graficos/graficoTorta.html");
    } else {
        $grafico = file_get_contents("views/sgd/graficos/" . $id_empresa . "_graficoTorta.html");
    }
    if ($origen == "admin") {
        $grafico = str_replace("{PIECHART_SGD}", "graficoAdminAvance", $grafico);
    } else {
        $grafico = str_replace("{PIECHART_SGD}", $evaluador, $grafico);
    }
    $grafico       = str_replace("{DETIPO}", "evaluaciones realizadas", $grafico);
    $grafico       = str_replace("{TOTAL_LIBERADOS}", $finaliza, $grafico);
    $grafico       = str_replace("{TOTAL_PENDIENTES}", count($evaluados), $grafico);
    $grafico       = str_replace("{TOTAL_MENOS_LIBERADOS}", (count($evaluados) - $finaliza), $grafico);
    $datos_proceso = TraeProcesosDeEvaluacionPorEmpresaYDiProceso($id_empresa, $id_proceso);
    $grafico       = str_replace("{COLOR_GRAFICO_2}", $datos_proceso[0]->color_grafico_2, $grafico);
    $grafico       = str_replace("{TITULO_GRAFICO_2}", $datos_proceso[0]->titulo_grafico_2, $grafico);
    $PRINCIPAL     = str_replace("{GRAFICO_AVANCE_EVALUADOR}", $grafico, $PRINCIPAL);
    return ($PRINCIPAL);
}
function OptionDestinatariosPorUsuario($seleccionado, $rut, $id_empresa)
{
    if ($rut) {
        $destinatarios = DAtosDestinatariosPorUsuario($rut);
    } else {
        $destinatarios = TiposDestinatariosPorEmpresa($id_empresa);
    }
    foreach ($destinatarios as $unico) {
        if ($unico->tipo_destinatario == $seleccionado) {
            $options .= "<option selected value='" . $unico->tipo_destinatario . "'>" . $unico->nombre . "</option>";
        } else {
            $options .= "<option value='" . $unico->tipo_destinatario . "'>" . $unico->nombre . "</option>";
        }
    }
    return ($options);
}
function ListadoIngresoPlanesParaSeguimiento($evaluado, $evaluador, $id_plan)
{
    //$tiene_bitacora=TraeDatosPorBitacora($evaluado);
    $tiene_planes       = TraeDatosPorPlanes($evaluado);
    //VErifico si los planes estan finalizados
    $planes_finalizados = VerificaEstadoPlanes($evaluado);
    if ($tiene_planes) {
        foreach ($tiene_planes as $dato) {
            if ($dato->id == $id_plan) {
                $template .= file_get_contents("views/sgd/planes/row_plan_edicion.html");
                $template = str_replace("{OPTIONS_VALORES}", OptionsCompetenciasPorPerfil($evaluado->perfil_evaluacion, ""), $template);
                $template = str_replace("{OPTIONS_PLAZOS_POR_EMPRESA}", OptionsGenericoNombreDadoValoresPorEmpresa("tbl_planes_plazos", $dato->plazo, "nombre", "id", "order by orden asc", $_SESSION["id_empresa"]), $template);
            } else {
                if ($planes_finalizados) {
                    if ($evaluado <> $evaluador) {
                        $template .= file_get_contents("views/sgd/planes/row_plan_lectura_sin_editar.html");
                        if ($dato->jefe_sugiere) {
                            if ($dato->seguimiento_grado_cumplimiento) {
                                $template = str_replace("{BLOQUE_COMENTARIOS_JEFE}", file_get_contents("views/sgd/planes/bloque_comentarios_jefe_lectura.html") . file_get_contents("views/sgd/planes/bloque_seguimiento_por_plan_lectura.html"), $template);
                                $template = str_replace("{GRADO_CUMPLIMIENTO}", $dato->seguimiento_grado_cumplimiento, $template);
                                $template = str_replace("{COMENTARIO_CUMPLIMIENTO}", $dato->seguimiento_comentario, $template);
                            } else {
                                $template = str_replace("{BLOQUE_COMENTARIOS_JEFE}", file_get_contents("views/sgd/planes/bloque_comentarios_jefe_lectura.html") . file_get_contents("views/sgd/planes/bloque_seguimiento_por_plan.html"), $template);
                            }
                            if ($dato->jefe_sugiere == "si") {
                                $template = str_replace("{SUGIERE}", "La Jefatura acepta los planes", $template);
                            } else {
                                $template = str_replace("{SUGIERE}", "La Jefatura acepta con observaciones", $template);
                            }
                            $template = str_replace("{COMENTARIO}", $dato->jefe_comentario, $template);
                        } else {
                            $template = str_replace("{BLOQUE_COMENTARIOS_JEFE}", file_get_contents("views/sgd/planes/bloque_comentarios_jefe.html"), $template);
                        }
                        $template = str_replace("{ID_PLAN}", $dato->id, $template);
                        $template = str_replace("{RUT_EVALUADO}", $evaluado, $template);
                    } else {
                        $template .= file_get_contents("views/sgd/planes/row_plan_lectura_sin_editar.html");
                        if ($dato->jefe_sugiere) {
                            if ($dato->seguimiento_grado_cumplimiento) {
                                $template = str_replace("{BLOQUE_COMENTARIOS_JEFE}", file_get_contents("views/sgd/planes/bloque_comentarios_jefe_lectura.html") . file_get_contents("views/sgd/planes/bloque_seguimiento_por_plan_lectura.html"), $template);
                                $template = str_replace("{GRADO_CUMPLIMIENTO}", $dato->seguimiento_grado_cumplimiento, $template);
                                $template = str_replace("{COMENTARIO_CUMPLIMIENTO}", $dato->seguimiento_comentario, $template);
                            } else {
                                $template = str_replace("{BLOQUE_COMENTARIOS_JEFE}", file_get_contents("views/sgd/planes/bloque_comentarios_jefe_lectura.html"), $template);
                            }
                            if ($dato->jefe_sugiere == "si") {
                                $template = str_replace("{SUGIERE}", "La Jefatura acepta los planes", $template);
                            } else {
                                $template = str_replace("{SUGIERE}", "La Jefatura acepta con observaciones", $template);
                            }
                            $template = str_replace("{COMENTARIO}", $dato->jefe_comentario, $template);
                        } else {
                            $template = str_replace("{BLOQUE_COMENTARIOS_JEFE}", "", $template);
                        }
                    }
                } else {
                    if ($evaluado <> $evaluador) {
                        $template = file_get_contents("views/sgd/planes/row_plan_no_finalizado_por_evaluado.html");
                    } else {
                        $template .= file_get_contents("views/sgd/planes/row_plan_lectura.html");
                    }
                }
            }
            $template = str_replace("{COMPETENCIA}", ($dato->nombre_competencia), $template);
            $template = str_replace("{ACTIVIDAD_A_DESARROLLAR}", $dato->actividad_desarrollar, $template);
            $template = str_replace("{RESULTADO_ESPERADO}", $dato->resultado_esperado, $template);
            $template = str_replace("{FECHA_INICIO}", formatearFechaCompleta($dato->fecha_inicio), $template);
            $template = str_replace("{FECHA_TERMINO}", formatearFechaCompleta($dato->fecha_termino), $template);
            $template = str_replace("{PLAZOS}", $dato->plazo_nombre, $template);
            $template = str_replace("{ID_PLANES_ENCODEADO}", Encodear3($dato->id), $template);
        }
        $arreglo[0] = "si";
        $arreglo[1] = $template;
    } else {
        if ($evaluado <> evaluador) {
            $template = file_get_contents("views/sgd/planes/row_plan_no_finalizado_por_evaluado.html");
        } else {
            $template = file_get_contents("views/sgd/planes/sin_planes.html");
        }
        $arreglo[0] = "no";
        $arreglo[1] = $template;
    }
    return ($arreglo);
}
function ListadoColaboradoresPlanesSeguimiento($html, $evaluador, $rut_evaluado, $id_plan)
{
    $evaluados = EvaluadosDadoEvaluador($evaluador);
    //Se muestran los objetivos individuales.
    if ($_SESSION["id_empresa"] == 28) {
        $total_html   = file_get_contents("views/sgd/planes/entorno_bloque_principal_chilquinta.html");
        $template_row = file_get_contents("views/sgd/planes/row_colaboradores_chilquinta.html");
    } else {
        $total_html   = file_get_contents("views/sgd/planes/entorno_bloque_principal.html");
        $template_row = file_get_contents("views/sgd/planes/row_colaboradores.html");
    }
    //Primero veo si es que hay registro en la tabla de sesion
    $row           = "";
    $ok_finalizado = 0;
    foreach ($evaluados as $evaluado) {
        $row .= $template_row;
        $objetivos_validados_por_validador = VerificaSiObjetivosEstanValidados($evaluado->evaluado);
        if ($evaluado->evaluado == $evaluador) {
            $row = ColocaDatosUsuario($row, $evaluado->evaluado, "sinmensaje");
        } else {
            $row = ColocaDatosUsuario($row, $evaluado->evaluado, "sinmensaje");
        }
        //$listado=ListadoIngresoPlanes($evaluado->evaluado, $evaluador, $id_plan, "jefe");
        $listado                    = ListadoIngresoPlanesParaSeguimiento($evaluado->evaluado, $evaluador, $id_plan, "jefe");
        $row                        = str_replace("{LISTADO_OBJETIVOS_A_EVALUAR}", $listado[1], $row);
        $row                        = str_replace("{BOTON_PLANES_INGRESA}", "", $row);
        $ponderaciones_bases        = DevuelvePonderacionesPorEvaluado($evaluado->evaluado);
        $verifica_evaluado_validado = VerificaSiObjetivosEstanAjustados($evaluado->evaluado);
        if ($rut_evaluado == $evaluado->evaluado && !$id_plan) {
            $row = str_replace("{FORMUARIO_BITACORA}", file_get_contents("views/sgd/planes/formulario.html"), $row);
            $row = str_replace("{OPTIONS_VALORES}", OptionsCompetenciasPorPerfil($evaluado->perfil_evaluacion, ""), $row);
            $row = str_replace("{OPTIONS_PLAZOS_POR_EMPRESA}", OptionsGenericoNombreDadoValoresPorEmpresa("tbl_planes_plazos", "", "nombre", "id", "order by orden asc", $_SESSION["id_empresa"]), $row);
        } else {
            $row = str_replace("{FORMUARIO_BITACORA}", "", $row);
        }
        $row          = str_replace("{RUT_ENCODEADO}", Encodear3($evaluado->evaluado), $row);
        $row          = str_replace("{RUT_EVALUADO}", ($evaluado->evaluado), $row);
        $total_planes = TraeDatosPorPlanes($evaluado->evaluado);
        $row          = str_replace("{X_PLANES}", count($total_planes), $row);
        $row          = str_replace("{BOTON_JEFE_VALIDA_OBJETIVOS}", "", $row);
        $row          = str_replace("{RUT_EVALUADO_ENCODEADO}", Encodear3($evaluado->evaluado), $row);
        //ACA veo si es que tiene comentarios de rechazo
        //ACA VEO PARA COLOCAR EL BOTON ENVIAR A VALIDACION
        if ($evaluado->evaluado == $evaluador) {
            if ($listado[0] == "si") {
                $plan_finalizado = VerificaEstadoPlanes($evaluado->evaluado);
                if ($plan_finalizado) {
                    $row = str_replace("{BOTON_VALIDACIONES_PLANES}", "", $row);
                } else {
                    $row = str_replace("{BOTON_VALIDACIONES_PLANES}", file_get_contents("views/sgd/planes/boton_envia_a_validar.html"), $row);
                    $row = str_replace("{RUT_USUARIO_ENCODEADO}", Encodear3($evaluado->evaluado), $row);
                }
            } else {
                $row = str_replace("{BOTON_VALIDACIONES_PLANES}", "", $row);
            }
        } else {
            $row = str_replace("{BOTON_VALIDACIONES_PLANES}", "", $row);
        }
    }
    $total_html = str_replace("{LISTADO_COLABORADORES}", ($row), $total_html);
    $html       = str_replace("{ENTORNO_LISTADO_EVALUACION}", ($total_html), $html);
    return ($html);
}
function ListadoIngresoPlanes($evaluado, $evaluador, $id_plan, $tipo, $id_proceso, $id_proceso_plan, $perfil_evaluacion)
{
    //print_R($_SESSION);
    $id_empresa         = $_SESSION["id_empresa"];
    $datos_proceso      = TraeProcesosDeEvaluacionDadoId($_SESSION["id_proceso"]);
    //$tiene_bitacora=TraeDatosPorBitacora($evaluado);
    //$tiene_planes=TraeDatosPorPlanes($evaluado);
    //$tiene_planes=TraeDatosPorPlanesPorProceso($evaluado, $datos_proceso[0]->id_proceso_a_evaluar);
    $tiene_planes       = TraeDatosPorPlanesPorProcesoPlan($evaluado, $id_proceso_plan);
    //VErifico si los planes estan finalizados
    //$planes_finalizados=VerificaEstadoPlanes($evaluado);
    $planes_finalizados = VerificaEstadoPlanesPorProcesoEmpresa($evaluado, $id_proceso_plan, $id_empresa);
    if ($tiene_planes) {
        foreach ($tiene_planes as $dato) {
            if ($dato->id == $id_plan) {
                $template .= file_get_contents("views/sgd/planes/row_plan_edicion.html");
                //$template = str_replace("{OPTIONS_VALORES}",OptionsCompetenciasPorPerfil($evaluado->perfil_evaluacion, ""),$template);
                $template = str_replace("{OPTIONS_VALORES}", OptionsCompetenciasDadoPerfil($perfil_evaluacion, $dato->id_competencia), $template);
                $template = str_replace("{OPTIONS_PLAZOS_POR_EMPRESA}", OptionsGenericoNombreDadoValoresPorEmpresa("tbl_planes_plazos", $dato->plazo, "nombre", "id", "order by orden asc", $_SESSION["id_empresa"]), $template);
            } else {
                if ($planes_finalizados) {
                    if ($evaluado <> $evaluador) {
                        $template .= file_get_contents("views/sgd/planes/row_plan_lectura_sin_editar.html");
                        if ($dato->jefe_sugiere) {
                            $template = str_replace("{BLOQUE_COMENTARIOS_JEFE}", file_get_contents("views/sgd/planes/bloque_comentarios_jefe_lectura.html"), $template);
                            if ($dato->jefe_sugiere == "si") {
                                $template = str_replace("{SUGIERE}", "La Jefatura acepta los planes", $template);
                            } else {
                                $template = str_replace("{SUGIERE}", "La Jefatura acepta con observaciones", $template);
                            }
                            $template = str_replace("{COMENTARIO}", $dato->jefe_comentario, $template);
                        } else {
                            $template = str_replace("{BLOQUE_COMENTARIOS_JEFE}", file_get_contents("views/sgd/planes/bloque_comentarios_jefe.html"), $template);
                            $template = str_replace("{ID_PLAN}", $dato->id, $template);
                            $template = str_replace("{RUT_EVALUADO}", $evaluado, $template);
                        }
                    } else {
                        //$template.=file_get_contents("views/sgd/planes/row_plan_lectura_sin_editar.html");
                        $template .= file_get_contents("views/sgd/planes/row_plan_lectura_con_grado_avance.html");
                        //$template = str_replace("{BLOQUE_COMENTARIOS_JEFE}","ddfdf",$template);
                        if ($dato->jefe_sugiere) {
                            $template = str_replace("{BLOQUE_COMENTARIOS_JEFE}", file_get_contents("views/sgd/planes/bloque_comentarios_jefe_lectura.html"), $template);
                            if ($dato->jefe_sugiere == "si") {
                                $template = str_replace("{SUGIERE}", "La Jefatura acepta los planes", $template);
                            } else {
                                $template = str_replace("{SUGIERE}", "La Jefatura acepta con observaciones", $template);
                            }
                            $template = str_replace("{COMENTARIO}", $dato->jefe_comentario, $template);
                        } else {
                            $template = str_replace("{BLOQUE_COMENTARIOS_JEFE}", "", $template);
                        }
                    }
                } else {
                    if ($evaluado <> $evaluador) {
                        $template = file_get_contents("views/sgd/planes/row_plan_no_finalizado_por_evaluado.html");
                    } else {
                        $template .= file_get_contents("views/sgd/planes/row_plan_lectura.html");
                    }
                }
            }
            //SEGUIMIENTO
            if ($dato->seguimiento_grado_cumplimiento && $dato->seguimiento_comentario) {
                $template = str_replace("{BLOQUE_SEGUIMIENTO}", file_get_contents("views/sgd/planes/28_bloque_seguimiento_lectura.html"), $template);
                $template = str_replace("{GRADO}", $dato->seguimiento_grado_cumplimiento, $template);
                $template = str_replace("{COMENTARIO_SEGUIMIENTO}", ($dato->seguimiento_comentario), $template);
            } else {
                if ($evaluado == $evaluador) {
                    $template = str_replace("{BLOQUE_SEGUIMIENTO}", file_get_contents("views/sgd/planes/28_bloque_seguimiento.html"), $template);
                } else {
                    $template = str_replace("{BLOQUE_SEGUIMIENTO}", "", $template);
                }
            }
            $template = str_replace("{COMPETENCIA}", ($dato->nombre_competencia), $template);
            $template = str_replace("{ACTIVIDAD_A_DESARROLLAR}", $dato->actividad_desarrollar, $template);
            $template = str_replace("{RESULTADO_ESPERADO}", $dato->resultado_esperado, $template);
            //$template = str_replace("{FECHA_INICIO}",formatearFechaCompleta($dato->fecha_inicio),$template);
            $template = str_replace("{FECHA_INICIO}", ($dato->fecha_inicio), $template);
            //$template = str_replace("{FECHA_TERMINO}",formatearFechaCompleta($dato->fecha_termino),$template);
            $template = str_replace("{FECHA_TERMINO}", ($dato->fecha_termino), $template);
            $template = str_replace("{PLAZOS}", $dato->plazo_nombre, $template);
            $template = str_replace("{ID_PLANES_ENCODEADO}", ($dato->id), $template);
            $template = str_replace("{ID_PROCESO_ENCODEADO}", Encodear3($id_proceso), $template);
            $template = str_replace("{ID_PROCESO_PLAN_ENCODEADO}", Encodear3($id_proceso_plan), $template);
        }
        $arreglo[0] = "si";
        $arreglo[1] = $template;
    } else {
        if ($evaluado <> evaluador) {
            $template = file_get_contents("views/sgd/planes/row_plan_no_finalizado_por_evaluado.html");
        } else {
            $template = file_get_contents("views/sgd/planes/sin_planes.html");
        }
        $arreglo[0] = "no";
        $arreglo[1] = $template;
    }
    return ($arreglo);
}
function OptionsCompetenciasPorPerfil($perfil, $seleccionado)
{
    $competencias = CompetenciasPorPerfilConNombre($perfil);
    foreach ($competencias as $unico) {
        $options .= "<option value='" . $unico->id_componente . "'>" . $unico->nombre_competencia . "</option>";
    }
    return (($options));
}
function ListadoColaboradoresPlanes($html, $evaluador, $rut_evaluado, $id_plan, $id_proceso, $id_proceso_plan)
{
    $id_empresa = $_SESSION["id_empresa"];
    //$evaluados=EvaluadosDadoEvaluador($evaluador);
    $evaluados  = EvaluadosDadoEvaluadorParaBitacoraPorProceso($evaluador, $id_proceso);
    //Se muestran los objetivos individuales.
    if ($_SESSION["id_empresa"] == 28) {
        $total_html   = file_get_contents("views/sgd/planes/entorno_bloque_principal_chilquinta.html");
        $template_row = file_get_contents("views/sgd/planes/row_colaboradores_chilquinta.html");
    } else {
        $total_html   = file_get_contents("views/sgd/planes/entorno_bloque_principal.html");
        $template_row = file_get_contents("views/sgd/planes/row_colaboradores.html");
    }
    //Primero veo si es que hay registro en la tabla de sesion
    $row           = "";
    $ok_finalizado = 0;
    foreach ($evaluados as $evaluado) {
        $row .= $template_row;
        if ($evaluado->evaluado == $evaluador) {
            $row = str_replace("{BOTON_PLANES_INGRESA}", file_get_contents("views/sgd/planes/boton_ingreso_formulario.html"), $row);
        } else {
            $row = str_replace("{BOTON_PLANES_INGRESA}", "", $row);
        }
        $objetivos_validados_por_validador = VerificaSiObjetivosEstanValidados($evaluado->evaluado);
        //$row=FormularioIngresaObjetivos($row, $evaluado->evaluado, $evaluador);
        if ($evaluado->evaluado == $evaluador) {
            $row = ColocaDatosUsuario($row, $evaluado->evaluado, "planes");
        } else {
            $row = ColocaDatosUsuario($row, $evaluado->evaluado, "sinmensaje");
        }
        //$valores_objetivos=ListadoObjetivosAValidar($evaluado->evaluado, $evaluador, $id_objetivo, "jefe");
        $listado                    = ListadoIngresoPlanes($evaluado->evaluado, $evaluador, $id_plan, "jefe", $id_proceso, $id_proceso_plan, $evaluado->perfil_evaluacion_competencias);
        $row                        = str_replace("{LISTADO_OBJETIVOS_A_EVALUAR}", $listado[1], $row);
        $ponderaciones_bases        = DevuelvePonderacionesPorEvaluado($evaluado->evaluado);
        $verifica_evaluado_validado = VerificaSiObjetivosEstanAjustados($evaluado->evaluado);
        if ($rut_evaluado == $evaluado->evaluado && !$id_plan) {
            $row = str_replace("{FORMUARIO_BITACORA}", file_get_contents("views/sgd/planes/formulario.html"), $row);
            //$row = str_replace("{OPTIONS_VALORES}",OptionsGenericoNombreDadoValoresPorEmpresa("tbl_bitacora_valores", "",  "valor", "id", "order by valor asc", $_SESSION["id_empresa"]),$row);
            //]Aca traigo las competencias de este perfil
            $row = str_replace("{OPTIONS_VALORES}", OptionsCompetenciasDadoPerfil($evaluado->perfil_evaluacion_competencias, ""), $row);
            $row = str_replace("{OPTIONS_PLAZOS_POR_EMPRESA}", OptionsGenericoNombreDadoValoresPorEmpresa("tbl_planes_plazos", "", "nombre", "id", "order by orden asc", $_SESSION["id_empresa"]), $row);
        } else if ($_SESSION["user_"] == $evaluado->evaluado) {
            $row = str_replace("{FORMUARIO_BITACORA}", file_get_contents("views/sgd/planes/formulario.html"), $row);
            //$row = str_replace("{OPTIONS_VALORES}",OptionsGenericoNombreDadoValoresPorEmpresa("tbl_bitacora_valores", "",  "valor", "id", "order by valor asc", $_SESSION["id_empresa"]),$row);
            //]Aca traigo las competencias de este perfil
            $row = str_replace("{OPTIONS_VALORES}", OptionsCompetenciasDadoPerfil($evaluado->perfil_evaluacion_competencias, ""), $row);
            $row = str_replace("{OPTIONS_PLAZOS_POR_EMPRESA}", OptionsGenericoNombreDadoValoresPorEmpresa("tbl_planes_plazos", "", "nombre", "id", "order by orden asc", $_SESSION["id_empresa"]), $row);
        } else {
            $row = str_replace("{FORMUARIO_BITACORA}", "", $row);
        }
        $row              = str_replace("{RUT_ENCODEADO}", Encodear3($evaluado->evaluado), $row);
        $row              = str_replace("{RUT_EVALUADO}", ($evaluado->evaluado), $row);
        //$total_planes=TraeDatosPorPlanes($evaluado->evaluado);
        $total_planes     = TraeDatosPorPlanesPorProcesoPlan($evaluado->evaluado, $id_proceso_plan);
        $row              = str_replace("{X_PLANES}", count($total_planes), $row);
        //$planes_validados=TraePlanesValidados($evaluado->evaluado);
        $planes_validados = TraePlanesValidadosPorProcesoPlan($evaluado->evaluado, $id_proceso_plan);
        $row              = str_replace("{X_VALIDADOS}", count($planes_validados), $row);
        $row              = str_replace("{X_NO_VALIDADOS}", count($total_planes) - count($planes_validados), $row);
        $row              = str_replace("{BOTON_JEFE_VALIDA_OBJETIVOS}", "", $row);
        $row              = str_replace("{RUT_EVALUADO_ENCODEADO}", Encodear3($evaluado->evaluado), $row);
        //ACA veo si es que tiene comentarios de rechazo
        //ACA VEO PARA COLOCAR EL BOTON ENVIAR A VALIDACION
        if ($evaluado->evaluado == $evaluador) {
            if ($listado[0] == "si") {
                //$plan_finalizado=VerificaEstadoPlanes($evaluado->evaluado);
                $plan_finalizado = VerificaEstadoPlanesPorProcesoEmpresa($evaluado->evaluado, $id_proceso_plan, $id_empresa);
                if ($plan_finalizado) {
                    $row = str_replace("{BOTON_VALIDACIONES_PLANES}", "", $row);
                } else {
                    $row = str_replace("{BOTON_VALIDACIONES_PLANES}", file_get_contents("views/sgd/planes/boton_envia_a_validar.html"), $row);
                    $row = str_replace("{RUT_USUARIO_ENCODEADO}", Encodear3($evaluado->evaluado), $row);
                }
            } else {
                $row = str_replace("{BOTON_VALIDACIONES_PLANES}", "", $row);
            }
        } else {
            $row = str_replace("{BOTON_VALIDACIONES_PLANES}", "", $row);
        }
    }
    $total_html = str_replace("{LISTADO_COLABORADORES}", ($row), $total_html);
    $html       = str_replace("{ENTORNO_LISTADO_EVALUACION}", ($total_html), $html);
    return ($html);
}
function ColocaMeGusta($id_objeto, $tipo_objeto, $id_empresa, $rut, $autor, $id_objeto_curso_megusta)
{
    $tiene_megusta = VerCantidadMeGustaPorObjetoYUsuario($id_objeto, $tipo_objeto, $id_empresa, $rut);
    if ($tiene_megusta or $autor) {
        $row              = file_get_contents("views/megusta/bloque_comentario_yamegusta.html");
        $cantidad_megusta = VerCantidadMeGustaPorObjeto($id_objeto, $tipo_objeto, $id_empresa);
        $row              = str_replace("{CANTIDAD_MEGUSTA}", count($cantidad_megusta), $row);
    } else {
        $row              = file_get_contents("views/megusta/bloque_comentario_megusta.html");
        $row              = str_replace("{ID_CONTENIDO}", ($id_objeto), $row);
        $row              = str_replace("{TIPO_OBJETO_MEGUSTA}", $tipo_objeto, $row);
        $row              = str_replace("{ID_OBJETO_MEGUSTA}", $_SESSION["id_objeto"], $row);
        $cantidad_megusta = VerCantidadMeGustaPorObjeto($id_objeto, $tipo_objeto, $id_empresa);
        $row              = str_replace("{CANTIDAD_MEGUSTA}", count($cantidad_megusta), $row);
    }
    return ($row);
}
function ColocaMeGustaApoyoInt($id_objeto, $tipo_objeto, $id_empresa, $rut, $autor, $id_objeto_curso_megusta)
{
    $tiene_megusta = VerInteraccionesPorObjetoYUsuario($id_objeto, $tipo_objeto, $id_empresa, $rut, "MEGUSTA");
    if ($tiene_megusta) {
        $row = file_get_contents("views/megusta/bloque_comentario_yamegusta_apoyo.html");
        //$cantidad_megusta=VerCantidadMeGustaPorObjeto($id_objeto, $tipo_objeto, $id_empresa);
        //$row = str_replace("{CANTIDAD_MEGUSTA}",count($cantidad_megusta),$row);
    } else {
        $row = file_get_contents("views/megusta/bloque_comentario_megusta_apoyo.html");
        $row = str_replace("{ID_CONTENIDO}", ($id_objeto), $row);
        $row = str_replace("{TIPO_OBJETO_MEGUSTA}", $tipo_objeto, $row);
        $row = str_replace("{ID_OBJETO_MEGUSTA}", $_SESSION["id_objeto"], $row);
        //$cantidad_megusta=VerCantidadMeGustaPorObjeto($id_objeto, $tipo_objeto, $id_empresa);
        //$row = str_replace("{CANTIDAD_MEGUSTA}",count($cantidad_megusta),$row);
    }
    return ($row);
}
function ColocaFavoritoInt($id_objeto, $tipo_objeto, $id_empresa, $rut, $autor, $id_objeto_curso_megusta)
{
    $tiene_favorita = VerInteraccionesPorObjetoYUsuario($id_objeto, $tipo_objeto, $id_empresa, $rut, "FAVORITA");
    if ($tiene_favorita) {
        $row = file_get_contents("views/megusta/bloque_comentario_yafavorita_apoyo.html");
        //$cantidad_megusta=VerCantidadMeGustaPorObjeto($id_objeto, $tipo_objeto, $id_empresa);
        //$row = str_replace("{CANTIDAD_MEGUSTA}",count($cantidad_megusta),$row);
    } else {
        $row = file_get_contents("views/megusta/bloque_comentario_favorita_apoyo.html");
        $row = str_replace("{ID_CONTENIDO}", ($id_objeto), $row);
        $row = str_replace("{TIPO_OBJETO_MEGUSTA}", $tipo_objeto, $row);
        $row = str_replace("{ID_OBJETO_MEGUSTA}", $_SESSION["id_objeto"], $row);
        //$cantidad_megusta=VerCantidadMeGustaPorObjeto($id_objeto, $tipo_objeto, $id_empresa);
        //$row = str_replace("{CANTIDAD_MEGUSTA}",count($cantidad_megusta),$row);
    }
    return ($row);
}
function ColocaPDFInt($id_objeto, $tipo_objeto, $id_empresa, $rut, $autor, $id_objeto_curso_megusta)
{
    $tiene_megusta = VerInteraccionesPorObjetoYUsuario($id_objeto, $tipo_objeto, $id_empresa, $rut, "PDF");
    if ($tiene_megusta or $autor) {
        $row = file_get_contents("views/megusta/bloque_comentario_pdf_apoyo.html");
        //$cantidad_megusta=VerCantidadMeGustaPorObjeto($id_objeto, $tipo_objeto, $id_empresa);
        $row = str_replace("{CANTIDAD_MEGUSTA}", count($cantidad_megusta), $row);
    } else {
        $row = file_get_contents("views/megusta/bloque_comentario_pdf_apoyo.html");
        $row = str_replace("{ID_CONTENIDO}", ($id_objeto), $row);
        $row = str_replace("{TIPO_OBJETO_MEGUSTA}", $tipo_objeto, $row);
        $row = str_replace("{ID_OBJETO_MEGUSTA}", $_SESSION["id_objeto"], $row);
        //$cantidad_megusta=VerCantidadMeGustaPorObjeto($id_objeto, $tipo_objeto, $id_empresa);
        $row = str_replace("{CANTIDAD_MEGUSTA}", count($cantidad_megusta), $row);
    }
    return ($row);
}
function MuestraSucursal($PRINCIPAL, $id_sucursal, $id_empresa)
{
    //con el ide de empresa e id de sucursal,traigo los campos a leer
    $campos = TraigoCamposParaSucursalPorEmpresa($id_empresa);
    /*$i=1;
    foreach($campos as $camp){
    $campos_valor.=$camp->campo." as ".$camp->nombrecampo;
    if($i<count($campos)){
    $campos_valor.=", ";
    }
    $i++;
    }
    */
    foreach ($campos as $camp) {
        $dato_a_mostrar = TraeCampoPorSucursalEmpresa($camp->campo, $id_sucursal, $id_empresa);
        $row .= file_get_contents("views/sucursales/row_datos.html");
        $row = str_replace("{NOMBRE_CAMPO}", $camp->nombrecampo, $row);
        if ($camp->veperfil) {
            $datos_usuario = UsuarioEnBasePersonas($dato_a_mostrar[0]->valor);
            $row           = str_replace("{VALOR_CAMPO}", "<a  href='?sw=veperfil&r=" . Encodear3($dato_a_mostrar[0]->valor) . "'>" . $datos_usuario[0]->nombre_completo . " </a>", $row);
        } else {
            $row = str_replace("{VALOR_CAMPO}", $dato_a_mostrar[0]->valor, $row);
        }
    }
    //traigo la coordenada X
    $coordenadaX = TraeCampoPorSucursalEmpresa("coordenadax_googlemap", $id_sucursal, $id_empresa);
    $coordenadaY = TraeCampoPorSucursalEmpresa("coordenaday_googlemap", $id_sucursal, $id_empresa);
    $PRINCIPAL   = str_replace("{COORX}", $coordenadaX[0]->valor, $PRINCIPAL);
    $PRINCIPAL   = str_replace("{ROW_DATOS}", ($row), $PRINCIPAL);
    $PRINCIPAL   = str_replace("{COORY}", $coordenadaY[0]->valor, $PRINCIPAL);
    return ($PRINCIPAL);
}
function TransformaAlternativaAPuntaje($alternativa, $perfil, $id_empresa, $dimension)
{
    //echo "$alternativa, $perfil, $id_empresa, $dimension";
    $puntaje = ObtengoPuntajeDadoAlternativa($alternativa, $perfil, $id_empresa, $dimension);
    if ($puntaje) {
        $arreglo[0] = "";
        $arreglo[1] = $puntaje[0]->puntaje;
    } else {
        $arreglo[0] = "";
        $arreglo[1] = $alternativa;
    }
    return ($arreglo);
}
function TotalComponentesPorEvaluador($evaluador)
{
    $perfiles = TotalPerfilesDadoEvaluador1($evaluador);
    //Aca tengo todos los perfiles, con esto, obtengo todas las competencias.
    for ($i = 0; $i < count($perfiles); $i++) {
        $sql .= " perfil_evaluacion='" . $perfiles[$i]->id_perfil_ev . "'";
        if ($perfiles[$i + 1]->id_perfil_ev)
            $sql .= " or";
    }
    $componentes = TotalIdCompetencias($sql);
    $arreglo[0]  = count($componentes);
    $arreglo[1]  = $componentes;
    return ($arreglo);
}
function ObtieneNotaFinalCompetencias($perfil_evaluacion, $evaluado, $evaluador, $id_proceso)
{
    $dimensiones = ObtengoDimensionesDadoPerfil($perfil_evaluacion);
    foreach ($dimensiones as $dim) {
        //Ahora por cada dimension, traigo las competencias
        //$competencias=CompetenciasDadoDimension($dim->id_dimension);
        $competencias                    = CompetenciasDadoDimensionYPerfil($dim->id_dimension, $perfil_evaluacion);
        //echo count($competencias);exit;
        //echo "<br>";
        //$competencias=CompetenciasDadoDimensionYPerfil($dim->id_dimension, $datos_evaluado[0]->perfil_evaluacion);
        $cont_competencias_por_dimension = 0;
        $acum_comp                       = 0;
        foreach ($competencias as $comp) {
            //Promedio de respuestas por competencias
            //$prom_com=PromedioRespuestasComp($evaluado, $evaluador, $comp->id);
            $prom_com  = PromedioRespuestasCompPorProceso($evaluado, $evaluador, $comp->id, $id_proceso);
            //echo "promedio ".$prom_com[0]->nota_competencia."<br>";
            $acum_comp = $acum_comp + $prom_com[0]->nota_competencia;
        }
        //echo "<br>";
        //el promedio de esta dimension
        $acum_dimension = $acum_dimension + ($acum_comp / count($competencias));
        //echo "promedio dimension ".($acum_comp/count($competencias))."   ".$acum_comp." --- ".count($competencias)."  <br>";
    }
    //ACA VERIFICO SI LA EVAL ESTA FINALIZADA
    $finalizada_eval = FinalizadoEvaluadoEvaluador($evaluado, $evaluador, $id_proceso);
    if ($finalizada_eval) {
        $arreglo[0] = $acum_dimension / count($dimensiones);
        $arreglo[1] = "si";
    } else {
        $arreglo[0] = "";
        $arreglo[1] = "no";
    }
    return ($arreglo);
}
function ColocaAvanceSemaforosProcesoEvaluacionPorEvaluador($id_proceso, $id_etapa, $evaluador)
{
    //echo "idproceso  $id_proceso  , id etapa  $id_etapa ,evaluador  $evaluador <br>";
    $total_evaluados   = TraeEvaluadosDadoEvaluadorPorProceso2($evaluador, $id_proceso);
    $total_finalizados = FinalizadoEvaluadoEvaluadorProProcesoSoloEvaluador($evaluador, $id_proceso);
    $avance[0]         = (count($total_finalizados) * 100) / count($total_evaluados);
    if ($avance[0] == 100) {
        $avance[1] = '<span class="fa fa-check text-iconos fs14 mr10"></span>';
    } else {
        $avance[1] = '<span class="fa fa-circle-thin text-iconos fs14 mr10"></span>';
    }
    return ($avance);
}
Function VerificaFotoPersonalParaReporte($id_empresa)
{
    $total_usuarios = TotalUsuariosPorempresa($id_empresa);
    header("Content-Type: application/vnd.ms-excel");
    header("Content-Disposition: attachment; filename=reporte_fotos.xls");
    header("Pragma: no-cache");
    header("Expires: 0");
    echo "<table border='1'>
    <tr>
    <td>&nbsp;</td>
    <td>RUT</td>
    <td>NOMBRE</td>
    <td>APATERNO</td>
    <td>AMATERNO</td>
    <td>TIENE FOTO</td>";
    $i = 1;
    foreach ($total_usuarios as $datos_usuario) {
        $rut_completo      = $datos_usuario->rut_completo;
        $rut               = $datos_usuario->rut;
        $tiene_foto        = "no";
        $ruta              = "../front/img/personas/" . $rut;
        $ruta_rut_completo = "../front/img/personas/" . $rut_completo;
        if (file_exists($ruta . ".jpg")) {
            //$imagen=$ruta.".jpg";
            $tiene_foto = "si";
        } else if (file_exists($ruta . ".JPG")) {
            //$imagen=$ruta.".JPG";
            $tiene_foto = "si";
        } else if (file_exists($ruta . ".gif")) {
            //$imagen=$ruta.".gif";
            $tiene_foto = "si";
        } else if (file_exists($ruta_rut_completo . ".jpg")) {
            //$imagen=$ruta_rut_completo.".jpg";
            $tiene_foto = "si";
        } else if (file_exists($ruta_rut_completo . ".JPG")) {
            //$imagen=$ruta_rut_completo.".JPG";
            $tiene_foto = "si";
        } else if (file_exists($ruta_rut_completo . ".gif")) {
            //$imagen=$ruta_rut_completo.".gif";
            $tiene_foto = "si";
        }
        echo "<tr>
                <td>" . $i . "</td>
                <td>" . $datos_usuario->rut . "</td>
                <td>" . $datos_usuario->nombre . "</td>
                <td>" . $datos_usuario->apaterno . "</td>
                <td>" . $datos_usuario->amaterno . "</td>
                <td>" . $tiene_foto . "</td>
                </tr>";
        $i++;
    }
}
function EstadoMensajeria($id_comentario)
{
    //Veo si el id comentario, est? en la tabla de mensajes_respuestas, y el campo tipo_creador=1
    $mensaje_atendido = MensajeAtendidoPorAdmin($id_comentario);
    if ($mensaje_atendido) {
        $arreglo[0] = "Atendido";
        $arreglo[1] = '<span class="etiquetaEstadoAtendido">Atendido</span>';
    } else {
        $arreglo[0] = "Pendiente";
        $arreglo[1] = '<span class="etiquetaEstadoPendiente">Pendiente</span>';
    }
    return ($arreglo);
}
function IndicadoresEconomicos()
{
    //$apiUrl = 'http://mindicador.cl/api';
    //Es necesario tener habilitada la directiva allow_url_fopen para usar file_get_contents
    if (ini_get('allow_url_fopen')) {
        $json = file_get_contents($apiUrl);
    } else {
        //De otra forma utilizamos cURL
        $curl = curl_init($apiUrl);
        curl_setopt($curl, CURLOPT_RETURNTRANSFER, true);
        $json = curl_exec($curl);
        curl_close($curl);
    }
    $dailyIndicators = json_decode($json);
    echo 'El valor actual de la UF es $' . $dailyIndicators->uf->valor;
    echo 'El valor actual del D?lar observado es $' . $dailyIndicators->dolar->valor;
    echo 'El valor actual del D?lar acuerdo es $' . $dailyIndicators->dolar_intercambio->valor;
    echo 'El valor actual del Euro es $' . $dailyIndicators->euro->valor;
    echo 'El valor actual del IPC es ' . $dailyIndicators->ipc->valor;
    echo 'El valor actual de la UTM es $' . $dailyIndicators->utm->valor;
    echo 'El valor actual del IVP es $' . $dailyIndicators->ivp->valor;
    echo 'El valor actual del Imacec es ' . $dailyIndicators->imacec->valor;
}
function ColocaBloquePrincipalCategorias($PRINCIPAL, $id_empresa)
{
    $categorias = TraeCategoriasPorEmpresa($id_empresa);
    $i          = 1;
    foreach ($categorias as $Cat) {
        $row    = file_get_contents("views/biblioteca/lista_todas_categorias.html");
        $row    = str_replace("{CATEGORIA}", $Cat->categoria, $row);
        $row    = str_replace("{NOMBRE}", $Cat->categoria, $row);
        $row    = str_replace("{DESCRIPCION}", $Cat->descripcion, $row);
        $row    = str_replace("{FECHA}", $Cat->fecha, $row);
        $imagen = "";
        if ($Cat->imagen <> "") {
            $imagen = "<img src='img/" . $Cat->imagen . "' border=0>";
        }
        ;
        $row   = str_replace("{IMAGEN}", $imagen, $row);
        $total = Total_archivos_categoria($Cat->id);
        $row   = str_replace("{DETALLE}", " " . $total . "", $row);
        $row   = str_replace("{ID}", $Cat->id, $row);
        $total_html .= $row;
        if ($i == 2) {
            $i = 1;
            $total_html .= "<div class='row'></div>";
        } else {
            $i++;
        }
    }
    $PRINCIPAL = str_replace("{LISTADO_CATEGORIAS_PRINCIPALES}", $total_html, $PRINCIPAL);
    return ($PRINCIPAL);
}
function ColocaBloqueUltimosDescargadosBiblio($PRINCIPAL, $id_empresa)
{
    //$archivos2=mas_descargados(3);
    $archivos2 = mas_descargadosPorEmpresa(3, $id_empresa);
    $entorno   = file_get_contents("views/biblioteca/entorno_ultimos_documentos_descargados.html");
    foreach ($archivos2 as $ar2) {
        $row2 = file_get_contents("views/biblioteca/ultimos3_archivos.html");
        $row2 = str_replace("{ICONO}", "<img src='img/iconos/" . $ar2->icono . ".png'>", $row2);
        $row2 = str_replace("{NOMBRE}", $ar2->titulo, $row2);
        $row2 = str_replace("{DESCRIPCION}", $ar2->descripcion, $row2);
        $row2 = str_replace("{IMAGEN}", $ar2->imagen, $row2);
        $row2 = str_replace("{FECHA}", $ar2->fecha, $row2);
        $row2 = str_replace("{DESCARGADO}", $ar2->descargado, $row2);
        $row2 = str_replace("{DETALLE}", $ar2->tamano, $row2);
        $row2 = str_replace("{DESCARGA}", "./archivos_biblioteca/" . $ar2->archivo, $row2);
        $row2 = str_replace("{ID}", $ar2->id, $row2);
        $total_html1 .= $row2;
    }
    //$html = str_replace("{LISTA2}",$total_html1,$html);
    $entorno   = str_replace("{LISTA_MAS_DESCARGADOS}", $total_html1, $entorno);
    $PRINCIPAL = str_replace("{BLOQUE_LOS_MAS_DESCARGADOS}", $entorno, $PRINCIPAL);
    return ($PRINCIPAL);
}
function ColocaBloqueUltimosBiblio($PRINCIPAL, $id_empresa)
{
    $archivos = ultimos_archivosPorEmpresa(3, $id_empresa);
    $entorno  = file_get_contents("views/biblioteca/entorno_ultimos_documentos.html");
    foreach ($archivos as $ar) {
        $total_r++;
        $row = file_get_contents("views/biblioteca/ultimos3_archivos.html");
        $row = str_replace("{ICONO}", "<img src='img/iconos/" . $ar->icono . ".png'>", $row);
        $row = str_replace("{NOMBRE}", $ar->titulo, $row);
        $row = str_replace("{DESCRIPCION}", $ar->descripcion, $row);
        $row = str_replace("{IMAGEN}", $ar->imagen, $row);
        $row = str_replace("{FECHA}", $ar->fecha, $row);
        $row = str_replace("{DESCARGADO}", $ar->descargado, $row);
        $row = str_replace("{DETALLE}", $ar->tamano, $row);
        $row = str_replace("{DESCARGA}", "./archivos_biblioteca/" . $ar->archivo, $row);
        $row = str_replace("{ID}", $ar->id, $row);
        $total_html .= $row;
    }
    $entorno   = str_replace("{LISTA_ULTIMOS_DESCARGADOS}", $total_html, $entorno);
    $PRINCIPAL = str_replace("{BLOQUE_ULTIMOS_DOCUMENTOS}", $entorno, $PRINCIPAL);
    return ($PRINCIPAL);
}
function BloqueListadoEvaluadosEvalCompetencias($arreglo_evaluados, $evaluador, $id_componente, $id_pregunta, $id_proceso_anterior, $id_procceso, $comentario_obligatorio, $td_options, $template_comentario_por_pregunta)
{
    $total_evaluados_a_evaluar = 0;
    $total_evaluados_a_evaluar = 0;
    foreach ($arreglo_evaluados as $evaluado) {
        //Aca debo verificar si es que este evaluado, le corresponde ser evaluado por esta pregunta / competencia
        $verificaPReg = EvaluadoParaEstaPregunta($id_componente, $id_pregunta, $evaluado->evaluado, $evaluado->perfil_evaluacion);
        if ($verificaPReg == "si") {
            $total_evaluados_a_evaluar++;
            $row .= file_get_contents("views/sgd/evaluacion/" . $_SESSION["id_empresa"] . "_row_colaboradores_evaluacion_comp_dinamico.html");
            $row = str_replace("{SECCION_BLOQUE_COMENTARIO}", $template_comentario_por_pregunta, $row);
            $row = str_replace("{ROWSPAN_SI_TIENE_COMENTARIO}", $rowspan_tiene_comentario, $row);
            $row = str_replace("{NOMBRE_COMENTARIO}", "c" . $evaluado->evaluado . "-" . $id_pregunta, $row);
            $row = str_replace("{CAMPO_OBLIGATORIO}", $comentario_obligatorio, $row);
            $row = str_replace("{SECCION_INPUTS}", $td_options, $row);
            if ($id_proceso_anterior) {
                //Aca verifico si en esta pregunta, evaluado, evaluador, proceso, perfil, ya tiene respuesta anteriormente, si es asi, coloca estilo de color, sino replace con vacio
                $tiene_respuesta_proceso_anterior = TieneRespuestaCompetenciaProProceso($evaluado->evaluado, $evaluador, $id_pregunta, $id_proceso_anterior);
                if ($tiene_respuesta_proceso_anterior) {
                    //echo "{STYLO1".$tiene_respuesta_proceso_anterior[0]->respuesta."}";
                    $row = str_replace("{STYLO1" . $tiene_respuesta_proceso_anterior[0]->respuesta . "}", "backalt", $row);
                }
                for ($h = 1; $h <= 10; $h++) {
                    $row = str_replace("{STYLO1" . $h . "}", "", $row);
                }
            }
            $row        = str_replace("{SUBPERFIL_EVALUACION}", ($evaluado->nombre_subperfil), $row);
            //$row=ColocaDatosUsuario($row, $evaluado->evaluado);
            $row        = ColocaDatosUsuarioSGD($row, $evaluado->evaluado, "", $evaluador, $id_procceso);
            $row        = str_replace("{NOMBRE_RADIO}", $evaluado->evaluado . "-" . $id_pregunta, $row);
            $row        = str_replace("{NOMBRE_RADIO_SOLO_PREGUNTA}", $id_pregunta, $row);
            //$tiene_resp=TieneRespuestaCompetencia($evaluado->evaluado, $evaluador, $id_componente);
            $row        = str_replace("{ID_PREGUNTA_AJAX}", $id_pregunta, $row);
            $row        = str_replace("{EVALUADO_AJAX}", $evaluado->evaluado, $row);
            $row        = str_replace("{EVALUADO_AJAX_ENCODEADO}", Encodear3($evaluado->evaluado), $row);
            //$tiene_resp=TieneRespuestaCompetencia($evaluado->evaluado, $evaluador, $id_pregunta);
            $tiene_resp = TieneRespuestaCompetenciaProProceso($evaluado->evaluado, $evaluador, $id_pregunta, $id_procceso);
            $row        = str_replace("{COMENTARIO_c" . $evaluado->evaluado . "-" . $id_pregunta . "}", ($tiene_resp[0]->comentario), $row);
            $row        = str_replace("{SELECT" . $tiene_resp[0]->respuesta . "}", "checked", $row);
            $row        = str_replace("{SELECT1}", "", $row);
            $row        = str_replace("{SELECT1.5}", "", $row);
            $row        = str_replace("{SELECT2}", "", $row);
            $row        = str_replace("{SELECT2.3}", "", $row);
            $row        = str_replace("{SELECT2.7}", "", $row);
            $row        = str_replace("{SELECT3}", "", $row);
            $row        = str_replace("{SELECT3.3}", "", $row);
            $row        = str_replace("{SELECT3.7}", "", $row);
            $row        = str_replace("{SELECT4}", "", $row);
            $row        = str_replace("{SELECT4.5}", "", $row);
            $row        = str_replace("{SELECT5}", "", $row);
        }
    }
    //Listado de Evaluados a Evaluar
    $arreglo[0] = $row;
    //Cantidad de evaluados
    $arreglo[1] = $total_evaluados_a_evaluar;
    return ($arreglo);
}
function BloqueListadoObjetivoEspecificos($evaluado, $evaluador, $id_proceso, $id_empresa, $con_notas)
{
    if ($con_notas == "si") {
        if ($evaluado == $evaluador) {
            $template_row  = file_get_contents("views/sgd/informe/" . $id_empresa . "_row_informe1.html");
            $template_row1 = file_get_contents("views/sgd/informe/" . $id_empresa . "_row_informe1.1.html");
        } else {
            $template_row  = file_get_contents("views/sgd/informe/" . $id_empresa . "_row_informe1_con_ae.html");
            $template_row1 = file_get_contents("views/sgd/informe/" . $id_empresa . "_row_informe1.1_con_ae.html");
        }
    } elseif ($con_notas == "no") {
        $template_row  = file_get_contents("views/sgd/informe/row_informe1_sinnota.html");
        $template_row1 = file_get_contents("views/sgd/informe/row_informe1.1_sinnota.html");
    }
    //$objetivos=ObjetivosEspecificosConRespuestaEvaluadoEvaluadorProceso($evaluado, $evaluador, $id_proceso);
    if ($id_empresa == 43) {
        $objetivos = ObjetivosEspecificosConRespuestaEvaluadoEvaluadorProceso2SinTablaRespuesta($evaluado, $evaluador, $id_proceso);
    } else {
        $objetivos = ObjetivosEspecificosConRespuestaEvaluadoEvaluadorProceso2($evaluado, $evaluador, $id_proceso);
    }
    $contador_objetivos = 0;
    foreach ($objetivos as $ob) {
        $contador_objetivos++;
        if ($subtitulo_dimension_objetivos <> $ob->nombre_dimension) {
            $row2 .= $template_row;
            $row2 = str_replace("{NOMBRE}", $ob->nombre_dimension, $row2);
            $row2 = str_replace("{DESCRIPCION}", $ob->descripcion, $row2);
            //$promedio_por_dimension=PromedioPorDimensionObjetivos($evaluado, $evaluador, $ob->dimension, $id_proceso);
            if ($id_empresa == 43) {
                $promedio_por_dimension = ObtieneNotaObjetivosPorDimension($evaluado, $evaluador, $id_proceso, $ob->dimension);
            } else {
                $promedio_por_dimension = ObtieneNotaObjetivos($evaluado, $evaluador, $id_proceso, $ob->dimension);
            }
            //Aca obtengo la nota promedio de esta dimension
            $criterios_dimensiones = ObtenerCriterioPuntajeMatrizNotaFinal($promedio_por_dimension, $evaluado, "", "ind", $evaluador, $id_proceso);
            $row2                  = str_replace("{NOTA}", FormatearPorcentajesSinDecimal($promedio_por_dimension), $row2);
            $row2                  = str_replace("{ESTILO_ETIQUETA}", $criterios_dimensiones[2], $row2);
            $row2                  = str_replace("{ICONO}", $criterios_dimensiones[3], $row2);
            $row2                  = str_replace("{CRITERIO}", $criterios_dimensiones[0], $row2);
        }
        $acumulador_promedio_dimensiones = $acumulador_promedio_dimensiones + $ob->puntaje;
        $contador_obj++;
        $subtitulo_dimension_objetivos = $ob->nombre_dimension;
        //$row2.=file_get_contents("views/sgd/informe/row_informe1.1.html");
        $row2 .= $template_row1;
        $row2 = str_replace("{NOMBRE_1}", $ob->descripcion_objetivo, $row2);
        $row2 = str_replace("{PONDERACION_1}", $ob->ponderacion, $row2);
        $row2 = str_replace("{RUT_EVALUADO_ENCODEADO}", Encodear3($rut), $row2);
        $row2 = str_replace("{VALOR_NOTA_OBJ_PRECARGADA}", $ob->nota_ev, $row2);
        if ($obj->nota_descripcion) {
            $row2 = str_replace("{VALOR_NOTA_OBJ_PRECARGADA_DESC}", $ob->nota_descripcion, $row2);
        } else {
            $row2 = str_replace("{VALOR_NOTA_OBJ_PRECARGADA_DESC}", $ob->nota_ev, $row2);
        }
        $row2 = str_replace("{OPCION_ID_OBJ}", Encodear($evaluado) . "-" . Encodear($ob->id_objetivo_original), $row2);
        if ($ob->nota_descripcion) {
            $row2 = str_replace("{DESCRIPCION_1}", $ob->nota_descripcion, $row2);
        } else {
            $row2 = str_replace("{DESCRIPCION_1}", $ob->metrica, $row2);
        }
        $criterios = ObtenerCriterioPuntajeMatrizNotaFinal($ob->puntaje, $evaluado, "", "ind", $evaluador, $id_proceso);
        if ($ob->puntaje == 0) {
            $row2 = str_replace("{NOTA_1}", "No Aplica", $row2);
            $row2 = str_replace("{ESTILO_ETIQUETA_1}", "estilo_no_aplica", $row2);
            $row2 = str_replace("{ICONO_1}", "", $row2);
            $row2 = str_replace("{CRITERIO_1}", "", $row2);
        } else {
            $row2 = str_replace("{NOTA_1}", FormatearPorcentajesSinDecimal($ob->puntaje) . "", $row2);
            $row2 = str_replace("{ESTILO_ETIQUETA_1}", $criterios[2], $row2);
            $row2 = str_replace("{ICONO_1}", $criterios[3], $row2);
            $row2 = str_replace("{CRITERIO_1}", $criterios[0], $row2);
        }
        if ($ob->comentario) {
            $row2 = str_replace("{BLOQUE_COMENTARIO_POR_OBJETIVO}", file_get_contents("views/sgd/informe/" . $id_empresa . "_row_informe_comentario_por_objetivo.html"), $row2);
            $row2 = str_replace("{TIPO}", "", $row2);
            $row2 = str_replace("{COMENTARIO_POR_OBJETIVO}", ($ob->comentario), $row2);
        } else {
            $row2 = str_replace("{BLOQUE_COMENTARIO_POR_OBJETIVO}", "", $row2);
        }
        $nota_ae      = ObjetivosEspecificosConRespuestaEvaluadoEvaluadorProceso2Objeto($evaluado, $evaluado, $id_proceso, $ob->id_objetivo_original);
        $criterios_ae = ObtenerCriterioPuntajeMatrizNotaFinal($nota_ae[0]->puntaje, $evaluado, "", "ind", $evaluado, $id_proceso);
        $row2         = str_replace("{NOTA_1_AE}", FormatearPorcentajesSinDecimal($nota_ae[0]->puntaje), $row2);
        $row2         = str_replace("{ESTILO_ETIQUETA_1_AE}", $criterios_ae[2], $row2);
        $row2         = str_replace("{ICONO_1_AE}", $criterios_ae[3], $row2);
        $row2         = str_replace("{CRITERIO_1_AE}", $criterios_ae[0], $row2);
        if ($nota_ae[0]->comentario) {
            $row2 = str_replace("{BLOQUE_COMENTARIO_POR_OBJETIVO_AE}", file_get_contents("views/sgd/informe/" . $id_empresa . "_row_informe_comentario_por_objetivo.html"), $row2);
            $row2 = str_replace("{TIPO}", "Autoevaluaci&oacute;n", $row2);
            $row2 = str_replace("{COMENTARIO_POR_OBJETIVO}", ($nota_ae[0]->comentario), $row2);
        } else {
            $row2 = str_replace("{BLOQUE_COMENTARIO_POR_OBJETIVO_AE}", "", $row2);
        }
        //$row2 = str_replace("{COMENTARIO_POR_OBJETIVO_FORMULARIO}",$ob->comentario,$row2);
        //ESTE BLOQUE ES PARA LA ULTIMA DIMENSION
        if (count($objetivos) == $contador_objetivos) {
            $criterios_dimensiones = ObtenerCriterioPuntajeMatrizNotaFinal($nota_por_dimension, $evaluado, "", "ind");
            $row2                  = str_replace("{NOTA}", $nota_por_dimension, $row2);
            $row2                  = str_replace("{ESTILO_ETIQUETA}", $criterios_dimensiones[2], $row2);
            $row2                  = str_replace("{ICONO}", FormatearPorcentajesSinDecimal($criterios_dimensiones[3]), $row2);
            $row2                  = str_replace("{CRITERIO}", $criterios_dimensiones[0], $row2);
        }
    }
    return ($row2);
}
function ArmaTemplareDeTablaResumen($html, $id_proceso_anual, $id_empresa, $perfil_evaluacion, $evaluado, $rut, $muestra_boton_informe, $id_proceso_para_reportes_admin)
{
    //$id_proceso_para_reportes_admin -->se lo paso desde el admin, para los reportes de resultados
    //echo "$id_proceso_anual, $id_empresa, $perfil_evaluacion, $evaluado, $rut, $muestra_boton_informe, $id_proceso_para_reportes_admin";
    $porcentajes = TraePonderacionesPorPerfil($perfil_evaluacion);
    $contador    = 0;
    if ($porcentajes[0]->objetivos_empresa > 0) {
        $tr_items .= file_get_contents("views/sgd/informe/tabla_superior_resumen/tr_por_item.html");
        $tr_items = str_replace("{ITEM_PORCEN}", $porcentajes[0]->objetivos_empresa . "% Corporativo", $tr_items);
        $tr_valores .= file_get_contents("views/sgd/informe/tabla_superior_resumen/tr_valores_empresa.html");
        $contador++;
    }
    if ($porcentajes[0]->objetivos_area > 0) {
        $tr_items .= file_get_contents("views/sgd/informe/tabla_superior_resumen/tr_por_item.html");
        $tr_items = str_replace("{ITEM_PORCEN}", $porcentajes[0]->objetivos_area . "% Area", $tr_items);
        $tr_valores .= file_get_contents("views/sgd/informe/tabla_superior_resumen/tr_valores_area.html");
        $contador++;
    }
    if ($porcentajes[0]->objetivos_individuales > 0) {
        $tr_items .= file_get_contents("views/sgd/informe/tabla_superior_resumen/tr_por_item.html");
        $tr_items = str_replace("{ITEM_PORCEN}", $porcentajes[0]->objetivos_individuales . "% " . $porcentajes[0]->nombre_objetivos_individuales, $tr_items);
        $tr_valores .= file_get_contents("views/sgd/informe/tabla_superior_resumen/tr_valores_ind.html");
        $contador++;
    }
    if ($porcentajes[0]->competencias > 0) {
        $tr_items .= file_get_contents("views/sgd/informe/tabla_superior_resumen/tr_por_item.html");
        if ($id_empresa == 28) {
            $tr_items = str_replace("{ITEM_PORCEN}", $porcentajes[0]->nombre_competencias, $tr_items);
        } else {
            $tr_items = str_replace("{ITEM_PORCEN}", $porcentajes[0]->competencias . "% " . $porcentajes[0]->nombre_competencias, $tr_items);
        }
        $tr_valores .= file_get_contents("views/sgd/informe/tabla_superior_resumen/tr_valores_comp.html");
        $contador++;
    }
    if ($id_empresa == 28 or $id_empresa == 61) {
        $tr_items .= file_get_contents("views/sgd/informe/tabla_superior_resumen/tr_por_item.html");
        $tr_items = str_replace("{ITEM_PORCEN}", "Autoevaluacion", $tr_items);
        $tr_valores .= file_get_contents("views/sgd/informe/tabla_superior_resumen/tr_valores_ae.html");
        $contador++;
    }
    $html                = str_replace("{FILAS_DINAMICAS_DE_LOS_PORCENTAJES}", ($tr_items), $html);
    $datos_proceso_anual = DatosProcesoAnual($id_proceso_anual, $id_empresa);
    //$procesos=ProcesosEvalPorProcesoAnual($datos_proceso_anual[0]->id);
    $procesos            = ProcesosEvalPorProcesoAnualParaTabla($datos_proceso_anual[0]->id, "evaluacion");
    $td_por_proceso      = "";
    if ($id_empresa == 28) {
        $row_template = file_get_contents("views/sgd/informe/tabla_superior_resumen/td_por_proceso_chilquinta.html");
    } else {
        $row_template = file_get_contents("views/sgd/informe/tabla_superior_resumen/td_por_proceso.html");
    }
    foreach ($procesos as $unico) {
        $td_por_proceso .= $row_template;
        if ($unico->evaluacion_individual == 1) {
            $td_por_proceso = str_replace("{BOTON_EVALUACION_INDIVIDUAL}", file_get_contents("views/sgd/informe/tabla_superior_resumen/boton_eval_individual.html"), $td_por_proceso);
        } else {
            $td_por_proceso = str_replace("{BOTON_EVALUACION_INDIVIDUAL}", "", $td_por_proceso);
        }
        //Por cada proceso, verifico si est? finalizado para este evaluado y evaluador, asi
        //veo si coloco o no el boton de Ver Informe
        if ($muestra_boton_informe == "no") {
            $td_por_proceso = str_replace("{BOTON_VE_INFORME_POR_PROCESO}", "", $td_por_proceso);
        } else {
            $proceso_finalizado = FinalizadoEvaluadoEvaluadorProProceso($evaluado, $rut, $unico->id_proceso);
            if ($proceso_finalizado) {
                if ($muestra_boton_informe == "no") {
                    $td_por_proceso = str_replace("{BOTON_VE_INFORME_POR_PROCESO}", "", $td_por_proceso);
                } else {
                    $td_por_proceso = str_replace("{BOTON_VE_INFORME_POR_PROCESO}", file_get_contents("views/sgd/informe/tabla_superior_resumen/boton_ve_informe.html"), $td_por_proceso);
                }
            } else {
                $td_por_proceso = str_replace("{BOTON_VE_INFORME_POR_PROCESO}", "", $td_por_proceso);
            }
        }
        $td_por_proceso = str_replace("{NOMBRE_PROCESO}", $unico->descripcion_proceso, $td_por_proceso);
        $td_por_proceso = str_replace("{RUT_EVALUADO_ENCODEADO}", Encodear3($evaluado), $td_por_proceso);
        $td_por_proceso = str_replace("{ID_PROCESO_ENCODEADO}", Encodear3($unico->id_proceso), $td_por_proceso);
        $td_por_proceso = str_replace("{FILAS_NOTAS_DINAMICAS}", $tr_valores, $td_por_proceso);
        //Ahora por cada proceso, lo paso por la funcion que coloca los datos
        if ($evaluado == $rut) {
            $datos_rel = ObtenerJefeRelPorProceso($evaluado, $unico->id_proceso);
            //$rut=$datos_rel[0]->evaluador;
        }
        $td_por_proceso = ColocaResultadosTablaReumen($td_por_proceso, $evaluado, $rut, $unico->id_proceso, $unico->id_proceso, $id_proceso_para_reportes_admin);
        if ($unico->nota_final == 1) {
            if ($id_proceso_para_reportes_admin) {
                if ($id_proceso_para_reportes_admin == $unico->id_proceso) {
                    $html = ColocaResultadosTablaReumen($html, $evaluado, $rut, $unico->id_proceso, $unico->id_proceso, $id_proceso_para_reportes_admin);
                }
            } else {
                $html = ColocaResultadosTablaReumen($html, $evaluado, $rut, $unico->id_proceso, $unico->id_proceso, $id_proceso_para_reportes_admin);
            }
        }
    }
    $html = str_replace("{COLUMNAS_DINAMICAS_DADA_CANTIDAD_PROCESOS}", ($td_por_proceso), $html);
    return ($html);
}
function FuncionParaObtenerCalculoMientrasAvanzaPagina($html, $evaluador, $id_proceso_evaluacion, $id_empresa, $evaluado, $calibrador, $origen, $arreglo_post, $filtro1, $filtro2)
{
    if ($arreglo_post["rutevaluador"] && $arreglo_post["evaluador"])
        $evaluador = $arreglo_post["rutevaluador"];
    if ($arreglo_post["rutcalibrador"] && $arreglo_post["calibrador"])
        $calibrador = $arreglo_post["rutcalibrador"];
    //Lo que voy a hacer, es treaer el total de respuestas, con inner join de la tabla preguntas
    //Eso va a ser el total.
    //Sobre eso los categorizo
    if ($evaluado) {
        $respuestas_todas = TraigoRespuestasCrucePreguntasPorEvaluado($evaluador, $id_proceso_evaluacion, $evaluado);
    } else if ($calibrador) {
        //$respuestas_todas=TraigoRespuestasCrucePreguntasPorCalibrador($calibrador, $id_proceso_evaluacion);
        $respuestas_todas = TraigoRespuestasCrucePreguntasPorCalibradorSinAe($calibrador, $id_proceso_evaluacion);
    } else if ($evaluador) {
        //$respuestas_todas=TraigoRespuestasCrucePreguntas($evaluador, $id_proceso_evaluacion);
        $respuestas_todas = TraigoRespuestasCrucePreguntasSinAe($evaluador, $id_proceso_evaluacion);
    } else if ($id_proceso_evaluacion) {
        //$respuestas_todas=TraigoRespuestasCrucePreguntasSoloPorProceso($id_proceso_evaluacion);
        $respuestas_todas = TraigoRespuestasCrucePreguntasSoloPorProcesoSinAe($id_proceso_evaluacion, $filtro1, $filtro2, $arreglo_post);
    }
    //echo "total de respuestas ".count($respuestas_todas);
    //ahora traigo  los rangos de la tabla de matriz
    $registros                = DatosCriterioPorEmpresaTipo($id_empresa, "grafico_frecuencia");
    $datos_empresa            = DatosEmpresa($id_empresa);
    $datos_proceso_evaluacion = TraeProcesosDeEvaluacionPorEmpresaYDiProceso($id_empresa, $id_proceso_evaluacion);
    $contador_                = 1;
    foreach ($registros as $unico) {
        //print_r($unico);
        //echo "<br><br>";
        //_ahora por cada categoria, traigo la cantidad de respuestas, pasando como parametro
        //los rangos menores y mayores
        if ($evaluado) {
            //echo "1";
            $respuestas = TraigoRespuestasCrucePreguntasPorRangosMenorYMayorPorEvaluado($evaluador, $id_proceso_evaluacion, $unico->rangomenor, $unico->rangomayor, $evaluado);
        } else if ($calibrador) {
            //echo "2";
            $respuestas = TraigoRespuestasCrucePreguntasPorRangosMenorYMayorPorCalibrador($calibrador, $id_proceso_evaluacion, $unico->rangomenor, $unico->rangomayor);
        } else if ($evaluador) {
            //$respuestas=TraigoRespuestasCrucePreguntasPorRangosMenorYMayor($evaluador, $id_proceso_evaluacion, $unico->rangomenor, $unico->rangomayor);
            $respuestas = TraigoRespuestasCrucePreguntasPorRangosMenorYMayorSinAe($evaluador, $id_proceso_evaluacion, $unico->rangomenor, $unico->rangomayor);
        } else if ($id_proceso_evaluacion) {
            //$respuestas=TraigoRespuestasCrucePreguntasPorRangosMenorYMayorSoloPorProceso($id_proceso_evaluacion, $unico->rangomenor, $unico->rangomayor);
            $respuestas = TraigoRespuestasCrucePreguntasPorRangosMenorYMayorSoloPorProcesoSinAe($id_proceso_evaluacion, $unico->rangomenor, $unico->rangomayor, $arreglo_post);
        }
        //$datos.="['".$unico->criterio."', ".FormatearPorcentajesSinDecimal((100*count($respuestas))/count($respuestas_todas)).", ".$unico->requerido."]";
        $datos .= "['" . $unico->criterio . "', " . FormatearPorcentajesSinDecimal((100 * count($respuestas)) / count($respuestas_todas)) . "]";
        if ($contador_ < count($registros))
            $datos .= ",";
        $contador_++;
    }
    //echo "<br>";
    //            print_r($datos);
    //    echo "<br>";
    //echo $datos;
    if ($origen == "admin") {
        $template_grafico = file_get_contents("../front/views/sgd/graficos/barra_frecuenciaCompetencias.html");
    } else {
        $template_grafico = file_get_contents("views/sgd/graficos/barra_frecuenciaCompetencias.html");
    }
    $template_grafico = str_replace("{ARREGLO_DATOS}", $datos, $template_grafico);
    $template_grafico = str_replace("{TITULO_GRAFICO_1}", $datos_proceso_evaluacion[0]->titulo_grafico_1, $template_grafico);
    if ($datos_empresa[0]->color_grafico1) {
        $template_grafico = str_replace("{COLOR_GRAFICO}", $datos_empresa[0]->color_grafico1, $template_grafico);
    } else {
        $template_grafico = str_replace("{COLOR_GRAFICO}", "#009B1D", $template_grafico);
    }
    $html = str_replace("{GRAFICO}", $template_grafico, $html);
    return ($html);
}
function FuncionParaObtenerCalculoMientrasAvanzaPaginaBK($html, $evaluador, $id_proceso_evaluacion, $id_empresa)
{
    //Lo que voy a hacer, es treaer el total de respuestas, con inner join de la tabla preguntas
    //Eso va a ser el total.
    //Sobre eso los categorizo
    $respuestas       = TraigoRespuestasCrucePreguntas($evaluador, $id_proceso_evaluacion);
    $contador_arreglo = 0;
    foreach ($respuestas as $resp) {
        $valores                                = ObtenerCriterioPuntajeMatrizNotaFinal($resp->puntaje, $resp->evaluado, "", "grafico_frecuencia");
        //print_r($valores);echo "<br>";
        $arreglo[$contador_arreglo]["criterio"] = $valores[0];
        $arreglo[$contador_arreglo]["etiqueta"] = $valores[2];
        $arreglo[$contador_arreglo]["icono"]    = $valores[3];
        $arreglo[$contador_arreglo]["puntaje"]  = $valores[4];
        $contador_arreglo++;
        //exit;
    }
    //echo "<pre>";
    //print_r($arreglo[$contador_arreglo]);exit;
    foreach ($arreglo as $key => $row) {
        $aux[$key] = $row['puntaje'];
    }
    array_multisort($aux, SORT_ASC, $arreglo);
    $categoria    = "";
    //Aca traigo los criterios de la tabla matriz, pasandole el parametro grafico_frecuencia y el id de empresa
    $datos_matriz = TaigoDatosMatriz($id_empresa, "grafico_frecuencia");
    for ($i = 0; $i < count($arreglo); $i++) {
        $indice_arreglo_grafico = 0;
        foreach ($datos_matriz as $dat) {
            //echo $dat->criterio." ".$arreglo[$i]["criterio"];exit;
            if ($dat->criterio == $arreglo[$i]["criterio"]) {
                $arreglo_grafico[$indice_arreglo_grafico]["criterio"] = $arreglo[$i]["criterio"];
                $arreglo_grafico[$indice_arreglo_grafico]["cantidad"]++;
                continue;
            }
            $indice_arreglo_grafico++;
        }
    }
    for ($j = count($arreglo_grafico); $j < count($datos_matriz); $j++) {
        $arreglo_grafico[$j + 1]["criterio"] = $datos_matriz[$j]->criterio;
        $arreglo_grafico[$j + 1]["cantidad"] = 0;
    }
    //echo "<pre>";
    //print_r(($arreglo_grafico));exit;
    $template_grafico = file_get_contents("views/graficos/barra_frecuenciaCompetencias.html");
    for ($i = 1; $i <= count($arreglo_grafico); $i++) {
        $datos .= "['" . $arreglo_grafico[$i]['criterio'] . "', " . $arreglo_grafico[$i]['cantidad'] . ", 10]";
        if ($i < count($arreglo_grafico))
            $datos .= ",";
    }
    //echo "<pre>";
    //print_r($arreglo_grafico);exit;
    $template_grafico = str_replace("{ARREGLO_DATOS}", $datos, $template_grafico);
    $html             = str_replace("{GRAFICO}", $template_grafico, $html);
    return ($html);
}
function OptionsCategoriasValoresFormularios($id_Categoria, $id_empresa)
{
    $valores = TraigoValoresPorCategoria($id_Categoria, $id_empresa);
    foreach ($valores as $val) {
        $html .= "<option value=" . $val->id . ">" . $val->nombre . "</option>";
    }
    return (($html));
}
function BloqueBuscadorPersonasDirectorio($html, $id_empresa)
{
    $html = str_replace("{SECCION_BUSCA_PERSONAS_DIRECTORIO}", file_get_contents("views/buscador_personas/buscador.html"), $html);
    return ($html);
}
function buscacursosaprobadospornivel($id_orden_nivel, $rut, $id_empresa, $id_malla)
{
    //echo "<br>$id_orden_nivel,$rut, $id_empresa, $id_malla";
    $buscacursosaprobadospornivel_arreglos = buscacursosaprobadospornivel_data($id_orden_nivel, $rut, $id_empresa, $id_malla);
    //print_r($buscacursosaprobadospornivel_arreglos);
    foreach ($buscacursosaprobadospornivel_arreglos as $cursonivel) {
        //    echo "<br>$cursonivel->idcurso ";
        //    echo "$cursonivel->aprobado";
        if ($cursonivel->aprobado == 1) {
            $cursoaprobado++;
        }
    }
    return $cursoaprobado;
}
function MP_estadisticas_personales($PRINCIPAL, $rut, $id_empresa)
{
    $mp_estadisticas_personal = MP_buscaestadisticasPersonales($rut, $id_empresa);
    $PRINCIPAL                = str_replace("{MP_MIS_PUBLICACIONES}", $mp_estadisticas_personal[0]->MP_MIS_PUBLICACIONES, $PRINCIPAL);
    $PRINCIPAL                = str_replace("{MP_MIS_FAVORITAS}", $mp_estadisticas_personal[0]->MP_MIS_FAVORITAS, $PRINCIPAL);
    $PRINCIPAL                = str_replace("{MP_COMPARTIDA_CONMIGO}", $mp_estadisticas_personal[0]->MP_COMPARTIDA_CONMIGO, $PRINCIPAL);
    $PRINCIPAL                = str_replace("{MP_SIGUIENDO}", $mp_estadisticas_personal[0]->MP_SIGUIENDO, $PRINCIPAL);
    $PRINCIPAL                = str_replace("{MP_MESIGUEN}", $mp_estadisticas_personal[0]->MP_MESIGUEN, $PRINCIPAL);
    $PRINCIPAL                = str_replace("{MP_MIS_INTERESES}", $mp_estadisticas_personal[0]->MP_MIS_INTERESES, $PRINCIPAL);
    $PRINCIPAL                = str_replace("{MP_INSIGNIA}", $mp_estadisticas_personal[0]->MP_INSIGNIA, $PRINCIPAL);
    $PRINCIPAL                = str_replace("{ICONOINSIGNIA}", $mp_estadisticas_personal[0]->iconoinsignia, $PRINCIPAL);
    $PRINCIPAL                = str_replace("{BCICOINS}", $mp_estadisticas_personal[0]->bcicoins, $PRINCIPAL);
    return ($PRINCIPAL);
}
function MP_estadisticas_personalesv2($PRINCIPAL, $rut, $id_empresa)
{
    //echo "Rod 20231 $rut, $id_empresa";
    $ArregloEstadisticaMF = ComMp_BuscaNumTipo($rut, $id_empresa, "MISFAVORITAS");
    $ArregloEstadisticaCC = ComMp_BuscaNumTipo($rut, $id_empresa, "COMPARTIDASCONMIGO");
    $num_mf               = count($ArregloEstadisticaMF);
    $num_cc               = count($ArregloEstadisticaCC);
    $PRINCIPAL            = str_replace("{MP_COMPARTIDA_CONMIGO2}", $num_cc, $PRINCIPAL);
    $PRINCIPAL            = str_replace("{MP_MIS_FAVORITAS2}", $num_mf, $PRINCIPAL);
    return ($PRINCIPAL);
}
function ColocarDatosHomeBeFenCompetencias($PRINCIPAL, $rut, $id_empresa, $id_malla, $nivel, $mod, $template_comp)
{
    $id_malla_enc    = Encodear3($id_malla);
    //echo "<br>_ $rut, $id_empresa, malla $id_malla, <br>";
    $datos_curso     = TotalcursosPorUsuaroEmpresa($rut, $id_empresa, $id_malla);
    //print_r($datos_curso);
    $total_aprobados = 0;
    $datos_nivel     = TotalNivelPorUsuaroEmpresa($rut, $id_empresa, $id_malla);
    //print_r($datos_nivel);
    if ($nivel <> '') {
        $nivel = $nivel;
    } else {
        $id_nivel = $datos_nivel[0]->id_nivel;
        $nivel    = $datos_nivel[0]->idorden + 1;
        $mod      = 0;
    }
    $minivel           = $nivel;
    //echo "<br>minivel $minivelnivel $nivel, mod $mod, id nivel $id_nivel";
    //$cursosaprobados=buscacursosaprobadospornivel($nivel, $rut, $id_empresa, $id_malla);
    $nivelFinalizados  = NivelesFinalizados($rut, $id_empresa, $id_malla);
    $nivel_actual      = $nivelFinalizados[0]->cuenta + 1;
    $nivel_actual_real = $nivelFinalizados[0]->cuenta + 1;
    if ($template_comp == "Fn") {
        $nivel_actual = $minivel;
        $imagen_fondo = $buscaNivelRol[0]->imagenbackhome;
    }
    //echo "<br>imagen_fondo $imagen_fondo";
    $buscaNivelRol             = buscaNivelRol($rut, $id_empresa, $id_malla, $nivel_actual);
    //print_r($buscaNivelRol);
    $nivelPersonal             = $buscaNivelRol[0]->nivelnombre;
    $rolPersonal               = $buscaNivelRol[0]->descripcionRol;
    $id_curso_activo           = $buscaNivelRol[0]->idcurso_actual;
    $template_detalle_cursoCap = $buscaNivelRol[0]->template_detalle_cursoCap;
    $menu_activo               = $buscaNivelRol[0]->menuactivo;
    $nivel_activo              = $buscaNivelRol[0]->nivelactivo;
    $curso_activo              = $buscaNivelRol[0]->cursoactivo;
    if ($template_comp == "Fn") {
        $tipo_boton          = "nivelactivo";
        //echo "<br><br>nivelactivo<br>";
        //print_r($nivel_activo);
        $nivel_activos_array = explode(",", $nivel_activo);
        $acciontboton        = BuscaNivelAccionBoton($id_empresa, $nivel_activos_array[0], $tipo_boton);
        $CUADROnivel1        = ($acciontboton[0]->boton);
        $acciontboton        = BuscaNivelAccionBoton($id_empresa, $nivel_activos_array[1], $tipo_boton);
        $CUADROnivel2        = ($acciontboton[0]->boton);
        $acciontboton        = BuscaNivelAccionBoton($id_empresa, $nivel_activos_array[2], $tipo_boton);
        $CUADROnivel3        = ($acciontboton[0]->boton);
        $acciontboton        = BuscaNivelAccionBoton($id_empresa, $nivel_activos_array[3], $tipo_boton);
        $CUADROnivel4        = ($acciontboton[0]->boton);
    }
    // Imagen de fondo
    if ($template_comp == "") {
        $imagen_fondo         = $buscaNivelRol[0]->imagenbackhome;
        //echo "<br> For Each Menu<br>";
        $tipo_boton           = "menuactivo";
        //echo "<br><br>menuactivo<br>";
        //print_r($menu_activo);
        $menues_activos_array = explode(",", $menu_activo);
        $acciontboton         = BuscaNivelAccionBoton($id_empresa, $menues_activos_array[0], $tipo_boton);
        $CUADRO1m             = ($acciontboton[0]->boton);
        $acciontboton         = BuscaNivelAccionBoton($id_empresa, $menues_activos_array[1], $tipo_boton);
        $CUADRO2m             = ($acciontboton[0]->boton);
        $acciontboton         = BuscaNivelAccionBoton($id_empresa, $menues_activos_array[2], $tipo_boton);
        $CUADRO3m             = ($acciontboton[0]->boton);
        $acciontboton         = BuscaNivelAccionBoton($id_empresa, $menues_activos_array[3], $tipo_boton);
        $CUADRO4m             = ($acciontboton[0]->boton);
        $acciontboton         = BuscaNivelAccionBoton($id_empresa, $menues_activos_array[4], $tipo_boton);
        $CUADROhm             = ($acciontboton[0]->boton);
        //echo "<br> For Each Link Activo<br>";
        $tipo_boton           = "nivelactivo";
        //echo "<br><br>nivelactivo<br>";
        //print_r($nivel_activo);
        $nivel_activos_array  = explode(",", $nivel_activo);
        $acciontboton         = BuscaNivelAccionBoton($id_empresa, $nivel_activos_array[0], $tipo_boton);
        $CUADROnivel1         = ($acciontboton[0]->boton);
        $acciontboton         = BuscaNivelAccionBoton($id_empresa, $nivel_activos_array[1], $tipo_boton);
        $CUADROnivel2         = ($acciontboton[0]->boton);
        $acciontboton         = BuscaNivelAccionBoton($id_empresa, $nivel_activos_array[2], $tipo_boton);
        $CUADROnivel3         = ($acciontboton[0]->boton);
        $acciontboton         = BuscaNivelAccionBoton($id_empresa, $nivel_activos_array[3], $tipo_boton);
        $CUADROnivel4         = ($acciontboton[0]->boton);
    } else {
        $imagen_fondo = $buscaNivelRol[0]->imagenbackhometemplate;
        if ($imagen_fondo == "") {
            $imagen_fondo = $buscaNivelRol[0]->imagenbackhome;
        }
        $tipo_boton           = "menuactivo";
        //echo "<br><br>menuactivo<br>";
        //print_r($menu_activo);
        $menues_activos_array = explode(",", $menu_activo);
        $acciontboton         = BuscaNivelAccionBoton($id_empresa, $menues_activos_array[0], $tipo_boton);
        //$CUADRO1m=($acciontboton[0]->boton);
        $acciontboton         = BuscaNivelAccionBoton($id_empresa, $menues_activos_array[1], $tipo_boton);
        //$CUADRO2m=($acciontboton[0]->boton);
        $acciontboton         = BuscaNivelAccionBoton($id_empresa, $menues_activos_array[2], $tipo_boton);
        //$CUADRO3m=($acciontboton[0]->boton);
        $acciontboton         = BuscaNivelAccionBoton($id_empresa, $menues_activos_array[3], $tipo_boton);
        //$CUADRO4m=($acciontboton[0]->boton);
        $acciontboton         = BuscaNivelAccionBoton($id_empresa, $menues_activos_array[4], $tipo_boton);
        $CUADROhm             = ($acciontboton[0]->boton);
        $tipo_boton           = "cursoactivo";
        //echo "<br><br>cursoactivo<br>";
        //print_r($curso_activo);
        $curso_activos_array  = explode(",", $curso_activo);
        $acciontboton         = BuscaNivelAccionBoton($id_empresa, $curso_activos_array[0], $tipo_boton);
        $CUADROcurso1         = ($acciontboton[0]->boton);
        $acciontboton         = BuscaNivelAccionBoton($id_empresa, $curso_activos_array[1], $tipo_boton);
        $CUADROcurso2         = ($acciontboton[0]->boton);
        $acciontboton         = BuscaNivelAccionBoton($id_empresa, $curso_activos_array[2], $tipo_boton);
        $CUADROcurso3         = ($acciontboton[0]->boton);
        $acciontboton         = BuscaNivelAccionBoton($id_empresa, $curso_activos_array[3], $tipo_boton);
        $CUADROcurso4         = ($acciontboton[0]->boton);
        $acciontboton         = BuscaNivelAccionBoton($id_empresa, $curso_activos_array[4], $tipo_boton);
        $CUADROcurso5         = ($acciontboton[0]->boton);
    }
    //echo "<br>CUADROcurso1 ".$CUADROcurso1;
    //echo "<br>".$CUADROnivel2;
    //echo " <br>imagen_fondo $imagen_fondo";
    //echo "<br>Reemplazo cuadro1m ".$menues_activos_array[0];
    $PRINCIPAL       = str_replace("{IMAGEN_FONDO}", $imagen_fondo, $PRINCIPAL);
    $PRINCIPAL       = str_replace("{CUADRO1m}", $CUADRO1m, $PRINCIPAL);
    $PRINCIPAL       = str_replace("{CUADRO2m}", $CUADRO2m, $PRINCIPAL);
    $PRINCIPAL       = str_replace("{CUADRO3m}", $CUADRO3m, $PRINCIPAL);
    $PRINCIPAL       = str_replace("{CUADRO4m}", $CUADRO4m, $PRINCIPAL);
    $PRINCIPAL       = str_replace("{CUADROhm}", $CUADROhm, $PRINCIPAL);
    $PRINCIPAL       = str_replace("{CUADROnivel1}", $CUADROnivel1, $PRINCIPAL);
    $PRINCIPAL       = str_replace("{CUADROnivel2}", $CUADROnivel2, $PRINCIPAL);
    $PRINCIPAL       = str_replace("{CUADROnivel3}", $CUADROnivel3, $PRINCIPAL);
    $PRINCIPAL       = str_replace("{CUADROnivel4}", $CUADROnivel4, $PRINCIPAL);
    $PRINCIPAL       = str_replace("{cuadro21a_ref}", $cuadro21a_ref, $PRINCIPAL);
    $PRINCIPAL       = str_replace("{cuadro22a_ref}", $cuadro22a_ref, $PRINCIPAL);
    $PRINCIPAL       = str_replace("{cuadro23a_ref}", $cuadro23a_ref, $PRINCIPAL);
    $PRINCIPAL       = str_replace("{cuadro24a_ref}", $cuadro24a_ref, $PRINCIPAL);
    $PRINCIPAL       = str_replace("{cuadro25a_ref}", $cuadro25a_ref, $PRINCIPAL);
    $PRINCIPAL       = str_replace("{cuadro21b_ref}", $cuadro21b_ref, $PRINCIPAL);
    $PRINCIPAL       = str_replace("{cuadro23b_ref}", $cuadro23b_ref, $PRINCIPAL);
    $PRINCIPAL       = str_replace("{cuadro24b_ref}", $cuadro24b_ref, $PRINCIPAL);
    $PRINCIPAL       = str_replace("{cuadro25b_ref}", $cuadro25b_ref, $PRINCIPAL);
    $PRINCIPAL       = str_replace("{CUADROcurso1}", $CUADROcurso1, $PRINCIPAL);
    $PRINCIPAL       = str_replace("{CUADROcurso2}", $CUADROcurso2, $PRINCIPAL);
    $PRINCIPAL       = str_replace("{CUADROcurso3}", $CUADROcurso3, $PRINCIPAL);
    $PRINCIPAL       = str_replace("{CUADROcurso4}", $CUADROcurso4, $PRINCIPAL);
    $PRINCIPAL       = str_replace("{CUADROcurso5}", $CUADROcurso5, $PRINCIPAL);
    $PRINCIPAL       = str_replace("{cuadroNivAG_ref}", $cuadroNivAG_ref, $PRINCIPAL);
    $PRINCIPAL       = str_replace("{cuadroNivGMM_ref}", $cuadroNivGMM_ref, $PRINCIPAL);
    $PRINCIPAL       = str_replace("{cuadroNivEJ_ref}", $cuadroNivEJ_ref, $PRINCIPAL);
    $PRINCIPAL       = str_replace("{cuadroNivAD_ref}", $cuadroNivAD_ref, $PRINCIPAL);
    $PRINCIPAL       = str_replace("{cuadro1mFN_ref}", $cuadro1mFN_ref, $PRINCIPAL);
    $PRINCIPAL       = str_replace("{cuadro2mFN_ref}", $cuadro2mFN_ref, $PRINCIPAL);
    $PRINCIPAL       = str_replace("{cuadro3mFN_ref}", $cuadro3mFN_ref, $PRINCIPAL);
    $PRINCIPAL       = str_replace("{cuadrohmFN_ref}", $cuadrohmFN_ref, $PRINCIPAL);
    $PuntosYDesafios = buscapuntosydesafiospormallarut($rut, $id_empresa, $id_malla);
    //print_r($PuntosYDesafios[0]->puntosganados);
    //echo "16370";
    if ($PuntosYDesafios[0]->puntosganados > 0) {
        $puntosganados = $PuntosYDesafios[0]->puntosganados;
    } else {
        $puntosganados = 0;
    }
    if ($PuntosYDesafios[0]->desafiosganados > 0) {
        $desafiosganados = $PuntosYDesafios[0]->desafiosganados;
    } else {
        $desafiosganados = 0;
    }
    //echo "nivel personal $nivelPersonal ,   rol Personal $rolPersonal, $puntosganados, $desafiosganados";
    $PRINCIPAL                       = str_replace("{PUNTOSGANADOS}", $puntosganados, $PRINCIPAL);
    $PRINCIPAL                       = str_replace("{DESAFIOSGANADOS}", $desafiosganados, $PRINCIPAL);
    $CursosFinalizados_CursosTotales = buscaCursosFinalizados_Totales($rut, $id_empresa, $id_malla);
    foreach ($CursosFinalizados_CursosTotales as $CursoFinalizado_Curso) {
        if ($CursoFinalizado_Curso->estado == 1) {
            $imagen_activo .= "<img src='img/bci_comp_globo_amarillo.png'>";
        } elseif ($CursoFinalizado_Curso->estado === '0') {
            //echo "chau";
            $imagen_activo .= "<img src='img/bci_comp_globo_reprobado.png'>";
        } elseif ($CursoFinalizado_Curso->estado == NULL) {
            //echo "hola1";
            $imagen_inactivo .= "<img src='img/bci_comp_globo_bn.png'>";
        } elseif ($CursoFinalizado_Curso->estado == "") {
            //echo "hola2";
            $imagen_inactivo .= "<img src='img/bci_comp_globo_bn.png'>";
        } else {
            $imagen_inactivo .= "<img src='img/bci_comp_globo_bn.png'>";
        }
    }
    //echo "hola";
    //print_r($CursosFinalizados_CursosTotales);
    $total_niveles_Malla = TotalNivelesMalla($id_empresa, $id_malla);
    $TotalObjetos        = BuscaTotalOBjetosCursosIdMalla($id_empresa, $id_malla, $rut);
    //print_r($TotalObjetos);
    $procentaje_avance   = round(100 * $TotalObjetos[0]->cuentafinalizados / $TotalObjetos[0]->cuentaobjetostotales);
    //echo "<br>";
    //echo "hola";
    //print_r($total_niveles_Malla);
    //echo "<br>";
    //echo "hola";
    $PRINCIPAL           = str_replace("{GLOBOS_ACTIVOS_AMARILLOS}", $imagen_activo, $PRINCIPAL);
    $PRINCIPAL           = str_replace("{GLOBOS_INACTIVOS}", $imagen_inactivo, $PRINCIPAL);
    $PRINCIPAL           = str_replace("{MI_ROL}", $rolPersonal, $PRINCIPAL);
    $PRINCIPAL           = str_replace("{MI_NIVEL}", $nivelPersonal, $PRINCIPAL);
    $PRINCIPAL           = str_replace("{TOTAL_NIVEL}", $total_niveles_Malla[0]->cuenta, $PRINCIPAL);
    $PRINCIPAL           = str_replace("{BARRA_DE_AVANCE}", $procentaje_avance, $PRINCIPAL);
    return ($PRINCIPAL);
}
function ColocarDatosHomeBciCompetencias($PRINCIPAL, $rut, $id_empresa, $id_malla, $nivel, $mod, $template_comp)
{
    $id_malla_enc    = Encodear3($id_malla);
    //    echo "<br>_ $rut, $id_empresa, malla $id_malla, <br>";
    $datos_curso     = TotalcursosPorUsuaroEmpresa($rut, $id_empresa, $id_malla);
    //print_r($datos_curso);
    $total_aprobados = 0;
    //$id_malla="bci_comp";
    $datos_nivel     = TotalNivelPorUsuaroEmpresa($rut, $id_empresa, $id_malla);
    //print_r($datos_nivel);
    if ($nivel <> '') {
        $nivel = $nivel;
    } else {
        $id_nivel = $datos_nivel[0]->id_nivel;
        $nivel    = $datos_nivel[0]->idorden + 1;
        $mod      = 0;
    }
    $minivel           = $nivel;
    //echo "<br>minivel $minivelnivel $nivel, mod $mod, id nivel $id_nivel";
    //verifica MOD
    $cursosaprobados   = buscacursosaprobadospornivel($nivel, $rut, $id_empresa, $id_malla);
    $nivelFinalizados  = NivelesFinalizados($rut, $id_empresa, $id_malla);
    $nivel_actual      = $nivelFinalizados[0]->cuenta + 1;
    $nivel_actual_real = $nivelFinalizados[0]->cuenta + 1;
    //echo "finalizados $nivelFinalizados actual $nivel_actual";
    if ($template_comp <> '') {
        if ($template_comp == 1) {
            //echo $id_malla;
            if ($id_malla == "bci_comp_gmm" or $id_malla == "bci_comp_ag") {
                if ($nivel_actual > 6) {
                    $nivel_actual = 6;
                } else {
                    $nivel_actual = $nivel_actual;
                }
            }
            if ($id_malla == "bci_comp_ad" or $id_malla == "bci_comp_ej") {
                if ($nivel_actual > 5) {
                    $nivel_actual = 5;
                } else {
                    $nivel_actual = $nivel_actual;
                }
            }
        }
        if ($id_malla == "bci_comp_gmm" or $id_malla == "bci_comp_ag") {
            if ($nivel_actual > 6) {
                $nivel_actual = 7;
            } else {
                $nivel_actual = $nivel_actual;
            }
        }
    }
    if ($id_malla == "bci_comp_ad" or $id_malla == "bci_comp_ej") {
        if ($nivel_actual_real == 6) {
            $nivel_actual = 7;
        } else {
            $nivel_actual = $nivel_actual;
        }
    }
    if ($id_malla == "bci_comp_ad" or $id_malla == "bci_comp_ej") {
        if ($nivel_actual_real == 7) {
            $nivel_actual = 8;
        } else {
            $nivel_actual = $nivel_actual;
        }
    }
    if ($template_comp == "Fn") {
        $nivel_actual = $minivel;
        $imagen_fondo = $buscaNivelRol[0]->imagenbackhome;
    }
    //echo "<br>nivel_actual $nivel_actual";
    $buscaNivelRol             = buscaNivelRol($rut, $id_empresa, $id_malla, $nivel_actual);
    //print_r($buscaNivelRol);
    $nivelPersonal             = $buscaNivelRol[0]->nivelnombre;
    $rolPersonal               = $buscaNivelRol[0]->descripcionRol;
    $id_curso_activo           = $buscaNivelRol[0]->idcurso_actual;
    $template_detalle_cursoCap = $buscaNivelRol[0]->template_detalle_cursoCap;
    $menu_activo               = $buscaNivelRol[0]->menuactivo;
    $nivel_activo              = $buscaNivelRol[0]->nivelactivo;
    $curso_activo              = $buscaNivelRol[0]->cursoactivo;
    if ($template_comp == "Fn") {
        $tipo_boton          = "nivelactivo";
        //echo "<br><br>nivelactivo<br>";
        //print_r($nivel_activo);
        $nivel_activos_array = explode(",", $nivel_activo);
        $acciontboton        = BuscaNivelAccionBoton($id_empresa, $nivel_activos_array[0], $tipo_boton);
        $CUADROnivel1        = ($acciontboton[0]->boton);
        $acciontboton        = BuscaNivelAccionBoton($id_empresa, $nivel_activos_array[1], $tipo_boton);
        $CUADROnivel2        = ($acciontboton[0]->boton);
        $acciontboton        = BuscaNivelAccionBoton($id_empresa, $nivel_activos_array[2], $tipo_boton);
        $CUADROnivel3        = ($acciontboton[0]->boton);
        $acciontboton        = BuscaNivelAccionBoton($id_empresa, $nivel_activos_array[3], $tipo_boton);
        $CUADROnivel4        = ($acciontboton[0]->boton);
    }
    // Imagen de fondo
    if ($template_comp == "") {
        $imagen_fondo         = $buscaNivelRol[0]->imagenbackhome;
        //echo "<br> For Each Menu<br>";
        $tipo_boton           = "menuactivo";
        //echo "<br><br>menuactivo<br>";
        //print_r($menu_activo);
        $menues_activos_array = explode(",", $menu_activo);
        $acciontboton         = BuscaNivelAccionBoton($id_empresa, $menues_activos_array[0], $tipo_boton);
        $CUADRO1m             = ($acciontboton[0]->boton);
        $acciontboton         = BuscaNivelAccionBoton($id_empresa, $menues_activos_array[1], $tipo_boton);
        $CUADRO2m             = ($acciontboton[0]->boton);
        $acciontboton         = BuscaNivelAccionBoton($id_empresa, $menues_activos_array[2], $tipo_boton);
        $CUADRO3m             = ($acciontboton[0]->boton);
        $acciontboton         = BuscaNivelAccionBoton($id_empresa, $menues_activos_array[3], $tipo_boton);
        $CUADRO4m             = ($acciontboton[0]->boton);
        $acciontboton         = BuscaNivelAccionBoton($id_empresa, $menues_activos_array[4], $tipo_boton);
        $CUADROhm             = ($acciontboton[0]->boton);
        //echo "<br> For Each Link Activo<br>";
        $tipo_boton           = "nivelactivo";
        //echo "<br><br>nivelactivo<br>";
        //print_r($nivel_activo);
        $nivel_activos_array  = explode(",", $nivel_activo);
        $acciontboton         = BuscaNivelAccionBoton($id_empresa, $nivel_activos_array[0], $tipo_boton);
        $CUADROnivel1         = ($acciontboton[0]->boton);
        $acciontboton         = BuscaNivelAccionBoton($id_empresa, $nivel_activos_array[1], $tipo_boton);
        $CUADROnivel2         = ($acciontboton[0]->boton);
        $acciontboton         = BuscaNivelAccionBoton($id_empresa, $nivel_activos_array[2], $tipo_boton);
        $CUADROnivel3         = ($acciontboton[0]->boton);
        $acciontboton         = BuscaNivelAccionBoton($id_empresa, $nivel_activos_array[3], $tipo_boton);
        $CUADROnivel4         = ($acciontboton[0]->boton);
    } else {
        $imagen_fondo = $buscaNivelRol[0]->imagenbackhometemplate;
        if ($imagen_fondo == "") {
            $imagen_fondo = $buscaNivelRol[0]->imagenbackhome;
        }
        $tipo_boton           = "menuactivo";
        //echo "<br><br>menuactivo<br>";
        //print_r($menu_activo);
        $menues_activos_array = explode(",", $menu_activo);
        $acciontboton         = BuscaNivelAccionBoton($id_empresa, $menues_activos_array[0], $tipo_boton);
        //$CUADRO1m=($acciontboton[0]->boton);
        $acciontboton         = BuscaNivelAccionBoton($id_empresa, $menues_activos_array[1], $tipo_boton);
        //$CUADRO2m=($acciontboton[0]->boton);
        $acciontboton         = BuscaNivelAccionBoton($id_empresa, $menues_activos_array[2], $tipo_boton);
        //$CUADRO3m=($acciontboton[0]->boton);
        $acciontboton         = BuscaNivelAccionBoton($id_empresa, $menues_activos_array[3], $tipo_boton);
        //$CUADRO4m=($acciontboton[0]->boton);
        $acciontboton         = BuscaNivelAccionBoton($id_empresa, $menues_activos_array[4], $tipo_boton);
        $CUADROhm             = ($acciontboton[0]->boton);
        $tipo_boton           = "cursoactivo";
        //echo "<br><br>cursoactivo<br>";
        //print_r($curso_activo);
        $curso_activos_array  = explode(",", $curso_activo);
        $acciontboton         = BuscaNivelAccionBoton($id_empresa, $curso_activos_array[0], $tipo_boton);
        $CUADROcurso1         = ($acciontboton[0]->boton);
        $acciontboton         = BuscaNivelAccionBoton($id_empresa, $curso_activos_array[1], $tipo_boton);
        $CUADROcurso2         = ($acciontboton[0]->boton);
        $acciontboton         = BuscaNivelAccionBoton($id_empresa, $curso_activos_array[2], $tipo_boton);
        $CUADROcurso3         = ($acciontboton[0]->boton);
        $acciontboton         = BuscaNivelAccionBoton($id_empresa, $curso_activos_array[3], $tipo_boton);
        $CUADROcurso4         = ($acciontboton[0]->boton);
        $acciontboton         = BuscaNivelAccionBoton($id_empresa, $curso_activos_array[4], $tipo_boton);
        $CUADROcurso5         = ($acciontboton[0]->boton);
    }
    //echo "<br>CUADROcurso1 ".$CUADROcurso1;
    //echo "<br>".$CUADROnivel2;
    //echo " <br>imagen_fondo $imagen_fondo";
    //echo "<br>Reemplazo cuadro1m ".$menues_activos_array[0];
    $PRINCIPAL       = str_replace("{IMAGEN_FONDO}", $imagen_fondo, $PRINCIPAL);
    $PRINCIPAL       = str_replace("{CUADRO1m}", $CUADRO1m, $PRINCIPAL);
    $PRINCIPAL       = str_replace("{CUADRO2m}", $CUADRO2m, $PRINCIPAL);
    $PRINCIPAL       = str_replace("{CUADRO3m}", $CUADRO3m, $PRINCIPAL);
    $PRINCIPAL       = str_replace("{CUADRO4m}", $CUADRO4m, $PRINCIPAL);
    $PRINCIPAL       = str_replace("{CUADROhm}", $CUADROhm, $PRINCIPAL);
    $PRINCIPAL       = str_replace("{CUADROnivel1}", $CUADROnivel1, $PRINCIPAL);
    $PRINCIPAL       = str_replace("{CUADROnivel2}", $CUADROnivel2, $PRINCIPAL);
    $PRINCIPAL       = str_replace("{CUADROnivel3}", $CUADROnivel3, $PRINCIPAL);
    $PRINCIPAL       = str_replace("{CUADROnivel4}", $CUADROnivel4, $PRINCIPAL);
    $PRINCIPAL       = str_replace("{cuadro21a_ref}", $cuadro21a_ref, $PRINCIPAL);
    $PRINCIPAL       = str_replace("{cuadro22a_ref}", $cuadro22a_ref, $PRINCIPAL);
    $PRINCIPAL       = str_replace("{cuadro23a_ref}", $cuadro23a_ref, $PRINCIPAL);
    $PRINCIPAL       = str_replace("{cuadro24a_ref}", $cuadro24a_ref, $PRINCIPAL);
    $PRINCIPAL       = str_replace("{cuadro25a_ref}", $cuadro25a_ref, $PRINCIPAL);
    $PRINCIPAL       = str_replace("{cuadro21b_ref}", $cuadro21b_ref, $PRINCIPAL);
    $PRINCIPAL       = str_replace("{cuadro23b_ref}", $cuadro23b_ref, $PRINCIPAL);
    $PRINCIPAL       = str_replace("{cuadro24b_ref}", $cuadro24b_ref, $PRINCIPAL);
    $PRINCIPAL       = str_replace("{cuadro25b_ref}", $cuadro25b_ref, $PRINCIPAL);
    $PRINCIPAL       = str_replace("{CUADROcurso1}", $CUADROcurso1, $PRINCIPAL);
    $PRINCIPAL       = str_replace("{CUADROcurso2}", $CUADROcurso2, $PRINCIPAL);
    $PRINCIPAL       = str_replace("{CUADROcurso3}", $CUADROcurso3, $PRINCIPAL);
    $PRINCIPAL       = str_replace("{CUADROcurso4}", $CUADROcurso4, $PRINCIPAL);
    $PRINCIPAL       = str_replace("{CUADROcurso5}", $CUADROcurso5, $PRINCIPAL);
    $PRINCIPAL       = str_replace("{cuadroNivAG_ref}", $cuadroNivAG_ref, $PRINCIPAL);
    $PRINCIPAL       = str_replace("{cuadroNivGMM_ref}", $cuadroNivGMM_ref, $PRINCIPAL);
    $PRINCIPAL       = str_replace("{cuadroNivEJ_ref}", $cuadroNivEJ_ref, $PRINCIPAL);
    $PRINCIPAL       = str_replace("{cuadroNivAD_ref}", $cuadroNivAD_ref, $PRINCIPAL);
    $PRINCIPAL       = str_replace("{cuadro1mFN_ref}", $cuadro1mFN_ref, $PRINCIPAL);
    $PRINCIPAL       = str_replace("{cuadro2mFN_ref}", $cuadro2mFN_ref, $PRINCIPAL);
    $PRINCIPAL       = str_replace("{cuadro3mFN_ref}", $cuadro3mFN_ref, $PRINCIPAL);
    $PRINCIPAL       = str_replace("{cuadrohmFN_ref}", $cuadrohmFN_ref, $PRINCIPAL);
    $PuntosYDesafios = buscapuntosydesafiospormallarut($rut, $id_empresa, $id_malla);
    //print_r($PuntosYDesafios[0]->puntosganados);
    //echo "16370";
    if ($PuntosYDesafios[0]->puntosganados > 0) {
        $puntosganados = $PuntosYDesafios[0]->puntosganados;
    } else {
        $puntosganados = 0;
    }
    if ($PuntosYDesafios[0]->desafiosganados > 0) {
        $desafiosganados = $PuntosYDesafios[0]->desafiosganados;
    } else {
        $desafiosganados = 0;
    }
    //echo "nivel personal $nivelPersonal ,   rol Personal $rolPersonal";
    $PRINCIPAL                       = str_replace("{PUNTOSGANADOS}", $puntosganados, $PRINCIPAL);
    $PRINCIPAL                       = str_replace("{DESAFIOSGANADOS}", $desafiosganados, $PRINCIPAL);
    $CursosFinalizados_CursosTotales = buscaCursosFinalizados_Totales($rut, $id_empresa, $id_malla);
    //print_r($CursosFinalizados_CursosTotales);
    foreach ($CursosFinalizados_CursosTotales as $CursoFinalizado_Curso) {
        if ($CursoFinalizado_Curso->estado == 1) {
            $imagen_activo .= "<img src='img/bci_comp_globo_amarillo.png'>";
        } elseif ($CursoFinalizado_Curso->estado === '0') {
            //echo "chau";
            $imagen_activo .= "<img src='img/bci_comp_globo_reprobado.png'>";
        } elseif ($CursoFinalizado_Curso->estado == NULL) {
            //echo "hola1";
            $imagen_inactivo .= "<img src='img/bci_comp_globo_bn.png'>";
        } elseif ($CursoFinalizado_Curso->estado == "") {
            //echo "hola2";
            $imagen_inactivo .= "<img src='img/bci_comp_globo_bn.png'>";
        } else {
            $imagen_inactivo .= "<img src='img/bci_comp_globo_bn.png'>";
        }
    }
    $PRINCIPAL = str_replace("{GLOBOS_ACTIVOS_AMARILLOS}", $imagen_activo, $PRINCIPAL);
    $PRINCIPAL = str_replace("{GLOBOS_INACTIVOS}", $imagen_inactivo, $PRINCIPAL);
    $PRINCIPAL = str_replace("{MI_ROL}", $rolPersonal, $PRINCIPAL);
    $PRINCIPAL = str_replace("{MI_NIVEL}", $nivelPersonal, $PRINCIPAL);
    return ($PRINCIPAL);
}
function MuestraFormulario($id_categoria, $id_empresa, $rut)
{
    $datos_formulario = FormularioDadoIdCategoria($id_categoria, $id_empresa);
    $html             = file_get_contents("views/formularios/" . $datos_formulario[0]->template);
    $html             = str_replace("{TITULO1}", ($datos_formulario[0]->nombre), $html);
    //$html = str_replace("{OPTIONS_CATEGORIAS_VALOR}",OptionsGenericoNombreDadoValoresPorEmpresa("tbl_salonfama_valores", "",  "nombre", "id", "order by nombre asc", $id_empresa),$html);
    $html             = str_replace("{OPTIONS_CATEGORIAS_VALOR}", OptionsCategoriasValoresFormularios($id_categoria, $id_empresa), $html);
    $html             = str_replace("{CASE}", $datos_formulario[0]->case, $html);
    $html             = str_replace("{ID_TIPO}", Encodear3($id_categoria), $html);
    $html             = str_replace("{RUT_BUENASPRACTICAS}", $rut, $html);
    return ($html);
}
function BloqueListadoConectate($html, $id_empresa, $id_categoria)
{
    $rut          = $_SESSION["user_"];
    //Traigo el listado publicados, dado
    //$datos=TraeListadoClasicos($id_empresa, "", "order by antiguedad desc");
    $datos        = TotalReconocimientosPorCategoria($id_categoria, $id_empresa);
    $html         = str_replace("{TITULO1}", ($datos[0]->titulo_pagina), $html);
    $html         = str_replace("{ID_CATEGORIA_ENCODEADO}", Encodear3($id_categoria), $html);
    $html         = str_replace("{IMAGEN_FORM}", $datos[0]->imagen_form, $html);
    $html         = str_replace("{IMAGEN_FORM}", $datos[0]->imagen_form, $html);
    $html         = str_replace("{IMAGEN_INICIO_PAGINA}", $datos[0]->imagen_inicio_pagina, $html);
    $template_row = $datos[0]->template_row;
    $subtitulo    = "";
    //echo round($datos[0]->antiguedad/5);
    $subtitulo    = "";
    foreach ($datos as $unico) {
        if ($subtitulo <> $unico->nombre_valor) {
            $row .= file_get_contents("views/reconocimiento/subtitulo.html");
            $row       = str_replace("{TITULO}", $unico->nombre_valor, $row);
            $subtitulo = $unico->nombre_valor;
        } else {
            $subtitulo = $unico->nombre_valor;
        }
        $row .= file_get_contents("views/" . $template_row);
        $row = str_replace("{NOMBRE}", $unico->nombre . " " . $unico->apaterno . " " . $unico->amaterno, $row);
        $row = str_replace("{ANOS}", $unico->antiguedad, $row);
        $row = str_replace("{CARGO}", $unico->cargo, $row);
        $row = str_replace("{URL_PERSONA}", VerificaFotoPersonal($unico->rut), $row);
        $row = str_replace("{RUT_ENCODEADO}", Encodear3($unico->rut), $row);
        $row = str_replace("{VALOR_SITUACION}", ($unico->situacion), $row);
        $row = str_replace("{VALOR_ACCION}", ($unico->accion), $row);
        $row = str_replace("{VALOR_IMPACTO}", ($unico->impacto), $row);
        $row = str_replace("{FECHAPUBLICACION}", ($unico->fecha), $row);
        $row = str_replace("{VALOR_CONDUCTA}", ($unico->nombre_conducta_valor), $row);
        //$row = str_replace("{MEGUSTA}",file_get_contents("views/megusta/bloque_comentario_megusta.html"),$row);
        //$row = str_replace("{ID_CONTENIDO}",$unico->id,$row);
        $row = str_replace("{MEGUSTA}", ColocaMeGusta($unico->id, "id_salonfama_publicados", $id_empresa, $rut), $row);
        /*$tiene_megusta=VerCantidadMeGustaPorObjetoYUsuario($unico->id, "id_salonfama_publicados", $id_empresa, $rut);
        if($tiene_megusta){
        $row = str_replace("{MEGUSTA}",file_get_contents("views/megusta/bloque_comentario_yamegusta.html"),$row);
        $cantidad_megusta=VerCantidadMeGustaPorObjeto($unico->id, "id_salonfama_publicados", $id_empresa);
        $row = str_replace("{CANTIDAD_MEGUSTA}",count($cantidad_megusta),$row);
        }else{
        $row = str_replace("{MEGUSTA}",file_get_contents("views/megusta/bloque_comentario_megusta.html"),$row);
        $row = str_replace("{ID_CONTENIDO}",($unico->id),$row);
        $row = str_replace("{TIPO_OBJETO_MEGUSTA}","id_salonfama_publicados",$row);
        }
        */
    }
    $html = str_replace("{BLOQUE_LISTADO_CLASICOS}", ($row), $html);
    return ($html);
}
function BloqueListadoClasicos($html, $id_empresa)
{
    //Traigo el listado de usuarios para ver en Clasicos
    $datos       = TraeListadoClasicos($id_empresa, "", "order by antiguedad desc");
    $subtitulo   = "";
    //echo round($datos[0]->antiguedad/5);
    $valor_mayor = (round($datos[0]->antiguedad / 10) * 10);
    $valor_menor = $valor_mayor - 10;
    $row .= file_get_contents("views/clasicos/subtitulo.html");
    //$row = str_replace("{IMG_SUBTITULO}","clasicos_golden.jpg",$row);
    //echo "<br>";
    $row = str_replace("{NUMERO}", $valor_menor . " a " . $valor_mayor, $row);
    $j   = 0;
    foreach ($datos as $unico) {
        if ($unico->antiguedad >= $valor_menor && $unico->antiguedad < $valor_mayor) {
            //$valor_mayor=(round($unico->antiguedad/5)*5);
            //$valor_menor=$valor_mayor-5;
        } else {
            //echo $valor_menor;
            //echo "<br>";
            $row .= file_get_contents("views/clasicos/subtitulo.html");
            $valor_mayor = (round($unico->antiguedad / 10) * 10);
            $valor_menor = $valor_mayor - 10;
            if ($valor_menor == 20) {
                $row = str_replace("{IMG_SUBTITULO}", "clasicos_silver.jpg", $row);
            } elseif ($valor_menor == 10) {
                $row = str_replace("{IMG_SUBTITULO}", "clasicos_bronce.jpg", $row);
            }
            if ($valor_menor == 0)
                break;
            $row = str_replace("{NUMERO}", $valor_menor . " a " . $valor_mayor, $row);
        }
        if ($valor_menor == 30) {
            $row .= file_get_contents("views/clasicos/row_golden.html");
        } else if ($valor_menor == 20) {
            $row .= file_get_contents("views/clasicos/row_silver.html");
        } else if ($valor_menor == 10) {
            $row .= file_get_contents("views/clasicos/row_bronce.html");
        }
        $j++;
        if ($j == 2) {
            $row .= '<div class="row"></div>';
            $j = 0;
        }
        $row = str_replace("{NOMBRE}", $unico->nombre_persona . " " . $unico->apaterno . " " . $unico->amaterno, $row);
        $row = str_replace("{ANOS}", $unico->antiguedad, $row);
        $row = str_replace("{CARGO}", $unico->cargo, $row);
        $row = str_replace("{URL_PERSONA}", VerificaFotoPersonal($unico->rut), $row);
        $row = str_replace("{RUT_ENCODEADO}", Encodear3($unico->rut), $row);
    }
    $html = str_replace("{BLOQUE_LISTADO_CLASICOS}", ($row), $html);
    return ($html);
}
function BloqueClasicos($html, $id_empresa, $cantidad_registros)
{
    //Dada la empresa, traigo a todos los que estan en la tabla de salon de la fama
    $bloque = file_get_contents("views/salondelafama/bloquesalonfama.html");
    //Primero por traigo las categorias por la empresa
    if ($_SESSION["id_empresa"] == 22) {
        $row = file_get_contents("views/salondelafama/22_row_bloquesalonfama.html");
    } else {
        $row = file_get_contents("views/salondelafama/row_bloquesalonfama.html");
    }
    $row    = str_replace("{NOMBRE_CATEGORIA}", "Clasicos", $row);
    $row    = str_replace("{LOGO_CATEGORIA}", "logo_clasico.png", $row);
    $row    = str_replace("{DESCRIPCION_CATEGORIA}", $unico->descripcion, $row);
    //Por la categoria traigo la cantidad X de ganadores
    $row    = str_replace("{NOMBRE_PERSONAS}", $datos[0]->nombre_persona . " " . $datos[0]->apaterno . " " . $datos[0]->amaterno, $row);
    $row    = str_replace("{CARGO_PERSONAS}", $datos[0]->cargo, $row);
    $row    = str_replace("{URL_PERSONA}", VerificaFotoPersonal($datos[0]->rut), $row);
    $row    = str_replace("{RUT_ENCODEADO}", Encodear3($datos[0]->rut), $row);
    $row    = str_replace("{TEXTO1}", $datos[0]->texto1, $row);
    $row    = str_replace("{TEXTO2}", $datos[0]->texto2, $row);
    $row    = str_replace("{TEXTO3}", $datos[0]->texto3, $row);
    $row    = str_replace("{TEXTO4}", $datos[0]->texto4, $row);
    $row    = str_replace("{TEXTO5}", $datos[0]->texto5, $row);
    //$row=file_get_contents("views/salondelafama/bloquesalonfama.html");
    $bloque = str_replace("{LISTADO_SALON_FAMA}", ($row), $bloque);
    $html   = str_replace("{BLOQUE_CLASICOS}", $bloque, $html);
    return ($html);
}
function ObtenerAnosDadoFecha($fecha)
{
    $dias = explode("-", $fecha, 3);
    $dias = mktime(0, 0, 0, $dias[1], $dias[0], $dias[2]);
    $edad = (int) ((time() - $dias) / 31556926);
    return $edad;
}
function BloqueBanners($html, $id_empresa)
{
    //Traigo los banner por empresa
    $total_banners = BannersPorEmpresa($id_empresa);
    if ($total_banners) {
        $html_banners = "";
        foreach ($total_banners as $banner) {
            if ($banner->icono) {
                $html_banners .= file_get_contents("views/banners/imagentexto_conicono.html");
                $html_banners = str_replace("{ICONO}", $banner->icono, $html_banners);
            } else {
                $html_banners .= file_get_contents("views/banners/" . $banner->template);
            }
            $html_banners = str_replace("{TEXTO}", ($banner->texto), $html_banners);
            $html_banners = str_replace("{IMAGEN_IZQUIERDA}", $banner->imagen_izquierda, $html_banners);
        }
        $html = str_replace("{SECCION_BANNERS}", ($html_banners), $html);
    } else {
        $html = str_replace("{SECCION_BANNERS}", "", $html);
    }
    return ($html);
}
function ArmaBloqueComentariosPorEmpresa($PRINCIPAL, $id_empresa, $rut, $id_categoria, $id_comentario)
{
    //echo "$id_categoria $id_comentario";
    $categorias = CategoriasComentariosPorEmpresa($id_empresa);
    foreach ($categorias as $cat) {
        if ($id_categoria == $cat->id) {
            $formulario .= file_get_contents("views/comentarios/formulario_edicion.html");
            $datos_comentario = DatosComentarioPorId($id_comentario);
            $formulario       = str_replace("{COMENTARIO}", $datos_comentario[0]->comentario, $formulario);
            $formulario       = str_replace("{ID_COMENTARIO_ENCODEADO}", $id_comentario, $formulario);
        } else {
            $formulario .= file_get_contents("views/comentarios/formulario.html");
        }
        $formulario      = str_replace("{DESCRIPCION}", $cat->descripcion, $formulario);
        $formulario      = str_replace("{RUT_EVALUADO_ENCODEADO}", Encodear3($rut), $formulario);
        $comentarios     = ComentariosPorCategoria($cat->id);
        $html_comentario = "";
        if ($comentarios) {
            foreach ($comentarios as $comen) {
                $html_comentario .= file_get_contents("views/comentarios/row_comentario.html");
                $html_comentario = str_replace("{COMENTARIO}", $comen->comentario, $html_comentario);
                $html_comentario = str_replace("{FECHA}", FechaTipoSpa($comen->fecha), $html_comentario);
                $html_comentario = str_replace("{ID_COMENTARIO_ENCODEADO}", Encodear3($comen->id), $html_comentario);
            }
            $formulario = str_replace("{BLOQUE_COMENTARIOS_INGRESADOS}", $html_comentario, $formulario);
        } else {
            $formulario = str_replace("{BLOQUE_COMENTARIOS_INGRESADOS}", "", $formulario);
        }
        $formulario = str_replace("{ID_CATEGORIA_COMENTARIO_ENCODEADO}", Encodear3($cat->id), $formulario);
    }
    //Veo si tiene comentarios
    $PRINCIPAL = str_replace("{ENTORNO_COMENTARIOS}", ($formulario), $PRINCIPAL);
    return ($PRINCIPAL);
}
function EvaluadoParaEstaPregunta($id_componente, $id_pregunta, $evaluado, $id_perfil)
{
    //$preguntas_por_encuesta=PreguntasPorCompetenciaPorPerfilEval($id_perfil);
    $preguntas_por_encuesta = PreguntasPorCompetenciaPorPerfilEvalParaValidar($id_perfil);
    $muestra                = "no";
    foreach ($preguntas_por_encuesta as $unico) {
        if ($unico->id == $id_pregunta) {
            $muestra = "si";
            continue;
        }
    }
    return ($muestra);
}
function ListadoIngresoBitacoras($evaluado, $evaluador, $id_bitacora, $tipo, $sgd_version)
{
    if ($_SESSION["id_empresa"] == 28) {
        $tiene_bitacora = TraeDatosPorBitacoraPorCompetencia($evaluado);
    } else {
        $tiene_bitacora = TraeDatosPorBitacora($evaluado);
    }
    if ($tiene_bitacora) {
        foreach ($tiene_bitacora as $dato) {
            if ($dato->id == $id_bitacora) {
                if ($sgd_version == 2) {
                    $template .= file_get_contents("views/sgd/bitacora/row_bitacora_edicion_chilquinta.html");
                } else {
                    $template .= file_get_contents("views/sgd/bitacora/row_bitacora_edicion.html");
                }
                $template = str_replace("{OPTIONS_VALORES}", OptionsGenericoNombreDadoValoresPorEmpresa("tbl_bitacora_valores", $dato->valor, "valor", "id", "order by valor asc", $_SESSION["id_empresa"]), $template);
                if ($dato->realizado == "si") {
                    $template = str_replace("{CHECKEDREALIZADOSI}", "checked", $template);
                    $template = str_replace("{CHECKEDREALIZADONO}", "", $template);
                    $template = str_replace("{STYLE_DISPLAY}", 'style="display: none"', $template);
                } else if ($dato->realizado == "no") {
                    $template = str_replace("{CHECKEDREALIZADONO}", "checked", $template);
                    $template = str_replace("{CHECKEDREALIZADOSI}", "", $template);
                } else {
                    $template = str_replace("{CHECKEDREALIZADONO}", "", $template);
                    $template = str_replace("{CHECKEDREALIZADOSI}", "", $template);
                }
            } else {
                if ($sgd_version == 2) {
                    $template .= file_get_contents("views/sgd/bitacora/row_bitacora_lectura_chilquinta.html");
                    if ($evaluado == $evaluador) {
                        $template = str_replace("{BOTON_MODIFICAR}", file_get_contents("views/sgd/bitacora/boton_modifica.html"), $template);
                    } else {
                        $template = str_replace("{BOTON_MODIFICAR}", "", $template);
                    }
                } else {
                    $template .= file_get_contents("views/sgd/bitacora/row_bitacora_lectura.html");
                }
            }
            $template = str_replace("{VALOR}", ($dato->nombre_valor), $template);
            $template = str_replace("{TEXTO_ST}", $dato->texto_st, $template);
            $template = str_replace("{AUTOR}", ($dato->nombre_completo), $template);
            $template = str_replace("{FECHA}", formatearFechaCompleta($dato->fecha), $template);
            $template = str_replace("{TEXTO_A}", $dato->texto_a, $template);
            $template = str_replace("{TEXTO_R}", $dato->texto_r, $template);
            if ($dato->realizado == "si") {
                $template = str_replace("{REALIZADO}", file_get_contents("views/sgd/bitacora/realizado_si.html"), $template);
                $template = str_replace("{LINEA_BLOQUE_NEGATIVO}", file_get_contents("views/sgd/bitacora/row_bitacora_lectura_bloque_positivo.html"), $template);
            } else {
                $template = str_replace("{REALIZADO}", file_get_contents("views/sgd/bitacora/realizado_no.html"), $template);
                $template = str_replace("{LINEA_BLOQUE_NEGATIVO}", file_get_contents("views/sgd/bitacora/row_bitacora_lectura_bloque_negativo.html"), $template);
            }
            //$template = str_replace("{REALIZADO}",$dato->realizado,$template);
            $template = str_replace("{TEXTO_AA}", $dato->texto_aa, $template);
            $template = str_replace("{TEXTO_AT}", $dato->texto_at, $template);
            $template = str_replace("{ID_BITACORA_ENCODEADA}", Encodear3($dato->id), $template);
            $template = str_replace("{RUT_EVALUADO_ENCODEADO}", Encodear3($evaluado), $template);
        }
    } else {
        $template = file_get_contents("views/sgd/bitacora/sin_objetivos.html");
    }
    return ($template);
}
function ListadoColaboradoresBitacora($html, $evaluador, $rut_evaluado, $id_bitacora, $sgd_version, $id_proceso)
{
    //$evaluados=EvaluadosDadoEvaluador($evaluador);
    //$evaluados=EvaluadosDadoEvaluadorParaBitacora($evaluador);
    $evaluados = EvaluadosDadoEvaluadorParaBitacoraPorProceso($evaluador, $id_proceso);
    //Se muestran los objetivos individuales.
    //if($_SESSION["id_empresa"]==28){
    if ($sgd_version == 2) {
        $total_html   = file_get_contents("views/sgd/bitacora/entorno_bloque_principal_chilquinta.html");
        $row_template = file_get_contents("views/sgd/bitacora/row_colaboradores_chilquinta.html");
        //$row_template=file_get_contents("views/sgd/bitacora/row_colaboradores.html");
    } else {
        $total_html   = file_get_contents("views/sgd/bitacora/entorno_bloque_principal.html");
        $row_template = file_get_contents("views/sgd/bitacora/row_colaboradores.html");
    }
    //Primero veo si es que hay registro en la tabla de sesion
    $row                           = "";
    $ok_finalizado                 = 0;
    $html                          = str_replace("{SECCION_EQUIPO_CONSOLIDADO}", file_get_contents("views/sgd/bitacora/vista_consolidada_equipo.html"), $html);
    $html                          = str_replace("{GRAFICO}", file_get_contents("views/sgd/graficos/graficoBarraBitacora.html"), $html);
    $total_positivas_por_evaluador = 0;
    $total_negativas_por_evaluador = 0;
    foreach ($evaluados as $evaluado) {
        $row .= $row_template;
        $objetivos_validados_por_validador = VerificaSiObjetivosEstanValidados($evaluado->evaluado);
        //$row=FormularioIngresaObjetivos($row, $evaluado->evaluado, $evaluador);
        $row                               = ColocaDatosUsuario($row, $evaluado->evaluado, "bitacora");
        //$valores_objetivos=ListadoObjetivosAValidar($evaluado->evaluado, $evaluador, $id_objetivo, "jefe");
        $valores_objetivos                 = ListadoIngresoBitacoras($evaluado->evaluado, $evaluador, $id_bitacora, "jefe", $sgd_version);
        $row                               = str_replace("{LISTADO_OBJETIVOS_A_EVALUAR}", $valores_objetivos, $row);
        $ponderaciones_bases               = DevuelvePonderacionesPorEvaluado($evaluado->evaluado);
        $verifica_evaluado_validado        = VerificaSiObjetivosEstanAjustados($evaluado->evaluado);
        if ($rut_evaluado == $evaluado->evaluado && !$id_bitacora) {
            if ($sgd_version == 2) {
                $row = str_replace("{FORMUARIO_BITACORA}", file_get_contents("views/sgd/bitacora/formulario_chilquinta.html"), $row);
                $row = str_replace("{OPTIONS_VALORES}", OptionsCompetenciasDadoPerfil($evaluado->perfil_evaluacion_competencias), $row);
            } else {
                $row = str_replace("{FORMUARIO_BITACORA}", file_get_contents("views/sgd/bitacora/formulario.html"), $row);
                $row = str_replace("{OPTIONS_VALORES}", OptionsGenericoNombreDadoValoresPorEmpresa("tbl_bitacora_valores", "", "valor", "id", "order by valor asc", $_SESSION["id_empresa"]), $row);
            }
        } else {
            $row = str_replace("{FORMUARIO_BITACORA}", "", $row);
        }
        $row                           = str_replace("{RUT_ENCODEADO}", Encodear3($evaluado->evaluado), $row);
        $row                           = str_replace("{RUT_EVALUADO}", ($evaluado->evaluado), $row);
        //Veo cuantas posotivas y cuantas negativas tiene
        $positivas                     = VerificaBitacorasPositivasNegativas($evaluado->evaluado, "si");
        $negativas                     = VerificaBitacorasPositivasNegativas($evaluado->evaluado, "no");
        $row                           = str_replace("{X_POSITIVAS}", count($positivas), $row);
        $row                           = str_replace("{X_NEGATIVAS}", count($negativas), $row);
        $total_positivas_por_evaluador = $total_positivas_por_evaluador + count($positivas);
        $total_negativas_por_evaluador = $total_negativas_por_evaluador + count($negativas);
        $row                           = str_replace("{CANTIDAD}", count($positivas) + count($negativas), $row);
        $row                           = str_replace("{BOTON_JEFE_VALIDA_OBJETIVOS}", "", $row);
        $row                           = str_replace("{TOTAL_SUMA_PONDERACION}", $valores_objetivos[1], $row);
        $row                           = str_replace("{PONDERACION_OBJETIVOS_INDIVIDUALES}", $ponderaciones_bases[2], $row);
        if ($valores_objetivos[1] == $ponderaciones_bases[2]) {
            $row = str_replace("{OK}", "OK", $row);
        } else {
            $row = str_replace("{OK}", "", $row);
        }
        $row = str_replace("{RUT_EVALUADO_ENCODEADO}", Encodear3($evaluado->evaluado), $row);
        if ($valores_objetivos[1] == $ponderaciones_bases[2]) {
            $ok_finalizado++;
        }
        //ACA veo si es que tiene comentarios de rechazo
        $comentarios           = ObtenerObjetivosDeRechazoUltimo($evaluado->evaluado);
        $comentarios_validador = "";
        foreach ($comentarios as $com) {
            $comentarios_validador .= $com->comentario . "<br>";
        }
        $row = str_replace("{COMENTARIOS_VALIDADOR}", $comentarios_validador, $row);
    }
    $total_total = ($total_negativas_por_evaluador + $total_positivas_por_evaluador);
    $html        = str_replace("{TOTAL_POSITIVAS}", ColocaDecimalesNotasFinales(0, ($total_positivas_por_evaluador * 100) / $total_total), $html);
    $html        = str_replace("{TOTAL_NEGATIVAS}", ColocaDecimalesNotasFinales(0, ($total_negativas_por_evaluador * 100) / $total_total), $html);
    $html        = str_replace("{TOTAL_POR_EVALUADOR}", $total_total, $html);
    $html        = str_replace("{TOTAL_EVALUADOR_POSITIVAS}", ($total_positivas_por_evaluador), $html);
    $html        = str_replace("{TOTAL_EVALUADOR_NEGATIVAS}", ($total_negativas_por_evaluador), $html);
    $total_html  = str_replace("{LISTADO_COLABORADORES}", ($row), $total_html);
    $html        = str_replace("{ENTORNO_LISTADO_EVALUACION}", ($total_html), $html);
    return ($html);
}
function ColocaBloqueMP3PorObjeto($id_objeto)
{
    //Veo si hay MP3 por Objeto
    $datos_objeto = DatosObjeto($id_objeto);
    $bloque_mp3   = "";
    if ($datos_objeto[0]->mp3) {
        $bloque_mp3 = file_get_contents("views/cursos/contenidos/entorno_bloque_mp3.html");
        $bloque_mp3 = str_replace("{URL_MP3}", $datos_objeto[0]->mp3, $bloque_mp3);
    }
    return ($bloque_mp3);
}
function ColocaBloqueComentariosPorObjeto($id_objeto, $rut, $pagina, $cantidad_por_pagina)
{
    //Veo si hay documentos por Objeto
    //$comentarios=ComentariosPorObjeto($id_objeto, $pagina, $cantidad_por_pagina);
    $comentarios        = ComentariosPorObjetoPaginado($id_objeto, $pagina, $cantidad_por_pagina);
    $bloque_comentarios = "";
    if ($comentarios) {
        $total = "";
        foreach ($comentarios as $unico) {
            $bloque_comentarios = file_get_contents("views/cursos/objetos/foro/bloque_comentario.html");
            $bloque_comentarios = str_replace("{URL_IMAGEN_PERSONA}", VerificaFotoPersonal($unico->rut), $bloque_comentarios);
            $bloque_comentarios = str_replace("{NOMBRE}", ($unico->nombre_persona), $bloque_comentarios);
            $bloque_comentarios = str_replace("{COMENTARIO}", ($unico->comentario), $bloque_comentarios);
            $bloque_comentarios = str_replace("{RUT_ENCODEADO_AUTOR_COMENTARIO}", Encodear3($unico->rut), $bloque_comentarios);
            $bloque_comentarios = str_replace("{FECHA}", FechaTipoSpa($unico->fecha . " " . $unico->hora), $bloque_comentarios);
            $tiene_megusta      = MegustaPorComentarioRut($unico->id, $rut);
            if ($unico->rut == $rut) {
                $bloque_comentarios = str_replace("{BLOQUE_MEGUSTA}", file_get_contents("views/cursos/objetos/foro/bloque_comentario_micomentario.html"), $bloque_comentarios);
            } else {
                if ($tiene_megusta) {
                    $bloque_comentarios = str_replace("{BLOQUE_MEGUSTA}", file_get_contents("views/cursos/objetos/foro/bloque_comentario_yamegusta.html"), $bloque_comentarios);
                } else {
                    $bloque_comentarios = str_replace("{BLOQUE_MEGUSTA}", file_get_contents("views/cursos/objetos/foro/bloque_comentario_megusta.html"), $bloque_comentarios);
                }
            }
            $bloque_comentarios             = str_replace("{ID_COMENTARIO}", $unico->id, $bloque_comentarios);
            $bloque_comentarios             = str_replace("{ID_COMENTARIO_MEGUSTA}", $unico->id, $bloque_comentarios);
            //Verifico si este comentario ya tiene un me gusta, si ya tiene, le muestro un bloque de me gusta,
            //sino el bloque de Yamegusta
            //Veo cuantos ME GUSTA tiene este comentario
            $cantidad_megusta_porcomentario = MegustaPorComentario($unico->id);
            $bloque_comentarios             = str_replace("{XMEGUSTA}", count($cantidad_megusta_porcomentario), $bloque_comentarios);
            $total .= $bloque_comentarios;
        }
    } else {
    }
    return (($total));
}




function FormatearPorcentajesSinDecimal($valor)
{
    $valor = number_format($valor, 0, ",", ".");
    return ($valor);
}
function FormatearPorcentajes1Decimal($valor)
{
    $valor = number_format($valor, 1, ",", ".");
    return ($valor);
}
function ColocaBloquePreguntaPorObjeto($id_objeto, $rut, $tipo)
{
    //Veo si hay documentos por Objeto
    if ($_SESSION["id_empresa"] == 22) {
        //$pregunta=PreguntaEncuestaParaTNT();
        //$pregunta=PreguntaEncuestaParaPorEmpresa($_SESSION["id_empresa"]);
        //$tipo=$pregunta[0]->numero_template_pregunta;
        //$pregunta=PreguntaDadoIdObjeto(999, 2);
        $pregunta = PreguntaEncuestaParaPorEmpresa($_SESSION["id_empresa"]);
        $tipo     = $pregunta[0]->tipo;
    } else if ($_SESSION["id_empresa"] == 41) {
        //$pregunta=PreguntaEncuestaParaTNT();
        $pregunta = PreguntaEncuestaParaPorEmpresa($_SESSION["id_empresa"]);
        $tipo     = $pregunta[0]->numero_template_pregunta;
    } else {
        $pregunta = PreguntaDadoIdObjeto($id_objeto, $tipo);
        $tipo     = $pregunta[0]->tipo;
    }
    $bloque_archivos = "";
    if ($pregunta) {
        $tiene_respuesta = VerificaRespuestaPorPreguntaObjetoUsuario($id_objeto, $pregunta[0]->id, $rut);
        //si tiene respuesta
        if ($tiene_respuesta) {
            if ($tipo == 1) {
                $bloque_archivos = MuestraResultadosPreguntaPorObjeto($id_objeto, $pregunta[0]->id, $rut);
            } else if ($tipo == 2) {
                $bloque_archivos = MuestraResultadosPreguntaPorObjetoCheck($id_objeto, $pregunta[0]->id, $rut);
            } else if ($tipo == 3) {
                $bloque_archivos = MuestraResultadosPreguntaPorObjetoCheck($id_objeto, $pregunta[0]->id, $rut);
                //}else if($tipo==4){
            } else {
                $bloque_archivos = MuestraResultadosPreguntaPorObjeto4($id_objeto, $pregunta[0]->id, $rut);
            }
        } else {
            $bloque_archivos = file_get_contents("views/cursos/contenidos/entorno_bloque_pregunta" . $tipo . ".html");
            $bloque_archivos = str_replace("{PREGUNTA}", ($pregunta[0]->pregunta), $bloque_archivos);
            $bloque_archivos = str_replace("{ID_PREGUNTA_ENCODEADA}", ($pregunta[0]->id), $bloque_archivos);
            if ($tipo == 2) {
                //Coloco las alternativas
                $alternativas = AlternativasDadoGupoId($pregunta[0]->id_alternativas);
                foreach ($alternativas as $alt) {
                    $alternativas_html .= file_get_contents("views/cursos/contenidos/row_alternativa_pregunta_objeto.html");
                    $alternativas_html = str_replace("{ALTERNATIVA}", $alt->alternativa, $alternativas_html);
                    $alternativas_html = str_replace("{VALUE_CHECK}", $alt->id, $alternativas_html);
                }
                $bloque_archivos = str_replace("{TOTAL_ALTERNATIVAS}", count($alternativas), $bloque_archivos);
            } else if ($tipo == 3) {
                //Coloco las alternativas
                $alternativas = AlternativasDadoGupoId($pregunta[0]->id_alternativas);
                foreach ($alternativas as $alt) {
                    $alternativas_html .= file_get_contents("views/cursos/contenidos/row_alternativa_pregunta_objeto_radio.html");
                    $alternativas_html = str_replace("{ALTERNATIVA}", $alt->alternativa, $alternativas_html);
                    $alternativas_html = str_replace("{VALUE_CHECK}", $alt->id, $alternativas_html);
                    $alternativas_html = str_replace("{NAME}", $pregunta[0]->id, $alternativas_html);
                }
                $bloque_archivos = str_replace("{TOTAL_ALTERNATIVAS}", count($alternativas), $bloque_archivos);
            }
            $bloque_archivos = str_replace("{OPCIONES}", $alternativas_html, $bloque_archivos);
        }
    }
    return ($bloque_archivos);
}
function ColocaBloqueDocumentosPorObjeto($id_objeto)
{
    //Veo si hay documentos por Objeto
    $archivos        = ArchivosDadoIdObjeto($id_objeto);
    $bloque_archivos = "";
    if ($archivos) {
        $bloque_archivos = file_get_contents("views/cursos/contenidos/entorno_bloque_documentos.html");
        foreach ($archivos as $unico) {
            $row .= file_get_contents("views/cursos/contenidos/bloque_documento.html");
            $row = str_replace("{TITULO}", $unico->titulo, $row);
            $row = str_replace("{DESCRIPCION}", ($unico->descripcion), $row);
            $row = str_replace("{DOCUMENTO_DESCARGA}", $unico->archivo, $row);
        }
        $bloque_archivos = str_replace("{ROWS_MATERIAL_APOYO}", $row, $bloque_archivos);
    }
    return ($bloque_archivos);
    /*
    $bloques_texto=BloqueCitaPorObjeto($id_objeto);
    $html_bloque="";
    if($bloques_texto){
    $html_bloque=file_get_contents("views/cursos/contenidos/entorno_bloque_cita.html");
    foreach($bloques_texto as $unico){
    $row.=file_get_contents("views/cursos/contenidos/bloque_cita.html");
    $row = str_replace("{TEXTO}",$unico->texto,$row);
    }
    //$html_bloque = str_replace("{ROWS}",$row, $html_bloque);
    $html_bloque = str_replace("{ROWS_CITA}",$row,$html_bloque);
    }else{
    }
    return(($html_bloque));*/
}
function MobileDetectFunction()
{
}
function ColocaBloqueCitasPorObjeto($id_objeto)
{
    $bloques_texto = BloqueCitaPorObjeto($id_objeto);
    $html_bloque   = "";
    if ($bloques_texto) {
        $html_bloque = file_get_contents("views/cursos/contenidos/entorno_bloque_cita.html");
        foreach ($bloques_texto as $unico) {
            $row .= file_get_contents("views/cursos/contenidos/bloque_cita.html");
            $row = str_replace("{TEXTO}", $unico->texto, $row);
        }
        //$html_bloque = str_replace("{ROWS}",$row, $html_bloque);
        $html_bloque = str_replace("{ROWS_CITA}", $row, $html_bloque);
    } else {
    }
    return (($html_bloque));
}
function ColocaBloqueTextosPorObjeto($id_objeto)
{
    $bloques_texto = BloqueTextoPorObjeto($id_objeto);
    $html_bloque   = "";
    if ($bloques_texto) {
        $html_bloque = file_get_contents("views/cursos/contenidos/entorno_bloque_texto.html");
        foreach ($bloques_texto as $unico) {
            $row .= file_get_contents("views/cursos/contenidos/bloque_texto.html");
            $row = str_replace("{TEXTO}", $unico->texto, $row);
        }
        //$html_bloque = str_replace("{ROWS}",$row, $html_bloque);
        $html_bloque = str_replace("{ROWS}", $row, $html_bloque);
    } else {
    }
    return (($html_bloque));
}
function colocarReconocimientosPorRut($PRINCIPAL, $id_empresa, $rut)
{
    $listado_reconocimientos = TotalReconocimientosPorRut($rut, $id_empresa);
    if ($listado_reconocimientos) {
        $PRINCIPAL = str_replace("{BLOQUE_RECONOCIMIENTOS}", file_get_contents("views/miperfil/bloque_mis_reconocimientos.html"), $PRINCIPAL);
    } else {
        $PRINCIPAL = str_replace("{BLOQUE_RECONOCIMIENTOS}", "", $PRINCIPAL);
    }
    foreach ($listado_reconocimientos as $unico) {
        $row .= file_get_contents("views/salondelafama/row_bloquesalonfama2.html");
        $row   = str_replace("{NOMBRE_CATEGORIA}", $unico->nombre_categoria, $row);
        $row   = str_replace("{LOGO_CATEGORIA}", $unico->imagen, $row);
        $row   = str_replace("{DESCRIPCION_CATEGORIA}", $unico->descripcion_categoria, $row);
        //Por la categoria traigo la cantidad X de ganadores
        $datos = ObtenerSalonPorCategoriaYEmpresa($id_empresa, $unico->id, 1);
        $row   = str_replace("{NOMBRE_PERSONAS}", $datos[0]->nombre_persona . " " . $datos[0]->apaterno . " " . $datos[0]->amaterno, $row);
        $row   = str_replace("{CARGO_PERSONAS}", $datos[0]->cargo, $row);
        $row   = str_replace("{URL_PERSONA}", VerificaFotoPersonal($datos[0]->rut), $row);
        $row   = str_replace("{RUT_ENCODEADO}", Encodear3($datos[0]->rut), $row);
        $row   = str_replace("{TEXTO1}", $datos[0]->texto1, $row);
        $row   = str_replace("{TEXTO2}", $datos[0]->texto2, $row);
        $row   = str_replace("{TEXTO3}", $datos[0]->texto3, $row);
        $row   = str_replace("{TEXTO4}", $datos[0]->texto4, $row);
        $row   = str_replace("{TEXTO5}", $datos[0]->texto5, $row);
    }
    $PRINCIPAL = str_replace("{LISTADO_RECONOCIMIENTOS}", ($row), $PRINCIPAL);
    return ($PRINCIPAL);
}
function Noticias($PRINCIPAL, $tipo, $limit, $variable)
{
    if ($tipo == "1") {
        $template_row = file_get_contents("views/noticias/row_noticias_principales.html");
        if ($variable) {
            $noticias = TraeNoticiasPrincipalesPorGerencia($_SESSION["id_empresa"], $variable, $limit);
        } else {
            $noticias = TraeNoticiasPrincipales($_SESSION["id_empresa"], $variable, $limit);
        }
    } else if ($tipo == "sola") {
        $template_row = file_get_contents("views/noticias/row_noticias_1.html");
        $noticias     = TraeNoticiasSecundarias($_SESSION["id_empresa"], $limit);
    } else if ($tipo == "CATEGORIA_CONCURSO") {
        $template_row = file_get_contents("views/noticias/row_general_TREScolumnas.html");
        $noticias     = TraeNoticiasSecundariasCategoria($_SESSION["id_empresa"], $limit, 72);
    } else if ($tipo == "CATEGORIA_PRENSA") {
        $template_row = file_get_contents("views/noticias/row_general_TREScolumnas.html");
        $noticias     = TraeNoticiasSecundariasCategoria($_SESSION["id_empresa"], $limit, 71);
    } else if ($tipo == "2") {
        $template_row = file_get_contents("views/noticias/row_noticias_2.html");

        if($_SESSION["id_empresa"]==41){

            $noticias     = TraeNoticiasSecundariasSinConcurso($_SESSION["id_empresa"], $limit);
        }else{
            $noticias     = TraeNoticiasSecundarias($_SESSION["id_empresa"], $limit);
        }

    } else if ($tipo == "3") {
        $template_row = file_get_contents("views/noticias/row_noticias_terciarias.html");
        $noticias     = TraeNoticiasSecundarias($_SESSION["id_empresa"], $limit);
    } else if ($tipo == "4") {
        $template_row = file_get_contents("views/noticias/row_noticias_4.html");
        $noticias     = TraeNoticiasSecundarias($_SESSION["id_empresa"], $limit);
    } else if ($tipo == "53") {
        $template_row = file_get_contents("views/noticias/53_row_noticias_4.html");
        $noticias     = TraeNoticiasSecundarias($_SESSION["id_empresa"], $limit);
    } else if ($tipo == "5") {
        $template_row = file_get_contents("views/noticias/row_noticias_5.html");
        $noticias     = TraeNoticiasSecundarias($_SESSION["id_empresa"], $limit);
    } else if ($tipo == "6") {
        $template_row = file_get_contents("views/noticias/row_noticias_6.html");
        $noticias     = TraeNoticiasSecundarias($_SESSION["id_empresa"], $limit);
    } else if ($tipo == "7") {
        $template_row = file_get_contents("views/noticias/row_noticias_principales_7.html");
        if ($variable) {
            $noticias = TraeNoticiasPrincipalesPorGerencia($_SESSION["id_empresa"], $variable, $limit);
        } else {
            $noticias = TraeNoticiasPrincipales($_SESSION["id_empresa"], $variable, $limit);
        }
    } else if ($tipo == "8") {
        $template_row = file_get_contents("views/noticias/row_noticias_8.html");
        $noticias     = TraeNoticiasSecundarias($_SESSION["id_empresa"], $limit);
    } else if ($tipo == "9") {
        $template_row = file_get_contents("views/noticias/row_noticias_9.html");
        $noticias     = TraeNoticiasSecundarias($_SESSION["id_empresa"], $limit);
    } else if ($tipo == "principal_2columnas") {
        $template_row = file_get_contents("views/noticias/row_principal_DOScolumnas.html");
        $noticias     = TraeNoticiasSecundarias($_SESSION["id_empresa"], $limit);
    } else if ($tipo == "principal_DOScolumnas") {
        $template_row = file_get_contents("views/noticias/row_principal_DOScolumnas.html");
        $noticias     = TraeNoticiasPrincipales($_SESSION["id_empresa"], $limit);
    } else if ($tipo == "general_TREScolumnas") {
        $template_row = file_get_contents("views/noticias/row_general_TREScolumnas.html");
        $noticias     = TraeNoticiasSecundarias($_SESSION["id_empresa"], $limit);
    } else if ($tipo == "2columnas") {
        $template_row = file_get_contents("views/noticias/row_general_2columnas.html");
        $noticias     = TraeNoticiasSecundarias($_SESSION["id_empresa"], $limit);
    } else if ($tipo == "1columnabciprod") {
        $template_row = file_get_contents("views/noticias/row_1columnas_prod.html");
        $noticias     = TraeNoticiasSecundarias($_SESSION["id_empresa"], $limit);
    } else if ($tipo == "1columnasinhref") {
        $template_row = file_get_contents("views/noticias/row_1columnas_sinhref.html");
        $noticias     = TraeNoticiasSecundarias($_SESSION["id_empresa"], $limit);
    } else if ($tipo == "1columnasinhref_wide") {
        $template_row = file_get_contents("views/noticias/row_1columnas_sinhref_wide.html");
        $noticias     = TraeNoticiasSecundarias($_SESSION["id_empresa"], $limit);
    } else if ($tipo == "enFila") {
        $template_row = file_get_contents("views/noticias/row_enfila.html");
        $noticias     = TraeNoticiasSecundarias($_SESSION["id_empresa"], $limit);
    } else if ($tipo == "enFilaV2") {
        $template_row = file_get_contents("views/noticias/row_enfila_v2.html");
        $noticias     = TraeNoticiasSecundarias($_SESSION["id_empresa"], $limit);
    }
    //
    //print_r($noticias);
    foreach ($noticias as $not) {
        $row                 = $template_row;
        $TodoslosComentarios = TodosComentarios($not->id);
        //$row = str_replace("{PORTADA}",imagen_existe($not->portada),$row);
        if ($not->imagen_thumb) {
            $row = str_replace("{PORTADA}", "thum/" . $not->imagen_thumb, $row);
            $row = str_replace("{IMAGEN_NOTICIA}", "thum/" . $not->imagen_thumb, $row);
        } else {
            $row = str_replace("{PORTADA}", $not->portada, $row);
            $row = str_replace("{IMAGEN_NOTICIA}", $not->portada, $row);
        }
        $row         = str_replace("{TITULO}", $not->titulo, $row);
        $row         = str_replace("{FECHA}", FechaTipoSpa($not->fecha_creacion), $row);
        //$row = str_replace("{CONTENIDO_CORTO}",substr($not->contenido, 0, 100),$row);
        $row         = str_replace("{CONTENIDO_CORTO}", tokenTruncate($not->bajada, 245), $row);
        $row         = str_replace("{CONTENIDO_CORTO2}", tokenTruncate($not->bajada, 150), $row);
        $row         = str_replace("{ID_NOTICIA}", Encodear($not->id), $row);
        $row         = str_replace("{COMENTARIOS}", count($TodoslosComentarios), $row);
        $row         = str_replace("{CATEGORIA}", $not->nombre_categoria, $row);
        //datos autor
        $datos_autor = UsuarioEnBasePersonas($not->rut_creador);
        $row         = str_replace("{AUTOR}", $datos_autor[0]->nombre . " " . $datos_autor[0]->apaterno . " " . $datos_autor[0]->apaterno, $row);
        $total_html .= $row;
    }
    //echo $total_html;
    $PRINCIPAL = str_replace("{COLUMNAS_NOTICIAS_" . $tipo . "}", ($total_html), $PRINCIPAL);
    return ($PRINCIPAL);
}
function ComunidadObjeto($PRINCIPAL, $tipo, $id_objeto, $limit, $num, $lectura, $volver, $sinboton, $textoboton)
{
    //echo "$tipo, $id_objeto, $limit, $num, $lectura, $volver, $sinboton, $textoboton";
    if ($tipo == "opinion") {
        $template_row  = file_get_contents("views/comunidad/row_opinion_comunidad.html");
        //echo "hola";
        $datos_objetos = traeLineasObjetov($_SESSION["id_empresa"], $tipo, $id_objeto, $limit);
        //echo "chau";
    } else if ($tipo == "foto") {
        $template_row  = file_get_contents("views/comunidad/row_opinion_comunidad.html");
        $datos_objetos = traeLineasObjetov($_SESSION["id_empresa"], $tipo, $id_objeto, $limit);
    } else if ($tipo == "compromiso") {
        $template_row  = file_get_contents("views/comunidad/row_compromiso_comunidad.html");
        $datos_objetos = traeLineasObjetov($_SESSION["id_empresa"], $tipo, $id_objeto, $limit);
    }
    $titulo_objeto = traetituloObjeto($_SESSION["id_empresa"], $id_objeto);
    foreach ($datos_objetos as $dato_objeto) {
        $row         = $template_row;
        $row         = str_replace("{COMENTARIO}", $dato_objeto->comentario, $row);
        $row         = str_replace("{COMPROMISO}", $dato_objeto->compromiso, $row);
        $row         = str_replace("{META}", $dato_objeto->meta, $row);
        $row         = str_replace("{PLAN}", $dato_objeto->plan, $row);
        $datos_autor = UsuarioEnBasePersonas($dato_objeto->rut);
        $row         = str_replace("{AUTOR}", $datos_autor[0]->nombre_completo, $row);
        //datos autor
        $row         = str_replace("{URL_PERSONA}", VerificaFotoPersonal($dato_objeto->rut), $row);
        $total_html .= $row;
    }
    //echo $total_html;
    $PRINCIPAL = str_replace("{LISTA_OBJETO" . $num . "}", ($total_html), $PRINCIPAL);
    $PRINCIPAL = str_replace("{OBJETO" . $num . "}", ($titulo_objeto[0]->titulo_principal), $PRINCIPAL);
    $PRINCIPAL = str_replace("{DESCOBJETO" . $num . "}", ($titulo_objeto[0]->descripcion), $PRINCIPAL);
    if ($sinboton <> 1) {
        $PRINCIPAL = str_replace("{BOTON" . $num . "}", file_get_contents("views/comunidad/row_boton_ingresa.html"), $PRINCIPAL);
    } else {
        $PRINCIPAL = str_replace("{BOTON" . $num . "}", "", $PRINCIPAL);
    }
    if ($lectura == 1) {
        $PRINCIPAL = str_replace("{LINK_OBJETO}", "?sw=contenido&i=" . Encodear3($id_objeto) . "&tt=1&checkin=1", $PRINCIPAL);
        $PRINCIPAL = str_replace("{TEXTOBOTON}", ($textoboton), $PRINCIPAL);
    } else {
        $PRINCIPAL = str_replace("{LINK_OBJETO}", "?sw=contenido&i=" . Encodear3($id_objeto) . "&checkin=1", $PRINCIPAL);
        $PRINCIPAL = str_replace("{TEXTOBOTON}", ($textoboton), $PRINCIPAL);
    }
    /*
    if($lectura==1){
    $PRINCIPAL = str_replace("{LINK_OBJETO".$num."}","?sw=contenido&i=".Encodear3($id_objeto)."&tt=1&checkin=1",$PRINCIPAL);
    } else {
    $PRINCIPAL = str_replace("{LINK_OBJETO".$num."}","?sw=contenido&i=".Encodear3($id_objeto)."&checkin=1",$PRINCIPAL);
    }
    */
    return ($PRINCIPAL);
}
function FaqObjeto($PRINCIPAL, $rut, $id_empresa)
{
    $datos_mallapersona = buscamalla($rut, $id_empresa);
    //print_r($datos_mallapersona);
    $id_malla           = $datos_mallapersona[0]->id_malla;
    $template_row       = file_get_contents("views/faq/" . $id_empresa . "_row_faq.html");
    $datos_objetos      = traeLineasFaqs($id_empresa, $id_malla);
    //print_r($datos_objetos);
    foreach ($datos_objetos as $dato_objeto) {
        $row = $template_row;
        //$TodoslosComentarios=TodosComentarios($not->id);
        //$row = str_replace("{PORTADA}",imagen_existe($not->portada),$row);
        $row = str_replace("{NOMBREFAQ}", ($dato_objeto->faq_nombre), $row);
        $row = str_replace("{CONTENIDOFAQ}", ($dato_objeto->faq_contenido), $row);
        //datos autor
        $row = str_replace("{CATEGORIAFAQ}", utf8_decode($dato_objeto->categoria), $row);
        $row = str_replace("{IDFAQ}", $dato_objeto->id, $row);
        $total_html .= $row;
    }
    //echo $total_html;
    $PRINCIPAL = str_replace("{LISTA_FAQS}", ($total_html), $PRINCIPAL);
    return ($PRINCIPAL);
}
function devuelveNombreMes($numero_mes)
{
    if ($numero_mes == "1") {
        return ("Enero");
    } else if ($numero_mes == "2") {
        return ("Febrero");
    } else if ($numero_mes == "3") {
        return ("Marzo");
    } else if ($numero_mes == "4") {
        return ("Abril");
    } else if ($numero_mes == "5") {
        return ("Mayo");
    } else if ($numero_mes == "6") {
        return ("Junio");
    } else if ($numero_mes == "7") {
        return ("Julio");
    } else if ($numero_mes == "8") {
        return ("Agosto");
    } else if ($numero_mes == "9") {
        return ("Septiembre");
    } else if ($numero_mes == "10") {
        return ("Octubre");
    } else if ($numero_mes == "11") {
        return ("Noviembre");
    } else if ($numero_mes == "12") {
        return ("Diciembre");
    }
}
function colocaIndicadores($PRINCIPAL, $variable, $id_empresa)
{
    //Traigo los registros de la tabla
    $indicadores = TraeIndicadores($id_empresa, $variable);
    foreach ($indicadores as $unico) {
        $grafico .= file_get_contents("views/graficos/sgd/barraslinea.html");
        $grafico         = str_replace("{NOMBRE_GRAFICO}", "Grafico" . $unico->id, $grafico);
        $grafico         = str_replace("{TITULO}", $unico->nombre, $grafico);
        $grafico         = str_replace("{x}", $unico->mes, $grafico);
        $grafico         = str_replace("{y1}", $unico->y1, $grafico);
        $grafico         = str_replace("{y2}", $unico->y2, $grafico);
        $grafico         = str_replace("{y3}", $unico->y3, $grafico);
        //Ahora por cada indicador, traigo la data
        $datos_indicador = DataPorIndicador($unico->id);
        $html_datos      = "";
        $i               = 1;
        foreach ($datos_indicador as $datos_unico) {
            //print_r($datos_unico);echo "<br>";
            $html_datos .= "['" . $datos_unico->x . "', " . $datos_unico->y1 . ", " . $datos_unico->y2 . ", " . $datos_unico->y3 . "]";
            if ($i < count($datos_indicador))
                $html_datos .= ",";
            $i++;
        }
        //echo "<br><br>";
        $grafico = str_replace("{ARREGLO_DATOS}", $html_datos, $grafico);
    }
    $PRINCIPAL = str_replace("{LISTADO_GRAFICOS}", $grafico, $PRINCIPAL);
    return ($PRINCIPAL);
}
function PaginacionSGDSoloEvaluadorPorPreguntas($evaluador, $pagina, $id_proceso)
{
    $perfiles_dado_evaluador = TotalPerfilesDadoEvaluador($evaluador);
    $total_paginas           = $perfiles_dado_evaluador[0]->cantidad_componentes + 1;
    $tiene_sesion            = SesionSGDSoloEvaluador($evaluador, $id_proceso);
    //total de paginas
    if ($tiene_sesion) {
        $pagina = $tiene_sesion[0]->pagina;
    } else {
        $pagina = 1;
    }
    $paginacion = '<div class="pagination_sgd"><ul>';
    for ($i = 1; $i <= $total_paginas; $i++) {
        if ($pagina == $i) {
            //$paginacion.="<span class='pagination_sgd_activo'>".$i."</span>";
            $paginacion .= '<li ><a class="pagination_sgd_activo">' . $i . '</a></li>';
        } else {
            //$paginacion.=$i;
            $paginacion .= '<li><a href="#">' . $i . '</a></li>';
        }
    }
    $paginacion .= '</ul></div>';
    return ($paginacion);
}
function PaginacionSGDPorPreguntasV2($evaluador, $pagina, $id_proceso, $total_paginas, $tiene_objetivos, $evaluado)
{
    //$perfiles_dado_evaluador=TotalPerfilesDadoEvaluador($evaluador);
    //$total_paginas=$perfiles_dado_evaluador[0]->cantidad_componentes+1;
    if ($tiene_objetivos == "si") {
        $total_paginas = $total_paginas + 1;
    } else {
        $total_paginas = $total_paginas;
    }
    if ($evaluado) {
        $tiene_sesion = SesionSGDSoloEvaluadorEvaluado($evaluador, $id_proceso, $evaluado);
    } else {
        $tiene_sesion = SesionSGDSoloEvaluador($evaluador, $id_proceso);
    }
    //total de paginas
    if ($tiene_sesion) {
        $pagina = $tiene_sesion[0]->pagina;
    } else {
        $pagina = 1;
    }
    if ($total_paginas > 10) {
        $paginacion = '<div class="col-md-4 pagination_sgd"><ul>';
        $mayor      = "no";
        for ($i = 1; $i <= $total_paginas; $i++) {
            if ($pagina == $i) {
                $paginacion .= '<li ><a class="pagination_sgd_activo_actual">' . $i . '</a></li>';
            } else if ($i == $pagina - 1 or $i == $pagina - 2) {
                $paginacion .= '<li><a class="pagination_sgd_activo" href="#">' . $i . '</a></li>';
            } else if ($i == $pagina + 1 or $i == $pagina + 2) {
                $paginacion .= '<li><a href="#">' . $i . '</a></li>';
            } else if ($i < $total_paginas && $mayor == "no") {
                $ultima_pagina = '<li><a href="#">de un total de ' . $total_paginas . '</a></li>';
                $mayor         = "si";
            }
            /*else if($pagina>$i){
            //$paginacion.='<li ><a class="pagination_sgd_activo" href="?sw=ev&p='.Encodear3($i).'">'.$i.'</a></li>';
            }else{
            //$paginacion.='<li><a href="#">'.$i.'</a></li>';
            }*/
        }
        $paginacion .= $ultima_pagina;
        $paginacion .= '</ul></div>';
        return ($paginacion);
    } else {
        $paginacion = '<div class="col-md-12 pagination_sgd"><ul>';
        for ($i = 1; $i <= $total_paginas; $i++) {
            if ($pagina == $i) {
                $paginacion .= '<li ><a class="pagination_sgd_activo_actual">' . $i . '</a></li>';
            } else if ($pagina > $i) {
                //$paginacion.='<li ><a class="pagination_sgd_activo" href="?sw=ev&p='.Encodear3($i).'">'.$i.'</a></li>';
                //$paginacion.='<li ><a class="pagination_sgd_activo" href="?sw=evind&ie='.Encodear3($evaluado).'&p='.Encodear3($i).'&pagi=1"> '.$i.'</a></li>';
                $paginacion .= '<li ><a class="pagination_sgd_activo" href="#"> ' . $i . '</a></li>';
            } else {
                $paginacion .= '<li><a href="#">' . $i . '</a></li>';
            }
        }
        $paginacion .= '</ul></div>';
        return ($paginacion);
    }
}
function EntornoEvaluacionListadoAlternativasDinamicas($html, $evaluador, $pagina, $id_empresa, $id_proceso, $evaluado_individual)
{
    if ($evaluado_individual) {
        $evaluados = EvaluadosDadoEvaluadorPorProcesoPorEvaluado($evaluador, $id_proceso, $evaluado_individual);
    } else {
        //$evaluados=EvaluadosDadoEvaluadorPorProceso($evaluador, $id_proceso);
        $evaluados = EvaluadosDadoEvaluadorPorProcesoSinAe($evaluador, $id_proceso);
    }
    $datos_proceso       = TraeProcesosDeEvaluacionPorEmpresaYDiProceso($id_empresa, $id_proceso);
    $id_proceso_anterior = $datos_proceso[0]->id_proceso_anterior;
    if ($evaluados) {
        if ($evaluado_individual) {
            $perfiles = TotalPerfilesDadoEvaluador1PorEvaluado($evaluador, $evaluado_individual, $id_proceso);
        } else {
            //$perfiles=TotalPerfilesDadoEvaluador1($evaluador);
            $perfiles = TotalPerfilesDadoEvaluador1PorProceso($evaluador, $id_proceso);
        }
        //Aca tengo todos los perfiles, con esto, obtengo todas las competencias.
        for ($i = 0; $i < count($perfiles); $i++) {
            $sql .= " perfil_evaluacion='" . $perfiles[$i]->id_perfil_ev . "'";
            if ($perfiles[$i + 1]->id_perfil_ev)
                $sql .= " or";
        }
        if ($evaluado_individual) {
            $componentes               = TotalIdCompetenciasIndividual($sql);
            //$entorno_eval_competencias=file_get_contents("views/sgd/evaluacion/entorno_individual_evaluacion_competencia.html");
            $entorno_eval_competencias = file_get_contents("views/sgd/evaluacion/" . $id_empresa . "_entorno_individual_evaluacion_competencia.html");
            if ($evaluado_individual == $evaluador) {
                $entorno_eval_competencias = str_replace("{TEXTO_COMENTARIO_POR_COMPETENCIA_INDIVIDUAL}", "Recuerda exponer situaciones concretas que validen tu autoevaluaci?n. Ser? importante para tu Supervisor conocer tu percepci?n al evaluarte.", $entorno_eval_competencias);
            } else {
                $entorno_eval_competencias = str_replace("{TEXTO_COMENTARIO_POR_COMPETENCIA_INDIVIDUAL}", "Recuerda que es importante retroalimentar a tu equipo! Tus observaciones pueden hacer la diferencia sobre c?mo se percibe el proceso de evaluaci?n. Recuerda ser lo m?s objetivo posible y relatar experiencias concretas!", $entorno_eval_competencias);
            }
            $entorno_eval_competencias = ColocaDatosUsuario($entorno_eval_competencias, $evaluado_individual);
            $verifico_eval_finalizada  = FinalizadoEvaluadoEvaluadorProProceso($evaluado_individual, $evaluador, $id_proceso);
            if ($verifico_eval_finalizada) {
                $html = str_replace("{VER_INFORME_INDIVIDUAL}", file_get_contents("views/sgd/evaluacion/boton_ver_informe.html"), $html);
                $html = str_replace("{ID_PROCESO_ENCODEADO}", Encodear3($id_proceso), $html);
                $html = str_replace("{RUT_EVALUADO_ENCODEADO}", Encodear3($evaluado_individual), $html);
            } else {
                $html = str_replace("{VER_INFORME_INDIVIDUAL}", "", $html);
            }
            if ($pagina > 1) {
                $entorno_eval_competencias = str_replace("{BOTON_ATRAS}", file_get_contents("views/sgd/evaluacion/boton_atras_eval_competencias.html"), $entorno_eval_competencias);
                if ($evaluado_individual == $evaluador) {
                    $entorno_eval_competencias = str_replace("{VISTA_AE}", "&ae=1", $entorno_eval_competencias);
                } else {
                    $entorno_eval_competencias = str_replace("{VISTA_AE}", "", $entorno_eval_competencias);
                }
                $total_html = str_replace("{BOTON_ATRAS}", file_get_contents("views/sgd/evaluacion/boton_atras_eval_competencias.html"), $total_html);
            } else {
                $entorno_eval_competencias = str_replace("{BOTON_ATRAS}", "", $entorno_eval_competencias);
                $total_html                = str_replace("{BOTON_ATRAS}", "", $total_html);
                $entorno_eval_competencias = str_replace("{VISTA_AE}", "", $entorno_eval_competencias);
            }
        } else {
            $componentes               = TotalIdCompetencias($sql);
            $total_html                = file_get_contents("views/sgd/evaluacion/" . $id_empresa . "_entorno_equipo_evaluacion_competencia.html");
            $entorno_eval_competencias = file_get_contents("views/sgd/evaluacion/" . $id_empresa . "_entorno_equipo_evaluacion_competencia.html");
            $html                      = str_replace("{VER_INFORME_INDIVIDUAL}", "", $html);
            if ($pagina > 1) {
                $entorno_eval_competencias = str_replace("{BOTON_ATRAS}", file_get_contents("views/sgd/evaluacion/boton_atras_eval_competencias.html"), $entorno_eval_competencias);
                $total_html                = str_replace("{BOTON_ATRAS}", file_get_contents("views/sgd/evaluacion/boton_atras_eval_competencias.html"), $total_html);
            } else {
                $entorno_eval_competencias = str_replace("{BOTON_ATRAS}", "", $entorno_eval_competencias);
                $total_html                = str_replace("{BOTON_ATRAS}", "", $total_html);
            }
        }
        if ($datos_proceso[0]->tiene_especificos == 1) {
            /****************************/
            /******************************/
            /********PARA CUANDO TIENE OBJETIVOS*/
            if ($pagina > 1) {
                /****************************/
                /******************************/
                /********PARA CUANDO NO TIENE OBJETIVOS*/
                /****************************************************************/
                //BLOQUE QUE VALIDA LA CANTIDAD DE RESPUESTAS POR PAGINA JAVASCRIPT
                /****************************************************************/
                //$total_html=file_get_contents("views/sgd/evaluacion/entorno_equipo_evaluacion_competencia.html");
                $total_html = $entorno_eval_competencias;
                if ($datos_proceso[0]->validacion_js_preguntas == 1) {
                    $total_html = str_replace("{BLOQUE_FUNCION_JAVASCRIPT_PARA_VALIDAR_CANTIDAD_ALTERNATIVAS}", file_get_contents("views/sgd/evaluacion/funcionValidaCantidadRespuestas.html"), $total_html);
                } else {
                    $total_html = str_replace("{BLOQUE_FUNCION_JAVASCRIPT_PARA_VALIDAR_CANTIDAD_ALTERNATIVAS}", file_get_contents("views/sgd/evaluacion/funcionNext.html"), $total_html);
                }
                //$total_html = str_replace("{TOTAL_EVALUADOS}",(count($evaluados)*60)/100,$total_html);
                //$total_html = str_replace("{TOTAL_TOTAL_EVALUADOS}",count($evaluados),$total_html);
                //$total_html = str_replace("{TOTAL_EVALUADOS_1_2}",(count($evaluados)*40)/100,$total_html);
                //$total_html = str_replace("{TOTAL_EVALUADOS_4_5}",(count($evaluados)*40)/100,$total_html);
                //Se muestran las competencias para evaluar.
                //echo "pagina $pagina <br>";
                //print_r($componentes);exit;
                //Aca verifico si la pagina actual es mayor a la cantidad de paginas//si es asi, lo tiro para afuera, e inserto registro de finalizado.
                if ($pagina > count($componentes) + 1) {
                    InsertaEvaluadorFinalizado($evaluador, $id_proceso);
                    //Aca ,por cada uno de los evaluados del evaluador, se inserta registro de finalizado evaluado evaluador
                    foreach ($evaluados as $evaluad) {
                        InsertaEvaluadoEvaluadorFinalizado($evaluad->evaluado, $evaluador, $id_proceso);
                    }
                    echo "<script>
                    location.href='?sw=sgd2&ip=" . Encodear3($id_proceso) . "';
                    </script>";
                    exit;
                }
                /////////////////*********************************/////////////////////////////
                //SECCION PARA ENCABEZADOS COMPETENCIAS
                //if($componentes[$pagina-1]->muestra_competencia==1){
                if ($componentes[$pagina - 2]->muestra_competencia == 1) {
                    $total_html = str_replace("{ENCABEZADO_COMPETENCIA}", file_get_contents("views/sgd/evaluacion/encabezado_competencia.html"), $total_html);
                    $total_html = str_replace("{COMPETENCIA}", ($componentes[$pagina - 2]->nombre), $total_html);
                    $total_html = str_replace("{DESCRIPCION_COMPETENCIA}", ($componentes[$pagina - 2]->descripcion_competencia), $total_html);
                } else {
                    $total_html = str_replace("{ENCABEZADO_COMPETENCIA}", "", $total_html);
                }
                /////////////////*********************************/////////////////////////////
                //SECCION PARA ENCABEZADO DIMENSIONES
                if ($componentes[$pagina - 2]->muestra_dimension == 1) {
                    $total_html = str_replace("{ENCABEZADO_DIMENSION}", file_get_contents("views/sgd/evaluacion/encabezado_dimension.html"), $total_html);
                    $total_html = str_replace("{DIMENSION}", ($componentes[$pagina - 2]->nombre_dimension), $total_html);
                } else {
                    $total_html = str_replace("{ENCABEZADO_COMPETENCIA}", "", $total_html);
                    $total_html = str_replace("{ENCABEZADO_DIMENSION}", "", $total_html);
                }
                if ($componentes[$pagina - 2]->comentario_obligatorio == 1) {
                    $comentario_obligatorio = "required";
                } else {
                    $comentario_obligatorio = "";
                }
                $total_html                 = str_replace("{ID_ENCODEADO_COMPETENCIA}", $componentes[$pagina - 2]->id_componente, $total_html);
                $total_html                 = str_replace("{ID_COMPETENCIA}", $componentes[$pagina - 2]->id_componente, $total_html);
                $comentario_por_competencia = TieneComentarioPorCompetencia($evaluado_individual, $evaluador, $componentes[$pagina - 2]->id_componente, $id_empresa, $id_proceso);
                $total_html                 = str_replace("{COMENTARIO_POR_COMPETENCIA}", ($comentario_por_competencia[0]->comentario), $total_html);
                if ($evaluado_individual) {
                    //Traigo las preguntas por la competencia
                    $preguntas = PreguntasPorCompetencia($componentes[$pagina - 2]->id_componente);
                    foreach ($preguntas as $preg) {
                        // echo "evaluado $evaluado_individual, evaluador $evaluador, idproceso $id_proceso, idpregunta ".$preg->id."<br>";
                        //Aca veo si para esta pregunta, este evaluado para este evaluador tiene respuesta
                        $tiene_respuesta = TieneRespuestaCompetenciaProProceso($evaluado_individual, $evaluador, $preg->id, $id_proceso);
                        $listado_preguntas .= file_get_contents("views/sgd/evaluacion/" . $id_empresa . "_row_pregunta_por_competencia.html");
                        $listado_preguntas = str_replace("{NOMBRE_PREGUNTA}", $preg->pregunta, $listado_preguntas);
                        $alternativas      = AlternativasDadoIdGrupo($preg->id_alternativa);
                        $td_options        = "";
                        foreach ($alternativas as $alt) {
                            $td .= file_get_contents("views/sgd/evaluacion/alternativa_encabezado.html");
                            $td                = str_replace("{DESCRIPCION_ALTERNATIVA}", ($alt->alternativa), $td);
                            //Por cada alternativa, verifico si tiene m?s de una opcion
                            $mas_de_una_opcion = MasDeUnaOpcionPorAlternativa($alt->puntaje, $id_empresa, $id_proceso);
                            if ($mas_de_una_opcion) {
                                $td_options .= file_get_contents("views/sgd/evaluacion/alternativa_options_dinamico.html");
                                $options = "";
                                foreach ($mas_de_una_opcion as $unico) {
                                    $options .= file_get_contents("views/sgd/evaluacion/options_dinamico.html");
                                    $options    = str_replace("{VALUE}", $unico->valor_puntaje, $options);
                                    $td_options = str_replace("{ETIQUETA}", $unico->titulo_opciones, $td_options);
                                    $options    = str_replace("{SIGNO}", $unico->signo, $options);
                                    $options    = str_replace("{CHECK}", "{SELECT" . $unico->valor_puntaje . "} ", $options);
                                }
                                $td_options = str_replace("{SELECT" . $tiene_respuesta[0]->puntaje . "}", "checked", $td_options);
                                $options    = str_replace("{SELECT" . $tiene_respuesta[0]->puntaje . "}", "checked", $options);
                                $td_options = str_replace("{OPTIONS_}", $options, $td_options);
                            } else {
                                $td_options .= file_get_contents("views/sgd/evaluacion/alternativa_options.html");
                                if ($tiene_respuesta[0]->puntaje == $alt->puntaje) {
                                    $td_options = str_replace("{CHECK}", "checked='checked'", $td_options);
                                } else {
                                    $td_options = str_replace("{CHECK}", "", $td_options);
                                }
                                $td_options = str_replace("{VALUE}", $alt->puntaje, $td_options);
                                $td_options = str_replace("{SIGNO}", $unico->signo, $td_options);
                                //$td_options = str_replace("{CHECK}","{SELECT".$alt->puntaje."} ",$td_options);
                            }
                        }
                        $listado_preguntas = str_replace("{NIVELES_TD}", $td_options, $listado_preguntas);
                        $listado_preguntas = str_replace("{NOMBRE_RADIO}", $evaluado_individual . "-" . $preg->id, $listado_preguntas);
                        $listado_preguntas = str_replace("{NOMBRE_RADIO_SOLO_PREGUNTA}", $preg->id, $listado_preguntas);
                        $total_html        = str_replace("{NIVELES_TD}", ($td), $total_html);
                    }
                    $listado_preguntas          = str_replace("{NOMBRE_PREGUNTA}", $preg->pregunta, $listado_preguntas);
                    $total_html                 = str_replace("{LISTADO_PREGUNTAS_A_EVALUAR_POR_COMPETENCIAS}", ($listado_preguntas), $total_html);
                    $total_html                 = str_replace("{EVALUADO_ENCODEADO}", Encodear3($evaluado_individual), $total_html);
                    $total_html                 = str_replace("{TOTAL_PREGUNTAS_A_RESPONDER}", count($preguntas), $total_html);
                    $comentario_por_competencia = TieneComentarioPorCompetencia($evaluado_individual, $evaluador, $componentes[$pagina - 1]->id_componente, $id_empresa, $id_proceso);
                    $total_html                 = str_replace("{COMENTARIO_POR_COMPETENCIA}", ($comentario_por_competencia[0]->comentario), $total_html);
                } else {
                    //REPLACE PARA LA PREGUNTA
                    $total_html = str_replace("{NOMBRE_PREGUNTA}", ($componentes[$pagina - 2]->pregunta), $total_html);
                    if ($componentes[$pagina - 2]->descripcion) {
                        $total_html = str_replace("{TOOLTIP_DESCRIPCION}", file_get_contents("views/sgd/evaluacion/tooltip_descripcion.html"), $total_html);
                    } else {
                        $total_html = str_replace("{TOOLTIP_DESCRIPCION}", "", $total_html);
                    }
                    $total_html   = str_replace("{DESCRIPCION_PREGUNTA}", ($componentes[$pagina - 2]->descripcion), $total_html);
                    $total_html   = str_replace("{ID_PREGUNTA_ENCODEADA}", $componentes[$pagina - 2]->id_pregunta, $total_html);
                    $alternativas = AlternativasDadoIdGrupo($componentes[$pagina - 2]->id_alternativa);
                    //Esta codicion es para ver si es que tiene o no comentariop
                    //Si tiene, se coloca el encabezado
                    if ($componentes[$pagina - 2]->tiene_comentarios == 1) {
                        $template_comentario_por_pregunta = file_get_contents("views/sgd/evaluacion/comentario_por_pregunta.html");
                        //Este es para colocar el width dinamico
                        $rowspan_tiene_comentario         = "rowspan='2'";
                    } else {
                        //$total_html = str_replace("{SECCION_ENCABEADO_COMENTARIO}","",$total_html);
                        $template_comentario_por_pregunta = "";
                        $rowspan_tiene_comentario         = "";
                    }
                    $width_dinamico_options = FormatearPorcentajesSinDecimal(100 / (count($alternativas)));
                    foreach ($alternativas as $alt) {
                        $td .= file_get_contents("views/sgd/evaluacion/alternativa_encabezado.html");
                        $td                = str_replace("{DESCRIPCION_ALTERNATIVA}", $alt->alternativa, $td);
                        //Por cada alternativa, verifico si tiene m?s de una opcion
                        $mas_de_una_opcion = MasDeUnaOpcionPorAlternativa($alt->puntaje, $id_empresa, $id_proceso);
                        if ($mas_de_una_opcion) {
                            //exit("b");
                            $td_options .= file_get_contents("views/sgd/evaluacion/alternativa_options_dinamico.html");
                            $options = "";
                            foreach ($mas_de_una_opcion as $unico) {
                                //exit("c");
                                $options .= file_get_contents("views/sgd/evaluacion/options_dinamico.html");
                                $options    = str_replace("{VALUE}", $unico->valor_puntaje, $options);
                                $td_options = str_replace("{ETIQUETA}", $unico->titulo_opciones, $td_options);
                                $options    = str_replace("{SIGNO}", $unico->signo, $options);
                                $options    = str_replace("{CHECK}", "{SELECT" . $unico->valor_puntaje . "} ", $options);
                            }
                            $td_options = str_replace("{OPTIONS_}", $options, $td_options);
                        } else {
                            $td_options .= file_get_contents("views/sgd/evaluacion/alternativa_options.html");
                            $td_options = str_replace("{VALUE}", $alt->puntaje, $td_options);
                            $td_options = str_replace("{DESCRIPCION_ANTERNATIVA_2}", $alt->alternativa, $td_options);
                            $td_options = str_replace("{SIGNO}", $unico->signo, $td_options);
                            $td_options = str_replace("{CHECK}", "{SELECT" . $alt->puntaje . "} ", $td_options);
                        }
                    }
                    $total_html = str_replace("{NIVELES_TD}", ($td), $total_html);
                    $html       = FuncionParaObtenerCalculoMientrasAvanzaPagina($html, $evaluador, $id_proceso, $id_empresa);
                    $row        = BloqueListadoEvaluadosEvalCompetencias($evaluados, $evaluador, $componentes[$pagina - 2]->id_componente, $componentes[$pagina - 2]->id_pregunta, $id_proceso_anterior, $id_proceso, $comentario_obligatorio, $td_options, $template_comentario_por_pregunta);
                    $total_html = str_replace("{LISTADO_COLABORADORES}", ($row[0]), $total_html);
                    $total_html = str_replace("{TOTAL_EVALUADOS}", ($row[1] * 60) / 100, $total_html);
                    $total_html = str_replace("{TOTAL_EVALUADOS_1_2}", ($row[1] * 40) / 100, $total_html);
                    $total_html = str_replace("{TOTAL_EVALUADOS_4_5}", ($row[1] * 40) / 100, $total_html);
                    $total_html = str_replace("{TOTAL_TOTAL_EVALUADOS}", $row[1], $total_html);
                    $total_html = str_replace("{WIDTH_DINAMICO_OPCIONES}", ($width_dinamico_options), $total_html);
                }
                $html = str_replace("{PAGINACION_EVALUACION}", PaginacionSGDPorPreguntasV2($evaluador, $pagina, $id_proceso, count($componentes), "no", $evaluado_individual), $html);
                $html = str_replace("{BARRA_PROGESS}", file_get_contents("views/sgd/evaluacion/barra_progress.html"), $html);
                if ($evaluado_individual) {
                    $porcentaje_avance = AvanceDeEvaluados($evaluador, $id_proceso, "", "", $datos_proceso[0]->id_proceso_anual, $evaluado_individual, "");
                } else {
                    $porcentaje_avance = AvanceDeEvaluados($evaluador, $id_proceso, "", "", $datos_proceso[0]->id_proceso_anual, "", "");
                }
                $html = str_replace("{VALOR_AVANCE}", FormatearPorcentajesSinDecimal($porcentaje_avance[0]), $html);
            } else {
                //Se muestran los objetivos individuales.
                $total_html = file_get_contents("views/sgd/evaluacion/" . $id_empresa . "_entorno_equipo_evaluacion.html");
                if ($_GET["ae"] == 1) {
                    $total_html = str_replace("{SOLO_AE}", "&ae=1", $total_html);
                } else {
                    $total_html = str_replace("{SOLO_AE}", "", $total_html);
                }
                //Primero veo si es que hay registro en la tabla de sesion
                $row = "";
                foreach ($evaluados as $evaluado) {
                    if ($_SESSION["id_empresa"] == 11 or $_SESSION["id_empresa"] == 66 or $_SESSION["id_empresa"] == 74) {
                        $row .= file_get_contents("views/sgd/evaluacion/" . $id_empresa . "_row_colaboradores_evaluacion.html");
                        $row = ColocaDatosUsuario($row, $evaluado->evaluado);
                        $row = str_replace("{LISTADO_OBJETIVOS_A_EVALUAR}", ListadoObjetivosEvaluacion($evaluado->evaluado, $evaluador, $id_proceso, $id_empresa), $row);
                    } else {
                        $row .= file_get_contents("views/sgd/evaluacion/row_colaboradores_evaluacion_dinamico.html");
                        $row = ColocaDatosUsuario($row, $evaluado->evaluado);
                        //$bloque_objetivos_especificos=BloqueListadoObjetivoEspecificos($evaluado->evaluado, $evaluador, $id_proceso, $id_empresa);
                        //$row = str_replace("{LISTADO_OBJETIVOS_A_EVALUAR}",ListadoObjetivosEvaluacion($evaluado->evaluado, $evaluador, $id_proceso),$row);
                        $row = str_replace("{LISTADO_OBJETIVOS_A_EVALUAR}", (BloqueListadoObjetivoEspecificos($evaluado->evaluado, $evaluador, $id_proceso, $id_empresa, "no")), $row);
                    }
                }
                $total_html = str_replace("{LISTADO_COLABORADORES}", ($row), $total_html);
                $total_html = str_replace("{GRAFICO}", "", $total_html);
            }
            $html = str_replace("{PAGINACION_EVALUACION}", PaginacionSGDPorPreguntasV2($evaluador, $pagina, $id_proceso, count($componentes), "si", $evaluado_individual), $html);
        } else {
            /****************************/
            /******************************/
            /********PARA CUANDO NO TIENE OBJETIVOS*/
            /****************************************************************/
            //BLOQUE QUE VALIDA LA CANTIDAD DE RESPUESTAS POR PAGINA JAVASCRIPT
            /****************************************************************/
            //$total_html=file_get_contents("views/sgd/evaluacion/entorno_equipo_evaluacion_competencia.html");
            $total_html = $entorno_eval_competencias;
            if ($datos_proceso[0]->validacion_js_preguntas == 1) {
                $total_html = str_replace("{BLOQUE_FUNCION_JAVASCRIPT_PARA_VALIDAR_CANTIDAD_ALTERNATIVAS}", file_get_contents("views/sgd/evaluacion/funcionValidaCantidadRespuestas.html"), $total_html);
            } else {
                $total_html = str_replace("{BLOQUE_FUNCION_JAVASCRIPT_PARA_VALIDAR_CANTIDAD_ALTERNATIVAS}", file_get_contents("views/sgd/evaluacion/" . $id_empresa . "_funcionNext.html"), $total_html);
            }
            //$total_html = str_replace("{TOTAL_EVALUADOS}",(count($evaluados)*60)/100,$total_html);
            //$total_html = str_replace("{TOTAL_TOTAL_EVALUADOS}",count($evaluados),$total_html);
            //$total_html = str_replace("{TOTAL_EVALUADOS_1_2}",(count($evaluados)*40)/100,$total_html);
            //$total_html = str_replace("{TOTAL_EVALUADOS_4_5}",(count($evaluados)*40)/100,$total_html);
            //Se muestran las competencias para evaluar.
            //Aca verifico si la pagina actual es mayor a la cantidad de paginas//si es asi, lo tiro para afuera, e inserto registro de finalizado.
            if ($pagina > count($componentes)) {
                InsertaEvaluadorFinalizado($evaluador, $id_proceso);
                //Aca ,por cada uno de los evaluados del evaluador, se inserta registro de finalizado evaluado evaluador
                foreach ($evaluados as $evaluad) {
                    InsertaEvaluadoEvaluadorFinalizado($evaluad->evaluado, $evaluador, $id_proceso);
                }
                echo "<script>
                    location.href='?sw=sgd2&ip=" . Encodear3($id_proceso) . "';
                    </script>";
                exit;
            }
            /////////////////*********************************/////////////////////////////
            //SECCION PARA ENCABEZADOS COMPETENCIAS
            if ($componentes[$pagina - 1]->muestra_competencia == 1) {
                $total_html = str_replace("{ENCABEZADO_COMPETENCIA}", file_get_contents("views/sgd/evaluacion/" . $id_empresa . "_encabezado_competencia.html"), $total_html);
                $total_html = str_replace("{COMPETENCIA}", ($componentes[$pagina - 1]->nombre), $total_html);
                if (($componentes[$pagina - 1]->imagen_competencia)) {
                    $total_html = str_replace("{IMAGEN_COMPETENCIA}", "<img src='img/" . ($componentes[$pagina - 1]->imagen_competencia) . "' width=90>", $total_html);
                } else {
                    $total_html = str_replace("{IMAGEN_COMPETENCIA}", "", $total_html);
                }
                $total_html = str_replace("{DESCRIPCION_COMPETENCIA}", ($componentes[$pagina - 1]->descripcion_competencia), $total_html);
            } else {
                $total_html = str_replace("{ENCABEZADO_COMPETENCIA}", "", $total_html);
            }
            /////////////////*********************************/////////////////////////////
            //SECCION PARA ENCABEZADO DIMENSIONES
            if ($componentes[$pagina - 1]->muestra_dimension == 1) {
                $total_html = str_replace("{ENCABEZADO_DIMENSION}", file_get_contents("views/sgd/evaluacion/encabezado_dimension.html"), $total_html);
                $total_html = str_replace("{DIMENSION}", ($componentes[$pagina - 1]->nombre_dimension), $total_html);
            } else {
                $total_html = str_replace("{ENCABEZADO_COMPETENCIA}", "", $total_html);
                $total_html = str_replace("{ENCABEZADO_DIMENSION}", "", $total_html);
            }
            if ($componentes[$pagina - 1]->comentario_obligatorio == 1) {
                $comentario_obligatorio = "required";
            } else {
                $comentario_obligatorio = "";
            }
            $total_html                 = str_replace("{ID_ENCODEADO_COMPETENCIA}", $componentes[$pagina - 1]->id_componente, $total_html);
            $total_html                 = str_replace("{ID_COMPETENCIA}", $componentes[$pagina - 1]->id_componente, $total_html);
            $comentario_por_competencia = TieneComentarioPorCompetencia($evaluado_individual, $evaluador, $componentes[$pagina - 1]->id_componente, $id_empresa, $id_proceso);
            $total_html                 = str_replace("{COMENTARIO_POR_COMPETENCIA}", ($comentario_por_competencia[0]->comentario), $total_html);
            if ($evaluado_individual) {
                //Traigo las preguntas por la competencia
                $preguntas = PreguntasPorCompetencia($componentes[$pagina - 1]->id_componente);
                foreach ($preguntas as $preg) {
                    // echo "evaluado $evaluado_individual, evaluador $evaluador, idproceso $id_proceso, idpregunta ".$preg->id."<br>";
                    //Aca veo si para esta pregunta, este evaluado para este evaluador tiene respuesta
                    $tiene_respuesta = TieneRespuestaCompetenciaProProceso($evaluado_individual, $evaluador, $preg->id, $id_proceso);
                    $listado_preguntas .= file_get_contents("views/sgd/evaluacion/" . $id_empresa . "_row_pregunta_por_competencia.html");
                    $listado_preguntas = str_replace("{NOMBRE_PREGUNTA}", $preg->pregunta, $listado_preguntas);
                    $alternativas      = AlternativasDadoIdGrupo($preg->id_alternativa);
                    $td_options        = "";
                    foreach ($alternativas as $alt) {
                        $td .= file_get_contents("views/sgd/evaluacion/alternativa_encabezado.html");
                        $td                = str_replace("{DESCRIPCION_ALTERNATIVA}", ($alt->alternativa), $td);
                        //Por cada alternativa, verifico si tiene m?s de una opcion
                        $mas_de_una_opcion = MasDeUnaOpcionPorAlternativa($alt->puntaje, $id_empresa, $id_proceso);
                        if ($mas_de_una_opcion) {
                            $td_options .= file_get_contents("views/sgd/evaluacion/alternativa_options_dinamico.html");
                            $options = "";
                            foreach ($mas_de_una_opcion as $unico) {
                                $options .= file_get_contents("views/sgd/evaluacion/options_dinamico.html");
                                $options    = str_replace("{VALUE}", $unico->valor_puntaje, $options);
                                $td_options = str_replace("{ETIQUETA}", $unico->titulo_opciones, $td_options);
                                $options    = str_replace("{SIGNO}", $unico->signo, $options);
                                $options    = str_replace("{CHECK}", "{SELECT" . $unico->valor_puntaje . "} ", $options);
                            }
                            $td_options = str_replace("{OPTIONS_}", $options, $td_options);
                        } else {
                            $td_options .= file_get_contents("views/sgd/evaluacion/alternativa_options.html");
                            if ($tiene_respuesta[0]->puntaje == $alt->puntaje) {
                                $td_options = str_replace("{CHECK}", "checked='checked'", $td_options);
                            } else {
                                $td_options = str_replace("{CHECK}", "", $td_options);
                            }
                            $td_options = str_replace("{VALUE}", $alt->puntaje, $td_options);
                            $td_options = str_replace("{DESCRIPCION_ANTERNATIVA_2}", $alt->alternativa, $td_options);
                            $td_options = str_replace("{SIGNO}", $unico->signo, $td_options);
                            //$td_options = str_replace("{CHECK}","{SELECT".$alt->puntaje."} ",$td_options);
                        }
                    }
                    $listado_preguntas = str_replace("{NIVELES_TD}", $td_options, $listado_preguntas);
                    $listado_preguntas = str_replace("{NOMBRE_RADIO}", $evaluado_individual . "-" . $preg->id, $listado_preguntas);
                    $listado_preguntas = str_replace("{NOMBRE_RADIO_SOLO_PREGUNTA}", $preg->id, $listado_preguntas);
                    $total_html        = str_replace("{NIVELES_TD}", ($td), $total_html);
                }
                $listado_preguntas          = str_replace("{NOMBRE_PREGUNTA}", $preg->pregunta, $listado_preguntas);
                $total_html                 = str_replace("{LISTADO_PREGUNTAS_A_EVALUAR_POR_COMPETENCIAS}", ($listado_preguntas), $total_html);
                $total_html                 = str_replace("{EVALUADO_ENCODEADO}", Encodear3($evaluado_individual), $total_html);
                $total_html                 = str_replace("{TOTAL_PREGUNTAS_A_RESPONDER}", count($preguntas), $total_html);
                $comentario_por_competencia = TieneComentarioPorCompetencia($evaluado_individual, $evaluador, $componentes[$pagina - 1]->id_componente, $id_empresa, $id_proceso);
                $total_html                 = str_replace("{COMENTARIO_POR_COMPETENCIA}", ($comentario_por_competencia[0]->comentario), $total_html);
            } else {
                //REPLACE PARA LA PREGUNTA
                $total_html = str_replace("{NOMBRE_PREGUNTA}", ($componentes[$pagina - 1]->pregunta), $total_html);
                if ($componentes[$pagina - 1]->descripcion) {
                    $total_html = str_replace("{TOOLTIP_DESCRIPCION}", file_get_contents("views/sgd/evaluacion/tooltip_descripcion.html"), $total_html);
                } else {
                    $total_html = str_replace("{TOOLTIP_DESCRIPCION}", "", $total_html);
                }
                $total_html   = str_replace("{DESCRIPCION_PREGUNTA}", ($componentes[$pagina - 1]->descripcion), $total_html);
                $total_html   = str_replace("{ID_PREGUNTA_ENCODEADA}", $componentes[$pagina - 1]->id_pregunta, $total_html);
                $alternativas = AlternativasDadoIdGrupo($componentes[$pagina - 1]->id_alternativa);
                //Esta codicion es para ver si es que tiene o no comentariop
                //Si tiene, se coloca el encabezado
                if ($componentes[$pagina - 1]->tiene_comentarios == 1) {
                    $template_comentario_por_pregunta = file_get_contents("views/sgd/evaluacion/comentario_por_pregunta.html");
                    //Este es para colocar el width dinamico
                    $rowspan_tiene_comentario         = "rowspan='2'";
                } else {
                    //$total_html = str_replace("{SECCION_ENCABEADO_COMENTARIO}","",$total_html);
                    $template_comentario_por_pregunta = "";
                    $rowspan_tiene_comentario         = "";
                }
                $width_dinamico_options = FormatearPorcentajesSinDecimal(100 / (count($alternativas)));
                foreach ($alternativas as $alt) {
                    $td .= file_get_contents("views/sgd/evaluacion/alternativa_encabezado.html");
                    $td                = str_replace("{DESCRIPCION_ALTERNATIVA}", $alt->alternativa, $td);
                    //Por cada alternativa, verifico si tiene m?s de una opcion
                    $mas_de_una_opcion = MasDeUnaOpcionPorAlternativa($alt->puntaje, $id_empresa, $id_proceso);
                    if ($mas_de_una_opcion) {
                        $td_options .= file_get_contents("views/sgd/evaluacion/alternativa_options_dinamico.html");
                        $options = "";
                        foreach ($mas_de_una_opcion as $unico) {
                            $options .= file_get_contents("views/sgd/evaluacion/options_dinamico.html");
                            $options    = str_replace("{VALUE}", $unico->valor_puntaje, $options);
                            $td_options = str_replace("{ETIQUETA}", $unico->titulo_opciones, $td_options);
                            $options    = str_replace("{SIGNO}", $unico->signo, $options);
                            $options    = str_replace("{CHECK}", "{SELECT" . $unico->valor_puntaje . "} ", $options);
                        }
                        $td_options = str_replace("{OPTIONS_}", $options, $td_options);
                    } else {
                        $td_options .= file_get_contents("views/sgd/evaluacion/alternativa_options.html");
                        $td_options = str_replace("{VALUE}", $alt->puntaje, $td_options);
                        $td_options = str_replace("{SIGNO}", $unico->signo, $td_options);
                        $td_options = str_replace("{CHECK}", "{SELECT" . $alt->puntaje . "} ", $td_options);
                    }
                }
                $total_html = str_replace("{NIVELES_TD}", ($td), $total_html);
                $html       = FuncionParaObtenerCalculoMientrasAvanzaPagina($html, $evaluador, $id_proceso, $id_empresa);
                $row        = BloqueListadoEvaluadosEvalCompetencias($evaluados, $evaluador, $componentes[$pagina - 1]->id_componente, $componentes[$pagina - 1]->id_pregunta, $id_proceso_anterior, $id_proceso, $comentario_obligatorio, $td_options, $template_comentario_por_pregunta);
                $total_html = str_replace("{LISTADO_COLABORADORES}", ($row[0]), $total_html);
                $total_html = str_replace("{TOTAL_EVALUADOS}", ($row[1] * 60) / 100, $total_html);
                $total_html = str_replace("{TOTAL_EVALUADOS_1_2}", ($row[1] * 40) / 100, $total_html);
                $total_html = str_replace("{TOTAL_EVALUADOS_4_5}", ($row[1] * 40) / 100, $total_html);
                $total_html = str_replace("{TOTAL_TOTAL_EVALUADOS}", $row[1], $total_html);
                $total_html = str_replace("{WIDTH_DINAMICO_OPCIONES}", ($width_dinamico_options), $total_html);
            }
            $html = str_replace("{PAGINACION_EVALUACION}", PaginacionSGDPorPreguntasV2($evaluador, $pagina, $id_proceso, count($componentes), "no", $evaluado_individual), $html);
            $html = str_replace("{BARRA_PROGESS}", file_get_contents("views/sgd/evaluacion/barra_progress.html"), $html);
            if ($evaluado_individual) {
                $porcentaje_avance = AvanceDeEvaluados($evaluador, $id_proceso, "", "", $datos_proceso[0]->id_proceso_anual, $evaluado_individual, "");
            } else {
                $porcentaje_avance = AvanceDeEvaluados($evaluador, $id_proceso, "", "", $datos_proceso[0]->id_proceso_anual, "", "");
            }
            $html = str_replace("{VALOR_AVANCE}", FormatearPorcentajesSinDecimal($porcentaje_avance[0]), $html);
        }
    } else {
        $total_html = "<div>Proceso no Activado o no tiene evaluados</div>";
    }
    $html = str_replace("{ENTORNO_LISTADO_EVALUACION}", ($total_html), $html);
    return ($html);
}
function formatearFecha($valor_fecha)
{
    $dia = date("d", strtotime($valor_fecha));
    $mes = devuelveNombreMes(date("m", strtotime($valor_fecha)));
    return ($dia . " de " . $mes);
    //return($fecha2=date("d-m",strtotime($valor_fecha)));
}
function formatearFechaSmall($valor_fecha)
{
    $d = date("d", strtotime($valor_fecha));
    $m = date("m", strtotime($valor_fecha));
    $a = date("Y", strtotime($valor_fecha));
    return ($d . "-" . $m . "-" . $a);
    //return($fecha2=date("d-m",strtotime($valor_fecha)));
}
function formatearFechaCompleta($valor_fecha)
{
    $dia = date("d", strtotime($valor_fecha));
    $mes = devuelveNombreMes(date("m", strtotime($valor_fecha)));
    $ano = date("Y", strtotime($valor_fecha));
    //return($fecha2=date("d-m-Y",strtotime($valor_fecha)));
    return ($dia . " de " . $mes . " de " . $ano);
}
function ListadoMensajesPrincipalesAgente($PRINCIPAL, $rut, $id_empresa, $filtro_destinatario, $id_curso, $id_objeto, $vista_agente, $rut_agente)
{
    if ($rut_agente) {
        $mensajes = TotalMensajesPorRutEmpresaAgenteFiltroAgente($rut, $id_empresa, $rut_agente);
    } else {
        $mensajes = TotalMensajesPorRutEmpresaAgente($rut, $id_empresa);
    }
    //Coloca DAtos de Agente (Campo JEfe tbl_usuarios)
    $datos_agente     = DatosMiAgente($rut, $id_empresa);
    $PRINCIPAL        = str_replace("{NOMBRE_AGENTE}", $datos_agente[0]->nombre_completo, $PRINCIPAL);
    $PRINCIPAL        = str_replace("{CARGO_AGENTE}", $datos_agente[0]->cargo, $PRINCIPAL);
    $PRINCIPAL        = str_replace("{EMAIL_AGENTE}", $datos_agente[0]->email, $PRINCIPAL);
    $PRINCIPAL        = str_replace("{TELEFONO_AGENTE}", $datos_agente[0]->telefono, $PRINCIPAL);
    $PRINCIPAL        = str_replace("{URL_IMAGEN_AGENTE}", VerificaFotoPersonal($datos_agente[0]->jefe), $PRINCIPAL);
    $usuario_en_curso = CI_verificausuariocurso($rut, $id_curso, $id_empresa);
    if ($usuario_en_curso[0]->relator == 1) {
        $PRINCIPAL = str_replace("{BOTON_PREGUNTAR}", "", $PRINCIPAL);
    } else {
        $PRINCIPAL = str_replace("{BOTON_PREGUNTAR}", file_get_contents("views/mensajeria/" . $id_empresa . "_boton_preguntar.html"), $PRINCIPAL);
    }
    if ($mensajes) {
        //print_r($mensajes);
        foreach ($mensajes as $unico) {
            if ($usuario_en_curso[0]->relator == 1) {
                $row .= file_get_contents("views/mensajeria/" . $id_empresa . "_row_mensaje_principal_relator.html");
                $row = str_replace("{BLOQUE_RESPUESTA_RAPIDA}", file_get_contents("views/mensajeria/" . $id_empresa . "_bloque_respuesta_rapida_usuario_relator.html"), $row);
                $row = str_replace("{ID_OBJETO_ENCODEADO}", Encodear3($id_objeto), $row);
                $row = str_replace("{ID_CURSO_ENCODEADO}", Encodear3($id_curso), $row);
            } else {
                if ($rut_agente) {
                    $row .= file_get_contents("views/mensajeria/" . $id_empresa . "_row_mensaje_principal_agente.html");
                    $row = str_replace("{RUT_AGENTE}", ($rut_agente), $row);
                } else {
                    $row .= file_get_contents("views/mensajeria/" . $id_empresa . "_row_mensaje_principal.html");
                }
                $row = str_replace("{BLOQUE_RESPUESTA_RAPIDA}", file_get_contents("views/mensajeria/" . $id_empresa . "_bloque_respuesta_rapida_usuario.html"), $row);
            }
            //print_r($unico);
            $row                   = str_replace("{ID_COMENTARIO}", $unico->id, $row);
            $row                   = str_replace("{ID_MENSAJE_ENCODEADO}", Encodear3($unico->id), $row);
            $row                   = str_replace("{NOMBRE_CREADOR}", $unico->nombre_creador . " " . $unico->apaterno . " " . $unico->amaterno, $row);
            $row                   = str_replace("{URL_PERSONA}", VerificaFotoPersonal($unico->rut_creador), $row);
            $row                   = str_replace("{NOMBRE_DESTINATARIO}", $unico->nombre_tipo_destinatario, $row);
            $row                   = str_replace("{ASUNTO}", $unico->nombre_titulo, $row);
            $row                   = str_replace("{MENSAJE}", ($unico->mensaje), $row);
            $estado                = EstadoMensajeria($unico->id);
            $row                   = str_replace("{ESTADO}", $estado[1], $row);
            $row                   = str_replace("{FECHA}", formatearFechaCompleta($unico->fecha), $row);
            $row                   = str_replace("{CANTIDAD_RESPUESTAS}", ($unico->total_comen), $row);
            $respuesta_por_mensaje = RespuestasPorMensaje($unico->id);
            if ($respuesta_por_mensaje) {
                $row_resp = "";
                foreach ($respuesta_por_mensaje as $resp) {
                    $row_resp .= file_get_contents("views/mensajeria/" . $id_empresa . "_bloque_listado_respuesta.html");
                    $row_resp  = str_replace("{URL_PERSONA}", VerificaFotoPersonal($resp->rut_creador), $row_resp);
                    $row_resp  = str_replace("{RUT_USUARIO_ENCODEADO}", Encodear3($resp->rut_creador), $row_resp);
                    $row_resp  = str_replace("{NOMBRE}", ($resp->nombre) . " " . $resp->amaterno . " " . $resp->apaterno, $row_resp);
                    $row_resp  = str_replace("{CARGO}", $resp->cargo, $row_resp);
                    $row_resp  = str_replace("{MENSAJE_RESPUESTA}", ($resp->mensaje), $row_resp);
                    $hora      = $resp->hora;
                    $nuevaHora = strtotime('-7 hour', strtotime($hora));
                    $nuevaHora = date('H:i:s', $nuevaHora);
                    $row_resp  = str_replace("{FECHA_RESPUESTA}", formatearFechaCompleta($resp->fecha), $row_resp);
                }
                $row = str_replace("{BLOQUE_LISTADO_RESPUESTAS}", $row_resp, $row);
            } else {
                $row = str_replace("{BLOQUE_LISTADO_RESPUESTAS}", "", $row);
            }
        }
        $PRINCIPAL = str_replace("{LISTADO_MENSAJES_PRINCIPALES}", $row, $PRINCIPAL);
    } else {
        $PRINCIPAL = str_replace("{LISTADO_MENSAJES_PRINCIPALES}", "No hay preguntas", $PRINCIPAL);
    }
    //Aca verifico si el usuario, con el rut, est? en el listado de los remitentes
    $es_admini_mensajeria = EsDestinatarioMensajeria($rut);
    if ($id_objeto && $id_curso) {
        //Aca veo si el usuario es relator de este curso, si es asi, le muestro el boton de responder
        $usuario_en_curso = CI_verificausuariocurso($rut, $id_curso, $id_empresa);
        if ($usuario_en_curso[0]->relator == 1) {
            $PRINCIPAL = str_replace("{BOTONERA_ADMINISTRACION}", file_get_contents("views/mensajeria/" . $id_empresa . "_botones_administracion.html"), $PRINCIPAL);
        } else {
            $PRINCIPAL = str_replace("{BOTONERA_ADMINISTRACION}", "", $PRINCIPAL);
        }
    } else if ($es_admini_mensajeria) {
        $PRINCIPAL = str_replace("{BOTONERA_ADMINISTRACION}", file_get_contents("views/mensajeria/" . $id_empresa . "_botones_administracion.html"), $PRINCIPAL);
    } else {
        $PRINCIPAL = str_replace("{BOTONERA_ADMINISTRACION}", "", $PRINCIPAL);
    }
    //$PRINCIPAL = str_replace("{OPTIONS_DESTINATARIOS}",OptionsGenericoNombreDadoValoresPorEmpresa("tbl_mensajes_destinatarios", "",  "nombre", "id", "order by nombre asc", $id_empresa, ""),$PRINCIPAL);
    $PRINCIPAL = str_replace("{OPTIONS_DESTINATARIOS}", OptionDestinatariosPorUsuario($filtro_destinatario, "", $id_empresa), $PRINCIPAL);
    return ($PRINCIPAL);
}
function ListadoMensajesPrincipales($PRINCIPAL, $rut, $id_empresa, $filtro_destinatario, $id_curso, $id_objeto)
{
    if ($id_objeto && $id_curso) {
        $mensajes = TotalMensajesPorEmpresaCursoObjeto($id_empresa, $id_curso, $id_objeto);
    } else if ($filtro_destinatario) {
        $mensajes = TotalMensajesPorRutEmpresaPorTipoDestinatario($rut, $id_empresa, $filtro_destinatario);
    } else {
        $mensajes = TotalMensajesPorRutEmpresa($rut, $id_empresa);
    }
    $usuario_en_curso = CI_verificausuariocurso($rut, $id_curso, $id_empresa);
    if ($usuario_en_curso[0]->relator == 1) {
        $PRINCIPAL = str_replace("{BOTON_PREGUNTAR}", "", $PRINCIPAL);
    } else {
        $PRINCIPAL = str_replace("{BOTON_PREGUNTAR}", file_get_contents("views/mensajeria/" . $id_empresa . "_boton_preguntar.html"), $PRINCIPAL);
    }
    if ($mensajes) {
        //print_r($mensajes);
        foreach ($mensajes as $unico) {
            if ($usuario_en_curso[0]->relator == 1) {
                $row .= file_get_contents("views/mensajeria/" . $id_empresa . "_row_mensaje_principal_relator.html");
                $row = str_replace("{BLOQUE_RESPUESTA_RAPIDA}", file_get_contents("views/mensajeria/" . $id_empresa . "_bloque_respuesta_rapida_usuario_relator.html"), $row);
                $row = str_replace("{ID_OBJETO_ENCODEADO}", Encodear3($id_objeto), $row);
                $row = str_replace("{ID_CURSO_ENCODEADO}", Encodear3($id_curso), $row);
            } else {
                $row .= file_get_contents("views/mensajeria/" . $id_empresa . "_row_mensaje_principal.html");
                $row = str_replace("{BLOQUE_RESPUESTA_RAPIDA}", file_get_contents("views/mensajeria/" . $id_empresa . "_bloque_respuesta_rapida_usuario.html"), $row);
            }
            //print_r($unico);
            $row                   = str_replace("{ID_COMENTARIO}", $unico->id, $row);
            $row                   = str_replace("{ID_MENSAJE_ENCODEADO}", Encodear3($unico->id), $row);
            $row                   = str_replace("{NOMBRE_CREADOR}", $unico->nombre_creador . " " . $unico->apaterno . " " . $unico->amaterno, $row);
            $row                   = str_replace("{URL_PERSONA}", VerificaFotoPersonal($unico->rut_creador), $row);
            $row                   = str_replace("{NOMBRE_DESTINATARIO}", $unico->nombre_tipo_destinatario, $row);
            $row                   = str_replace("{ASUNTO}", $unico->nombre_titulo, $row);
            $row                   = str_replace("{MENSAJE}", ($unico->mensaje), $row);
            $estado                = EstadoMensajeria($unico->id);
            $row                   = str_replace("{ESTADO}", $estado[1], $row);
            $row                   = str_replace("{FECHA}", formatearFechaCompleta($unico->fecha), $row);
            $row                   = str_replace("{CANTIDAD_RESPUESTAS}", ($unico->total_comen), $row);
            $respuesta_por_mensaje = RespuestasPorMensaje($unico->id);
            if ($respuesta_por_mensaje) {
                $row_resp = "";
                foreach ($respuesta_por_mensaje as $resp) {
                    $row_resp .= file_get_contents("views/mensajeria/" . $id_empresa . "_bloque_listado_respuesta.html");
                    $row_resp  = str_replace("{URL_PERSONA}", VerificaFotoPersonal($resp->rut_creador), $row_resp);
                    $row_resp  = str_replace("{RUT_USUARIO_ENCODEADO}", Encodear3($resp->rut_creador), $row_resp);
                    $row_resp  = str_replace("{NOMBRE}", ($resp->nombre) . " " . $resp->amaterno . " " . $resp->apaterno, $row_resp);
                    $row_resp  = str_replace("{CARGO}", $resp->cargo, $row_resp);
                    $row_resp  = str_replace("{MENSAJE_RESPUESTA}", ($resp->mensaje), $row_resp);
                    $hora      = $resp->hora;
                    $nuevaHora = strtotime('-7 hour', strtotime($hora));
                    $nuevaHora = date('H:i:s', $nuevaHora);
                    $row_resp  = str_replace("{FECHA_RESPUESTA}", formatearFechaCompleta($resp->fecha), $row_resp);
                }
                $row = str_replace("{BLOQUE_LISTADO_RESPUESTAS}", $row_resp, $row);
            } else {
                $row = str_replace("{BLOQUE_LISTADO_RESPUESTAS}", "", $row);
            }
        }
        $PRINCIPAL = str_replace("{LISTADO_MENSAJES_PRINCIPALES}", $row, $PRINCIPAL);
    } else {
        $PRINCIPAL = str_replace("{LISTADO_MENSAJES_PRINCIPALES}", "No hay preguntas", $PRINCIPAL);
    }
    //Aca verifico si el usuario, con el rut, est? en el listado de los remitentes
    $es_admini_mensajeria = EsDestinatarioMensajeria($rut);
    if ($id_objeto && $id_curso) {
        //Aca veo si el usuario es relator de este curso, si es asi, le muestro el boton de responder
        $usuario_en_curso = CI_verificausuariocurso($rut, $id_curso, $id_empresa);
        if ($usuario_en_curso[0]->relator == 1) {
            $PRINCIPAL = str_replace("{BOTONERA_ADMINISTRACION}", file_get_contents("views/mensajeria/" . $id_empresa . "_botones_administracion.html"), $PRINCIPAL);
        } else {
            $PRINCIPAL = str_replace("{BOTONERA_ADMINISTRACION}", "", $PRINCIPAL);
        }
    } else if ($es_admini_mensajeria) {
        $PRINCIPAL = str_replace("{BOTONERA_ADMINISTRACION}", file_get_contents("views/mensajeria/" . $id_empresa . "_botones_administracion.html"), $PRINCIPAL);
    } else {
        $PRINCIPAL = str_replace("{BOTONERA_ADMINISTRACION}", "", $PRINCIPAL);
    }
    //$PRINCIPAL = str_replace("{OPTIONS_DESTINATARIOS}",OptionsGenericoNombreDadoValoresPorEmpresa("tbl_mensajes_destinatarios", "",  "nombre", "id", "order by nombre asc", $id_empresa, ""),$PRINCIPAL);
    $PRINCIPAL = str_replace("{OPTIONS_DESTINATARIOS}", OptionDestinatariosPorUsuario($filtro_destinatario, "", $id_empresa), $PRINCIPAL);
    return ($PRINCIPAL);
}
function ListadoMensajesPrincipalesParaResponder($PRINCIPAL, $rut, $id_empresa, $filtro_destinatario, $id_curso, $id_objeto)
{
    //Traigo el listado de los mensajes, filtrado por empresa y por RUT
    if ($id_objeto && $id_curso) {
        $mensajes = TotalMensajesPorEmpresaCursoObjeto($id_empresa, $id_curso, $id_objeto);
    } else if ($filtro_destinatario) {
        $mensajes = TotalMensajesPorRutDestinatarioPerfilado($rut, $id_empresa, $filtro_destinatario);
    } else {
        $mensajes = TotalMensajesPorRutDestinatario($rut, $id_empresa);
    }
    if ($mensajes) {
        foreach ($mensajes as $unico) {
            $row .= file_get_contents("views/mensajeria/row_mensaje_principal_admin.html");
            $row                   = str_replace("{BLOQUE_RESPUESTA_RAPIDA}", file_get_contents("views/mensajeria/bloque_respuesta_rapida.html"), $row);
            $row                   = str_replace("{ID_COMENTARIO}", $unico->id, $row);
            $row                   = str_replace("{NOMBRE_CREADOR}", $unico->nombre_creador . " " . $unico->apaterno . " " . $unico->amaterno, $row);
            $row                   = str_replace("{NOMBRE_DESTINATARIO}", $unico->nombre_tipo_destinatario, $row);
            $row                   = str_replace("{ASUNTO}", $unico->nombre_titulo, $row);
            $row                   = str_replace("{MENSAJE}", $unico->mensaje, $row);
            $row                   = str_replace("{FECHA}", formatearFechaCompleta($unico->fecha), $row);
            $estado                = EstadoMensajeria($unico->id);
            $row                   = str_replace("{ESTADO}", $estado[1], $row);
            $row                   = str_replace("{FECHA}", formatearFechaCompleta($unico->fecha), $row);
            $row                   = str_replace("{CANTIDAD_RESPUESTAS}", ($unico->total_comen), $row);
            $respuesta_por_mensaje = RespuestasPorMensaje($unico->id);
            if ($respuesta_por_mensaje) {
                $row_resp = "";
                foreach ($respuesta_por_mensaje as $resp) {
                    $row_resp .= file_get_contents("views/mensajeria/bloque_listado_respuesta.html");
                    $row_resp  = str_replace("{URL_PERSONA}", VerificaFotoPersonal($resp->rut_creador), $row_resp);
                    $row_resp  = str_replace("{RUT_USUARIO_ENCODEADO}", Encodear3($resp->rut_creador), $row_resp);
                    $row_resp  = str_replace("{NOMBRE}", ($resp->nombre) . " " . $resp->amaterno . " " . $resp->apaterno, $row_resp);
                    $row_resp  = str_replace("{CARGO}", $resp->cargo, $row_resp);
                    $row_resp  = str_replace("{MENSAJE_RESPUESTA}", $resp->mensaje, $row_resp);
                    $hora      = $resp->hora;
                    $nuevaHora = strtotime('-7 hour', strtotime($hora));
                    $nuevaHora = date('H:i:s', $nuevaHora);
                    $row_resp  = str_replace("{FECHA_RESPUESTA}", formatearFechaCompleta($resp->fecha) . "<br>" . $nuevaHora, $row_resp);
                }
                $row = str_replace("{BLOQUE_LISTADO_RESPUESTAS}", $row_resp, $row);
            } else {
                $row = str_replace("{BLOQUE_LISTADO_RESPUESTAS}", "", $row);
            }
        }
        $PRINCIPAL = str_replace("{LISTADO_MENSAJES_PRINCIPALES}", $row, $PRINCIPAL);
    } else {
        $PRINCIPAL = str_replace("{LISTADO_MENSAJES_PRINCIPALES}", "No posee mensajes enviados al Administrador para responder", $PRINCIPAL);
    }
    //Aca verifico si el usuario, con el rut, est? en el listado de los remitentes
    $es_admini_mensajeria = EsDestinatarioMensajeria($rut);
    if ($id_objeto && $id_curso) {
        //Aca veo si el usuario es relator de este curso, si es asi, le muestro el boton de responder
        $usuario_en_curso = CI_verificausuariocurso($rut, $id_curso, $id_empresa);
        if ($usuario_en_curso[0]->relator == 1) {
            $PRINCIPAL = str_replace("{BOTONERA_ADMINISTRACION}", file_get_contents("views/mensajeria/" . $id_empresa . "_botones_administracion.html"), $PRINCIPAL);
        } else {
            $PRINCIPAL = str_replace("{BOTONERA_ADMINISTRACION}", "", $PRINCIPAL);
        }
    } else if ($es_admini_mensajeria) {
        $PRINCIPAL = str_replace("{BOTONERA_ADMINISTRACION}", file_get_contents("views/mensajeria/botones_administracion.html"), $PRINCIPAL);
    } else {
        $PRINCIPAL = str_replace("{BOTONERA_ADMINISTRACION}", "", $PRINCIPAL);
    }
    $PRINCIPAL = str_replace("{OPTIONS_DESTINATARIOS_ADMIN}", OptionDestinatariosPorUsuario($filtro_destinatario, $rut, $id_empresa), $PRINCIPAL);
    //Bloque de las dem?s respuestas
    return ($PRINCIPAL);
}
function ColocaFormularioMensaje($PRINCIPAL, $id_empresa)
{
    $PRINCIPAL = str_replace("{OPTIONS_TIPO_MENSAJE}", OptionsGenericoNombreDadoValoresPorEmpresa("tbl_mensaje_tipo", "", "nombre", "id", "order by orden asc", $id_empresa), $PRINCIPAL);
    $PRINCIPAL = str_replace("{OPTIONS_TIPO_DESTINATARIO}", OptionsGenericoNombreDadoValoresPorEmpresa("tbl_mensajes_destinatarios", "", "nombre", "id", "order by nombre asc", $id_empresa), $PRINCIPAL);
    return ($PRINCIPAL);
}
function colocarColaboradoresPorRut($PRINCIPAL, $id_empresa, $rut)
{
    $listado_colaboradores = TotalUsuariosPorRutJefe($rut);
    if ($listado_colaboradores) {
        $PRINCIPAL = str_replace("{BLOQUE_COLABORADORES}", file_get_contents("views/miperfil/bloque_mis_colaboradores.html"), $PRINCIPAL);
    } else {
        $PRINCIPAL = str_replace("{BLOQUE_COLABORADORES}", "", $PRINCIPAL);
    }
    foreach ($listado_colaboradores as $unico) {
        $row .= file_get_contents("views/miperfil/row_colaboradores_miperfil.html");
        $row = str_replace("{NOMBRE}", $unico->nombre . " " . $unico->apaterno . " " . $unico->amaterno, $row);
        $row = str_replace("{CARGO}", $unico->cargo, $row);
        $row = str_replace("{FECHA_CUMPLEANOS}", formatearFecha($unico->fecha_nacimiento), $row);
        $row = str_replace("{URL_PERSONA}", VerificaFotoPersonal($unico->rut), $row);
        $row = str_replace("{RUT_ENCODEADO}", Encodear3($unico->rut), $row);
    }
    $PRINCIPAL = str_replace("{LISTADO_COLABORADORES_DIRECTOS}", ($row), $PRINCIPAL);
    return ($PRINCIPAL);
}
function MuestraEvaluacionFeedback($id_evaluacion, $rut)
{
    $id_empresa               = $_SESSION["id_empresa"];
    //function MuestraEvaluacion($PRINCIPAL, $id_evaluacion, $rut){
    //ID_EVALUACION CORRESPONDE AL ID DEL OBJETO
    $datos_objeto             = DatosObjeto($id_evaluacion);
    $id_evaluacion_por_objeto = $datos_objeto[0]->id_evaluacion; //Id de la evaluacion. Este es el que se obtiene desde el campo id evaluacion de la tabla objeto
    $datos_evaluacion         = DatosEvaluacion($datos_objeto[0]->id_evaluacion);
    //Veo si est? en la tabla sesion esta evaluacion, y este usuario
    $tiene_sesion             = SesionEvaluacionContenidos($id_evaluacion, $rut);
    $total_preguntas          = PreguntasDadoEvaluacion($id_evaluacion_por_objeto);
    //ACA VALIDA SI ES QUE EL OBJETO, QUE CONTIENE ESTA EVALUACION, TIENE PREGUNTAS ALEATORIAS O NO.
    //SI NO TIENE ALEATORIAS, LAS MUESTRA TODAS
    if ($datos_objeto[0]->preguntas_aleatorias > 0) {
        //Asigno a una tabla,si es que no esta asignado obviamente. La cantidad que corresponda de preguntas, asociadas al rut, curso y objeto.
        $tiene_preguntas_asociadas = VerificaSiTienePReguntasAsociadasRandomicas($rut, $id_evaluacion_por_objeto, $datos_objeto[0]->id);
        if (count($tiene_preguntas_asociadas) == 0) {
            shuffle($total_preguntas);
            $vueltas = 1;
            foreach ($total_preguntas as $pre) {
                InsertoRegistroPreguntasAleatorias($rut, $id_evaluacion_por_objeto, $datos_objeto[0]->id, $vueltas, $pre->id, $datos_objeto[0]->id_curso);
                if ($vueltas == $datos_objeto[0]->preguntas_aleatorias)
                    break;
                $vueltas++;
            }
        }
        if ($tiene_sesion) {
            //echo "1.1<br>";
            $pagina             = $tiene_sesion[0]->pagina - 1;
            $pregunta           = PreguntaDeEvaluacionAleatorias($id_evaluacion_por_objeto, $pagina, $rut);
            //echo "views/cursos/evaluacion/".$pregunta[0]->template_pregunta_feedback;
            $PRINCIPAL          = FuncionesTransversales(file_get_contents("views/cursos/evaluacion/" . $pregunta[0]->template_pregunta_feedback));
            $PRINCIPAL          = str_replace("{TEXTO_PREGUNTA}", ($pregunta[0]->pregunta), $PRINCIPAL);
            //Funcion para mostrar las alternativas
            $PRINCIPAL          = str_replace("{OPCIONES}", MuestraAlternativas($pregunta[0]->id_grupo_alternativas, $pregunta[0]->id), $PRINCIPAL);
            $PRINCIPAL          = str_replace("{ID_PREGUNTA_ENCODEADO}", Encodear3($pregunta[0]->id), $PRINCIPAL);
            $PRINCIPAL          = str_replace("{ID_OBJETO_ENCODEADO}", Encodear3($id_evaluacion), $PRINCIPAL);
            $PRINCIPAL          = str_replace("{URL_IMAGEN}", $pregunta[0]->url_archivo, $PRINCIPAL);
            $PRINCIPAL          = str_replace("{NUMERO_PREGUNTA}", $pagina, $PRINCIPAL);
            $PRINCIPAL          = str_replace("{TEXTO_PREGUNTA_BAJADA1}", $pregunta[0]->bajada1, $PRINCIPAL);
            $PRINCIPAL          = str_replace("{TEXTO_PREGUNTA_BAJADA2}", $pregunta[0]->bajada2, $PRINCIPAL);
            $PRINCIPAL          = str_replace("{TEXTO_PREGUNTA_BAJADA3}", $pregunta[0]->bajada3, $PRINCIPAL);
            $PRINCIPAL          = str_replace("{TEXTO_PREGUNTA_BAJADA4}", $pregunta[0]->bajada4, $PRINCIPAL);
            $PRINCIPAL          = str_replace("{TEXTO_PREGUNTA_REFUERZO1}", $pregunta[0]->refuerzo1, $PRINCIPAL);
            $PRINCIPAL          = str_replace("{TEXTO_PREGUNTA_REFUERZO2}", $pregunta[0]->refuerzo2, $PRINCIPAL);
            $PRINCIPAL          = str_replace("{TEXTO_PREGUNTA_REFUERZO3}", $pregunta[0]->refuerzo3, $PRINCIPAL);
            $PRINCIPAL          = str_replace("{TEXTO_PREGUNTA_REFUERZO4}", $pregunta[0]->refuerzo4, $PRINCIPAL);
            $PRINCIPAL          = str_replace("{TEXTO_PREGUNTA_REFUERZO5}", $pregunta[0]->refuerzo5, $PRINCIPAL);
            $PRINCIPAL          = str_replace("{TEXTO_PREGUNTA_REFUERZO6}", $pregunta[0]->refuerzo6, $PRINCIPAL);
            $respuesta_correcta = ObtenerRespuestaDeUsuario($pregunta[0]->id, $rut);
            if ($respuesta_correcta[0]->correcta == "1") {
                $PRINCIPAL = str_replace("{RESULTADO}", "CORRECTO", $PRINCIPAL);
                $PRINCIPAL = str_replace("{CLASERESULTADO}", "feedbackcorrecto", $PRINCIPAL);
            } else {
                $PRINCIPAL = str_replace("{RESULTADO}", "INCORRECTO", $PRINCIPAL);
                $PRINCIPAL = str_replace("{CLASERESULTADO}", "feedbackincorrecto", $PRINCIPAL);
            }
        } else {
            $pagina = 1;
            //Ingreso el registro de la sesion con pagina 1
            InsertaRegistroTablaSesionEvaluacionContenido($rut, $id_evaluacion, $pagina);
            $pregunta           = PreguntaDeEvaluacionAleatorias($id_evaluacion_por_objeto, $pagina, $rut);
            $PRINCIPAL          = FuncionesTransversales(file_get_contents("views/cursos/evaluacion/" . $pregunta[0]->template_pregunta_feedback));
            $PRINCIPAL          = str_replace("{TEXTO_PREGUNTA}", ($pregunta[0]->pregunta), $PRINCIPAL);
            //Funcion para mostrar las alternativas
            $PRINCIPAL          = str_replace("{OPCIONES}", MuestraAlternativas($pregunta[0]->id_grupo_alternativas, $pregunta[0]->id), $PRINCIPAL);
            $PRINCIPAL          = str_replace("{ID_PREGUNTA_ENCODEADO}", Encodear3($pregunta[0]->id), $PRINCIPAL);
            $PRINCIPAL          = str_replace("{ID_OBJETO_ENCODEADO}", Encodear3($id_evaluacion), $PRINCIPAL);
            $PRINCIPAL          = str_replace("{NUMERO_PREGUNTA}", $pagina, $PRINCIPAL);
            $PRINCIPAL          = str_replace("{TEXTO_PREGUNTA_BAJADA1}", $pregunta[0]->bajada1, $PRINCIPAL);
            $PRINCIPAL          = str_replace("{TEXTO_PREGUNTA_BAJADA2}", $pregunta[0]->bajada2, $PRINCIPAL);
            $PRINCIPAL          = str_replace("{TEXTO_PREGUNTA_BAJADA3}", $pregunta[0]->bajada3, $PRINCIPAL);
            $PRINCIPAL          = str_replace("{TEXTO_PREGUNTA_BAJADA4}", $pregunta[0]->bajada4, $PRINCIPAL);
            $PRINCIPAL          = str_replace("{TEXTO_PREGUNTA_REFUERZO1}", $pregunta[0]->refuerzo1, $PRINCIPAL);
            $PRINCIPAL          = str_replace("{TEXTO_PREGUNTA_REFUERZO2}", $pregunta[0]->refuerzo2, $PRINCIPAL);
            $PRINCIPAL          = str_replace("{TEXTO_PREGUNTA_REFUERZO3}", $pregunta[0]->refuerzo3, $PRINCIPAL);
            $PRINCIPAL          = str_replace("{TEXTO_PREGUNTA_REFUERZO4}", $pregunta[0]->refuerzo4, $PRINCIPAL);
            $PRINCIPAL          = str_replace("{TEXTO_PREGUNTA_REFUERZO5}", $pregunta[0]->refuerzo5, $PRINCIPAL);
            $PRINCIPAL          = str_replace("{TEXTO_PREGUNTA_REFUERZO6}", $pregunta[0]->refuerzo6, $PRINCIPAL);
            $respuesta_correcta = ObtenerRespuestaDeUsuario($pregunta[0]->id, $rut);
            if ($respuesta_correcta[0]->correcta == "1") {
                $PRINCIPAL = str_replace("{RESULTADO}", "CORRECTO", $PRINCIPAL);
                $PRINCIPAL = str_replace("{CLASERESULTADO}", "feedbackcorrecto", $PRINCIPAL);
            } else {
                $PRINCIPAL = str_replace("{RESULTADO}", "INCORRECTO", $PRINCIPAL);
                $PRINCIPAL = str_replace("{CLASERESULTADO}", "feedbackincorrecto", $PRINCIPAL);
            }
        }
    } else {
        if ($tiene_sesion) {
            //$pagina=$tiene_sesion[0]->pagina;
            $pagina             = $tiene_sesion[0]->pagina - 1;
            $pregunta           = PreguntaDeEvaluacion($id_evaluacion_por_objeto, $pagina);
            $PRINCIPAL          = FuncionesTransversales(file_get_contents("views/cursos/evaluacion/" . $pregunta[0]->template_pregunta_feedback));
            $PRINCIPAL          = str_replace("{TEXTO_PREGUNTA}", ($pregunta[0]->pregunta), $PRINCIPAL);
            //Funcion para mostrar las alternativas
            $PRINCIPAL          = str_replace("{OPCIONES}", MuestraAlternativas($pregunta[0]->id_grupo_alternativas, $pregunta[0]->id), $PRINCIPAL);
            $PRINCIPAL          = str_replace("{ID_PREGUNTA_ENCODEADO}", Encodear3($pregunta[0]->id), $PRINCIPAL);
            $PRINCIPAL          = str_replace("{ID_OBJETO_ENCODEADO}", Encodear3($id_evaluacion), $PRINCIPAL);
            $PRINCIPAL          = str_replace("{URL_IMAGEN}", $pregunta[0]->url_archivo, $PRINCIPAL);
            $PRINCIPAL          = str_replace("{NUMERO_PREGUNTA}", $pregunta[0]->orden, $PRINCIPAL);
            $PRINCIPAL          = str_replace("{TEXTO_PREGUNTA_BAJADA1}", $pregunta[0]->bajada1, $PRINCIPAL);
            $PRINCIPAL          = str_replace("{TEXTO_PREGUNTA_BAJADA2}", $pregunta[0]->bajada2, $PRINCIPAL);
            $PRINCIPAL          = str_replace("{TEXTO_PREGUNTA_BAJADA3}", $pregunta[0]->bajada3, $PRINCIPAL);
            $PRINCIPAL          = str_replace("{TEXTO_PREGUNTA_BAJADA4}", $pregunta[0]->bajada4, $PRINCIPAL);
            $PRINCIPAL          = str_replace("{TEXTO_PREGUNTA_REFUERZO1}", $pregunta[0]->refuerzo1, $PRINCIPAL);
            $PRINCIPAL          = str_replace("{TEXTO_PREGUNTA_REFUERZO2}", $pregunta[0]->refuerzo2, $PRINCIPAL);
            $PRINCIPAL          = str_replace("{TEXTO_PREGUNTA_REFUERZO3}", $pregunta[0]->refuerzo3, $PRINCIPAL);
            $PRINCIPAL          = str_replace("{TEXTO_PREGUNTA_REFUERZO4}", $pregunta[0]->refuerzo4, $PRINCIPAL);
            $PRINCIPAL          = str_replace("{TEXTO_PREGUNTA_REFUERZO5}", $pregunta[0]->refuerzo5, $PRINCIPAL);
            $PRINCIPAL          = str_replace("{TEXTO_PREGUNTA_REFUERZO6}", $pregunta[0]->refuerzo6, $PRINCIPAL);
            $respuesta_correcta = ObtenerRespuestaDeUsuario($pregunta[0]->id, $rut);
            if ($respuesta_correcta[0]->correcta == "1") {
                $PRINCIPAL = str_replace("{RESULTADO}", "CORRECTO", $PRINCIPAL);
                $PRINCIPAL = str_replace("{CLASERESULTADO}", "feedbackcorrecto", $PRINCIPAL);
            } else {
                $PRINCIPAL = str_replace("{RESULTADO}", "INCORRECTO", $PRINCIPAL);
                $PRINCIPAL = str_replace("{CLASERESULTADO}", "feedbackincorrecto", $PRINCIPAL);
            }
        } else {
            $pagina   = 1;
            //obtengo la primera pregunta
            $pregunta = PreguntaDeEvaluacion($id_evaluacion_por_objeto, $pagina1);
            //Inserto en la tabla de sesion la pgina 1.
            InsertaRegistroTablaSesionEvaluacionContenido($rut, $id_evaluacion, "1");
            $PRINCIPAL = FuncionesTransversales(file_get_contents("views/cursos/evaluacion/" . $pregunta[0]->template_pregunta_feedback));
            $PRINCIPAL = str_replace("{TEXTO_PREGUNTA}", ($pregunta[0]->pregunta), $PRINCIPAL);
            //Funcion para mostrar las alternativas
            $PRINCIPAL = str_replace("{OPCIONES}", MuestraAlternativas($pregunta[0]->id_grupo_alternativas, $pregunta[0]->id), $PRINCIPAL);
            $PRINCIPAL = str_replace("{ID_PREGUNTA_ENCODEADO}", Encodear3($pregunta[0]->id), $PRINCIPAL);
            $PRINCIPAL = str_replace("{ID_OBJETO_ENCODEADO}", Encodear3($id_evaluacion), $PRINCIPAL);
            $PRINCIPAL = str_replace("{NUMERO_PREGUNTA}", $pregunta[0]->orden, $PRINCIPAL);
            $PRINCIPAL = str_replace("{TEXTO_PREGUNTA_BAJADA1}", $pregunta[0]->bajada1, $PRINCIPAL);
            $PRINCIPAL = str_replace("{TEXTO_PREGUNTA_BAJADA2}", $pregunta[0]->bajada2, $PRINCIPAL);
            $PRINCIPAL = str_replace("{TEXTO_PREGUNTA_BAJADA3}", $pregunta[0]->bajada3, $PRINCIPAL);
            $PRINCIPAL = str_replace("{TEXTO_PREGUNTA_BAJADA4}", $pregunta[0]->bajada4, $PRINCIPAL);
        }
    }
    //PAGINACION////////////
    if ($datos_objeto[0]->preguntas_aleatorias > 0) {
        $total_preguntas = VerificaSiTienePReguntasAsociadasRandomicas($rut, $id_evaluacion_por_objeto, $datos_objeto[0]->id);
    } else {
        $total_preguntas = PreguntasDadoEvaluacion($id_evaluacion_por_objeto);
    }
    $PRINCIPAL     = str_replace("{ENTORNO_PAGINACION}", ArmaPaginacionEvaluacion($total_preguntas, $pagina), $PRINCIPAL);
    $PRINCIPAL     = str_replace("{ID_PREGUNTA_ENCODEADO}", Encodear3($id_evaluacion_por_objeto), $PRINCIPAL);
    $PRINCIPAL     = str_replace("{NAME_FORMULARIO}", "FormRespuestas", $PRINCIPAL);
    $PRINCIPAL     = str_replace("{VALOR_BOTON}", "Guardar y Avanzar", $PRINCIPAL);
    $PRINCIPAL     = str_replace("{NOMBRE_EVALUACION}", $datos_evaluacion[0]->nombre_evaluacion, $PRINCIPAL);
    $PRINCIPAL     = str_replace("{NOMBRE_OBJETO}", $datos_evaluacion[0]->nombre_evaluacion, $PRINCIPAL);
    $datos_usuario = UsuarioEnBasePersonas($rut);
    $PRINCIPAL     = str_replace("{NOMBRE_USUARIO}", ($datos_usuario[0]->nombre_completo), $PRINCIPAL);
    $PRINCIPAL     = str_replace("{AVANCEEVALUACION_PREGUNTADOS}", "100", $PRINCIPAL);
    return ($PRINCIPAL);
}
function ColocaDatosPerfil($PRINCIPAL, $rut)
{
	
		//echo "rut $rut";
    $PRINCIPAL             = str_replace("{FOTO_PERSONA}", VerificaFotoPersonal($rut), $PRINCIPAL);
    $datos_usuario         = DatosUsuarioLeftJefeDeTblUsuario($rut);
    //Datos JEfe
    $arreglo_rut_jefe      = explode("-", $datos_usuario[0]->jefe);
    $datos_personales_jefe = DatosUsuarioLeftJefeDeTblUsuario($arreglo_rut_jefe[0]);
    $PRINCIPAL             = str_replace("{NOMBRE}", ($datos_usuario[0]->nombre . " " . $datos_usuario[0]->apaterno . " " . $datos_usuario[0]->amaterno), $PRINCIPAL);
    $PRINCIPAL             = str_replace("{CARGO}", ($datos_usuario[0]->cargo), $PRINCIPAL);
    $PRINCIPAL             = str_replace("{GERENCIA}", ($datos_usuario[0]->gerencia), $PRINCIPAL);
    $PRINCIPAL             = str_replace("{DIVISION}", ($datos_usuario[0]->division), $PRINCIPAL);
    $PRINCIPAL             = str_replace("{CORREO}", $datos_usuario[0]->email, $PRINCIPAL);
    $PRINCIPAL             = str_replace("{RUT_ENCODEADO}", Encodear3($rut), $PRINCIPAL);
    if ($datos_usuario[0]->telefono) {
        $PRINCIPAL = str_replace("{ROW_TELEFONO}", file_get_contents("views/miperfil/row_telefono_miperfil.html"), $PRINCIPAL);
        $PRINCIPAL = str_replace("{TELEFONO_FIJO}", $datos_usuario[0]->telefono, $PRINCIPAL);
    } else {
        $PRINCIPAL = str_replace("{ROW_TELEFONO}", "", $PRINCIPAL);
    }
    if ($datos_usuario[0]->celular) {
        if ($_SESSION["id_empresa"] == 41) {
            if ($rut == 6473776) {
                $PRINCIPAL = str_replace("{ROW_CELULAR}", "", $PRINCIPAL);
            } else {
                $PRINCIPAL = str_replace("{ROW_CELULAR}", file_get_contents("views/miperfil/row_celular_miperfil.html"), $PRINCIPAL);
                $PRINCIPAL = str_replace("{CELULAR}", $datos_usuario[0]->celular, $PRINCIPAL);
            }
        } else {
            $PRINCIPAL = str_replace("{ROW_CELULAR}", file_get_contents("views/miperfil/row_celular_miperfil.html"), $PRINCIPAL);
            $PRINCIPAL = str_replace("{CELULAR}", $datos_usuario[0]->celular, $PRINCIPAL);
        }
    } else {
        $PRINCIPAL = str_replace("{ROW_CELULAR}", "", $PRINCIPAL);
    }
    if ($datos_usuario[0]->anexo) {
        $PRINCIPAL = str_replace("{ROW_TELEFONO}", file_get_contents("views/miperfil/row_telefono_miperfil.html"), $PRINCIPAL);
        $PRINCIPAL = str_replace("{TELEFONO_FIJO}", $datos_usuario[0]->anexo, $PRINCIPAL);
    } else {
        $PRINCIPAL = str_replace("{ROW_TELEFONO}", "", $PRINCIPAL);
    }
    if ($datos_usuario[0]->fecha_nacimiento) {
        $PRINCIPAL = str_replace("{ROW_CUMPLEANOS}", file_get_contents("views/miperfil/row_cumple_miperfil.html"), $PRINCIPAL);
        $PRINCIPAL = str_replace("{CUMPLE}", formatearFecha($datos_usuario[0]->fecha_nacimiento), $PRINCIPAL);
    } else {
        $PRINCIPAL = str_replace("{ROW_CUMPLEANOS}", "", $PRINCIPAL);
    }
    if ($datos_usuario[0]->jefe) {
        $PRINCIPAL = str_replace("{ROW_JEFE}", file_get_contents("views/miperfil/row_mi_jefe_miperfil.html"), $PRINCIPAL);
        $PRINCIPAL = str_replace("{NOMBRE_JEFE}", "<a href='?sw=veperfil&r=" . Encodear3($datos_usuario[0]->jefe) . "'>" . ($datos_personales_jefe[0]->nombre . " " . $datos_personales_jefe[0]->apaterno . " " . $datos_personales_jefe[0]->amaterno) . "</a>", $PRINCIPAL);
    } else {
        $PRINCIPAL = str_replace("{ROW_JEFE}", "", $PRINCIPAL);
    }
    if ($_SESSION["id_empresa"] == 41) {
        $PRINCIPAL = str_replace("{UBICACION}", ($datos_usuario[0]->sucursal), $PRINCIPAL);
    } else {
        $PRINCIPAL = str_replace("{UBICACION}", ($datos_usuario[0]->ubicacion), $PRINCIPAL);
    }
    return ($PRINCIPAL);
}
function DetectaSistema()
{
    $tablet_browser = 0;
    $mobile_browser = 0;
    $body_class     = 'desktop';
    if (preg_match('/(tablet|ipad|playbook)|(android(?!.*(mobi|opera mini)))/i', strtolower($_SERVER['HTTP_USER_AGENT']))) {
        $tablet_browser++;
        $body_class = "tablet";
    }
    if (preg_match('/(up.browser|up.link|mmp|symbian|smartphone|midp|wap|phone|android|iemobile)/i', strtolower($_SERVER['HTTP_USER_AGENT']))) {
        $mobile_browser++;
        $body_class = "mobile";
    }
    if ((strpos(strtolower($_SERVER['HTTP_ACCEPT']), 'application/vnd.wap.xhtml+xml') > 0) or ((isset($_SERVER['HTTP_X_WAP_PROFILE']) or isset($_SERVER['HTTP_PROFILE'])))) {
        $mobile_browser++;
        $body_class = "mobile";
    }
    $mobile_ua     = strtolower(substr($_SERVER['HTTP_USER_AGENT'], 0, 4));
    $mobile_agents = array(
        'w3c ',
        'acs-',
        'alav',
        'alca',
        'amoi',
        'audi',
        'avan',
        'benq',
        'bird',
        'blac',
        'blaz',
        'brew',
        'cell',
        'cldc',
        'cmd-',
        'dang',
        'doco',
        'eric',
        'hipt',
        'inno',
        'ipaq',
        'java',
        'jigs',
        'kddi',
        'keji',
        'leno',
        'lg-c',
        'lg-d',
        'lg-g',
        'lge-',
        'maui',
        'maxo',
        'midp',
        'mits',
        'mmef',
        'mobi',
        'mot-',
        'moto',
        'mwbp',
        'nec-',
        'newt',
        'noki',
        'palm',
        'pana',
        'pant',
        'phil',
        'play',
        'port',
        'prox',
        'qwap',
        'sage',
        'sams',
        'sany',
        'sch-',
        'sec-',
        'send',
        'seri',
        'sgh-',
        'shar',
        'sie-',
        'siem',
        'smal',
        'smar',
        'sony',
        'sph-',
        'symb',
        't-mo',
        'teli',
        'tim-',
        'tosh',
        'tsm-',
        'upg1',
        'upsi',
        'vk-v',
        'voda',
        'wap-',
        'wapa',
        'wapi',
        'wapp',
        'wapr',
        'webc',
        'winw',
        'winw',
        'xda ',
        'xda-'
    );
    if (in_array($mobile_ua, $mobile_agents)) {
        $mobile_browser++;
    }
    if (strpos(strtolower($_SERVER['HTTP_USER_AGENT']), 'opera mini') > 0) {
        $mobile_browser++;
        //Check for tablets on opera mini alternative headers
        $stock_ua = strtolower(isset($_SERVER['HTTP_X_OPERAMINI_PHONE_UA']) ? $_SERVER['HTTP_X_OPERAMINI_PHONE_UA'] : (isset($_SERVER['HTTP_DEVICE_STOCK_UA']) ? $_SERVER['HTTP_DEVICE_STOCK_UA'] : ''));
        if (preg_match('/(tablet|ipad|playbook)|(android(?!.*mobile))/i', $stock_ua)) {
            $tablet_browser++;
        }
    }
    if ($tablet_browser > 0) {
        // Si es tablet has lo que necesites
        //print 'es tablet';
        $arreglo_return[0] = 1;
    } else if ($mobile_browser > 0) {
        // Si es dispositivo mobil has lo que necesites
        //print 'es un mobil';
        $arreglo_return[0] = 2;
    } else {
        // Si es ordenador de escritorio has lo que necesites
        // print 'es un ordenador de escritorio';
        $arreglo_return[0] = 3;
    }
    return ($arreglo_return);
}
function TransformarEscalaEncSatisParaGrafico($valor)
{
    $valor = ($valor * 100) / 5;
    return ($valor);
}
function ColocaBloqueUltimasTres($PRINCIPAL, $id_empresa)
{
    //Traigo el listado de Categorias por empresa
    $noticias = TRaigoUltimas3Noticias($id_empresa);
    $i        = 20;
    foreach ($noticias as $unico) {
        //$row.=file_get_contents("views/bloques/row_bloques_sin_visitas.html");
        $row .= file_get_contents("views/bloques/row_bloques_noticias_recientes.html");
        $row = str_replace("{NOMBRE}", $unico->titulo, $row);
        $row = str_replace("{ID_NOTICIA}", Encodear($unico->id), $row);
        $row = str_replace("{TOTAL_DE_CURSOS}", "", $row);
        $i++;
    }
    $PRINCIPAL = str_replace("{BLOQUE_ULTIMAS_TRES}", ($row), $PRINCIPAL);
    return ($PRINCIPAL);
}
function ColocaBloqueNoticiasSimilares($PRINCIPAL, $id_empresa, $id_categoria)
{
    //Traigo el listado de Categorias por empresa
    $noticias = NoticiaPorIdConVistasPorCategoria($id_categoria, $id_empresa);
    $i        = 20;
    foreach ($noticias as $unico) {
        $row .= file_get_contents("views/bloques/row_bloques_sin_visitas.html");
        $row = str_replace("{NOMBRE}", $unico->titulo, $row);
        $row = str_replace("{TOTAL_DE_CURSOS}", $unico->total_visitas, $row);
        $i++;
    }
    $PRINCIPAL = str_replace("{BLOQUE_NOTICIAS_SIMILARES}", ($row), $PRINCIPAL);
    return ($PRINCIPAL);
}
function ColocaBloqueMasVistas($PRINCIPAL, $id_empresa)
{
    //Traigo el listado de Categorias por empresa
    $noticias = TraigoNoticasMasVistas($id_empresa);
    $i        = 20;
    foreach ($noticias as $unico) {
        $row .= file_get_contents("views/bloques/row_bloques_noticias.html");
        $row = str_replace("{NOMBRE}", $unico->titulo, $row);
        $row = str_replace("{ID_NOTICIA_ENCODEADA}", Encodear($unico->id), $row);
        $row = str_replace("{TOTAL_DE_CURSOS}", $unico->visitas, $row);
        $i++;
    }
    $PRINCIPAL = str_replace("{BLOQUE_MAS_VISTAS}", ($row), $PRINCIPAL);
    return ($PRINCIPAL);
}
function ColocaBloqueCategoriasNoticias($PRINCIPAL, $id_empresa)
{
    $datos_empresa = DatosEmpresa($id_empresa);
    if ($datos_empresa[0]->bloque_categorias_noticias_derecha == 1) {
        $PRINCIPAL = str_replace("{BLOQUE_CATEGORIAS_DERECHA}", "", $PRINCIPAL);
    } else {
        $PRINCIPAL = str_replace("{BLOQUE_CATEGORIAS_DERECHA}", file_get_contents("views/noticias/bloque_derecho_categorias.html"), $PRINCIPAL);
    }
    //Traigo el listado de Categorias por empresa
    $categorias = CategoriasNoticiasPorEmpresa($id_empresa);
    foreach ($categorias as $cat) {
        $row .= file_get_contents("views/bloques/row_bloques_categorias.html");
        $row = str_replace("{NOMBRE}", $cat->categoria, $row);
        $row = str_replace("{ID_CATEGORIA_ENCODEADA}", Encodear3($cat->id), $row);
        $row = str_replace("{TOTAL_DE_CURSOS}", $cat->total_noticia, $row);
    }
    $PRINCIPAL = str_replace("{BLOQUE_CATEGORIAS}", ($row), $PRINCIPAL);
    return ($PRINCIPAL);
}
function ColocaMenuSecundario($PRINCIPAL, $id_empresa)
{
    //obtengo los menus nivel 1 dado el id de la empresa
    $menus_n1 = DatosMenuNivel1DadoEmpresa($id_empresa);
    $menu     = file_get_contents("views/menu_secundario/menu_secundario.html");
    foreach ($menus_n1 as $men) {
        //por cada uno de estos, traigo los menus n2
        $menus_n2 = DatosMenuNivel2DadoNivel1($men->id);
        if ($menus_n2) {
            $n1 .= file_get_contents("views/menu_secundario/li_n1_con_n2.html");
            $n2 = "";
            foreach ($menus_n2 as $mn2) {
                $n2 .= file_get_contents("views/menu_secundario/li_n2.html");
                $n2 = str_replace("{NOMBRE_N2}", $mn2->nombre, $n2);
                if ($mn2->id_mundo > 0) {
                    $var_mundo = "&idcom=" . Encodear3($mn2->id_mundo);
                } else {
                    $var_mundo = "";
                }
                if ($mn2->link <> 0) {
                    $n2 = str_replace("{HREF_N2}", "?sw=web&niv=2&i=" . Encodear3($mn2->id) . $var_mundo, $n2);
                } else {
                    $n2 = str_replace("{HREF_N2}", "#", $n2);
                }
            }
            $n1 = str_replace("{NOMBRE}", $men->nombre, $n1);
            $n1 = str_replace("{LISTADO_LI_N2}", ($n2), $n1);
            $n1 = str_replace("{SPAN_IMAGEN}", $men->icono, $n1);
        } else {
            $n1 .= file_get_contents("views/menu_secundario/li_n1.html");
            $n1 = str_replace("{NOMBRE}", "$men->nombre", $n1);
            $n1 = str_replace("{SPAN_IMAGEN}", $men->icono, $n1);
            if ($men->link <> 0) {
                $n1 = str_replace("{HREF_N1}", "?sw=web&niv=1&i=" . Encodear3($men->id) . "&idcom=" . Encodear3($men->id_comunidad), $n1);
            } else {
                if ($men->descripcion_link) {
                    $n1 = str_replace("{HREF_N1}", $men->descripcion_link, $n1);
                } else {
                    $n1 = str_replace("{HREF_N1}", "#", $n1);
                }
            }
        }
    }
    $menu      = str_replace("{LISTADO_LI}", $n1, $menu);
    $PRINCIPAL = str_replace("{MENU_SECUNDARIO}", ($menu), $PRINCIPAL);
    return ($PRINCIPAL);
}
function ColocarEntornoEquipo($PRINCIPAL, $rut_jefe, $modalidad)
{
    if ($modalidad == "todos") {
        $PRINCIPAL     = str_replace("{ENTORNO_EQUIPO}", file_get_contents("views/miequipo/entorno_equipo.html"), $PRINCIPAL);
        $colaboradores = EsJefe($rut_jefe);
        $template_row  = file_get_contents("views/miequipo/row_equipo.html");
    } elseif ($modalidad == "todoequipo") {
        $PRINCIPAL     = str_replace("{ENTORNO_EQUIPO_TODO}", file_get_contents("views/miequipo/entorno_lideres.html"), $PRINCIPAL);
        $colaboradores = EsJefe($rut_jefe);
        $template_row  = file_get_contents("views/miequipo/row_lideres.html");
    } elseif ($modalidad == "todoequipoExcel") {
        $PRINCIPAL     = file_get_contents("views/miequipo/entorno_lideres_excel.html");
        $colaboradores = EsJefe($rut_jefe);
        $template_row  = file_get_contents("views/miequipo/row_lideres_excel.html");
    } else if ($modalidad == "lideres") {
        $PRINCIPAL         = str_replace("{ENTORNO_EQUIPO_LIDERES}", file_get_contents("views/miequipo/entorno_lideres.html"), $PRINCIPAL);
        $colaboradores     = ListadoUsuariosLideres($rut_jefe);
        $template_row      = file_get_contents("views/miequipo/row_lideres.html");
        $template_SUB1_row = file_get_contents("views/miequipo/row_sub_lideres.html");
    }
    foreach ($colaboradores as $unico) {
        //echo "modalidad $modalidad unico ".$unico->total."<br>";
        if ($modalidad == "lideres" and $unico->total == 0 and $unico->lider <> "1") {
            continue;
        }
        $row .= $template_row;
        $row = str_replace("{NOMBRE_COMPLETO}", "<span class='pad_izquierda0'>" . $unico->nombre_completo . "</span>", $row);
        $row = str_replace("{RUT}", "<span class='pad_izquierda0'>" . $unico->rut_completo . "</span>", $row);
        $row = str_replace("{EMAIL}", "<span class='pad_izquierda0'>" . $unico->email . "</span>", $row);
        $row = str_replace("{RUT_JEFE}", "<span class='pad_izquierda0'>" . $unico->rut_jefe . "</span>", $row);
        $row = str_replace("{NOMBRE_JEFE}", "<span class='pad_izquierda0'>" . $unico->nombre_jefe . "</span>", $row);
        if ($unico->total == 0) {
            $row = str_replace("{PERFIL}", "", $row);
        } else {
            $row = str_replace("{PERFIL}", "<span class='fa fa-user-plus'>", $row);
        }
        if ($unico->cargo) {
            $row = str_replace("{CARGO}", $unico->cargo, $row);
        } else {
            $row = str_replace("{CARGO}", "Sin Cargo", $row);
        }
        if ($unico->gerencia) {
            $row = str_replace("{GERENCIA}", $unico->gerencia, $row);
        } else {
            $row = str_replace("{GERENCIA}", "Sin Gerencia", $row);
        }
        //Veo en cuanta
        //Veo en cuantas accione est? dado el rut del jefe y el rut del colaborador, independiente del id del objetivo
        $total_sugerencias = UsuariosPorSugerenciaJefeYColaborador($rut_jefe, $unico->rut);
        $row               = str_replace("{NUM_ACCIONES}", count($total_sugerencias), $row);
        //SUB 1 busca colaboradores abajo de cada linea
        if ($modalidad == "todos" OR $modalidad == "todoequipo" or $modalidad == "todoequipoExcel") {
            $colaboradoresSUB1 = EsJefe($unico->rut);
        } else if ($modalidad == "lideres") {
            $colaboradoresSUB1 = ListadoUsuariosLideres($unico->rut);
        }
        foreach ($colaboradoresSUB1 as $unicoSUB1) {
            if ($modalidad == "lideres" and $unicoSUB1->total == 0 and $unicoSUB1->lider <> "1") {
                continue;
            }
            $row_SUB1 .= $template_SUB1_row;
            $row_SUB1 = str_replace("{NOMBRE_COMPLETO}", $unicoSUB1->nombre_completo, $row_SUB1);
            $row_SUB1 = str_replace("{RUT}", $unicoSUB1->rut_completo, $row_SUB1);
            $row_SUB1 = str_replace("{EMAIL}", $unicoSUB1->email, $row_SUB1);
            $row_SUB1 = str_replace("{NOMBRE_JEFE}", $unicoSUB1->nombre_jefe, $row_SUB1);
            $row .= $template_row;
            $row = str_replace("{NOMBRE_COMPLETO}", " <span class='  pad_izquierda1'>" . $unicoSUB1->nombre_completo . "</span>", $row);
            $row = str_replace("{RUT}", " <span class='  pad_izquierda1'>" . $unicoSUB1->rut_completo . "</span>", $row);
            $row = str_replace("{EMAIL}", " <span class='  pad_izquierda1'>" . $unicoSUB1->email . "</span>", $row);
            $row = str_replace("{RUT_JEFE}", " <span class='  pad_izquierda1'>" . $unicoSUB1->rut_jefe . "</span>", $row);
            $row = str_replace("{NOMBRE_JEFE}", " <span class='  pad_izquierda1'>" . $unicoSUB1->nombre_jefe . "</span>", $row);
            if ($unicoSUB1->total == 0) {
                $row = str_replace("{PERFIL}", "", $row);
            } else {
                $row = str_replace("{PERFIL}", "<span class='fa fa-user-plus'>", $row);
            }
            if ($unico->cargo) {
                $row = str_replace("{CARGO}", $unicoSUB1->cargo, $row);
            } else {
                $row = str_replace("{CARGO}", "Sin Cargo", $row);
            }
            if ($unico->gerencia) {
                $row = str_replace("{GERENCIA}", $unicoSUB1->gerencia, $row);
            } else {
                $row = str_replace("{GERENCIA}", "Sin Gerencia", $row);
            }
            $total_sugerencias = UsuariosPorSugerenciaJefeYColaborador($rut_jefe, $unicoSUB1->rut);
            $row               = str_replace("{NUM_ACCIONES}", count($total_sugerencias), $row);
            //SUB 2 busca colaboradores abajo de cada linea
            if ($modalidad == "todos" OR $modalidad == "todoequipo" or $modalidad == "todoequipoExcel") {
                $colaboradoresSUB2 = EsJefe($unicoSUB1->rut);
            } else if ($modalidad == "lideres") {
                $colaboradoresSUB2 = ListadoUsuariosLideres($unicoSUB1->rut);
            }
            foreach ($colaboradoresSUB2 as $unicoSUB2) {
                if ($modalidad == "lideres" and $unicoSUB2->total == 0 and $unicoSUB2->lider <> "1") {
                    continue;
                }
                $row .= $template_row;
                $row = str_replace("{NOMBRE_COMPLETO}", " <span class=' pad_izquierda2'>" . $unicoSUB2->nombre_completo . "</span>", $row);
                $row = str_replace("{RUT}", " <span class=' pad_izquierda2'>" . $unicoSUB2->rut_completo . "</span>", $row);
                $row = str_replace("{EMAIL}", " <span class=' pad_izquierda2'>" . $unicoSUB2->email . "</span>", $row);
                $row = str_replace("{RUT_JEFE}", " <span class=' pad_izquierda2'>" . $unicoSUB2->rut_jefe . "</span>", $row);
                $row = str_replace("{NOMBRE_JEFE}", " <span class=' pad_izquierda2'>" . $unicoSUB2->nombre_jefe . "</span>", $row);
                if ($unicoSUB2->total == 0) {
                    $row = str_replace("{PERFIL}", "", $row);
                } else {
                    $row = str_replace("{PERFIL}", "<span class='fa fa-user-plus'>", $row);
                }
                if ($unicoSUB2->cargo) {
                    $row = str_replace("{CARGO}", $unicoSUB2->cargo, $row);
                } else {
                    $row = str_replace("{CARGO}", "Sin Cargo", $row);
                }
                if ($unicoSUB2->gerencia) {
                    $row = str_replace("{GERENCIA}", $unicoSUB2->gerencia, $row);
                } else {
                    $row = str_replace("{GERENCIA}", "Sin Gerencia", $row);
                }
                $total_sugerencias = UsuariosPorSugerenciaJefeYColaborador($rut_jefe, $unicoSUB2->rut);
                $row               = str_replace("{NUM_ACCIONES}", count($total_sugerencias), $row);
                //SUB 3 busca colaboradores abajo de cada linea
                if ($modalidad == "todos" OR $modalidad == "todoequipo" or $modalidad == "todoequipoExcel") {
                    $colaboradoresSUB3 = EsJefe($unicoSUB2->rut);
                } else if ($modalidad == "lideres") {
                    $colaboradoresSUB3 = ListadoUsuariosLideres($unicoSUB2->rut);
                }
                $colaboradoresSUB3 = EsJefe($unicoSUB2->rut);
                foreach ($colaboradoresSUB3 as $unicoSUB3) {
                    if ($modalidad == "lideres" and $unicoSUB3->total == 0 and $unicoSUB3->lider <> "1") {
                        continue;
                    }
                    $row .= $template_row;
                    $row = str_replace("{NOMBRE_COMPLETO}", " <span class=' pad_izquierda3'>" . $unicoSUB3->nombre_completo . "</span>", $row);
                    $row = str_replace("{RUT}", " <span class=' pad_izquierda3'>" . $unicoSUB3->rut_completo . "</span>", $row);
                    $row = str_replace("{EMAIL}", " <span class=' pad_izquierda3'>" . $unicoSUB3->email . "</span>", $row);
                    $row = str_replace("{RUT_JEFE}", " <span class=' pad_izquierda3'>" . $unicoSUB3->rut_jefe . "</span>", $row);
                    $row = str_replace("{NOMBRE_JEFE}", " <span class=' pad_izquierda3'>" . $unicoSUB3->nombre_jefe . "</span>", $row);
                    if ($unicoSUB3 > total == 0) {
                        $row = str_replace("{PERFIL}", "", $row);
                    } else {
                        $row = str_replace("{PERFIL}", "<span class='fa fa-user-plus'>", $row);
                    }
                    if ($unicoSUB3->cargo) {
                        $row = str_replace("{CARGO}", $unicoSUB3->cargo, $row);
                    } else {
                        $row = str_replace("{CARGO}", "Sin Cargo", $row);
                    }
                    if ($unicoSUB3->gerencia) {
                        $row = str_replace("{GERENCIA}", $unicoSUB3->gerencia, $row);
                    } else {
                        $row = str_replace("{GERENCIA}", "Sin Gerencia", $row);
                    }
                    $total_sugerencias = UsuariosPorSugerenciaJefeYColaborador($rut_jefe, $unicoSUB3->rut);
                    $row               = str_replace("{NUM_ACCIONES}", count($total_sugerencias), $row);
                    //SUB 4 busca colaboradores abajo de cada linea
                    if ($modalidad == "todos" OR $modalidad == "todoequipo" or $modalidad == "todoequipoExcel") {
                        $colaboradoresSUB4 = EsJefe($unicoSUB3->rut);
                    } else if ($modalidad == "lideres") {
                        $colaboradoresSUB4 = ListadoUsuariosLideres($unicoSUB3->rut);
                    }
                    $colaboradoresSUB4 = EsJefe($unicoSUB3->rut);
                    foreach ($colaboradoresSUB4 as $unicoSUB4) {
                        if ($modalidad == "lideres" and $unicoSUB4->total == 0 and $unicoSUB4->lider <> "1") {
                            continue;
                        }
                        $row .= $template_row;
                        $row = str_replace("{NOMBRE_COMPLETO}", " <span class=' pad_izquierda4'>" . $unicoSUB4->nombre_completo . "</span>", $row);
                        $row = str_replace("{RUT}", " <span class=' pad_izquierda4'>" . $unicoSUB4->rut_completo . "</span>", $row);
                        $row = str_replace("{EMAIL}", " <span class=' pad_izquierda4'>" . $unicoSUB4->email . "</span>", $row);
                        $row = str_replace("{RUT_JEFE}", " <span class=' pad_izquierda4'>" . $unicoSUB4->rut_jefe . "</span>", $row);
                        $row = str_replace("{NOMBRE_JEFE}", " <span class=' pad_izquierda4'>" . $unicoSUB4->nombre_jefe . "</span>", $row);
                        if ($unicoSUB4->total == 0) {
                            $row = str_replace("{PERFIL}", "", $row);
                        } else {
                            $row = str_replace("{PERFIL}", "<span class='fa fa-user-plus'>", $row);
                        }
                        if ($unicoSUB4->cargo) {
                            $row = str_replace("{CARGO}", $unicoSUB4->cargo, $row);
                        } else {
                            $row = str_replace("{CARGO}", "Sin Cargo", $row);
                        }
                        if ($unicoSUB4->gerencia) {
                            $row = str_replace("{GERENCIA}", $unicoSUB4->gerencia, $row);
                        } else {
                            $row = str_replace("{GERENCIA}", "Sin Gerencia", $row);
                        }
                        $total_sugerencias = UsuariosPorSugerenciaJefeYColaborador($rut_jefe, $unicoSUB4->rut);
                        $row               = str_replace("{NUM_ACCIONES}", count($total_sugerencias), $row);
                        //SUB 5 busca colaboradores abajo de cada linea
                        if ($modalidad == "todos" OR $modalidad == "todoequipo" or $modalidad == "todoequipoExcel") {
                            $colaboradoresSUB5 = EsJefe($unicoSUB4->rut);
                        } else if ($modalidad == "lideres") {
                            $colaboradoresSUB5 = ListadoUsuariosLideres($unicoSUB4->rut);
                        }
                        $colaboradoresSUB5 = EsJefe($unicoSUB4->rut);
                        foreach ($colaboradoresSUB5 as $unicoSUB5) {
                            if ($modalidad == "lideres" and $unicoSUB5->total == 0 and $unicoSUB5->lider <> "1") {
                                continue;
                            }
                            $row .= $template_row;
                            $row = str_replace("{NOMBRE_COMPLETO}", " <span class=' pad_izquierda5'>" . $unicoSUB5->nombre_completo . "</span>", $row);
                            $row = str_replace("{RUT}", " <span class=' pad_izquierda5'>" . $unicoSUB5->rut_completo . "</span>", $row);
                            $row = str_replace("{EMAIL}", " <span class=' pad_izquierda5'>" . $unicoSUB5->email . "</span>", $row);
                            $row = str_replace("{RUT_JEFE}", " <span class=' pad_izquierda5'>" . $unicoSUB5->rut_jefe . "</span>", $row);
                            $row = str_replace("{NOMBRE_JEFE}", " <span class=' pad_izquierda5'>" . $unicoSUB5->nombre_jefe . "</span>", $row);
                            if ($unicoSUB5->total == 0) {
                                $row = str_replace("{PERFIL}", "", $row);
                            } else {
                                $row = str_replace("{PERFIL}", "<span class='fa fa-user-plus'>", $row);
                            }
                            if ($unicoSUB5->cargo) {
                                $row = str_replace("{CARGO}", $unicoSUB5->cargo, $row);
                            } else {
                                $row = str_replace("{CARGO}", "Sin Cargo", $row);
                            }
                            if ($unicoSUB5->gerencia) {
                                $row = str_replace("{GERENCIA}", $unicoSUB5->gerencia, $row);
                            } else {
                                $row = str_replace("{GERENCIA}", "Sin Gerencia", $row);
                            }
                            $total_sugerencias = UsuariosPorSugerenciaJefeYColaborador($rut_jefe, $unicoSUB5->rut);
                            $row               = str_replace("{NUM_ACCIONES}", count($total_sugerencias), $row);
                        }
                    }
                }
            }
        }
    }
    if ($modalidad == "todoequipoExcel") {
        $PRINCIPAL = str_replace("{ROW_ENTORNO_EQUIPO}", ($row), $PRINCIPAL);
    } else {
        $PRINCIPAL = str_replace("{ROW_ENTORNO_EQUIPO}", ($row), $PRINCIPAL);
    }
    return ($PRINCIPAL);
}
function allSucursalesPorNombrePorEmpresa($buscar, $id_empresa)
{
    //$dataPersonas = allPersonasPorEmpresa($buscar, $id_empresa);
    $dataPersonas = allSucursalesPorEmpresa($buscar, $id_empresa);
    if ($dataPersonas) {
        foreach ($dataPersonas as $dataPersonas_aux) {
            echo ($dataPersonas_aux->nombre) . " " . "|" . $dataPersonas_aux->id . "\n";
        }
    } else {
        $data = 'Sucursal inexistente';
    }
    return $data;
}
function allPersonasPorNombrePorEmpresa($buscar, $id_empresa, $rut)
{
    $datos_usuario = UsuarioEnBasePersonas($rut);
    //$dataPersonas = allPersonasPorEmpresa($buscar, $id_empresa);
    $dataPersonas  = allPersonasPorEmpresa($buscar, $id_empresa, $datos_usuario[0]->gerencia);
    if ($dataPersonas) {
        foreach ($dataPersonas as $dataPersonas_aux) {
            echo ($dataPersonas_aux->nombre) . " " . ($dataPersonas_aux->apaterno) . " " . ($dataPersonas_aux->amaterno) . " " . "|" . $dataPersonas_aux->rut . "\n";
            //echo ($dataPersonas_aux->nombre)."\n";
        }
    } else {
        $data = 'No Existe este nombre';
    }
    return $data;
}
function allPersonasPorNombrePorEmpresaMP($buscar, $id_empresa)
{
    //$dataPersonas = allPersonasPorEmpresa($buscar, $id_empresa);
    $dataPersonas = allPersonasPorEmpresaMP($buscar, $id_empresa);
    if ($dataPersonas) {
        foreach ($dataPersonas as $dataPersonas_aux) {
            echo ($dataPersonas_aux->nombre) . " " . ($dataPersonas_aux->apaterno) . " " . ($dataPersonas_aux->amaterno) . " " . "|" . $dataPersonas_aux->rut . "\n";
            //echo ($dataPersonas_aux->nombre)."\n";
        }
    } else {
        $data = 'No Existe este nombre, intenta nuevamente';
    }
    return $data;
}
function allArchivosBibliotecaPorEmpresaMP($buscar, $id_empresa)
{
    //$dataPersonas = allPersonasPorEmpresa($buscar, $id_empresa);
    $dataArchivos = allArchivosBibliotecaPorEmpresaMPDATA($buscar, $id_empresa);
    if ($dataArchivos) {
        foreach ($dataArchivos as $dataArchivo) {
            echo ($dataArchivo->titulo) . " [" . ($dataArchivo->NombreSubCat) . "]\n";
            //$data=$dataArchivo;
        }
    } else {
        $data = 'No Existen archivos con este nombre, intenta nuevamente';
    }
    return $data;
}
function allPersonasPorNombrePorEmpresaMP_GOPLAY($buscar, $id_empresa)
{
    //$dataPersonas = allPersonasPorEmpresa($buscar, $id_empresa);
    $dataPersonas = allPersonasPorEmpresaMP_GOPLAY($buscar, $id_empresa);
    if ($dataPersonas) {
        foreach ($dataPersonas as $dataPersonas_aux) {
            echo ($dataPersonas_aux->nombre) . " " . ($dataPersonas_aux->apaterno) . " " . ($dataPersonas_aux->amaterno) . " " . "|" . $dataPersonas_aux->rut . "\n";
            //echo ($dataPersonas_aux->nombre)."\n";
        }
    } else {
        $data = 'No Existe este nombre, intenta nuevamente';
    }
    return $data;
}
function allPersonasPorNombre($buscar)
{
    $dataPersonas = allPersonas($buscar);
    if ($dataPersonas) {
        foreach ($dataPersonas as $dataPersonas_aux) {
            echo ($dataPersonas_aux->nombre_completo) . "|" . $dataPersonas_aux->rut . "\n";
        }
    } else {
        $data = 'No Existe este nombre';
    }
    return $data;
}
function ColocarDatosEncuesta($rut, $pagina, $id_empresa, $id_inscripcion, $tipo_alternativas, $id_objeto, $id_encuesta)
{
    $pagina_mayor = EncTraePaginaMayor($id_encuesta);
    $pagina_mayor = $pagina_mayor[0]->pagina_mayor;
    $datos_objeto = DatosObjeto($id_objeto);
    if ($id_objeto) {
        //Si viene un id de objeto, se muestra la encuesta asociada a este
        $datos_encuesta      = ObtenerEncuestaDadiIdObjeto($id_objeto);
        //print_r($datos_encuesta);
        //Verifico si la encuesta, con este objeto y con el rut, esta finalizada
        //$encuesta_finalizada=VerificoEncuestaFinalizada($datos_encuesta[0]->id, $id_empresa, $rut);
        $encuesta_finalizada = VerificoEncuestaFinalizadaConIDObjeto($datos_encuesta[0]->id, $id_empresa, $rut, $id_objeto);
        if ($encuesta_finalizada) {
            $PRINCIPAL = FuncionesTransversales(file_get_contents("views/encuesta/template_enc_sat_fin_generico.html"));
        } else {
            $PRINCIPAL = FuncionesTransversales(file_get_contents("views/encuesta/" . $datos_encuesta[0]->template . ""));
        }
    } else if ($id_encuesta && $id_inscripcion) {
        $datos_encuesta      = DDatosEncSatis($id_encuesta);
        //Aca verifico si esta finalizada la encuesta, por el rut, id encuesta
        $encuesta_finalizada = VerificoEncuestaFinalizadaPorInsc($datos_encuesta[0]->id, $id_empresa, $rut, $id_inscripcion);
        if ($encuesta_finalizada) {
            if ($id_empresa == 19) {
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/encuesta/19_template_enc_sat_fin_generico.html"));
            } else {
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/encuesta/template_enc_sat_fin_generico.html"));
            }
        } else {
            $PRINCIPAL = FuncionesTransversales(file_get_contents("views/encuesta/" . $datos_encuesta[0]->template . ""));
        }
    } else if ($id_encuesta) {
        $datos_encuesta      = DDatosEncSatis($id_encuesta);
        //Aca verifico si esta finalizada la encuesta, por el rut, id encuesta
        $encuesta_finalizada = VerificoEncuestaFinalizada($datos_encuesta[0]->id, $id_empresa, $rut);
        if ($encuesta_finalizada) {
            if ($id_empresa == 19) {
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/encuesta/19_template_enc_sat_fin_generico.html"));
            } else {
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/encuesta/template_enc_sat_fin_generico.html"));
            }
        } else {
            $PRINCIPAL = FuncionesTransversales(file_get_contents("views/encuesta/" . $datos_encuesta[0]->template . ""));
        }
    } else {
        //Por ahora, si no viene ID de Objeto, se muestra la que est? asociada a la empresa
        $datos_encuesta      = ObtenerEncuestaDadaEmpresa($id_empresa);
        //Verifico si la encuesta, con este usuario, de esta empresa est? finalizada o no.
        $encuesta_finalizada = VerificoEncuestaFinalizada($datos_encuesta[0]->id, $id_empresa, $rut);
        if ($encuesta_finalizada) {
            $PRINCIPAL = FuncionesTransversales(file_get_contents("views/encuesta/template_enc_sat_fin_generico.html"));
        } else {
            $PRINCIPAL = FuncionesTransversales(file_get_contents("views/encuesta/" . $datos_encuesta[0]->template . ""));
        }
    }
    if ($pagina == $pagina_mayor) {
        //$PRINCIPAL = str_replace("{BLOQUE_PREGUNTA_FINAL}",file_get_contents("views/encuesta/comentarios_finales.html"),$PRINCIPAL);
    } else {
        //$PRINCIPAL = str_replace("{BLOQUE_PREGUNTA_FINAL}","",$PRINCIPAL);
    }
    $PRINCIPAL = str_replace("{BLOQUE_PREGUNTA_FINAL}", "", $PRINCIPAL);
    $PRINCIPAL = str_replace("{TITULO}", $datos_encuesta[0]->titulo, $PRINCIPAL);
    $PRINCIPAL = str_replace("{DESCRIPCION}", $datos_encuesta[0]->descriptor, $PRINCIPAL);
    $PRINCIPAL = str_replace("{IMAGEHEADER}", $datos_encuesta[0]->imagenheader, $PRINCIPAL);
    $PRINCIPAL = str_replace("{ID_EMPRESA_ENCODEADA}", Encodear3($id_empresa), $PRINCIPAL);
    $PRINCIPAL = str_replace("{ID_OBJETO_ENCODEADO}", Encodear3($id_objeto), $PRINCIPAL);
    $PRINCIPAL = str_replace("{ID_OBJETIVO_ENCODEADO}", Encodear3($id_objeto), $PRINCIPAL);
    $PRINCIPAL = str_replace("{ID_INSCRIPCION_ENCODEADA}", Encodear3($id_inscripcion), $PRINCIPAL);
    //aca traigo las preguntas correspondientes
    $preguntas = EncTraigoPreguntasDadaPaginaIdEncuesta($datos_encuesta[0]->idencuesta, $pagina);
    $dimension = "";
    $muestra   = "si";
    //    print_r($preguntas);
    foreach ($preguntas as $preg) {
        $row_pregunta .= file_get_contents("views/encuesta/" . $preg->template);
        $template_opcion = file_get_contents("views/encuesta/" . $preg->template_opcion);
        if ($dimension <> $preg->iddimension) {
            if ($preg->visible == 1) {
                if ($muestra == "si") {
                    $row_pregunta = str_replace("{SUBTITULO}", file_get_contents("views/encuesta/subtitulo_solo.html"), $row_pregunta);
                    $muestra      = "no";
                } else {
                    $row_pregunta = str_replace("{SUBTITULO}", "", $row_pregunta);
                }
            } else {
                $row_pregunta = str_replace("{SUBTITULO}", file_get_contents("views/encuesta/subtitulo.html"), $row_pregunta);
            }
            //Aca traigo los encabezdos para las opciones por esta pregunta
            $opciones          = EncOpcionesDadoId($preg->idopcion);
            $html_enc_opciones = "";
            foreach ($opciones as $op) {
                $width = 100 / count($opciones);
                $html_enc_opciones .= file_get_contents("views/encuesta/td_encabezado.html");
                $html_enc_opciones = str_replace("{VALOR_WIDTH}", $width, $html_enc_opciones);
                $html_enc_opciones = str_replace("{VALOR_OPCION}", $op->opcion, $html_enc_opciones);
                //$html_enc_opciones.="<td width='".$width."%'>".$op->opcion."</td>";
            }
            $row_pregunta = str_replace("{TEXTO}", $preg->nombre_dimension, $row_pregunta);
            $row_pregunta = str_replace("{TD_CON_ENCABEZADOS}", $html_enc_opciones, $row_pregunta);
        } else {
            $row_pregunta = str_replace("{SUBTITULO}", "", $row_pregunta);
        }
        $dimension          = $preg->iddimension;
        $row_pregunta       = str_replace("{PREGUNTA1}", $preg->pregunta, $row_pregunta);
        $row_pregunta       = str_replace("{NUMERO_PREGUNTA}", $preg->idpregunta, $row_pregunta);
        //alternativas por cada pregunta
        $opciones           = EncOpcionesDadoId($preg->idopcion);
        $i                  = 1;
        $row_alternativa    = "";
        $row_Alternativa_td = "";
        //print_r($opciones);
        foreach ($opciones as $opc) {
            //$row_alternativa.=file_get_contents("views/encuesta/td_opciones_alternativas.html");
            //$row_alternativa = str_replace("{OPCION}","<input  type='radio' value='".$opc->puntaje."' name='".$preg->idpregunta."' id='".$preg->idpregunta."' class='radio1' >",$row_alternativa);
            //$row_alternativa = str_replace("{ALT_TEXTO}",$opc->opcion,$row_alternativa);
            $width_alt = 100 / count($opciones);
            $row_Alternativa_td .= file_get_contents("views/encuesta/td_opciones_alternativas.html");
            $row_Alternativa_td = str_replace("{WIDTH_ALT}", $width_alt, $row_Alternativa_td);
            $row_Alternativa_td = str_replace("{PUNTAJE_ALT}", $opc->puntaje, $row_Alternativa_td);
            $row_Alternativa_td = str_replace("{ENC_OPCION_TEXTO}", $opc->opcion, $row_Alternativa_td);
            $row_Alternativa_td = str_replace("{NAME_ALT}", $preg->idpregunta, $row_Alternativa_td);
            $row_Alternativa_td = str_replace("{ID_ALT}", $preg->idpregunta, $row_Alternativa_td);
            //$row_Alternativa_td.="<td width='".$width_alt."%'><input required style='opacity: 0; margin: 0px;' value='".$opc->puntaje."' name='".$preg->idpregunta."' id='".$preg->idpregunta."' class='radio1 checkator_source' type='radio'></td>";
            $i++;
        }
        $tiene_respuesta = TieneRespuestasPorPReguntaEncuesta($rut, $id_empresa, $id_objeto, $datos_encuesta[0]->idencuesta, $preg->idpregunta);
        //echo "<pre>";
        //print_r($tiene_respuesta);exit;
        if ($tiene_respuesta) {
            $row_Alternativa_td = str_replace("{CHECKED_ALTERNATIVA}_" . $tiene_respuesta[0]->respuesta . "}", "checked='checked'", $row_Alternativa_td);
            $row_Alternativa_td = str_replace("{CHECKED_ALTERNATIVA}_1}", "", $row_Alternativa_td);
            $row_Alternativa_td = str_replace("{CHECKED_ALTERNATIVA}_2}", "", $row_Alternativa_td);
            $row_Alternativa_td = str_replace("{CHECKED_ALTERNATIVA}_3}", "", $row_Alternativa_td);
            $row_Alternativa_td = str_replace("{CHECKED_ALTERNATIVA}_4}", "", $row_Alternativa_td);
            $row_Alternativa_td = str_replace("{CHECKED_ALTERNATIVA}_5}", "", $row_Alternativa_td);
            $row_Alternativa_td = str_replace("{CHECKED_ALTERNATIVA}_6}", "", $row_Alternativa_td);
            $row_Alternativa_td = str_replace("{CHECKED_ALTERNATIVA}_7}", "", $row_Alternativa_td);
        } else {
            $row_Alternativa_td = str_replace("{CHECKED_ALTERNATIVA}_1}", "", $row_Alternativa_td);
            $row_Alternativa_td = str_replace("{CHECKED_ALTERNATIVA}_2}", "", $row_Alternativa_td);
            $row_Alternativa_td = str_replace("{CHECKED_ALTERNATIVA}_3}", "", $row_Alternativa_td);
            $row_Alternativa_td = str_replace("{CHECKED_ALTERNATIVA}_4}", "", $row_Alternativa_td);
            $row_Alternativa_td = str_replace("{CHECKED_ALTERNATIVA}_5}", "", $row_Alternativa_td);
            $row_Alternativa_td = str_replace("{CHECKED_ALTERNATIVA}_6}", "", $row_Alternativa_td);
            $row_Alternativa_td = str_replace("{CHECKED_ALTERNATIVA}_7}", "", $row_Alternativa_td);
        }
        //$row_pregunta = str_replace("{ALTERNATIVAS}",$row_alternativa,$row_pregunta);
        $row_pregunta = str_replace("{TD_ALTERNATIVAS}", $row_Alternativa_td, $row_pregunta);
    }
    $row_pregunta .= "<br>" . file_get_contents("views/encuesta/comentarios_finales.html") . "<br>";
    $tiene_comentario          = TieneComentarioFinalEncSatisGeneral($rut, $id_empresa, $id_objeto, $datos_encuesta[0]->idencuesta);
    $row_pregunta              = str_replace("{COMENTARIO_FINAL}", $tiene_comentario[0]->comentario, $row_pregunta);
    //Aca veo si esta inscripcion, tiene relatores por sesion, si es asi, debiese traer las preguntas
    $relatores_por_inscripcion = TraeRelatoresPorInscripcion($id_empresa, $datos_objeto[0]->id_curso);
    //print_r($relatores_por_inscripcion);
    if ($relatores_por_inscripcion) {
        if ($datos_encuesta[0]->idencuesta == "13") {
            $preguntas = EncTraigoPreguntasParaRelatores();
        } else if ($datos_encuesta[0]->idencuesta == "6") {
            $preguntas = EncTraigoPreguntasParaRelatoresEnc6();
        }
        foreach ($relatores_por_inscripcion as $relator) {
            $dimension = "";
            foreach ($preguntas as $preg) {
                $row_preguntas_por_relator .= file_get_contents("views/encuesta/" . $preg->template);
                $template_opcion = file_get_contents("views/encuesta/" . $preg->template_opcion);
                if ($dimension <> $preg->iddimension) {
                    if ($preg->visible == 1) {
                        if ($muestra == "si") {
                            $row_preguntas_por_relator = str_replace("{SUBTITULO}", file_get_contents("views/encuesta/subtitulo_solo.html"), $row_preguntas_por_relator);
                            $muestra                   = "no";
                        } else {
                            $row_preguntas_por_relator = str_replace("{SUBTITULO}", "", $row_preguntas_por_relator);
                        }
                    } else {
                        $row_preguntas_por_relator = str_replace("{SUBTITULO}", file_get_contents("views/encuesta/subtitulo.html"), $row_preguntas_por_relator);
                    }
                    //Aca traigo los encabezdos para las opciones por esta pregunta
                    $opciones          = EncOpcionesDadoId($preg->idopcion);
                    $html_enc_opciones = "";
                    foreach ($opciones as $op) {
                        $width = 100 / count($opciones);
                        $html_enc_opciones .= file_get_contents("views/encuesta/td_encabezado.html");
                        $html_enc_opciones = str_replace("{VALOR_WIDTH}", $width, $html_enc_opciones);
                        $html_enc_opciones = str_replace("{VALOR_OPCION}", $op->opcion, $html_enc_opciones);
                        //$html_enc_opciones.="<td width='".$width."%'>".$op->opcion."</td>";
                    }
                    $row_preguntas_por_relator = str_replace("{TEXTO}", $preg->nombre_dimension, $row_preguntas_por_relator);
                    $row_preguntas_por_relator = str_replace("{TD_CON_ENCABEZADOS}", $html_enc_opciones, $row_preguntas_por_relator);
                } else {
                    $row_preguntas_por_relator = str_replace("{SUBTITULO}", "", $row_preguntas_por_relator);
                }
                $dimension                 = $preg->iddimension;
                $row_preguntas_por_relator = str_replace("{PREGUNTA1}", $preg->pregunta, $row_preguntas_por_relator);
                $row_preguntas_por_relator = str_replace("{NUMERO_PREGUNTA}", $preg->idpregunta, $row_preguntas_por_relator);
                //alternativas por cada pregunta
                $opciones                  = EncOpcionesDadoId($preg->idopcion);
                $i                         = 1;
                $row_alternativa           = "";
                $row_Alternativa_td        = "";
                //print_r($opciones);
                foreach ($opciones as $opc) {
                    //$row_alternativa.=file_get_contents("views/encuesta/td_opciones_alternativas.html");
                    //$row_alternativa = str_replace("{OPCION}","<input  type='radio' value='".$opc->puntaje."' name='".$preg->idpregunta."' id='".$preg->idpregunta."' class='radio1' >",$row_alternativa);
                    //$row_alternativa = str_replace("{ALT_TEXTO}",$opc->opcion,$row_alternativa);
                    $width_alt = 100 / count($opciones);
                    $row_Alternativa_td .= file_get_contents("views/encuesta/td_opciones_alternativas.html");
                    $row_Alternativa_td = str_replace("{WIDTH_ALT}", $width_alt, $row_Alternativa_td);
                    $row_Alternativa_td = str_replace("{PUNTAJE_ALT}", $opc->puntaje, $row_Alternativa_td);
                    $row_Alternativa_td = str_replace("{ENC_OPCION_TEXTO}", $opc->opcion, $row_Alternativa_td);
                    $row_Alternativa_td = str_replace("{NAME_ALT}", $preg->idpregunta . "_" . $relator->rut_relator, $row_Alternativa_td);
                    $row_Alternativa_td = str_replace("{RUT_RELATOR}", $relator->rut_relator, $row_Alternativa_td);
                    $row_Alternativa_td = str_replace("{ID_ALT}", $preg->idpregunta, $row_Alternativa_td);
                    //$row_Alternativa_td.="<td width='".$width_alt."%'><input required style='opacity: 0; margin: 0px;' value='".$opc->puntaje."' name='".$preg->idpregunta."' id='".$preg->idpregunta."' class='radio1 checkator_source' type='radio'></td>";
                    $i++;
                }
                $tiene_respuesta = TieneRespuestasPorPReguntaRelatorEncuesta($rut, $id_empresa, $id_objeto, $datos_encuesta[0]->idencuesta, $relator->rut_relator, $preg->idpregunta);
                if ($tiene_respuesta) {
                    $row_Alternativa_td = str_replace("{CHECKED_ALTERNATIVA}_" . $tiene_respuesta[0]->respuesta . "}", "checked='checked'", $row_Alternativa_td);
                    $row_Alternativa_td = str_replace("{CHECKED_ALTERNATIVA}_1}", "", $row_Alternativa_td);
                    $row_Alternativa_td = str_replace("{CHECKED_ALTERNATIVA}_2}", "", $row_Alternativa_td);
                    $row_Alternativa_td = str_replace("{CHECKED_ALTERNATIVA}_3}", "", $row_Alternativa_td);
                    $row_Alternativa_td = str_replace("{CHECKED_ALTERNATIVA}_4}", "", $row_Alternativa_td);
                    $row_Alternativa_td = str_replace("{CHECKED_ALTERNATIVA}_5}", "", $row_Alternativa_td);
                    $row_Alternativa_td = str_replace("{CHECKED_ALTERNATIVA}_6}", "", $row_Alternativa_td);
                    $row_Alternativa_td = str_replace("{CHECKED_ALTERNATIVA}_7}", "", $row_Alternativa_td);
                } else {
                    $row_Alternativa_td = str_replace("{CHECKED_ALTERNATIVA}_1}", "", $row_Alternativa_td);
                    $row_Alternativa_td = str_replace("{CHECKED_ALTERNATIVA}_2}", "", $row_Alternativa_td);
                    $row_Alternativa_td = str_replace("{CHECKED_ALTERNATIVA}_3}", "", $row_Alternativa_td);
                    $row_Alternativa_td = str_replace("{CHECKED_ALTERNATIVA}_4}", "", $row_Alternativa_td);
                    $row_Alternativa_td = str_replace("{CHECKED_ALTERNATIVA}_5}", "", $row_Alternativa_td);
                    $row_Alternativa_td = str_replace("{CHECKED_ALTERNATIVA}_6}", "", $row_Alternativa_td);
                    $row_Alternativa_td = str_replace("{CHECKED_ALTERNATIVA}_7}", "", $row_Alternativa_td);
                }
                $row_preguntas_por_relator = str_replace("{TD_ALTERNATIVAS}", $row_Alternativa_td, $row_preguntas_por_relator);
            }
            $row_preguntas_por_relator = str_replace("{NOMBRE_RELATOR}", $relator->nombre_relator, $row_preguntas_por_relator);
            $row_preguntas_por_relator .= "<br>" . file_get_contents("views/encuesta/comentarios_finales_2_preguntas.html") . "<br>";
            $tiene_comentario          = TieneComentarioFinalEncSatisPorRelator($rut, $id_empresa, $id_objeto, $datos_encuesta[0]->idencuesta, $relator->rut_relator);
            $row_preguntas_por_relator = str_replace("{CVALOR_COMENTARIO}", $tiene_comentario[0]->comentario, $row_preguntas_por_relator);
            $row_preguntas_por_relator = str_replace("{CVALOR_COMENTARIO2}", $tiene_comentario[0]->comentario2, $row_preguntas_por_relator);
            $row_preguntas_por_relator = str_replace("{RUT_RELATOR}", $relator->rut_relator, $row_preguntas_por_relator);
            $row_preguntas_por_relator .= "<br><br>";
        }
    }
    $PRINCIPAL = str_replace("{ID_ENCUESTA_ENCODEADA}", encodear3($datos_encuesta[0]->idencuesta), $PRINCIPAL);
    $PRINCIPAL = str_replace("{LISTADO_PREGUNTAS}", $row_pregunta . "<br><br>" . $row_preguntas_por_relator, $PRINCIPAL);
    $PRINCIPAL = str_replace("{BOTON}", file_get_contents("views/encuesta/boton_siguiente.html"), $PRINCIPAL);
    $PRINCIPAL = str_replace("{ACTION_ENC}", "?sw=savEncSat", $PRINCIPAL);
    return (($PRINCIPAL));
}
function DecodearConRut($valor)
{
    $arreglo    = explode("$", $valor);
    $arreglo[0] = Decodear3($arreglo[0]);
    $arreglo[1] = Decodear3($arreglo[1]);
    $arreglo[2] = Decodear3($arreglo[2]);
    $arreglo[3] = Decodear3($arreglo[3]);
    return ($arreglo);
}
function EncodearConRut($rut, $fecha_y_hora, $id_inscripcion)
{
    $datos_usuario = UsuarioEnBasePersonasCruceEmpresa2($rut);
    $id_empresa    = $datos_usuario[0]->idempresa;
    $tokem         = $datos_usuario[0]->tokem_validacion_externo;
    $valor         = Encodear3($rut) . "$" . Encodear3($tokem) . "$" . Encodear3($fecha_y_hora) . "$" . Encodear3($id_inscripcion);
    return ($valor);
}
function ColocaBotoneraDNC($html, $valor)
{
    //Seccion para colocar la botonera 1
    $rut  = $_SESSION["user_"];
    $html = str_replace("{BOTONERA_SUPERIOR_DNC}", file_get_contents("views/dnc/botonera_superior_dnc.html"), $html);
    if ($valor == 1) {
        $html = str_replace("{PESTANA1}", "active", $html);
        $html = str_replace("{PESTANA2}", "pasive", $html);
        $html = str_replace("{PESTANA3}", "pasive", $html);
        $html = str_replace("{PESTANA4}", "pasive", $html);
    } else if ($valor == 2) {
        $html = str_replace("{PESTANA1}", "pasive", $html);
        $html = str_replace("{PESTANA2}", "active", $html);
        $html = str_replace("{PESTANA3}", "pasive", $html);
        $html = str_replace("{PESTANA4}", "pasive", $html);
    } else if ($valor == 3) {
        $html = str_replace("{PESTANA1}", "pasive", $html);
        $html = str_replace("{PESTANA2}", "pasive", $html);
        $html = str_replace("{PESTANA3}", "active", $html);
        $html = str_replace("{PESTANA4}", "pasive", $html);
    } else if ($valor == 4) {
        $html = str_replace("{PESTANA1}", "pasive", $html);
        $html = str_replace("{PESTANA2}", "pasive", $html);
        $html = str_replace("{PESTANA3}", "pasive", $html);
        $html = str_replace("{PESTANA4}", "active", $html);
    }
    return ($html);
}
function PersonasIanctivasTemporalmente($PRINCIPAL, $evaluador)
{
    $personas_inactivas = TienePersonasInactivas($evaluador);
    if ($personas_inactivas) {
        $PRINCIPAL = str_replace("{BLOQUE_PERSONA_INACTIVAS}", file_get_contents("views/sgd/entorno_inactivos.html"), $PRINCIPAL);
        foreach ($personas_inactivas as $unico) {
            $row .= file_get_contents("views/sgd/row_colaboradores_inactivos.html");
            $row = ColocaDatosUsuario($row, $unico->evaluado);
        }
        $PRINCIPAL = str_replace("{LISTADO_EVALUADOS}", $row, $PRINCIPAL);
    } else {
        $PRINCIPAL = str_replace("{BLOQUE_PERSONA_INACTIVAS}", "", $PRINCIPAL);
    }
    return ($PRINCIPAL);
}
function ObtenerDatosAvancesPorEvaluador($evaluador)
{
    $evaluados                    = EvaluadosDadoEvaluadorConDatosDeEvaluado($evaluador);
    $finalizado_individual_cont   = 0;
    $finalizado_validaciones_cont = 0;
    $finalizado_ajustes_cont      = 0;
    foreach ($evaluados as $eval) {
        $finalizado_individual = VerificaFinalizadoObjetivosIndividuales($eval->evaluado);
        if ($finalizado_individual)
            $finalizado_individual_cont++;
        $finalizado_ajustes = VerificaSiObjetivosEstanAjustados($eval->evaluado);
        if ($finalizado_ajustes)
            $finalizado_ajustes_cont++;
        $finalizado_validaciones = VerificaSiObjetivosEstanValidados($eval->evaluado);
        if ($finalizado_validaciones)
            $finalizado_validaciones_cont++;
    }
    //porcentaje proposicion Evaluados
    $arreglo[0] = number_format(($finalizado_individual_cont * 100) / count($evaluados), 0);
    //Porcentaje de finalizados ajustes
    $arreglo[1] = number_format(($finalizado_ajustes_cont * 100) / count($evaluados), 0);
    //Porcentaje de Validados
    $arreglo[2] = number_format(($finalizado_validaciones_cont * 100) / count($evaluados), 0);
    return ($arreglo);
}

function VerificaProgramaFinalizado($id_programa, $rut, $id_malla)
{
    //Primero verifico si el programa est? finalizado
    $programa_finalizado = VeProgramaFinalizado($id_programa, $rut);
    if ($programa_finalizado) {
    } else {
        //Traigo los niveles del programa, para verificar si est? finalizado o no, si es asi, inserto
        //el registro de programa finalizado
        $niveles          = NivelesDadoPrograma($id_programa);
        $nivel_finalizado = 0;
        if (count($niveles) > 0) {
            foreach ($niveles as $niv) {
                //Por cada uno verifico si est?n finalizados
                $verifica_nivel_finalizado = VerificaNivelFinalizadoDadoNivelPrograma($id_programa, $niv->id, $rut);
                if ($verifica_nivel_finalizado)
                    $nivel_finalizado++;
            }
            //Aca comparo, y si son iguales, inserto el registro de programa finalizado
            if ($nivel_finalizado == count($niveles)) {
                //Aca inserto el registro finalizado programa
                InsertaProgramaFinalizado($id_programa, $rut, $id_malla);
            }
        }
    }
}
function VerificaNivelFinalizado($id_nivel, $rut, $id_programa)
{
    $nivel_finalizado = VerificaNivelFinalizadoDadoNivelPrograma($id_programa, $id_nivel, $rut);
    if ($nivel_finalizado) {
    } else {
        //Traigo el total de cursos asociados a este nivel
        $total_cursos = CursosDadoNivel($id_nivel);
        foreach ($total_cursos as $curso_unico) {
            $curso_finalizado = VErificaCursoFinalizado($curso_unico->id, $rut);
            if ($curso_finalizado)
                $finalizado++;
        }
        if ($finalizado == count($total_cursos)) {
            //Inserto Finalizado
            InsertaNivelFinalizado($id_nivel, $rut, $id_programa);
        }
    }
}
function ArmaCronometro($id_curso, $id_evaluacion, $rut, $PRINCIPAL, $id_objeto, $id_inscripcion)
{

    $id_curso_encodeado=Encodear3($id_curso);
    $id_inscripcion_encodeado=Encodear3($id_inscripcion);
    $timestamp    = time();
    $datos_objeto = DatosObjeto($id_evaluacion);
    $id_objeto_encodeado=Encodear3($id_objeto);

    if ($datos_objeto[0]->currentorg) {
        $diff = strtotime($datos_objeto[0]->currentorg) - strtotime('TODAY'); //<-Time of countdown in seconds.  ie. 3600 = 1 hr. or 86400 = 1 day.
        //echo strtotime($datos_objeto[0]->currentorg) - strtotime('TODAY'); // 3600
    } else {
        $diff = 14400; //<-Time of countdown in seconds.  ie. 3600 = 1 hr. or 86400 = 1 day.
    }
    //MODIFICATION BELOW THIS LINE IS NOT REQUIRED.
    $hld_diff = $diff;
    if (isset($_SESSION['ts'])) {
        $slice = ($timestamp - $_SESSION['ts']);
        $diff  = $diff - $slice;
    }
    if (!isset($_SESSION['ts']) || $diff > $hld_diff || $diff < 0) {
        $diff           = $hld_diff;
        $_SESSION['ts'] = $timestamp;
    }
    //Below is demonstration of output.  Seconds could be passed to Javascript.
    $diff; //$diff holds seconds less than 3600 (1 hour);
    $hours   = floor($diff / 3600) . ' : ';
    $diff    = $diff % 3600;
    $minutes = floor($diff / 60) . ' : ';
    $diff    = $diff % 60;
    $seconds = $diff;
    //echo '<div id="timmer"></div>';
    //$PRINCIPAL = str_replace("{TIMMER}","<div id='strclock'></div><input type='text' readonly id='cronometro' name='cronometro'>",$PRINCIPAL);
?>
<?php
    $js_cronometro = '
<script type="text/javascript">
var hour = ' . floor($hours) . ';
var min = ' . floor($minutes) . ';
var sec = ' . floor($seconds) . ';

var id_curso ="'.$id_curso.'";
var id_inscripcion ="'.$id_inscripcion.'";
var id_objeto ="'.$id_objeto.'";

function doSubmit() {
//btn_submit is the name of the SUBMIT button in the form
document.f1.btn_submit.click();
}
function countdown() {
if(sec <= 0 && min > 0) {
sec = 59;
min -= 1;
}
else if(min <= 0 && sec <= 0) {
min = 0;
sec = 0;
}
else {
sec -= 1;
}
if(min <= 0 && hour > 0) {
min = 59;
hour -= 1;
}
var pat = /^[0-9]{1}$/;
sec = (pat.test(sec) == true) ? "0"+sec : sec;
min = (pat.test(min) == true) ? "0"+min : min;
hour = (pat.test(hour) == true) ? "0"+hour : hour;
document.getElementById("strclock").innerHTML = hour+":"+min+":"+sec;
document.getElementById("cronometro").value= hour+":"+min+":"+sec;
setTimeout("countdown()",1000);
//AUTO SUBMIT
if(min == 00 && sec ==00  ){
    alert("Tiempo agotado");
    location.href="?sw=detalle_cursoCap_exit";
}
}
countdown();
</script>
';
?>
<!------- JAVA SCRIPT--------->
<?php
    echo ($PRINCIPAL);
    $_SESSION["objeto_exit"]=$id_objeto;
    $_SESSION["inscripcion_exit"]=$id_inscripcion;
    $_SESSION["curso_exit"]=$id_curso;


    echo $js_cronometro;
    //print_r($_SESSION);



}
Function VerificaFotoPersonal($rut)
{
    $imagen = "img/sinfoto.png";
    $avatar=DatosAvatarTblUsuario2022($rut);
    if($avatar<>""){
        $imagen=$avatar;
    }

    return ($imagen);
}
function checkRemoteFile($url)
{
    $ch = curl_init();
    curl_setopt($ch, CURLOPT_URL, $url);
    // don't download content
    curl_setopt($ch, CURLOPT_NOBODY, 1);
    curl_setopt($ch, CURLOPT_FAILONERROR, 1);
    curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);
    if (curl_exec($ch) !== FALSE) {
        $valor = 1;
    } else {
        $valor = 0;
    }
    //echo $valor; exit();
    return $valor;
}
function ObtenerBrecha($valor, $requerido)
{
    if ($valor >= $requerido) {
        $arreglo[0] = "fa fa-circle text-success fs14 mr10";
        $arreglo[1] = "etiquetaAcreditacion etiquetaAcreditacion-acreditada";
        $arreglo[2] = "Acreditada";
        $arreglo[3] = "si";
    } else if ($valor < $requerido) {
        $arreglo[0] = "fa fa-circle text-warning fs14 mr10";
        $arreglo[1] = "etiquetaAcreditacion etiquetaAcreditacion-proceso";
        $arreglo[2] = "Brecha Media";
        $arreglo[3] = "no";
    }
    //ROJO
    //etiquetaAcreditacion etiquetaAcreditacion-noacreditada
    //fa fa-circle text-danger fs14 mr10
    return ($arreglo);
}
function CategoriaColoresResultadosEvalConductas($valor)
{
    if ($valor == 1) {
        $arreglo[0] = "etiqueta etiqueta-nivel0";
        $arreglo[1] = "Nulo";
    } else if ($valor == 2) {
        $arreglo[0] = "etiqueta etiqueta-nivel1";
        $arreglo[1] = "Inicial";
    } else if ($valor == 3) {
        $arreglo[0] = "etiqueta etiqueta-nivel2";
        $arreglo[1] = "Medio";
    } else if ($valor == 4) {
        $arreglo[0] = "etiqueta etiqueta-nivel3";
        $arreglo[1] = "Alto";
    }
    return ($arreglo);
}
function MuestraResultadosEvaluacionConducta($PRINCIPAL, $evaluador, $evaluado)
{
    $datos_evaluado     = UsuarioEnBasePersonas($evaluado);
    $cargo              = ($datos_evaluado[0]->cargo);
    $PRINCIPAL          = str_replace("{NOMBRE}", $datos_evaluado[0]->nombre_completo, $PRINCIPAL);
    $PRINCIPAL          = str_replace("{GERENCIA}", $datos_evaluado[0]->gerencia, $PRINCIPAL);
    $PRINCIPAL          = str_replace("{CARGO}", $cargo, $PRINCIPAL);
    $PRINCIPAL          = str_replace("{FOTO_COLABORADOR}", VerificaFotoPersonal($datos_evaluado[0]->rut), $PRINCIPAL);
    $objetivos          = ListadoObjetivosDnc2($evaluador, $cargo);
    $requerido          = 3;
    $cantidad_conductas = 0;
    $certificadas       = 0;
    foreach ($objetivos as $obj) {
        $respuesta = TieneRegistroRespuestaEvConduccta($evaluado, $evaluador, $obj->id);
        if ($obj->conducta1) {
            $cantidad_conductas++;
            $row .= file_get_contents("views/dnc/row_dnc6.html");
            $row              = str_replace("{NOMBRE_CONDUCTA}", $obj->conducta1, $row);
            $rangos           = CategoriaColoresResultadosEvalConductas($respuesta[0]->nota_c1);
            $row              = str_replace("{CLASS_NIVEL}", $rangos[0], $row);
            $row              = str_replace("{NIVEL}", $rangos[1], $row);
            $rangos_requerido = CategoriaColoresResultadosEvalConductas($requerido);
            $row              = str_replace("{CLASS_NIVEL_REQUERIDO}", $rangos_requerido[0], $row);
            $row              = str_replace("{NIVEL_REQUERIDO}", $rangos_requerido[1], $row);
            //Brecha
            $brecha           = ObtenerBrecha($respuesta[0]->nota_c1, $requerido);
            $row              = str_replace("{BRECHA_ICONO}", $brecha[0], $row);
            $row              = str_replace("{BRECHA_COLOR}", $brecha[1], $row);
            $row              = str_replace("{BRECHA}", $brecha[2], $row);
            if ($brecha[3] == "si")
                $certificadas++;
        }
        if ($obj->conducta2) {
            $cantidad_conductas++;
            $row .= file_get_contents("views/dnc/row_dnc6.html");
            $row              = str_replace("{NOMBRE_CONDUCTA}", $obj->conducta2, $row);
            $rangos           = CategoriaColoresResultadosEvalConductas($respuesta[0]->nota_c2);
            $row              = str_replace("{CLASS_NIVEL}", $rangos[0], $row);
            $row              = str_replace("{NIVEL}", $rangos[1], $row);
            $rangos_requerido = CategoriaColoresResultadosEvalConductas($requerido);
            $row              = str_replace("{CLASS_NIVEL_REQUERIDO}", $rangos_requerido[0], $row);
            $row              = str_replace("{NIVEL_REQUERIDO}", $rangos_requerido[1], $row);
            //Brecha
            $brecha           = ObtenerBrecha($respuesta[0]->nota_c2, $requerido);
            $row              = str_replace("{BRECHA_ICONO}", $brecha[0], $row);
            $row              = str_replace("{BRECHA_COLOR}", $brecha[1], $row);
            $row              = str_replace("{BRECHA}", $brecha[2], $row);
            if ($brecha[3] == "si")
                $certificadas++;
        }
        if ($obj->conducta3) {
            $cantidad_conductas++;
            $row .= file_get_contents("views/dnc/row_dnc6.html");
            $row              = str_replace("{NOMBRE_CONDUCTA}", $obj->conducta3, $row);
            $rangos           = CategoriaColoresResultadosEvalConductas($respuesta[0]->nota_c3);
            $row              = str_replace("{CLASS_NIVEL}", $rangos[0], $row);
            $row              = str_replace("{NIVEL}", $rangos[1], $row);
            $rangos_requerido = CategoriaColoresResultadosEvalConductas($requerido);
            $row              = str_replace("{CLASS_NIVEL_REQUERIDO}", $rangos_requerido[0], $row);
            $row              = str_replace("{NIVEL_REQUERIDO}", $rangos_requerido[1], $row);
            //Brecha
            $brecha           = ObtenerBrecha($respuesta[0]->nota_c3, $requerido);
            $row              = str_replace("{BRECHA_ICONO}", $brecha[0], $row);
            $row              = str_replace("{BRECHA_COLOR}", $brecha[1], $row);
            $row              = str_replace("{BRECHA}", $brecha[2], $row);
            if ($brecha[3] == "si")
                $certificadas++;
        }
    }
    $PRINCIPAL = str_replace("{LISTADO_CONDUCTAS_EVALUADAS}", ($row), $PRINCIPAL);
    $PRINCIPAL = str_replace("{CANTIDAD_CONDUCTAS}", $cantidad_conductas, $PRINCIPAL);
    $PRINCIPAL = str_replace("{CANTIDAD_ACREDITADAS}", $certificadas, $PRINCIPAL);
    return ($PRINCIPAL);
}
function SelectNiveleDebilidadEvalConducta($seleccionado)
{
    $alternativas = TraeDebilidadAlternativaEvConducta();
    $opciones     = "";
    foreach ($alternativas as $alt) {
        if ($alt->valor == $seleccionado) {
            $opciones .= "<option selected value='" . $alt->valor . "'>" . $alt->valor . "</option>";
        } else {
            $opciones .= "<option value='" . $alt->valor . "'>" . $alt->valor . "</option>";
        }
    }
    return ($opciones);
}
function SelectNiveleEvalConducta($seleccionado)
{
    $alternativas = TraeNivelesAlternativaEvConducta();
    $opciones     = "";
    foreach ($alternativas as $alt) {
        if ($alt->puntaje == $seleccionado) {
            $opciones .= "<option selected value='" . $alt->puntaje . "'>" . $alt->valor . "</option>";
        } else {
            $opciones .= "<option value='" . $alt->puntaje . "'>" . $alt->valor . "</option>";
        }
    }
    return ($opciones);
}
function ListadoConductasEvaluado($PRINCIPAL, $jefe, $evaluado)
{
    $datos_evaluado = UsuarioEnBasePersonas($evaluado);
    $cargo          = ($datos_evaluado[0]->cargo);
    $PRINCIPAL      = str_replace("{NOMBRE}", $datos_evaluado[0]->nombre_completo, $PRINCIPAL);
    $PRINCIPAL      = str_replace("{FOTO_COLABORADOR}", VerificaFotoPersonal($datos_evaluado[0]->rut), $PRINCIPAL);
    $PRINCIPAL      = str_replace("{GERENCIA}", $datos_evaluado[0]->gerencia, $PRINCIPAL);
    $PRINCIPAL      = str_replace("{CARGO}", $cargo, $PRINCIPAL);
    //Dado el cargo, traigo los objetivos de ests.
    //$objetivos=ListadoObjetivosDncDadoCargo($cargo);
    $objetivos      = ListadoObjetivosDnc2($jefe, $cargo);
    foreach ($objetivos as $obj) {
        if ($obj->conducta1) {
            $row .= file_get_contents("views/dnc/row_dnc5.html");
            $tiene_registro = TieneRegistroRespuestaEvConduccta($evaluado, $jefe, $obj->id);
            $row            = str_replace("{OPCIONES_NIVEL_EVALUACION}", SelectNiveleEvalConducta($tiene_registro[0]->nota_c1), $row);
            $row            = str_replace("{OPCIONES_DEBILIDAD_ALTERNATIVA}", SelectNiveleDebilidadEvalConducta($tiene_registro[0]->debilidad_c1), $row);
            $row            = str_replace("{NOMBRE_CONDUCTA}", $obj->conducta1, $row);
            $row            = str_replace("{NUMERO_CONDUCTA}", "1", $row);
        }
        if ($obj->conducta2) {
            $row .= file_get_contents("views/dnc/row_dnc5.html");
            $row = str_replace("{OPCIONES_NIVEL_EVALUACION}", SelectNiveleEvalConducta($tiene_registro[0]->nota_c2), $row);
            $row = str_replace("{OPCIONES_DEBILIDAD_ALTERNATIVA}", SelectNiveleDebilidadEvalConducta($tiene_registro[0]->debilidad_c2), $row);
            $row = str_replace("{NOMBRE_CONDUCTA}", $obj->conducta2, $row);
            $row = str_replace("{NUMERO_CONDUCTA}", "2", $row);
            $row = str_replace("SELECT_" . $obj->id . "_2_" . $tiene_registro[0]->nota_c2 . "", "selected", $row);
        }
        if ($obj->conducta3) {
            $row .= file_get_contents("views/dnc/row_dnc5.html");
            $row = str_replace("{OPCIONES_NIVEL_EVALUACION}", SelectNiveleEvalConducta($tiene_registro[0]->nota_c3), $row);
            $row = str_replace("{OPCIONES_DEBILIDAD_ALTERNATIVA}", SelectNiveleDebilidadEvalConducta($tiene_registro[0]->debilidad_c3), $row);
            $row = str_replace("{NOMBRE_CONDUCTA}", $obj->conducta3, $row);
            $row = str_replace("{NUMERO_CONDUCTA}", "3", $row);
            $row = str_replace("SELECT_" . $obj->id . "_3_" . $tiene_registro[0]->nota_c3 . "", "selected", $row);
        }
        $row = str_replace("{ID_OBJETIVO}", $obj->id, $row);
    }
    $PRINCIPAL = str_replace("{EVALUADO_ENCODEADO}", Encodear3($evaluado), $PRINCIPAL);
    $PRINCIPAL = str_replace("{EVALUADOR_ENCODEADO}", Encodear3($jefe), $PRINCIPAL);
    $PRINCIPAL = str_replace("{CARGO_ENCODEADO}", Encodear3($cargo), $PRINCIPAL);
    $PRINCIPAL = str_replace("{LISTADO_CONDUCTAS}", ($row), $PRINCIPAL);
    return ($PRINCIPAL);
}
function VerificaEvaluacionFinalizadaConducta($evaluado, $evaluador)
{
    $fin = EvaluacionFinConducta($evaluado, $evaluador);
    if ($fin) {
        $arreglo[0] = "fa fa-circle text-success fs14 mr10";
        $arreglo[1] = "Terminado";
        $arreglo[2] = file_get_contents("views/dnc/dnc4_boton_edita.html");
        $arreglo[3] = "si";
    } else {
        $arreglo[0] = "fa fa-circle text-danger fs14 mr10";
        $arreglo[1] = "Pendiente";
        $arreglo[2] = file_get_contents("views/dnc/dnc4_boton_ingresa.html");
        $arreglo[3] = "no";
    }
    return ($arreglo);
}
function ListadoColaboradoresPorJefe($PRINCIPAL, $jefe)
{
    $listado_colaboradores = EsJefe($jefe);
    $total_finalizados     = 0;
    foreach ($listado_colaboradores as $col) {
        $row .= file_get_contents("views/dnc/row_dnc4.html");
        $row    = str_replace("{NOMBRE}", $col->nombre_completo, $row);
        $row    = str_replace("{GERENCIA}", $col->gerencia, $row);
        $row    = str_replace("{CARGO}", $col->cargo, $row);
        $row    = str_replace("{FOTO_COLABORADOR}", VerificaFotoPersonal($col->rut), $row);
        $estado = VerificaEvaluacionFinalizadaConducta($col->rut, $jefe);
        if ($estado[3] == "si") {
            $total_finalizados++;
            $row = str_replace("{ETIQUETA_NOTA}", "Medio", $row);
            $row = str_replace("{CLASE_ETIQUETA_NOTA}", "etiqueta etiqueta-nivel2", $row);
        } else {
            $row = str_replace("{ETIQUETA_NOTA}", "", $row);
            $row = str_replace("{CLASE_ETIQUETA_NOTA}", "", $row);
        }
        $row = str_replace("{ICONO}", $estado[0], $row);
        $row = str_replace("{ESTADO}", $estado[1], $row);
        $row = str_replace("{OPCIONES}", $estado[2], $row);
        $row = str_replace("{EVALUADO_ENCODEADO}", Encodear3($col->rut), $row);
    }
    //Porcentaje_final=($total_finalizados*100)/count($listado_colaboradores);
    $PRINCIPAL = str_replace("{PORCENTAJE_AVANCE}", number_format(($total_finalizados * 100) / count($listado_colaboradores), 0), $PRINCIPAL);
    $PRINCIPAL = str_replace("{LISTADO_COLABORADORES}", ($row), $PRINCIPAL);
    $PRINCIPAL = str_replace("{CANTIDAD_COLABORADORES}", count($listado_colaboradores), $PRINCIPAL);
    return ($PRINCIPAL);
}
function detect()
{
    $browser         = array(
        "IE",
        "OPERA",
        "MOZILLA",
        "NETSCAPE",
        "FIREFOX",
        "SAFARI",
        "CHROME"
    );
    $os              = array(
        "WIN",
        "MAC",
        "LINUX"
    );
    # definimos unos valores por defecto para el navegador y el sistema operativo
    $info['browser'] = "OTHER";
    $info['os']      = "OTHER";
    # buscamos el navegador con su sistema operativo
    foreach ($browser as $parent) {
        $s       = strpos(strtoupper($_SERVER['HTTP_USER_AGENT']), $parent);
        $f       = $s + strlen($parent);
        $version = substr($_SERVER['HTTP_USER_AGENT'], $f, 15);
        $version = preg_replace('/[^0-9,.]/', '', $version);
        if ($s) {
            $info['browser'] = $parent;
            $info['version'] = $version;
        }
    }
    # obtenemos el sistema operativo
    foreach ($os as $val) {
        if (strpos(strtoupper($_SERVER['HTTP_USER_AGENT']), $val) !== false)
            $info['os'] = $val;
    }
    # devolvemos el array de valores
    return $info;
}
function ValidarSesion($ambiente, $id_empresas, $url_front)
{
    //echo "ValidarSesion<br> ";
    //print_r($_SESSION);
    //sleep(5);
    if ($_SESSION["user_"]) {
        //Tiene session
        //Veo si el usuario esta en la base
        $existe_usuario_en_la_base = $datos_usuario = UsuarioEnBasePersonas($_SESSION["user_"],$_SESSION["user_"]);

             if (!$existe_usuario_en_la_base) {
                $PRINCIPAL        = FuncionesTransversales(file_get_contents("" . $url_front . "/front/views/home/login.html"));
                $token_fecha_hora = Encodear3(date("Y-m-d") . " " . date("H:i:s"));
                $PRINCIPAL        = str_replace("{TOKEN_FECHA_HORA}", $token_fecha_hora, $PRINCIPAL);
                session_start();
                $_SESSION["token"] = $token_fecha_hora;
                echo $PRINCIPAL;
                exit;
            } else {
                if ($existe_usuario_en_la_base[0]->vigencia == "1") {
                    $PRINCIPAL        = FuncionesTransversales(file_get_contents("" . $url_front . "/front/views/home/login.html"));
                    $token_fecha_hora = Encodear3(date("Y-m-d") . " " . date("H:i:s"));
                    $PRINCIPAL        = str_replace("{TOKEN_FECHA_HORA}", $token_fecha_hora, $PRINCIPAL);
                    session_start();
                    $_SESSION["token"] = $token_fecha_hora;
                    echo $PRINCIPAL;
                    exit;
                }
            }



        if ($ambiente == "detnot") {
            InsertaLogSistema($_SESSION["user_"], $ambiente, $id_empresas, Decodear($_GET["id"]), "", "", "", "");
        } else if ($ambiente == "GuardaLogVideoVisto") {
            InsertaLogSistema($_SESSION["user_"], $ambiente . "_" . $_POST["tipo_video"], $id_empresas, "", "", "", "", "");
        } else if ($ambiente == "veperfil") {
            $rut = $_POST["buscarRut"];
            if (!$rut) {
                $rut = Decodear3($_GET["r"]);
            }
            InsertaLogSistema($_SESSION["user_"], $ambiente, $id_empresas, $rut, "", "", "", "");
        } else if ($ambiente == "biblioteca") {
            InsertaLogSistema($_SESSION["user_"], $ambiente, $id_empresas, $_GET["id"], $_GET["p"], "", "", "");
        } else if ($ambiente == "detalle_cursoCap") {
            InsertaLogSistema($_SESSION["user_"], $ambiente, $id_empresas, Decodear3($_GET["idc"]), "", "", "", "");
        } else if ($ambiente == "contenido") {
            InsertaLogSistema($_SESSION["user_"], $ambiente, $id_empresas, Decodear3($_GET["i"]), "", "", "", "");
        } else if ($ambiente == "web") {
            //InsertaLogSistema($_SESSION["user_"], $ambiente, $id_empresas, "", "", $_GET["i"], $_GET["i"], $_GET["niv"]);
            InsertaLogSistema($_SESSION["user_"], $ambiente, $id_empresas, $_GET["id"], $_GET["p"], "", ($_GET["niv"]), Decodear3($_GET["i"]));
        } else {
            InsertaLogSistema($_SESSION["user_"], $ambiente, $id_empresas, "", "", "", "", "");
        }
    } else {
        if ($ambiente <> "CreateNewUser" && $ambiente <> "LogEmail" && $ambiente <> "entrada_inscripcion" && $ambiente <> "entrada_inscripcion_anonima"  && $ambiente <> "entrada" && $ambiente <> "entradacl" && $ambiente <> "entradaclg" && $ambiente <> "entradaLdap" && $ambiente <> "registerac" && $ambiente <> 'chpex' && $ambiente <> 'listMejIVPH' && $ambiente <> "homeEncuesta" && $ambiente <> "help" && $ambiente <> "autoLoginRel" && $ambiente <> "SF" && $ambiente <> "go_save_data_ext" && $ambiente <> "RegistraRelator" 
        
        && $ambiente <> "checkUser" 
        && $ambiente <> "logext" 
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        && $ambiente <> "checkUserLosAndes" && $ambiente <> "checkUserTaylor" && $ambiente <> "checkUserExt" && $ambiente <> "checkUserExterno" && $ambiente <> "checkUserBci" && $ambiente <> "CheckValRec" && $ambiente <> "regis" && $ambiente <> "oco" && $ambiente <> "entradac" && $ambiente <> "sendSolicitud" && $ambiente <> "sendClave" && $ambiente <> "iex") {
            if ($ambiente == "logwatts") {
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/login.html"));
                echo $PRINCIPAL;
                exit;
            } else if ($ambiente == "loguss") {
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/login_uss.html"));
                echo $PRINCIPAL;
                exit;
            } else if ($ambiente == "logwattsv2") {
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/login_wattsv2.html"));
                echo $PRINCIPAL;
                exit;
            } else if ($ambiente == "logen") {
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/login_en.html"));
                echo $PRINCIPAL;
                exit;
            } else if ($ambiente == "logind") {
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/login_indumotora.html"));
                echo $PRINCIPAL;
                exit;
            } else if ($ambiente == "logtnt") {
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/login_tnt.html"));
                echo $PRINCIPAL;
                exit;
            } else if ($ambiente == "logtaylor") {
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/22_login_taylor.html"));
                echo $PRINCIPAL;
                exit;
            } else if ($ambiente == "logips") {
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/login_ips.html"));
                echo $PRINCIPAL;
                exit;
            } else if ($ambiente == "logutem") {
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/login_utem.html"));
                echo $PRINCIPAL;
                exit;
            } else if ($ambiente == "logsky") {
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/login_sky.html"));
                echo $PRINCIPAL;
                exit;
            } else if ($ambiente == "logpotbci") {
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/login_latam.html"));
                echo $PRINCIPAL;
                exit;
            } else if ($ambiente == "logbci") {
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/login_bci.html"));
                echo $PRINCIPAL;
                exit;
            } else if ($ambiente == "logtannerext") {
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/login_tanner_ext.html"));
                echo $PRINCIPAL;
                exit;
            } else if ($ambiente == "logbci_vota") {
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/login_bci_vota.html"));
                echo $PRINCIPAL;
                exit;
            } else if ($ambiente == "logbci_ci") {
                //$texto2="logbci_ci";
                //$texto=Encodear3($texto2);
                //echo "$texto2";
                //echo "<br>";
                //echo "$texto";
                //exit();
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/login_bci_checkin.html"));
                echo $PRINCIPAL;
                exit;
            }


            else if ($ambiente == "login_ext") {
                //unset($_SESSION);
                //session_start(); $_SESSION = array(); if (isset($_COOKIE[session_name()])) {    setcookie(session_name(), '', time()-42000, '/'); } session_destroy();
                //$ambiente=($_GET["ambiente"]);
                //$im=($_GET["im"]);
                //exit();
                //$PRINCIPAL=FuncionesTransversales(file_get_contents("views/home/login_ext.html"));
                //echo $PRINCIPAL;
                unset($_SESSION);
                session_start();
                $_SESSION = array();
                if (isset($_COOKIE[session_name()])) {
                    setcookie(session_name(), '', time() - 42000, '/');
                }
                session_destroy();
                $ambiente  = ($_GET["ambiente"]);
                $im        = ($_GET["im"]);
                $id_mp     = ($_GET["id_mp"]);
                                $sess     = ($_GET["sess"]);

                $PRINCIPAL = FuncionesTransversales(file_get_contents("" . $url_front . "/front/views/home/login_ext.html"));
                $PRINCIPAL = str_replace("{AMBIENTE}", $ambiente, $PRINCIPAL);
                $PRINCIPAL = str_replace("{IM}", $im, $PRINCIPAL);
                $PRINCIPAL = str_replace("{ID_MP}", $id_mp, $PRINCIPAL);
                                $PRINCIPAL = str_replace("{SESS}", $sess, $PRINCIPAL);

                echo $PRINCIPAL;
            }


            else if ($ambiente == "login_externo") {
                //unset($_SESSION);
                //session_start(); $_SESSION = array(); if (isset($_COOKIE[session_name()])) {    setcookie(session_name(), '', time()-42000, '/'); } session_destroy();
                //$ambiente=($_GET["ambiente"]);
                //$im=($_GET["im"]);
                //exit();
                //$PRINCIPAL=FuncionesTransversales(file_get_contents("views/home/login_ext.html"));
                //echo $PRINCIPAL;
                unset($_SESSION);
                session_start();
                $_SESSION = array();
                if (isset($_COOKIE[session_name()])) {
                    setcookie(session_name(), '', time() - 42000, '/');
                }
                session_destroy();
    $ambiente=($_GET["ambiente"]);
    $im=($_GET["im"]);
    $id_mp=($_GET["id_mp"]);
    $amb=($_GET["amb"]);
    $idcat=($_GET["idcat"]);
    $idc=($_GET["idc"]);
    $site=($_GET["site"]);
    $linkext=($_GET["linkext"]);

                $PRINCIPAL = FuncionesTransversales(file_get_contents("" . $url_front . "/front/views/home/login_externo.html"));
    $PRINCIPAL = str_replace("{AMBIENTE}", $ambiente, $PRINCIPAL);
    $PRINCIPAL = str_replace("{IM}", $im, $PRINCIPAL);
    $PRINCIPAL = str_replace("{ID_MP}", $id_mp, $PRINCIPAL);
    $PRINCIPAL = str_replace("{AMB}", $amb, $PRINCIPAL);
    $PRINCIPAL = str_replace("{IDCAT}", $idcat, $PRINCIPAL);
    $PRINCIPAL = str_replace("{IDC}", $idc, $PRINCIPAL);
    $PRINCIPAL = str_replace("{SITE}", $site, $PRINCIPAL);
    $PRINCIPAL = str_replace("{LINKEXT}", $linkext, $PRINCIPAL);
    $PRINCIPAL = str_replace("{SESS}", $sess, $PRINCIPAL);

                echo ($PRINCIPAL);
            }

             else if ($ambiente == "logbci_gp") {
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/67_login.html"));
                echo $PRINCIPAL;
                exit;
            } else if ($ambiente == "logbci_norm") {
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/69_login.html"));
                echo $PRINCIPAL;
                exit;
            } else if ($ambiente == "logbci_reci") {
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/70_login.html"));
                echo $PRINCIPAL;
                exit;
            } else if ($ambiente == "logbci_escuela") {
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/70_login_escuela.html"));
                echo $PRINCIPAL;
                exit;
            } else if ($ambiente == "logbci_lid") {
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/71_login.html"));
                echo $PRINCIPAL;
                exit;
            } else if ($ambiente == "logbchile") {
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/72_login.html"));
                echo $PRINCIPAL;
                exit;
            } else if ($ambiente == "logbci_edfin") {
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/72_login_bci_edfin.html"));
                echo $PRINCIPAL;
                exit;
            } else if ($ambiente == "logbci_cir") {
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/login_bci_checkin_relator.html"));
                echo $PRINCIPAL;
                exit;
            } else if ($ambiente == "logbci_ffvv") {
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/62_login_ffvv.html"));
                echo $PRINCIPAL;
                exit;
            } else if ($ambiente == "enviar_password") {
                $alert = "";
                //print_r($_POST);
                if ($_POST["email"] <> '') {
                    $arreglo = buscar_email_clave($_POST["email"]);
                    //VERIRFICA SI EMAIL EXISTE... Y BUSCO CLAVE
                    //print_r($arreglo); sleep(5);


                    $id_empresa=$arreglo[0]->id_empresa;

                    //print_r($arreglo); sleep(5);
                    if ($arreglo[0]->rut <> '' and $arreglo[0]->email <> '' and $arreglo[0]->clave <> '' and $arreglo[0]->id_empresa<>'') {


    $datosusuario            =mp_buscaDATOSPERSONAS($arreglo[0]->rut, $arreglo[0]->id_empresa);


                    if($arreglo[0]->id_empresa=='78'){

        $url_front="https://www.masconectadosbch.cl";
        $url_base="https://www.masconectadosbch.cl";
        $from="notificaciones@masconectadosbch.cl";
        $nombrefrom="M?s Conectados BCH";
        $tipo="text/html";
        $titulo1="";
        $url=$url_base;
        $texto_url="Ir a M?s Conectados BCH";
        $logo="https://masconectadosbch.cl/front/img/bch_logo_conectados_trans.jpg";
        $texto4="masconectadosbch.cl";

$titulo1="Tu clave";
$subject=" Tu clave";
$subtitulo1=($datosusuario[0]->nombre_completo).", tu clave para ingresar es<br><br> ".($arreglo[0]->clave)."";

$texto1="";

$texto2="";

$texto3="";
$texto4="<strong>Departamento Entrenamiento y Formaci?n<br>Divisi?n Personas y Organizaci?n<br>Banco de Chile</strong>";

$tipomensaje="Email_ValidacionPostulacion_usuario";
$rut=$datosusuario[0]->rut;
$key=$datosusuario[0]->rut;
$to=$datosusuario[0]->email;

//echo "jefe to $to";

//$to="rod@gop.cl";
$url=$url_base;


$nombreto=($datosusuario[0]->nombre_completo);
SendGrid_Email($to, $nombreto, $from, $nombrefrom, $tipo, $subject, $titulo1,$subtitulo1,$texto1,$url,$texto_url, $texto2, $texto3, $texto4, $logo, $id_empresa, $url, $tipomensaje, $rut, $key, "");


}
if($arreglo[0]->id_empresa=='62'){

        $url_front="https://www.mimundo.cl";
        $url_base="https://www.mimundo.cl";
        $from="notificaciones@mimundo.cl";
        $nombrefrom="Mi Mundo Tanner";
        $tipo="text/html";
        $titulo1="";
        $url=$url_base;
        $texto_url="Ir a Mi Mundo Tanner";
        $logo="https://www.mimundo.cl/front/img/tan_mundo_logo.png";
        $texto4="Mi Mundo Tanner";

$titulo1="Tu clave para Mi Mundo Tanner";
$subject=" Tu clave para Mi Mundo Tanner";
$subtitulo1=($datosusuario[0]->nombre_completo).", tu clave para ingresar a Mi Mundo Tanner es:<br><br> ".($arreglo[0]->clave)."";
$texto1="";
$texto2="";
$texto3="";
$texto4="<strong>Mi Mundo Tanner</strong>";
$tipomensaje="Email_ValidacionPostulacion_usuario";
$rut=$datosusuario[0]->rut;
$key=$datosusuario[0]->rut;
$to=$datosusuario[0]->email;
$url=$url_base;
$nombreto=($datosusuario[0]->nombre_completo);
SendGrid_Email($to, $nombreto, $from, $nombrefrom, $tipo, $subject, $titulo1,$subtitulo1,$texto1,$url,$texto_url, $texto2, $texto3, $texto4, $logo, $id_empresa, $url, $tipomensaje, $rut, $key, "");



}

if($arreglo[0]->id_empresa=='61'){

        $url_front="https://www.personasrf.cl";
        $url_base="https://www.personasrf.cl";
        $from="notificaciones@personasrf.cl";
        $nombrefrom="PersonasRF";
        $tipo="text/html";
        $titulo1="";
        $url=$url_base;
        $texto_url="Ir a PersonasRF";
        $logo="https://www.personasrf.cl/front/img/logo_empresa/rf_logoretail-Financiero-Scotiabank-Cencosud_transparent.png";
        $texto4="PersonasRF";

$titulo1="Tu clave para PersonasRF";
$subject=" Tu clave para PersonasRF";
$subtitulo1=($datosusuario[0]->nombre_completo).", tu clave para ingresar a PersonasRF es ".($arreglo[0]->clave)."";
$texto1="";
$texto2="";
$texto3="";
$texto4="<strong>PersonasRF</strong>";
$tipomensaje="Email_OlvidoClave";
$rut=$datosusuario[0]->rut;
$key=$datosusuario[0]->rut;
$to=$datosusuario[0]->email;

$url=$url_base;
$template="template_notificacion_general";

$nombreto=($datosusuario[0]->nombre_completo);
SendGrid_Email($to, $nombreto, $from, $nombrefrom, $tipo, $subject, $titulo1,$subtitulo1,$texto1,$url,$texto_url, $texto2, $texto3, $texto4, $logo, $id_empresa, $url, $tipomensaje, $rut, $key, $template);



}

                    echo '<link href="bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css">
                <br><br><br><div class="alert alert-success" role="alert">
             <center> Clave fue enviada exitosamente a tu Correo Corporativo.</center>
            </div>';



                        sleep(2);
                        echo "<script>location.href='../';</script>";



                    }

                    elseif ($arreglo[0]->rut <> '' and $arreglo[0]->email <> '' and $arreglo[0]->clave == '') {
                        $alert = "<div class='alert alert-danger' role='alert'>No tienes clave creada</div>";
                        sleep(5);
                        echo "<script>location.href='?sw=login';</script>";
                    } else {
                        $alert = "<div class='alert alert-danger' role='alert'>Credenciales Incorrectas</div>";
                        sleep(5);
                        echo "<script>location.href='?sw=login';</script>";
                    }
                }
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/gen_envia_password.html"));
                $PRINCIPAL = str_replace("{ALERTA}", $alert, $PRINCIPAL);
                echo $PRINCIPAL;
                exit;
            } else if ($ambiente == "logbci_com_mp") {
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/login_bci_com_mp.html"));
                echo $PRINCIPAL;
                exit;
            } else if ($ambiente == "logbci_capacitacion") {
                $PRINCIPAL        = FuncionesTransversales(file_get_contents("views/home/login_bci_capacitacion.html"));
                $token_fecha_hora = Encodear3(date("Y-m-d") . " " . date("H:i:s"));
                $PRINCIPAL        = str_replace("{TOKEN_FECHA_HORA}", $token_fecha_hora, $PRINCIPAL);
                session_start();
                $_SESSION["token"] = $token_fecha_hora;
                echo $PRINCIPAL;
                exit;
            } else if ($ambiente == "logbci_capacitacion_id") {
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/login_bci_capacitacion_id.html"));
                echo $PRINCIPAL;
                exit;
            } else if ($ambiente == "logbci_product") {
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/login_bci_productivizate.html"));
                echo $PRINCIPAL;
                exit;
            } else if ($ambiente == "logbci_mp") {
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/login_bci_mp.html"));
                echo $PRINCIPAL;
                exit;
            } else if ($ambiente == "logtabancura") {
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/login_tabancura.html"));
                echo $PRINCIPAL;
                exit;
            } else if ($ambiente == "logsantafe") {
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/login_santafe.html"));
                echo $PRINCIPAL;
                exit;
            } else if ($ambiente == "logminvest") {
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/login_minvest.html"));
                echo $PRINCIPAL;
                exit;
            }


            else if ($ambiente == "logminvestt") {
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/login_minvest_tecnico.html"));
                echo $PRINCIPAL;
                exit;
            }


            else if ($ambiente == "logminvestc") {
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/login_minvest_comercial.html"));
                echo $PRINCIPAL;
                exit;
            }



            else if ($ambiente == "loglp") {
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/login_lp.html"));
                echo $PRINCIPAL;
                exit;
            } else if ($ambiente == "logbci_viaje") {
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/login_bci_viaje.html"));
                echo $PRINCIPAL;
                exit;
            } else if ($ambiente == "logbci_revG") {
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/login_bci_revG.html"));
                echo $PRINCIPAL;
                exit;
            } else if ($ambiente == "log_los_andes_gracias") {
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/login_los_andes_gracias.html"));
                echo $PRINCIPAL;
                exit;
            } else if ($ambiente == "log_los_andes_google_G") {
                unset($_SESSION);
                session_start();
                $_SESSION = array();
                if (isset($_COOKIE[session_name()])) {
                    setcookie(session_name(), '', time() - 42000, '/');
                }
                session_destroy();
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/75_login_los_andes_google.html"));
                echo $PRINCIPAL;
            } else if ($ambiente == "logbci_sessions") {
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/login_bci_sessions.html"));
                echo $PRINCIPAL;
                exit;
            } else if ($ambiente == "logsamsonite") {
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/login_samsonite.html"));
                echo $PRINCIPAL;
                exit;
            } else if ($ambiente == "logrfsgd") {
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/login_rfsgd.html"));
                echo $PRINCIPAL;
                exit;
            } else if ($ambiente == "logrfgud") {
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/login_rf_gud.html"));
                echo $PRINCIPAL;
                exit;
            } else if ($ambiente == "log_rf_callcenter") {
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/login_rf_callcenter.html"));
                echo $PRINCIPAL;
                exit;
            } else if ($ambiente == "login_dncrf") {
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/login_dncrf.html"));
                echo $PRINCIPAL;
                exit;
            } else if ($ambiente == "logrf") {
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/login_rf.html"));
                echo $PRINCIPAL;
                exit;
            } else if ($ambiente == "logbci_rev2") {
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/login_bci_rev2.html"));
                echo $PRINCIPAL;
                exit;
            } else if ($ambiente == "logbci_escuela") {
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/71_login_escuela.html"));
                echo $PRINCIPAL;
                exit;
            } else if ($ambiente == "logbci_rev") {
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/login_bci_rev.html"));
                echo $PRINCIPAL;
                exit;
            } else if ($ambiente == "log_los_andes_google") {
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/75_login_los_andes_google.html"));
                echo $PRINCIPAL;
                exit;
            } else if ($ambiente == "log_taylor_google") {
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/22_login_taylor.html"));
                echo $PRINCIPAL;
                exit;
            } else if ($ambiente == "log_taylor_google2") {
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/22_login_taylor_G.html"));
                echo $PRINCIPAL;
                exit;
            } else if ($ambiente == "log_taylor_google_logincorrecto") {
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/22_login_taylor_G.html"));
                echo $PRINCIPAL;
                exit;
            } else if ($ambiente == "log_taylor_google_G") {
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/22_login_taylor_G.html"));
                echo $PRINCIPAL;
                exit;
            } else if ($ambiente == "logtransbank") {
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/login_transbank.html"));
                $PRINCIPAL = str_replace("{ID_EMPRESA_ENCODEADA}", Encodear3(58), $PRINCIPAL);
                echo $PRINCIPAL;
                exit;
            } else if ($ambiente == "log_vf") {
                session_start();
                $tokem     = NoCSRF::generate('tokem');
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/login_vf.html"));
                //$tokem_login=date("Y-m-d")." ".date("H:i:s");
                $PRINCIPAL = str_replace("{TOKEM_LOGIN}", $tokem, $PRINCIPAL);
                //$_SESSION["tokem_login"]=encodear3($tokem_login);
                //print_r($_SESSION);
                echo $PRINCIPAL;
                exit;
            }
            else if ($ambiente == "log_educacion_financiera_ext") {
                session_start();
                $tokem     = NoCSRF::generate('tokem');
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/login_bci_educacion_financiera_ext.html"));
                //$tokem_login=date("Y-m-d")." ".date("H:i:s");
                $PRINCIPAL = str_replace("{TOKEM_LOGIN}", $tokem, $PRINCIPAL);
                //$_SESSION["tokem_login"]=encodear3($tokem_login);
                //print_r($_SESSION);
                echo $PRINCIPAL;
                exit;
            }
            else if ($ambiente == "logwom_academy") {
                session_start();
                $tokem     = NoCSRF::generate('tokem');
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/login_wom_academy.html"));
                //$tokem_login=date("Y-m-d")." ".date("H:i:s");
                $PRINCIPAL = str_replace("{TOKEM_LOGIN}", $tokem, $PRINCIPAL);
                //$_SESSION["tokem_login"]=encodear3($tokem_login);
                //print_r($_SESSION);
                echo $PRINCIPAL;
                exit;
            } else if ($ambiente == "logbestadobeme") {
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/login_bestadobeme.html"));
                echo $PRINCIPAL;
                exit;
            } else if ($ambiente == "logbestadorrll") {
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/login_bestadorrll.html"));
                echo $PRINCIPAL;
                exit;
            } else if ($ambiente == "logbe_fen") {
                echo "    <script>         location.href='../gurupagorut/front/?sw=com_mp_home';     </script>";
                exit;
            } else if ($ambiente == "logesachs") {
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/login_esachs.html"));
                echo $PRINCIPAL;
                exit;
            } else if ($ambiente == "logultramarv2") {
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/login_ultramarv2.html"));
                echo $PRINCIPAL;
                exit;
            } else if ($ambiente == "logultramarv2_form") {
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/login_ultramarv2_form.html"));
                echo $PRINCIPAL;
                exit;
            } else if ($ambiente == "logultramarv2_form_ldap") {
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/login_ultramarv2_form_ldap.html"));
                echo $PRINCIPAL;
                exit;
            } else if ($ambiente == "loggopartners") {
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/login_gopartners.html"));
                echo $PRINCIPAL;
                exit;
            }
            else if ($ambiente == "log_encuestas") {
                    //print_r($_GET);
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/login_gopartners.html"));
                $PRINCIPAL = str_replace("{ID_ENC}", $_GET["id_enc"], $PRINCIPAL);

                $array_encuesta=datos_Encuesta_front_lb($_GET["id_enc"]);
                    //print_r($array_encuesta);
                    $PRINCIPAL = str_replace("{AMBIENTE}", $ambiente, $PRINCIPAL);
        $PRINCIPAL = str_replace("{IMAGEN}",        ($array_encuesta[0]->imagensuperior), $PRINCIPAL);
        $PRINCIPAL = str_replace("{IMAGEN_BACKGROUND}",        ($array_encuesta[0]->imageninferior), $PRINCIPAL);
        $PRINCIPAL = str_replace("{TITULO}",        ($array_encuesta[0]->titulo), $PRINCIPAL);
        $PRINCIPAL = str_replace("{DESCRIPCION}",   ($array_encuesta[0]->descripcion), $PRINCIPAL);
        $PRINCIPAL = str_replace("{DATOS}",         ($array_encuesta[0]->bajada_texto), $PRINCIPAL);

if($array_encuesta[0]->imagenlogo<>""){
    $boton="<span class='badge badge-info'>Encuesta Desactiva</span>";

}   else {
    $boton="<center><button class='button button-3d button-info nomargin' type='submit'>?Quiero Contestar!</button></center>";
}
        $PRINCIPAL = str_replace("{BOTON_INGRESAR}",   $boton, $PRINCIPAL);

                echo $PRINCIPAL;
                exit;
            } else if ($ambiente == "logwom") {
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/login_wom.html"));
                echo $PRINCIPAL;
                exit;
            } else if ($ambiente == "logsisteco") {
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/login_sisteco.html"));
                echo $PRINCIPAL;
                exit;
            } else if ($ambiente == "logstc") {
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/login_stc.html"));
                echo $PRINCIPAL;
                exit;
            } else if ($ambiente == "logfalabella") {
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/login_falabella.html"));
                echo $PRINCIPAL;
                exit;
            } else if ($ambiente == "lograbobank") {
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/login_rabobank.html"));
                echo $PRINCIPAL;
                exit;
            } else if ($ambiente == "logbestado") {
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/login_bestado.html"));
                echo $PRINCIPAL;
                exit;
            } else if ($ambiente == "logsparta") {
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/login_sparta.html"));
                echo $PRINCIPAL;
                exit;
            } else if ($ambiente == "logcmpc") {
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/login_cmpc.html"));
                echo $PRINCIPAL;
                exit;
            } else if ($ambiente == "loggw") {
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/login_gw.html"));
                echo $PRINCIPAL;
                exit;
            } else if ($ambiente == "logbtgpactual") {
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/login_btgpactual.html"));
                echo $PRINCIPAL;
                exit;
            } else if ($ambiente == "logsiga") {
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/login_siga.html"));
                $PRINCIPAL = str_replace("{ID_EMPRESA_ENCODEADA}", Encodear3(27), $PRINCIPAL);
                echo $PRINCIPAL;
                exit;
            } else if ($ambiente == "logcompasscollege") {
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/login_compasscollege.html"));
                $PRINCIPAL = str_replace("{TOK_ENCODEADA}", Encodear3("Fr45GDs"), $PRINCIPAL);
                echo $PRINCIPAL;
                exit;
            } else if ($ambiente == "logcompass") {
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/login_compass.html"));
                $PRINCIPAL = str_replace("{TOK_ENCODEADA}", Encodear3("Fr45GDs"), $PRINCIPAL);
                echo $PRINCIPAL;
                exit;
            } else if ($ambiente == "logchilquinta") {
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/login_chilquinta.html"));
                $PRINCIPAL = str_replace("{TOK_ENCODEADA}", Encodear3("Fr45GDs"), $PRINCIPAL);
                echo $PRINCIPAL;
                exit;
            } else if ($ambiente == "logsg") {
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/login_sg.html"));
                echo $PRINCIPAL;
                exit;
            } else if ($ambiente == "logcial") {
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/login_cial.html"));
                echo $PRINCIPAL;
                exit;
            } else if ($ambiente == "logmasisa") {
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/login_masisa.html"));
                echo $PRINCIPAL;
                exit;
            } else if ($ambiente == "logsonda") {
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/login_sonda.html"));
                echo $PRINCIPAL;
                exit;
            } else if ($ambiente == "logcorpvida") {
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/login_corpvida.html"));
                echo $PRINCIPAL;
                exit;
            } else if ($ambiente == "logbsa") {
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/login_bsa.html"));
                echo $PRINCIPAL;
                exit;
            } else if ($ambiente == "login_rfsgd") {
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/login_rfsgd.html"));
                echo $PRINCIPAL;
                exit;
            } else if ($ambiente == "login_rf") {
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/login_rf.html"));
                $tokem     = NoCSRF::generate('tokem');
                $PRINCIPAL = str_replace("{TOKEM_LOGIN}", $tokem, $PRINCIPAL);
                echo $PRINCIPAL;
                exit;
            } else if ($ambiente == "logintime") {
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/login_intime.html"));
                echo $PRINCIPAL;
                exit;
            } else if ($ambiente == "logultramar") {
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/login_ultramar.html"));
                echo $PRINCIPAL;
                exit;
            } else if ($ambiente == "logturbus") {
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/login_turbus.html"));
                echo $PRINCIPAL;
                exit;
            } else if ($ambiente == "logemiliana") {
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/login_emiliana.html"));
                echo $PRINCIPAL;
                exit;
            } else if ($ambiente == "logskberge") {
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/login_skberge.html"));
                echo $PRINCIPAL;
                exit;
            } else if ($ambiente == "logminvestBK") {
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/login_minvest.html"));
                echo $PRINCIPAL;
                exit;
            } else if ($ambiente == "logust") {
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/login_ust.html"));
                echo $PRINCIPAL;
                exit;
            } else if ($ambiente == "log_imperial") {
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/login_imperial.html"));
                echo $PRINCIPAL;
                exit;
            } else {
                //echo "aca";
                session_start();
                $_SESSION = array();
                if (isset($_COOKIE[session_name()])) {
                    setcookie(session_name(), '', time() - 42000, '/');
                }
                session_destroy();
                $PRINCIPAL        = FuncionesTransversales(file_get_contents("" . $url_front . "/front/views/home/login.html"));
                $token_fecha_hora = Encodear3(date("Y-m-d") . " " . date("H:i:s"));
                $PRINCIPAL        = str_replace("{TOKEN_FECHA_HORA}", $token_fecha_hora, $PRINCIPAL);
                session_start();
                $_SESSION["token"] = $token_fecha_hora;
                echo $PRINCIPAL;
                exit;
            }
        } else {
        }
    }
}
function PorcentajeAvanceIngresoObjetivosPorJefe($rut)
{
    $total_cargos      = count(ListadoCargosDistinct($rut));
    $total_finalizados = count(ListadoCargosFinalizadosPorJefe($rut));
    $porcentaje        = ($total_finalizados * 100) / $total_cargos;
    return (number_format($porcentaje, 0));
}
function ListadoObjetivosDnc($rut, $cargo, $html, $PRINCIPAL)
{
    $objetivos = ListadoObjetivosDnc2($rut, utf8_decode($cargo));
    if ($objetivos) {
        foreach ($objetivos as $obj) {
            $row .= file_get_contents("views/dnc/row_objetivos.html");
            $row = str_replace("{OBJETIVO}", ($obj->objetivo), $row);
            $row = str_replace("{CONDUCTA1}", ($obj->conducta1), $row);
            $row = str_replace("{CONDUCTA2}", ($obj->conducta2), $row);
            $row = str_replace("{CONDUCTA3}", ($obj->conducta3), $row);
            $row = str_replace("{ID_OBJETIVO_ENCODEADO}", Encodear3($obj->id), $row);
            $row = str_replace("{RUT_JEFE_ENCODEADO}", Encodear3($rut), $row);
            $row = str_replace("{CARGO_ENCODEADO}", Encodear3($cargo), $row);
        }
        $html = str_replace("{LISTA_OBJETIVOS}", ($row), $html);
    } else {
        //$html=file_get_contents("views/dnc/entorno_objetivos_ingresados_sin_finalizar.html");
        $html = "";
        //$html = str_replace("{LISTA_OBJETIVOS}","<tr><td colspan='4'>No existen objetivos ingresados para el cargo ".$cargo."</td></tr>",$html);
        $html = str_replace("{LISTA_OBJETIVOS}", "", $html);
    }
    $PRINCIPAL = str_replace("{ENTORNO_LISTADO_OBJETIVOS}", ($html), $PRINCIPAL);
    $PRINCIPAL = str_replace("{CARGO_ENCODEADO}", Encodear3($cargo), $PRINCIPAL);
    $PRINCIPAL = str_replace("{JEFE_ENCODEADO}", Encodear3($rut), $PRINCIPAL);
    $PRINCIPAL = str_replace("{CARGO}", ($cargo), $PRINCIPAL);
    return ($PRINCIPAL);
}
function FormularioObjetivoEdicion($PRINCIPAL, $rut, $id_cargo, $cargo)
{
    $PRINCIPAL      = str_replace("{CARGO}", ($cargo), $PRINCIPAL);
    $PRINCIPAL      = str_replace("{ID_CARGO_ENCODEADO}", Encodear3($id_cargo), $PRINCIPAL);
    $PRINCIPAL      = str_replace("{CARGO_ENCODEADO}", Encodear3($cargo), $PRINCIPAL);
    //Para el caaso cuando es edicion
    $datos_objetivo = DatosObjetivoDncDadoId($id_cargo);
    $PRINCIPAL      = str_replace("{OBJETIVO}", ($datos_objetivo[0]->objetivo), $PRINCIPAL);
    $PRINCIPAL      = str_replace("{CONDUCTA1}", ($datos_objetivo[0]->conducta1), $PRINCIPAL);
    $PRINCIPAL      = str_replace("{CONDUCTA2}", ($datos_objetivo[0]->conducta2), $PRINCIPAL);
    $PRINCIPAL      = str_replace("{CONDUCTA3}", ($datos_objetivo[0]->conducta3), $PRINCIPAL);
    return ($PRINCIPAL);
}
function FormularioObjetivo($PRINCIPAL, $rut, $cargo)
{
    $PRINCIPAL   = str_replace("{CARGO}", ($cargo), $PRINCIPAL);
    $PRINCIPAL   = str_replace("{CARGO_ENCODEADO}", Encodear3($cargo), $PRINCIPAL);
    $PRINCIPAL   = str_replace("{JEFE_ENCODEADO}", Encodear3($rut), $PRINCIPAL);
    //aca muestro el listado de los cumplimientos agrupados en dimensiones
    $dimensiones = TotalDimensionesDeCumplimientoDnc();
    foreach ($dimensiones as $dimen) {
        $entorno .= file_get_contents("views/dnc/entorno_cumplimientos_dimension.html");
        $entorno         = str_replace("{CLASE_DIMENSION}", $dimen->css, $entorno);
        $entorno         = str_replace("{NOMBRE_DIMENSION}", $dimen->dimension, $entorno);
        $entorno         = str_replace("{DESCRIPCION_DIMENSION}", $dimen->descripcion, $entorno);
        $comportamientos = ComportamientoDadoDimension($dimen->id);
        $i               = 1;
        $filas           = "";
        foreach ($comportamientos as $comp) {
            if ($i == 1) {
                $filas .= "<tr>";
            }
            $filas .= '<td class="textos_compo bg_accion" width="50%"><span class="color_celeste"><i class="fa fa-arrow-circle-o-right padRight10px" title="' . $comp->descripcion . '" style="cursor: pointer;"></i></span>' . $comp->comportamiento . '</td>';
            if ($i == 2) {
                $filas .= "</tr>";
                $i = 0;
            }
            $i++;
        }
        $entorno = str_replace("{LISTADO_CUMPLIMIENTOS}", $filas, $entorno);
    }
    $PRINCIPAL = str_replace("{TABLA_CUMPLIMIENTOS_EJEMPLO}", ($entorno), $PRINCIPAL);
    return ($PRINCIPAL);
}
function EstadoDncJefeCargo($rut, $cargo)
{
    $verifica_finalizado = VerificaDNCFinalizado($rut, $cargo);
    if ($verifica_finalizado) {
        $estado[0] = "fa fa-circle text-success fs14 mr10";
        $estado[1] = "Terminado";
        $estado[2] = file_get_contents("views/dnc/opciones_edita.html");
    } else {
        $estado[0] = "fa fa-circle text-danger fs14 mr10";
        $estado[1] = "Pendiente";
        $estado[2] = file_get_contents("views/dnc/opciones_ingresa.html");
    }
    return ($estado);
}
function ListadoCargosPorJefe($PRINCIPAL, $rut)
{
    //con el rut del jefe, busco con un select distinct el listado de los cargos que tiene bajo su dependencia
    $cargos = ListadoCargosDistinct($rut);
    foreach ($cargos as $unico) {
        $row .= file_get_contents("views/dnc/row_dnc2.html");
        $row    = str_replace("{NOMBRE_CARGO}", ($unico->cargo), $row);
        $row    = str_replace("{CANTIDAD_COLABORADORES}", $unico->numero_colaboradores, $row);
        $row    = str_replace("{RUT_JEFE}", $rut, $row);
        $Estado = EstadoDncJefeCargo($rut, ($unico->cargo));
        $row    = str_replace("{OPCIONES}", $Estado[2], $row);
        $row    = str_replace("{ESTADO_CARGO}", $Estado[1], $row);
        $row    = str_replace("{COLOR_ESTADO}", $Estado[0], $row);
        $row    = str_replace("{CARGO_ENCODEADO}", Encodear3(($unico->cargo)), $row);
    }
    $PRINCIPAL                     = str_replace("{LISTADO_CARGOS}", ($row), $PRINCIPAL);
    $PRINCIPAL                     = str_replace("{PORCENTAJE_AVANCE}", PorcentajeAvanceIngresoObjetivosPorJefe($rut), $PRINCIPAL);
    $total_colaboradores           = count(EsJefe($rut));
    $PRINCIPAL                     = str_replace("{CANTIDAD_COLABORADORES}", $total_colaboradores, $PRINCIPAL);
    $cantidad_objetivos_ingresados = count(DatosObjetivoDncDadoJefe($rut));
    $PRINCIPAL                     = str_replace("{CANTIDAD_OBJETIVOS_DEFINIDOS}", $cantidad_objetivos_ingresados, $PRINCIPAL);
    $PRINCIPAL                     = str_replace("{CANTIDAD_CARGOS}", count($cargos), $PRINCIPAL);
    return ($PRINCIPAL);
}
function MuestraDatosCurso($PRINCIPAL, $id_curso)
{
    $total_objetos = count(ObjetosDadoCursoSoloId($id_curso));
    $datos_curso   = DetalleCurso($id_curso);
    $PRINCIPAL     = str_replace("{NOMBRE_CURSO}", ($datos_curso[0]->nombre), $PRINCIPAL);
    $PRINCIPAL     = str_replace("{DESCRIPCION_CURSO}", ($datos_curso[0]->descripcion), $PRINCIPAL);
    $PRINCIPAL     = str_replace("{CANTIDAD_MODULOS}", $total_objetos, $PRINCIPAL);
    $PRINCIPAL     = str_replace("{ID_CURSO_ENCODEADO}", Encodear3($id_curso), $PRINCIPAL);
    return ($PRINCIPAL);
}

function BloqueBloqueBannerDinamico($html, $id_empresa, $rut)
{
    //Aca verifico si el usuario dijo no quiero ver o no mas el banner
    $vio_banner = VioBanner($rut, $id_empresa);
    if ($vio_banner) {
        $html = str_replace("{BANNER_DINAMICO}", "", $html);
        $html = str_replace("{FUNCION_ONLOAD}", "", $html);
    } else {
        $html = str_replace("{FUNCION_ONLOAD}", 'onload="SimularBoton();"', $html);
        $html = str_replace("{BANNER_DINAMICO}", file_get_contents("views/home/" . $id_empresa . "_banner_inicial.html"), $html);
    }
    return ($html);
}
function BloqueBloqueBannerDinamicoViajeBciFFVV($html, $id_empresa, $rut)
{
    //Aca verifico si el usuario dijo no quiero ver o no mas el banner
    $vio_banner = VioBanner($rut, $id_empresa);
    if ($vio_banner) {
        $html = str_replace("{BANNER_DINAMICO}", "", $html);
        $html = str_replace("{FUNCION_ONLOAD}", "", $html);
    } else {
        $html = str_replace("{FUNCION_ONLOAD}", 'onload="SimularBoton();"', $html);
        $html = str_replace("{BANNER_DINAMICO}", file_get_contents("views/home/" . $id_empresa . "_banner_inicial.html"), $html);
    }
    return ($html);
}
function BloqueFooterContenido($html)
{
    $row  = file_get_contents("views/footer_contenido/footer_contenido.html");
    $html = str_replace("{BLOQUEFOOTERCONTENIDO}", $row, $html);
    return ($html);
}
function BloqueLinks($html, $id_empresa)
{
    //traigo los links de interes de esta empresa
    $links = LinksInteresPorEmpresa($id_empresa);
    if ($links) {
        $i              = 1;
        $contador_total = 0;
        $entorno        = file_get_contents("views/link_interes/" . $id_empresa . "_entorno_links_interes.html");
        foreach ($links as $unico) {
            $contador_total++;
            if ($i == 1) {
                $rows .= "<div class='row'>";
            }
            if ($unico->link) {
                if ($unico->imagen) {
                    $rows .= file_get_contents("views/link_interes/" . $id_empresa . "_row_links_interes_conlink_imagen.html");
                } else {
                    $rows .= file_get_contents("views/link_interes/" . $id_empresa . "_row_links_interes_conlink.html");
                }
                $rows = str_replace("{LINK}", $unico->link, $rows);
                $rows = str_replace("{IMAGEN}", $unico->imagen, $rows);
                $rows = str_replace("{ID_LINK_ENCODEADO}", Encodear3($unico->id), $rows);
            } else {
                $rows .= file_get_contents("views/link_interes/" . $id_empresa . "_row_links_interes.html");
            }
            $rows = str_replace("{NOMBRE_LINK}", $unico->nombre, $rows);
            $rows = str_replace("{ICONO}", $unico->icono, $rows);
            $rows = str_replace("{DESCRIPCION}", $unico->descripcion, $rows);
            $i++;
            if ($i == 4 && $contador_total <> count($links)) {
                $rows .= "</div>";
                $i = 1;
            }
            if ($contador_total == count($links)) {
                $rows .= "</div>";
            }
        }
        $entorno = str_replace("{BLOQUE_LINKS}", ($rows), $entorno);
        //$html = str_replace("{BLOQUE_LINKS}",($rows),$entorno);
        $html    = str_replace("{BLOQUE_LINKS_INTERES}", ($entorno), $html);
    } else {
        $html = str_replace("{BLOQUE_LINKS_INTERES}", "", $html);
    }
    /*$row=file_get_contents("views/links/bloque_links.html");
    $html = str_replace("{BLOQUE_LINKS}",$row,$html);
    */
    return ($html);
}
/*function BloqueLinksInteres($html){
$row=file_get_contents("views/links/bloque_links_interes.html");
$html = str_replace("{BLOQUE_LINKS_INTERES}",$row,$html);
return($html);
}
*/
function SepararTag($tag)
{
    $valor_array = explode(',', $tag);
    $html        = '';
    foreach ($valor_array as $llave => $valores) {
        $html .= '<a href="#" rel="tag">' . $valores . '</a>';
    }
    return ($html);
}
////FIN CHIS
function ObtenerCategoriaEvalJefe($nota, $requerido)
{
    $color_bajo   = "#e44c41";
    $color_cumple = "#88cd2a";
    $color_alto   = "#6adcfa";
    if ($nota < $requerido) {
        $arreglo[0] = "Bajo";
        $arreglo[1] = $color_bajo;
    } else if ($nota == $requerido) {
        $arreglo[0] = "Cumple";
        $arreglo[1] = $color_cumple;
    } else if ($nota > $requerido) {
        $arreglo[0] = "Sobre";
        $arreglo[1] = $color_alto;
    }
    if ($requerido <= 2) {
        $arreglo[2] = $color_bajo;
        $arreglo[3] = "Bajo";
    } else if ($requerido == 3) {
        $arreglo[2] = $color_cumple;
        $arreglo[3] = "Cumple";
    } else if ($requerido > 3) {
        $arreglo[2] = $color_alto;
        $arreglo[3] = "Sobre";
    }
    //Porcentaje
    return ($arreglo);
}
function MuestraInformeEvaluacionJefatura($PRINCIPAL, $id_programa, $evaluado, $evaluador)
{
    //traigo las respuestas de las conductas de este programa, que fueron evaluadas.
    $respuestas = TieneRespuestasEvaluacionJefeCrucePRogramas($evaluado, $evaluador, $id_programa);
    $conductas  = "";
    foreach ($respuestas as $resp) {
        $conductas .= file_get_contents("views/equipo/informe/row_conductas.html");
        $conductas       = str_replace("{NOMBRE_CONDUCTA}", $resp->nombre_conducta, $conductas);
        $valor_respuesta = ObtenerCategoriaEvalJefe($resp->respuesta, $resp->requerido);
        $conductas       = str_replace("{RESULTADO_RESPUESTA}", $valor_respuesta[0], $conductas);
        $conductas       = str_replace("{COLOR1}", $valor_respuesta[1], $conductas);
        $conductas       = str_replace("{COLOR2}", $valor_respuesta[2], $conductas);
        $conductas       = str_replace("{REQUERIDO}", $valor_respuesta[3], $conductas);
    }
    $PRINCIPAL        = str_replace("{LISTADO_CONDUCTAS_EVALUADAS}", $conductas, $PRINCIPAL);
    // Obtengo Comentarios de la Evaluacion de la JEfatura
    $comentarios_eval = TieneComentarioEvaluacionJefe($evaluado, $evaluador, $id_programa);
    $PRINCIPAL        = str_replace("{COMENTARIOS_MEJORA}", ($comentarios_eval[0]->comentario), $PRINCIPAL);
    return ($PRINCIPAL);
}
function MuestraEvaluacionJefe($PRINCIPAL, $rut_evaluado, $rut_evaluador, $id_programa)
{
    $datos_programa               = DatosPrograma($id_programa);
    $alternativas                 = AlternativasDadoIdPrograma($datos_programa[0]->id_grupo_alternativa);
    $encabezado_html_alternativas = "";
    foreach ($alternativas as $alt) {
        $encabezado_html_alternativas .= '<div class="col-md-1 col-sm-1 subtitulo_skill' . $alt->estilo . '">' . ($alt->alternativa) . '</div>';
    }
    //Con el id del programa, obtengo las conductas.
    $conductas = ObtenerConductasPorPrograma($id_programa);
    $preguntas = "";
    foreach ($conductas as $cond) {
        $preguntas .= file_get_contents("views/equipo/row_pregunta.html");
        $preguntas = str_replace("{NOMBRE_PREGUNTA}", $cond->nombre, $preguntas);
        //Aca traigo las alternativas dado el programa.
        $alter     = "";
        foreach ($alternativas as $alt) {
            //Verifico, si para este evaluado, evaluador, conducta y programa tieme respuesta, si es asi, muestro el template con la alternativa chequeada.
            $tiene_respuesta = TieneRespuestasEvaluacionJefe($rut_evaluado, $rut_evaluador, $cond->id, $id_programa);
            if ($alt->puntaje == $tiene_respuesta[0]->respuesta) {
                //if($tiene_respuesta){
                $alter .= file_get_contents("views/equipo/alternativa_pregunta_eval_jefe_seleccionada.html");
            } else {
                $alter .= file_get_contents("views/equipo/alternativa_pregunta_eval_jefe.html");
            }
            if ($alt->puntaje == $cond->requerido) {
                $alter = str_replace("{STILO_REQUERIDO}", " color_requerido", $alter);
            } else {
                $alter = str_replace("{STILO_REQUERIDO}", "", $alter);
            }
            $alter = str_replace("{VALUE}", $alt->puntaje, $alter);
        }
        $preguntas = str_replace("{OPTIONS_PREGUNTA_EVALUACION_JEFE}", $alter, $preguntas);
        $preguntas = str_replace("{ID_PREGUNTA_ENCODEADO}", $cond->id, $preguntas);
    }
    //Veo si tiene comentarios de la evaluacion de la jefatura
    $comentario_eval = TieneComentarioEvaluacionJefe($rut_evaluado, $rut_evaluador, $id_programa);
    $PRINCIPAL       = str_replace("{VALUE_MEJORA}", ($comentario_eval[0]->comentario), $PRINCIPAL);
    //$PRINCIPAL = str_replace("{VALUE_MEJORA}",$comentario_eval[0]->comentario,$PRINCIPAL);
    $PRINCIPAL       = str_replace("{LISTADO_PREGUNTAS}", ($preguntas), $PRINCIPAL);
    $PRINCIPAL       = str_replace("{EVALUADO_ENCODEADO}", Encodear3($rut_evaluado), $PRINCIPAL);
    $PRINCIPAL       = str_replace("{ID_PROGRAMA_ENCODEADO}", Encodear3($id_programa), $PRINCIPAL);
    $PRINCIPAL       = str_replace("{ENCABEZADO_OPCIONES_EVAL_JEFE}", ($encabezado_html_alternativas), $PRINCIPAL);
    return ($PRINCIPAL);
}
function MiEquipo($PRINCIPAL, $rut)
{
    //Verificar si es jefe, si es que lo es, viene el listado de colaboradores.
    $es_jefe = EsJefe($rut);
    if ($es_jefe) {
        $colaborador = "";
        foreach ($es_jefe as $col) {
            $colaborador .= file_get_contents("views/equipo/row_colaboradores.html");
            $colaborador        = str_replace("{NOMBRE}", $col->nombre_completo, $colaborador);
            $colaborador        = str_replace("{RUT_EVALUADO_ENCODEADO}", Encodear3($col->rut), $colaborador);
            $colaborador        = str_replace("{CARGO}", $col->cargo, $colaborador);
            $colaborador        = str_replace("{RUT}", $col->rut, $colaborador);
            $colaborador        = str_replace("{GERENCIA}", $col->gerencia, $colaborador);
            $colaborador        = str_replace("{FOTO_PERSONA}", "img/personas/" . $col->rut . ".jpg", $colaborador);
            $colaborador        = str_replace("{FECHA_INGRESO}", $col->fecha_ingreso, $colaborador);
            $mallas_por_empresa = MallasPorEmpresa($col->id_empresa);
            //Con el criterio malla, me indica si tiene o no asignada la malla encontrada para el usuario
            $criterio_malla     = VerificaCriterioMalla($mallas_por_empresa[0]->campo, $mallas_por_empresa[0]->valor, $col->rut, $col->id_empresa);
            if ($criterio_malla) {
                //Con la malla, traigo cuales son los programas.
                $programas = ProgramasDadoMallaTraeEvaluacionesJefe($mallas_por_empresa[0]->id_malla);
                if ($programas) {
                    //aca recorro el arreglo de programas.
                    //Cada uno de estos corresponde a las evaluaciones que el jefe debe realizar sobre el evaluado.
                    $evaluaciones_ver = "";
                    foreach ($programas as $prog) {
                        $evaluaciones_ver .= 'Programa: ' . $prog->nombre . ': <input type="button" value="Acceder"   onClick="location.href=\'?sw=evJef&ie=' . Encodear3($col->rut) . '&i=' . Encodear3($prog->id) . ' \' " ><br>';
                    }
                    //$evaluaciones_ver="si";
                } else {
                    $evaluaciones_ver = "No posee evaluaciones asocidas a los programas de su malla";
                }
            } else {
                $evaluaciones_ver = "No posee evaluaciones asocidas a los programas de su malla";
            }
            $colaborador = str_replace("{EVALUACIONES}", $evaluaciones_ver, $colaborador);
        }
        $PRINCIPAL = str_replace("{LISTADOS_COLABORADORES_EQUIPO}", $colaborador, $PRINCIPAL);
    } else {
        $PRINCIPAL = str_replace("{LISTADOS_COLABORADORES_EQUIPO}", file_get_contents("views/equipo/no_es_jefe.html"), $PRINCIPAL);
    }
    return ($PRINCIPAL);
}
function segundos_tiempo($segundos)
{
    $minutos    = $segundos / 60;
    $horas      = floor($minutos / 60);
    $minutos2   = $minutos % 60;
    $segundos_2 = $segundos % 60 % 60 % 60;
    if ($minutos2 < 10)
        $minutos2 = '0' . $minutos2;
    if ($segundos_2 < 10)
        $segundos_2 = '0' . $segundos_2;
    if ($segundos < 60) {
        /* segundos */
        $resultado = round($segundos) . ' Segundos';
    } elseif ($segundos > 60 && $segundos < 3600) {
        /* minutos */
        $resultado = $minutos2 . ':' . $segundos_2 . ' Minutos';
    } else {
        /* horas */
        $resultado = $horas . ':' . $minutos2 . ':' . $segundos_2 . ' Horas';
    }
    return $resultado;
}
function EstadoObjeto($id_objeto, $rut)
{
    $estado_objeto = VerObjetoFinalizado($id_objeto, $rut);
    if ($estado_objeto) {
        $arreglo[0] = "completo.png";
        $arreglo[1] = "si";
    } else {
        $arreglo[0] = "pendiente.png";
        $arreglo[1] = "no";
    }
    return ($arreglo);
}
function my_simple_crypt_encodear($string)
{
    // you may change these values to your own
    $secret_key     = 'JVvlenf593ld0fgptu58gjd03';
    $secret_iv      = 'gp2017gp!encriptacion______!iwuio';
    $output         = false;
    $encrypt_method = "AES-256-CBC";
    $key            = hash('sha256', $secret_key);
    $iv             = substr(hash('sha256', $secret_iv), 0, 16);
    $output         = base64_encode(openssl_encrypt($string, $encrypt_method, $key, 0, $iv));
    return $output;
}
function my_simple_crypt_decodear($string)
{
    // you may change these values to your own
    $secret_key     = 'JVvlenf593ld0fgptu58gjd03';
    $secret_iv      = 'gp2017gp!encriptacion______!iwuio';
    $output         = false;
    $encrypt_method = "AES-256-CBC";
    $key            = hash('sha256', $secret_key);
    $iv             = substr(hash('sha256', $secret_iv), 0, 16);
    $output         = openssl_decrypt(base64_decode($string), $encrypt_method, $key, 0, $iv);
    return $output;
}
function Encodear3($valor)
{
    //$valor=Encodear(Encodear(Encodear($valor)));
    $valor = my_simple_crypt_encodear($valor, 'e');
    return ($valor);
}
function Encodear($valor)
{
    $valor = base64_encode(base64_encode(base64_encode($valor)));
    return ($valor);
}
function Decodear3($valor)
{
    //$valor=Decodear(Decodear(Decodear($valor)));
    //print_r($valor);
    $valor = my_simple_crypt_decodear($valor, 'd');
    return ($valor);
}
function Decodear($valor)
{
    $valor = base64_decode(base64_decode(base64_decode($valor)));
    return ($valor);
}
function FuncionesTransversales($html)
{
    $environment_sw               = $_GET["sw"];
    $rut                          = $_SESSION["user_"];
    $datos_proceso                = DatosProceso();
    $datos_empresa                = DatosEmpresa($_SESSION["id_empresa"]);
    $rut_sesion                   = $_SESSION["user_"];
    $id_empresa                   = $_SESSION["id_empresa"];
    $datos_usuario                = UsuarioEnBasePersonas($rut_sesion, "");
    //print_r($datos_usuario);
    $html                         = str_replace("{FECHAHOY}", formatearFechaCompleta(date("Y-m-d")), $html);
    $html                         = str_replace("{NOMBRE_USUARIO}", $datos_usuario[0]->nombre_completo, $html);
    $html                         = str_replace("{RUT_USUARIO_LOGUEADO}", $datos_usuario[0]->rut, $html);
    $id_tema                      = $_SESSION["tema"];
    $rand                         = rand(1, 4);
    $html = str_replace("{RANDOM}", $rand , $html);
    $ahora=date("Ymdhi");
    $html = str_replace("{AHORA}", $ahora , $html);
    //MENU SUPERIOR
    //primero veo si tiene menu nivel 0, si es si,muestro el template menu_superior_dinamico.html
    $tiene_menu_superior_dinamico = MenuNivel0PorEmpresa($_SESSION["id_empresa"], $id_tema);
    if ($tiene_menu_superior_dinamico) {
        if (file_exists("views/menu/" . $_SESSION["id_empresa"] . "_menu_superior_dinamico.html")) {
            $html = str_replace("{MENU_SUPERIOR}", file_get_contents("views/menu/" . $_SESSION["id_empresa"] . "_menu_superior_dinamico.html"), $html);
        } else {
            $html = str_replace("{MENU_SUPERIOR}", file_get_contents("views/menu/menu_superior_dinamico.html"), $html);
        }
        foreach ($tiene_menu_superior_dinamico as $unico) {
            //echo "<br>".$unico->nombre." - menu solo jefe ".$unico->solojefe;
            if ($unico->modal == 1) {
                $row_pestanas_dinamicas .= file_get_contents("views/menu/opciones_menu_dinamico_modal.html");
                $row_pestanas_dinamicas = str_replace("{BLOQUE_VENTANA_MODAL}", file_get_contents("views/pagina/" . $unico->pagina), $row_pestanas_dinamicas);
                $row_pestanas_dinamicas = str_replace("{ID}", $unico->id, $row_pestanas_dinamicas);
            } else if ($unico->blank == 1) {
                $row_pestanas_dinamicas .= file_get_contents("views/menu/opciones_menu_dinamico_blank.html");
            } else {
                if ($unico->solojefe == 1) {
                    //$esjefe            = EsJefetblUsuario($rut, $id_empresa);
                    //$esjefeResponsable = EsJefeResponsabletblUsuario($rut, $id_empresa);
                    //$esliderEjecutivo  = EsLiderEjecutivotblUsuario($rut, $id_empresa);
                    //echo "<br>solo jefe 1 esjefe $esjefe esjefeResponsable $esjefeResponsable esliderEjecutivo $esliderEjecutivo .";
                    if ($esjefe >= 1) {
                        $row_pestanas_dinamicas .= file_get_contents("views/menu/opciones_menu_dinamico.html");
                    } else if ($esjefeResponsable >= 1) {
                        $row_pestanas_dinamicas .= file_get_contents("views/menu/opciones_menu_dinamico.html");
                    }
                } elseif ($unico->solojefe == 2) {
                    //$esjefe            = EsJefetblUsuario($rut, $id_empresa);
                    //$esjefeResponsable = EsJefeResponsabletblUsuario($rut, $id_empresa);
                    //$esliderEjecutivo  = EsLiderEjecutivotblUsuario($rut, $id_empresa);
                    //echo "<br>solo jefe 2 esjefe $esjefe esjefeResponsable $esjefeResponsable esliderEjecutivo $esliderEjecutivo .";
                    if ($esliderEjecutivo >= 1) {
                        $row_pestanas_dinamicas .= file_get_contents("views/menu/opciones_menu_dinamico.html");
                    }
                } else {
                    $row_pestanas_dinamicas .= file_get_contents("views/menu/opciones_menu_dinamico.html");
                }
            }
            $row_pestanas_dinamicas = str_replace("{NOMBRE}", $unico->nombre, $row_pestanas_dinamicas);

            $row_pestanas_dinamicas = str_replace("{ICONO}", $unico->icono, $row_pestanas_dinamicas);
            $row_pestanas_dinamicas = str_replace("{A_AHREF}", $unico->descripcion_link, $row_pestanas_dinamicas);
            $row_pestanas_dinamicas = str_replace("{RUT_ENCODEADO}", Encodear3($rut_sesion), $row_pestanas_dinamicas);
        }
        $html = str_replace("{PESTANAS_DINAMICAS}", $row_pestanas_dinamicas, $html);
    } else {
        if ($datos_empresa[0]->template_menu_superior) {
            $html = str_replace("{MENU_SUPERIOR}", file_get_contents("views/menu/" . $datos_empresa[0]->template_menu_superior . ""), $html);
        } else {
            $html = str_replace("{MENU_SUPERIOR}", file_get_contents("views/menu/menu_superior.html"), $html);
        }
    }
    $html = str_replace("{IMAGEN_BANNER_FORM_CONTRATO}", $datos_empresa[0]->imagen_banner_form_contacto, $html);
    if ($datos_empresa[0]->template_footer) {
        $html = str_replace("{BLOQUEFOOTERCONTENIDO}", file_get_contents("views/footer_contenido/" . $datos_empresa[0]->template_footer . ""), $html);
    } else {
        $html = str_replace("{BLOQUEFOOTERCONTENIDO}", "", $html);
    }
    $html = str_replace("{IMAGEN_BANNER_FORM_CONTRATO}", $datos_empresa[0]->imagen_banner_form_contacto, $html);
    //MENU INFERIOR
    if ($datos_empresa[0]->template_menu_inferior) {
        $html = str_replace("{MENU_INFERIOR}", file_get_contents("views/menu/" . $datos_empresa[0]->template_menu_inferior . ""), $html);
    } else {
        $html = str_replace("{MENU_INFERIOR}", file_get_contents("views/menu/menu_inferior.html"), $html);
    }
    //$html = str_replace("{MENU_SECUNDARIO}",file_get_contents("views/menu_secundario/menu_secundario.html"),$html);
    //$html = str_replace("{MENU_INFERIOR}",file_get_contents("views/menu/menu_inferior.html"),$html);
    $html                  = str_replace("{FOOTER}", file_get_contents("views/footer.html"), $html);
    $html                  = str_replace("{MENU_DETALLE_CURSOS}", file_get_contents("views/cursos/menu_detalle_curso.html"), $html);
    //$html = str_replace("{LOGO}",file_get_contents("views/logo.html"),$html);
    $datos_empresa_holding = DatosEmpresaHolding($datos_usuario[0]->nombre_empresa_holding);
    if ($_SESSION["logo"]) {
        $html = str_replace("{ARCHIVO}", $_SESSION["logo"], $html);
    } else {
        if ($datos_empresa_holding[0]->imagen) {
            $html = str_replace("{ARCHIVO}", $datos_empresa_holding[0]->imagen, $html);
        } else {
            $html = str_replace("{ARCHIVO}", $datos_empresa[0]->archivo, $html);
        }
    }


    $html = str_replace("{HEAD}", file_get_contents("views/head.html"), $html);

    $html = str_replace("{HEAD_DINAMICO}",     file_get_contents("views/head/" . $id_empresa . "_head.html"), $html);
    $html = str_replace("{MENU_DINAMICO}",     file_get_contents("views/menu/" . $id_empresa . "_menu_principal.html"), $html);
    $html = str_replace("{FOOTER_DINAMICO}",file_get_contents("views/head/" . $id_empresa . "_footer.html"), $html);
    $html = str_replace("{PERFIL_DINAMICO}",file_get_contents("views/menu/" . $id_empresa . "_perfil_principal.html"), $html);
    //$esjefe            = EsJefeLidertblUsuario($rut, $id_empresa);
    //print_r($esjefe);
    $html = str_replace("{MENU_DINAMICO_BOTON_MI_EQUIPO}","", $html);
    $html = str_replace("{MENU_DINAMICO_BOTON_MI_EQUIPO2}","", $html);
    $html = str_replace("{MI_EQUIPO_VISTA}","", $html);
        $html = str_replace("{MENU_DINAMICO_BOTON_RECONOCE}","
        <li><a href='?sw=home_reconocer'><button class='btn btn-outline'>
        Reconocer</button></a> </li>", $html);
        $html = str_replace("{MENU_DINAMICO_BOTON_RECONOCE_LANDING}","
        <li><a href='?sw=home_reconocer_landing'><button class='btn btn-outline'>
        Reconocer</button></a> </li>", $html);
        $html = str_replace("{MENU_DINAMICO_BOTON_COMUNIDAD}","", $html);
    $html = str_replace("{MENU_DINAMICO_BOTON_RECONOCE}","", $html);
    //SGD

        $html = str_replace("{MENU_DINAMICO_BOTON_SGD}","<li><a href='?sw=evaluacion_integral'><button class='btn btn-outline'>
        Evaluaci&oacute;n Integral</button></a></li>", $html);





    $rut  = $_SESSION["user_"];
    if ($_SESSION["css"]) {
        $html = str_replace("{STYLE_DINAMICO}", "empresa/" . $_SESSION["css"], $html);
    } else {
        if ($datos_empresa_holding[0]->css) {
            $html = str_replace("{STYLE_DINAMICO}", "empresa/" . $datos_empresa_holding[0]->css, $html);
        } else if ($datos_empresa[0]->css_nombre) {
            $html = str_replace("{STYLE_DINAMICO}", "empresa/" . $datos_empresa[0]->css_nombre, $html);
        } else {
            $html = str_replace("{STYLE_DINAMICO}", "style.css", $html);
        }
    }

        $html = str_replace("{PESTANAS_CURSOS}", "", $html);


        $html = str_replace("{PESTANAS_SGD}", "", $html);


        $html = str_replace("{PESTANAS_DNC}", "", $html);


        $html = str_replace("{PESTANAS_NOTICIAS}", "", $html);


        $html = str_replace("{PESTANAS_HOME}", "", $html);

        $html = str_replace("{PESTANAS_BIBLIOTECA}", "", $html);


        $html = str_replace("{PESTANAS_GALERIA}", "", $html);


        $html = str_replace("{PESTANA_DINAMICA}", "", $html);

    $html = str_replace("{COLOR_PRIMARIO}", $datos_empresa[0]->color_primario, $html);
    if ($_SESSION["link_salir"]) {
        $html = str_replace("{LINK_SALIR}", "?sw=" . $_SESSION["link_salir"], $html);
    } else {
        $html = str_replace("{LINK_SALIR}", "../../" . $datos_empresa[0]->link_salir, $html);
    }
    $html   = str_replace("{HEAD}", file_get_contents("views/head.html"), $html);
    $html   = str_replace("{TITULO_PAGINA}", ($datos_empresa[0]->titulo_pagina), $html);
    $html   = str_replace("{ICO}", $datos_empresa[0]->ico, $html);
    $html   = str_replace("{CASE_HOME}", $datos_empresa[0]->case_home, $html);
    $html   = str_replace("{SALON_FAMA}", file_get_contents("views/cursos/salonfama.html"), $html);
    $titulo = ObtenertituloCase($environment_sw);
    $html   = str_replace("{TITULO_PARRAFO}", ($titulo[0]->titulo), $html);
    $html   = str_replace("{LOGO_EMPRESA}", ($datos_empresa[0]->archivo), $html);
    return ($html);
}

function FuncionesTransversales2($html)
{
    $environment_sw               = $_GET["sw"];
    $rut                          = $_SESSION["user_"];
    $datos_empresa                = DatosEmpresa($_SESSION["id_empresa"]);
    $rut_sesion                   = $_SESSION["user_"];
    $id_empresa                   = $_SESSION["id_empresa"];
    $html                         = str_replace("{FECHAHOY}", formatearFechaCompleta(date("Y-m-d")), $html);
    $html                         = str_replace("{NOMBRE_USUARIO}", $datos_usuario[0]->nombre_completo, $html);
    $html                         = str_replace("{RUT_USUARIO_LOGUEADO}", $datos_usuario[0]->rut, $html);
    $id_tema                      = $_SESSION["tema"];
    $rand                         = rand(1, 4);
    $html = str_replace("{RANDOM}", $rand , $html);
    $html = str_replace("{IMAGEN_BANNER_FORM_CONTRATO}", $datos_empresa[0]->imagen_banner_form_contacto, $html);
    $html                  = str_replace("{FOOTER}", file_get_contents("views/footer.html"), $html);
    $html = str_replace("{HEAD}", file_get_contents("views/head.html"), $html);
    $html = str_replace("{HEAD_DINAMICO}",     file_get_contents("views/head/" . $id_empresa . "_head.html"), $html);
    $html = str_replace("{MENU_DINAMICO}",     file_get_contents("views/menu/" . $id_empresa . "_menu_principal.html"), $html);
    $html = str_replace("{FOOTER_DINAMICO}",file_get_contents("views/head/" . $id_empresa . "_footer.html"), $html);
    $html = str_replace("{PERFIL_DINAMICO}",file_get_contents("views/menu/" . $id_empresa . "_perfil_principal.html"), $html);
    $html = str_replace("{MENU_SUPERIOR}", file_get_contents("views/menu/menu_superior.html"), $html);

    return ($html);
}
function ColocaBotonera1($html, $estado)
{
    //Seccion para colocar la botonera 1
    $rut          = $_SESSION["user_"];
    //$es_validador=EsValidador($rut);
    $es_validador = EsValidador2($rut);
    if ($es_validador) {
        if ($_SESSION["id_empresa"] == "11") {
            $html = str_replace("{BOTONERA1}", file_get_contents("views/sgd/botonera_1_validador.html"), $html);
        } else {
            if ($_SESSION["id_empresa"] == 43) {
                $html = str_replace("{BOTONERA1}", file_get_contents("views/sgd/botonera_1_turbus.html"), $html);
            } else {
                $html = str_replace("{BOTONERA1}", file_get_contents("views/sgd/botonera1/botonera_1_dinamica.html"), $html);
            }
        }
    } else {
        $tiene_evaluados = EvaluadosDadoEvaluador($rut);
        if ($tiene_evaluados) {
            if ($_SESSION["id_empresa"] == 28) {
                $html = str_replace("{BOTONERA1}", file_get_contents("views/sgd/botonera_1_chilquinta.html"), $html);
            } else if ($_SESSION["id_empresa"] == 433) {
                $html = str_replace("{BOTONERA1}", file_get_contents("views/sgd/botonera_1_turbus.html"), $html);
            } else {
                $html = str_replace("{BOTONERA1}", file_get_contents("views/sgd/botonera_1.html"), $html);
            }
        } else {
            $html = str_replace("{BOTONERA1}", file_get_contents("views/sgd/botonera_1_sin_col.html"), $html);
        }
    }
    $html = FuncionesTransversales($html);
    if ($estado == 1) {
        $html = str_replace("{ESTADO1}", "active", $html);
    } else if ($estado == 2) {
        $html = str_replace("{ESTADO2}", "active", $html);
    } else if ($estado == 3) {
        $html = str_replace("{ESTADO3}", "active", $html);
    } else if ($estado == 4) {
        $html = str_replace("{ESTADO4}", "active", $html);
    }
    $html = str_replace("{ESTADO1}", "pasive", $html);
    $html = str_replace("{ESTADO2}", "pasive", $html);
    $html = str_replace("{ESTADO3}", "pasive", $html);
    $html = str_replace("{ESTADO4}", "pasive", $html);
    return ($html);
}
function ColocaBotonera2($html, $estado_pestana, $id_proceso)
{
    $id_empresa          = $_SESSION["id_empresa"];
    $rut_session         = $_SESSION["user_"];
    $estado_pestana      = trim($estado_pestana);
    $datos_empresa       = DatosEmpresa($id_empresa);
    $sgd_version         = $datos_empresa[0]->sgd_version;
    //Esta botonera ser? por empresa, por cada empresa, traigo todos los procesos de eval
    //$procesos_evaluacion=ProcesosEvalPorEmpresa($id_empresa);
    $procesos_evaluacion = ProcesosEvalPorEmpresaPorAno($id_empresa, $_SESSION["id_proceso_anual"]);
    //Seccion para colocar la botonera 1
    //$rut=$_SESSION["user_"];
    //$tiene_evaluados=EvaluadosDadoEvaluador($rut);
    //$html = str_replace("{BOTONERA_2}",file_get_contents("views/sgd/botonera_2.html"),$html);
    //if($id_empresa==28){
    if ($sgd_version == 2) {
        if ($id_empresa == 22) {
            $html = str_replace("{BOTONERA_2}", file_get_contents("views/sgd/botonera2/botonera_dinamica_sin_bitacora.html"), $html);
        } else if ($id_empresa == 41) {
            $html = str_replace("{BOTONERA_2}", file_get_contents("views/sgd/botonera2/41_botonera_dinamica.html"), $html);
        } else if ($id_empresa == 43) {
            $html = str_replace("{BOTONERA_2}", file_get_contents("views/sgd/botonera2/41_botonera_dinamica.html"), $html);
        } else if ($id_empresa == 30) {
            $html = str_replace("{BOTONERA_2}", file_get_contents("views/sgd/botonera2/30_ botonera_dinamica.html"), $html);
        } else if ($id_empresa == 66) {
            $html = str_replace("{BOTONERA_2}", file_get_contents("views/sgd/botonera2/66_botonera_dinamica.html"), $html);
        } else if ($id_empresa == 74) {
            $html = str_replace("{BOTONERA_2}", file_get_contents("views/sgd/botonera2/74_botonera_dinamica.html"), $html);
        } else if ($id_empresa == 61) {
            $html = str_replace("{BOTONERA_2}", file_get_contents("views/sgd/botonera2/61_botonera_dinamica.html"), $html);
        } else {
            $html = str_replace("{BOTONERA_2}", file_get_contents("views/sgd/botonera2/botonera_dinamica_chilquinta.html"), $html);
        }
    } else {
        $html = str_replace("{BOTONERA_2}", file_get_contents("views/sgd/botonera2/botonera_dinamica.html"), $html);
    }
    if ($estado_pestana == "bitacora") {
        $html = str_replace("{ESTADOBITACORA}", "botonera_activo", $html);
    } else {
        $html = str_replace("{ESTADOBITACORA}", "botonera_pasivo", $html);
    }
    if ($estado_pestana == "homeHistoricos") {
        $html = str_replace("{ESTADOHISTORICOS}", "botonera_activo", $html);
    } else {
        $html = str_replace("{ESTADOHISTORICOS}", "botonera_pasivo", $html);
    }
    //Aca veo los procesos de evaluacion que tiene esta empresa, y los coloco dinamicamente en las botonera
    //$procesos_evaluacion=TraeProcesosDeEvaluacionPorEmpresa($id_empresa);
    $datos_proceso_anual = DatosProcesoAnualPorId($_SESSION["id_proceso_anual"]);
    if ($datos_proceso_anual[0]->activo == 0) {
        //$html = str_replace("{PROCESOS_EVALUACION}","<td width='70%'></td>",$html);
    }
    if ($procesos_evaluacion) {
        //$html = str_replace("{PROCESOS_EVALUACION}","si tiene",$html);
        foreach ($procesos_evaluacion as $proceso) {
            if ($proceso->calibracion == "si") {
                //Verifico si el usuario es calibrador, solo si es calibrador, se le muestra esta pesta?a
                $es_calibrador = TraeEvaluadoresPorProcesoDadoCalibrador($rut_session, $proceso->id_proceso_a_calibrar);
                if (!$es_calibrador) {
                    continue;
                }
            }
            $pestanas_evaluaciones .= file_get_contents("views/sgd/botonera2/pestanas_dinamica.html");
            if ($proceso->environment) {
                $pestanas_evaluaciones = str_replace("{TEMPALTE_HREF_TITULO}", file_get_contents("views/sgd/botonera2/pestanas_dinamica_link.html"), $pestanas_evaluaciones);
            } else {
                $pestanas_evaluaciones = str_replace("{TEMPALTE_HREF_TITULO}", file_get_contents("views/sgd/botonera2/pestanas_dinamica_alert.html"), $pestanas_evaluaciones);
                $pestanas_evaluaciones = str_replace("{TEXTO_ALERT}", ($proceso->mensaje_alert), $pestanas_evaluaciones);
            }
            $pestanas_evaluaciones = str_replace("{NOMBRE_PROCESO_EVALUACION}", ($proceso->descripcion_proceso), $pestanas_evaluaciones);
            $pestanas_evaluaciones = str_replace("{ENVIRONMENT_POR_PROCESO}", ($proceso->environment), $pestanas_evaluaciones);
            $pestanas_evaluaciones = str_replace("{ID_PROCESO_ENCODEADO}", Encodear3($proceso->id_proceso), $pestanas_evaluaciones);
            $pestanas_evaluaciones = str_replace("{ID_PROCESO}", $proceso->id_proceso, $pestanas_evaluaciones);
            if ($id_proceso == $proceso->id_proceso) {
                $pestanas_evaluaciones = str_replace("{ESTADO" . $proceso->id_proceso . "}", "botonera_activo", $pestanas_evaluaciones);
            } else {
                $pestanas_evaluaciones = str_replace("{ESTADO" . $proceso->id_proceso . "}", "botonera_pasivo", $pestanas_evaluaciones);
            }
            //Traigo las etapas por proceso,
            $etapas     = EtapasPorProceso($proceso->id_proceso);
            $etapas_row = "";
            foreach ($etapas as $etapa_unica) {
                $etapas_row .= file_get_contents("views/sgd/botonera2/etapas_por_proceso.html");
                $etapas_row = str_replace("{NOMBRE_PROCESO}", $etapa_unica->etapa, $etapas_row);
                $etapas_row = str_replace("{ETIQUETA_ICONO}", $etapa_unica->etiqueta_icono, $etapas_row);
                $etapas_row = str_replace("{ETIQUETA_PORCENTAJE}", $etapa_unica->etiqueta_porcentaje, $etapas_row);
                $etapas_row = str_replace("{ID_ETAPA}", $etapa_unica->id, $etapas_row);
                if ($etapa_unica->codigo == "evaluacion") {
                    $avance     = ColocaAvanceSemaforosProcesoEvaluacionPorEvaluador($proceso->id_proceso, $etapa_unica->id, $rut_session);
                    $etapas_row = str_replace("{POR_" . $etapa_unica->id . "}", FormatearPorcentajesSinDecimal($avance[0]) . "%", $etapas_row);
                    $etapas_row = str_replace("{ICO_" . $etapa_unica->id . "}", $avance[1], $etapas_row);
                } else {
                }
            }
            $pestanas_evaluaciones = str_replace("{LISTADO_ETAPAS}", ($etapas_row), $pestanas_evaluaciones);
        }
        $html = str_replace("{PROCESOS_EVALUACION}", $pestanas_evaluaciones, $html);
    } else {
        $html = str_replace("{PROCESOS_EVALUACION}", "", $html);
    }
    /*if($estado=='bitacora'){
    $html = str_replace("{ESTADOBITACORA}","botonera_activo",$html);
    }*/
    /*
     * else if($estado=="sgdchilquinta"){
     $html = str_replace("{ESTADO_INICIO}","botonera_activo",$html);
     }else if($estado=="homePlanes"){
     $html = str_replace("{ESTADO_PLANES}","botonera_activo",$html);
     }
     * */
    $html                 = str_replace("{ESTADO_INICIO}", "botonera_pasivo", $html);
    $html                 = str_replace("{ESTADO_PLANES}", "botonera_pasivo", $html);
    //Link para pesta?a de evaluacion intermedia
    $finalizado_evaluador = FinalizadoEvaluador($rut_session);
    if ($finalizado_evaluador) {
        $html = str_replace("{LINK_EVALUACION_EQUIPO}", "sgd2", $html);
    } else {
        $html = str_replace("{LINK_EVALUACION_EQUIPO}", "ev", $html);
    }
    //Seccion para colcoar el combobox de los historicos
    //Dada la empresa, traigo los procesos de evaluacion
    $procesos_eval      = ProcesosEvalPorEmpresaYTipoEvaluacion($id_empresa);
    $options_historicos = "";
    if ($id_empresa == 28) {
        foreach ($procesos_eval as $ev) {
            //Por cada proceso de evaluacion, veo si el Rut de la session, se encuentra dentro de ese proceso
            $id_proceso_evaluacion = $ev->id_proceso;
            $esta_en_proceso       = UsuarioSeEncuentraEnProcesoEvaluacion($_SESSION["user_"], $id_proceso_evaluacion);
            if ($esta_en_proceso) {
                //if($id_proceso==$ev->id_proceso){
                if ($_SESSION["ano_proceso_anual"] == $ev->ano) {
                    $options_historicos .= "<option selected value='" . Encodear3($ev->id_proceso) . "'>" . $ev->titulo_informes_proceso . "</option>";
                } else {
                    $options_historicos .= "<option value='" . Encodear3($ev->id_proceso) . "'>" . $ev->titulo_informes_proceso . "</option>";
                }
            }
        }
        $html = str_replace("{OPTIONS_PROCESOS}", $options_historicos, $html);
    }
    return ($html);
}
function ColocaBotoneraEntornoValidacion($html, $estado)
{
    //Seccion para colocar la botonera 1
    //$rut=$_SESSION["user_"];
    //$tiene_evaluados=EvaluadosDadoEvaluador($rut);
    $html = str_replace("{BOTONERA_2}", file_get_contents("views/sgd/botonera_validacion.html"), $html);
    if ($estado == 1) {
        $html = str_replace("{ESTADO11}", "botonera_activo", $html);
    } else if ($estado == 2) {
        $html = str_replace("{ESTADO22}", "botonera_active", $html);
    } else if ($estado == 3) {
        $html = str_replace("{ESTADO33}", "botonera_active", $html);
    } else if ($estado == 4) {
        $html = str_replace("{ESTADO44}", "botonera_active", $html);
    }
    $html = str_replace("{ESTADO11}", "botonera_pasivo", $html);
    $html = str_replace("{ESTADO22}", "botonera_pasivo", $html);
    $html = str_replace("{ESTADO33}", "botonera_pasivo", $html);
    $html = str_replace("{ESTADO44}", "botonera_pasivo", $html);
    return ($html);
}
function ColocaBotonera2MiPerfil($html, $estado)
{
    //Seccion para colocar la botonera 1
    //$rut=$_SESSION["user_"];
    //$tiene_evaluados=EvaluadosDadoEvaluador($rut);
    $html = str_replace("{BOTONERA_2}", file_get_contents("views/sgd/botonera_2_miperfil.html"), $html);
    if ($_SESSION["id_empresa"] == 30) {
        $html = str_replace("{ID_PROCESO_ENCODEADO}", Encodear3(39), $html);
    }
    if ($estado == 1) {
        $html = str_replace("{ESTADO11}", "botonera_activo", $html);
    } else if ($estado == 2) {
        $html = str_replace("{ESTADO22}", "botonera_active", $html);
    } else if ($estado == 3) {
        $html = str_replace("{ESTADO33}", "botonera_active", $html);
    } else if ($estado == 4) {
        $html = str_replace("{ESTADO44}", "botonera_active", $html);
    }
    $html = str_replace("{ESTADO11}", "botonera_pasivo", $html);
    $html = str_replace("{ESTADO22}", "botonera_pasivo", $html);
    $html = str_replace("{ESTADO33}", "botonera_pasivo", $html);
    $html = str_replace("{ESTADO44}", "botonera_pasivo", $html);
    return ($html);
}
function EnviaCorreoMensajeria($tipo_correo, $emisor, $id_empresa, $destinatario, $mensaje, $tipo_mensaje)
{
    $datos_template_correo = ObtengoTipoCorreoPorProcesoEmpresa($id_empresa, $tipo_correo);
    $datos_destinatario    = UsuarioEnBasePersonas($destinatario);
    //print_r($datos_destinatario);exit;
    $datos_emisor          = UsuarioEnBasePersonas($emisor);
    $template_correo       = file_get_contents("views/correos/" . $datos_template_correo[0]->template);
    $template_correo       = str_replace("{TITULO1}", $datos_template_correo[0]->titulo1, $template_correo);
    $template_correo       = str_replace("{TITULO2}", $datos_template_correo[0]->titulo2, $template_correo);
    $template_correo       = str_replace("{TEXTO1}", $datos_template_correo[0]->texto1, $template_correo);
    $template_correo       = str_replace("{TEXTO2}", $datos_template_correo[0]->texto2, $template_correo);
    $template_correo       = str_replace("{TEXTOLINK}", $datos_template_correo[0]->textolink, $template_correo);
    $template_correo       = str_replace("{TEXTO3}", $datos_template_correo[0]->texto3, $template_correo);
    $template_correo       = str_replace("{TEXTO4}", $datos_template_correo[0]->texto4, $template_correo);
    $template_correo       = str_replace("{TEXTOFOOTER1}", $datos_template_correo[0]->textofooter1, $template_correo);
    $template_correo       = str_replace("{TEXTOFOOTER2}", $datos_template_correo[0]->textofooter2, $template_correo);
    $template_correo       = str_replace("{NOMBREUSUARIO}", ($datos_emisor[0]->nombre) . " " . ($datos_emisor[0]->apaterno) . " " . ($datos_emisor[0]->amaterno), $template_correo);
    $template_correo       = str_replace("{texto_mensaje}", ($mensaje), $template_correo);
    $asunto_mensaje        = TraeAsuntoDeMensaje($tipo_mensaje);
    $template_correo       = str_replace("{ASUNTO}", ($asunto_mensaje[0]->nombre), $template_correo);
    $template_correo       = str_replace("{asunto}", ($asunto_mensaje[0]->nombre), $template_correo);
    $datos_empresa         = DatosEmpresa($id_empresa);
    $mail                  = new PHPMailer;
    //Tell PHPMailer to use SMTP
    $mail->isSMTP(); //Enable SMTP debugging
    // 0 = off (for production use)
    // 1 = client messages
    // 2 = client and server messages
    $mail->SMTPDebug   = 1;
    //Ask for HTML-friendly debug output
    $mail->Debugoutput = 'error_log';
    //Set the hostname of the mail server
    $mail->Host        = $datos_empresa[0]->server;
    //Set the SMTP port number - likely to be 25, 465 or 587
    $mail->Port        = 25;
    //Whether to use SMTP authentication
    $mail->SMTPAuth    = true;
    //Username to use for SMTP authentication
    $mail->Username    = $datos_empresa[0]->envio_correos;
    //Password to use for SMTP authentication
    $mail->Password    = $datos_empresa[0]->envio_correos_pass;
    //Set who the message is to be sent from
    $mail->setFrom($datos_empresa[0]->envio_correos, $datos_empresa[0]->envio_correos);
    //Set an alternative reply-to address
    //$mail->addReplyTo('replyto@example.com', 'First Last');
    //Set who the message is to be sent to
    $mail->addAddress($datos_destinatario[0]->email, $datos_destinatario[0]->nombre_completo);
    //$mail->addAddress("daniel@gop.cl", $datos_destinatario[0]->nombre_completo);
    //$mail->addAddress("rod@gop.cl", $datos_destinatario[0]->nombre_completo);
    $mail->AddBCC("backup@sgd.cl", "BCC: " . $datos_destinatario[0]->nombre_completo);
    //Set the subject line
    $mail->Subject = "Nuevo mensaje en Plataforma TNT";
    //Read an HTML message body from an external file, convert referenced images to embedded,
    //convert HTML into a basic plain-text alternative body
    $mail->msgHTML($template_correo, dirname(__FILE__));
    //Replace the plain text body with one created manually
    $mail->AltBody = 'Si no puedes visualizar este correo ....';
    //Attach an image file
    //$mail->addAttachment('images/phpmailer_mini.png');
    //send the message, check for errors
    if (!$mail->send()) {
        //echo "Mailer Error: " . $mail->ErrorInfo;
    } else {
        //echo "Message sent!";
    }
    //exit;
}
function EnviaCorreoLinkAcceso($correo_para, $nombre_para, $tokem, $id_template_correo, $tipo_correo, $id_empresa)
{
    if ($tipo_correo) {
        $datos_template_correo = ObtengoTipoCorreoPorTipoEmpresa($tipo_correo, $id_empresa);
    } else {
        $datos_template_correo = ObtengoTipoCorreoPorId($id_template_correo);
    }
    $template_correo = file_get_contents("views/correos/" . $datos_template_correo[0]->template);
    $template_correo = str_replace("{TITULO1}", $datos_template_correo[0]->titulo1, $template_correo);
    $template_correo = str_replace("{TITULO2}", $datos_template_correo[0]->titulo2, $template_correo);
    $template_correo = str_replace("{TEXTO2}", $datos_template_correo[0]->texto2, $template_correo);
    $template_correo = str_replace("{TEXTOLINK}", $datos_template_correo[0]->textolink, $template_correo);
    $template_correo = str_replace("{TEXTO3}", $datos_template_correo[0]->texto3, $template_correo);
    $template_correo = str_replace("{TEXTO4}", $datos_template_correo[0]->texto4, $template_correo);
    $template_correo = str_replace("{TEXTOFOOTER1}", $datos_template_correo[0]->textofooter1, $template_correo);
    $template_correo = str_replace("{TEXTOFOOTER2}", $datos_template_correo[0]->textofooter2, $template_correo);
    $link_acceso     = "http://plataformagop.ngd.cl/front/index.php?sw=chpex&tok=" . Encodear3($tokem) . "";
    $template_correo = str_replace("{LINK_CON_PARAMETROS}", $link_acceso, $template_correo);
    $mail            = new PHPMailer;
    //Set who the message is to be sent from
    $mail->setFrom($datos_template_correo[0]->from_correo, $datos_template_correo[0]->from);
    //Set an alternative reply-to address
    //$mail->addReplyTo('replyto@example.com', 'First Last');
    //Set who the message is to be sent to
    $mail->addAddress($correo_para, $nombre_para);
    //$mail->addAddress('dpezoa@gmail.com', $datos_usuario[0]->nombre_completo);
    $mail->AddBCC("backup@sgd.cl", "BCC: " . $nombre_para);
    //Set the subject line
    $mail->Subject = $datos_template_correo[0]->asunto;
    //Read an HTML message body from an external file, convert referenced images to embedded,
    //convert HTML into a basic plain-text alternative body
    $mail->msgHTML($template_correo, dirname(__FILE__));
    //Replace the plain text body with one created manually
    $mail->AltBody = 'Alt Body';
    //Attach an image file
    //$mail->addAttachment('img/Prop_Intranet_TNT.docx');
    //send the message, check for errors
    if (!$mail->send()) {
        echo "Mailer Error: " . $mail->ErrorInfo;
    } else {
        //echo "Message sent!";
    }
    //exit;
}
function EnviarCorreos($rut, $tipo, $rut_jefe)
{
    $tipo_correo   = ObtengoTipoCorreo($tipo);
    $datos_usuario = UsuarioEnBasePersonas($rut);
    $plantilla     = $tipo_correo[0]->texto;
    $plantilla     = str_replace("{NOMBRE_USUARIO}", htmlentities($datos_usuario[0]->nombre_completo), $plantilla);
    if ($tipo == "1") {
        $clave     = VerificaClaveAccesoSoloRut($rut);
        $plantilla = str_replace("{CLAVE}", htmlentities($clave[0]->clave), $plantilla);
    }
    if ($tipo == 3) {
        $datos_jefe = UsuarioEnBasePersonas($rut_jefe);
        $plantilla  = str_replace("{NOMBRE_JEFE}", htmlentities($datos_jefe[0]->nombre_completo), $plantilla);
    }
    //echo $plantilla;
    $mail = new PHPMailer;
    //Set who the message is to be sent from
    $mail->setFrom($tipo_correo[0]->from_correo, $tipo_correo[0]->from);
    //Set an alternative reply-to address
    //$mail->addReplyTo('replyto@example.com', 'First Last');
    //Set who the message is to be sent to
    //$mail->addAddress($datos_usuario[0]->email, $datos_usuario[0]->nombre_completo);
    $mail->addAddress('dpezoa@gmail.com', $datos_usuario[0]->nombre_completo);
    $mail->AddBCC("backup@sgd.cl", "BCC: " . $datos_usuario[0]->nombre_completo);
    //Set the subject line
    $mail->Subject = $tipo_correo[0]->titulo;
    //Read an HTML message body from an external file, convert referenced images to embedded,
    //convert HTML into a basic plain-text alternative body
    $mail->msgHTML($plantilla, dirname(__FILE__));
    //Replace the plain text body with one created manually
    $mail->AltBody = 'Alt Body';
    //Attach an image file
    //$mail->addAttachment('img/Prop_Intranet_TNT.docx');
    //send the message, check for errors
    if (!$mail->send()) {
        echo "Mailer Error: " . $mail->ErrorInfo;
    } else {
        //echo "Message sent!";
    }
    //exit;
}
////FUNCIONES PARA BIBLIOTECA Y GALERIAS


//FIN MODULO BIBLIOTECA
function tokenTruncate($text, $length)
{
    $length = abs((int) $length);
    if (strlen($text) > $length) {
        $text = preg_replace("/^(.{1,$length})(\s.*|$)/s", '\\1...', $text);
    }
    return ($text);
}

function lms_busca_cursos_realizados($rut, $id_empresa)
{
    //echo "$rut, $id_empresa";
    $lista_cursos_reportes_data = lms_busca_cursos_realizados_data($rut, $id_empresa);
    foreach ($lista_cursos_reportes_data as $lista_curso_reportes_data) {
        if ($lista_curso_reportes_data->status == "Elearning") {
            $bloque_cursos_lms_reportes = str_replace("{CURSO}", ($lista_curso_reportes_data->programa), $bloque_cursos_lms_reportes);
            $bloque_cursos_lms_reportes = str_replace("{ENC_CURSO}", Encodear3(($lista_curso_reportes_data->programa)), $bloque_cursos_lms_reportes);
            $bloque_cursos_lms_reportes = str_replace("{ICO}", "<i class='icon-screen-desktop icons'></i> Online", $bloque_cursos_lms_reportes);
        }
        if ($lista_curso_reportes_data->status == "Presencial") {
            $bloque_cursos_lms_reportes = str_replace("{CURSO}", ($lista_curso_reportes_data->curso), $bloque_cursos_lms_reportes);
            $bloque_cursos_lms_reportes = str_replace("{ENC_CURSO}", Encodear3(($lista_curso_reportes_data->curso)), $bloque_cursos_lms_reportes);
            $bloque_cursos_lms_reportes = str_replace("{ICO}", "<i class='icon-notebook icons'></i> Presencial", $bloque_cursos_lms_reportes);
        }
        $bloque_cursos_lms_reportes .= file_get_contents("views/integracion/" . $id_empresa . "_row_cursos_lms_reportes.html");
        $bloque_cursos_lms_reportes = str_replace("{HORAS}", ($lista_curso_reportes_data->horas), $bloque_cursos_lms_reportes);
        if ($lista_curso_reportes_data->asistencia == "100%") {
            $boton_diploma              = "<a href='?sw=diploma&name={ENC_NOMBRE}&course={ENC_CURSO}&program={ENC_PROGRAMA}&month={ENC_MESTERMINO}&year={ENC_ANNOTERMINO}&hour={ENC_HORAS}' target='_blank' class='btn btn-info btn-sm'> <span class='blanco'> <i class='icon-screen-tablet icons'></i> Descargar Certificado </span> </a>";
            $bloque_cursos_lms_reportes = str_replace("{ANNOTERMINO}", ($lista_curso_reportes_data->anno_termino), $bloque_cursos_lms_reportes);
            $bloque_cursos_lms_reportes = str_replace("{MESTERMINO}", (genMonth_Text($lista_curso_reportes_data->mes_termino)), $bloque_cursos_lms_reportes);
            $bloque_cursos_lms_reportes = str_replace("{ICOCAL}", "<i class='icon-calendar icons'></i>", $bloque_cursos_lms_reportes);
        } else {
            $boton_diploma              = "<SMALL>Curso Incompleto</SMALL>";
            $bloque_cursos_lms_reportes = str_replace("{ANNOTERMINO}", "", $bloque_cursos_lms_reportes);
            $bloque_cursos_lms_reportes = str_replace("{MESTERMINO}", "", $bloque_cursos_lms_reportes);
            $bloque_cursos_lms_reportes = str_replace("{ICOCAL}", "", $bloque_cursos_lms_reportes);
        }
        $bloque_cursos_lms_reportes = str_replace("{DIPLOMA}", $boton_diploma, $bloque_cursos_lms_reportes);
        $bloque_cursos_lms_reportes = str_replace("{ENC_NOMBRE}", Encodear3(($lista_curso_reportes_data->nombre)), $bloque_cursos_lms_reportes);
        $bloque_cursos_lms_reportes = str_replace("{ENC_ANNOTERMINO}", Encodear3(($lista_curso_reportes_data->anno_termino)), $bloque_cursos_lms_reportes);
        $bloque_cursos_lms_reportes = str_replace("{ENC_MESTERMINO}", Encodear3(genMonth_Text($lista_curso_reportes_data->mes_termino)), $bloque_cursos_lms_reportes);
        $bloque_cursos_lms_reportes = str_replace("{ENC_HORAS}", Encodear3($lista_curso_reportes_data->horas), $bloque_cursos_lms_reportes);
    }
    $arreglo[0] = $bloque_cursos_lms_reportes;
    return $arreglo;
}
function array_sort_by(&$arrIni, $col, $order = SORT_ASC)
{
    $arrAux = array();
    foreach ($arrIni as $key => $row) {
        $arrAux[$key] = is_object($row) ? $arrAux[$key] = $row->$col : $row[$col];
        $arrAux[$key] = strtolower($arrAux[$key]);
    }
    array_multisort($arrAux, $order, $arrIni);
}
function Lista_cursos_por_programa($rut, $id_empresa, $id_programa_bbdd, $id_malla)
{

    if($id_empresa==78){
        $malla_dado_progama=BuscaIdmallaDadoProgramaRut_Prd($rut, $id_empresa, $id_programa_bbdd);
        //print_r($malla_dado_progama);
    }
    $listaProgramas = List_cursos_programa($rut, $id_empresa, $id_programa_bbdd, $id_malla);
    //print_r($listaProgramas);
    $plantilla      = "detalle_cursoCap";
    foreach ($listaProgramas as $listaPrograma) {
        $bloque_archivos .= file_get_contents("views/integracion/" . $id_empresa . "_row_lms_programa_interno.html");
        $bloque_archivos = str_replace("{PROGRAMA_NOMBRE}", ($listaPrograma->nombre), $bloque_archivos);
        $bloque_archivos = str_replace("{AVANCE_PROGRAMA}", $listaPrograma->avance, $bloque_archivos);
        $bloque_archivos = str_replace("{RESULTADO_FINAL}", $listaPrograma->resultado_final, $bloque_archivos);
        $bloque_archivos = str_replace("{ID_PROGRAMA_SLIDE}", $listaPrograma->id_programa . $listaPrograma->rut, $bloque_archivos);
        $bloque_archivos = str_replace("{ID_MALLA}", ($listaPrograma->id), $bloque_archivos);
        $bloque_archivos = str_replace("{IDC_ENCODEADO}", Encodear3($listaPrograma->id), $bloque_archivos);
        $bloque_archivos = str_replace("{ID_MALLA_ENCODEADO}", Encodear3($listaPrograma->id_malla), $bloque_archivos);
        $bloque_archivos = str_replace("{FOCO_PROGRAMA}", $listaPrograma->foco, $bloque_archivos);
        $bloque_archivos = str_replace("{ID_FOCO}", $listaPrograma->id_foco, $bloque_archivos);
        $bloque_archivos = str_replace("{CODIGO_FOCO}", $listaPrograma->id_foco, $bloque_archivos);
        $bloque_archivos = str_replace("{IMAGEN_PROGRAMA}", $listaPrograma->imagen, $bloque_archivos);
        $bloque_archivos = str_replace("{DESCRIPCION_PROGRAMA}", ($listaPrograma->descripcion_programa), $bloque_archivos);
        //$bloque_archivos = str_replace("{DESCRIPTOR_NOMBRE}",($listaPrograma->descriptor_nombre),$bloque_archivos);
        $bloque_archivos = str_replace("{URL_PROGRAMA}", ($listaPrograma->url_programa), $bloque_archivos);
        $bloque_archivos = str_replace("{TEMPLATE}", $plantilla, $bloque_archivos);
        $bloque_archivos = str_replace("{RESULTADO_PROGRAMA_1A7}", "-", $bloque_archivos);
        $cuenta_cursos++;
        $suma_Avance = $suma_Avance + $listaPrograma->avance;
        if ($listaPrograma->avance >= 100) {
            $cuenta_finalizados++;
        }
    }
    $promedio   = round($suma_Avance / $cuenta_cursos);
    $arreglo[0] = $bloque_archivos;
    $arreglo[1] = $promedio;
    $arreglo[2] = $cuenta_cursos;
    $arreglo[3] = $cuenta_finalizados;
    $arreglo[4] = $malla_dado_progama[0]->id_malla;
    return $arreglo;
}
function lms_cursos_especiales($rut, $id_empresa,$tipo, $estado, $modalidad){
    //echo "lms_cursos_especiales";
    $listaProgramas  = lms_integracion_lista_cursos_especiales($rut, $id_empresa, $tipo, $estado, $modalidad);
    $bloque_archivos = "";

        //print_r($listaProgramas);
        foreach ($listaProgramas as $listaPrograma) {

        //veo si el curso esta asociado a una malla que no sea la malla Elearning_por_fechas
        $existe_en_otra_malla=VerificoCursoModalidad4EnOtraMalla($listaPrograma->id_curso, $id_empresa);
        if($existe_en_otra_malla){
            continue;
        }
        $template = $listaPrograma->template;
        $plantilla = "detalle_cursoCap";


                        //echo "<br><br>foreach";


        $mensaje_objeto="";
                        $fecha_actual      = date("Y-m-d");
                        $hora_actual       = date("H:i:s");
                       //// echo "fecha actual $fecha_actual, hora actual $hora_actual <br>";
                       //// echo $listaPrograma->hora_inicioT."<br>";
                       //// echo $listaPrograma->hora_terminoT."<br>";
                       //// echo $listaPrograma->fecha_inicioT."<br>";
                       /// echo $listaPrograma->fecha_terminoT."<br>";



                        if ($fecha_actual < $listaPrograma->fecha_inicioT) {
                        //echo "FT1";
        $bloque_archivos .= file_get_contents("views/integracion/" . $id_empresa . "_row_lms_programa_interno_especial_desactivo.html");
$mensaje_objeto="";
$mensaje_objeto .= "El modulo se encuentra desactivado. La fecha de aplicaci&oacute;n es el " . $listaPrograma->fecha_inicioT." y el horario de activaci&oacute;n es entre las ".$listaPrograma->hora_inicioT." y ".$listaPrograma->hora_terminoT."";

                            $row_curso = str_replace("{MENSAJE_}", $mensaje_objeto, $row_curso);


                       } else if ($fecha_actual > $listaPrograma->fecha_terminoT) {
                        //echo "FT2";
$mensaje_objeto="";
        $bloque_archivos .= file_get_contents("views/integracion/" . $id_empresa . "_row_lms_programa_interno_especial_desactivo.html");
$mensaje_objeto .= "El modulo se encuentra desactivado. La fecha de aplicaci&oacute;n es el " . $listaPrograma->fecha_inicioT." y el horario de activaci&oacute;n es entre las ".$listaPrograma->hora_inicioT." y ".$listaPrograma->hora_terminoT."";
                            $row_curso = str_replace("{MENSAJE_}", $mensaje_objeto, $row_curso);

                        } else if ($fecha_actual >= $listaPrograma->fecha_inicioT && $fecha_actual <= $listaPrograma->fecha_terminoT) {
                        //echo "FT3";
                                    if ($fecha_actual == $listaPrograma->fecha_inicioT and $fecha_actual <> $listaPrograma->fecha_terminoT) {
                                    //echo "FT4";
                                        //echo "es hoy inicio";

                                        //echo "<br>$hora_actual < hora inicio ".$listaPrograma->hora_inicioT;
                                        if ($hora_actual < $listaPrograma->hora_inicioT) {
                $bloque_archivos .= file_get_contents("views/integracion/" . $id_empresa . "_row_lms_programa_interno_especial_desactivo.html");
$mensaje_objeto="";
$mensaje_objeto .= "El modulo se encuentra desactivado. La fecha de aplicaci&oacute;n es el " . $listaPrograma->fecha_inicioT." y el horario de activaci&oacute;n es entre las ".$listaPrograma->hora_inicioT." y ".$listaPrograma->hora_terminoT."";
                                            $row_curso = str_replace("{MENSAJE_}", $mensaje_objeto, $row_curso);
                                        } elseif($hora_actual >= $listaPrograma->hora_inicioT) {
                $bloque_archivos .= file_get_contents("views/integracion/" . $id_empresa . "_row_lms_programa_interno_especial.html");
                                            $mensaje_objeto = "";;
                                            $row_curso = str_replace("{MENSAJE_}", $mensaje_objeto, $row_curso);
                                        }



                                    } elseif ($fecha_actual == $listaPrograma->fecha_terminoT and $fecha_actual <> $listaPrograma->fecha_inicioT) {
                                    //echo "FT5";

                                    if ($hora_actual > $listaPrograma->hora_terminoT) {

                $bloque_archivos .= file_get_contents("views/integracion/" . $id_empresa . "_row_lms_programa_interno_especial_desactivo.html");
$mensaje_objeto="";
$mensaje_objeto .= "El modulo se encuentra desactivado. La fecha de aplicaci&oacute;n es el " . $listaPrograma->fecha_inicioT." y el horario de activaci&oacute;n es entre las ".$listaPrograma->hora_inicioT." y ".$listaPrograma->hora_terminoT."";
                                            $row_curso = str_replace("{MENSAJE_}", $mensaje_objeto, $row_curso);
                                        } elseif($hora_actual <= $listaPrograma->hora_terminoT) {

                $bloque_archivos .= file_get_contents("views/integracion/" . $id_empresa . "_row_lms_programa_interno_especial.html");
                                            $mensaje_objeto = "";
                                            $row_curso = str_replace("{MENSAJE_}", $mensaje_objeto, $row_curso);



                                    } elseif ($fecha_actual == $listaPrograma->fecha_terminoT and $fecha_actual == $listaPrograma->fecha_inicioT) {
                                        //echo "es hoy termino e iniciohora ahora es ".$hora_actual." hora termino ".$unico->hora_termino." hora inicio".$unico->hora_inicio;
                                        if ($hora_actual > $listaPrograma->hora_terminoT or $hora_actual < $listaPrograma->hora_inicioT) {
                $bloque_archivos .= file_get_contents("views/integracion/" . $id_empresa . "_row_lms_programa_interno_especial_desactivo.html");
$mensaje_objeto="";
$mensaje_objeto .= "El modulo se encuentra desactivado. La fecha de aplicaci&oacute;n es el " . $listaPrograma->fecha_inicioT." y el horario de activaci&oacute;n es entre las ".$listaPrograma->hora_inicioT." y ".$listaPrograma->hora_terminoT."";
                                            $row_curso = str_replace("{MENSAJE_}", $mensaje_objeto, $row_curso);
                                        }

                                    }


                                    } else {
                                    //echo "FT6";


                                    if ($hora_actual >= $listaPrograma->hora_inicioT and $hora_actual <= $listaPrograma->hora_terminoT) {

                            $bloque_archivos .= file_get_contents("views/integracion/" . $id_empresa . "_row_lms_programa_interno_especial.html");
                                            $mensaje_objeto = "";
                                            $row_curso = str_replace("{MENSAJE_}", $mensaje_objeto, $row_curso);
                                        } else {
                                        //echo "FT8";
                            $bloque_archivos .= file_get_contents("views/integracion/" . $id_empresa . "_row_lms_programa_interno_especial_desactivo.html");
$mensaje_objeto="";
$mensaje_objeto .= "El modulo se encuentra desactivado. La fecha de aplicaci&oacute;n es el " . $listaPrograma->fecha_inicioT." y el horario de activaci&oacute;n es entre las ".$listaPrograma->hora_inicioT." y ".$listaPrograma->hora_terminoT."";
                                            $row_curso = str_replace("{MENSAJE_}", $mensaje_objeto, $row_curso);


                                        }


                                    //echo "activo";

                                    }





                        } else {
                        //echo "FT9";
                        $bloque_archivos .= file_get_contents("views/integracion/" . $id_empresa . "_row_lms_programa_interno_especial.html");

                        }


        //echo "$mensaje_objeto";

        $Array_Avance=BuscaAvanceIdCursoActualizaReportes($rut, $listaPrograma->id_curso, $id_empresa);
        //print_r($Array_Avance);




        $bloque_archivos = str_replace("{MENSAJE_}", $mensaje_objeto, $bloque_archivos);

        $bloque_archivos = str_replace("{PROGRAMA_NOMBRE}", ($listaPrograma->nombre_curso), $bloque_archivos);
        $bloque_archivos = str_replace("{AVANCE_PROGRAMA}",     ($Array_Avance[0]->avance),     $bloque_archivos);
        $bloque_archivos = str_replace("{RESULTADO_FINAL}",     ($Array_Avance[0]->nota),     $bloque_archivos);
        $bloque_archivos = str_replace("{ID_PROGRAMA_SLIDE}", $listaPrograma->id_programa . $listaPrograma->rut, $bloque_archivos);
        $bloque_archivos = str_replace("{ID_MALLA}", ($listaPrograma->id), $bloque_archivos);
        $bloque_archivos = str_replace("{ID_MALLA_ENCODEADO}", "", $bloque_archivos);
        $bloque_archivos = str_replace("{ID_CURSO_ENCODEADO}", Encodear3($listaPrograma->id_curso)."&idinsc=".Encodear3($listaPrograma->id_inscripcion), $bloque_archivos);

        $bloque_archivos = str_replace("{FECHA_INICIO_T}",     ($listaPrograma->fecha_inicioT),     $bloque_archivos);
        $bloque_archivos = str_replace("{FECHA_TERMINO_T}",     ($listaPrograma->fecha_terminoT),     $bloque_archivos);
        $bloque_archivos = str_replace("{HORA_INICIO_T}", ($listaPrograma->hora_inicioT),     $bloque_archivos);
        $bloque_archivos = str_replace("{HORA_TERMINO_T}",     ($listaPrograma->hora_terminoT),     $bloque_archivos);

        $bloque_archivos = str_replace("{IMAGEN_PROGRAMA}", $listaPrograma->imagen_curso, $bloque_archivos);
        $bloque_archivos = str_replace("{DESCRIPCION_PROGRAMA}", ($listaPrograma->descripcion_curso), $bloque_archivos);
        $bloque_archivos = str_replace("{URL_PROGRAMA}", ($listaPrograma->url_programa), $bloque_archivos);
        $bloque_archivos = str_replace("{TEMPLATE}", $plantilla, $bloque_archivos);
        $bloque_archivos = str_replace("{RESULTADO_PROGRAMA_1A7}", "-", $bloque_archivos);

        }

    $arreglo[0]              = $bloque_archivos;
    $promedio_avance_general = round($acumula_avance / $cuenta_programas);
    return ($arreglo);
}
function lms_integracion_programas_estado($rut, $id_empresa, $vista, $estado)
{

    //echo "<br> $rut, $id_empresa, $vista, $estado";


    if ($vista == "opcional") {
        $filtrodata = "opcional";
    } else {
        $filtrodata = "";
    }

 $cuenta_programas=0;


    //$start = round(microtime(true) * 1000);

    $listaProgramas  = lms_integracion_lista_programas($rut, $id_empresa, $id_programa_bbdd, $filtrodata, $estado);

    //echo "<pre>";     print_r($listaProgramas);

    /*$time_elapsed_secs = round(microtime(true) * 1000) - $start;
    $time_elapsed= gmdate("H:i:s", $time_elapsed_secs);
    echo "<br>Int_1 : $time_elapsed<br><br>";

    $start = round(microtime(true) * 1000);    */


    //print_r($listaProgramas);
    //array_sort_by($listaProgramas, "avance_malla", $order = SORT_ASC);
    $bloque_archivos = "";
    $cuenta          = count($listaProgramas);
    if ($cuenta > 0) {
        foreach ($listaProgramas as $listaPrograma) {

            if($listaPrograma->id_malla=="e_p_f"){
                continue;
            }

    if($estado=="FINALIZADO"){
        if($listaPrograma->avance_malla<100){ continue; }
    } elseif($estado=="PENDIENTE"){
        if($listaPrograma->avance_malla>=100){ continue; }
    }




    /*        $time_elapsed_secs = round(microtime(true) * 1000) - $start;
    $time_elapsed= gmdate("H:i:s", $time_elapsed_secs);
    echo "<br>Int_02 : $time_elapsed<br><br>";

    $start = round(microtime(true) * 1000);    */

            //print_r($listaPrograma);
            $html_objetos = "";
            if ($vista == "equipo") {
                $bloque_archivos .= file_get_contents("views/integracion/" . $id_empresa . "_row_lms_programa_vista_equipo.html");
            } else if ($vista == "detalle") {
                $bloque_archivos .= file_get_contents("views/integracion/" . $id_empresa . "_row_lms_programa_vista_detalle.html");
            } else if ($listaPrograma->bbdd_host) {
                //Aca verifico si este usuario esta en la base y host remoto
                INTEGRACION_VerificaUsuarioEnOtraBase($rut, $listaPrograma->bbdd_host, $listaPrograma->bbdd_database, $listaPrograma->bbdd_username, $listaPrograma->bbdd_password, $listaPrograma->id_malla, $listaPrograma->id_empresa_programa);
            } else {
            }
            if ($vista == "" or $vista == "opcional") {
                if ($listaPrograma->url_programa <> '') {
                    $bloque_archivos .= file_get_contents("views/integracion/" . $id_empresa . "_row_lms_programa.html");
                } else {
                    $bloque_archivos .= file_get_contents("views/integracion/" . $id_empresa . "_row_lms_programa_interno.html");
                }
            }

    /*$time_elapsed_secs = round(microtime(true) * 1000) - $start;
    $time_elapsed= gmdate("H:i:s", $time_elapsed_secs);
    echo "<br>Int_03 : $time_elapsed<br><br>"; */



    //echo "<br> BBDD HOST ".$listaPrograma->bbdd_host;
    /*echo "<br> id_programa  ".$listaPrograma->id_programa;*/





                /*$start = round(microtime(true) * 1000);    */
                $avanceProgramaArrCursos = BuscaAvgCierreCurso($listaPrograma->id_malla, $id_empresa, $listaPrograma->rut);

                /*$time_elapsed_secs = round(microtime(true) * 1000) - $start;
                $time_elapsed= gmdate("H:i:s", $time_elapsed_secs);
                echo "<br>Int_1 : $time_elapsed<br><br>";
                $start = round(microtime(true) * 1000);        */
                //print_r($avanceProgramaArrCursos);
                $sumaavancecursos        = 0;
                $cuentaavancecursos      = 0;
                foreach ($avanceProgramaArrCursos as $avanceProgramaArrCurso) {
                    $sumaavancecursos = $sumaavancecursos + $avanceProgramaArrCurso->avance;
                    $cuentaavancecursos++;
                }

                /*$time_elapsed_secs = round(microtime(true) * 1000) - $start;
                $time_elapsed= gmdate("H:i:s", $time_elapsed_secs);
                echo "<br>Int_2 : $time_elapsed<br><br>";
                $start = round(microtime(true) * 1000);    */

                if ($cuentaavancecursos > 0) {
                    $avanceProgramaArrInscripcionCierre = round($sumaavancecursos / $cuentaavancecursos);
                } else {
                    $avanceProgramaArrInscripcionCierre = 0;
                }
                /*$time_elapsed_secs = round(microtime(true) * 1000) - $start;
                $time_elapsed= gmdate("H:i:s", $time_elapsed_secs);
                echo "<br>Int_3 : $time_elapsed<br><br>"; */
                /*$start = round(microtime(true) * 1000);        */
                //cho "<br>";
                //echo "<br><br><br>hay dif Internos ->".$listaPrograma->nombre_programa."<br>".$avanceProgramaArr[0]->avancePrograma.", avance ".$listaPrograma->avance_malla." - ".$avanceProgramaArrInscripcionCierre;

                //echo "<br>avanceProgramaArrInscripcionCierre $avanceProgramaArrInscripcionCierre <> listaPrograma->avance_malla ".$listaPrograma->avance_malla;

                if ($avanceProgramaArrInscripcionCierre <> $listaPrograma->avance_malla) {
                    //echo "<br>hay dif Internos 2 ->".$listaPrograma->nombre_programa."<br>".$avanceProgramaArr[0]->avancePrograma." avance ".$listaPrograma->avance_malla;
                    //print_r($listaPrograma);
                    GuardaDatosTablaReporte2017RutPrograma($listaPrograma->rut, $listaPrograma->id_programa);
                    $avance_temporal_array       = CalcularAvanceDatosTablaReporte2017RutPrograma($listaPrograma->rut, $listaPrograma->id_programa);
                    $listaPrograma->avance_malla = $avance_temporal_array[0]->avance;
                }

                //echo "<br>avanceProgramaArrInscripcionCierre $avanceProgramaArrInscripcionCierre <> listaPrograma->avance_malla ".$listaPrograma->avance_malla;

                /*$time_elapsed_secs = round(microtime(true) * 1000) - $start;
                $time_elapsed= gmdate("H:i:s", $time_elapsed_secs);
                echo "<br>Int_4 : $time_elapsed<br><br>";
                $start = round(microtime(true) * 1000);    */



                /*$objetos = TraigoObjetosDadoRutYMalla($listaPrograma->rut, $listaPrograma->id_malla, $id_objeto);
                foreach ($objetos as $obj) {
                    //print_r($obj); exit();
                    if ($obj->extension_objeto == 23) {
                        $html_objetos .= file_get_contents("views/integracion/" . $id_empresa . "_row_lms_objetos_desafios.html");
                        $verifica_accion_pendiente = VerificaDesafioEnAccionesPendientes($rut, $id_empresa, $obj->id_curso, $obj->id_objeto);
                        if ($verifica_accion_pendiente[0]->estado === "0") {
                            //pendiente de validacion
                            $html_objetos = str_replace("{ICONO_ESTADO_DESAFIO}", "<img src='img/lms_icons_enproceso.png' width='20px'>", $html_objetos);
                            $html_objetos = str_replace("{VER_DESAFIO}", '<a href="?sw=contenido&i={ID_OBJETO_ENCODEADO}&rc={RUT_COLABORADOR_ENCODEADO}&checkin=1">Ver Desafio</a>', $html_objetos);
                        } else if ($verifica_accion_pendiente[0]->estado === "1") {
                            //Validado
                            $html_objetos = str_replace("{ICONO_ESTADO_DESAFIO}", "<img src='img/lms_icons_aprobado.jpg' width='20px'>", $html_objetos);
                            $html_objetos = str_replace("{VER_DESAFIO}", '<a href="?sw=contenido&i={ID_OBJETO_ENCODEADO}&rc={RUT_COLABORADOR_ENCODEADO}&checkin=1">Ver Desafio</a>', $html_objetos);
                        } else if (count($verifica_accion_pendiente) < 1) {
                            //No se a enviado a validar
                            $html_objetos = str_replace("{ICONO_ESTADO_DESAFIO}", "<img src='img/lms_icons_noiniciado.jpg' width='20px'>", $html_objetos);
                            $html_objetos = str_replace("{VER_DESAFIO}", '', $html_objetos);
                        }
                    } else {
                        $html_objetos .= file_get_contents("views/integracion/" . $id_empresa . "_row_lms_objetos.html");
                    }
                    //VerificaDesafioEnAccionesPendientes($rut_colaborador, $id_empresa, $id_curso, $id_objeto);
                    $html_objetos                = str_replace("{ID_OBJETO_ENCODEADO}", Encodear3($obj->id_objeto), $html_objetos);
                    $html_objetos                = str_replace("{ID_CURSO_ENCODEADO}", Encodear3($obj->id_curso), $html_objetos);
                    $html_objetos                = str_replace("{RUT_COLABORADOR_ENCODEADO}", Encodear3($rut), $html_objetos);
                    $html_objetos                = str_replace("{OBJETO_NOMBRE}", ($obj->nombre_objeto), $html_objetos);
                    $html_objetos                = str_replace("{NOTA_OBJETO}", ($obj->nota), $html_objetos);
                    $html_objetos                = str_replace("{NOTA_OBJETO_1A7}", ColocaNotaConvertidaTrivia(($obj->nota)), $html_objetos);
                    $html_objetos                = str_replace("{ID_OBJETO_SLIDE}", $obj->id_objeto . $listaPrograma->rut, $html_objetos);
                    $listado_preguntas_De_Trivia = MuestraInformeIndividualDesdeVistaJefe($listaPrograma->rut, $obj->id_objeto);
                    $html_objetos                = str_replace("{LISTADO_PREGUINTAS_DE_TRIVIA}", $listado_preguntas_De_Trivia, $html_objetos);
                    //echo ColocaNotaConvertidaTrivia(($obj->nota))."<br>";
                    $nota_objeto_seleccionado    = (($obj->nota));
                }


                */
                //echo "aca";
                //echo $html_objetos;
                $bloque_archivos = str_replace("{ROW_LISTADO_OBJETOS_TRIVIAS}", $html_objetos, $bloque_archivos);
                $bloque_archivos = str_replace("{ROW_LISTADO_OBJETOS_TRIVIASV2}", $html_objetos, $bloque_archivos);





/*    $start = round(microtime(true) * 1000);    */
            $template = $listaPrograma->template;
            if ($template <> '') {
                $plantilla = $template;
            } else {
                $plantilla = "malla3";
            }
            /*
            echo "<br>".$listaPrograma->nombre_programa;
            echo "<br>".$avanceProgramaArrCursos[0]->certificacion;
            echo "<br>".$avanceProgramaArrCursos[0]->estadodescripcion;
            */
            if ($avanceProgramaArrCursos[0]->certificacion == 1) {
                $bloque_archivos = str_replace("{PROGRAMA_NOMBRE}", ($listaPrograma->nombre_programa), $bloque_archivos);
                if ($avanceProgramaArrCursos[0]->estadodescripcion == "Aprueba" or $avanceProgramaArrCursos[0]->estadodescripcion == "APROBADO") {
                    $labelcolor = "success";
                }
                if ($avanceProgramaArrCursos[0]->estadodescripcion == "Reprueba" or $avanceProgramaArrCursos[0]->estadodescripcion == "REPROBADO") {
                    $labelcolor = "danger";
                }
                $RESULTADO_cert  = " <span class='label label-" . $labelcolor . "'><span class='blanco'>" . $avanceProgramaArrCursos[0]->nota . "% " . $avanceProgramaArrCursos[0]->estadodescripcion . "</span></span>";
                $bloque_archivos = str_replace("{RESULTADO_FINAL}", "", $bloque_archivos);
                $bloque_archivos = str_replace("{AVANCE_PROGRAMA}", $avanceProgramaArrCursos[0]->nota, $bloque_archivos);
            } else {
                $bloque_archivos = str_replace("{PROGRAMA_NOMBRE}", ($listaPrograma->nombre_programa), $bloque_archivos);
                $bloque_archivos = str_replace("{RESULTADO_FINAL}", "", $bloque_archivos);
                if (($listaPrograma->avance_malla)) {
                    $bloque_archivos = str_replace("{AVANCE_PROGRAMA}", (round($listaPrograma->avance_malla)), $bloque_archivos);
                } else {
                    $bloque_archivos = str_replace("{AVANCE_PROGRAMA}", "0", $bloque_archivos);
                }
            }

    /*$time_elapsed_secs = round(microtime(true) * 1000) - $start;
    $time_elapsed= gmdate("H:i:s", $time_elapsed_secs);
    echo "<br>Int_5 : $time_elapsed<br><br>";

    $start = round(microtime(true) * 1000);        /**/
            $bloque_archivos = str_replace("{ID_PROGRAMA_SLIDE}", $listaPrograma->id_programa . $listaPrograma->rut, $bloque_archivos);
            $bloque_archivos = str_replace("{ID_MALLA}", ($listaPrograma->id_malla), $bloque_archivos);
            $bloque_archivos = str_replace("{ID_MALLA_ENCODEADO}", Encodear3($listaPrograma->id_malla), $bloque_archivos);
            $bloque_archivos = str_replace("{ID_CURSO_ENCODEADO}", "", $bloque_archivos);

            $bloque_archivos = str_replace("{FOCO_PROGRAMA}", $listaPrograma->foco, $bloque_archivos);
            $bloque_archivos = str_replace("{ID_FOCO}", $listaPrograma->id_foco, $bloque_archivos);
            $bloque_archivos = str_replace("{CODIGO_FOCO}", $listaPrograma->id_foco, $bloque_archivos);
            $bloque_archivos = str_replace("{IMAGEN_PROGRAMA}", $listaPrograma->imagen_programa, $bloque_archivos);
            $bloque_archivos = str_replace("{DESCRIPCION_PROGRAMA}", ($listaPrograma->descripcion_programa), $bloque_archivos);
            //$bloque_archivos = str_replace("{DESCRIPTOR_NOMBRE}",($listaPrograma->descriptor_nombre),$bloque_archivos);
            $bloque_archivos = str_replace("{URL_PROGRAMA}", ($listaPrograma->url_programa), $bloque_archivos);
            $bloque_archivos = str_replace("{TEMPLATE}", $plantilla, $bloque_archivos);
            $bloque_archivos = str_replace("{RESULTADO_PROGRAMA_1A7}", "-", $bloque_archivos);
            //echo "<br>".$listaPrograma->avance_malla;

        /*$time_elapsed_secs = round(microtime(true) * 1000) - $start;
    $time_elapsed= gmdate("H:i:s", $time_elapsed_secs);
    echo "<br>Int_6 : $time_elapsed<br><br>";

    $start = round(microtime(true) * 1000);    */
            if ($listaPrograma->bbdd_host) {
                if ($contador_acumulador_bbdd > 0) {
                    $bloque_archivos = str_replace("{RESULTADO_PROGRAMA_1A7}", round(($acumulador_nota_bbdd / $contador_acumulador_bbdd), 1), $bloque_archivos);
                } else {
                    $bloque_archivos = str_replace("{RESULTADO_PROGRAMA_1A7}", "-", $bloque_archivos);
                }
            }
            if (($listaPrograma->avance_malla) == 100) {
                if ($listaPrograma->id_programa <> 'bci_competencias') {
                    $bloque_archivos = str_replace("{RESULTADO_PROGRAMA}", ($listaPrograma->resultado), $bloque_archivos);
                    $bloque_archivos = str_replace("{RESULTADO_PROGRAMA_1A7}", MuestraNotaConvertidaPorEmpresa($id_empresa, ($listaPrograma->resultado)), $bloque_archivos);
                } else {
                    $bloque_archivos = str_replace("{RESULTADO_PROGRAMA}", ($listaPrograma->resultado), $bloque_archivos);
                    $bloque_archivos = str_replace("{RESULTADO_PROGRAMA_1A7}", "-", $bloque_archivos);
                }
                if ($listaPrograma->resultado > 0) {
                    $contador_100_porciento++;
                }
                $acumulador_100_porciento = $listaPrograma->resultado + $acumulador_100_porciento;
            } else {
                $bloque_archivos = str_replace("{RESULTADO_PROGRAMA}", ($listaPrograma->resultado), $bloque_archivos);
                $bloque_archivos = str_replace("{RESULTADO_PROGRAMA_1A7}", MuestraNotaConvertidaPorEmpresa($id_empresa, ($listaPrograma->resultado)), $bloque_archivos);
                if ($listaPrograma->resultado > 0) {
                    $contador_100_porciento++;
                }
                $acumulador_100_porciento = $listaPrograma->resultado + $acumulador_100_porciento;
            }
            //echo $listaPrograma->avance_malla;
            $bloque_archivos = str_replace("{RUT}", ($rut), $bloque_archivos);
            $bloque_archivos = str_replace("{CLAVE_RUT}", substr($rut, 0, 4), $bloque_archivos);
            if ($listaPrograma->opcional === NULL) {
                $acumula_avance = $listaPrograma->avance_malla + $acumula_avance;
                //echo $listaPrograma->avance_malla;
                //echo "<br>";
                $cuenta_programas++;
            }
        }


            /*$time_elapsed_secs = round(microtime(true) * 1000) - $start;
    $time_elapsed= gmdate("H:i:s", $time_elapsed_secs);
    echo "<br>Int_7 : $time_elapsed<br><br>"; */



    } else {
        $bloque_archivos = file_get_contents("views/integracion/row_lms_programa.html");
    }




    $start = round(microtime(true) * 1000);
    $arreglo[0]              = $bloque_archivos;
    $promedio_avance_general = round($acumula_avance / $cuenta_programas);
    $arreglo[1]              = $promedio_avance_general;
    if ($id_objeto) {
        $arreglo[2] = $nota_objeto_seleccionado;
    } else {
        $arreglo[2] = round($acumulador_100_porciento / $contador_100_porciento);
    }
    $arreglo[3] = $cuenta_programas;

    //$time_elapsed_secs = round(microtime(true) * 1000) - $start;
    //$time_elapsed= gmdate("H:i:s", $time_elapsed_secs);
    //echo "<br>Int_8 : $time_elapsed<br><br>";
    //echo "<br>".$listaPrograma->nombre_programa;//
    //echo "<br>promedio $promedio_avance_general, acuumulad avance $acumula_avance/ cuenta programas $cuenta_programas";
    return ($arreglo);
}
function mes_3letras($mes)
{
    if ($mes == 1) {
        $mestxt = "ENE";
    }
    if ($mes == 2) {
        $mestxt = "FEB";
    }
    if ($mes == 3) {
        $mestxt = "MAR";
    }
    if ($mes == 4) {
        $mestxt = "ABR";
    }
    if ($mes == 5) {
        $mestxt = "MAY";
    }
    if ($mes == 6) {
        $mestxt = "JUN";
    }
    if ($mes == 7) {
        $mestxt = "JUL";
    }
    if ($mes == 8) {
        $mestxt = "AGO";
    }
    if ($mes == 9) {
        $mestxt = "SEP";
    }
    if ($mes == 10) {
        $mestxt = "OCT";
    }
    if ($mes == 11) {
        $mestxt = "NOV";
    }
    if ($mes == 12) {
        $mestxt = "DIC";
    }
    return $mestxt;
}
