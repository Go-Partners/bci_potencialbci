<?php

ini_set('session.cookie_secure',1);
ini_set('session.cookie_httponly',1);
ini_set('session.use_only_cookies',1);
ini_set('session.cookie_secure', '1');
ini_set('session.cookie_httponly', '1');
ini_set('session.use_only_cookies', '1');

session_start();

$varieb = "Vm0wd2QyUXlVWGxWV0d4V1YwZDRWMVl3WkRSV01WbDNXa1JTVjAxV2JETlhhMUpUVmpBeFYySkVUbGhoTVVwVVZqQmFTMlJIVmtkWGJGcHBWa1phZVZadGVGWmxSbGw1Vkd0c2FsSnRhRzlVVjNOM1pVWmFkR05GWkZSTmJFcEpWbTEwVjFWdFNsWlhiR2hYWWxob2VsUlVSbUZqVmtaMFVteFNUbUpGY0VwV2JURXdZVEZrU0ZOclpHcFNWR3hoVm1wT1UxSXhjRlpYYlVaclVqQTFSMVV5TVRSVk1rcElaSHBHVjFaRmIzZFdha1poVjBaT2NtRkhhRk5sYlhoWFZtMXdUMVF3TUhoalJscFlZbFZhY2xWcVFURlNNV1J5VjI1a1YwMUVSa1pWYkZKSFZqRmFSbUl6WkZkaGExcG9WakJhVDJOdFJraGhSazVzWWxob1dGWnRNWGRVTVZGM1RVaG9hbEpzY0ZsWmJHaFRWMFpTVjJGRlRsTmlSbkJaV2xWb2ExWXdNVVZTYTFwV1lrWktSRlpxU2tkamJVVjZZVVphYUdFeGNHOVdha0poVkRKT2RGSnJaRmhpVjJoeldXeG9iMkl4V1hoYVJGSnBUV3RzTkZaSGRHdFdiVXBIVjJ4U1dtSkdXbWhaTW5oWFkxWkdWVkpzVGs1WFJVcElWbXBLTkZReFdsaFRhMlJxVW14d1dGbHNhRk5OTVZweFUydDBWMVpyY0ZwWGExcHJZVWRGZUdOR2JGaGhNVnBvVmtSS1RtVkdjRWxVYldoVFRXNW9WVlpHWTNoaU1XUnpWMWhvWVZKR1NuQlVWM1J6VGxaYWRFNVZPVmRpVlhCSVZqSjRVMWR0U2tkWGJXaGFUVlp3YUZwRlpGTlRSa3B5VGxaT2FWSnRPVE5XTW5oWFlqSkZlRmRZWkU1V1ZscFVXV3RrVTFsV1VsWlhiVVpPVFZad2VGVXlkREJXTVZweVkwWndXR0V4Y0ROWmEyUkdaV3hHY21KR2FGaFRSVXBKVm10U1MxVXhXWGhYYmxaVllrZG9jRlpxU205bGJHUllaVWM1YVUxcmJEUldNalZUVkd4a1NGVnNXbFZXTTFKNlZHeGFWMlJIVWtoa1IyaHBVbGhCZDFac1pEUmpNV1IwVTJ0b2FGSnNTbGhVVlZwM1ZrWmFjVk5yWkZOaVJrcDZWa2N4YzFVeVNuSlRiVVpYVFc1b1dGbHFTa1psUm1SWldrVTFWMVpzY0ZWWFZsSkhaREZaZUdKSVNsaGhNMUpVVlcxNGQyVkdWWGxrUjBacFVteHdlbFV5ZUhkWGJGcFhZMGhLVjFaRldreFdNVnBIWTIxS1IxcEhiRmhTVlhCS1ZtMTBVMU14VlhoWFdHaFhZbXhhVmxsc1pHOVdSbEpZVGxjNVYxWnNjRWhYVkU1dllWVXhjbUpFVWxkTlYyaDJWakJrUzFKck5WZFdiRlpYVFRGS05sWkhkR0ZXYlZaWVZXdG9hMUp0YUZSVVZXaERVMnhhYzFwRVVtcE5WMUl3VlRKMGIyRkdTbk5UYkdoVlZsWndNMVpyV21GalZrNXlXa1pPYVZKcmNEWldhMk40WXpGVmVWTnVTbFJpVlZwWVdWUkdkMkZHV2xWU2ExcHNVbTFTZWxsVldsTmhSVEZaVVc1b1YxWXphSEpaYWtaclVqRldjMkZGT1ZkV1ZGWmFWbGN4TkdReVZrZFdibEpyVWtWS2IxbFljRWRsVmxKelZtMDVXR0pHY0ZoWk1HaExWMnhhV0ZWclpHRldNMmhJV1RJeFMxSXhjRWRhUms1WFYwVktNbFp0Y0VkWlYwVjRWbGhvV0ZkSGFGWlpiWGhoVm14c2NsZHJkR3BTYkZwNFZXMTBNRll4V25OalJXaFhWak5TVEZsVVFYaFNWa3B6Vkd4YVUySkZXWHBXVlZwR1QxWkNVbEJVTUQwPQ";	
require_once ("includes/include.php");
header('X-Frame-Options: SAMEORIGIN');
header('X-XSS-Protection: 1; mode=block');

//ini_set('display_errors', 1);ini_set('display_startup_errors', 1);error_reporting(E_ALL);//exit();//
//exit();
ini_set('session.cookie_secure',1);
ini_set('session.cookie_httponly',1);
ini_set('session.use_only_cookies',1);    

    require_once ("includes/include.php");
		if($_GET["__cf_waf_tk__"]){
				echo "<script>		alert('Bloqueado');		location.href='https://google.cl/';		</script>";		exit;
		}
    if($_GET["LOGININFO"]){
        ini_set('display_errors', 1);ini_set('display_startup_errors', 1);error_reporting(E_ALL);
        include('phpseclib1.0.11/Crypt/RSA.php');
        //include('phpseclib/Crypt/RSA.php');
        
			$pi_key = openssl_pkey_get_private($llave_privada);
			var_dump($pi_key);
			echo "\r\n";
			$rsa = new Crypt_RSA();
			$rsa->loadKey($llave_privada);
			$pi_key =  openssl_pkey_get_private($rsa);
			var_dump($pi_key);
   		echo "\r\n";
			echo "<br><br>opcion1<br>";

			//rod // Decrypt the data using the private key and store the results in $decrypted
			$res=openssl_private_decrypt($variable_recibida, $decrypted, openssl_pkey_get_private($llave_privada, ""));
			//print_r($res);
			
			//echo "Rod 5<br/>";			echo "Decrypted Data = ".$decrypted;			echo "<br/>";
			
      $rsa = new Crypt_RSA();
      $rsa->loadKey($llave_privada); // private key

      //echo $rsa->decrypt($variable_recibida);

        $public_key="AAAAB3NzaC1yc2EAAAADAQABAAABAQDBe8liQmVtWWvQ7RgbP2cS1n1KU9c9+i+DCPKF2Zgk8SS3v7dqu1zq1uVXm2JtMQFzxjar1b32sVsBBgR/SSLphTcPWC95e1ZtNqlQgZ16zIZqzwc3JdfBMqr6tEXne5yJU3mOothaQ41OnSUf/ORdZ6Sb449iYVRRG8wBgzdT7KR/6v/Ps8S1V5LYxUgxGdzQM4gj42yCyTCzfKHAiTFcRTND0SOdlBGv1lcHi9/V+ebZPU0d9n1EPZ7mlgz7Fe2H4Cy9CnnPabxjVMcx3EXNC56KwLX/NmGniR7O3p+dkb8kYUqvvtKbl+fwnbciiPwTR5IoOJBUwtVCAZtORZ49";

        echo "<br><br><br>Opcion 2 <br>";

        $res = openssl_pkey_get_private($llave_privada,$passphrase);


        openssl_private_decrypt($variable_recibida,$newsource,"-----BEGIN RSA PRIVATE KEY-----
MIICdgIBADANBgkqhkiG9w0BAQEFAASCAmAwggJcAgEAAoGBALy1cgDrfU9EvG8R
IPq3CjZe/WyBH63S5Vzdv5W21XOden5cvBrsbLdORRGDxVEh229Hi37Fd0Sey3wY
uGqyYplOqCzvlWxtpwqg2lHn2aW8edsyiPTWByVGpOI4dX11H7Qpe27dsKTDaZdv
ouAfbrLvmOsSgre+8adiZhQjBaYlAgMBAAECgYBrV47sxQd3srK5PvYSh1Hw0aG4
Oc7qUn+TjrOvFtxeMqL+BAQgEIJa1tPk/Z6c4vRuXTUVPH/2cZlwEqO8VZJNhE1Z
Pj9SbSERUPXElWn+E+Y4BkXCYAkXAfpmKblTsSmPKBiAdumurwoGROY/2mF7oz8m
uUqW30DtdhgjHMBG4QJBAPpJEHTd8pTCsO+JBumnJV9j68L9MVt7Ry0Nk9YttsIV
n7BvY17JMiaWl7gj8GnLMaq/CX0ATPDk5I3NsMWtwtkCQQDBBHYXZnk0myhIjUtU
BM+cclxRUz4bSEDiHZJMjmbdeD2Kapg8HsPoXV6dQMGSX6aQ9EPSfozFVHg7ixQF
wdYtAkBpU+41AGJh8Dz90TCzi7/SkP5apKrs0Mh3UUtxyvMqYmc9nOK4tPsB+kYH
HDjEjNpt/M9FZ6b5iZoVgwZtal6hAkEAilWiNV8yGyvgkS8C//J6wUuNMpQQfQkp
x2UeR1QAEVZt9Ng0x1HdYpoYh2ez1C5NeLI4MZKVXZAOo84nyYCE+QJAJetPK4ce
tTXqKg2nS70Ucyy/lv2rzfCl4J45BsdiafeFO90us8uzh+P7OfHU+lgpyUEuPYtj
IuxR/fHaw5TfRQ==
-----END RSA PRIVATE KEY-----");
        echo "Opcion 2 String decrypt : $newsource";



        echo "<br><br><br>opcion 3<br><br><br>";
        function rsa_decrypt($variable_recibida, $llave_privada)
        {
            //Create an instance of the RSA cypher and load the key into it
            $cipher = new Crypt_RSA();
            $cipher->loadKey($llave_privada);
            //Set the encryption mode
            $cipher->setEncryptionMode(CRYPT_RSA_ENCRYPTION_PKCS1);
            //Return the decrypted version
            return $cipher->decrypt($variable_recibida);
        }

        $opcion_3=rsa_decrypt($variable_recibida, $llave_privada);
        print_r($opcion_3);

        echo "<br><br><br>opcion 4 <br><br><br>";
        openssl_private_decrypt($variable_recibida, $variable_desrecibida, $llave_privada);
        echo   "descencirptada $variable_desrecibida<br>";
        var_dump(openssl_private_decrypt($variable_recibida, $output, $llave_privada));
        var_dump($output);





exit;

    }
    ini_set('session.cookie_httponly',1);
    ini_set('session.use_only_cookies',1);

    $arreglo_post 			= $_POST;
    $arreglo_get 				= $_GET;
    $arreglo_request	 	= $_REQUEST;
    
    $_POST 			= VerificaArregloSQLInjectionV2($arreglo_post);
    $_GET 			= VerificaArregloSQLInjectionV2($arreglo_get);
    $_REQUEST 	= VerificaArregloSQLInjectionV2($arreglo_request);

    // echo " <br />POST despues";//print_r($_POST);//exit;//echo $_GET["sw"]." <--><br />";
    $seccion = (($_GET["sw"]));
    $seccion = str_replace("%", "", $seccion);
    $seccion = str_replace("'", "", $seccion);
    $seccion = str_replace('"', '', $seccion);
    $seccion = str_replace(' ', '', $seccion);
    $seccion = str_replace(" ", "", $seccion);
    //echo "<br />"; print_r($_SESSION);echo "<br />PHP_SELF ";echo $_SERVER['PHP_SELF'];echo "<br />SERVER_NAME ";echo $_SERVER['SERVER_NAME'];echo "<br />HTTPS ";echo $_SERVER['HTTPS'];echo "<br />HTTP_HOST ";echo $_SERVER['HTTP_HOST'];echo "<br />";

    if ($_SERVER['HTTPS'] == 'on') {
        $https = 1;
    }
    if (strpos($_SERVER['SERVER_NAME'], 'www.') !== false) {
        $wwwok = 1;
    } //echo "<br>https $https wwwok $wwwok";//sleep(5);

    if (!$seccion) {
        session_start();
        $_SESSION = array();
        if (isset($_COOKIE[session_name() ])) {
            setcookie(session_name() , '', time() - 42000, '/','secure','httpOnly');
        }
            session_destroy();
        // echo "destruye";    //echo "".$url_front."views/home/login.html";
        if ($https <> 1 and $wwwok <> 1) {
            echo "    <script>location.href='" . $url_front . "';    </script>";
        }

          //echo "<br>Viene con www y https<br>";
         // echo  "" . $url_front . "/front/views/home/login.html"; sleep(5);
    //    $PRINCIPAL = FuncionesTransversales(file_get_contents("" . $url_front . "/front/views/home/login.html"));
        $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/login.html"));
        $token_fecha_hora = Encodear3(date("Y-m-d") . " " . date("H:i:s"));
        $PRINCIPAL = str_replace("{TOKEN_FECHA_HORA}", $token_fecha_hora, $PRINCIPAL);
        session_start();
        $_SESSION["token"] = $token_fecha_hora;
        // print_r($_SESSION);
        echo $PRINCIPAL;
        exit();
    }
    if ($_GET["ide"] <> '') {
        $siesempresa = Verificasiesempresa(Decodear3($_GET["ide"]));
        if ($siesempresa == 1) {
            $_SESSION["id_empresa"] = Decodear3($_GET["ide"]);
        }
    }
    if ($_SESSION["id_empresa"]) {
        $id_empresa = $_SESSION["id_empresa"];
    }
    // BUSCADOR BIBLIOTECA
    if (isset($_GET['busca_archivos'])) {
        $PRINCIPAL = ListadoNoticias(FuncionesTransversales(file_get_contents("views/biblioteca/entorno.html")) , $id_empresa, "", "");
        $PRINCIPAL = BarraNavegacion($PRINCIPAL, $seccion);
        $PRINCIPAL = ColocaMenuSecundario($PRINCIPAL, $_SESSION["id_empresa"]);
        $PRINCIPAL = str_replace("{ENTORNO_BIBLIOTECA}", biblioteca_archivos_busqueda(FuncionesTransversales(file_get_contents("views/biblioteca/resultados.html")) , $_GET['busca_archivos'], $id_empresa) , $PRINCIPAL);
        echo $PRINCIPAL;
        exit;
    }
    $valida_usuario_logueado = UsuarioEnBasePersonaPorEmpresa($_SESSION["user_"], $_SESSION["id_empresa"]);
    // echo "valida_usuario_logueado $valida_usuario_logueado";
    // print_r($valida_usuario_logueado);
    /*if(count($valida_usuario_logueado)==0){
    $PRINCIPAL=FuncionesTransversales(file_get_contents("views/home/login.html"));
    echo $PRINCIPAL;
    exit;
    }*/
    // echo "<br />$seccion, $id_empresa"; exit();
    ValidarSesion($seccion, $id_empresa, $url_front);
    if (!$seccion) {
        session_start();
        $_SESSION = array();
        if (isset($_COOKIE[session_name() ])) {
            setcookie(session_name() , '', time() - 42000, '/');
        }
        session_destroy();
        // $PRINCIPAL=FuncionesTransversales(file_get_contents("views/home/login.html"));
        $PRINCIPAL = FuncionesTransversales(file_get_contents("" . $url_front . "/front/views/home/login.html"));
        $token_fecha_hora = Encodear3(date("Y-m-d") . " " . date("H:i:s"));
        $PRINCIPAL = str_replace("{TOKEN_FECHA_HORA}", $token_fecha_hora, $PRINCIPAL);
        session_start();
        $_SESSION["token"] = $token_fecha_hora;
        echo $PRINCIPAL;
    }
    else if ($seccion == "GuardaLogVideoVisto") {
        // ValidarSesion($_POST["tipo_video"], $id_empresa);
    }
    else if($seccion=="homebchr"){


        echo "<script>location.href='?sw=home_misprogramas';</script>";

    }

     else if ($seccion == "grriesgo") {

         //
         $datos=TraigoUltimoJsonPorRut($_SESSION["user_"]);
         $value=$datos[0]->json_completo;
        // $datos='{"menu":[{"number":0,"check":true,"type":"video","url":"content/video/Introduccion_Contexto_V01.mp4","subtitle":"content/video/Introduccion_Contexto_V01.es.vtt"},{"number":1,"check":true,"type":"video","url":"content/video/Introduccion_Contexto_V01.mp4","subtitle":"content/video/Introduccion_Contexto_V01.es.vtt"},{"number":2,"check":true,"type":"video","url":"content/video/Video_02_Normativa_V01_1.mp4","subtitle":"content/video/Video_02_Normativa_V01.es.vtt"},{"number":3,"check":true,"type":"video","url":"content/video/Introduccion_Contexto_V01.mp4","subtitle":"content/video/Introduccion_Contexto_V01.es.vtt"},{"number":4,"check":true,"type":"video","url":"content/video/Video_04_Normativa_V01.mp4","subtitle":"content/video/Video_04_Normativa_V01.es.vtt"},{"number":5,"check":true,"message":"","type":"quiz"},{"number":6,"check":true,"message":"","type":"celular"},{"number":7,"check":true,"message":"","type":"instrucciones"}],"quiz":{"bestscore":3,"batery":[{"number":0,"obligatory":true,"respond":2},{"number":2,"obligatory":true,"respond":1},{"number":3,"obligatory":true,"respond":0},{"number":8,"obligatory":false,"respond":1},{"number":4,"obligatory":true,"respond":2},{"number":5,"obligatory":true,"respond":null},{"number":1,"obligatory":true,"respond":null},{"number":15,"obligatory":false,"respond":null},{"number":6,"obligatory":true,"respond":null},{"number":22,"obligatory":false,"respond":null}],"intentos":[{"score":3,"quiz":[{"number":2,"obligatory":true,"respond":1},{"number":17,"obligatory":false,"respond":2},{"number":5,"obligatory":true,"respond":2},{"number":1,"obligatory":true,"respond":2},{"number":0,"obligatory":true,"respond":2},{"number":21,"obligatory":false,"respond":2},{"number":3,"obligatory":true,"respond":2},{"number":6,"obligatory":true,"respond":2},{"number":19,"obligatory":false,"respond":2},{"number":4,"obligatory":true,"respond":2}]},{"score":4,"quiz":[{"number":3,"obligatory":true,"respond":0},{"number":0,"obligatory":true,"respond":1},{"number":22,"obligatory":false,"respond":2},{"number":6,"obligatory":true,"respond":1},{"number":1,"obligatory":true,"respond":1},{"number":17,"obligatory":false,"respond":2},{"number":5,"obligatory":true,"respond":1},{"number":12,"obligatory":false,"respond":2},{"number":2,"obligatory":true,"respond":2},{"number":4,"obligatory":true,"respond":2}]},{"score":4,"quiz":[{"number":5,"obligatory":true,"respond":2},{"number":0,"obligatory":true,"respond":2},{"number":4,"obligatory":true,"respond":2},{"number":6,"obligatory":true,"respond":2},{"number":1,"obligatory":true,"respond":2},{"number":7,"obligatory":false,"respond":2},{"number":3,"obligatory":true,"respond":2},{"number":8,"obligatory":false,"respond":2},{"number":2,"obligatory":true,"respond":2},{"number":12,"obligatory":false,"respond":2}]},{"score":4,"quiz":[{"number":3,"obligatory":true,"respond":2},{"number":8,"obligatory":false,"respond":2},{"number":0,"obligatory":true,"respond":2},{"number":17,"obligatory":false,"respond":2},{"number":10,"obligatory":false,"respond":2},{"number":5,"obligatory":true,"respond":2},{"number":4,"obligatory":true,"respond":2},{"number":6,"obligatory":true,"respond":2},{"number":2,"obligatory":true,"respond":2},{"number":1,"obligatory":true,"respond":2}]},{"score":4,"quiz":[{"number":0,"obligatory":true,"respond":2},{"number":7,"obligatory":false,"respond":2},{"number":3,"obligatory":true,"respond":2},{"number":4,"obligatory":true,"respond":2},{"number":21,"obligatory":false,"respond":2},{"number":6,"obligatory":true,"respond":2},{"number":20,"obligatory":false,"respond":2},{"number":2,"obligatory":true,"respond":2},{"number":1,"obligatory":true,"respond":2},{"number":5,"obligatory":true,"respond":2}]},{"score":3,"quiz":[{"number":5,"obligatory":true,"respond":0},{"number":4,"obligatory":true,"respond":1},{"number":8,"obligatory":false,"respond":2},{"number":2,"obligatory":true,"respond":0},{"number":19,"obligatory":false,"respond":1},{"number":0,"obligatory":true,"respond":2},{"number":3,"obligatory":true,"respond":0},{"number":1,"obligatory":true,"respond":1},{"number":20,"obligatory":false,"respond":2},{"number":6,"obligatory":true,"respond":0}]},{"score":3,"quiz":[{"number":6,"obligatory":true,"respond":2},{"number":4,"obligatory":true,"respond":0},{"number":8,"obligatory":false,"respond":1},{"number":3,"obligatory":true,"respond":1},{"number":17,"obligatory":false,"respond":2},{"number":5,"obligatory":true,"respond":1},{"number":2,"obligatory":true,"respond":1},{"number":0,"obligatory":true,"respond":1},{"number":19,"obligatory":false,"respond":2},{"number":1,"obligatory":true,"respond":2}]},{"score":2,"quiz":[{"number":4,"obligatory":true,"respond":2},{"number":5,"obligatory":true,"respond":0},{"number":6,"obligatory":true,"respond":1},{"number":2,"obligatory":true,"respond":2},{"number":14,"obligatory":false,"respond":0},{"number":11,"obligatory":false,"respond":1},{"number":0,"obligatory":true,"respond":2},{"number":9,"obligatory":false,"respond":0},{"number":1,"obligatory":true,"respond":0},{"number":3,"obligatory":true,"respond":2}]},{"score":5,"quiz":[{"number":2,"obligatory":true,"respond":1},{"number":5,"obligatory":true,"respond":2},{"number":1,"obligatory":true,"respond":0},{"number":10,"obligatory":false,"respond":1},{"number":16,"obligatory":false,"respond":2},{"number":4,"obligatory":true,"respond":0},{"number":22,"obligatory":false,"respond":1},{"number":0,"obligatory":true,"respond":2},{"number":3,"obligatory":true,"respond":0},{"number":6,"obligatory":true,"respond":1}]},{"score":3,"quiz":[{"number":2,"obligatory":true,"respond":2},{"number":5,"obligatory":true,"respond":1},{"number":0,"obligatory":true,"respond":0},{"number":1,"obligatory":true,"respond":2},{"number":15,"obligatory":false,"respond":1},{"number":4,"obligatory":true,"respond":0},{"number":14,"obligatory":false,"respond":2},{"number":6,"obligatory":true,"respond":1},{"number":3,"obligatory":true,"respond":0},{"number":17,"obligatory":false,"respond":2}]},{"score":2,"quiz":[{"number":0,"obligatory":true,"respond":2},{"number":3,"obligatory":true,"respond":1},{"number":2,"obligatory":true,"respond":0},{"number":10,"obligatory":false,"respond":2},{"number":12,"obligatory":false,"respond":1},{"number":4,"obligatory":true,"respond":0},{"number":7,"obligatory":false,"respond":2},{"number":1,"obligatory":true,"respond":1},{"number":6,"obligatory":true,"respond":0},{"number":5,"obligatory":true,"respond":2}]},{"score":2,"quiz":[{"number":3,"obligatory":true,"respond":1},{"number":12,"obligatory":false,"respond":2},{"number":2,"obligatory":true,"respond":2},{"number":10,"obligatory":false,"respond":2},{"number":4,"obligatory":true,"respond":0},{"number":0,"obligatory":true,"respond":2},{"number":5,"obligatory":true,"respond":0},{"number":16,"obligatory":false,"respond":1},{"number":6,"obligatory":true,"respond":2},{"number":1,"obligatory":true,"respond":2}]},{"score":2,"quiz":[{"number":11,"obligatory":false,"respond":0},{"number":0,"obligatory":true,"respond":1},{"number":16,"obligatory":false,"respond":2},{"number":20,"obligatory":false,"respond":0},{"number":1,"obligatory":true,"respond":1},{"number":3,"obligatory":true,"respond":2},{"number":4,"obligatory":true,"respond":0},{"number":5,"obligatory":true,"respond":1},{"number":6,"obligatory":true,"respond":2},{"number":2,"obligatory":true,"respond":0}]}]}}';
        //echo json_encode($datos);
        //$value='{"value":"{"menu":[{"number":0,"check":true,"type":"video","url":"content/video/Introduccion_Contexto_V01.mp4","subtitle":"content/video/Introduccion_Contexto_V01.es.vtt"},{"number":1,"check":true,"type":"video","url":"content/video/Introduccion_Contexto_V01.mp4","subtitle":"content/video/Introduccion_Contexto_V01.es.vtt"},{"number":2,"check":true,"type":"video","url":"content/video/Video_02_Normativa_V01_1.mp4","subtitle":"content/video/Video_02_Normativa_V01.es.vtt"},{"number":3,"check":true,"type":"video","url":"content/video/Introduccion_Contexto_V01.mp4","subtitle":"content/video/Introduccion_Contexto_V01.es.vtt"},{"number":4,"check":true,"type":"video","url":"content/video/Video_04_Normativa_V01.mp4","subtitle":"content/video/Video_04_Normativa_V01.es.vtt"},{"number":5,"check":true,"message":"","type":"quiz"},{"number":6,"check":true,"message":"","type":"celular"},{"number":7,"check":true,"message":"","type":"instrucciones"}],"quiz":{"bestscore":4,"batery":null,"intentos":[{"score":3,"quiz":[{"number":2,"obligatory":true,"respond":1},{"number":17,"obligatory":false,"respond":2},{"number":5,"obligatory":true,"respond":2},{"number":1,"obligatory":true,"respond":2},{"number":0,"obligatory":true,"respond":2},{"number":21,"obligatory":false,"respond":2},{"number":3,"obligatory":true,"respond":2},{"number":6,"obligatory":true,"respond":2},{"number":19,"obligatory":false,"respond":2},{"number":4,"obligatory":true,"respond":2}]},{"score":4,"quiz":[{"number":3,"obligatory":true,"respond":0},{"number":0,"obligatory":true,"respond":1},{"number":22,"obligatory":false,"respond":2},{"number":6,"obligatory":true,"respond":1},{"number":1,"obligatory":true,"respond":1},{"number":17,"obligatory":false,"respond":2},{"number":5,"obligatory":true,"respond":1},{"number":12,"obligatory":false,"respond":2},{"number":2,"obligatory":true,"respond":2},{"number":4,"obligatory":true,"respond":2}]}]}}"}';
        $param = array(
        "id_curso" => "bch_ro_gl1",
        "value" => $value
    );


    //echo json_encode($value);
    //echo ($datos);
    echo "";
    Exit;



    }


   
     elseif ($seccion == "entrada_inscripcion") {
     	exit;
          $_SESSION["id_empresa"] = "77";
        //print_r($_POST);
        $user = ($_REQUEST["user"]);
        //echo "user $user"; sleep(1);
        if ($user <> "" and $rut_usuario == "") {
            $rut_usuario = VerificaUsuarioUserRut($user, $_SESSION["id_empresa"]);
            if ($rut_usuario == "") {

                session_start();
                LogInsertUsuario($user,$_SESSION["id_empresa"]);
                Sleep(1);
                $_SESSION["id_empresa"] = "77";
                $_SESSION["user_"] = $user;
                echo "    <script>         location.href='?sw=medicion_encuestas_preguntas_lb&idm=11';     </script>";
            }
            else {
                session_start();
                $_SESSION["id_empresa"] = "77";
                $_SESSION["user_"] = $user;
                echo "    <script>         location.href='?sw=medicion_encuestas_preguntas_lb&idm=11';     </script>";
            }
        } else {
             echo "    <script>         location.href='?sw=loggopartners';     </script>";  exit();
        }


    }
  elseif ($seccion == "entrada_inscripcion_anonima") {
  	exit();
          $_SESSION["id_empresa"] = "77";
            $id_enc=$_POST["id_enc"];
        //print_r($_POST);   exit();
        $user =  rand(10000, 90000);
        //echo "user $user"; sleep(1);
        if ($user <> "" and $rut_usuario == "") {
            $rut_usuario = VerificaUsuarioUserRut($user, $_SESSION["id_empresa"]);
            if ($rut_usuario == "") {

                session_start();
                LogInsertUsuario($user,$_SESSION["id_empresa"]);
                Sleep(1);
                $_SESSION["id_empresa"] = "77";
                $_SESSION["user_"] = $user;
                echo "    <script>         location.href='?sw=medicion_encuestas_preguntas_lb&idm=".$id_enc."';     </script>";
            }
            else {
                session_start();
                $_SESSION["id_empresa"] = "77";
                $_SESSION["user_"] = $user;
                echo "    <script>         location.href='?sw=medicion_encuestas_preguntas_lb&idm=12';     </script>";
            }
        } else {
             echo "    <script>         location.href='?sw=loggopartners';     </script>";  exit();
        }


    }
     elseif ($seccion == "sendgrid_test") {

    print_r($_POST);


    $rut=$_POST["rut"];
    $to=$_POST["hacia"];
    $nombreto=$_POST["destinatario"];
    $from=$_POST["desde"];
    $nombrefrom=$_POST["remitente"];
    $subject=$_POST["asunto"];
    $titulo1=$_POST["titulo1"];
    $subtitulo1=$_POST["subtitulo1"];
    $texto1=$_POST["texto1"];
    $texto2=$_POST["texto2"];
    $texto3=$_POST["texto3"];
    $texto4=$_POST["texto4"];
    $id_empresa=$_POST["id_empresa"];
    $template=$_POST["template"];
    $envio=$_POST["envio"];
    $key=$_POST["rut"];


        if($envio==1){
                SendGrid_Email($to, $nombreto, $from, $nombrefrom, $tipo, $subject, $titulo1, $subtitulo1, $texto1, $url, $texto_url, $texto2, $texto3, $texto4, $logo, $id_empresa, $url, $tipomensaje, $rut, $key, $template);

        }

        echo "
                <form action='?sw=sendgrid_test' method='post'>

                    RUT: <input type='text' name='rut' value='10365815'><br>
                    Hacia: <input type='text' name='hacia' value='rod@gop.cl'><br>
                    HaciaDest: <input type='text' name='destinatario' value='rod'><br>
                    Desde: <input type='text' name='desde' value='notificaciones@gcloud.cl'><br>
                    DesdeRem: <input type='text' name='remitente' value='gcloud'><br>

                    Asunto: <input type='text' name='asunto' value='Asunto Prueba'><br>
                    Titulo1: <input type='text' name='titulo1'  value='Titulo Prueba'><br>
                    Subtitulo1: <input type='text' name='subtitulo1' value='Subtitulo Prueba'><br>

                    texto1: <input type='text' name='texto1' value='texto1 texto1 texto1 texto1'><br>
                    texto1: <input type='text' name='texto2' value='texto2 texto2 texto2 texto2'><br>
                    texto1: <input type='text' name='texto3' value='texto3 texto3 texto3 texto3'><br>
                    texto1: <input type='text' name='texto4' value='texto4 texto4 texto4 texto4'><br>

                    id_empresa: <input type='text' name='id_empresa' value='62'><br>
            template: <input type='text' name='template' value='template_notificacion'><br>
                    <input type='hidden' name='envio' id='envio' value='1'>
                    <input type='submit'>
                </form>
                ";
            exit();

    }
    else if ($seccion == "FinModCond") {
        $id_objeto = "rf_cod_cond_m1";
        $id_curso = "rf_cod_cond";
        $rut = $_SESSION["user_"];
        $id_empresa = $_SESSION["id_empresa"];
        $datos_objeto = DatosObjeto($id_objeto);
        // echo "id objeto: $id_objeto<br /> id curso: $id_curso <br /> rut: $rut <br />id empresa:  $id_empresa;";exit;
        $nota_obtenida = 100;
        $estado = 1;
        // HTML_ActualizarDatosCierre($id_curso, $rut, $id_empresa, $estado, "10");
        FinalizaObjetoFullDatos($rut, $id_objeto, $id_empresa);
        HTML_ActualizarDatosCierre($id_curso, $rut, $id_empresa, $estado, $nota_obtenida, "APROBADO");
        $siguiente_objeto = DatosObjetoDadoRutCursoyOrden($datos_objeto[0]->id_curso, $datos_objeto[0]->orden + 1);
        // Ingreso LOG de Tiempo
        InsertaLogNavegacion($rut, $id_objeto, $tiempo_navegado, $id_curso);
        // echo date('Y-m-d H:i:s');
    }
         else if ($seccion == "ver_sesion_usuario") {
        $rut_enviado = $_GET["rut_enviado"];
        $_SESSION["user_"] =$rut_enviado;

        echo "<br><center><div class='alert alert-success'>Realizado Correctamente $rut_enviado</div></center><br><br>";
        echo "    <script>         location.href='?sw=potencial_landing';     </script>"; exit;	
       exit();
    }
    
     else if ($seccion == "FinalizaModuloFullObjetoAjax") {
        $id_objeto = $_POST["id_objeto"];
        $rut = $_SESSION["user_"];
        $id_empresa = $_SESSION["id_empresa"];

        FinalizaObjetoFullDatos($rut, $id_objeto, $id_empresa);

        InsertaLogNavegacion($rut, $id_objeto, $tiempo_navegado, $id_curso);
        echo "<br><center><div class='alert alert-success'>Realizado Correctamente</div></center><br><br>";
        // echo date('Y-m-d H:i:s');
    }
    else if ($seccion == "FinModCondGenerico") {
        $id_objeto = $_POST["id_objeto"];
        $datos_objeto = DatosObjeto($id_objeto);
        $id_curso = $datos_objeto[0]->id_curso;
        $rut = $_SESSION["user_"];
        $id_empresa = $_SESSION["id_empresa"];
        $datos_objeto = DatosObjeto($id_objeto);
        $id_curso = $datos_objeto[0]->id_curso;
        // echo "id objeto: $id_objeto<br /> id curso: $id_curso <br /> rut: $rut <br />id empresa:  $id_empresa;";exit;
        $nota_obtenida = $_POST["nota_obtenida"];
        // $nota_obtenida=100;
        $estado = 1;
        if ($nota_obtenida >= $datos_objeto[0]->nota_aprobacion) {
            FinalizaObjetoFullDatos($rut, $id_objeto, $id_empresa, $nota_obtenida);
            HTML_ActualizarDatosCierre($datos_objeto[0]->id_curso, $rut, $id_empresa, $estado, $nota_obtenida, "APROBADO");
            $siguiente_objeto = DatosObjetoDadoRutCursoyOrden($datos_objeto[0]->id_curso, $datos_objeto[0]->orden + 1);
        }
        else {
            // HTML_ActualizarDatosCierre($id_curso, $rut, $id_empresa, $estado, "10");
            // FinalizaObjetoFullDatos($rut, $id_objeto, $id_empresa);
            // HTML_ActualizarDatosCierre($id_curso, $rut, $id_empresa, $estado, $nota_obtenida, "APROBADO");
            // $siguiente_objeto=DatosObjetoDadoRutCursoyOrden($datos_objeto[0]->id_curso, $datos_objeto[0]->orden+1);
        }
        // Ingreso LOG de Tiempo
        InsertaLogNavegacion($rut, $id_objeto, $tiempo_navegado, $id_curso);
        // echo date('Y-m-d H:i:s');
    }
    else if ($seccion == "FinMilionairep") {
        $id_objeto = "bci_v2017_cm5";
        $id_curso = "bci_v2017_consumo";
        $rut = $_SESSION["user_"];
        $id_empresa = $_SESSION["id_empresa"];
        $datos_objeto = DatosObjeto($id_objeto);
        // echo "id objeto: $id_objeto<br /> id curso: $id_curso <br /> rut: $rut <br />id empresa:  $id_empresa;";exit;
        $nota_obtenida = 0;
        $estado = 1;
        // HTML_ActualizarDatosCierre($id_curso, $rut, $id_empresa, $estado, "10");
        FinalizaObjetoFullDatos($rut, $id_objeto, $id_empresa, $nota_obtenida);
        // HTML_ActualizarDatosCierre($id_curso, $rut, $id_empresa, $estado, $nota_obtenida, "APROBADO");
        $siguiente_objeto = DatosObjetoDadoRutCursoyOrden($datos_objeto[0]->id_curso, $datos_objeto[0]->orden + 1);
        // Ingreso LOG de Tiempo
        InsertaLogNavegacion($rut, $id_objeto, $tiempo_navegado, $id_curso);
        // echo date('Y-m-d H:i:s');
    }
    else if ($seccion == "FinMilionaire") {
        $id_objeto = "bci_v2017_cm5";
        $id_curso = "bci_v2017_consumo";
        $rut = $_SESSION["user_"];
        $id_empresa = $_SESSION["id_empresa"];
        $datos_objeto = DatosObjeto($id_objeto);
        // echo "id objeto: $id_objeto<br /> id curso: $id_curso <br /> rut: $rut <br />id empresa:  $id_empresa;";exit;
        $nota_obtenida = 100;
        $estado = 1;
        // HTML_ActualizarDatosCierre($id_curso, $rut, $id_empresa, $estado, "10");
        FinalizaObjetoFullDatos($rut, $id_objeto, $id_empresa, $nota_obtenida);
        // HTML_ActualizarDatosCierre($id_curso, $rut, $id_empresa, $estado, $nota_obtenida, "APROBADO");
        $siguiente_objeto = DatosObjetoDadoRutCursoyOrden($datos_objeto[0]->id_curso, $datos_objeto[0]->orden + 1);
        // Ingreso LOG de Tiempo
        InsertaLogNavegacion($rut, $id_objeto, $tiempo_navegado, $id_curso);
        // echo date('Y-m-d H:i:s');
    }
    else if ($seccion == "saveCheck") {
        //
        $rut_jefatura = $_SESSION["user_"];
        $dia = $_POST["dia"];
        $rut = $_POST["rut_colaborador"];
        // Traigo las actividades por dia
        $actividades = CHECK_LIST_PreguntasPorDia($dia);
        foreach($actividades as $act) {
            // echo $_POST[$act->id];
            // echo "<br />";
            CHECK_LIST_InsertaRespuestas($rut_jefatura, $rut, $act->id, $_POST[$act->id], $dia);
        }
        CHECK_LIST_InsertaComentariosFinales($rut_jefatura, $rut, utf8_Decode($_POST["comentarios"]) , utf8_decode($_POST["asistencia"]) , $dia);
        // print_r($_POST);
        echo "<script>
                                    location.href='?sw=home_esc_bp_jof&im=" . Encodear3("bci_esc_bp_jof") . "';
                                    </script>";
        exit;
    }
    else if ($seccion == "ayuda") {
        $PRINCIPAL = FuncionesTransversales(file_get_contents("views/ayuda/" . $id_empresa . "_ayuda.html"));
        $PRINCIPAL = BloqueFooterContenido($PRINCIPAL);
        $PRINCIPAL = ColocarSlider($PRINCIPAL);
        $PRINCIPAL = BarraNavegacion($PRINCIPAL, $seccion);
        $PRINCIPAL = ColocaMenuSecundario($PRINCIPAL, $_SESSION["id_empresa"]);
        echo $PRINCIPAL;
    }
    else if ($seccion == "bchile_mail_curso_rm") {
        $from = "masconectados@masconectados.cl";
        $nombrefrom = "Mas Conectados Banco de Chile";
        $tipo = "text/html";
        $subject = "Nuevo Portal de Desarrollo y Formacion MasConectadosBCH";
        $titulo1 = "Nuevo Portal de Desarrollo y Formacion MasConectadosBCH";
        // $subtitulo1="Â¡Perfil Actualizado en Mas Conectados Banco de Chile!";
        // $subtitulo1="".$datos_usuario[0]->nombre_completo." has actualizado exitosamente tu Perfil Publico.<br /><br />Recuerda que juntos construimos esta nueva forma de estar conectados en el Chile.";
        $texto1 = "";
        $url = "https://www.masconectadosbch.cl";
        $texto_url = "Ir a Mas Conectados Banco de Chile
    ";
        $logo = "https://www.masconectadosbch.cl/front/img/bch_logo_conectados_trans.png";
        /*
        $to="";
        $nombreto="";
        $to="mlarcod@bancochile.cl";
        $nombreto=$datos_usuario[0]->nombre_completo;
        SendGrid_Email($to, $nombreto, $from, $nombrefrom, $tipo, $subject, $titulo1,$subtitulo1,$texto1,$url,$texto_url, $texto2, "", "", "", "", "", "", "", "", "78_curso_template_notificacion_credito_hipotecario.html");
        $to="daniel@gop.cl";
        $nombreto=$datos_usuario[0]->nombre_completo;
        SendGrid_Email($to, $nombreto, $from, $nombrefrom, $tipo, $subject, $titulo1,$subtitulo1,$texto1,$url,$texto_url, $texto2, "", "", "", "", "", "", "", "", "78_curso_template_notificacion_credito_hipotecario.html");
        exit("ok");
        */
        // SendGrid_Email($to, $nombreto, $from, $nombrefrom, $tipo, $subject, $titulo1,$subtitulo1,$texto1,$url,$texto_url, $texto2);
        // $datos=EMAIL_BancoChileRM();
        $datos = EMAIL_TodosTablaEmailRut();
        foreach($datos as $dat) {
            $datos_usuario = TraeDatosBiografiayUsuario($dat->rut, $id_empresa);
            $to = "daniel@gop.cl";
            $nombreto = $datos_usuario[0]->nombre_completo;
            // SendGrid_Email($to, $nombreto, $from, $nombrefrom, $tipo, $subject, $titulo1,$subtitulo1,$texto1,$url,$texto_url, $texto2, "", "", "", "", "", "", "", "", "78_pronto_template_notificacion_contrato_fijo.html");
            // SendGrid_Email($to, $nombreto, $from, $nombrefrom, $tipo, $subject, $titulo1,$subtitulo1,$texto1,$url,$texto_url, $texto2, "", "", "", "", "", "", "", "", "78_pronto_template_notificacion_contrato_fijo.html");
            // SendGrid_Email($to, $nombreto, $from, $nombrefrom, $tipo, $subject, $titulo1,$subtitulo1,$texto1,$url,$texto_url, $texto2, "", "", "", "", "", "", "", "", "curso_template_notificacion_rm");
            SendGrid_Email($to, $nombreto, $from, $nombrefrom, $tipo, $subject, $titulo1, $subtitulo1, $texto1, $url, $texto_url, $texto2, "", "", "", "", "", "", "", "", "curso_template_notificacion_reg_contrato");
            // SendGrid_Email($to, $nombreto, $from, $nombrefrom, $tipo, $subject, $titulo1,$subtitulo1,$texto1,$url,$texto_url, $texto2, "", "", "", "", "", "", "", "", "78_curso_template_notificacion_credito_hipotecario.html");
            // exit;
            $to = $dat->email;
            $nombreto = $datos_usuario[0]->nombre_completo;
            // SendGrid_Email($to, $nombreto, $from, $nombrefrom, $tipo, $subject, $titulo1,$subtitulo1,$texto1,$url,$texto_url, $texto2, "", "", "", "", "", "", "", "", "78_pronto_template_notificacion_contrato_fijo.html");
            // SendGrid_Email($to, $nombreto, $from, $nombrefrom, $tipo, $subject, $titulo1,$subtitulo1,$texto1,$url,$texto_url, $texto2, "", "", "", "", "", "", "", "", "78_curso_template_notificacion_rm.html");
            // SendGrid_Email($to, $nombreto, $from, $nombrefrom, $tipo, $subject, $titulo1,$subtitulo1,$texto1,$url,$texto_url, $texto2, "", "", "", "", "", "", "", "", "78_curso_template_notificacion_reg_contrato.html");
            // SendGrid_Email($to, $nombreto, $from, $nombrefrom, $tipo, $subject, $titulo1,$subtitulo1,$texto1,$url,$texto_url, $texto2, "", "", "", "", "", "", "", "", "78_curso_template_notificacion_credito_hipotecario.html");
            // SendGrid_Email($to, $nombreto, $from, $nombrefrom, $tipo, $subject, $titulo1,$subtitulo1,$texto1,$url,$texto_url, $texto2, "", "", "", "", "", "", "", "", "curso_template_notificacion_rm");
            SendGrid_Email($to, $nombreto, $from, $nombrefrom, $tipo, $subject, $titulo1, $subtitulo1, $texto1, $url, $texto_url, $texto2, "", "", "", "", "", "", "", "", "curso_template_notificacion_reg_contrato");
            echo "correo enviado a " . $to . " - " . $nombreto . "<br />";
            sleep(1);
            // exit;
        }
    }
    else if ($seccion == "bchile_mail_pronto_plazo_fijo") {
        $from = "masconectados@masconectados.cl";
        $nombrefrom = "Mas Conectados Banco de Chile";
        $tipo = "text/html";
        $subject = "Pronto, Nuevo Portal de Desarrollo y Formacion MasConectadosBCH";
        $titulo1 = "Pronto, Nuevo Portal de Desarrollo y Formacion MasConectadosBCH";
        // $subtitulo1="Â¡Perfil Actualizado en Mas Conectados Banco de Chile!";
        $subtitulo1 = "" . $datos_usuario[0]->nombre_completo . " has actualizado exitosamente tu Perfil Publico.<br /><br />Recuerda que juntos construimos esta nueva forma de estar conectados en el Chile.";
        $texto1 = "";
        $url = "https://www.masconectadosbch.cl";
        $texto_url = "Ir a Mas Conectados Banco de Chile
    ";
        $logo = "https://www.masconectadosbch.cl/front/img/bch_logo_conectados_trans.png";
        $to = "";
        $nombreto = "";
        // SendGrid_Email($to, $nombreto, $from, $nombrefrom, $tipo, $subject, $titulo1,$subtitulo1,$texto1,$url,$texto_url, $texto2);
        // $datos=BancoChilePlazoFijo();
        foreach($datos as $dat) {
            $datos_usuario = TraeDatosBiografiayUsuario($dat->rut, $id_empresa);
            $to = "daniel@gop.cl";
            $nombreto = $datos_usuario[0]->nombre_completo;
            SendGrid_Email($to, $nombreto, $from, $nombrefrom, $tipo, $subject, $titulo1, $subtitulo1, $texto1, $url, $texto_url, $texto2, "", "", "", "", "", "", "", "", "78_pronto_template_notificacion_contrato_fijo.html");
            $to = $dat->email;
            $nombreto = $datos_usuario[0]->nombre_completo;
            SendGrid_Email($to, $nombreto, $from, $nombrefrom, $tipo, $subject, $titulo1, $subtitulo1, $texto1, $url, $texto_url, $texto2, "", "", "", "", "", "", "", "", "78_pronto_template_notificacion_contrato_fijo.html");
            echo "correo enviado a " . $to . "<br />";
            sleep(2);
            // exit;
        }
    }
    else if ($seccion == "bchile_mail_pronto_indefinido") {
        $from = "masconectados@masconectados.cl";
        $nombrefrom = "Mas Conectados Banco de Chile";
        $tipo = "text/html";
        $subject = "Pronto, Nuevo Portal de Desarrollo y Formacion MasConectadosBCH";
        $titulo1 = "Pronto, Nuevo Portal de Desarrollo y Formacion MasConectadosBCH";
        // $subtitulo1="Â¡Perfil Actualizado en Mas Conectados Banco de Chile!";
        $subtitulo1 = "" . $datos_usuario[0]->nombre_completo . " has actualizado exitosamente tu Perfil Publico.<br /><br />Recuerda que juntos construimos esta nueva forma de estar conectados en el Chile.";
        $texto1 = "";
        $url = "https://www.masconectadosbch.cl";
        $texto_url = "Ir a Mas Conectados Banco de Chile
    ";
        $logo = "https://www.masconectadosbch.cl/front/img/bch_logo_conectados_trans.png";
        $to = "";
        $nombreto = "";
        // SendGrid_Email($to, $nombreto, $from, $nombrefrom, $tipo, $subject, $titulo1,$subtitulo1,$texto1,$url,$texto_url, $texto2);
        // $datos=BancoChileIndefinidos();
        foreach($datos as $dat) {
            $datos_usuario = TraeDatosBiografiayUsuario($dat->rut, $id_empresa);
            $to = "daniel@gop.cl";
            $nombreto = $datos_usuario[0]->nombre_completo;
            SendGrid_Email($to, $nombreto, $from, $nombrefrom, $tipo, $subject, $titulo1, $subtitulo1, $texto1, $url, $texto_url, $texto2, "", "", "", "", "", "", "", "", "78_pronto_template_notificacion_contrato_indefinido.html");
            $to = $dat->email;
            $nombreto = $datos_usuario[0]->nombre_completo;
            SendGrid_Email($to, $nombreto, $from, $nombrefrom, $tipo, $subject, $titulo1, $subtitulo1, $texto1, $url, $texto_url, $texto2, "", "", "", "", "", "", "", "", "78_pronto_template_notificacion_contrato_indefinido.html");
            echo "correo enviado a " . $to . "<br />";
            sleep(2);
        }
    }
    else if ($seccion == "profile_save_tarjeta") {
        // echo "<br /><br />POST";print_r($_POST);echo "<br /><br />GET";print_r($_GET);
        abstract class SlimStatus

        {
            const FAILURE = 'failure';
            const SUCCESS = 'success';
        }
        class Slim

        {
            public static function getImages($inputName = 'slim')

            {
                $values = Slim::getPostData($inputName);
                // test for errors
                if ($values === false) {
                    return false;
                }
                // determine if contains multiple input values, if is singular, put in array
                $data = array();
                if (!is_array($values)) {
                    $values = array(
                        $values
                    );
                }
                // handle all posted fields
                foreach($values as $value) {
                    $inputValue = Slim::parseInput($value);
                    if ($inputValue) {
                        array_push($data, $inputValue);
                    }
                }
                // return the data collected from the fields
                return $data;
            }
            // $value should be in JSON format
            private static function parseInput($value)
            {
                // if no json received, exit, don't handle empty input values.
                if (empty($value)) {
                    return null;
                }
                // The data is posted as a JSON String so to be used it needs to be deserialized first
                $data = json_decode($value);
                // shortcut
                $input = null;
                $actions = null;
                $output = null;
                $meta = null;
                if (isset($data->input)) {
                    $inputData = null;
                    if (isset($data->input->image)) {
                        $inputData = Slim::getBase64Data($data->input->image);
                    }
                    else if (isset($data->input->field)) {
                        $filename = $_FILES[$data->input->field]['tmp_name'];
                        if ($filename) {
                            $inputData = file_get_contents($filename);
                        }
                    }
                    $input = array(
                        'data' => $inputData,
                        'name' => $data->input->name,
                        'type' => $data->input->type,
                        'size' => $data->input->size,
                        'width' => $data->input->width,
                        'height' => $data->input->height,
                    );
                }
                if (isset($data->output)) {
                    $outputDate = null;
                    if (isset($data->output->image)) {
                        $outputData = Slim::getBase64Data($data->output->image);
                    }
                    else if (isset($data->output->field)) {
                        $filename = $_FILES[$data->output->field]['tmp_name'];
                        if ($filename) {
                            $outputData = file_get_contents($filename);
                        }
                    }
                    $output = array(
                        'data' => $outputData,
                        'name' => $data->output->name,
                        'type' => $data->output->type,
                        'width' => $data->output->width,
                        'height' => $data->output->height
                    );
                }
                if (isset($data->actions)) {
                    $actions = array(
                        'crop' => $data->actions->crop ? array(
                            'x' => $data->actions->crop->x,
                            'y' => $data->actions->crop->y,
                            'width' => $data->actions->crop->width,
                            'height' => $data->actions->crop->height,
                            'type' => $data->actions->crop->type
                        ) : null,
                        'size' => $data->actions->size ? array(
                            'width' => $data->actions->size->width,
                            'height' => $data->actions->size->height
                        ) : null,
                        'rotation' => $data->actions->rotation,
                        'filters' => $data->actions->filters ? array(
                            'sharpen' => $data->actions->filters->sharpen
                        ) : null
                    );
                }
                if (isset($data->meta)) {
                    $meta = $data->meta;
                }
                // We've sanitized the base64data and will now return the clean file object
                return array(
                    'input' => $input,
                    'output' => $output,
                    'actions' => $actions,
                    'meta' => $meta
                );
            }
            // $path should have trailing slash
            public static function saveFile($data, $name, $path = 'multimedia/', $uid = true)

            {
                // Add trailing slash if omitted
                if (substr($path, -1) !== '/') {
                    $path.= '/';
                }
                // Test if directory already exists
                if (!is_dir($path)) {
                    mkdir($path, 0755, true);
                }
                // Sanitize characters in file name
                $name = Slim::sanitizeFileName($name);
                // Let's put a unique id in front of the filename so we don't accidentally overwrite other files
                if ($uid) {
                    $name = uniqid() . '_' . $name;
                }
                // Add name to path, we need the full path including the name to save the file
                $path = $path . $name;
                // store the file
                Slim::save($data, $path);
                // return the files new name and location
                return array(
                    'name' => $name,
                    'path' => $path
                );
            }
            /**
             * Get data from remote URL
             * @param $url
             * @return string
             */
            public static function fetchURL($url, $maxFileSize)

            {
                if (!ini_get('allow_url_fopen')) {
                    return null;
                }
                $content = null;
                try {
                    $content = @file_get_contents($url, false, null, 0, $maxFileSize);
                }
                catch(Exception $e) {
                    return false;
                }
                return $content;
            }
            public static function outputJSON($data)

            {
                header('Content-Type: application/json');
                echo json_encode($data);
            }
            /**
             * http://stackoverflow.com/a/2021729
             * Remove anything which isn't a word, whitespace, number
             * or any of the following characters -_~,;[]().
             * If you don't need to handle multi-byte characters
             * you c_replace rather than mb_ereg_replace
             * @param $str
             * @return string
             */
            public static function sanitizeFileName($str)

            {
                // Basic clean up
                $str = mb_ereg_replace("([^\w\s\d\-_~,;\[\]\(\).])", '', $str);
                // Remove any runs of periods
                $str = mb_ereg_replace("([\.]{2,})", '', $str);
                return $str;
            }
            /**
             * Gets the posted data from the POST or FILES object. If was using Slim to upload it will be in POST (as posted with hidden field) if not enhanced with Slim it'll be in FILES.
             * @param $inputName
             * @return array|bool
             */
            private static function getPostData($inputName)
            {
                $values = array();
                if (isset($_POST[$inputName])) {
                    $values = $_POST[$inputName];
                }
                else if (isset($_FILES[$inputName])) {
                    // Slim was not used to upload this file
                    return false;
                }
                return $values;
            }
            /**
             * Saves the data to a given location
             * @param $data
             * @param $path
             * @return bool
             */
            private static function save($data, $path)
            {
                if (!file_put_contents($path, $data)) {
                    return false;
                }
                return true;
            }
            /**
             * Strips the "data:image..." part of the base64 data string so PHP can save the string as a file
             * @param $data
             * @return string
             */
            private static function getBase64Data($data)
            {
                return base64_decode(preg_replace('#^data:image/\w+;base64,#i', '', $data));
            }
        }
        /***** FIN SLIM.PHP */
        // Get posted data
        $images = Slim::getImages();
        // No image found under the supplied input name
        if ($images == false) {
            // inject your own auto crop or fallback script here
            // echo '<p>Slim was not used to upload these images.</p>';
        }
        else {
            // Could be multiple slim croppers
            foreach($images as $image) {
                $files = array();
                // save output data if set
                if (isset($image['output']['data'])) {
                    // Save the file
                    $name = $image['output']['name'];
                    // We'll use the output crop data
                    $data = $image['output']['data'];
                    // If you want to store the file in another directory pass the directory name as the third parameter.
                    // $file = Slim::saveFile($data, $name, 'my-directory/');
                    // If you want to prevent Slim from adding a unique id to the file name add false as the fourth parameter.
                    // $file = Slim::saveFile($data, $name, 'tmp/', false);
                    $output = Slim::saveFile($data, $name);
                    array_push($files, $output);
                }
                // save input data if set
                if (isset($image['input']['data'])) {
                    // Save the file
                    $name = $image['input']['name'];
                    // We'll use the output crop data
                    $data = $image['input']['data'];
                    // If you want to store the file in another directory pass the directory name as the third parameter.
                    // $file = Slim::saveFile($data, $name, 'my-directory/');
                    // If you want to prevent Slim from adding a unique id to the file name add false as the fourth parameter.
                    // $file = Slim::saveFile($data, $name, 'tmp/', false);
                    $input = Slim::saveFile($data, $name);
                    array_push($files, $input);
                }
                $filenames = join(', ', array_map(function ($file)
                {
                    return ellipsis($file['name'], 200);
                }
                , $files));
                $images = array_map(function ($file)
                {
                    return '<img src="' . $file['path'] . '" alt=""/>';
                }
                , $files);
                $resultado_subida.= '
        <h1>You uploaded "' . $filenames . '"</h1>
        ' . join('<br />', $images) . '
        <div class="table-wrapper">
        <table>
            <thead>
                <tr>
                    <th>Property</th>
                    <th>Value</th>
                </tr>
            </thead>
            ';
                if (isset($image['input']['data'])) {
                    $resultado_subida.= '
                <tbody>
                    <tr>
                        <th colspan="2">Input</th>
                    </tr>
                    <tr>
                        <th>Name</th>
                        <td>' . ellipsis($image['input']['name'], 100) . '</td>
                    </tr>
                    <tr>
                        <th>Type</th>
                        <td>' . $image['input']['type'] . '</td>
                    </tr>
                    <tr>
                        <th>Size</th>
                        <td>' . $image['input']['size'] . '</td>
                    </tr>
                    <tr>
                        <th>Width</th>
                        <td>' . $image['input']['width'] . '</td>
                    </tr>
                    <tr>
                        <th>Height</th>
                        <td>' . $image['input']['height'] . '</td>
                    </tr>
                        <tr>
                            <th>Data</th>
                            ' . (isset($image['input']['data']) ? '<td class="bytes">' . ellipsis(base64_encode($image['output']['data']) , 50) . '</td>' : '<td>Input data was not sent, add the "input" value to the <code>data-post</code> property to send it along.</td>') . '
                        </tr>
                </tbody>
                ';
                }
                if (isset($image['output']['data'])) {
                    $resultado_subida.= '
                    <tbody>
                        <tr>
                            <th colspan="2">Output</th>
                        </tr>
                        <tr>
                            <th>Name</th>
                            <td>' . $image['output']['name'] . '</td>
                        </tr>
                        <tr>
                            <th>Type</th>
                            <td>' . $image['output']['type'] . '</td>
                        </tr>
                        <tr>
                            <th>Width</th>
                            <td>' . $image['output']['width'] . '</td>
                        </tr>
                        <tr>
                            <th>Height</th>
                            <td>' . $image['output']['height'] . '</td>
                        </tr>
                        <tr>
                            <th>Data</th>
                            ' . (isset($image['output']['data']) ? '<td class="bytes">' . ellipsis(base64_encode($image['output']['data']) , 50) . '</td>' : '<td>Output data was not sent, add the "output" value to the <code>data-post</code> property to send it along.</td>') . '
                        </tr>
                    </tbody>
                ';
                }
                if (isset($image['actions'])) {
                    $resultado_subida.= '
                    <tbody>
                    <tr>
                        <th colspan="2">Crop</th>
                    </tr>
                    <tr>
                        <th>Type</th>
                        <td>' . $image['actions']['crop']['type'] . '</td>
                    </tr>
                    <tr>
                        <th>X</th>
                        <td>' . $image['actions']['crop']['x'] . '</td>
                    </tr>
                    <tr>
                        <th>Y</th>
                        <td>' . $image['actions']['crop']['y'] . '</td>
                    </tr>
                    <tr>
                        <th>Width</th>
                        <td>' . $image['actions']['crop']['width'] . '</td>
                    </tr>
                    <tr>
                        <th>Height</th>
                        <td>' . $image['actions']['crop']['height'] . '</td>
                    </tr>
                </tbody>
                <tbody>
                    <tr>
                        <th colspan="2">Size</th>
                    </tr>
                    <tr>
                        <th>Width</th>
                        <td>' . $image['actions']['size']['width'] . '</td>
                    </tr>
                    <tr>
                        <th>Height</th>
                        <td>' . $image['actions']['size']['height'] . '</td>
                    </tr>
                </tbody>
                ';
                }
                $resultado_subida.= '
            <tbody>
                <tr>
                    <th colspan="2">Meta</th>
                </tr>
                <tr>
                    <th>Data</th>
                    <td>' . ($image['meta'] ? json_encode($image['meta']) : 'No meta data received') . '</td>
                </tr>
            </tbody>
        </table>
        </div>';
            }
        }
        $id_empresa = $_SESSION["id_empresa"];
        $rut = $_SESSION["user_"];
        $Array_Banned = MP_SearchBannedWords($id_empresa);
        $PRINCIPAL = FuncionesTransversales(file_get_contents("views/comunidad_mp/" . $id_empresa . "_com_mp_personal.html"));
        $biografia = utf8_decode($_POST["biografia"]);
        if (!mp_search_banned_words($biografia, $Array_Banned)) {
            $biografiaclean = 1;
        }
        else {
            echo '<link href="bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css">
                    <br /><br /><br /><div class="alert alert-danger" role="alert">
                 <center> <strong>Cuidado</strong>: el Titulo contiene Palabras Prohibidas</center>
                </div>';
            sleep(3);
        }
        $logros = utf8_decode($_POST["logros"]);
        $sueno = utf8_decode($_POST["sueno"]);
        $celular = utf8_decode($_POST["celular"]);
        if ($id_empresa == 62) {
            if ($titulo_clean == 1 and $editor_clean == 1 and $tag_clean == 1 and $titulo_clean_long == 1) {
                $guarda == 1;
            }
            else {
                // echo "<script>window.location.href = '?sw=com_mp_personal&swa=4'; </script>";
                echo "<script>window.history.back();</script>";
                exit();
            }
        }
        else {
            if ($biografiaclean) {
                $guarda == 1;
            }
            else {
                echo "<script>window.history.back();</script>";
                exit();
            }
        }
        $logros = utf8_decode($_POST["logros"]);
        $sueno = utf8_decode($_POST["sueno"]);
        $celular = utf8_decode($_POST["celular"]);
        $estudios = utf8_decode($_POST["estudios"]);
        $institucion = utf8_decode($_POST["institucion"]);
        // print_r($_POST); sleep(4);
        // echo "<br /><br />";    print_r($_FILES);
        $tamano_archivo = $_FILES["archivo"]['size'];
        $tipo_archivo = $_FILES["archivo"]['type'];
        $archivo_archivo = $_FILES["archivo"]['name'];
        $prefijo_archivo = substr(md5(uniqid(rand())) , 0, 6);
        $arreglo_archivo = explode(".", $archivo_archivo);
        // echo "<br /><br />";    print_r($arreglo_archivo);
        // echo "<br /><br />";
        $extension_archivo = $arreglo_archivo[1];
        // print_r($_FILES);
        $tamano_imagen_fondo = $_FILES["imagen_fondo"]['size'];
        $tipo_imagen_fondo = $_FILES["imagen_fondo"]['type'];
        $imagen_fondo_archivo = $_FILES["imagen_fondo"]['name'];
        $prefijo_imagen_fondo = substr(md5(uniqid(rand())) , 0, 6);
        $arreglo_imagen_fondo = explode(".", $imagen_fondo_archivo);
        $extension_imagen_fondo = $arreglo_imagen_fondo[1];
        $capacitacion = utf8_decode($_POST["capacitacion"]);
        $fecha_cumpleanos = utf8_decode($_POST["fecha_cumpleanos"]);
        $fecha_ingreso = utf8_decode($_POST["fecha_ingreso"]);
        $recuerdos = utf8_decode($_POST["recuerdos"]);
        $titulo = utf8_decode($_POST["titulo"]);

        // echo "<br /><br />";
        $nombre_imagen_fondo = $filenames;
        // echo "<br /><br />$nombre_imagen_fondo";    exit();
        if ($rut <> '' and $id_empresa <> '') {
            $id_biografia = profile_tarjeta_save($rut, $id_empresa, $biografia, $sueno, $logros, $celular, $nombre_imagen_fondo, $capacitacion, $fecha_cumpleanos, $fecha_ingreso, $recuerdos, $titulo, $estudios, $institucion);
            // guarda Badge 1 // creacion perfil
            if($id_empresa=="83"){
            GAMIFICACIONInsertaPuntosPorObjeto($rut, "perfil", "perfil", $id_empresa, "1000", "0", $rut_autor_megusta, $id_objeto_megusta, $tipo_objeto_megusta, $id_malla);
            }   else {
            $badge_ganado = SaveBadge($rut, $id_empresa, "1");
            GAMIFICACIONInsertaPuntosPorObjeto($rut, "perfil", "perfil", $id_empresa, "50", "0", $rut_autor_megusta, $id_objeto_megusta, $tipo_objeto_megusta, $id_malla);
            }
            if ($badge_ganado == 1) {
                $sa = Encodear3("1");
            }
            $datos_usuario = TraeDatosBiografiayUsuario($rut, $id_empresa);
            if ($_SESSION["id_empresa"] == 62) {
                $subject = "Nuevo Perfil en la Plataforma ";
                $subtitulo1 = "Hay un nuevo Perfil en la Plataforma!";
                $texto1 = "El " . $rut . " ha finalizado su Perfil";
                $texto_url = "Ir a Plataforma";
                $to = "carolina.majluf@bci.cl";
                $nombreto = "Carolina Majluf";
                // SendGrid_Email($to, $nombreto, $from, $nombrefrom, $tipo, $subject, $titulo1,$subtitulo1,$texto1,$url,$texto_url, $texto2);
                $to = "ricardo.ross@bci.cl";
                $nombreto = "Ricardo Ross";
                // SendGrid_Email($to, $nombreto, $from, $nombrefrom, $tipo, $subject, $titulo1,$subtitulo1,$texto1,$url,$texto_url, $texto2);
                $to = "rod@gop.cl";
                $nombreto = "Rod";
                SendGrid_Email($to, $nombreto, $from, $nombrefrom, $tipo, $subject, $titulo1, $subtitulo1, $texto1, $url, $texto_url, $texto2, $texto3, $texto4, $logo, $id_empresa, $url, $tipomensaje, $rut, $key);
            }
            if ($_SESSION["id_empresa"] == 78) {
                $from = "masconectados@masconectados.cl";
                $nombrefrom = "Más Conectados Banco de Chile";
                $tipo = "text/html";
                $subject = "Perfil Actualizado en Más Conectados Banco de Chile";
                $titulo1 = "Perfil Actualizado en Más Conectados Banco de Chile";
                // $subtitulo1="Â¡Perfil Actualizado en Mas Conectados Banco de Chile!";
                $subtitulo1 = "" . $datos_usuario[0]->nombre_completo . " has actualizado exitosamente tu Perfil Público.<br /><br />
    Recuerda que juntos construimos esta nueva forma de estar conectados en el Chile.";
                $texto1 = "";
                $url = "https://www.masconectadosbch.cl";
                $texto_url = "Ir a Más Conectados Banco de Chile
    ";
                $logo = "https://www.masconectadosbch.cl/front/img/bch_logo_conectados_trans.png";
                $to = "";
                $nombreto = "";
                // SendGrid_Email($to, $nombreto, $from, $nombrefrom, $tipo, $subject, $titulo1,$subtitulo1,$texto1,$url,$texto_url, $texto2);
                $to = $datos_usuario[0]->email;
                $nombreto = $datos_usuario[0]->nombre_completo;
                SendGrid_Email($to, $nombreto, $from, $nombrefrom, $tipo, $subject, $titulo1, $subtitulo1, $texto1, $url, $texto_url, $texto2);
                // echo "envio a $to, $nombreto";
                $to = "rod@gop.cl";
                $nombreto = "Rod";
                // SendGrid_Email($to, $nombreto, $from, $nombrefrom, $tipo, $subject, $titulo1,$subtitulo1,$texto1,$url,$texto_url, $texto2, $texto3, $texto4, $logo, $id_empresa, $url, $tipomensaje, $rut, $key);
            }
        }
        else {
            echo '<link href="bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css">
                    <br /><br /><br /><div class="alert alert-danger" role="alert">
                    <center> <strong>Cuidado</strong>: Perdiste la Sesion</center>
                </div>';
            sleep(3);
            echo "<script>window.history.back();</script>";
            exit();
        }
        if ($_SESSION["id_empresa"] == 78) {
            echo "<script>location.href='?sw=home_profile_intro&sa" . $sa . "';</script>";
        }
        else {


            echo "<script>location.href='?sw=home_landing&sa" . $sa . "';</script>";
        }

    }
    else if ($seccion == "checjof") {
        $rut = $_SESSION["user_"];
        $id_malla = Decodear3($_GET["im"]);
        $id_empresa = $_SESSION["id_empresa"];
        $rut_colaborador = Decodear3($_GET["re"]);
        $dia = Decodear3($_GET["d"]);
        $dia_realizado = CHECK_LIST_tieneComentariosFinales($rut_colaborador, $dia);
        if ($dia_realizado) {
            echo "<script>
                        alert('Se encuentra realizado el Check List del dÃ­a " . $dia_realizado . " para el colaborador seleccionado');
                        window.history.back();
                        </script>";
        }
        // echo "$rut_colaborador, $dia";
        // echo "$rut $id_empresa";
        // Funcion para saber cuales pueden ser los criterios de la malla
        // $PRINCIPAL=NoticiasPrincipales(FuncionesTransversales(file_get_contents("views/home/index_tnt.html")));
        // $PRINCIPAL=NoticiasSecundarias($PRINCIPAL);
        // $PRINCIPAL=NoticiasTerciarias($PRINCIPAL);
        // $PRINCIPAL=Noticias(FuncionesTransversales(file_get_contents("views/home/index_tnt.html")), 1, 3, "");
        $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/home_esc_bp_jof_check.html"));
        // $PRINCIPAL=Noticias($PRINCIPAL, 2, "limit 3", "");
        // $PRINCIPAL=Noticias($PRINCIPAL, 3, "limit 3, 3", "");
        $PRINCIPAL = str_replace("{ID_MALLA_ENCODEADA}", Encodear3($id_malla) , $PRINCIPAL);
        // $PRINCIPAL=BloqueLinks($PRINCIPAL);
        $PRINCIPAL = BloqueFooterContenido($PRINCIPAL);
        // $PRINCIPAL=ColocarSlider($PRINCIPAL);
        $PRINCIPAL = BarraNavegacion($PRINCIPAL, $seccion);
        // Bloque para Pregunta
        $PRINCIPAL = ColocaCheckPorDia($PRINCIPAL, $id_empresa, $rut, $rut_colaborador, $dia);
        $PRINCIPAL = ColocaMenuSecundario($PRINCIPAL, $_SESSION["id_empresa"]);
        echo $PRINCIPAL;
    }
    else if ($seccion == "calendario") {
        $rut = $_SESSION["user_"];
        $id_empresa = $_SESSION["id_empresa"];
        $vv = $_GET["vv"];
        $im = $_GET["im"];
        $viovideo_visto = 0;
        $idt = Decodear3($_GET["idt"]);
        // print_r($_POST);
        $filtro_cui = $_POST["cui"];
        $filtro_tipo = $_POST["tipo_registro"];
        $filtro_rut = $_POST["rut"];

        // echo "filtro_cui $filtro_cui";
        if ($idt <> '') {
            $template = "_" . $idt;
        }
        $perfil_bacbus = TraePerfilBacBus($rut, $id_empresa);
        if ($perfil_bacbus == "") {
            $cuenta_resp = BuscaPerfilResponsable($rut, $id_empresa);
            if ($cuenta_resp >= 1) {
                $perfil_bacbus = "Responsable";
            }
        }
        if ($perfil_bacbus == "") {
            $perfil_bacbus = "Sin Perfil";
        }
        $cuenta_cerrados = 0;
        $cuenta_sin_iniciar = 0;
        $cuenta_en_demora = 0;
        $cuenta_en_proceso = 0;
        if ($perfil_bacbus == "Super Registrador") {
            $menu = "<a href='?sw=sis_seguimiento_registro' class='btn blue'><span class='blanco f14'><i class='fas fa-plus-square'></i> Nuevo Registro</span></a>
    <a href='?sw=sis_seguimiento_listado' class='btn blue'><span class='blanco f14'><i class='fas fa-list-alt'></i> Listado</span></a>
    <a href='?sw=calendario&idt=" . $idt . "' class='btn blue'><span class='blanco f14'><i class='fas fa-calendar-alt'></i> Calendario</span></a>
    <a href='?sw=sis_seguimiento_reportes' class='btn blue'><span class='blanco f14'><i class='fas fa-chart-area'></i> Reportes</span></a>
    <a href='?sw=sis_seguimiento_gestionregistrador' class='btn blue'><span class='blanco f14'><i class='fas fa-users'></i> Registradores</span></a>

    <a href='?sw=logout' class='btn blue'><span class='blanco f14'><i class='fas fa-sign-out-alt'></i> Salir</span></a>";
        }
        elseif ($perfil_bacbus == "Registrador") {
            $menu = "<a href='?sw=sis_seguimiento_registro' class='btn blue'><span class='blanco f14'>><i class='fas fa-plus-square'></i> Nuevo Registro</span></a>
    <a href='?sw=sis_seguimiento_listado' class='btn blue'><span class='blanco f14'><i class='fas fa-list-alt'></i> Listado</span></a>
    <a href='?sw=calendario&idt=" . $idt . "' class='btn blue'><span class='blanco f14'><i class='fas fa-calendar-alt'></i> Calendario</span></a>
    <a href='?sw=sis_seguimiento_reportes' class='btn blue'><span class='blanco f14'><i class='fas fa-chart-area'></i> Reportes</span></a>
    <a href='?sw=logout' class='btn blue'><span class='blanco f14'><i class='fas fa-sign-out-alt'></i> Salir</span></a>";
        }
        else {
            $menu = "<a href='?sw=logout' class='btn blue'><span class='blanco f14'><i class='fas fa-sign-out-alt'></i> Salir</span></a>";
        }
        $Arreglo_Datos_usuario = TraeDatosBiografiayUsuario($rut, $id_empresa);
        // print_r($Arreglo_Datos_usuario);
        $nombre_completo = $Arreglo_Datos_usuario[0]->nombre_completo;
        $cargo = $Arreglo_Datos_usuario[0]->cargo;
        $unidad_negocio = $Arreglo_Datos_usuario[0]->unidad_negocio;
        $gerencia = $Arreglo_Datos_usuario[0]->gerencia;
        $area = $Arreglo_Datos_usuario[0]->area;
        $division = $Arreglo_Datos_usuario[0]->division;
        $departamento = $Arreglo_Datos_usuario[0]->departamento;
        $local = $Arreglo_Datos_usuario[0]->local;
        $sucursal = $Arreglo_Datos_usuario[0]->sucursal;
        $regional = $Arreglo_Datos_usuario[0]->regional;
        $telefono = $Arreglo_Datos_usuario[0]->telefono;
        $anexo = $Arreglo_Datos_usuario[0]->anexo;
        $email = $Arreglo_Datos_usuario[0]->email;
        $biografia = $Arreglo_Datos_usuario[0]->biografia;
        $sueno = $Arreglo_Datos_usuario[0]->sueno;
        $logros = $Arreglo_Datos_usuario[0]->logros;
        $celular = $Arreglo_Datos_usuario[0]->micelular;
        $avatar = $Arreglo_Datos_usuario[0]->miavatar;
        // FILTRO POR CUI
        $Arra_cui_agenda = FiltroCuiAgenda($id_empresa);
         //print_r($Arra_cui_agenda);
        foreach($Arra_cui_agenda as $unico) {
            // $pizza  = "porci&oacute;n1 porci&oacute;n2 porci&oacute;n3 porci&oacute;n4 porci&oacute;n5 porci&oacute;n6";
            $CuiArray = explode(" ", $unico->nombre);
            $option_cui.= "<option value='" . $CuiArray[0] . "'>" . $unico->nombre . "</option>";
        }
        $Arra_rut_agenda = FiltroRutAgenda($id_empresa);
        // print_r($Arra_cui_agenda);
        foreach($Arra_rut_agenda as $unico) {
            // $pizza  = "porci&oacute;n1 porci&oacute;n2 porci&oacute;n3 porci&oacute;n4 porci&oacute;n5 porci&oacute;n6";
            $RUTArray = explode(" ", $unico->descripcion);
            $option_rut.= "<option value='" . $RUTArray[0] . "'>" . $unico->descripcion . "</option>";
        }
        // echo $option_cui;
        // echo "views/calendario/eventos/".$id_empresa."_evento_calendario".$template.".html";
        // echo "views/calendario/eventos/".$id_empresa."_evento_calendario.html";
        // $PRINCIPAL=FuncionesTransversales(file_get_contents("views/calendario/demos/".$id_empresa."_agenda-views.html"));
        // $PRINCIPAL=FuncionesTransversales(file_get_contents("views/calendario/demos/agenda-views.html"));
        // $PRINCIPAL=FuncionesTransversales(file_get_contents("views/calendario/demos/".$id_empresa."_basic-views.html"));
        $PRINCIPAL = FuncionesTransversales(file_get_contents("views/calendario/eventos/" . $id_empresa . "_evento_calendario" . $template . ".html"));
        // echo "views/calendario/demos/".$id_empresa."_agenda-views.html";
        $PRINCIPAL = ColocaEventosCalendario($PRINCIPAL, $id_empresa, $idt, $filtro_cui, $filtro_rut, $filtro_tipo);
        $PRINCIPAL = BarraNavegacion($PRINCIPAL, $seccion);
        $PRINCIPAL = ColocarSliderPorNoticia($PRINCIPAL, $id_empresa);
        $PRINCIPAL = ColocaMenuSecundario($PRINCIPAL, $_SESSION["id_empresa"]);
        $PRINCIPAL = str_replace("{OPTION_AGENDA_CUI}", $option_cui, $PRINCIPAL);
        $PRINCIPAL = str_replace("{OPTION_RUT_BACBUS}", $option_rut, $PRINCIPAL);
        $PRINCIPAL = str_replace("{AVANCEMALLATOTAL}", $arreglo_row_avance[1], $PRINCIPAL);
        $PRINCIPAL = str_replace("{ID_MALLA_ENCODEADA}", $im, $PRINCIPAL);
        $PRINCIPAL = str_replace("{ROW_LISTA_PROGRAMAS}", $arreglo_row_avance[0], $PRINCIPAL);
        $PRINCIPAL = str_replace("{SECCION_PREGUNTA}", ColocaBloquePreguntaPorObjeto($datos_objeto[0]->id, $rut, 4) , $PRINCIPAL);
        $PRINCIPAL = str_replace("{ROW_PESTANAS_LI_FOCOS}", ColocaPestanasFocosHome($rut, $id_empresa) , $PRINCIPAL);
        $PRINCIPAL = str_replace("{AVATAR}", VerificaFotoPersonal($rut) , $PRINCIPAL);
        $PRINCIPAL = str_replace("{NOMBRE}", $nombre_completo, $PRINCIPAL);
        $PRINCIPAL = str_replace("{PERFIL_BAC_BUS}", $perfil_bacbus, $PRINCIPAL);
        $PRINCIPAL = str_replace("{MENU_BAC_BUS}", $menu, $PRINCIPAL);
        $PRINCIPAL = ColocaDatosPerfil($PRINCIPAL, $rut);
        echo $PRINCIPAL;
    }
    else if ($seccion == "calendario_lista") {
        $rut = $_SESSION["user_"];
        $id_empresa = $_SESSION["id_empresa"];
        $idevent = $_GET["idevent"];
        $PRINCIPAL = FuncionesTransversales(file_get_contents("views/calendario/eventos/" . $id_empresa . "_evento_lista.html"));
        $PRINCIPAL = ColocaEventosCalendario($PRINCIPAL, $id_empresa);
        $PRINCIPAL = BarraNavegacion($PRINCIPAL, $seccion);
        $PRINCIPAL = ColocarSliderPorNoticia($PRINCIPAL, $id_empresa);
        $PRINCIPAL = ColocaMenuSecundario($PRINCIPAL, $_SESSION["id_empresa"]);
        $PRINCIPAL = str_replace("{AVANCEMALLATOTAL}", $arreglo_row_avance[1], $PRINCIPAL);
        $PRINCIPAL = str_replace("{ID_MALLA_ENCODEADA}", $im, $PRINCIPAL);
        $PRINCIPAL = str_replace("{ROW_LISTA_PROGRAMAS}", $arreglo_row_avance[0], $PRINCIPAL);
        $PRINCIPAL = str_replace("{SECCION_PREGUNTA}", ColocaBloquePreguntaPorObjeto($datos_objeto[0]->id, $rut, 4) , $PRINCIPAL);
        $PRINCIPAL = str_replace("{ROW_PESTANAS_LI_FOCOS}", ColocaPestanasFocosHome($rut, $id_empresa) , $PRINCIPAL);
        $PRINCIPAL = ColocaDatosPerfil($PRINCIPAL, $rut);
        echo $PRINCIPAL;
    }
    else if ($seccion == "calendario_event") {
        $rut = $_SESSION["user_"];
        $id_empresa = $_SESSION["id_empresa"];
        $idevent = $_GET["idevent"];
        $PRINCIPAL = FuncionesTransversales(file_get_contents("views/calendario/eventos/" . $id_empresa . "_evento.html"));
        $PRINCIPAL = ColocaEventosCalendario($PRINCIPAL, $id_empresa);
        $PRINCIPAL = BarraNavegacion($PRINCIPAL, $seccion);
        $PRINCIPAL = ColocarSliderPorNoticia($PRINCIPAL, $id_empresa);
        $PRINCIPAL = ColocaMenuSecundario($PRINCIPAL, $_SESSION["id_empresa"]);
        $PRINCIPAL = str_replace("{AVANCEMALLATOTAL}", $arreglo_row_avance[1], $PRINCIPAL);
        $PRINCIPAL = str_replace("{ID_MALLA_ENCODEADA}", $im, $PRINCIPAL);
        $PRINCIPAL = str_replace("{ROW_LISTA_PROGRAMAS}", $arreglo_row_avance[0], $PRINCIPAL);
        $PRINCIPAL = str_replace("{SECCION_PREGUNTA}", ColocaBloquePreguntaPorObjeto($datos_objeto[0]->id, $rut, 4) , $PRINCIPAL);
        $PRINCIPAL = str_replace("{ROW_PESTANAS_LI_FOCOS}", ColocaPestanasFocosHome($rut, $id_empresa) , $PRINCIPAL);
        $PRINCIPAL = ColocaDatosPerfil($PRINCIPAL, $rut);
        echo $PRINCIPAL;
    }
    else if ($seccion == "home_bci_certro_rdp") {
        $rut = $_SESSION["user_"];
        $id_empresa = $_SESSION["id_empresa"];
        $vv = $_GET["vv"];
        $im = $_GET["im"];
        $viovideo_visto = 0;
        $viovideoarray = vio_vide_intro($rut, "home_tc", $id_empresa);
        $cuentaVideoArray = $viovideoarray[0]->cuenta;
        if ($cuentaVideoArray > 0) {
            $viovideo_visto = 1;
        }
        if ($vv == 1) {
            inserta_vio_video($rut, "home_tc", $id_empresa);
        }
        $viovideoarray = vio_vide_intro($rut, "home_tc", $id_empresa);
        $cuentaVideoArray = $viovideoarray[0]->cuenta;
        if ($cuentaVideoArray > 0) {
            $viovideo_visto = 1;
        }
        if ($viovideo_visto == 0) {
            $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/index_bci_home_cert_riesgo.html"));
        }
        else {
            $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/index_bci_home_cert_riesgo.html"));
        }
        $sa = $_GET["sa"];
        $datos_malla = VerificaMallaDadoPrograma($rut, $id_empresa, "bci_tcampo");
        $id_malla = $datos_malla[0]->id_malla;
        if ($sa == 1) {
            $PRINCIPAL = str_replace("{SWEET_ALERT}", file_get_contents("views/templates/tc_sa.html") , $PRINCIPAL);
        }
        else {
            $PRINCIPAL = str_replace("{SWEET_ALERT}", "", $PRINCIPAL);
        }
        $PRINCIPAL = ColocaEstadosPorClasificacion($PRINCIPAL, $rut, $id_malla, $id_empresa);
        $PRINCIPAL = BarraNavegacion($PRINCIPAL, $seccion);
        $PRINCIPAL = ColocarSliderPorNoticia($PRINCIPAL, $id_empresa);
        $PRINCIPAL = ColocaMenuSecundario($PRINCIPAL, $_SESSION["id_empresa"]);
        $PRINCIPAL = str_replace("{AVANCEMALLATOTAL}", $arreglo_row_avance[1], $PRINCIPAL);
        $PRINCIPAL = str_replace("{ID_MALLA_ENCODEADA}", $im, $PRINCIPAL);
        $PRINCIPAL = str_replace("{ROW_LISTA_PROGRAMAS}", $arreglo_row_avance[0], $PRINCIPAL);
        $PRINCIPAL = str_replace("{SECCION_PREGUNTA}", ColocaBloquePreguntaPorObjeto($datos_objeto[0]->id, $rut, 4) , $PRINCIPAL);
        $PRINCIPAL = str_replace("{ROW_PESTANAS_LI_FOCOS}", ColocaPestanasFocosHome($rut, $id_empresa) , $PRINCIPAL);
        $row_slider = ColocaEstadColocaEstadosPorClasificacionOrderSlider($PRINCIPAL, $rut, $id_malla, $id_empresa);
        $PRINCIPAL = str_replace("{TC_ROWS_SLIDER}", $row_slider, $PRINCIPAL);
        $PRINCIPAL = ColocaDatosPerfil($PRINCIPAL, $rut);
        echo $PRINCIPAL;
    }
    else if ($seccion == "home_bci_certro_rlgc") {
        $rut = $_SESSION["user_"];
        $id_empresa = $_SESSION["id_empresa"];
        $vv = $_GET["vv"];
        $im = $_GET["im"];
        $viovideo_visto = 0;
        $viovideoarray = vio_vide_intro($rut, "home_tc", $id_empresa);
        $cuentaVideoArray = $viovideoarray[0]->cuenta;
        if ($cuentaVideoArray > 0) {
            $viovideo_visto = 1;
        }
        if ($vv == 1) {
            inserta_vio_video($rut, "home_tc", $id_empresa);
        }
        $viovideoarray = vio_vide_intro($rut, "home_tc", $id_empresa);
        $cuentaVideoArray = $viovideoarray[0]->cuenta;
        if ($cuentaVideoArray > 0) {
            $viovideo_visto = 1;
        }
        if ($viovideo_visto == 0) {
            $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/index_bci_home_cert_riesgo.html"));
        }
        else {
            $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/index_bci_home_cert_riesgo.html"));
        }
        $sa = $_GET["sa"];
        $datos_malla = VerificaMallaDadoPrograma($rut, $id_empresa, "bci_tcampo");
        $id_malla = $datos_malla[0]->id_malla;
        if ($sa == 1) {
            $PRINCIPAL = str_replace("{SWEET_ALERT}", file_get_contents("views/templates/tc_sa.html") , $PRINCIPAL);
        }
        else {
            $PRINCIPAL = str_replace("{SWEET_ALERT}", "", $PRINCIPAL);
        }
        $PRINCIPAL = ColocaEstadosPorClasificacion($PRINCIPAL, $rut, $id_malla, $id_empresa);
        $PRINCIPAL = BarraNavegacion($PRINCIPAL, $seccion);
        $PRINCIPAL = ColocarSliderPorNoticia($PRINCIPAL, $id_empresa);
        $PRINCIPAL = ColocaMenuSecundario($PRINCIPAL, $_SESSION["id_empresa"]);
        $PRINCIPAL = str_replace("{AVANCEMALLATOTAL}", $arreglo_row_avance[1], $PRINCIPAL);
        $PRINCIPAL = str_replace("{ID_MALLA_ENCODEADA}", $im, $PRINCIPAL);
        $PRINCIPAL = str_replace("{ROW_LISTA_PROGRAMAS}", $arreglo_row_avance[0], $PRINCIPAL);
        $PRINCIPAL = str_replace("{SECCION_PREGUNTA}", ColocaBloquePreguntaPorObjeto($datos_objeto[0]->id, $rut, 4) , $PRINCIPAL);
        $PRINCIPAL = str_replace("{ROW_PESTANAS_LI_FOCOS}", ColocaPestanasFocosHome($rut, $id_empresa) , $PRINCIPAL);
        $row_slider = ColocaEstadColocaEstadosPorClasificacionOrderSlider($PRINCIPAL, $rut, $id_malla, $id_empresa);
        $PRINCIPAL = str_replace("{TC_ROWS_SLIDER}", $row_slider, $PRINCIPAL);
        $PRINCIPAL = ColocaDatosPerfil($PRINCIPAL, $rut);
        echo $PRINCIPAL;
    }
    else if ($seccion == "home_bci_certro_rdse") {
        $rut = $_SESSION["user_"];
        $id_empresa = $_SESSION["id_empresa"];
        $vv = $_GET["vv"];
        $im = $_GET["im"];
        $viovideo_visto = 0;
        $viovideoarray = vio_vide_intro($rut, "home_tc", $id_empresa);
        $cuentaVideoArray = $viovideoarray[0]->cuenta;
        if ($cuentaVideoArray > 0) {
            $viovideo_visto = 1;
        }
        if ($vv == 1) {
            inserta_vio_video($rut, "home_tc", $id_empresa);
        }
        $viovideoarray = vio_vide_intro($rut, "home_tc", $id_empresa);
        $cuentaVideoArray = $viovideoarray[0]->cuenta;
        if ($cuentaVideoArray > 0) {
            $viovideo_visto = 1;
        }
        if ($viovideo_visto == 0) {
            $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/index_bci_home_cert_riesgo.html"));
        }
        else {
            $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/index_bci_home_cert_riesgo.html"));
        }
        $sa = $_GET["sa"];
        $datos_malla = VerificaMallaDadoPrograma($rut, $id_empresa, "bci_tcampo");
        $id_malla = $datos_malla[0]->id_malla;
        if ($sa == 1) {
            $PRINCIPAL = str_replace("{SWEET_ALERT}", file_get_contents("views/templates/tc_sa.html") , $PRINCIPAL);
        }
        else {
            $PRINCIPAL = str_replace("{SWEET_ALERT}", "", $PRINCIPAL);
        }
        $PRINCIPAL = ColocaEstadosPorClasificacion($PRINCIPAL, $rut, $id_malla, $id_empresa);
        $PRINCIPAL = BarraNavegacion($PRINCIPAL, $seccion);
        $PRINCIPAL = ColocarSliderPorNoticia($PRINCIPAL, $id_empresa);
        $PRINCIPAL = ColocaMenuSecundario($PRINCIPAL, $_SESSION["id_empresa"]);
        $PRINCIPAL = str_replace("{AVANCEMALLATOTAL}", $arreglo_row_avance[1], $PRINCIPAL);
        $PRINCIPAL = str_replace("{ID_MALLA_ENCODEADA}", $im, $PRINCIPAL);
        $PRINCIPAL = str_replace("{ROW_LISTA_PROGRAMAS}", $arreglo_row_avance[0], $PRINCIPAL);
        $PRINCIPAL = str_replace("{SECCION_PREGUNTA}", ColocaBloquePreguntaPorObjeto($datos_objeto[0]->id, $rut, 4) , $PRINCIPAL);
        $PRINCIPAL = str_replace("{ROW_PESTANAS_LI_FOCOS}", ColocaPestanasFocosHome($rut, $id_empresa) , $PRINCIPAL);
        $row_slider = ColocaEstadColocaEstadosPorClasificacionOrderSlider($PRINCIPAL, $rut, $id_malla, $id_empresa);
        $PRINCIPAL = str_replace("{TC_ROWS_SLIDER}", $row_slider, $PRINCIPAL);
        $PRINCIPAL = ColocaDatosPerfil($PRINCIPAL, $rut);
        echo $PRINCIPAL;
    }
    else if ($seccion == "home_bci_certro_rlgc") {
        $rut = $_SESSION["user_"];
        $id_empresa = $_SESSION["id_empresa"];
        $vv = $_GET["vv"];
        $im = $_GET["im"];
        $viovideo_visto = 0;
        $viovideoarray = vio_vide_intro($rut, "home_tc", $id_empresa);
        $cuentaVideoArray = $viovideoarray[0]->cuenta;
        if ($cuentaVideoArray > 0) {
            $viovideo_visto = 1;
        }
        if ($vv == 1) {
            inserta_vio_video($rut, "home_tc", $id_empresa);
        }
        $viovideoarray = vio_vide_intro($rut, "home_tc", $id_empresa);
        $cuentaVideoArray = $viovideoarray[0]->cuenta;
        if ($cuentaVideoArray > 0) {
            $viovideo_visto = 1;
        }
        if ($viovideo_visto == 0) {
            $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/index_bci_home_cert_riesgo.html"));
        }
        else {
            $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/index_bci_home_cert_riesgo.html"));
        }
        $sa = $_GET["sa"];
        $datos_malla = VerificaMallaDadoPrograma($rut, $id_empresa, "bci_tcampo");
        $id_malla = $datos_malla[0]->id_malla;
        if ($sa == 1) {
            $PRINCIPAL = str_replace("{SWEET_ALERT}", file_get_contents("views/templates/tc_sa.html") , $PRINCIPAL);
        }
        else {
            $PRINCIPAL = str_replace("{SWEET_ALERT}", "", $PRINCIPAL);
        }
        $PRINCIPAL = ColocaEstadosPorClasificacion($PRINCIPAL, $rut, $id_malla, $id_empresa);
        $PRINCIPAL = BarraNavegacion($PRINCIPAL, $seccion);
        $PRINCIPAL = ColocarSliderPorNoticia($PRINCIPAL, $id_empresa);
        $PRINCIPAL = ColocaMenuSecundario($PRINCIPAL, $_SESSION["id_empresa"]);
        $PRINCIPAL = str_replace("{AVANCEMALLATOTAL}", $arreglo_row_avance[1], $PRINCIPAL);
        $PRINCIPAL = str_replace("{ID_MALLA_ENCODEADA}", $im, $PRINCIPAL);
        $PRINCIPAL = str_replace("{ROW_LISTA_PROGRAMAS}", $arreglo_row_avance[0], $PRINCIPAL);
        $PRINCIPAL = str_replace("{SECCION_PREGUNTA}", ColocaBloquePreguntaPorObjeto($datos_objeto[0]->id, $rut, 4) , $PRINCIPAL);
        $PRINCIPAL = str_replace("{ROW_PESTANAS_LI_FOCOS}", ColocaPestanasFocosHome($rut, $id_empresa) , $PRINCIPAL);
        $row_slider = ColocaEstadColocaEstadosPorClasificacionOrderSlider($PRINCIPAL, $rut, $id_malla, $id_empresa);
        $PRINCIPAL = str_replace("{TC_ROWS_SLIDER}", $row_slider, $PRINCIPAL);
        $PRINCIPAL = ColocaDatosPerfil($PRINCIPAL, $rut);
        echo $PRINCIPAL;
    }
    else if ($seccion == "home_bci_certro_rcgc") {
        $rut = $_SESSION["user_"];
        $id_empresa = $_SESSION["id_empresa"];
        $vv = $_GET["vv"];
        $im = $_GET["im"];
        $viovideo_visto = 0;
        $viovideoarray = vio_vide_intro($rut, "home_tc", $id_empresa);
        $cuentaVideoArray = $viovideoarray[0]->cuenta;
        if ($cuentaVideoArray > 0) {
            $viovideo_visto = 1;
        }
        if ($vv == 1) {
            inserta_vio_video($rut, "home_tc", $id_empresa);
        }
        $viovideoarray = vio_vide_intro($rut, "home_tc", $id_empresa);
        $cuentaVideoArray = $viovideoarray[0]->cuenta;
        if ($cuentaVideoArray > 0) {
            $viovideo_visto = 1;
        }
        if ($viovideo_visto == 0) {
            $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/index_bci_home_cert_riesgo.html"));
        }
        else {
            $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/index_bci_home_cert_riesgo.html"));
        }
        $sa = $_GET["sa"];
        $datos_malla = VerificaMallaDadoPrograma($rut, $id_empresa, "bci_tcampo");
        $id_malla = $datos_malla[0]->id_malla;
        if ($sa == 1) {
            $PRINCIPAL = str_replace("{SWEET_ALERT}", file_get_contents("views/templates/tc_sa.html") , $PRINCIPAL);
        }
        else {
            $PRINCIPAL = str_replace("{SWEET_ALERT}", "", $PRINCIPAL);
        }
        $PRINCIPAL = ColocaEstadosPorClasificacion($PRINCIPAL, $rut, $id_malla, $id_empresa);
        $PRINCIPAL = BarraNavegacion($PRINCIPAL, $seccion);
        $PRINCIPAL = ColocarSliderPorNoticia($PRINCIPAL, $id_empresa);
        $PRINCIPAL = ColocaMenuSecundario($PRINCIPAL, $_SESSION["id_empresa"]);
        $PRINCIPAL = str_replace("{AVANCEMALLATOTAL}", $arreglo_row_avance[1], $PRINCIPAL);
        $PRINCIPAL = str_replace("{ID_MALLA_ENCODEADA}", $im, $PRINCIPAL);
        $PRINCIPAL = str_replace("{ROW_LISTA_PROGRAMAS}", $arreglo_row_avance[0], $PRINCIPAL);
        $PRINCIPAL = str_replace("{SECCION_PREGUNTA}", ColocaBloquePreguntaPorObjeto($datos_objeto[0]->id, $rut, 4) , $PRINCIPAL);
        $PRINCIPAL = str_replace("{ROW_PESTANAS_LI_FOCOS}", ColocaPestanasFocosHome($rut, $id_empresa) , $PRINCIPAL);
        $row_slider = ColocaEstadColocaEstadosPorClasificacionOrderSlider($PRINCIPAL, $rut, $id_malla, $id_empresa);
        $PRINCIPAL = str_replace("{TC_ROWS_SLIDER}", $row_slider, $PRINCIPAL);
        $PRINCIPAL = ColocaDatosPerfil($PRINCIPAL, $rut);
        echo $PRINCIPAL;
    }
    else if ($seccion == "home_bci_certro_rlgs") {
        $rut = $_SESSION["user_"];
        $id_empresa = $_SESSION["id_empresa"];
        $vv = $_GET["vv"];
        $im = $_GET["im"];
        $viovideo_visto = 0;
        $viovideoarray = vio_vide_intro($rut, "home_tc", $id_empresa);
        $cuentaVideoArray = $viovideoarray[0]->cuenta;
        if ($cuentaVideoArray > 0) {
            $viovideo_visto = 1;
        }
        if ($vv == 1) {
            inserta_vio_video($rut, "home_tc", $id_empresa);
        }
        $viovideoarray = vio_vide_intro($rut, "home_tc", $id_empresa);
        $cuentaVideoArray = $viovideoarray[0]->cuenta;
        if ($cuentaVideoArray > 0) {
            $viovideo_visto = 1;
        }
        if ($viovideo_visto == 0) {
            $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/index_bci_home_cert_riesgo.html"));
        }
        else {
            $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/index_bci_home_cert_riesgo.html"));
        }
        $sa = $_GET["sa"];
        $datos_malla = VerificaMallaDadoPrograma($rut, $id_empresa, "bci_tcampo");
        $id_malla = $datos_malla[0]->id_malla;
        if ($sa == 1) {
            $PRINCIPAL = str_replace("{SWEET_ALERT}", file_get_contents("views/templates/tc_sa.html") , $PRINCIPAL);
        }
        else {
            $PRINCIPAL = str_replace("{SWEET_ALERT}", "", $PRINCIPAL);
        }
        $PRINCIPAL = ColocaEstadosPorClasificacion($PRINCIPAL, $rut, $id_malla, $id_empresa);
        $PRINCIPAL = BarraNavegacion($PRINCIPAL, $seccion);
        $PRINCIPAL = ColocarSliderPorNoticia($PRINCIPAL, $id_empresa);
        $PRINCIPAL = ColocaMenuSecundario($PRINCIPAL, $_SESSION["id_empresa"]);
        $PRINCIPAL = str_replace("{AVANCEMALLATOTAL}", $arreglo_row_avance[1], $PRINCIPAL);
        $PRINCIPAL = str_replace("{ID_MALLA_ENCODEADA}", $im, $PRINCIPAL);
        $PRINCIPAL = str_replace("{ROW_LISTA_PROGRAMAS}", $arreglo_row_avance[0], $PRINCIPAL);
        $PRINCIPAL = str_replace("{SECCION_PREGUNTA}", ColocaBloquePreguntaPorObjeto($datos_objeto[0]->id, $rut, 4) , $PRINCIPAL);
        $PRINCIPAL = str_replace("{ROW_PESTANAS_LI_FOCOS}", ColocaPestanasFocosHome($rut, $id_empresa) , $PRINCIPAL);
        $row_slider = ColocaEstadColocaEstadosPorClasificacionOrderSlider($PRINCIPAL, $rut, $id_malla, $id_empresa);
        $PRINCIPAL = str_replace("{TC_ROWS_SLIDER}", $row_slider, $PRINCIPAL);
        $PRINCIPAL = ColocaDatosPerfil($PRINCIPAL, $rut);
        echo $PRINCIPAL;
    }
    else if ($seccion == "home_bci_certro_rlpf") {
        $rut = $_SESSION["user_"];
        $id_empresa = $_SESSION["id_empresa"];
        $vv = $_GET["vv"];
        $im = $_GET["im"];
        $viovideo_visto = 0;
        $viovideoarray = vio_vide_intro($rut, "home_tc", $id_empresa);
        $cuentaVideoArray = $viovideoarray[0]->cuenta;
        if ($cuentaVideoArray > 0) {
            $viovideo_visto = 1;
        }
        if ($vv == 1) {
            inserta_vio_video($rut, "home_tc", $id_empresa);
        }
        $viovideoarray = vio_vide_intro($rut, "home_tc", $id_empresa);
        $cuentaVideoArray = $viovideoarray[0]->cuenta;
        if ($cuentaVideoArray > 0) {
            $viovideo_visto = 1;
        }
        if ($viovideo_visto == 0) {
            $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/index_bci_home_cert_riesgo.html"));
        }
        else {
            $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/index_bci_home_cert_riesgo.html"));
        }
        $sa = $_GET["sa"];
        $datos_malla = VerificaMallaDadoPrograma($rut, $id_empresa, "bci_tcampo");
        $id_malla = $datos_malla[0]->id_malla;
        if ($sa == 1) {
            $PRINCIPAL = str_replace("{SWEET_ALERT}", file_get_contents("views/templates/tc_sa.html") , $PRINCIPAL);
        }
        else {
            $PRINCIPAL = str_replace("{SWEET_ALERT}", "", $PRINCIPAL);
        }
        $PRINCIPAL = ColocaEstadosPorClasificacion($PRINCIPAL, $rut, $id_malla, $id_empresa);
        $PRINCIPAL = BarraNavegacion($PRINCIPAL, $seccion);
        $PRINCIPAL = ColocarSliderPorNoticia($PRINCIPAL, $id_empresa);
        $PRINCIPAL = ColocaMenuSecundario($PRINCIPAL, $_SESSION["id_empresa"]);
        $PRINCIPAL = str_replace("{AVANCEMALLATOTAL}", $arreglo_row_avance[1], $PRINCIPAL);
        $PRINCIPAL = str_replace("{ID_MALLA_ENCODEADA}", $im, $PRINCIPAL);
        $PRINCIPAL = str_replace("{ROW_LISTA_PROGRAMAS}", $arreglo_row_avance[0], $PRINCIPAL);
        $PRINCIPAL = str_replace("{SECCION_PREGUNTA}", ColocaBloquePreguntaPorObjeto($datos_objeto[0]->id, $rut, 4) , $PRINCIPAL);
        $PRINCIPAL = str_replace("{ROW_PESTANAS_LI_FOCOS}", ColocaPestanasFocosHome($rut, $id_empresa) , $PRINCIPAL);
        $row_slider = ColocaEstadColocaEstadosPorClasificacionOrderSlider($PRINCIPAL, $rut, $id_malla, $id_empresa);
        $PRINCIPAL = str_replace("{TC_ROWS_SLIDER}", $row_slider, $PRINCIPAL);
        $PRINCIPAL = ColocaDatosPerfil($PRINCIPAL, $rut);
        echo $PRINCIPAL;
    }
    else if ($seccion == "home_tc") {
        $rut = $_SESSION["user_"];
        $id_empresa = $_SESSION["id_empresa"];
        $vv = $_GET["vv"];
        $im = $_GET["im"];
        $viovideo_visto = 0;
        $viovideoarray = vio_vide_intro($rut, "home_tc", $id_empresa);
        //   print_r($viovideoarray);
        $cuentaVideoArray = $viovideoarray[0]->cuenta;
        if ($cuentaVideoArray > 0) {
            $viovideo_visto = 1;
        }
        // echo "vv $vv , viovideo_visto $viovideo_visto";
        if ($vv == 1) {
            inserta_vio_video($rut, "home_tc", $id_empresa);
        }
        $viovideoarray = vio_vide_intro($rut, "home_tc", $id_empresa);
        $cuentaVideoArray = $viovideoarray[0]->cuenta;
        if ($cuentaVideoArray > 0) {
            $viovideo_visto = 1;
        }
        if ($viovideo_visto == 0) {
            $PRINCIPAL = FuncionesTransversales(file_get_contents("views/templates/tc_index.html"));
        }
        else {
            $PRINCIPAL = FuncionesTransversales(file_get_contents("views/templates/tc_index.html"));
        }
        $sa = $_GET["sa"];
        $datos_malla = VerificaMallaDadoPrograma($rut, $id_empresa, "bci_tcampo");
        $id_malla = $datos_malla[0]->id_malla;
        if ($sa == 1) {
            $PRINCIPAL = str_replace("{SWEET_ALERT}", file_get_contents("views/templates/tc_sa.html") , $PRINCIPAL);
        }
        else {
            $PRINCIPAL = str_replace("{SWEET_ALERT}", "", $PRINCIPAL);
        }
        $PRINCIPAL = ColocaEstadosPorClasificacion($PRINCIPAL, $rut, $id_malla, $id_empresa);
        $PRINCIPAL = BarraNavegacion($PRINCIPAL, $seccion);
        $PRINCIPAL = ColocarSliderPorNoticia($PRINCIPAL, $id_empresa);
        $PRINCIPAL = ColocaMenuSecundario($PRINCIPAL, $_SESSION["id_empresa"]);
        $PRINCIPAL = str_replace("{AVANCEMALLATOTAL}", $arreglo_row_avance[1], $PRINCIPAL);
        $PRINCIPAL = str_replace("{ID_MALLA_ENCODEADA}", $im, $PRINCIPAL);
        $PRINCIPAL = str_replace("{ROW_LISTA_PROGRAMAS}", $arreglo_row_avance[0], $PRINCIPAL);
        $PRINCIPAL = str_replace("{SECCION_PREGUNTA}", ColocaBloquePreguntaPorObjeto($datos_objeto[0]->id, $rut, 4) , $PRINCIPAL);
        $PRINCIPAL = str_replace("{ROW_PESTANAS_LI_FOCOS}", ColocaPestanasFocosHome($rut, $id_empresa) , $PRINCIPAL);
        $row_slider = ColocaEstadColocaEstadosPorClasificacionOrderSlider($PRINCIPAL, $rut, $id_malla, $id_empresa);
        $PRINCIPAL = str_replace("{TC_ROWS_SLIDER}", $row_slider, $PRINCIPAL);
        $PRINCIPAL = ColocaDatosPerfil($PRINCIPAL, $rut);
        echo $PRINCIPAL;
    }
    else if ($seccion == "home_tc_intro") {
        $rut = $_SESSION["user_"];
        $id_empresa = $_SESSION["id_empresa"];
        $vv = $_GET["vv"];
        $im = $_GET["im"];
        $PRINCIPAL = FuncionesTransversales(file_get_contents("views/templates/tc_index_intro.html"));
        $sa = $_GET["sa"];
        $datos_malla = VerificaMallaDadoPrograma($rut, $id_empresa, "bci_tcampo");
        $id_malla = $datos_malla[0]->id_malla;
        if ($sa == 1) {
            $PRINCIPAL = str_replace("{SWEET_ALERT}", file_get_contents("views/templates/tc_sa.html") , $PRINCIPAL);
        }
        else {
            $PRINCIPAL = str_replace("{SWEET_ALERT}", "", $PRINCIPAL);
        }
        $PRINCIPAL = ColocaEstadosPorClasificacion($PRINCIPAL, $rut, $id_malla, $id_empresa);
        $PRINCIPAL = BarraNavegacion($PRINCIPAL, $seccion);
        $PRINCIPAL = ColocarSliderPorNoticia($PRINCIPAL, $id_empresa);
        $PRINCIPAL = ColocaMenuSecundario($PRINCIPAL, $_SESSION["id_empresa"]);
        $PRINCIPAL = str_replace("{AVANCEMALLATOTAL}", $arreglo_row_avance[1], $PRINCIPAL);
        $PRINCIPAL = str_replace("{ID_MALLA_ENCODEADA}", $im, $PRINCIPAL);
        $PRINCIPAL = str_replace("{ROW_LISTA_PROGRAMAS}", $arreglo_row_avance[0], $PRINCIPAL);
        $PRINCIPAL = str_replace("{SECCION_PREGUNTA}", ColocaBloquePreguntaPorObjeto($datos_objeto[0]->id, $rut, 4) , $PRINCIPAL);
        $PRINCIPAL = str_replace("{ROW_PESTANAS_LI_FOCOS}", ColocaPestanasFocosHome($rut, $id_empresa) , $PRINCIPAL);
        $row_slider = ColocaEstadColocaEstadosPorClasificacionOrderSlider($PRINCIPAL, $rut, $id_malla, $id_empresa);
        $PRINCIPAL = str_replace("{TC_ROWS_SLIDER}", $row_slider, $PRINCIPAL);
        $PRINCIPAL = ColocaDatosPerfil($PRINCIPAL, $rut);
        echo $PRINCIPAL;
    }
    else if ($seccion == "home_tc_asesores") {
        $rut = $_SESSION["user_"];
        $id_empresa = $_SESSION["id_empresa"];
        $vv = $_GET["vv"];
        $im = $_GET["im"];
        $PRINCIPAL = FuncionesTransversales(file_get_contents("views/templates/tc_asesores.html"));
        $sa = $_GET["sa"];
        $datos_malla = VerificaMallaDadoPrograma($rut, $id_empresa, "bci_tcampo");
        $id_malla = $datos_malla[0]->id_malla;
        $PRINCIPAL = ColocaEstadosPorClasificacion($PRINCIPAL, $rut, $id_malla, $id_empresa);
        $PRINCIPAL = BarraNavegacion($PRINCIPAL, $seccion);
        $PRINCIPAL = ColocarSliderPorNoticia($PRINCIPAL, $id_empresa);
        $PRINCIPAL = ColocaMenuSecundario($PRINCIPAL, $_SESSION["id_empresa"]);
        $PRINCIPAL = str_replace("{AVANCEMALLATOTAL}", $arreglo_row_avance[1], $PRINCIPAL);
        $PRINCIPAL = str_replace("{ID_MALLA_ENCODEADA}", $im, $PRINCIPAL);
        $PRINCIPAL = str_replace("{ROW_LISTA_PROGRAMAS}", $arreglo_row_avance[0], $PRINCIPAL);
        $PRINCIPAL = str_replace("{SECCION_PREGUNTA}", ColocaBloquePreguntaPorObjeto($datos_objeto[0]->id, $rut, 4) , $PRINCIPAL);
        $PRINCIPAL = str_replace("{ROW_PESTANAS_LI_FOCOS}", ColocaPestanasFocosHome($rut, $id_empresa) , $PRINCIPAL);
        $row_slider = ColocaEstadColocaEstadosPorClasificacionOrderSlider($PRINCIPAL, $rut, $id_malla, $id_empresa);
        $PRINCIPAL = str_replace("{TC_ROWS_SLIDER}", $row_slider, $PRINCIPAL);
        $PRINCIPAL = ColocaDatosPerfil($PRINCIPAL, $rut);
        echo $PRINCIPAL;
    }
    else if ($seccion == "home_crmbp") {
        $rut = $_SESSION["user_"];
        $id_empresa = $_SESSION["id_empresa"];
        $vv = $_GET["vv"];
        $im = $_GET["im"];
        $viovideo_visto = 0;
        $viovideoarray = vio_vide_intro($rut, "home_crmbp", $id_empresa);
        //    print_r($viovideoarray);
        $cuentaVideoArray = $viovideoarray[0]->cuenta;
        if ($cuentaVideoArray > 0) {
            $viovideo_visto = 1;
        }
        // echo "vv $vv , viovideo_visto $viovideo_visto";
        if ($vv == 1) {
            inserta_vio_video($rut, "home_crmbp", $id_empresa);
        }
        $viovideoarray = vio_vide_intro($rut, "home_crmbp", $id_empresa);
        $cuentaVideoArray = $viovideoarray[0]->cuenta;
        if ($cuentaVideoArray > 0) {
            $viovideo_visto = 1;
        }
        if ($viovideo_visto == 0) {
            $PRINCIPAL = FuncionesTransversales(file_get_contents("views/crm/index_intro.html"));
        }
        else {
            $PRINCIPAL = FuncionesTransversales(file_get_contents("views/crm/index.html"));
        }
        $PRINCIPAL = BarraNavegacion($PRINCIPAL, $seccion);
        $PRINCIPAL = ColocarSliderPorNoticia($PRINCIPAL, $id_empresa);
        $PRINCIPAL = ColocaMenuSecundario($PRINCIPAL, $_SESSION["id_empresa"]);
        $PRINCIPAL = str_replace("{AVANCEMALLATOTAL}", $arreglo_row_avance[1], $PRINCIPAL);
        $PRINCIPAL = str_replace("{ID_MALLA_ENCODEADA}", $im, $PRINCIPAL);
        $PRINCIPAL = str_replace("{ROW_LISTA_PROGRAMAS}", $arreglo_row_avance[0], $PRINCIPAL);
        $PRINCIPAL = str_replace("{SECCION_PREGUNTA}", ColocaBloquePreguntaPorObjeto($datos_objeto[0]->id, $rut, 4) , $PRINCIPAL);
        $PRINCIPAL = str_replace("{ROW_PESTANAS_LI_FOCOS}", ColocaPestanasFocosHome($rut, $id_empresa) , $PRINCIPAL);
        $PRINCIPAL = ColocaDatosPerfil($PRINCIPAL, $rut);
        echo $PRINCIPAL;
    }
    else if ($seccion == "home_crmbp_faq") {
        $rut = $_SESSION["user_"];
        $id_empresa = $_SESSION["id_empresa"];
        $vv = $_GET["vv"];
        $im = $_GET["im"];
        $PRINCIPAL = FuncionesTransversales(file_get_contents("views/crm/index_faq.html"));
        $PRINCIPAL = BarraNavegacion($PRINCIPAL, $seccion);
        $PRINCIPAL = ColocarSliderPorNoticia($PRINCIPAL, $id_empresa);
        $PRINCIPAL = ColocaMenuSecundario($PRINCIPAL, $_SESSION["id_empresa"]);
        $PRINCIPAL = str_replace("{AVANCEMALLATOTAL}", $arreglo_row_avance[1], $PRINCIPAL);
        $PRINCIPAL = str_replace("{ID_MALLA_ENCODEADA}", $im, $PRINCIPAL);
        $PRINCIPAL = str_replace("{ROW_LISTA_PROGRAMAS}", $arreglo_row_avance[0], $PRINCIPAL);
        $PRINCIPAL = str_replace("{SECCION_PREGUNTA}", ColocaBloquePreguntaPorObjeto($datos_objeto[0]->id, $rut, 4) , $PRINCIPAL);
        $PRINCIPAL = str_replace("{ROW_PESTANAS_LI_FOCOS}", ColocaPestanasFocosHome($rut, $id_empresa) , $PRINCIPAL);
        $PRINCIPAL = ColocaDatosPerfil($PRINCIPAL, $rut);
        echo $PRINCIPAL;
    }
    else if ($seccion == "faq") {
        $rut = $_SESSION["user_"];
        $id_empresa = $_SESSION["id_empresa"];
        $PRINCIPAL = Noticias(FuncionesTransversales(file_get_contents("views/faq/index.html")) , 7, 2, "");
        $PRINCIPAL = BarraNavegacion($PRINCIPAL, $seccion);
        $PRINCIPAL = ColocarSliderPorNoticia($PRINCIPAL, $id_empresa);
        $PRINCIPAL = ColocaMenuSecundario($PRINCIPAL, $_SESSION["id_empresa"]);
        $PRINCIPAL = ColocaIndicadoresVarios($PRINCIPAL);
        $PRINCIPAL = ColocaIndicadoresGlobales($PRINCIPAL, $id_empresa);
        $PRINCIPAL = Noticias($PRINCIPAL, "enFila", "limit 4", "");
        $arreglo_row_avance = lms_integracion_programas($rut, $id_empresa);
        $PRINCIPAL = str_replace("{AVANCEMALLATOTAL}", $arreglo_row_avance[1], $PRINCIPAL);
        $PRINCIPAL = str_replace("{ROW_LISTA_PROGRAMAS}", $arreglo_row_avance[0], $PRINCIPAL);
        $PRINCIPAL = str_replace("{SECCION_PREGUNTA}", ColocaBloquePreguntaPorObjeto($datos_objeto[0]->id, $rut, 4) , $PRINCIPAL);
        $PRINCIPAL = str_replace("{ROW_PESTANAS_LI_FOCOS}", ColocaPestanasFocosHome($rut, $id_empresa) , $PRINCIPAL);
        $PRINCIPAL = ColocaDatosPerfil($PRINCIPAL, $rut);
        echo $PRINCIPAL;
    }
    else if ($seccion == "IngresaComentarioPorPostSinMostrarComentarios") {
        $comentario = mysql_real_escape_string(trim(utf8_decode($_POST["comentario"])));
        $id_empresa = $_SESSION["id_empresa"];
        $rut = Decodear3($_POST["rut"]);
        $idmp = Decodear3($_POST["idmp"]);
        $numero = ($_POST["numero"]);
        if ($numero == 1) {
            InsertaComentarioPorPost($rut, $idmp, $comentario);
            $datos_mp = TraeDatosMP2($idmp, $id_empresa);
            if ($datos_mp[0]->id_objeto) {
                FinalizaObjetoFullDatos($rut, $datos_mp[0]->id_objeto, $id_empresa);
            }
        }
        $ultimo_id = InsertaEntablaInteraccion($id_empresa, $rut, $rut, $comentario, "1", "COMENTARIO", $idmp);
        // print_r($ultimo_id[0]->valor);
        // echo "<br />----<br />";
        // print_r($ultimo_id);
        GAMIFICACIONInsertaPuntosPorObjeto($rut, $ultimo_id[0]->valor, "comunidadmpa", $id_empresa, "1", "0", "", "", "", "comunidadmpa");
        // $comentarios=MuestraComentariosPorPost($idmp, 10, $numero);
        echo file_get_contents("views/comunidad_mp/" . $id_empresa . "_com_mp_texto_concurso.html");
    }

    else if ($seccion == "IngresaComentarioPorPostform") {
        $comentario = mysql_real_escape_string(trim(utf8_decode($_POST["comentario"])));
        $id_empresa = $_SESSION["id_empresa"];
        // $rut=Decodear3($_POST["rut"]);
        $rut = $_SESSION["user_"];
        $idmp = Decodear3($_POST["idmp"]);
        $numero = mysql_real_escape_string(trim($_POST["numero"]));
        $story = $_POST["story"];
        $pagina     = $_POST["pagina"];
        $id_pagina  = $_POST["id_pagina"];
        // guarda tagueados
        $tagueados = buscaarrobadomain($comentario, $idmp, $rut, $id_empresa);
        // print_r($tagueados);
        if ($numero == 1) {
            $comentario_clean = 0;
            $guarda = 0;
            $Array_Banned = MP_SearchBannedWords($id_empresa);
            if (!mp_search_banned_words($comentario, $Array_Banned)) {
                $comentario_clean = 1;
            }
            else {
                echo '<link href="bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css">
                            <br /><br /><br /><div class="alert alert-danger" role="alert">
                             <center> <strong>Cuidado</strong>: el comentario contiene Palabras Prohibidas</center>
                            </div>';
                sleep(3);
            }
            if ($comentario_clean == 1) {
                $guarda == 1;
            }
            else {
                echo "<script>window.history.back();</script>";
                exit();
            }
            // echo "$rut<>'' and $comentario<>'' and $idmp<>'' and $guarda==1, comentario_clean $comentario_clean";
            if ($rut <> '' and $comentario <> '' and $idmp <> '' and $comentario_clean == 1) {
                InsertaComentarioPorPost($rut, $idmp, $comentario);
                $ultimo_id = InsertaEntablaInteraccion($id_empresa, $rut, $rut, $comentario, "1", "COMENTARIO", $idmp);
                GAMIFICACIONInsertaPuntosPorObjeto($rut, $ultimo_id[0]->valor, "comunidadmpa", $id_empresa, "1", "0", "", "", "", "comunidadmpa");
                $arreglo_MP = DatosMP($id_empresa, $idmp);
                $arreglo_Usuario = mp_DATOSPERSONAS($rut, $id_empresa);
                $arreglo_Destinatario = mp_DATOSPERSONAS($arreglo_MP[0]->rut, $id_empresa);
                if ($_SESSION["id_empresa"] == 62) {
                    // envio email al experto general
                    $subject = "Han comentado tu publicacion: " . utf8_encode($arreglo_MP[0]->nombre);
                    $subtitulo1 = utf8_encode($arreglo_Usuario[0]->nombre_completo) . " ha comentado tu publicacion!";
                    $texto1 = utf8_encode($arreglo_Destinatario[0]->nombre_completo) . ", hay un nuevo comentario en la publicacion:  ";
                    $texto2 = utf8_encode($arreglo_MP[0]->nombre);
                    $texto3 = "";
                    $tipomensaje = "Notificacion_Comentario_Comunidad";
                    $rut = $arreglo_MP[0]->rut;
                    $key = $arreglo_MP[0]->id_mp;
                    $to = $arreglo_Destinatario[0]->email;
                    $url = $url_base . "/front/?sw=login_ext&ambiente=com_mp_full&id=" . $arreglo_MP[0]->id_mp . "&id_mp=" . $arreglo_MP[0]->id_mp;
                    $nombreto = utf8_encode($arreglo_Destinatario[0]->nombre_completo);
                    SendGrid_Email($to, $nombreto, $from, $nombrefrom, $tipo, $subject, $titulo1, $subtitulo1, $texto1, $url, $texto_url, $texto2, $texto3, $texto4, $logo, $id_empresa, $url, $tipomensaje, $rut, $key);
                    $subject = "Han comentado tu publicacion: " . utf8_encode($arreglo_MP[0]->nombre);
                    $subtitulo1 = utf8_encode($arreglo_Usuario[0]->nombre_completo) . " ha comentado tu publicacion!";
                    $texto1 = utf8_encode($arreglo_Destinatario[0]->nombre_completo) . ", hay un nuevo comentario en la publicacion:  ";
                    $texto2 = utf8_encode($arreglo_MP[0]->nombre);
                    $texto3 = "";
                    $tipomensaje = "Notificacion_Comentario_Comunidad";
                    $rut = $arreglo_MP[0]->rut;
                    $key = $arreglo_MP[0]->id_mp;
                    $url = $url_base . "/front/?sw=login_ext&ambiente=com_mp_full&id=" . $arreglo_MP[0]->id_mp . "&id_mp=" . $arreglo_MP[0]->id_mp;
                    $to = "paulina.cruz@bci.cl";
                    $nombreto = "rod@gop.cl";
                    SendGrid_Email($to, $nombreto, $from, $nombrefrom, $tipo, $subject, $titulo1, $subtitulo1, $texto1, $url, $texto_url, $texto2, $texto3, $texto4, $logo, $id_empresa, $url, $tipomensaje, $rut, $key);
                    $subject = "Han comentado tu publicacion: " . utf8_encode($arreglo_MP[0]->nombre);
                    $subtitulo1 = utf8_encode($arreglo_Usuario[0]->nombre_completo) . " ha comentado tu publicacion!";
                    $texto1 = utf8_encode($arreglo_Destinatario[0]->nombre_completo) . ", hay un nuevo comentario en la publicacion:  ";
                    $texto2 = utf8_encode($arreglo_MP[0]->nombre);
                    $texto3 = "";
                    $url = $url_base . "/front/?sw=login_ext&ambiente=com_mp_full&id=" . $arreglo_MP[0]->id_mp . "&id_mp=" . $arreglo_MP[0]->id_mp;
                    $tipomensaje = "Notificacion_Comentario_Comunidad";
                    $rut = $arreglo_MP[0]->rut;
                    $key = $arreglo_MP[0]->id_mp;
                    $to = "carolina.majluf@bci.cl";
                    $nombreto = "carolina.majluf@bci.cl";
                    SendGrid_Email($to, $nombreto, $from, $nombrefrom, $tipo, $subject, $titulo1, $subtitulo1, $texto1, $url, $texto_url, $texto2, $texto3, $texto4, $logo, $id_empresa, $url, $tipomensaje, $rut, $key);
                }
                // tagueados
                foreach($tagueados as $tagueado) {
                    // echo $tagueado;
                    $arreglo_Destinatario = mp_DATOSPERSONAS($tagueado, $id_empresa);
                    // envio email a los tagueados
                    if ($_SESSION["id_empresa"] == 62) {
                        $subject = "Has sido etiquetado en la publicacion: " . utf8_encode($arreglo_MP[0]->nombre);
                        $subtitulo1 = utf8_encode($arreglo_Destinatario[0]->nombre_completo) . ", has sido etiquetado por " . $arreglo_Usuario[0]->nombre_completo;
                        $texto1 = "Revisa la publicacion:  ";
                        $texto2 = utf8_encode($arreglo_MP[0]->nombre);
                        $texto3 = "";
                        $tipomensaje = "Notificacion_Etiquetado_Comunidad";
                        $rut = $tagueado;
                        $key = $arreglo_MP[0]->id_mp;
                        $to = $arreglo_Destinatario[0]->email;
                        $nombreto = utf8_encode($arreglo_Destinatario[0]->nombre_completo);
                        $url = $url_base . "/front/?sw=login_ext&ambiente=com_mp_full&id=" . $arreglo_MP[0]->id_mp . "&id_mp=" . $arreglo_MP[0]->id_mp;
                        SendGrid_Email($to, $nombreto, $from, $nombrefrom, $tipo, $subject, $titulo1, $subtitulo1, $texto1, $url, $texto_url, $texto2, $texto3, $texto4, $logo, $id_empresa, $url, $tipomensaje, $rut, $key);
                        $subject = "Has sido etiquetado en la publicacion: " . utf8_encode($arreglo_MP[0]->nombre);
                        $subtitulo1 = utf8_encode($arreglo_Destinatario[0]->nombre_completo) . ", has sido etiquetado por " . $arreglo_Usuario[0]->nombre_completo;
                        $texto1 = "Revisa la publicacion:  ";
                        $texto2 = utf8_encode($arreglo_MP[0]->nombre);
                        $texto3 = "";
                        $tipomensaje = "Notificacion_Etiquetado_Comunidad";
                        $rut = $tagueado;
                        $key = $arreglo_MP[0]->id_mp;
                        $to = "paulina.cruz@bci.cl";
                        $nombreto = utf8_encode($arreglo_Destinatario[0]->nombre_completo);
                        $url = $url_base . "/front/?sw=login_ext&ambiente=com_mp_full&id=" . $arreglo_MP[0]->id_mp . "&id_mp=" . $arreglo_MP[0]->id_mp;
                        //SendGrid_Email($to, $nombreto, $from, $nombrefrom, $tipo, $subject, $titulo1, $subtitulo1, $texto1, $url, $texto_url, $texto2, $texto3, $texto4, $logo, $id_empresa, $url, $tipomensaje, $rut, $key);
                        $subject = "Has sido etiquetado en la publicacion: " . utf8_encode($arreglo_MP[0]->nombre);
                        $subtitulo1 = utf8_encode($arreglo_Destinatario[0]->nombre_completo) . ", has sido etiquetado por " . $arreglo_Usuario[0]->nombre_completo;
                        $texto1 = "Revisa la publicacion:  ";
                        $texto2 = utf8_encode($arreglo_MP[0]->nombre);
                        $texto3 = "";
                        $tipomensaje = "Notificacion_Etiquetado_Comunidad";
                        $rut = $tagueado;
                        $key = $arreglo_MP[0]->id_mp;
                        $to = "carolina.majluf@bci.cl";
                        $nombreto = utf8_encode($arreglo_Destinatario[0]->nombre_completo);
                        $url = $url_base . "/front/?sw=login_ext&ambiente=com_mp_full&id=" . $arreglo_MP[0]->id_mp . "&id_mp=" . $arreglo_MP[0]->id_mp;
                        //SendGrid_Email($to, $nombreto, $from, $nombrefrom, $tipo, $subject, $titulo1, $subtitulo1, $texto1, $url, $texto_url, $texto2, $texto3, $texto4, $logo, $id_empresa, $url, $tipomensaje, $rut, $key);

                     COMUNIDAD_InsertaInteraccionConContenidoRemitente($idmp,$id_empresa, $rut, $arreglo_Destinatario[0]->rut, "TAGUEADO", "Tagueado en Comentario");

                 }
                }
            }
            $datos_mp = TraeDatosMP2($idmp, $id_empresa);
            if ($datos_mp[0]->id_objeto) {
                FinalizaObjetoFullDatos($rut, $datos_mp[0]->id_objeto, $id_empresa);
            }
        }
        // $comentarios=MuestraComentariosPorPost($idmp, 10, $numero);
        // $bloque_funcion_js_reply=file_get_contents("views/comunidad_mp/".$id_empresa."_com_mp_funcion_js_reply.html");
        // echo file_get_contents("views/comunidad_mp/".$id_empresa."_com_mp_texto_concurso.html");
        // echo $bloque_funcion_js_reply;
        // echo $comentarios;
        if ($story) {
            echo "<script>
                location.href='?sw=com_mp_fotoGPTW&id_mp=" . $idmp . "#Bloque" . $id_comentario . "';
                </script>";
            exit;
        }
        elseif($pagina)
         {
            echo "<script>
                location.href='?sw=com_mp_full&id_mp=" . $idmp . "#Bloque" . $id_comentario . "';
                </script>";
            exit;
        }
        else
         {
            echo "<script>
                location.href='?sw=playbook_pagina&id_p=".$id_pagina."';
                </script>";
            exit;
        }
    }

    else if ($seccion == "IngresaComentarioPorPostformPagina") {
        $comentario = mysql_real_escape_string(trim(utf8_decode($_POST["comentario"])));
        $id_empresa = $_SESSION["id_empresa"];
        // $rut=Decodear3($_POST["rut"]);
        //print_r($_POST); exit();
        $rut = $_SESSION["user_"];
        $idmp = Decodear3($_POST["idmp"]);
        $numero = mysql_real_escape_string(trim($_POST["numero"]));
        $story = $_POST["story"];
        $pagina     = $_POST["pagina"];
        $id_pagina  = $_POST["id_pagina"];
        // guarda tagueados
        $tagueados = buscaarrobadomain($comentario, $idmp, $rut, $id_empresa);
        // print_r($tagueados);
        if ($numero == 1) {
            $comentario_clean = 0;
            $guarda = 0;
            $Array_Banned = MP_SearchBannedWords($id_empresa);
            if (!mp_search_banned_words($comentario, $Array_Banned)) {
                $comentario_clean = 1;
            }
            else {
                echo '<link href="bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css">
                            <br /><br /><br /><div class="alert alert-danger" role="alert">
                             <center> <strong>Cuidado</strong>: el comentario contiene Palabras Prohibidas</center>
                            </div>';
                sleep(3);
            }
            if ($comentario_clean == 1) {
                $guarda == 1;
            }
            else {
                echo "<script>window.history.back();</script>";
                exit();
            }
            // echo "$rut<>'' and $comentario<>'' and $idmp<>'' and $guarda==1, comentario_clean $comentario_clean";
            if ($rut <> '' and $comentario <> '' and $idmp <> '' and $comentario_clean == 1) {
                InsertaComentarioPorPost($rut, $idmp, $comentario);
                $ultimo_id = InsertaEntablaInteraccion($id_empresa, $rut, $rut, $comentario, "1", "COMENTARIO", $idmp);
                //GAMIFICACIONInsertaPuntosPorObjeto($rut, $ultimo_id[0]->valor, "comunidadmpa", $id_empresa, "1", "0", "", "", "", "comunidadmpa");
                $arreglo_MP = DatosMP($id_empresa, $idmp);
                $arreglo_Usuario = mp_DATOSPERSONAS($rut, $id_empresa);
                $arreglo_Destinatario = mp_DATOSPERSONAS($arreglo_MP[0]->rut, $id_empresa);
                if ($_SESSION["id_empresa"] == 62) {
                    // envio email al experto general
                    $subject = "Han comentado tu publicacion: " . utf8_encode($arreglo_MP[0]->nombre);
                    $subtitulo1 = utf8_encode($arreglo_Usuario[0]->nombre_completo) . " ha comentado tu publicacion!";
                    $texto1 = utf8_encode($arreglo_Destinatario[0]->nombre_completo) . ", hay un nuevo comentario en la publicacion:  ";
                    $texto2 = utf8_encode($arreglo_MP[0]->nombre);
                    $texto3 = "";
                    $tipomensaje = "Notificacion_Comentario_Comunidad";
                    $rut = $arreglo_MP[0]->rut;
                    $key = $arreglo_MP[0]->id_mp;
                    $to = $arreglo_Destinatario[0]->email;
                    $url = $url_base . "/front/?sw=login_ext&ambiente=com_mp_full&id=" . $arreglo_MP[0]->id_mp . "&id_mp=" . $arreglo_MP[0]->id_mp;
                    $nombreto = utf8_encode($arreglo_Destinatario[0]->nombre_completo);
                    //SendGrid_Email($to, $nombreto, $from, $nombrefrom, $tipo, $subject, $titulo1, $subtitulo1, $texto1, $url, $texto_url, $texto2, $texto3, $texto4, $logo, $id_empresa, $url, $tipomensaje, $rut, $key);
                    $subject = "Han comentado tu publicacion: " . utf8_encode($arreglo_MP[0]->nombre);
                    $subtitulo1 = utf8_encode($arreglo_Usuario[0]->nombre_completo) . " ha comentado tu publicacion!";
                    $texto1 = utf8_encode($arreglo_Destinatario[0]->nombre_completo) . ", hay un nuevo comentario en la publicacion:  ";
                    $texto2 = utf8_encode($arreglo_MP[0]->nombre);
                    $texto3 = "";
                    $tipomensaje = "Notificacion_Comentario_Comunidad";
                    $rut = $arreglo_MP[0]->rut;
                    $key = $arreglo_MP[0]->id_mp;
                    $url = $url_base . "/front/?sw=login_ext&ambiente=com_mp_full&id=" . $arreglo_MP[0]->id_mp . "&id_mp=" . $arreglo_MP[0]->id_mp;
                    $to = "paulina.cruz@bci.cl";
                    $nombreto = "rod@gop.cl";
                    //SendGrid_Email($to, $nombreto, $from, $nombrefrom, $tipo, $subject, $titulo1, $subtitulo1, $texto1, $url, $texto_url, $texto2, $texto3, $texto4, $logo, $id_empresa, $url, $tipomensaje, $rut, $key);
                    $subject = "Han comentado tu publicacion: " . utf8_encode($arreglo_MP[0]->nombre);
                    $subtitulo1 = utf8_encode($arreglo_Usuario[0]->nombre_completo) . " ha comentado tu publicacion!";
                    $texto1 = utf8_encode($arreglo_Destinatario[0]->nombre_completo) . ", hay un nuevo comentario en la publicacion:  ";
                    $texto2 = utf8_encode($arreglo_MP[0]->nombre);
                    $texto3 = "";
                    $url = $url_base . "/front/?sw=login_ext&ambiente=com_mp_full&id=" . $arreglo_MP[0]->id_mp . "&id_mp=" . $arreglo_MP[0]->id_mp;
                    $tipomensaje = "Notificacion_Comentario_Comunidad";
                    $rut = $arreglo_MP[0]->rut;
                    $key = $arreglo_MP[0]->id_mp;
                    $to = "carolina.majluf@bci.cl";
                    $nombreto = "carolina.majluf@bci.cl";
                    //SendGrid_Email($to, $nombreto, $from, $nombrefrom, $tipo, $subject, $titulo1, $subtitulo1, $texto1, $url, $texto_url, $texto2, $texto3, $texto4, $logo, $id_empresa, $url, $tipomensaje, $rut, $key);
                }
                // tagueados
                foreach($tagueados as $tagueado) {
                    // echo $tagueado;
                    $arreglo_Destinatario = mp_DATOSPERSONAS($tagueado, $id_empresa);
                    // envio email a los tagueados
                    if ($_SESSION["id_empresa"] == 62) {
                        $subject = "Has sido etiquetado en la publicacion: " . utf8_encode($arreglo_MP[0]->nombre);
                        $subtitulo1 = utf8_encode($arreglo_Destinatario[0]->nombre_completo) . ", has sido etiquetado por " . $arreglo_Usuario[0]->nombre_completo;
                        $texto1 = "Revisa la publicacion:  ";
                        $texto2 = utf8_encode($arreglo_MP[0]->nombre);
                        $texto3 = "";
                        $tipomensaje = "Notificacion_Etiquetado_Comunidad";
                        $rut = $tagueado;
                        $key = $arreglo_MP[0]->id_mp;
                        $to = $arreglo_Destinatario[0]->email;
                        $nombreto = utf8_encode($arreglo_Destinatario[0]->nombre_completo);
                        $url = $url_base . "/front/?sw=login_ext&ambiente=com_mp_full&id=" . $arreglo_MP[0]->id_mp . "&id_mp=" . $arreglo_MP[0]->id_mp;
                        //SendGrid_Email($to, $nombreto, $from, $nombrefrom, $tipo, $subject, $titulo1, $subtitulo1, $texto1, $url, $texto_url, $texto2, $texto3, $texto4, $logo, $id_empresa, $url, $tipomensaje, $rut, $key);
                        $subject = "Has sido etiquetado en la publicacion: " . utf8_encode($arreglo_MP[0]->nombre);
                        $subtitulo1 = utf8_encode($arreglo_Destinatario[0]->nombre_completo) . ", has sido etiquetado por " . $arreglo_Usuario[0]->nombre_completo;
                        $texto1 = "Revisa la publicacion:  ";
                        $texto2 = utf8_encode($arreglo_MP[0]->nombre);
                        $texto3 = "";
                        $tipomensaje = "Notificacion_Etiquetado_Comunidad";
                        $rut = $tagueado;
                        $key = $arreglo_MP[0]->id_mp;
                        $to = "paulina.cruz@bci.cl";
                        $nombreto = utf8_encode($arreglo_Destinatario[0]->nombre_completo);
                        $url = $url_base . "/front/?sw=login_ext&ambiente=com_mp_full&id=" . $arreglo_MP[0]->id_mp . "&id_mp=" . $arreglo_MP[0]->id_mp;
                        //SendGrid_Email($to, $nombreto, $from, $nombrefrom, $tipo, $subject, $titulo1, $subtitulo1, $texto1, $url, $texto_url, $texto2, $texto3, $texto4, $logo, $id_empresa, $url, $tipomensaje, $rut, $key);
                        $subject = "Has sido etiquetado en la publicacion: " . utf8_encode($arreglo_MP[0]->nombre);
                        $subtitulo1 = utf8_encode($arreglo_Destinatario[0]->nombre_completo) . ", has sido etiquetado por " . $arreglo_Usuario[0]->nombre_completo;
                        $texto1 = "Revisa la publicacion:  ";
                        $texto2 = utf8_encode($arreglo_MP[0]->nombre);
                        $texto3 = "";
                        $tipomensaje = "Notificacion_Etiquetado_Comunidad";
                        $rut = $tagueado;
                        $key = $arreglo_MP[0]->id_mp;
                        $to = "carolina.majluf@bci.cl";
                        $nombreto = utf8_encode($arreglo_Destinatario[0]->nombre_completo);
                        $url = $url_base . "/front/?sw=login_ext&ambiente=com_mp_full&id=" . $arreglo_MP[0]->id_mp . "&id_mp=" . $arreglo_MP[0]->id_mp;
                        //SendGrid_Email($to, $nombreto, $from, $nombrefrom, $tipo, $subject, $titulo1, $subtitulo1, $texto1, $url, $texto_url, $texto2, $texto3, $texto4, $logo, $id_empresa, $url, $tipomensaje, $rut, $key);

                     //COMUNIDAD_InsertaInteraccionConContenidoRemitente($idmp,$id_empresa, $rut, $arreglo_Destinatario[0]->rut, "TAGUEADO", "Tagueado en Comentario");

                 }
                }
            }
            //$datos_mp = TraeDatosMP2($idmp, $id_empresa);
            //if ($datos_mp[0]->id_objeto) {
                //FinalizaObjetoFullDatos($rut, $datos_mp[0]->id_objeto, $id_empresa);
            //}
        }
        // $comentarios=MuestraComentariosPorPost($idmp, 10, $numero);
        // $bloque_funcion_js_reply=file_get_contents("views/comunidad_mp/".$id_empresa."_com_mp_funcion_js_reply.html");
        // echo file_get_contents("views/comunidad_mp/".$id_empresa."_com_mp_texto_concurso.html");
        // echo $bloque_funcion_js_reply;
        // echo $comentarios;

            echo "<script>
                location.href='?sw=playbook_pagina&id_p=".$id_pagina."';
                </script>";
            exit;

 }


    else if ($seccion == "IngresaComentarioPorPost") {
        $comentario = mysql_real_escape_string(trim(utf8_decode($_POST["comentario"])));
        $id_empresa = $_SESSION["id_empresa"];
        // $rut=Decodear3($_POST["rut"]);
        $rut = $_SESSION["user_"];
        $idmp = ($_POST["idmp"]);
        $numero = mysql_real_escape_string(trim($_POST["numero"]));
        if ($numero == 1) {
            InsertaComentarioPorPost($rut, $idmp, $comentario);
            $datos_mp = TraeDatosMP2($idmp, $id_empresa);
            if ($datos_mp[0]->id_objeto) {
                FinalizaObjetoFullDatos($rut, $datos_mp[0]->id_objeto, $id_empresa);
            }
        }
        $ultimo_id = InsertaEntablaInteraccion($id_empresa, $rut, $rut, $comentario, "1", "COMENTARIO", $idmp);
        GAMIFICACIONInsertaPuntosPorObjeto($rut, $ultimo_id[0]->valor, "comunidadmpa", $id_empresa, "1", "0", "", "", "", "comunidadmpa");
        $comentarios = MuestraComentariosPorPost($idmp, 10, $numero);
        $arreglo_MP = DatosMP($_SESSION["id_empresa"], $idmp);
        $arreglo_Usuario = mp_DATOSPERSONAS($rut, $_SESSION["id_empresa"]);
        if ($_SESSION["id_empresa"] == 62) {
            // envio email al experto general
            $subject = "Han comentado tu comentario en la publicacion: " . utf8_encode($arreglo_MP[0]->nombre);
            $subtitulo1 = utf8_encode($arreglo_Usuario[0]->nombre_completo) . " ha comentado tu publicacion!";
            $texto1 = utf8_encode($arreglo_Destinatario[0]->nombre_completo) . ", hay un nuevo comentario en la publicacion:  ";
            $texto2 = utf8_encode($arreglo_MP[0]->nombre);
            $texto3 = "";
            $tipomensaje = "Notificacion_Comentario_Reply_Comunidad";
            $rut = $arreglo_MP[0]->rut;
            $key = $arreglo_MP[0]->id_mp;
            $to = "rod@gop.cl";
            $nombreto = "rod@gop.cl";
            // $to=$arreglo_Destinatario[0]->email;
            $url = $url_base . "/front/?sw=login_ext&ambiente=com_mp_full&id=" . $arreglo_MP[0]->id_mp . "&id_mp=" . $arreglo_MP[0]->id_mp;
            // $nombreto=utf8_encode($arreglo_Destinatario[0]->nombre_completo);
            SendGrid_Email($to, $nombreto, $from, $nombrefrom, $tipo, $subject, $titulo1, $subtitulo1, $texto1, $url, $texto_url, $texto2, $texto3, $texto4, $logo, $id_empresa, $url, $tipomensaje, $rut, $key);
        }
        $bloque_funcion_js_reply = file_get_contents("views/comunidad_mp/" . $id_empresa . "_com_mp_funcion_js_reply.html");
        if ($id_empresa == 62) {
            echo file_get_contents("views/comunidad_mp/" . $id_empresa . "_com_mp_texto_concurso.html");
        }
        echo $bloque_funcion_js_reply;
        echo $comentarios;
    }
    else if ($seccion == "muestraTextareaDadoValorSeleccionado") {
        $id_empresa = $_SESSION["id_empresa"];
        $nombre_para_textarea = $_POST["nombre_para_textarea"];
        if ($_POST["valor_seleccionado"] == 1) {
            $template = file_get_contents("views/sgd/evaluacion/" . $id_empresa . "_row_comentario_por_pregunta.html");
            $template = str_replace("{NOMBRE_RADIO}", $nombre_para_textarea, $template);
            echo $template;
        }
        else if ($_POST["valor_seleccionado"] == 2) {
            $template = file_get_contents("views/sgd/evaluacion/" . $id_empresa . "_row_comentario_por_pregunta.html");
            $template = str_replace("{NOMBRE_RADIO}", $nombre_para_textarea, $template);
            echo $template;
        }
        else if ($_POST["valor_seleccionado"] == 4) {
            $template = file_get_contents("views/sgd/evaluacion/" . $id_empresa . "_row_comentario_por_pregunta.html");
            $template = str_replace("{NOMBRE_RADIO}", $nombre_para_textarea, $template);
            echo $template;
        }
    }
    else if ($seccion == "saveCompromisoPorObj") {
        $rut = $_SESSION["user_"];
        $id_empresa = $_SESSION["id_empresa"];
        $compromiso = utf8_decode($_POST["compromiso"]);
        $meta = utf8_decode($_POST["meta"]);
        $plan = utf8_decode($_POST["plan"]);
        $pa1 = utf8_decode($_POST["pa1"]);
        $pc1 = utf8_decode($_POST["pc1"]);
        $pa2 = utf8_decode($_POST["pa2"]);
        $pc2 = utf8_decode($_POST["pc2"]);
        $pa3 = utf8_decode($_POST["pa3"]);
        $pc3 = utf8_decode($_POST["pc3"]);
        $id_objeto = Decodear3($_POST["iob"]);
        FinalizaObjetoFullDatos($rut, $id_objeto, $id_empresa);
        InsertaCompromisoPorObjetoRut($rut, $id_objeto, $compromiso, $meta, $plan, $id_empresa, $pa1, $pc1, $pa2, $pc2, $pa3, $pc3);
        echo "<script>
                                    location.href='?sw=contenido&i=" . Encodear3($id_objeto) . "#Bloque" . $id_comentario . "';
                                    </script>";
        exit;
    }
    else if ($seccion == "downZip") {
        $id_objeto = Decodear3($_GET["i"]);
        $datos_objeto = DatosObjeto($id_objeto);
        $rut = $_SESSION["user_"];
        $id_empresa = $_SESSION["id_empresa"];
        FinalizaObjetoFullDatos($rut, $id_objeto, $id_empresa);
        $url = $datos_objeto[0]->url;
        // $file = basename($_GET['file']);
        // $path = $root.$file;
        // $type = '';
        // echo $url;exit;
        $type = "application/force-download";
        header("Content-Type: $type");
        header("Content-Disposition: attachment; filename='" . $datos_objeto[0]->archivo_descarga . "'");
        header("Content-Transfer-Encoding: binary");
        // header("Content-Length: " . $size);
        // Descargar archivo
        readfile($url);
        echo "<script>window.opener.location.reload();</script>";
    }
    else if ($seccion == "home_indicadores") {
        $rut = $_SESSION["user_"];
        $id_empresa = $_SESSION["id_empresa"];
        $PRINCIPAL = Noticias(FuncionesTransversales(file_get_contents("views/indicadores/" . $_SESSION["id_empresa"] . "_home_indicadores.html")) , 7, 2, "");
        $PRINCIPAL = BarraNavegacion($PRINCIPAL, $seccion);
        $PRINCIPAL = ColocarSliderPorNoticia($PRINCIPAL, $id_empresa);
        $PRINCIPAL = ColocaMenuSecundario($PRINCIPAL, $_SESSION["id_empresa"]);
        $PRINCIPAL = ColocaIndicadoresVarios($PRINCIPAL);
        $PRINCIPAL = ColocaIndicadoresGlobales($PRINCIPAL, $id_empresa);
        $PRINCIPAL = Noticias($PRINCIPAL, "enFila", "limit 4", "");
        $arreglo_row_avance = lms_integracion_programas($rut, $id_empresa);
        $PRINCIPAL = str_replace("{AVANCEMALLATOTAL}", $arreglo_row_avance[1], $PRINCIPAL);
        $PRINCIPAL = str_replace("{ROW_LISTA_PROGRAMAS}", $arreglo_row_avance[0], $PRINCIPAL);
        $PRINCIPAL = str_replace("{SECCION_PREGUNTA}", ColocaBloquePreguntaPorObjeto($datos_objeto[0]->id, $rut, 4) , $PRINCIPAL);
        $PRINCIPAL = str_replace("{ROW_PESTANAS_LI_FOCOS}", ColocaPestanasFocosHome($rut, $id_empresa) , $PRINCIPAL);
        $PRINCIPAL = ColocaDatosPerfil($PRINCIPAL, $rut);
        echo $PRINCIPAL;
    }
    else if ($seccion == "GuardaReplyPorComentario") {
        // inserto Comentario
        $rut = $_SESSION["user_"];
        $id_empresa = $_SESSION["id_empresa"];
        $comentario = utf8_decode($_POST["reply"]);
        $id_comentario = $_POST["id_comentario"];
        $id_objeto = Decodear3($_POST["idob"]);
        InsertaReplyComentarioPorObjeto($id_empresa, $rut, $comentario, $id_comentario);
        echo "<script>
                                    location.href='?sw=contenido&i=" . Encodear3($id_objeto) . "#Bloque" . $id_comentario . "';
                                    </script>";
        exit;
    }
    else if ($seccion == "ComentarioPorDimensionObjetivos") {
        // Verifico si tiene comentarios por la dimension
        $id_dimension = $_POST["id_dimension"];
        $comentario = utf8_decode($_POST["comentario"]);
        $rut = $_POST["rut"];
        $tiene_comentarios = TieneComentariosObjetivosPorDimension($id_dimension, $rut);
        if ($tiene_comentarios) {
            // Actualizar
            ActualizaComentarioObjetivoPorDimension($id_dimension, $comentario, $rut);
            echo "Comentario Actualizado";
        }
        else {
            // Insertar
            InsertaComentarioPorObjetivoDimension($id_dimension, $comentario, $rut);
            echo "Comentario Insertado Correctamente";
        }
    }
    else if ($seccion == "filtro_objeto_por_curso_programa") {
        $arreglo_post = $_POST;
        $id_empresa = $_SESSION["id_empresa"];
        // Traigo los programas, de la tabla rel_lms_malla_curso con foco y empresa
        $objetos = CHECK_ObjetosPorCurso($arreglo_post["cursos"]);
        $options = "";
        $options.= "<option value='0'>Todos</option>";
        foreach($objetos as $obj) {
            $options.= "<option value='" . $obj->id . "'>" . $obj->titulo . "</option>";
        }
        echo utf8_encode($options);
    }
    else if ($seccion == "filtro_curso_por_programa2") {
        $arreglo_post = $_POST;
        $id_empresa = $_SESSION["id_empresa"];
        // Traigo los programas, de la tabla rel_lms_malla_curso con foco y empresa
        $programas = REL_MALLA_CURSO_TraeCursosDadoPrograma2($id_empresa, $arreglo_post);
        $options = "";
        $options.= "<option value='0'>Todos</option>";
        foreach($programas as $prog) {
            $options.= "<option value='" . $prog->id_curso . "'>" . $prog->nombre . " (" . $prog->id_curso . ")</option>";
        }
        echo utf8_encode($options);
    }
    else if ($seccion == "savePreguntasDesafio") {
        $rut_colaborador = Decodear3($_POST["ev"]);
        $rut_jefatura = Decodear3($_POST["evr"]);
        $id_objeto = Decodear3($_POST["idob"]);
        $id_curso = Decodear3($_POST["idc"]);
        $id_desafio = Decodear3($_POST["iddes"]);
        $id_empresa = $_SESSION["id_empresa"];
        $preguntas = TraigoPreguntasPorDesafio($id_desafio);
        foreach($preguntas as $preg) {
            $prefijo_archivo = substr(md5(uniqid(rand())) , 0, 6);
            if ($preg->tipo_pregunta == 1 or $preg->tipo_pregunta == 3) {
                if (trim(utf8_decode($_POST[$preg->id]))) {
                    $respuesta = trim(utf8_decode($_POST[$preg->id]));
                    // Verifico si para este usuario, objeto, pregunta, curso y empresa, tiene respuesta
                    $tiene_respuesta = VerificoPReguntaDesafio($rut_colaborador, $preg->id, $id_objeto, $id_curso, $id_empresa, $id_desafio);
                    // Si tiene Actualiza
                    if ($tiene_respuesta) {
                        // Actualizo
                        ActualizaRespuestasDesafios($rut_colaborador, $preg->id, trim(utf8_decode($_POST[$preg->id])) , $id_objeto, $id_curso, $id_empresa, $id_desafio);
                    }
                    else {
                        // Inserta
                        InsertaRespuestaDesafio($rut_colaborador, $preg->id, trim(utf8_decode($_POST[$preg->id])) , $id_objeto, $id_curso, $id_empresa, $id_desafio);
                    }
                    // Si no, inserto
                }
            }
            else if ($preg->tipo_pregunta == 2) {
                $tamano_archivo = $_FILES[$preg->id]['size'];
                $tipo_archivo = $_FILES[$preg->id]['type'];
                $archivo_archivo = $_FILES[$preg->id]['name'];
                $arreglo_archivo = explode(".", $archivo_archivo);
                $extension_archivo = $arreglo_archivo[1];
                $rutaarchivo = "objetos/" . $id_curso . "/" . $id_objeto;
                if ($arreglo_archivo != "") {
                    $nombre_archivo = $id_curso . "_" . $id_objeto . "_" . $rut_colaborador . "_" . $prefijo_archivo;
                    $datos_subida_archivo = SubirArchivosGenericos($_FILES, $extension_archivo, $nombre_archivo, $rutaarchivo, 1, $preg->id);
                    $nombre_archivo = $datos_subida_archivo[1];
                }
                $tiene_respuesta = VerificoPReguntaDesafio($rut_colaborador, $preg->id, $id_objeto, $id_curso, $id_empresa, $id_desafio);
                // Si tiene Actualiza
                if ($tiene_respuesta) {
                    // Actualizo
                    ActualizaRespuestasDesafios($rut_colaborador, $preg->id, $nombre_archivo, $id_objeto, $id_curso, $id_empresa, $id_desafio);
                }
                else {
                    // Inserta
                    InsertaRespuestaDesafio($rut_colaborador, $preg->id, $nombre_archivo, $id_objeto, $id_curso, $id_empresa, $id_desafio);
                }
            }
        }
        if ($_POST["fin"] == "1") {
            InsertaAccionPendiente($rut_colaborador, $rut_jefatura, $id_objeto, $id_curso, $id_empresa, 0);
            $PRINCIPAL = MuestraContenidoCap(FuncionesTransversales(file_get_contents("views/cursos/contenidos/" . $id_empresa . "_detalle_contenidoBloqueTexto.html")) , $id_objeto, $_SESSION["user_"], $pagina, $tipo_template);
            if ($id_objeto == "bci_pas_eval_m1") {
                $PRINCIPAL = str_replace("{BLOQUE_TEXTO}", "", $PRINCIPAL);
            }
            else {
                $PRINCIPAL = str_replace("{BLOQUE_TEXTO}", file_get_contents("views/cursos/objetos/acciones_pendientes/bloque_accion_realizada.html") , $PRINCIPAL);
            }
            $PRINCIPAL = str_replace("{ID_CURSO_ENCODEADO}", Encodear3($id_curso) , $PRINCIPAL);
            FinalizaObjetoFullDatos($rut_colaborador, $id_objeto, $id_empresa);
        }
        if ($id_objeto == "bci_pas_eval_m1") {
            echo "<script>location.href='?sw=contenido&i=" . Encodear3($id_objeto) . "';</script>";
        }
        else {
            echo "<script>location.href='?sw=contenido&i=" . Encodear3($id_objeto) . "&alert=2';</script>";
        }
        // print_r($_POST);
    }
    else if ($seccion == "saveBiografiaPersonal") {
        $rut_colaborador = Decodear3($_POST["ev"]);
        $rut_jefatura = Decodear3($_POST["evr"]);
        $id_objeto = Decodear3($_POST["idob"]);
        $id_curso = Decodear3($_POST["idc"]);
        $id_empresa = $_SESSION["id_empresa"];
        $pareja = utf8_decode(trim($_POST["pareja"]));
        $emfermedades_importantes = utf8_decode(trim($_POST["emfermedades_importantes"]));
        $nombre_contacto_emergencia = utf8_decode(trim($_POST["nombre_contacto_emergencia"]));
        $telefono_contacto_emergencia = utf8_decode(trim($_POST["telefono_contacto_emergencia"]));
        $estudios = utf8_decode(trim($_POST["estudios"]));
        $profesion = utf8_decode(trim($_POST["profesion"]));
        $cantidad_hijos = utf8_decode(trim($_POST["cantidad_hijos"]));
        $edad_hijos = utf8_decode(trim($_POST["edad_hijos"]));
        $sexo_hijos = utf8_decode(trim($_POST["sexo_hijos"]));
        $ultima_empresa = utf8_decode(trim($_POST["ultima_empresa"]));
        $cargo_ultima_empresa = utf8_decode(trim($_POST["cargo_ultima_empresa"]));
        $tiempo_ultima_empresa = utf8_decode(trim($_POST["tiempo_ultima_empresa"]));
        $motivacion = utf8_decode(trim($_POST["motivacion"]));
        $que_esperas_jefatura = utf8_decode(trim($_POST["que_esperas_jefatura"]));
        $que_esperas_cargo = utf8_decode(trim($_POST["que_esperas_cargo"]));
        $metas = utf8_decode(trim($_POST["metas"]));
        $capacitacion = utf8_decode(trim($_POST["capacitacion"]));
        $talla_camisa = utf8_decode(trim($_POST["talla_camisa"]));
        $talla_pantalon = utf8_decode(trim($_POST["talla_pantalon"]));
        $talla_chaqueta = utf8_decode(trim($_POST["talla_chaqueta"]));
        $talla_falda = utf8_decode(trim($_POST["talla_falda"]));
        $datos = TraeDatosBiografiaProfesional($rut, $id_objeto);
        if ($datos) {
            ActualizaBiografÃ­aProfesional($rut_colaborador, $pareja, $emfermedades_importantes, $nombre_contacto_emergencia, $telefono_contacto_emergencia, $estudios, $profesion, $cantidad_hijos, $edad_hijos, $sexo_hijos, $ultima_empresa, $cargo_ultima_empresa, $tiempo_ultima_empresa, $motivacion, $que_esperas_jefatura, $que_esperas_cargo, $metas, $capacitacion, $talla_camisa, $talla_pantalon, $talla_chaqueta, $talla_falda, $rut_jefatura, $id_objeto, $id_curso, $id_empresa);
        }
        else {
            InsertaBiografÃ­aProfesional($rut_colaborador, $pareja, $emfermedades_importantes, $nombre_contacto_emergencia, $telefono_contacto_emergencia, $estudios, $profesion, $cantidad_hijos, $edad_hijos, $sexo_hijos, $ultima_empresa, $cargo_ultima_empresa, $tiempo_ultima_empresa, $motivacion, $que_esperas_jefatura, $que_esperas_cargo, $metas, $capacitacion, $talla_camisa, $talla_pantalon, $talla_chaqueta, $talla_falda, $rut_jefatura, $id_objeto, $id_curso, $id_empresa);
        }
        echo "<script>location.href='?sw=contenido&i=" . Encodear3($id_objeto) . "';</script>";
    }
    else if ($seccion == "NextFromSL") {
        $id_objeto = $_GET["ido"];
        $id_curso = $_GET["id"];
        $rut = $_SESSION["user_"];
        $id_empresa = $_SESSION["id_empresa"];
        $datos_objeto = DatosObjeto($id_objeto);
        // echo "id objeto: $id_objeto<br /> id curso: $id_curso <br /> rut: $rut <br />id empresa:  $id_empresa;";exit;
        FinalizaObjetoFullDatos($rut, $id_objeto, $id_empresa);
        $siguiente_objeto = DatosObjetoDadoRutCursoyOrden($datos_objeto[0]->id_curso, $datos_objeto[0]->orden + 1);
        // Ingreso LOG de Tiempo
        InsertaLogNavegacion($rut, $id_objeto, $tiempo_navegado, $id_curso);
        echo "
        <script>
            parent.document.location.href = '?sw=interPant&iobjsig=" . Encodear3($siguiente_objeto[0]->id) . "&iob=" . Encodear3($id_objeto) . "';
        </script>";
        exit;
        if ($datos_objeto[0]->gamificado == 1) {
            // echo "pantalla intermedia ";
            echo "<script>parent.document.location.href='?sw=interPant&iobjsig=" . Encodear3($siguiente_objeto[0]->id) . "&iob=" . Encodear3($id_objeto) . "';
                </script>";
            exit;
        }
    }
    else if ($seccion == "checkUser") {
        $id_empresa = 59;
        session_start();
        $_SESSION["id_empresa"] = $id_empresa;
        $nombre_completo = $_GET["fullName"];
        $nombre = $_GET["GivenName"];
        $apellido = $_GET["FamilyName"];
        $imagenUrl = $_GET["imageUrl"];
        $email = $_GET["email"];
        $user_content_key = $_GET["user_content_key"];
        $arreglo_email = $arreglo_archivo = explode("@", $email);
        // print_r($arreglo_email);
        if ($arreglo_email[1] == "bci.cl" or $arreglo_email[1] == "bcinova.cl" or $arreglo_email[1] == "externos.bci.cl" or $arreglo_email[1] == "bcimiami.com" or $arreglo_email[1] == "bcisecurities.com") {
            // Aca inserta registro en la tabla de usuario
            // InsertarUsuarioNuevoCargoTblUsuario3($arreglo_email[0], $nombre, $apellido, "", $nombre_completo, "", $id_empresa, "", "", $email, $imagenUrl);
            $key = ConsultaWebServiceDatosUsuario($email, $nombre, $apellido, $imagenUrl, $id_empresa);
            // print_r($email);
            // echo "hola $email, $id_empresa key $key";exit();
            // $key=BuscaUserBci($email, $id_empresa);
            if ($key == "") {
                //    exit();
                echo "
                                <script>
                                    location.href='?sw=logbci_rev2';
                                </script>";
                exit;
            }
            // UpdateUsuarioNuevoCargoBci($key, $id_empresa,  $imagenUrl);
            // UpdateUsuarioNuevoCargoBci($arreglo_email[0], $id_empresa,  $imagenUrl);
            // inserto registro de relacion malla persona
            // InsertaRegistroMallaPersona("bcirev_m1", $arreglo_email[0], $id_empresa);
            // buscarsesionbci($email, $id_empresa)
            $_SESSION["user_"] = $key;
            $datos_empresa = DatosEmpresa($id_empresa);
            // exit();
            echo "
                                <script>
                                    location.href='?sw=" . $datos_empresa[0]->case_home . "';
                                </script>";
            exit;
        }
        else {
            echo "
                                <script>
                                    location.href='?sw=logbci_rev_logincorrecto';
                                </script>";
            exit;
        }
    }
    elseif ($seccion == "checkUserExterno") {
        session_start();
        $rut = $_POST["user"];
        $clave = $_POST["newpass"];
        $ambiente = $_POST["ambiente"];
        $im = $_POST["im"];
        $id_mp = $_POST["id_mp"];
        $amb = $_POST["amb"];
        $idcat = $_POST["idcat"];
        $idc = $_POST["idc"];
        $site = $_POST["site"];
        $linkext = $_POST["linkext"];
        $sess = $_POST["sess"];
        //            echo "hola"; sleep(5);
        $existe_base = UsuarioEnBasePersonas($rut, $rut);
        // echo "<pre>";print_r($existe_base); exit();
        if ($existe_base) {
            $rut = $existe_base[0]->rut;
            if ($existe_base[0]->vigencia == 1) {
                echo "
            <script>
            window.history.back();
            </script>";
                exit;
            }
            // Verifico que la clave de acceso ingresada sea la correcta
            $verifica_clave = VerificaClaveAcceso($rut, $clave);
            if ($verifica_clave) {
                            InsertTblAnalitica($rut, $existe_base[0]->id_empresa, "LOGIN", "LoginRutExterno");
                // echo "hola"; sleep(5);
                // print_r($verifica_clave);
                // sleep(5);
                // La clave de acceso es correcta, ahora verifico si la clave fue modificada, o es la que tiene por defecto. Si el campo cambiado estÃ¡ en 0, se le muestra formulario para cambiar la clave
                if (($verifica_clave[0]->cambiado == "0" or $verifica_clave[0]->clave == "") and $word == '') { //Muestro formulario de ingreso para cambiar la clave
                    session_start();
                    $_SESSION["user_"] = $rut;
                    $_SESSION["id_empresa"] = $existe_base[0]->id_empresa;
                    $datos_proceso_anual = ObtengoDatosProcesoAnualActivo($_SESSION["id_empresa"]);
                    // Aca obtengo el aÃ±o del proceso anual activo
                    $_SESSION["id_proceso_anual"] = $datos_proceso_anual[0]->id;
                    $_SESSION["ano_proceso_anual"] = $datos_proceso_anual[0]->ano;
                    if ($tema) {
                        $_SESSION["tema"] = $tema;
                        $datos_tema = DatosTema($tema);
                        $_SESSION["css"] = $datos_tema[0]->css;
                        $_SESSION["logo"] = $datos_tema[0]->logo;
                        $_SESSION["link_salir"] = $datos_tema[0]->link_salir;
                    }
                    echo "
            <script>
            location.href='?sw=chp';
            </script>";
                    exit;
                }
                else {
                    // echo "tema $tema";
                    session_start();
                    $_SESSION["user_"] = $rut;
                    $_SESSION["id_empresa"] = $existe_base[0]->id_empresa;
                    ValidarSesion("visitas", $_SESSION["id_empresa"]);
                    if ($site <> '') {
                        echo "
                                                            <script>
                                                                    location.href='../" . $site . "&idc_senc=" . $idc . "';
                                                            </script>";
                        exit;
                    }
                    elseif ($linkext <> '') {
                        $arrayEmail = BuscaEmail($_SESSION["user_"]);
                        $email_base64 = base64_encode($arrayEmail[0]->email);
                        $word = $arrayEmail[0]->email . $secret;
                        $secret = "0rcywyht45kuydf2svx4ctxzll1yr7gby8q0wz51";
                        $word = $arrayEmail[0]->email . $secret;
                        $token_hash = hash('sha256', $word);
                        echo "
                                                            <script>
                                                                    location.href='" . $linkext . "&email=" . $email_base64 . "&token=" . $token_hash . "';
                                                            </script>";
                        exit;
                    }
                    else {
                        echo "
                                                            <script>
                                                                    location.href='?sw=" . $ambiente . "&im=" . $im . "&id_mp=" . $id_mp . "&amb=" . $amb . "&idcat=" . $idcat . "&idc=" . $idc . "&sess=" . $sess . "';
                                                            </script>";
                        exit;
                    }
                    exit;
                }
            }
            else {
                // Veo si esta el usuario en la tabla de claves, si es que estÃ¡, significa que la clave no coincide
                // Si no estÃ¡ el rut, le muestro el formulario para que pueda crear la nueva contraseÃ±a
                // Aca el usuario debiese crear contraseÃ±a.
                // Si no hay clave, la debe crear, con estado 1.
                session_start();
                $_SESSION["user_"] = $rut;
                $estaUsuario = VeoSiEstaEnTblClave($rut);
                if ($estaUsuario) {
                    echo "
            <script>
            alert('Ups, las credenciales no son correctas');
            window.history.back();
            </script>";
                }
                else {
                    $_SESSION["id_empresa"] = $existe_base[0]->id_empresa;
                    $datos_empresa = DatosEmpresa($existe_base[0]->id_empresa);
                    echo "
            <script>
            alert('Ups, las credenciales no son correctas');
            </script>";
                    $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/creacion_clave/" . $datos_empresa[0]->template_creacion_clave));
                    print_r($PRINCIPAL);
                    exit;
                }
            }
        }
        else {
            echo "
            <script>
            alert('Ups, las credenciales no son correctas');
            location.href='?sw=login';
            </script>";
        }
    }
     else if ($seccion == "checkUserExt") {
        $id_empresa = 62;
        session_start();
        $_SESSION["id_empresa"] = $id_empresa;
        //print_r($_GET);
        $response = file_get_contents ( 'https://www.googleapis.com/oauth2/v3/tokeninfo?id_token=' . $_GET["id_token"] );
        $response = json_decode ( $response );

  // echo "<pre>";
  // print_r ( $response );
  // echo "</pre>";
  // exit();

        $nombre_completo = mysql_real_escape_string($response->name);
        $nombre = mysql_real_escape_string($response->given_name);
        $apellido = mysql_real_escape_string($response->family_name);
        $imagenUrl = mysql_real_escape_string($response->picture);
        $email = mysql_real_escape_string($response->email);
        $user_content_key = mysql_real_escape_string($response->user_content_key);
        $ambiente = $_GET["ambiente"];
        $im = $_GET["im"];
        $id_mp = $_GET["id_mp"];
        $amb = $_GET["amb"];
        $idcat = $_GET["idcat"];
        $idc = $_GET["idc"];
        $site = $_GET["site"];
        $linkext = $_GET["linkext"];
        $sess = $_GET["sess"];
        $user_content_key = $_GET["user_content_key"];
        $arreglo_email = $arreglo_archivo = explode("@", $email);
        // echo "$nombre_completo $email<br />$imagenUrl $ambiente $im $email";
        if ($arreglo_email[1] == "bci.cl" or $arreglo_email[1] == "gop.cl" or $arreglo_email[1] == "bcinova.cl" or $arreglo_email[1] == "externos.bci.cl" or $arreglo_email[1] == "bcimiami.com") {
            ActualizaFotoBciUser($email, $id_empresa, $imagenUrl);
            $key = LMS_ConsultaRutSegunEmail($email, $id_empresa);


            // echo $key; exit();
            /*if($key==""){
            echo "
            <script>
            location.href='?sw=logbci_capacitacion_id';
            </script>";
            exit;
            }
            $_SESSION["user_"]=$key;
            * */
            // $_SESSION["user_"]="16939096";
            // echo "$nombre_completo $email<br />$imagenUrl $ambiente $im $email";
            //    echo "hola"; sleep(3);
            if ($key == "") {
                echo "
                                <script>
                                    location.href='?sw=logbci_capacitacion_id';
                                </script>";
                exit;
            }
            $_SESSION["user_"] = $key;
            InsertTblAnalitica($key, $id_empresa, "LOGIN", "LoginGoogleExterno");

            if ($site <> '') {
                echo "
                                <script>
                                    location.href='../" . $site . "&idc_senc=" . $idc . "';
                                </script>";
                exit;
            }
            elseif ($linkext <> '') {
                $arrayEmail = BuscaEmail($_SESSION["user_"]);
                $email_base64 = base64_encode($arrayEmail[0]->email);
                $word = $arrayEmail[0]->email . $secret;
                $secret = "0rcywyht45kuydf2svx4ctxzll1yr7gby8q0wz51";
                $word = $arrayEmail[0]->email . $secret;
                $token_hash = hash('sha256', $word);
                echo "
                                <script>
                                    location.href='" . $linkext . "&email=" . $email_base64 . "&token=" . $token_hash . "';
                                </script>";
                exit;
            }
            else {
                echo "
                                <script>
                                    location.href='?sw=" . $ambiente . "&im=" . $im . "&id_mp=" . $id_mp . "&amb=" . $amb . "&idcat=" . $idcat . "&idc=" . $idc . "&sess=" . $sess . "';
                                </script>";
                exit;
            }
        }
        else {
            echo "
                                <script>
                                    location.href='?sw=logbci_capacitacion_id';
                                </script>";
            exit;
        }
    }


else if ($seccion == "checkUserBci") {
    session_start();

    //$nombre_completo = $_GET["fullName"];
    //$nombre = $_GET["GivenName"];
    //$//apellido = $_GET["FamilyName"];
    //$imagenUrl = $_GET["imageUrl"];
    $email = $_GET["email"];
    //sso google
    $user_content_key = $_GET["user_content_key"];
		//captcha v3
		$rgv3=$_GET["rgv3"] ;
		if($rgv3==""){ exit();}
		if($user_content_key==""){ exit();}
		//echo "<br>user_content_key $user_content_key<br> rgv3 $rgv3";



		//CHECK CAPTCHA		
		if($rgv3<>""){
						//echo "<br> estoy dentro de rgv3"			;
									$url = "https://www.google.com/recaptcha/api/siteverify";
									$data = [
										'secret' => "6LequgweAAAAACTt8tG9GgHw3kaKY1vSJg5NtTGo",
										'response' => $rgv3,
										// 'remoteip' => $_SERVER['REMOTE_ADDR']
									];
									$options = array(
									    'http' => array(
									      'header'  => "Content-type: application/x-www-form-urlencoded\r\n",
									      'method'  => 'POST',
									      'content' => http_build_query($data)
									    )
									  );
									$context  = stream_context_create($options);
							  	$response = file_get_contents($url, false, $context);
									$res = json_decode($response, true);
									if($res['success'] == true) {
					
									} else {
				            echo "<script>location.href='?sw=logout';</script>";
				            exit;
									}			

		}


  	$response = file_get_contents ( 'https://www.googleapis.com/oauth2/v3/tokeninfo?id_token=' . $user_content_key);
    $response = json_decode ( $response );
    $email = ($response->email);

		
    $arreglo_email = $arreglo_archivo = explode("@", $email);
		$cuenta=count($arreglo_email);
		//echo "<br>cuenta $cuenta";
		//echo "email $email";exit();
		if($cuenta<>2){
			echo "<script>location.href='?sw=logout';</script>";exit;
		}

    if ($arreglo_email[1] == "bci.cl" or $arreglo_email[1] == "gop.cl" or $arreglo_email[1] == "externos.bci.cl") {
        
         $_SESSION["id_empresa"] = "62";
         $id_empresa="62";
        $key = LMS_ConsultaRutSegunEmail($email, $id_empresa);
        
			//echo "key $key";exit();
        if ($key<>"") {
        		$_SESSION["user_"] = $key;
            $_SESSION["id_empresa"] = "62";
        } else {
             echo "<script>location.href='?sw=logout';</script>";exit;       	
        }
        if (count($key) == 0) {
            echo "<script>location.href='?sw=logout';</script>";exit;
        }
        if ($key == "") {
            echo "<script>location.href='?sw=logout';</script>";exit;
        }
        echo "<script>location.href='?sw=home_bci_new';</script>";exit;
    } else {
        echo "<script>location.href='?sw=logout';</script>";exit;
    }
}
    
    elseif ($seccion == "logext") {
	exit();
    $_SESSION["id_empresa"] 	= "62";
    $token									 	= Decodear3($_REQUEST["rut_enc"]);
    
    
    
    //echo "<h2>logext token ".$token."</h2>";
		
	
				//session_start();
				$_SESSION["user_"] = $token;
				$_SESSION["id_empresa"] = "62";

				//
				echo "    <script>    location.href='?sw=potencial_landing';    </script>";
				exit;
	
		exit;
}  
    
    
    
    
    
    
    
    
    
    
    
    
    
    // Taylor
    else if ($seccion == "checkUserTaylor") {
        $id_empresa = 22;
        session_start();
        $_SESSION["id_empresa"] = $id_empresa;
        $nombre_completo = $_GET["fullName"];
        $nombre = $_GET["GivenName"];
        $apellido = $_GET["FamilyName"];
        $imagenUrl = $_GET["imageUrl"];
        $email = $_GET["email"];
        $user_content_key = $_GET["user_content_key"];
        $arreglo_email = $arreglo_archivo = explode("@", $email);
        if ($arreglo_email[1] == "gop.cl" or $arreglo_email[1] == "empresastaylor.com" or $arreglo_email[1] == "iantaylor.com" or $arreglo_email[1] == "taylor-logistics.com" or $arreglo_email[1] == "empresastaylor.cl" or $arreglo_email[1] == "iantaylor.pe" or $arreglo_email[1] == "empresastaylor.pe" or $arreglo_email[1] == "scrossgroup.com" or $arreglo_email[1] == "iantayloryciasa.cl") {
            $key = ConsultaWebServiceDatosUsuarioSoloEmailGoogle($email, $nombre, $apellido, $imagenUrl, $id_empresa);
            if ($key == "") {
                echo "
                                <script>
                                    location.href='?sw=log_los_andes_google_G';
                                </script>";
                exit;
            }
            $_SESSION["user_"] = $key;
            $datos_empresa = DatosEmpresa($id_empresa);
            echo "
                                <script>
                                    location.href='?sw=" . $datos_empresa[0]->case_home . "';
                                </script>";
            exit;
        }
        else {
            echo "
                                <script>
                                    location.href='?sw=log_los_andes_google_G';
                                </script>";
            exit;
        }
    }
    // Los Andes
    else if ($seccion == "checkUserLosAndes") {
         $id_empresa = 75;
        session_start();
        $_SESSION["id_empresa"] = $id_empresa;
        // exit();
        // echo "hola checkUserBci";
        $nombre_completo = mysql_real_escape_string($_GET["fullName"]);
        $nombre = mysql_real_escape_string($_GET["GivenName"]);
        $apellido = mysql_real_escape_string($_GET["FamilyName"]);
        $imagenUrl = mysql_real_escape_string($_GET["imageUrl"]);
        $email = mysql_real_escape_string($_GET["email"]);
        $user_content_key = mysql_real_escape_string($_GET["user_content_key"]);
        $arreglo_email = $arreglo_archivo = explode("@", $email);
        // echo "$nombre_completo $email<br />$imagenUrl";
        $var_desde_login = Decodear3(mysql_real_escape_string($_GET["var"]));
        $var_en_sesion = Decodear3($_SESSION["token"]);
        // $var=Decodear3($_GET["var"]);
        $ambiente = mysql_real_escape_string($_GET["ambiente"]);
        $id_mp = mysql_real_escape_string($_GET["id_mp"]);
        $im = mysql_real_escape_string($_GET["im"]);
        if ($ambiente == "") {
            $redireccion = "" . $url_front . "/front/?sw=" . $datos_empresa[0]->case_home . "";
        }
        else {
            $redireccion = "" . $url_front . "/front/?sw=" . $datos_empresa[0]->case_home . "&im=" . $im . "&id_mp=" . $id_mp;
        }
        // echo "desde Login ".$var." guardada en sesion ".$_SESSION["token"];
        // exit;
        // if($var<>"loginBCI"){
        /* if($var_desde_login<>$var_en_sesion){
        echo "
        <script>
        location.href='?sw=logbci_capacitacion_id';
        </script>";
        exit;
        }else if(!$var_en_sesion){
        echo "
        <script>
        location.href='?sw=logbci_capacitacion_id';
        </script>";
        exit;
        }
        */
        if ($arreglo_email[1] == "losandes.cl" or $arreglo_email[1] == "gop.cl" or $arreglo_email[1] == "cajalosandes.cl" or $arreglo_email[1] == "losandes.cl" or $arreglo_email[1] == "losandes.com") {
            // actualiza avatar
            ActualizaFotoBciUser($email, $id_empresa, $imagenUrl);
            $key = LMS_ConsultaRutSegunEmail($email, $id_empresa);
            // echo "key $key"; sleep(3);
            if ($key == "") {
                echo "
                                <script>
                                    location.href='?sw=log_los_andes_google_G';
                                </script>";
                exit;
            }
            $_SESSION["user_"] = $key;
            $datos_empresa = DatosEmpresa($id_empresa);
            InsertTblAnalitica($key, $id_empresa, "LOGIN", "LoginGoogleExterno");

            //  echo "hola 1795";
            // echo "".$url_front."/front/?sw=".$datos_empresa[0]->case_home."";
            // sleep(5);
            echo "
                                <script>
                                    location.href='" . $url_front . "/front/?sw=" . $datos_empresa[0]->case_home . "';
                                </script>";
            exit;
        }
        else {
            echo "
                                <script>
                                    location.href='" . $url_front . "/front/?sw=log_los_andes_google_G';
                                </script>";
            exit;
        }
    }
    else if ($seccion == "home") {
        // Funcion para saber cuales pueden ser los criterios de la malla
        $PRINCIPAL = ColocarSlider(ListadoNoticias(FuncionesTransversales(file_get_contents("views/home/index.html"))));
        $PRINCIPAL = BarraNavegacion($PRINCIPAL, $seccion);
        echo $PRINCIPAL;
    }
    else if ($seccion == "generaReporteFotos") {
        VerificaFotoPersonalParaReporte($id_empresa);
    }
    else if ($seccion == "clasicos") {
        $id_empresa = $_SESSION["id_empresa"];
        $PRINCIPAL = Noticias(FuncionesTransversales(file_get_contents("views/clasicos/index.html")) , 1, 3, "");
        $PRINCIPAL = BloqueListadoClasicos($PRINCIPAL, $id_empresa);
        $PRINCIPAL = BloqueDocumentos($PRINCIPAL);
        $PRINCIPAL = BloqueFotos($PRINCIPAL);
        $PRINCIPAL = BloqueMiniSalonFama($PRINCIPAL, $id_empresa);
        $PRINCIPAL = BloqueClasicos($PRINCIPAL, $id_empresa, 1);
        $PRINCIPAL = BloqueMiniBuenasPracticas($PRINCIPAL);
        $PRINCIPAL = BloqueBanners($PRINCIPAL, $id_empresa);
        $PRINCIPAL = BloqueCumpleanos($PRINCIPAL, $id_empresa);
        $PRINCIPAL = BloqueNuevosIngresos($PRINCIPAL, "", $id_empresa);
        $PRINCIPAL = BloqueMovimientosInternos($PRINCIPAL, "", $id_empresa);
        $PRINCIPAL = BloqueFooterContenido($PRINCIPAL);
        $PRINCIPAL = ColocarSlider($PRINCIPAL);
        $PRINCIPAL = BarraNavegacion($PRINCIPAL, $seccion);
        $PRINCIPAL = ColocaMenuSecundario($PRINCIPAL, $_SESSION["id_empresa"]);
        echo $PRINCIPAL;
    }
    
    else if ($seccion == "logout") {
        unset($_COOKIE["user_"]);
        unset($_COOKIE["id_empresa"]);
        unset($_SESSION);
        session_start();
        $_SESSION = array();
        if (isset($_COOKIE[session_name() ])) {
            setcookie(session_name() , '', time() - 42000, '/');
        }
        session_destroy();
        $PRINCIPAL = FuncionesTransversales(file_get_contents("htpps://www.google.cl"));
        echo $PRINCIPAL;
    }    
    else if ($seccion == "logoutCookie") {
        unset($_COOKIE["user_"]);
        unset($_COOKIE["id_empresa"]);
        unset($_SESSION);
        session_start();
        $_SESSION = array();
        if (isset($_COOKIE[session_name() ])) {
            setcookie(session_name() , '', time() - 42000, '/');
        }
        session_destroy();
        $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/login_minvest_ldap.html"));
        echo $PRINCIPAL;
    }
    else if ($seccion == "EnvObjPorEv") {
        $rut_evaluado = Decodear3($_GET["ie"]);
        $rut_evaluador = Decodear3($_GET["revr"]);
        $id_proceso = Decodear3($_GET["ip"]);
        InsertaRegistroFinalizadoRevisionJefeObjf($rut_evaluado, $rut_evaluador);
        // Envio correo a Evaluado
        InsertaValidacionJefeDelJefe($rut_evaluado, $rut_evaluador, $rut_evaluador);
        EnviarCorreosCIAL($rut_evaluador, 51, $rut_evaluado);
        echo "
                        <script>
                            location.href='?sw=listobj&ip=" . Encodear3($id_proceso) . "';
                        </script>";
    }
    else if ($seccion == "SaveFormMen") {
        $id_empresa = $_SESSION["id_empresa"];
        $rut = Decodear3($_POST["rut"]);
        $mensaje = ($_POST["mensaje"]);
        $asunto = ($_POST["asunto"]);
        $tipo_pregunta = ($_POST["tipo_pregunta"]);
        InsertarMensaje($rut, $asunto, $mensaje, $tipo_pregunta, $id_empresa, "", "", "");
        $template = BloqueUltimaPReguntaForm($rut, $id_empresa);
        echo $template;
    }
    else if ($seccion == "pagina_videobci") {
        $rut = $_SESSION["user_"];
        $id_empresa = $_SESSION["id_empresa"];
        $PRINCIPAL = Noticias(FuncionesTransversales(file_get_contents("views/pagina/bci_cappresenta1.html")) , 7, 2, "");
        $datos_malla = CAPACITACION_malla_porUsuario($rut);
        // $PRINCIPAL=ColocaDatosMallaCapacitacion(FuncionesTransversales($PRINCIPAL), $rut, $id_empresa);
        $PRINCIPAL = str_replace("{BLOQUE_DATOS_PERSONALES}", file_get_contents("views/cursos/capacitacion/" . $id_empresa . "_mi_perfil_bloque_datos_home.html") , $PRINCIPAL);
        $PRINCIPAL = ColocaDatosMallaCapacitacion(FuncionesTransversales($PRINCIPAL) , $rut, $id_empresa);
        $PRINCIPAL = str_replace("{LISTADO_DETALLE_TIPS}", Tipsganados($rut, $id_empresa) , $PRINCIPAL);
        $PRINCIPAL = str_replace("{CHIPS}", CuentaObtenerTipsGanados($rut, $id_empresa) , $PRINCIPAL);
        $PRINCIPAL = str_replace("{CHIPS}", CuentaObtenerTipsGanados($rut, $id_empresa) , $PRINCIPAL);
        $PRINCIPAL = str_replace("{REV_MUESTRA_PUNTOS_TOTALES}", PuntosPersonalesHomeBciRev($rut, $id_empresa, $datos_malla[0]->id_malla) , $PRINCIPAL);
        $PRINCIPAL = ColocaIndicadoresVarios($PRINCIPAL);
        $PRINCIPAL = ColocaRankingTopHomeInicial($PRINCIPAL, $id_empresa, $datos_malla[0]->id_malla);
        $PRINCIPAL = ColocaBloqueComparte($PRINCIPAL, $id_empresa, $datos_malla[0]->id_malla, $rut, "home");
        $PRINCIPAL = ColocaFormularioContactate($PRINCIPAL, $id_empresa, $rut);
        $PRINCIPAL = Noticias($PRINCIPAL, 8, "limit 3", "");
        $PRINCIPAL = Noticias($PRINCIPAL, 9, "limit 3,3", "");
        $PRINCIPAL = BloqueLinks($PRINCIPAL, $id_empresa);
        $PRINCIPAL = BloqueDocumentos($PRINCIPAL);
        $PRINCIPAL = BloqueFotos($PRINCIPAL, $id_empresa);
        $PRINCIPAL = BarraNavegacion($PRINCIPAL, $seccion);
        $PRINCIPAL = ColocarSliderPorNoticia($PRINCIPAL, $id_empresa);
        $PRINCIPAL = ColocaMenuSecundario($PRINCIPAL, $_SESSION["id_empresa"]);
        //        $PRINCIPAL=Noticias($PRINCIPAL, 2, "limit 3", "");
        //        $PRINCIPAL=Noticias($PRINCIPAL, 3, "limit 3, 3", "");
        $PRINCIPAL = ColocaIndicadoresVarios($PRINCIPAL);
        //        $PRINCIPAL=Noticias($PRINCIPAL, "principal_DOScolumnas", "limit 3", "");
        $PRINCIPAL = Noticias($PRINCIPAL, "enFilaV2", "limit 3", "");
        $PRINCIPAL = NoticiasMiniSlider($PRINCIPAL, "Topleft", "limit 3", "");
        // $PRINCIPAL=BloqueBloqueBannerDinamico($PRINCIPAL, $id_empresa, $rut);
        $PRINCIPAL = str_replace("{SECCION_PREGUNTA}", ColocaBloquePreguntaPorObjeto($datos_objeto[0]->id, $rut, 4) , $PRINCIPAL);
        echo $PRINCIPAL;
    }
    else if ($seccion == "home_bci_stock") {
        $rut = $_SESSION["user_"];
        $id_empresa = $_SESSION["id_empresa"];
        $PRINCIPAL = Noticias(FuncionesTransversales(file_get_contents("views/home/index_bci_stock.html")) , 7, 2, "");
        $datos_malla = CAPACITACION_malla_porUsuario($rut);
        // $PRINCIPAL=ColocaDatosMallaCapacitacion(FuncionesTransversales($PRINCIPAL), $rut, $id_empresa);
        $PRINCIPAL = str_replace("{BLOQUE_DATOS_PERSONALES}", file_get_contents("views/cursos/capacitacion/" . $id_empresa . "_mi_perfil_bloque_datos_home.html") , $PRINCIPAL);
        $PRINCIPAL = ColocaDatosMallaCapacitacion(FuncionesTransversales($PRINCIPAL) , $rut, $id_empresa);
        $PRINCIPAL = str_replace("{LISTADO_DETALLE_TIPS}", Tipsganados($rut, $id_empresa) , $PRINCIPAL);
        $PRINCIPAL = str_replace("{CHIPS}", CuentaObtenerTipsGanados($rut, $id_empresa) , $PRINCIPAL);
        $PRINCIPAL = str_replace("{CHIPS}", CuentaObtenerTipsGanados($rut, $id_empresa) , $PRINCIPAL);
        $PRINCIPAL = str_replace("{REV_MUESTRA_PUNTOS_TOTALES}", PuntosPersonalesHomeBciRev($rut, $id_empresa, $datos_malla[0]->id_malla) , $PRINCIPAL);
        $PRINCIPAL = ColocaIndicadoresVarios($PRINCIPAL);
        $PRINCIPAL = ColocaRankingTopHomeInicial($PRINCIPAL, $id_empresa, $datos_malla[0]->id_malla);
        $PRINCIPAL = ColocaBloqueComparte($PRINCIPAL, $id_empresa, $datos_malla[0]->id_malla, $rut, "home");
        $PRINCIPAL = ColocaFormularioContactate($PRINCIPAL, $id_empresa, $rut);
        $PRINCIPAL = Noticias($PRINCIPAL, 8, "limit 3", "");
        $PRINCIPAL = Noticias($PRINCIPAL, 9, "limit 3,3", "");
        $PRINCIPAL = BloqueLinks($PRINCIPAL, $id_empresa);
        $PRINCIPAL = BloqueDocumentos($PRINCIPAL);
        $PRINCIPAL = BloqueFotos($PRINCIPAL, $id_empresa);
        $PRINCIPAL = BarraNavegacion($PRINCIPAL, $seccion);
        $PRINCIPAL = ColocarSliderPorNoticia($PRINCIPAL, $id_empresa);
        $PRINCIPAL = ColocaMenuSecundario($PRINCIPAL, $_SESSION["id_empresa"]);
        //        $PRINCIPAL=Noticias($PRINCIPAL, 2, "limit 3", "");
        //        $PRINCIPAL=Noticias($PRINCIPAL, 3, "limit 3, 3", "");
        $PRINCIPAL = ColocaIndicadoresVarios($PRINCIPAL);
        //        $PRINCIPAL=Noticias($PRINCIPAL, "principal_DOScolumnas", "limit 3", "");
        $PRINCIPAL = Noticias($PRINCIPAL, "enFilaV2", "limit 3", "");
        $PRINCIPAL = NoticiasMiniSlider($PRINCIPAL, "Topleft", "limit 3", "");
        // $PRINCIPAL=BloqueBloqueBannerDinamico($PRINCIPAL, $id_empresa, $rut);
        $PRINCIPAL = str_replace("{SECCION_PREGUNTA}", ColocaBloquePreguntaPorObjeto($datos_objeto[0]->id, $rut, 4) , $PRINCIPAL);
        echo $PRINCIPAL;
    }
    else if ($seccion == "home_bci_capacitacionbci20") {
        // $texto="62";
        $rut = $_SESSION["user_"];
        $id_empresa = $_SESSION["id_empresa"];
        $PRINCIPAL = Noticias(FuncionesTransversales(file_get_contents("views/home/index_bci_capacitacionbci20.html")) , 7, 2, "");
        $datos_malla = CAPACITACION_malla_porUsuario($rut);
        // $PRINCIPAL=ColocaDatosMallaCapacitacion(FuncionesTransversales($PRINCIPAL), $rut, $id_empresa);
        $PRINCIPAL = str_replace("{BLOQUE_DATOS_PERSONALES}", file_get_contents("views/cursos/capacitacion/" . $id_empresa . "_mi_perfil_bloque_datos_home.html") , $PRINCIPAL);
        $PRINCIPAL = ColocaDatosMallaCapacitacion(FuncionesTransversales($PRINCIPAL) , $rut, $id_empresa);
        $PRINCIPAL = str_replace("{LISTADO_DETALLE_TIPS}", Tipsganados($rut, $id_empresa) , $PRINCIPAL);
        $PRINCIPAL = str_replace("{CHIPS}", CuentaObtenerTipsGanados($rut, $id_empresa) , $PRINCIPAL);
        $PRINCIPAL = str_replace("{CHIPS}", CuentaObtenerTipsGanados($rut, $id_empresa) , $PRINCIPAL);
        $PRINCIPAL = str_replace("{REV_MUESTRA_PUNTOS_TOTALES}", PuntosPersonalesHomeBciRev($rut, $id_empresa, $datos_malla[0]->id_malla) , $PRINCIPAL);
        $PRINCIPAL = ColocaIndicadoresVarios($PRINCIPAL);
        $PRINCIPAL = ColocaRankingTopHomeInicial($PRINCIPAL, $id_empresa, $datos_malla[0]->id_malla);
        $PRINCIPAL = ColocaBloqueComparte($PRINCIPAL, $id_empresa, $datos_malla[0]->id_malla, $rut, "home");
        $PRINCIPAL = ColocaFormularioContactate($PRINCIPAL, $id_empresa, $rut);
        $PRINCIPAL = Noticias($PRINCIPAL, 8, "limit 3", "");
        $PRINCIPAL = Noticias($PRINCIPAL, 9, "limit 3,3", "");
        $PRINCIPAL = BloqueLinks($PRINCIPAL, $id_empresa);
        $PRINCIPAL = BloqueDocumentos($PRINCIPAL);
        $PRINCIPAL = BloqueFotos($PRINCIPAL, $id_empresa);
        $PRINCIPAL = BarraNavegacion($PRINCIPAL, $seccion);
        $PRINCIPAL = ColocarSliderPorNoticia($PRINCIPAL, $id_empresa);
        $PRINCIPAL = ColocaMenuSecundario($PRINCIPAL, $_SESSION["id_empresa"]);
        //        $PRINCIPAL=Noticias($PRINCIPAL, 2, "limit 3", "");
        //        $PRINCIPAL=Noticias($PRINCIPAL, 3, "limit 3, 3", "");
        $PRINCIPAL = ColocaIndicadoresVarios($PRINCIPAL);
        //        $PRINCIPAL=Noticias($PRINCIPAL, "principal_DOScolumnas", "limit 3", "");
        $PRINCIPAL = Noticias($PRINCIPAL, "enFilaV2", "limit 3", "");
        $PRINCIPAL = NoticiasMiniSlider($PRINCIPAL, "Topleft", "limit 3", "");
        // $PRINCIPAL=BloqueBloqueBannerDinamico($PRINCIPAL, $id_empresa, $rut);
        $PRINCIPAL = str_replace("{SECCION_PREGUNTA}", ColocaBloquePreguntaPorObjeto($datos_objeto[0]->id, $rut, 4) , $PRINCIPAL);
        echo $PRINCIPAL;
    }
    else if ($seccion == "listadoSalon") {
        $id_empresa = $_SESSION["id_empresa"];
        $id_categoria = Decodear3($_GET["itip"]);
        $ano = $_GET["an"];
        $PRINCIPAL = FuncionesTransversales(file_get_contents("views/salondelafama/index_generico.html"));
        $PRINCIPAL = BloqueListadoSalonFama($PRINCIPAL, $id_empresa, $id_categoria, $ano);
        $PRINCIPAL = BloqueDocumentos($PRINCIPAL);
        $PRINCIPAL = BloqueFotos($PRINCIPAL);
        $PRINCIPAL = BloqueMiniSalonFama($PRINCIPAL, $id_empresa);
        $PRINCIPAL = BloqueClasicos($PRINCIPAL, $id_empresa, 1);
        $PRINCIPAL = BloqueMiniBuenasPracticas($PRINCIPAL);
        $PRINCIPAL = BloqueBanners($PRINCIPAL, $id_empresa);
        $PRINCIPAL = BloqueCumpleanos($PRINCIPAL, $id_empresa);
        $PRINCIPAL = BloqueNuevosIngresos($PRINCIPAL, "", $id_empresa);
        $PRINCIPAL = BloqueMovimientosInternos($PRINCIPAL, "", $id_empresa);
        $PRINCIPAL = BloqueFooterContenido($PRINCIPAL);
        $PRINCIPAL = ColocarSlider($PRINCIPAL);
        $PRINCIPAL = BarraNavegacion($PRINCIPAL, $seccion);
        $PRINCIPAL = ColocaMenuSecundario($PRINCIPAL, $_SESSION["id_empresa"]);
        echo $PRINCIPAL;
    }
    else if ($seccion == "muestra_consucta_valor") {
        $id_categoria_valor = $_POST["elegido"];
        // TRaigo las conductas valores dada la categoria
        $conductas = ConductasDadoCategoria($id_categoria_valor, $id_empresa);
        foreach($conductas as $unico) {
            echo "<option value='" . $unico->id . "'>" . utf8_encode($unico->nombre) . "</option>";
        }
    }
    else if ($seccion == "savConBuen") {
        $id_tipo_reconocimiento = Decodear3($_POST["dtip"]);
        $rut = $_POST["buscarRut_form"];
        $categoria_valor = $_POST["categoria_valor"];
        $conducta_valor = $_POST["conducta_valor"];
        $situacion = utf8_decode($_POST["situacion"]);
        $accion = utf8_decode($_POST["accion"]);
        $impacto = utf8_decode($_POST["impacto"]);
        Insertatbl_salonfama_publicados($id_tipo_reconocimiento, $rut, $id_empresa, $categoria_valor, $conducta_valor, $situacion, $accion, $impacto);
        echo "<script>location.href='?sw=reconoc&itip=" . Encodear3($id_tipo_reconocimiento) . "';</script>";
    }
    else if ($seccion == "form") {
        $id_categoria = Decodear3($_GET["tip"]);
        $rut = $_SESSION["user_"];
        $PRINCIPAL = FuncionesTransversales(MuestraFormulario($id_categoria, $id_empresa, $rut));
        $PRINCIPAL = BloqueLinks($PRINCIPAL);
        $PRINCIPAL = BloqueDocumentos($PRINCIPAL);
        $PRINCIPAL = BloqueFotos($PRINCIPAL);
        $PRINCIPAL = BloqueMiniSalonFama($PRINCIPAL, $id_empresa);
        $PRINCIPAL = BloqueClasicos($PRINCIPAL, $id_empresa, 1);
        $PRINCIPAL = BloqueMiniBuenasPracticas($PRINCIPAL, $id_empresa);
        $PRINCIPAL = BloqueBuscadorPersonasDirectorio($PRINCIPAL, $id_empresa);
        $PRINCIPAL = BloqueBanners($PRINCIPAL, $id_empresa);
        $PRINCIPAL = BloqueCumpleanos($PRINCIPAL, $id_empresa);
        $PRINCIPAL = BloqueNuevosIngresos($PRINCIPAL, "", $id_empresa);
        $PRINCIPAL = BloqueMovimientosInternos($PRINCIPAL, "", $id_empresa);
        $PRINCIPAL = BloqueFooterContenido($PRINCIPAL);
        $PRINCIPAL = ColocarSlider($PRINCIPAL);
        $PRINCIPAL = BarraNavegacion($PRINCIPAL, $seccion);
        $PRINCIPAL = ColocaMenuSecundario($PRINCIPAL, $_SESSION["id_empresa"]);
        echo $PRINCIPAL;
    }
    else if ($seccion == "savePregConc") {
        $rut = Decodear3($_POST["r"]);
        $respuesta = utf8_decode($_POST["respuesta_pregunta"]);
        $id_pregunta = Decodear3($_POST["ip"]);
        InsertaRespuestaPreguntaConcurso($rut, $respuesta, $id_pregunta);
        echo "<script>
            alert('Gracias por participar!!!!!!');
            location.href='?sw=home_tnt';
            </script>";
    }
    else if ($seccion == "MPSaveComent") {
        $id_mp = Decodear3($_POST["id_mp"]);
        $comentario = utf8_decode($_POST["comentario_t"]);
        $rut_creador = $_SESSION["user_"];
        MPInsertaComentario($id_mp, $rut_creador, $id_empresa, "COMENTARIO", $comentario);
        echo "<script>
            location.href='?sw=VistaMejPrac&id_mp=$id_mp#BloqueFormularioComen';
            </script>";
    }
    else if ($seccion == "reconoc") {
        $id_empresa = $_SESSION["id_empresa"];
        $id_categoria = Decodear3($_GET["itip"]);
        $rut = $_SESSION["user_"];
        $PRINCIPAL = FuncionesTransversales(file_get_contents("views/reconocimiento/index.html"));
        // $PRINCIPAL=BloqueListadoClasicos($PRINCIPAL, $id_empresa);
        $PRINCIPAL = BloqueListadoConectate($PRINCIPAL, $id_empresa, $id_categoria);
        $PRINCIPAL = BloqueBuscadorPersonasDirectorio($PRINCIPAL, $id_empresa);
        $PRINCIPAL = BloqueDocumentos($PRINCIPAL);
        $PRINCIPAL = BloqueFotos($PRINCIPAL);
        $PRINCIPAL = BloqueMiniSalonFama($PRINCIPAL, $id_empresa);
        $PRINCIPAL = BloqueClasicos($PRINCIPAL, $id_empresa, 1);
        $PRINCIPAL = BloqueMiniBuenasPracticas($PRINCIPAL);
        $PRINCIPAL = BloqueBanners($PRINCIPAL, $id_empresa);
        $PRINCIPAL = BloqueCumpleanos($PRINCIPAL, $id_empresa);
        $PRINCIPAL = BloqueNuevosIngresos($PRINCIPAL, "", $id_empresa);
        $PRINCIPAL = BloqueMovimientosInternos($PRINCIPAL, "", $id_empresa);
        $PRINCIPAL = BloqueFooterContenido($PRINCIPAL);
        $PRINCIPAL = ColocarSlider($PRINCIPAL);
        $PRINCIPAL = BarraNavegacion($PRINCIPAL, $seccion);
        $PRINCIPAL = ColocaMenuSecundario($PRINCIPAL, $_SESSION["id_empresa"]);
        echo $PRINCIPAL;
    }
    else if ($seccion == "home_ultramar") {
        // Funcion para saber cuales pueden ser los criterios de la malla
        $PRINCIPAL = ColocarSlider(ListadoNoticias(FuncionesTransversales(file_get_contents("views/home/index_ultramar.html"))));
        $PRINCIPAL = BarraNavegacion($PRINCIPAL, $seccion);
        echo $PRINCIPAL;
    }
    else if ($seccion == "linksEx") {
        $id_link = Decodear3($_GET["idl"]);
        ActualizarVisitasLinks($id_link);
        $datos_link = DatosLinks($id_link);
        echo "<script>location.href='" . $datos_link[0]->link . "';</script>";
    }
    else if ($seccion == "home_tnt") {
        $rut = $_SESSION["user_"];
        $id_empresa = $_SESSION["id_empresa"];
        // echo "$rut $id_empresa";
        // Funcion para saber cuales pueden ser los criterios de la malla
        // $PRINCIPAL=NoticiasPrincipales(FuncionesTransversales(file_get_contents("views/home/index_tnt.html")));
        // $PRINCIPAL=NoticiasSecundarias($PRINCIPAL);
        // $PRINCIPAL=NoticiasTerciarias($PRINCIPAL);
        // $PRINCIPAL=Noticias(FuncionesTransversales(file_get_contents("views/home/index_tnt.html")), 1, 3, "");
        $PRINCIPAL = Noticias(FuncionesTransversales(file_get_contents("views/home/index_tnt.html")) , 1, 3, "");
        //        $PRINCIPAL=Noticias($PRINCIPAL, 2, "limit 3", "");
        //        $PRINCIPAL=Noticias($PRINCIPAL, 3, "limit 3, 3", "");
        $PRINCIPAL = Noticias($PRINCIPAL, 4, "limit 3", "");
        $PRINCIPAL = Noticias($PRINCIPAL, 5, "limit 3,3", "");
        // $PRINCIPAL=BloqueLinks($PRINCIPAL);
        $PRINCIPAL = BloqueLinks($PRINCIPAL, $id_empresa);
        $PRINCIPAL = BloqueDocumentos($PRINCIPAL);
        $PRINCIPAL = BloqueFotos($PRINCIPAL, $id_empresa);
        $PRINCIPAL = BloqueMiniSalonFama($PRINCIPAL, $id_empresa);
        // $PRINCIPAL=BloqueClasicos($PRINCIPAL, $id_empresa, 1);
        $PRINCIPAL = BloqueMiniBuenasPracticas($PRINCIPAL, $id_empresa);
        $PRINCIPAL = BloqueBuscadorPersonasDirectorio($PRINCIPAL, $id_empresa);
        // $PRINCIPAL=BloqueBloqueBannerDinamico($PRINCIPAL, $id_empresa, $rut);
        $PRINCIPAL = BloqueBanners($PRINCIPAL, $id_empresa);
        $PRINCIPAL = BloqueCumpleanos($PRINCIPAL, $id_empresa);
        $PRINCIPAL = BloqueNuevosIngresos($PRINCIPAL, "", $id_empresa);
        $PRINCIPAL = BloqueMovimientosInternos($PRINCIPAL, "", $id_empresa, 2);
        $PRINCIPAL = BloqueFooterContenido($PRINCIPAL);
        // $PRINCIPAL=ColocarSlider($PRINCIPAL);
        $PRINCIPAL = ColocarSliderPorNoticia($PRINCIPAL, $id_empresa);
        $PRINCIPAL = BarraNavegacion($PRINCIPAL, $seccion);
        // Bloque para Pregunta
        $PRINCIPAL = str_replace("{SECCION_PREGUNTA}", ColocaBloquePreguntaPorObjeto($datos_objeto[0]->id, $rut, "") , $PRINCIPAL);
        $PRINCIPAL = ColocaMenuSecundario($PRINCIPAL, $_SESSION["id_empresa"]);
        echo $PRINCIPAL;
    }
    else if ($seccion == "home_esc_bp_jof") {
        $rut = $_SESSION["user_"];
        $id_malla = Decodear3($_GET["im"]);
        $id_empresa = $_SESSION["id_empresa"];
        // echo "$rut $id_empresa";
        // Funcion para saber cuales pueden ser los criterios de la malla
        // $PRINCIPAL=NoticiasPrincipales(FuncionesTransversales(file_get_contents("views/home/index_tnt.html")));
        // $PRINCIPAL=NoticiasSecundarias($PRINCIPAL);
        // $PRINCIPAL=NoticiasTerciarias($PRINCIPAL);
        // $PRINCIPAL=Noticias(FuncionesTransversales(file_get_contents("views/home/index_tnt.html")), 1, 3, "");
        $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/home_esc_bp_jof.html"));
        // $PRINCIPAL=Noticias($PRINCIPAL, 2, "limit 3", "");
        // $PRINCIPAL=Noticias($PRINCIPAL, 3, "limit 3, 3", "");
        $PRINCIPAL = str_replace("{ID_MALLA_ENCODEADA}", Encodear3($id_malla) , $PRINCIPAL);
        // $PRINCIPAL=BloqueLinks($PRINCIPAL);
        $PRINCIPAL = BloqueFooterContenido($PRINCIPAL);
        // $PRINCIPAL=ColocarSlider($PRINCIPAL);
        $PRINCIPAL = BarraNavegacion($PRINCIPAL, $seccion);
        // Bloque para Pregunta
        $PRINCIPAL = ColocaColaboradoresDeCampoLider($PRINCIPAL, $id_empresa, $_SESSION["user_"]);
        $PRINCIPAL = ColocaMenuSecundario($PRINCIPAL, $_SESSION["id_empresa"]);
        echo $PRINCIPAL;
    }
    else if ($seccion == "home_esc_fvp") {
        $rut = $_SESSION["user_"];
        $id_malla = Decodear3($_GET["im"]);
        $id_empresa = $_SESSION["id_empresa"];
        // echo "$rut $id_empresa";
        // Funcion para saber cuales pueden ser los criterios de la malla
        // $PRINCIPAL=NoticiasPrincipales(FuncionesTransversales(file_get_contents("views/home/index_tnt.html")));
        // $PRINCIPAL=NoticiasSecundarias($PRINCIPAL);
        // $PRINCIPAL=NoticiasTerciarias($PRINCIPAL);
        // $PRINCIPAL=Noticias(FuncionesTransversales(file_get_contents("views/home/index_tnt.html")), 1, 3, "");
        $PRINCIPAL = Noticias(FuncionesTransversales(file_get_contents("views/home/home_esc_fvp.html")) , 1, 3, "");
        // $PRINCIPAL=Noticias($PRINCIPAL, 2, "limit 3", "");
        // $PRINCIPAL=Noticias($PRINCIPAL, 3, "limit 3, 3", "");
        $PRINCIPAL = str_replace("{ID_MALLA_ENCODEADA}", Encodear3($id_malla) , $PRINCIPAL);
        $PRINCIPAL = Noticias($PRINCIPAL, 4, "limit 3", "");
        $PRINCIPAL = Noticias($PRINCIPAL, 5, "limit 3,3", "");
        // $PRINCIPAL=BloqueLinks($PRINCIPAL);
        $PRINCIPAL = BloqueLinks($PRINCIPAL, $id_empresa);
        $PRINCIPAL = BloqueDocumentos($PRINCIPAL);
        $PRINCIPAL = BloqueFotos($PRINCIPAL, $id_empresa);
        $PRINCIPAL = BloqueMiniSalonFama($PRINCIPAL, $id_empresa);
        // $PRINCIPAL=BloqueClasicos($PRINCIPAL, $id_empresa, 1);
        $PRINCIPAL = BloqueMiniBuenasPracticas($PRINCIPAL, $id_empresa);
        $PRINCIPAL = BloqueBuscadorPersonasDirectorio($PRINCIPAL, $id_empresa);
        // $PRINCIPAL=BloqueBloqueBannerDinamico($PRINCIPAL, $id_empresa, $rut);
        $PRINCIPAL = BloqueBanners($PRINCIPAL, $id_empresa);
        $PRINCIPAL = BloqueCumpleanos($PRINCIPAL, $id_empresa);
        $PRINCIPAL = BloqueNuevosIngresos($PRINCIPAL, "", $id_empresa);
        $PRINCIPAL = BloqueMovimientosInternos($PRINCIPAL, "", $id_empresa, 2);
        $PRINCIPAL = BloqueFooterContenido($PRINCIPAL);
        // $PRINCIPAL=ColocarSlider($PRINCIPAL);
        $PRINCIPAL = ColocarSliderPorNoticia($PRINCIPAL, $id_empresa);
        $PRINCIPAL = BarraNavegacion($PRINCIPAL, $seccion);
        // Bloque para Pregunta
        $PRINCIPAL = str_replace("{SECCION_PREGUNTA}", ColocaBloquePreguntaPorObjeto($datos_objeto[0]->id, $rut, "") , $PRINCIPAL);
        $PRINCIPAL = ColocaMenuSecundario($PRINCIPAL, $_SESSION["id_empresa"]);
        echo $PRINCIPAL;
    }

   
    else if ($seccion == "paso3obj") {
        $rut = $_SESSION["user_"];
        $id_empresa = $_SESSION["id_empresa"];
        // Funcion para saber cuales pueden ser los criterios de la malla
        // $PRINCIPAL=NoticiasPrincipales(FuncionesTransversales(file_get_contents("views/home/index_tnt.html")));
        // $PRINCIPAL=NoticiasSecundarias($PRINCIPAL);
        // $PRINCIPAL=NoticiasTerciarias($PRINCIPAL);
        // $PRINCIPAL=Noticias(FuncionesTransversales(file_get_contents("views/home/index_tnt.html")), 1, 3, "");
        $PRINCIPAL = Noticias(FuncionesTransversales(file_get_contents("views/sgd/objetivos/paso3.html")) , 1, 3, "");
        //        $PRINCIPAL=Noticias($PRINCIPAL, 2, "limit 3", "");
        //        $PRINCIPAL=Noticias($PRINCIPAL, 3, "limit 3, 3", "");
        $PRINCIPAL = Noticias($PRINCIPAL, 4, "limit 3", "");
        $PRINCIPAL = Noticias($PRINCIPAL, 5, "limit 3,3", "");
        // $PRINCIPAL=BloqueLinks($PRINCIPAL);
        $PRINCIPAL = BloqueLinks($PRINCIPAL, $id_empresa);
        $PRINCIPAL = BloqueDocumentos($PRINCIPAL);
        $PRINCIPAL = BloqueFotos($PRINCIPAL, $id_empresa);
        $PRINCIPAL = BloqueMiniSalonFama($PRINCIPAL, $id_empresa);
        $PRINCIPAL = BloqueClasicos($PRINCIPAL, $id_empresa, 1);
        $PRINCIPAL = BloqueMiniBuenasPracticas($PRINCIPAL, $id_empresa);
        $PRINCIPAL = BloqueBuscadorPersonasDirectorio($PRINCIPAL, $id_empresa);
        $PRINCIPAL = BloqueBloqueBannerDinamico($PRINCIPAL, $id_empresa, $rut);
        $PRINCIPAL = BloqueBanners($PRINCIPAL, $id_empresa);
        $PRINCIPAL = BloqueCumpleanos($PRINCIPAL, $id_empresa);
        $PRINCIPAL = BloqueNuevosIngresos($PRINCIPAL, "", $id_empresa);
        $PRINCIPAL = BloqueMovimientosInternos($PRINCIPAL, "", $id_empresa, 2);
        $PRINCIPAL = BloqueFooterContenido($PRINCIPAL);
        // $PRINCIPAL=ColocarSlider($PRINCIPAL);
        $PRINCIPAL = ColocarSliderPorNoticia($PRINCIPAL, $id_empresa);
        $PRINCIPAL = BarraNavegacion($PRINCIPAL, $seccion);
        // Bloque para Pregunta
        $PRINCIPAL = str_replace("{SECCION_PREGUNTA}", ColocaBloquePreguntaPorObjeto($datos_objeto[0]->id, $rut, 4) , $PRINCIPAL);
        $PRINCIPAL = ColocaMenuSecundario($PRINCIPAL, $_SESSION["id_empresa"]);
        echo $PRINCIPAL;
    }
    else if ($seccion == "paso4obj") {
        $rut = $_SESSION["user_"];
        $id_empresa = $_SESSION["id_empresa"];
        // Funcion para saber cuales pueden ser los criterios de la malla
        // $PRINCIPAL=NoticiasPrincipales(FuncionesTransversales(file_get_contents("views/home/index_tnt.html")));
        // $PRINCIPAL=NoticiasSecundarias($PRINCIPAL);
        // $PRINCIPAL=NoticiasTerciarias($PRINCIPAL);
        // $PRINCIPAL=Noticias(FuncionesTransversales(file_get_contents("views/home/index_tnt.html")), 1, 3, "");
        $PRINCIPAL = Noticias(FuncionesTransversales(file_get_contents("views/sgd/objetivos/paso4.html")) , 1, 3, "");
        //        $PRINCIPAL=Noticias($PRINCIPAL, 2, "limit 3", "");
        //        $PRINCIPAL=Noticias($PRINCIPAL, 3, "limit 3, 3", "");
        $PRINCIPAL = Noticias($PRINCIPAL, 4, "limit 3", "");
        $PRINCIPAL = Noticias($PRINCIPAL, 5, "limit 3,3", "");
        // $PRINCIPAL=BloqueLinks($PRINCIPAL);
        $PRINCIPAL = BloqueLinks($PRINCIPAL, $id_empresa);
        $PRINCIPAL = BloqueDocumentos($PRINCIPAL);
        $PRINCIPAL = BloqueFotos($PRINCIPAL, $id_empresa);
        $PRINCIPAL = BloqueMiniSalonFama($PRINCIPAL, $id_empresa);
        $PRINCIPAL = BloqueClasicos($PRINCIPAL, $id_empresa, 1);
        $PRINCIPAL = BloqueMiniBuenasPracticas($PRINCIPAL, $id_empresa);
        $PRINCIPAL = BloqueBuscadorPersonasDirectorio($PRINCIPAL, $id_empresa);
        $PRINCIPAL = BloqueBloqueBannerDinamico($PRINCIPAL, $id_empresa, $rut);
        $PRINCIPAL = BloqueBanners($PRINCIPAL, $id_empresa);
        $PRINCIPAL = BloqueCumpleanos($PRINCIPAL, $id_empresa);
        $PRINCIPAL = BloqueNuevosIngresos($PRINCIPAL, "", $id_empresa);
        $PRINCIPAL = BloqueMovimientosInternos($PRINCIPAL, "", $id_empresa, 2);
        $PRINCIPAL = BloqueFooterContenido($PRINCIPAL);
        // $PRINCIPAL=ColocarSlider($PRINCIPAL);
        $PRINCIPAL = ColocarSliderPorNoticia($PRINCIPAL, $id_empresa);
        $PRINCIPAL = BarraNavegacion($PRINCIPAL, $seccion);
        // Bloque para Pregunta
        $PRINCIPAL = str_replace("{SECCION_PREGUNTA}", ColocaBloquePreguntaPorObjeto($datos_objeto[0]->id, $rut, 4) , $PRINCIPAL);
        $PRINCIPAL = ColocaMenuSecundario($PRINCIPAL, $_SESSION["id_empresa"]);
        echo $PRINCIPAL;
    }
    else if ($seccion == "paso5obj") {
        $rut = $_SESSION["user_"];
        $id_empresa = $_SESSION["id_empresa"];
        // Funcion para saber cuales pueden ser los criterios de la malla
        // $PRINCIPAL=NoticiasPrincipales(FuncionesTransversales(file_get_contents("views/home/index_tnt.html")));
        // $PRINCIPAL=NoticiasSecundarias($PRINCIPAL);
        // $PRINCIPAL=NoticiasTerciarias($PRINCIPAL);
        // $PRINCIPAL=Noticias(FuncionesTransversales(file_get_contents("views/home/index_tnt.html")), 1, 3, "");
        $PRINCIPAL = Noticias(FuncionesTransversales(file_get_contents("views/sgd/objetivos/paso5.html")) , 1, 3, "");
        //        $PRINCIPAL=Noticias($PRINCIPAL, 2, "limit 3", "");
        //        $PRINCIPAL=Noticias($PRINCIPAL, 3, "limit 3, 3", "");
        $PRINCIPAL = Noticias($PRINCIPAL, 4, "limit 3", "");
        $PRINCIPAL = Noticias($PRINCIPAL, 5, "limit 3,3", "");
        // $PRINCIPAL=BloqueLinks($PRINCIPAL);
        $PRINCIPAL = BloqueLinks($PRINCIPAL, $id_empresa);
        $PRINCIPAL = BloqueDocumentos($PRINCIPAL);
        $PRINCIPAL = BloqueFotos($PRINCIPAL, $id_empresa);
        $PRINCIPAL = BloqueMiniSalonFama($PRINCIPAL, $id_empresa);
        $PRINCIPAL = BloqueClasicos($PRINCIPAL, $id_empresa, 1);
        $PRINCIPAL = BloqueMiniBuenasPracticas($PRINCIPAL, $id_empresa);
        $PRINCIPAL = BloqueBuscadorPersonasDirectorio($PRINCIPAL, $id_empresa);
        $PRINCIPAL = BloqueBloqueBannerDinamico($PRINCIPAL, $id_empresa, $rut);
        $PRINCIPAL = BloqueBanners($PRINCIPAL, $id_empresa);
        $PRINCIPAL = BloqueCumpleanos($PRINCIPAL, $id_empresa);
        $PRINCIPAL = BloqueNuevosIngresos($PRINCIPAL, "", $id_empresa);
        $PRINCIPAL = BloqueMovimientosInternos($PRINCIPAL, "", $id_empresa, 2);
        $PRINCIPAL = BloqueFooterContenido($PRINCIPAL);
        // $PRINCIPAL=ColocarSlider($PRINCIPAL);
        $PRINCIPAL = ColocarSliderPorNoticia($PRINCIPAL, $id_empresa);
        $PRINCIPAL = BarraNavegacion($PRINCIPAL, $seccion);
        // Bloque para Pregunta
        $PRINCIPAL = str_replace("{SECCION_PREGUNTA}", ColocaBloquePreguntaPorObjeto($datos_objeto[0]->id, $rut, 4) , $PRINCIPAL);
        $PRINCIPAL = ColocaMenuSecundario($PRINCIPAL, $_SESSION["id_empresa"]);
        echo $PRINCIPAL;
    }
    else if ($seccion == "paso1medioCiclo") {
        $rut = $_SESSION["user_"];
        $id_empresa = $_SESSION["id_empresa"];
        $id_proceso = 42;
        if ($id_proceso) {
            $_SESSION["id_proceso"] = $id_proceso;
        }
        $PRINCIPAL = FuncionesTransversales(file_get_contents("views/sgd/objetivos/paso1_mediociclo.html"));
        $PRINCIPAL = ColocaColaboradoresResumenObjetivosMedioCiclo($PRINCIPAL, $rut, $id_empresa, "", $id_proceso);
        $PRINCIPAL = BloqueFooterContenido($PRINCIPAL);
        $PRINCIPAL = BarraNavegacion($PRINCIPAL, $seccion);
        // Bloque para Pregunta
        $PRINCIPAL = str_replace("{SECCION_PREGUNTA}", ColocaBloquePreguntaPorObjeto($datos_objeto[0]->id, $rut, 4) , $PRINCIPAL);
        $PRINCIPAL = ColocaMenuSecundario($PRINCIPAL, $_SESSION["id_empresa"]);
        $PRINCIPAL = ColocaBotonera2($PRINCIPAL, "", 42);
        $PRINCIPAL = ColocaAvancesPorEvaluador($PRINCIPAL, $rut, 42, $id_empresa);
        echo $PRINCIPAL;
    }
    else if ($seccion == "resumenxdimensionpi") {
        $rut = $_SESSION["user_"];
        $id_empresa = $_SESSION["id_empresa"];
        $id_proceso = Decodear3($_GET["ip"]);
        if ($id_proceso) {
            $_SESSION["id_proceso"] = $id_proceso;
        }
        $PRINCIPAL = FuncionesTransversales(file_get_contents("views/sgd/objetivos/" . $id_empresa . "_resumen_equipo.html"));
        $PRINCIPAL = ColocaResumenPorEquipo($PRINCIPAL, $rut, $id_empresa, $id_proceso);
        $PRINCIPAL = ColocaColaboradoresResumenObjetivos($PRINCIPAL, $rut, $id_empresa, "", $id_proceso);
        $PRINCIPAL = BloqueFooterContenido($PRINCIPAL);
        $PRINCIPAL = BarraNavegacion($PRINCIPAL, $seccion);
        // Bloque para Pregunta
        $PRINCIPAL = ColocaMenuSecundario($PRINCIPAL, $_SESSION["id_empresa"]);
        $PRINCIPAL = ColocaBotonera2($PRINCIPAL, "", $id_proceso);
        $PRINCIPAL = ColocaAvancesPorEvaluador($PRINCIPAL, $rut, $id_proceso, $id_empresa);
        $PRINCIPAL = ColocaBotonera3($PRINCIPAL, $id_proceso, $rut);
        echo $PRINCIPAL;
    }
    else if ($seccion == "paso1obj") {
        $rut = $_SESSION["user_"];
        $id_empresa = $_SESSION["id_empresa"];
        $id_proceso = Decodear3($_GET["ip"]);
        if ($id_proceso) {
            $_SESSION["id_proceso"] = $id_proceso;
        }
        $PRINCIPAL = FuncionesTransversales(file_get_contents("views/sgd/objetivos/" . $id_empresa . "_paso1.html"));
        $PRINCIPAL = ColocaColaboradoresResumenObjetivos($PRINCIPAL, $rut, $id_empresa, "", $id_proceso);
        $PRINCIPAL = BloqueFooterContenido($PRINCIPAL);
        $PRINCIPAL = BarraNavegacion($PRINCIPAL, $seccion);
        // Bloque para Pregunta
        $PRINCIPAL = str_replace("{SECCION_PREGUNTA}", ColocaBloquePreguntaPorObjeto($datos_objeto[0]->id, $rut, 4) , $PRINCIPAL);
        $PRINCIPAL = ColocaMenuSecundario($PRINCIPAL, $_SESSION["id_empresa"]);
        $PRINCIPAL = ColocaBotonera2($PRINCIPAL, "", $id_proceso);
        $PRINCIPAL = ColocaAvancesPorEvaluador($PRINCIPAL, $rut, $id_proceso, $id_empresa);
        $PRINCIPAL = ColocaBotonera3($PRINCIPAL, $id_proceso, $rut);
        echo $PRINCIPAL;
    }
    else if ($seccion == "ValTodEvr") {
        $rut_fijador = Decodear3($_GET["evr"]);
        $id_proceso = Decodear3($_GET["ip"]);
        // Traigo los evaluados del evaluador
        $evaluados = TraeRelacionesSinAeConDatos($rut_fijador, $id_proceso);
        $dimensiones_por_empresa = DimensionesObjetivosPorEmpresa($id_empresa);
        foreach($evaluados as $eva) {
            foreach($dimensiones_por_empresa as $dim) {
                $datos_evaluado = UsuarioEnBasePersonasConEvaluadorValidador($eva->evaluado);
                InsertaValidacionJefeDelJefePorDimension($eva->evaluado, $datos_evaluado[0]->rut_evaluador, $datos_evaluado[0]->rut_validador, $dim->id, $id_empresa, $id_proceso);
            }
        }
        echo "<script>location.href='?sw=paso1objValidador&revr=" . Encodear3($rut_fijador) . "';</script>";
    }
    else if ($seccion == "paso1objValidador") {
        $rut = $_SESSION["user_"];
        $rut_fijador = Decodear3($_GET["revr"]);
        $id_empresa = $_SESSION["id_empresa"];
        $id_proceso = $_SESSION["id_proceso"];
        $datos_proceso_a_calibrar = TraeProcesosDeEvaluacionPorEmpresaYDiProceso($id_empresa, $id_proceso);
        // antes que todo, debo verificar que el evaluador haya finalizado todo para que el validador
        // pueda acceder a la info
        // Primero traigo el total de evaluados dado el rut del fijador.
        $datos_avance_fijador = OBJETIVOS_AvanceEvaluador($rut_fijador, $datos_proceso_a_calibrar[0]->id_proceso_a_calibrar, $id_empresa);
        if ($datos_avance_fijador[0] == 0) {
            echo "<script>
                        alert('La jefatura aun no finaliza el ingreso de los objetivos a todos sus colaboradores');
                        window.history.back();
                        </script>";
        }
        $PRINCIPAL = FuncionesTransversales(file_get_contents("views/sgd/objetivos/paso1_validador.html"));
        $PRINCIPAL = ColocaColaboradoresResumenObjetivos($PRINCIPAL, $rut_fijador, $id_empresa, $rut, $datos_proceso_a_calibrar[0]->id_proceso_a_calibrar);
        $PRINCIPAL = BloqueFooterContenido($PRINCIPAL);
        $evaluados = TraeRelacionesSinAeConDatos($rut_fijador, $datos_proceso_a_calibrar[0]->id_proceso_a_calibrar);
        $evaluados_validados = VerificaSiObjetivosEstanValidadosDadoEvaluadorIdProceso($rut_fijador, $datos_proceso_a_calibrar[0]->id_proceso_a_calibrar);
        if (count($evaluados) == count($evaluados_validados)) {
            $PRINCIPAL = str_replace("{BOTON_VALIDA_MASIVO}", "", $PRINCIPAL);
        }
        else {
            $PRINCIPAL = str_replace("{BOTON_VALIDA_MASIVO}", file_get_contents("views/sgd/objetivos/boton_validar_todos.html") , $PRINCIPAL);
            $datos_fijador = UsuarioEnBasePersonas($rut_fijador);
            $PRINCIPAL = str_replace("{NOMBRE_FIJADOR}", $datos_fijador[0]->nombre_completo, $PRINCIPAL);
        }
        $PRINCIPAL = BarraNavegacion($PRINCIPAL, $seccion);
        $PRINCIPAL = str_replace("{RUT_EVALUADOR_ENCODEADO}", Encodear3($rut_fijador) , $PRINCIPAL);
        $PRINCIPAL = str_replace("{ID_PROCESO_A_VALIDAD_ENCODEADO}", Encodear3($datos_proceso_a_calibrar[0]->id_proceso_a_calibrar) , $PRINCIPAL);
        // Bloque para Pregunta
        // $PRINCIPAL = str_replace("{SECCION_PREGUNTA}",ColocaBloquePreguntaPorObjeto($datos_objeto[0]->id, $rut, 4), $PRINCIPAL);
        $PRINCIPAL = ColocaMenuSecundario($PRINCIPAL, $_SESSION["id_empresa"]);
        $PRINCIPAL = ColocaBotonera2($PRINCIPAL, "", $_SESSION["id_proceso"]);
        $PRINCIPAL = ColocaAvancesPorEvaluador($PRINCIPAL, $evaluador);
        $PRINCIPAL = ColocarAvanceValidacionDadoRutValidador($PRINCIPAL, $rut, $id_empresa);
        echo $PRINCIPAL;
    }
    else if ($seccion == "validaObjV2") {
        $rut = $_SESSION["user_"];
        $id_empresa = $_SESSION["id_empresa"];
        $id_proceso = Decodear3($_GET["ip"]);
        if ($id_proceso) {
            $_SESSION["id_proceso"] = $id_proceso;
        }
        $datos_proceso_evaluacion = TraeProcesosDeEvaluacionPorEmpresaYDiProceso($id_empresa, $_SESSION["id_proceso"]);
        $_SESSION["id_proceso_a_validar"] = $datos_proceso_evaluacion[0]->id_proceso_a_validar;
        $PRINCIPAL = FuncionesTransversales(file_get_contents("views/sgd/objetivos/EntornoValidador.html"));
        // $PRINCIPAL=ColocaColaboradoresResumenObjetivos($PRINCIPAL, $rut, $id_empresa);
        $PRINCIPAL = ColocaBotonera2($PRINCIPAL, "", $id_proceso);
        $PRINCIPAL = ColocaJefaturasDadoValidador($PRINCIPAL, $rut, $id_empresa);
        $PRINCIPAL = ColocarAvanceValidacionDadoRutValidador($PRINCIPAL, $rut, $id_empresa);
        $PRINCIPAL = BloqueLinks($PRINCIPAL, $id_empresa);
        $PRINCIPAL = BloqueFooterContenido($PRINCIPAL);
        $PRINCIPAL = BarraNavegacion($PRINCIPAL, $seccion);
        $PRINCIPAL = ColocaMenuSecundario($PRINCIPAL, $_SESSION["id_empresa"]);
        $PRINCIPAL = ColocaAvancesPorEvaluador($PRINCIPAL, $evaluador);
        echo $PRINCIPAL;
    }
    else if ($seccion == "sgdnodisponible") {
        $id_empresa = $_SESSION["id_empresa"];
        // Funcion para saber cuales pueden ser los criterios de la malla
        // $PRINCIPAL=NoticiasPrincipales(FuncionesTransversales(file_get_contents("views/home/index_tnt.html")));
        // $PRINCIPAL=NoticiasSecundarias($PRINCIPAL);
        // $PRINCIPAL=NoticiasTerciarias($PRINCIPAL);
        $PRINCIPAL = Noticias(FuncionesTransversales(file_get_contents("views/pagina/sgd_no_disponible.html")) , 1, 3, "");
        //        $PRINCIPAL=Noticias($PRINCIPAL, 2, "limit 3", "");
        //        $PRINCIPAL=Noticias($PRINCIPAL, 3, "limit 3, 3", "");
        $PRINCIPAL = Noticias($PRINCIPAL, 4, "limit 3", "");
        $PRINCIPAL = Noticias($PRINCIPAL, 5, "limit 3,3", "");
        // $PRINCIPAL=BloqueLinks($PRINCIPAL);
        $PRINCIPAL = BloqueLinks($PRINCIPAL, $id_empresa);
        $PRINCIPAL = BloqueDocumentos($PRINCIPAL);
        $PRINCIPAL = BloqueFotos($PRINCIPAL, $id_empresa);
        $PRINCIPAL = BloqueMiniSalonFama($PRINCIPAL, $id_empresa);
        $PRINCIPAL = BloqueClasicos($PRINCIPAL, $id_empresa, 1);
        $PRINCIPAL = BloqueMiniBuenasPracticas($PRINCIPAL, $id_empresa);
        $PRINCIPAL = BloqueBuscadorPersonasDirectorio($PRINCIPAL, $id_empresa);
        $PRINCIPAL = BloqueBanners($PRINCIPAL, $id_empresa);
        $PRINCIPAL = BloqueCumpleanos($PRINCIPAL, $id_empresa);
        $PRINCIPAL = BloqueNuevosIngresos($PRINCIPAL, "", $id_empresa);
        $PRINCIPAL = BloqueMovimientosInternos($PRINCIPAL, "", $id_empresa);
        $PRINCIPAL = BloqueFooterContenido($PRINCIPAL);
        $PRINCIPAL = ColocarSlider($PRINCIPAL);
        $PRINCIPAL = BarraNavegacion($PRINCIPAL, $seccion);
        $PRINCIPAL = ColocaMenuSecundario($PRINCIPAL, $_SESSION["id_empresa"]);
        echo $PRINCIPAL;
    }
    else if ($seccion == "nodisponiblemalla") {
        $id_empresa = $_SESSION["id_empresa"];
        // Funcion para saber cuales pueden ser los criterios de la malla
        // $PRINCIPAL=NoticiasPrincipales(FuncionesTransversales(file_get_contents("views/home/index_tnt.html")));
        // $PRINCIPAL=NoticiasSecundarias($PRINCIPAL);
        // $PRINCIPAL=NoticiasTerciarias($PRINCIPAL);
        $PRINCIPAL = Noticias(FuncionesTransversales(file_get_contents("views/pagina/malla_no_disponible.html")) , 1, 3, "");
        //        $PRINCIPAL=Noticias($PRINCIPAL, 2, "limit 3", "");
        //        $PRINCIPAL=Noticias($PRINCIPAL, 3, "limit 3, 3", "");
        $PRINCIPAL = Noticias($PRINCIPAL, 4, "limit 3", "");
        $PRINCIPAL = Noticias($PRINCIPAL, 5, "limit 3,3", "");
        // $PRINCIPAL=BloqueLinks($PRINCIPAL);
        $PRINCIPAL = BloqueLinks($PRINCIPAL, $id_empresa);
        $PRINCIPAL = BloqueDocumentos($PRINCIPAL);
        $PRINCIPAL = BloqueFotos($PRINCIPAL, $id_empresa);
        $PRINCIPAL = BloqueMiniSalonFama($PRINCIPAL, $id_empresa);
        $PRINCIPAL = BloqueClasicos($PRINCIPAL, $id_empresa, 1);
        $PRINCIPAL = BloqueMiniBuenasPracticas($PRINCIPAL, $id_empresa);
        $PRINCIPAL = BloqueBuscadorPersonasDirectorio($PRINCIPAL, $id_empresa);
        $PRINCIPAL = BloqueBanners($PRINCIPAL, $id_empresa);
        $PRINCIPAL = BloqueCumpleanos($PRINCIPAL, $id_empresa);
        $PRINCIPAL = BloqueNuevosIngresos($PRINCIPAL, "", $id_empresa);
        $PRINCIPAL = BloqueMovimientosInternos($PRINCIPAL, "", $id_empresa);
        $PRINCIPAL = BloqueFooterContenido($PRINCIPAL);
        $PRINCIPAL = ColocarSlider($PRINCIPAL);
        $PRINCIPAL = BarraNavegacion($PRINCIPAL, $seccion);
        $PRINCIPAL = ColocaMenuSecundario($PRINCIPAL, $_SESSION["id_empresa"]);
        echo $PRINCIPAL;
    }
    else if ($seccion == "home_tnt2") {
        $id_empresa = $_SESSION["id_empresa"];
        // Funcion para saber cuales pueden ser los criterios de la malla
        // $PRINCIPAL=NoticiasPrincipales(FuncionesTransversales(file_get_contents("views/home/index_tnt.html")));
        // $PRINCIPAL=NoticiasSecundarias($PRINCIPAL);
        // $PRINCIPAL=NoticiasTerciarias($PRINCIPAL);
        $PRINCIPAL = Noticias(FuncionesTransversales(file_get_contents("views/home/index_tnt2.html")) , 1, 3, "");
        //        $PRINCIPAL=Noticias($PRINCIPAL, 2, "limit 3", "");
        //        $PRINCIPAL=Noticias($PRINCIPAL, 3, "limit 3, 3", "");
        $PRINCIPAL = Noticias($PRINCIPAL, 4, "limit 3", "");
        $PRINCIPAL = Noticias($PRINCIPAL, 5, "limit 3,3", "");
        $PRINCIPAL = BloqueLinks($PRINCIPAL);
        $PRINCIPAL = BloqueDocumentos($PRINCIPAL);
        $PRINCIPAL = BloqueFotos($PRINCIPAL);
        $PRINCIPAL = BloqueMiniSalonFama($PRINCIPAL, $id_empresa);
        $PRINCIPAL = BloqueMiniBuenasPracticas($PRINCIPAL);
        $PRINCIPAL = BloqueCumpleanos($PRINCIPAL, $id_empresa);
        $PRINCIPAL = BloqueNuevosIngresos($PRINCIPAL, "", $id_empresa);
        $PRINCIPAL = BloqueMovimientosInternos($PRINCIPAL, "", $id_empresa);
        $PRINCIPAL = BloqueFooterContenido($PRINCIPAL);
        $PRINCIPAL = ColocarSlider($PRINCIPAL);
        $PRINCIPAL = BarraNavegacion($PRINCIPAL, $seccion);
        $PRINCIPAL = ColocaMenuSecundario($PRINCIPAL, $_SESSION["id_empresa"]);
        echo $PRINCIPAL;
    }
    else if ($seccion == "tnt_p8") {
        $id_empresa = $_SESSION["id_empresa"];
        // Funcion para saber cuales pueden ser los criterios de la malla
        // $PRINCIPAL=NoticiasPrincipales(FuncionesTransversales(file_get_contents("views/home/index_tnt.html")));
        // $PRINCIPAL=NoticiasSecundarias($PRINCIPAL);
        // $PRINCIPAL=NoticiasTerciarias($PRINCIPAL);
        $PRINCIPAL = Noticias(FuncionesTransversales(file_get_contents("views/home/pagina/tnt_p8.html")) , 1, 3, "");
        //        $PRINCIPAL=Noticias($PRINCIPAL, 2, "limit 3", "");
        //        $PRINCIPAL=Noticias($PRINCIPAL, 3, "limit 3, 3", "");
        $PRINCIPAL = Noticias($PRINCIPAL, 4, "limit 3", "");
        $PRINCIPAL = Noticias($PRINCIPAL, 5, "limit 3,3", "");
        $PRINCIPAL = BloqueLinks($PRINCIPAL);
        $PRINCIPAL = BloqueDocumentos($PRINCIPAL);
        $PRINCIPAL = BloqueFotos($PRINCIPAL);
        $PRINCIPAL = BloqueMiniSalonFama($PRINCIPAL, $id_empresa);
        $PRINCIPAL = BloqueMiniBuenasPracticas($PRINCIPAL);
        $PRINCIPAL = BloqueCumpleanos($PRINCIPAL, $id_empresa);
        $PRINCIPAL = BloqueNuevosIngresos($PRINCIPAL, "");
        $PRINCIPAL = BloqueMovimientosInternos($PRINCIPAL);
        $PRINCIPAL = BloqueFooterContenido($PRINCIPAL);
        $PRINCIPAL = ColocarSlider($PRINCIPAL);
        $PRINCIPAL = BarraNavegacion($PRINCIPAL, $seccion);
        $PRINCIPAL = ColocaMenuSecundario($PRINCIPAL, $_SESSION["id_empresa"]);
        echo $PRINCIPAL;
    }
    else if ($seccion == "home_utem") {
        $id_empresa = $_SESSION["id_empresa"];
        // Funcion para saber cuales pueden ser los criterios de la malla
        // $PRINCIPAL=NoticiasPrincipales(FuncionesTransversales(file_get_contents("views/home/index_tnt.html")));
        // $PRINCIPAL=NoticiasSecundarias($PRINCIPAL);
        // $PRINCIPAL=NoticiasTerciarias($PRINCIPAL);
        $PRINCIPAL = Noticias(FuncionesTransversales(file_get_contents("views/home/index_tnt.html")) , 1, 3, "");
        //        $PRINCIPAL=Noticias($PRINCIPAL, 2, "limit 3", "");
        //        $PRINCIPAL=Noticias($PRINCIPAL, 3, "limit 3, 3", "");
        $PRINCIPAL = Noticias($PRINCIPAL, 4, "limit 3", "");
        $PRINCIPAL = Noticias($PRINCIPAL, 5, "limit 3,3", "");
        // $PRINCIPAL=BloqueLinks($PRINCIPAL);
        $PRINCIPAL = BloqueLinks($PRINCIPAL, $id_empresa);
        $PRINCIPAL = BloqueDocumentos($PRINCIPAL);
        $PRINCIPAL = BloqueFotos($PRINCIPAL, $id_empresa);
        $PRINCIPAL = BloqueMiniSalonFama($PRINCIPAL, $id_empresa);
        $PRINCIPAL = BloqueClasicos($PRINCIPAL, $id_empresa, 1);
        $PRINCIPAL = BloqueMiniBuenasPracticas($PRINCIPAL, $id_empresa);
        $PRINCIPAL = BloqueBuscadorPersonasDirectorio($PRINCIPAL, $id_empresa);
        $PRINCIPAL = BloqueBanners($PRINCIPAL, $id_empresa);
        $PRINCIPAL = BloqueCumpleanos($PRINCIPAL, $id_empresa);
        $PRINCIPAL = BloqueNuevosIngresos($PRINCIPAL, "", $id_empresa);
        $PRINCIPAL = BloqueMovimientosInternos($PRINCIPAL, "", $id_empresa);
        $PRINCIPAL = BloqueFooterContenido($PRINCIPAL);
        $PRINCIPAL = ColocarSlider($PRINCIPAL);
        $PRINCIPAL = BarraNavegacion($PRINCIPAL, $seccion);
        $PRINCIPAL = ColocaMenuSecundario($PRINCIPAL, $_SESSION["id_empresa"]);
        echo $PRINCIPAL;
    }
    else if ($seccion == "home_latam") {
        $id_empresa = $_SESSION["id_empresa"];
        // Funcion para saber cuales pueden ser los criterios de la malla
        // $PRINCIPAL=NoticiasPrincipales(FuncionesTransversales(file_get_contents("views/home/index_sisteco.html")));
        // $PRINCIPAL=NoticiasSecundarias($PRINCIPAL);
        $PRINCIPAL = Noticias(FuncionesTransversales(file_get_contents("views/home/index_latam.html")) , 1, 3, "");
        $PRINCIPAL = Noticias($PRINCIPAL, 2, "limit 3", "");
        $PRINCIPAL = BloqueLinks($PRINCIPAL);
        $PRINCIPAL = BloqueLinksInteres($PRINCIPAL);
        $PRINCIPAL = BloqueTips($PRINCIPAL);
        $PRINCIPAL = BloqueDocumentos($PRINCIPAL);
        $PRINCIPAL = BloqueFotos($PRINCIPAL);
        $PRINCIPAL = BloqueMiniSalonFama($PRINCIPAL, $id_empresa);
        $PRINCIPAL = BloqueMiniBuenasPracticas($PRINCIPAL);
        $PRINCIPAL = BloqueCumpleanos($PRINCIPAL, $id_empresa);
        $PRINCIPAL = BloqueNuevosIngresos($PRINCIPAL, "");
        $PRINCIPAL = BloqueMovimientosInternos($PRINCIPAL);
        $PRINCIPAL = BloqueFooterContenido($PRINCIPAL);
        $PRINCIPAL = ColocarSlider($PRINCIPAL);
        $PRINCIPAL = BarraNavegacion($PRINCIPAL, $seccion);
        $PRINCIPAL = ColocaMenuSecundario($PRINCIPAL, $_SESSION["id_empresa"]);
        echo $PRINCIPAL;
    }
    else if ($seccion == "home_sky") {
        $id_empresa = $_SESSION["id_empresa"];
        // Funcion para saber cuales pueden ser los criterios de la malla
        // $PRINCIPAL=NoticiasPrincipales(FuncionesTransversales(file_get_contents("views/home/index_sisteco.html")));
        // $PRINCIPAL=NoticiasSecundarias($PRINCIPAL);
        $PRINCIPAL = Noticias(FuncionesTransversales(file_get_contents("views/home/index_sky.html")) , 1, 3, "");
        $PRINCIPAL = Noticias($PRINCIPAL, 2, "limit 3", "");
        $PRINCIPAL = BloqueLinks($PRINCIPAL);
        $PRINCIPAL = BloqueLinksInteres($PRINCIPAL);
        $PRINCIPAL = BloqueTips($PRINCIPAL);
        $PRINCIPAL = BloqueDocumentos($PRINCIPAL);
        $PRINCIPAL = BloqueFotos($PRINCIPAL);
        $PRINCIPAL = BloqueMiniSalonFama($PRINCIPAL, $id_empresa);
        $PRINCIPAL = BloqueMiniBuenasPracticas($PRINCIPAL);
        $PRINCIPAL = BloqueCumpleanos($PRINCIPAL, $id_empresa);
        $PRINCIPAL = BloqueNuevosIngresos($PRINCIPAL, "");
        $PRINCIPAL = BloqueMovimientosInternos($PRINCIPAL);
        $PRINCIPAL = BloqueFooterContenido($PRINCIPAL);
        $PRINCIPAL = ColocarSlider($PRINCIPAL);
        $PRINCIPAL = BarraNavegacion($PRINCIPAL, $seccion);
        $PRINCIPAL = ColocaMenuSecundario($PRINCIPAL, $_SESSION["id_empresa"]);
        echo $PRINCIPAL;
    }
    else if ($seccion == "home_bci") {
        $id_empresa = $_SESSION["id_empresa"];
        // Funcion para saber cuales pueden ser los criterios de la malla
        // $PRINCIPAL=NoticiasPrincipales(FuncionesTransversales(file_get_contents("views/home/index_tnt.html")));
        // $PRINCIPAL=NoticiasSecundarias($PRINCIPAL);
        // $PRINCIPAL=NoticiasTerciarias($PRINCIPAL);
        $PRINCIPAL = Noticias(FuncionesTransversales(file_get_contents("views/home/index_bci.html")) , 1, 3, "");
        //        $PRINCIPAL=Noticias($PRINCIPAL, 2, "limit 3", "");
        //        $PRINCIPAL=Noticias($PRINCIPAL, 3, "limit 3, 3", "");
        $PRINCIPAL = Noticias($PRINCIPAL, 4, "limit 3", "");
        $PRINCIPAL = Noticias($PRINCIPAL, 5, "limit 3,3", "");
        $PRINCIPAL = BloqueLinks($PRINCIPAL);
        $PRINCIPAL = BloqueDocumentos($PRINCIPAL);
        $PRINCIPAL = BloqueFotos($PRINCIPAL);
        $PRINCIPAL = BloqueMiniSalonFama($PRINCIPAL, $id_empresa);
        $PRINCIPAL = BloqueMiniBuenasPracticas($PRINCIPAL);
        $PRINCIPAL = BloqueCumpleanos($PRINCIPAL, $id_empresa);
        $PRINCIPAL = BloqueNuevosIngresos($PRINCIPAL, "");
        $PRINCIPAL = BloqueMovimientosInternos($PRINCIPAL);
        $PRINCIPAL = BloqueFooterContenido($PRINCIPAL);
        $PRINCIPAL = ColocarSlider($PRINCIPAL);
        $PRINCIPAL = BarraNavegacion($PRINCIPAL, $seccion);
        $PRINCIPAL = ColocaMenuSecundario($PRINCIPAL, $_SESSION["id_empresa"]);
        echo $PRINCIPAL;
    }
    else if ($seccion == "home_minvest") {
        $rut = $_SESSION["user_"];
        $id_empresa = $_SESSION["id_empresa"];
        // Funcion para saber cuales pueden ser los criterios de la malla
        // $PRINCIPAL=NoticiasPrincipales(FuncionesTransversales(file_get_contents("views/home/index_tnt.html")));
        // $PRINCIPAL=NoticiasSecundarias($PRINCIPAL);
        // $PRINCIPAL=NoticiasTerciarias($PRINCIPAL);
        $PRINCIPAL = Noticias(FuncionesTransversales(file_get_contents("views/home/index_minvestplat.html")) , "principal_2columnas", 2, "");
        //        $PRINCIPAL=Noticias($PRINCIPAL, 2, "limit 3", "");
        //        $PRINCIPAL=Noticias($PRINCIPAL, 3, "limit 3, 3", "");
        $PRINCIPAL = ColocaIndicadoresVarios($PRINCIPAL);
        $PRINCIPAL = Noticias($PRINCIPAL, "principal_DOScolumnas", "limit 3", "");
        $PRINCIPAL = Noticias($PRINCIPAL, "general_TREScolumnas", "limit 3", "");
        // conectaBaseMinvest();
        $PRINCIPAL = BloqueLinks($PRINCIPAL, $id_empresa);
        $PRINCIPAL = BloqueDocumentos($PRINCIPAL);
        $PRINCIPAL = BloqueFotos($PRINCIPAL, $id_empresa);
        $PRINCIPAL = BloqueMiniSalonFama($PRINCIPAL, $id_empresa);
        $PRINCIPAL = BloqueClasicos($PRINCIPAL, $id_empresa, 1);
        $PRINCIPAL = BloqueMiniBuenasPracticas($PRINCIPAL, $id_empresa);
        $PRINCIPAL = BloqueBuscadorPersonasDirectorio($PRINCIPAL, $id_empresa);
        $PRINCIPAL = BloqueBanners($PRINCIPAL, $id_empresa);
        $PRINCIPAL = BloqueCumpleanos($PRINCIPAL, $id_empresa);
        $PRINCIPAL = BloqueNuevosIngresos($PRINCIPAL, "", $id_empresa);
        $PRINCIPAL = BloqueMovimientosInternos($PRINCIPAL, "", $id_empresa);
        $PRINCIPAL = BloqueBloqueBannerDinamico($PRINCIPAL, $id_empresa, $rut);
        // $PRINCIPAL=BloqueFooterContenido($PRINCIPAL);
        // $PRINCIPAL=ColocarSlider($PRINCIPAL);
        $PRINCIPAL = BarraNavegacion($PRINCIPAL, $seccion);
        $PRINCIPAL = ColocarSliderPorNoticia($PRINCIPAL, $id_empresa);
        $PRINCIPAL = ColocaMenuSecundario($PRINCIPAL, $_SESSION["id_empresa"]);
        // Bloque para Pregunta
        $PRINCIPAL = str_replace("{SECCION_PREGUNTA}", ColocaBloquePreguntaPorObjeto($datos_objeto[0]->id, $rut, 4) , $PRINCIPAL);
        echo $PRINCIPAL;
    }
    else if ($seccion == "home_lp") {
        $rut = $_SESSION["user_"];
        $id_empresa = $_SESSION["id_empresa"];
        $PRINCIPAL = Noticias(FuncionesTransversales(file_get_contents("views/home/index_lp.html")) , 7, 2, "");
        $PRINCIPAL = ColocaIndicadoresVarios($PRINCIPAL);
        $PRINCIPAL = Noticias($PRINCIPAL, 8, "limit 3", "");
        $PRINCIPAL = Noticias($PRINCIPAL, 9, "limit 3,3", "");
        $PRINCIPAL = BloqueLinks($PRINCIPAL, $id_empresa);
        $PRINCIPAL = BloqueDocumentos($PRINCIPAL);
        $PRINCIPAL = BloqueFotos($PRINCIPAL, $id_empresa);
        $PRINCIPAL = BloqueMiniSalonFama($PRINCIPAL, $id_empresa);
        $PRINCIPAL = BloqueClasicos($PRINCIPAL, $id_empresa, 1);
        $PRINCIPAL = BloqueMiniBuenasPracticas($PRINCIPAL, $id_empresa);
        $PRINCIPAL = BloqueBuscadorPersonasDirectorio($PRINCIPAL, $id_empresa);
        $PRINCIPAL = BloqueBanners($PRINCIPAL, $id_empresa);
        $PRINCIPAL = BloqueCumpleanos($PRINCIPAL, $id_empresa);
        $PRINCIPAL = BloqueNuevosIngresos($PRINCIPAL, "", $id_empresa);
        $PRINCIPAL = BloqueMovimientosInternos($PRINCIPAL, "", $id_empresa);
        $PRINCIPAL = BarraNavegacion($PRINCIPAL, $seccion);
        $PRINCIPAL = ColocarSliderPorNoticia($PRINCIPAL, $id_empresa);
        $PRINCIPAL = ColocaMenuSecundario($PRINCIPAL, $_SESSION["id_empresa"]);
        $PRINCIPAL = str_replace("{SECCION_PREGUNTA}", ColocaBloquePreguntaPorObjeto($datos_objeto[0]->id, $rut, 4) , $PRINCIPAL);
        echo $PRINCIPAL;
    }
    else if ($seccion == "GuardaComentarioPorCat") {
        $rut = $_SESSION["user_"];
        $id_malla = Decodear3($_POST["imalla"]);
        $home = $_POST["home"];
        $id_curso = $_POST["id_curso"];
        $comentario = utf8_decode($_POST["comentario_t"]);
        $id_empresa = $_SESSION["id_empresa"];
        InsertoComentarioPorMallaEmpresa($rut, $comentario, $id_curso, $id_malla, $id_empresa);
        if ($home == 1) {
            echo "<script>
                                    location.href='?sw=veComentCat&idma=" . Encodear3($id_malla) . "';
                                    </script>";
            exit;
        }
        else {
            echo "<script>
                                    location.href='?sw=home_bci_rev';
                                    </script>";
            exit;
        }
    }
    else if ($seccion == "home_bci_viaje") {
        $rut = $_SESSION["user_"];
        $id_empresa = $_SESSION["id_empresa"];
        $PRINCIPAL = Noticias(FuncionesTransversales(file_get_contents("views/home/index_bci_viaje.html")) , 7, 2, "");
        $PRINCIPAL = ColocaIndicadoresVarios($PRINCIPAL);
        $PRINCIPAL = Noticias($PRINCIPAL, 8, "limit 3", "");
        $PRINCIPAL = Noticias($PRINCIPAL, 9, "limit 3,3", "");
        $PRINCIPAL = BloqueLinks($PRINCIPAL, $id_empresa);
        $PRINCIPAL = BloqueDocumentos($PRINCIPAL);
        $PRINCIPAL = BloqueFotos($PRINCIPAL, $id_empresa);
        $PRINCIPAL = BloqueFotosSliderDestacadas($PRINCIPAL, $id_empresa);
        $PRINCIPAL = colocaBloqueHomeObjetos1($PRINCIPAL, "bciviaje_comodi_m1", "3");
        $PRINCIPAL = colocaBloqueHomeObjetos2($PRINCIPAL, "bciviaje_comodi_m2", "3");
        $PRINCIPAL = BloqueMiniSalonFama($PRINCIPAL, $id_empresa);
        $PRINCIPAL = BloqueClasicos($PRINCIPAL, $id_empresa, 1);
        $PRINCIPAL = BloqueMiniBuenasPracticas($PRINCIPAL, $id_empresa);
        $PRINCIPAL = BloqueBuscadorPersonasDirectorio($PRINCIPAL, $id_empresa);
        $PRINCIPAL = BloqueBanners($PRINCIPAL, $id_empresa);
        $PRINCIPAL = BloqueCumpleanos($PRINCIPAL, $id_empresa);
        $PRINCIPAL = BloqueNuevosIngresos($PRINCIPAL, "", $id_empresa);
        $PRINCIPAL = BloqueMovimientosInternos($PRINCIPAL, "", $id_empresa);
        $PRINCIPAL = BarraNavegacion($PRINCIPAL, $seccion);
        $PRINCIPAL = ColocarSliderPorNoticia($PRINCIPAL, $id_empresa);
        $PRINCIPAL = ColocaMenuSecundario($PRINCIPAL, $_SESSION["id_empresa"]);
        $atencion = BloqueAtencion($id_empresa, $rut);
        $PRINCIPAL = str_replace("{ATENCION}", $atencion, $PRINCIPAL);
        $PRINCIPAL = BloqueBloqueBannerDinamico($PRINCIPAL, $id_empresa, $rut);
        $PRINCIPAL = str_replace("{SECCION_PREGUNTA}", ColocaBloquePreguntaPorObjeto($datos_objeto[0]->id, $rut, 4) , $PRINCIPAL);
        echo $PRINCIPAL;
    }
    else if ($seccion == "test_ajax") {
        $video = $_POST["var_video"];
        FinalizaObjetoFullDatos($_SESSION["user_"], $video, $_SESSION["id_empresa"]);
        $datos_objeto = DatosObjeto("bci_new_app_m1");
        InsertaLogNavegacion($_SESSION["user_"], $video, $datos_objeto[0]->duracion_video, $datos_objeto[0]->id_curso);
        echo file_get_contents("views/cursos/capacitacion/icono_objeto_finalizado.html");
    }
    else if ($seccion == "bci_new_app") {
        $rut = $_SESSION["user_"];
        $id_empresa = $_SESSION["id_empresa"];
        $PRINCIPAL = Noticias(FuncionesTransversales(file_get_contents("https://capacitacionbci.cl/front/objetos/bci_new_app/totem_bci_app/totem_bci_app/home/")) , 7, 2, "");
        $PRINCIPAL = ColocaIndicadoresVarios($PRINCIPAL);
        $PRINCIPAL = Noticias($PRINCIPAL, 8, "limit 3", "");
        $PRINCIPAL = Noticias($PRINCIPAL, 9, "limit 3,3", "");
        $PRINCIPAL = BloqueLinks($PRINCIPAL, $id_empresa);
        $PRINCIPAL = BloqueDocumentos($PRINCIPAL);
        $PRINCIPAL = BloqueFotos($PRINCIPAL, $id_empresa);
        $PRINCIPAL = BloqueFotosSliderDestacadas($PRINCIPAL, $id_empresa);
        $PRINCIPAL = colocaBloqueHomeObjetos1($PRINCIPAL, "bciviaje_comodi_m1", "3");
        $PRINCIPAL = colocaBloqueHomeObjetos2($PRINCIPAL, "bciviaje_comodi_m2", "3");
        $PRINCIPAL = BloqueMiniSalonFama($PRINCIPAL, $id_empresa);
        $PRINCIPAL = BloqueClasicos($PRINCIPAL, $id_empresa, 1);
        $PRINCIPAL = BloqueMiniBuenasPracticas($PRINCIPAL, $id_empresa);
        $PRINCIPAL = BloqueBuscadorPersonasDirectorio($PRINCIPAL, $id_empresa);
        $PRINCIPAL = BloqueBanners($PRINCIPAL, $id_empresa);
        $PRINCIPAL = BloqueCumpleanos($PRINCIPAL, $id_empresa);
        $PRINCIPAL = BloqueNuevosIngresos($PRINCIPAL, "", $id_empresa);
        $PRINCIPAL = BloqueMovimientosInternos($PRINCIPAL, "", $id_empresa);
        $PRINCIPAL = BarraNavegacion($PRINCIPAL, $seccion);
        $PRINCIPAL = ColocarSliderPorNoticia($PRINCIPAL, $id_empresa);
        $PRINCIPAL = ColocaMenuSecundario($PRINCIPAL, $_SESSION["id_empresa"]);
        $atencion = BloqueAtencion($id_empresa, $rut);
        $PRINCIPAL = str_replace("{ATENCION}", $atencion, $PRINCIPAL);
        $PRINCIPAL = BloqueBloqueBannerDinamico($PRINCIPAL, $id_empresa, $rut);
        $PRINCIPAL = str_replace("{SECCION_PREGUNTA}", ColocaBloquePreguntaPorObjeto($datos_objeto[0]->id, $rut, 4) , $PRINCIPAL);
        // Objeto1
        $objeto_1 = ObjetoFinalizadoDadoIdYRut($rut, "bci_new_app_m1");
        if ($objeto_1) {
            $PRINCIPAL = str_replace("{ICONO_ESTADO_OBJETO_bci_new_app_m1}", file_get_contents("views/cursos/capacitacion/icono_objeto_finalizado.html") , $PRINCIPAL);
        }
        else {
            $PRINCIPAL = str_replace("{ICONO_ESTADO_OBJETO_bci_new_app_m1}", file_get_contents("views/cursos/capacitacion/icono_objeto_pendiente.html") , $PRINCIPAL);
        }
        // Objeto2
        $objeto_2 = ObjetoFinalizadoDadoIdYRut($rut, "bci_new_app_m2");
        if ($objeto_2) {
            $PRINCIPAL = str_replace("{ICONO_ESTADO_OBJETO_bci_new_app_m2}", file_get_contents("views/cursos/capacitacion/icono_objeto_finalizado.html") , $PRINCIPAL);
        }
        else {
            $PRINCIPAL = str_replace("{ICONO_ESTADO_OBJETO_bci_new_app_m2}", file_get_contents("views/cursos/capacitacion/icono_objeto_pendiente.html") , $PRINCIPAL);
        }
        echo $PRINCIPAL;
    }
    else if ($seccion == "home_bci_rev") {
        $rut = $_SESSION["user_"];
        $id_empresa = $_SESSION["id_empresa"];
        $PRINCIPAL = Noticias(FuncionesTransversales(file_get_contents("views/home/index_bci_rev.html")) , 7, 2, "");
        $datos_malla = CAPACITACION_malla_porUsuario($rut);
        // $PRINCIPAL=ColocaDatosMallaCapacitacion(FuncionesTransversales($PRINCIPAL), $rut, $id_empresa);
        $PRINCIPAL = str_replace("{BLOQUE_DATOS_PERSONALES}", file_get_contents("views/cursos/capacitacion/" . $id_empresa . "_mi_perfil_bloque_datos_home.html") , $PRINCIPAL);
        $PRINCIPAL = ColocaDatosMallaCapacitacion(FuncionesTransversales($PRINCIPAL) , $rut, $id_empresa);
        $PRINCIPAL = str_replace("{LISTADO_DETALLE_TIPS}", Tipsganados($rut, $id_empresa) , $PRINCIPAL);
        $PRINCIPAL = str_replace("{CHIPS}", CuentaObtenerTipsGanados($rut, $id_empresa) , $PRINCIPAL);
        $PRINCIPAL = str_replace("{CHIPS}", CuentaObtenerTipsGanados($rut, $id_empresa) , $PRINCIPAL);
        $PRINCIPAL = str_replace("{REV_MUESTRA_PUNTOS_TOTALES}", PuntosPersonalesHomeBciRev($rut, $id_empresa, $datos_malla[0]->id_malla) , $PRINCIPAL);
        $PRINCIPAL = ColocaIndicadoresVarios($PRINCIPAL);
        $PRINCIPAL = ColocaRankingTopHomeInicial($PRINCIPAL, $id_empresa, $datos_malla[0]->id_malla);
        $PRINCIPAL = ColocaBloqueComparte($PRINCIPAL, $id_empresa, $datos_malla[0]->id_malla, $rut, "home");
        $PRINCIPAL = Noticias($PRINCIPAL, 8, "limit 3", "");
        $PRINCIPAL = Noticias($PRINCIPAL, 9, "limit 3,3", "");
        $PRINCIPAL = BloqueLinks($PRINCIPAL, $id_empresa);
        $PRINCIPAL = BloqueDocumentos($PRINCIPAL);
        $PRINCIPAL = BloqueFotos($PRINCIPAL, $id_empresa);
        $PRINCIPAL = BarraNavegacion($PRINCIPAL, $seccion);
        $PRINCIPAL = ColocarSliderPorNoticia($PRINCIPAL, $id_empresa);
        $PRINCIPAL = ColocaMenuSecundario($PRINCIPAL, $_SESSION["id_empresa"]);
        //        $PRINCIPAL=Noticias($PRINCIPAL, 2, "limit 3", "");
        //        $PRINCIPAL=Noticias($PRINCIPAL, 3, "limit 3, 3", "");
        $PRINCIPAL = ColocaIndicadoresVarios($PRINCIPAL);
        //        $PRINCIPAL=Noticias($PRINCIPAL, "principal_DOScolumnas", "limit 3", "");
        $PRINCIPAL = Noticias($PRINCIPAL, "enFilaV2", "limit 3", "");
        $PRINCIPAL = NoticiasMiniSlider($PRINCIPAL, "Topleft", "limit 3", "");
        $PRINCIPAL = BloqueBloqueBannerDinamico($PRINCIPAL, $id_empresa, $rut);
        $PRINCIPAL = str_replace("{SECCION_PREGUNTA}", ColocaBloquePreguntaPorObjeto($datos_objeto[0]->id, $rut, 4) , $PRINCIPAL);
        echo $PRINCIPAL;
    }
    else if ($seccion == "home_los_andes_google") {
        echo "<script>
            location.href='?sw=home_los_andes_aventura';
            </script>";
        exit();
        /*
        $rut=$_SESSION["user_"];
        $id_empresa=$_SESSION["id_empresa"];
        // $PRINCIPAL=Noticias(FuncionesTransversales(file_get_contents("views/home/index_home_los_andes_google.html")), 7, 2, "");
        $PRINCIPAL=Noticias(FuncionesTransversales(file_get_contents("views/home/index_home_los_andes_google.html")), "enFilaV2", "limit 3", "");
        $datos_malla=CAPACITACION_malla_porUsuario($rut);
        // print_r($datos_malla);
        // ECHO "HOLA";
        // $PRINCIPAL=ColocaDatosMallaCapacitacion(FuncionesTransversales($PRINCIPAL), $rut, $id_empresa);
        $PRINCIPAL = str_replace("{BLOQUE_DATOS_PERSONALES}",file_get_contents("views/cursos/capacitacion/".$id_empresa."_mi_perfil_bloque_datos_home.html"),$PRINCIPAL);
        $PRINCIPAL = str_replace("{BLOQUE_DATOS_PERSONALES_PISTA}",file_get_contents("views/cursos/capacitacion/".$id_empresa."_mi_perfil_bloque_datos_home_pista.html"),$PRINCIPAL);
        $PRINCIPAL=ColocaDatosMallaCapacitacion(FuncionesTransversales($PRINCIPAL), $rut, $id_empresa);
        $PRINCIPAL = str_replace("{LISTADO_DETALLE_TIPS}",Tipsganados($rut, $id_empresa),$PRINCIPAL);
        $PRINCIPAL = str_replace("{CHIPS}",CuentaObtenerTipsGanados($rut, $id_empresa),$PRINCIPAL);
        $PRINCIPAL = str_replace("{KILOMETROS}",CuentaPuntosGanados($rut, $id_empresa,$datos_malla[0]->id_malla),$PRINCIPAL);
        $PRINCIPAL = str_replace("{REV_MUESTRA_PUNTOS_TOTALES}",CuentaPuntosGanados($rut, $id_empresa, $datos_malla[0]->id_malla),$PRINCIPAL);
        $PRINCIPAL=ColocaIndicadoresVarios($PRINCIPAL);
        $PRINCIPAL=ColocaRankingTopHomeInicialIndividual($PRINCIPAL, $id_empresa, $datos_malla[0]->id_malla);
        $PRINCIPAL=ColocaBloqueComparte($PRINCIPAL, $id_empresa, $datos_malla[0]->id_malla, $rut,"home");
        // $PRINCIPAL=Noticias($PRINCIPAL, 8, "limit 3", "");
        // $PRINCIPAL=Noticias($PRINCIPAL, 9, "limit 3,3", "");
        $PRINCIPAL=BloqueLinks($PRINCIPAL, $id_empresa);
        $PRINCIPAL=BloqueDocumentos($PRINCIPAL);
        $PRINCIPAL=BloqueFotos($PRINCIPAL, $id_empresa);
        $PRINCIPAL=BarraNavegacion($PRINCIPAL, $seccion);
        $PRINCIPAL=ColocarSliderPorNoticia($PRINCIPAL, $id_empresa);
        $PRINCIPAL=ColocaMenuSecundario($PRINCIPAL, $_SESSION["id_empresa"]);
        //        $PRINCIPAL=Noticias($PRINCIPAL, 2, "limit 3", "");
        //        $PRINCIPAL=Noticias($PRINCIPAL, 3, "limit 3, 3", "");
        $PRINCIPAL=ColocaIndicadoresVarios($PRINCIPAL);
        //        $PRINCIPAL=Noticias($PRINCIPAL, "principal_DOScolumnas", "limit 3", "");
        // $PRINCIPAL=Noticias($PRINCIPAL, "enFilaV2", "limit 3", "");
        $PRINCIPAL=NoticiasMiniSlider($PRINCIPAL, "Topleft", "limit 3", "");
        $PRINCIPAL=BloqueBloqueBannerDinamico($PRINCIPAL, $id_empresa, $rut);
        $PRINCIPAL = str_replace("{SECCION_PREGUNTA}",ColocaBloquePreguntaPorObjeto($datos_objeto[0]->id, $rut, 4), $PRINCIPAL);
        echo $PRINCIPAL;
        * */
    }
    else if ($seccion == "61_rf_callcenter") {
        $rut = $_SESSION["user_"];
        $id_empresa = $_SESSION["id_empresa"];
        // $PRINCIPAL=Noticias(FuncionesTransversales(file_get_contents("views/home/index_home_los_andes_google.html")), 7, 2, "");
        $PRINCIPAL = Noticias(FuncionesTransversales(file_get_contents("views/home/index_home_rf_callcenter.html")) , "enFilaV2", "limit 3", "");
        $datos_malla = CAPACITACION_malla_porUsuario($rut);
        // print_r($datos_malla);
        // ECHO "HOLA";
        // $PRINCIPAL=ColocaDatosMallaCapacitacion(FuncionesTransversales($PRINCIPAL), $rut, $id_empresa);
        $PRINCIPAL = str_replace("{BLOQUE_DATOS_PERSONALES}", file_get_contents("views/cursos/capacitacion/" . $id_empresa . "_mi_perfil_bloque_datos_home.html") , $PRINCIPAL);
        $PRINCIPAL = str_replace("{BLOQUE_DATOS_PERSONALES_PISTA}", file_get_contents("views/cursos/capacitacion/" . $id_empresa . "_mi_perfil_bloque_datos_home_pista.html") , $PRINCIPAL);
        $PRINCIPAL = ColocaDatosMallaCapacitacion(FuncionesTransversales($PRINCIPAL) , $rut, $id_empresa);
        $PRINCIPAL = str_replace("{LISTADO_DETALLE_TIPS}", Tipsganados($rut, $id_empresa) , $PRINCIPAL);
        $PRINCIPAL = str_replace("{CHIPS}", CuentaObtenerTipsGanados($rut, $id_empresa) , $PRINCIPAL);
        $PRINCIPAL = str_replace("{KILOMETROS}", CuentaPuntosGanados($rut, $id_empresa, $datos_malla[0]->id_malla) , $PRINCIPAL);
        $PRINCIPAL = str_replace("{REV_MUESTRA_PUNTOS_TOTALES}", CuentaPuntosGanados($rut, $id_empresa, $datos_malla[0]->id_malla) , $PRINCIPAL);
        $PRINCIPAL = ColocaIndicadoresVarios($PRINCIPAL);
        $PRINCIPAL = ColocaRankingTopHomeInicialIndividual($PRINCIPAL, $id_empresa, $datos_malla[0]->id_malla);
        $PRINCIPAL = ColocaBloqueComparte($PRINCIPAL, $id_empresa, $datos_malla[0]->id_malla, $rut, "home");
        // $PRINCIPAL=Noticias($PRINCIPAL, 8, "limit 3", "");
        // $PRINCIPAL=Noticias($PRINCIPAL, 9, "limit 3,3", "");
        $PRINCIPAL = BloqueLinks($PRINCIPAL, $id_empresa);
        $PRINCIPAL = BloqueDocumentos($PRINCIPAL);
        $PRINCIPAL = BloqueFotos($PRINCIPAL, $id_empresa);
        $PRINCIPAL = BarraNavegacion($PRINCIPAL, $seccion);
        $PRINCIPAL = ColocarSliderPorNoticia($PRINCIPAL, $id_empresa);
        $PRINCIPAL = ColocaMenuSecundario($PRINCIPAL, $_SESSION["id_empresa"]);
        //        $PRINCIPAL=Noticias($PRINCIPAL, 2, "limit 3", "");
        //        $PRINCIPAL=Noticias($PRINCIPAL, 3, "limit 3, 3", "");
        $PRINCIPAL = ColocaIndicadoresVarios($PRINCIPAL);
        //        $PRINCIPAL=Noticias($PRINCIPAL, "principal_DOScolumnas", "limit 3", "");
        // $PRINCIPAL=Noticias($PRINCIPAL, "enFilaV2", "limit 3", "");
        $PRINCIPAL = NoticiasMiniSlider($PRINCIPAL, "Topleft", "limit 3", "");
        $PRINCIPAL = BloqueBloqueBannerDinamico($PRINCIPAL, $id_empresa, $rut);
        $PRINCIPAL = str_replace("{SECCION_PREGUNTA}", ColocaBloquePreguntaPorObjeto($datos_objeto[0]->id, $rut, 4) , $PRINCIPAL);
        echo $PRINCIPAL;
    }
    else if ($seccion == "home_bci_escuela") {
        $rut = $_SESSION["user_"];
        $id_empresa = $_SESSION["id_empresa"];
        $PRINCIPAL = Noticias(FuncionesTransversales(file_get_contents("views/home/index_bci_escuela.html")) , 7, 2, "");
        $datos_malla = CAPACITACION_malla_porUsuario($rut);
        // $PRINCIPAL=ColocaDatosMallaCapacitacion(FuncionesTransversales($PRINCIPAL), $rut, $id_empresa);
        $PRINCIPAL = str_replace("{BLOQUE_DATOS_PERSONALES}", file_get_contents("views/cursos/capacitacion/" . $id_empresa . "_mi_perfil_bloque_datos_home.html") , $PRINCIPAL);
        $PRINCIPAL = ColocaDatosMallaCapacitacion(FuncionesTransversales($PRINCIPAL) , $rut, $id_empresa);
        $PRINCIPAL = str_replace("{LISTADO_DETALLE_TIPS}", Tipsganados($rut, $id_empresa) , $PRINCIPAL);
        $PRINCIPAL = str_replace("{CHIPS}", CuentaObtenerTipsGanados($rut, $id_empresa) , $PRINCIPAL);
        $PRINCIPAL = str_replace("{CHIPS}", CuentaObtenerTipsGanados($rut, $id_empresa) , $PRINCIPAL);
        $PRINCIPAL = str_replace("{REV_MUESTRA_PUNTOS_TOTALES}", PuntosPersonalesHomeBciRev($rut, $id_empresa, $datos_malla[0]->id_malla) , $PRINCIPAL);
        $PRINCIPAL = ColocaIndicadoresVarios($PRINCIPAL);
        $PRINCIPAL = ColocaRankingTopHomeInicial($PRINCIPAL, $id_empresa, $datos_malla[0]->id_malla);
        $PRINCIPAL = ColocaBloqueComparte($PRINCIPAL, $id_empresa, $datos_malla[0]->id_malla, $rut, "home");
        $PRINCIPAL = Noticias($PRINCIPAL, 8, "limit 3", "");
        $PRINCIPAL = Noticias($PRINCIPAL, 9, "limit 3,3", "");
        $PRINCIPAL = BloqueLinks($PRINCIPAL, $id_empresa);
        $PRINCIPAL = BloqueDocumentos($PRINCIPAL);
        $PRINCIPAL = BloqueFotos($PRINCIPAL, $id_empresa);
        $PRINCIPAL = BarraNavegacion($PRINCIPAL, $seccion);
        $PRINCIPAL = ColocarSliderPorNoticia($PRINCIPAL, $id_empresa);
        $PRINCIPAL = ColocaMenuSecundario($PRINCIPAL, $_SESSION["id_empresa"]);
        //        $PRINCIPAL=Noticias($PRINCIPAL, 2, "limit 3", "");
        //        $PRINCIPAL=Noticias($PRINCIPAL, 3, "limit 3, 3", "");
        $PRINCIPAL = ColocaIndicadoresVarios($PRINCIPAL);
        //        $PRINCIPAL=Noticias($PRINCIPAL, "principal_DOScolumnas", "limit 3", "");
        $PRINCIPAL = Noticias($PRINCIPAL, "enFilaV2", "limit 3", "");
        $PRINCIPAL = NoticiasMiniSlider($PRINCIPAL, "Topleft", "limit 3", "");
        $PRINCIPAL = BloqueBloqueBannerDinamico($PRINCIPAL, $id_empresa, $rut);
        $PRINCIPAL = str_replace("{SECCION_PREGUNTA}", ColocaBloquePreguntaPorObjeto($datos_objeto[0]->id, $rut, 4) , $PRINCIPAL);
        echo $PRINCIPAL;
    }
    else if ($seccion == "home_bci_productivizate") {
        $rut = $_SESSION["user_"];
        $id_empresa = $_SESSION["id_empresa"];
        $datos_malla = ObtenerDatosRelMallaUsuarioDadoRut($rut, $id_empresa);
        $PRINCIPAL = Noticias(FuncionesTransversales(file_get_contents("views/home/" . $datos_malla[0]->template . "")) , 7, 2, "");
        $PRINCIPAL = ColocaIndicadoresVarios($PRINCIPAL);
        $PRINCIPAL = Noticias($PRINCIPAL, 8, "limit 3", "");
        $PRINCIPAL = Noticias($PRINCIPAL, 9, "limit 3,3", "");
        $PRINCIPAL = BloqueLinks($PRINCIPAL, $id_empresa);
        $PRINCIPAL = BloqueDocumentos($PRINCIPAL);
        $PRINCIPAL = BloqueFotos($PRINCIPAL, $id_empresa);
        $PRINCIPAL = BloqueMiniSalonFama($PRINCIPAL, $id_empresa);
        $PRINCIPAL = BloqueClasicos($PRINCIPAL, $id_empresa, 1);
        $PRINCIPAL = BloqueMiniBuenasPracticas($PRINCIPAL, $id_empresa);
        $PRINCIPAL = BloqueBuscadorPersonasDirectorio($PRINCIPAL, $id_empresa);
        $PRINCIPAL = BloqueBanners($PRINCIPAL, $id_empresa);
        $PRINCIPAL = BloqueCumpleanos($PRINCIPAL, $id_empresa);
        $PRINCIPAL = BloqueNuevosIngresos($PRINCIPAL, "", $id_empresa);
        $PRINCIPAL = BloqueMovimientosInternos($PRINCIPAL, "", $id_empresa);
        $PRINCIPAL = BarraNavegacion($PRINCIPAL, $seccion);
        $PRINCIPAL = ColocarSliderPorNoticia($PRINCIPAL, $id_empresa);
        $PRINCIPAL = ColocaMenuSecundario($PRINCIPAL, $_SESSION["id_empresa"]);
        $PRINCIPAL = ColocaIndicadoresVarios($PRINCIPAL);
        $PRINCIPAL = Noticias($PRINCIPAL, "2columnas", "limit 3", "");
        // $PRINCIPAL=BloqueBloqueBannerDinamico($PRINCIPAL, $id_empresa, $rut);
        $PRINCIPAL = str_replace("{SECCION_PREGUNTA}", ColocaBloquePreguntaPorObjeto($datos_objeto[0]->id, $rut, 4) , $PRINCIPAL);
        echo $PRINCIPAL;
    }
    else if ($seccion == "home_rf_BK") {
        $rut = $_SESSION["user_"];
        $id_empresa = $_SESSION["id_empresa"];
        $PRINCIPAL = Noticias(FuncionesTransversales(file_get_contents("views/home/index_rf.html")) , 7, 2, "");
        $PRINCIPAL = ColocaIndicadoresVarios($PRINCIPAL);
        $PRINCIPAL = str_replace("{BLOQUE_DATOS_PERSONALES}", file_get_contents("views/cursos/capacitacion/" . $id_empresa . "_mi_perfil_bloque_datos_home.html") , $PRINCIPAL);
        $PRINCIPAL = ColocaDatosEnPerfilV2($PRINCIPAL, $rut, $id_empresa);
        $PRINCIPAL = ColocaDatosMallaCapacitacion(FuncionesTransversales($PRINCIPAL) , $rut, $id_empresa);
        $PRINCIPAL = Noticias($PRINCIPAL, 8, "limit 3", "");
        $PRINCIPAL = Noticias($PRINCIPAL, 9, "limit 3,3", "");
        $PRINCIPAL = BloqueLinks($PRINCIPAL, $id_empresa);
        $PRINCIPAL = BloqueDocumentos($PRINCIPAL);
        $PRINCIPAL = BloqueFotos($PRINCIPAL, $id_empresa);
        $PRINCIPAL = BloqueMiniSalonFama($PRINCIPAL, $id_empresa);
        $PRINCIPAL = BloqueClasicos($PRINCIPAL, $id_empresa, 1);
        $PRINCIPAL = BloqueMiniBuenasPracticas($PRINCIPAL, $id_empresa);
        $PRINCIPAL = BloqueBuscadorPersonasDirectorio($PRINCIPAL, $id_empresa);
        $PRINCIPAL = BloqueBanners($PRINCIPAL, $id_empresa);
        $PRINCIPAL = BloqueCumpleanos($PRINCIPAL, $id_empresa);
        $PRINCIPAL = BloqueNuevosIngresos($PRINCIPAL, "", $id_empresa);
        $PRINCIPAL = BloqueMovimientosInternos($PRINCIPAL, "", $id_empresa);
        $PRINCIPAL = BarraNavegacion($PRINCIPAL, $seccion);
        $PRINCIPAL = ColocarSliderPorNoticia($PRINCIPAL, $id_empresa);
        $PRINCIPAL = ColocaMenuSecundario($PRINCIPAL, $_SESSION["id_empresa"]);
        //        $PRINCIPAL=Noticias($PRINCIPAL, 2, "limit 3", "");
        //        $PRINCIPAL=Noticias($PRINCIPAL, 3, "limit 3, 3", "");
        $PRINCIPAL = ColocaIndicadoresVarios($PRINCIPAL);
        //        $PRINCIPAL=Noticias($PRINCIPAL, "principal_DOScolumnas", "limit 3", "");
        // $PRINCIPAL=Noticias($PRINCIPAL, "2columnas", "limit 3", "");
        $PRINCIPAL = Noticias($PRINCIPAL, "enFila", "limit 4", "");
        $PRINCIPAL = BloqueBloqueBannerDinamico($PRINCIPAL, $id_empresa, $rut);
        $PRINCIPAL = str_replace("{SECCION_PREGUNTA}", ColocaBloquePreguntaPorObjeto($datos_objeto[0]->id, $rut, 4) , $PRINCIPAL);
        echo $PRINCIPAL;
    }
    else if ($seccion == "home_bci_gerencia_capacitacion") {
        $rut = $_SESSION["user_"];
        $id_empresa = $_SESSION["id_empresa"];
        $PRINCIPAL = Noticias(FuncionesTransversales(file_get_contents("views/home/67_index.html")) , 7, 2, "");
        $PRINCIPAL = ColocaIndicadoresVarios($PRINCIPAL);
        $PRINCIPAL = Noticias($PRINCIPAL, 8, "limit 3", "");
        $PRINCIPAL = Noticias($PRINCIPAL, 9, "limit 3,3", "");
        $PRINCIPAL = BloqueLinks($PRINCIPAL, $id_empresa);
        $PRINCIPAL = BloqueDocumentos($PRINCIPAL);
        $PRINCIPAL = BloqueFotos($PRINCIPAL, $id_empresa);
        $PRINCIPAL = BloqueMiniSalonFama($PRINCIPAL, $id_empresa);
        $PRINCIPAL = BloqueClasicos($PRINCIPAL, $id_empresa, 1);
        $PRINCIPAL = BloqueMiniBuenasPracticas($PRINCIPAL, $id_empresa);
        $PRINCIPAL = BloqueBuscadorPersonasDirectorio($PRINCIPAL, $id_empresa);
        $PRINCIPAL = BloqueBanners($PRINCIPAL, $id_empresa);
        $PRINCIPAL = BloqueCumpleanos($PRINCIPAL, $id_empresa);
        $PRINCIPAL = BloqueNuevosIngresos($PRINCIPAL, "", $id_empresa);
        $PRINCIPAL = BloqueMovimientosInternos($PRINCIPAL, "", $id_empresa);
        $PRINCIPAL = BarraNavegacion($PRINCIPAL, $seccion);
        $PRINCIPAL = ColocarSliderPorNoticia($PRINCIPAL, $id_empresa);
        $PRINCIPAL = ColocaMenuSecundario($PRINCIPAL, $_SESSION["id_empresa"]);
        // $PRINCIPAL=Noticias($PRINCIPAL, 2, "limit 3", "");
        // $PRINCIPAL=Noticias($PRINCIPAL, 3, "limit 3, 3", "");
        $PRINCIPAL = ColocaIndicadoresVarios($PRINCIPAL);
        // $PRINCIPAL=Noticias($PRINCIPAL, "principal_DOScolumnas", "limit 3", "");
        // $PRINCIPAL=Noticias($PRINCIPAL, "2columnas", "limit 3", "");
        $PRINCIPAL = Noticias($PRINCIPAL, "enFila", "limit 4", "");
        // $PRINCIPAL=BloqueBloqueBannerDinamico($PRINCIPAL, $id_empresa, $rut);
        $PRINCIPAL = str_replace("{SECCION_PREGUNTA}", ColocaBloquePreguntaPorObjeto($datos_objeto[0]->id, $rut, 4) , $PRINCIPAL);
        $PRINCIPAL = ColocaDatosPerfil($PRINCIPAL, $rut);
        echo $PRINCIPAL;
    }

    else if ($seccion == "ColocaPostPorAjax") {
        $id_empresa = $_SESSION["id_empresa"];
        $rut = $_SESSION["user_"];
        $start_limit = $_POST["start_limit"];
        $arreglo_get = $_POST["variables_get"];
        $array_para_recibir_via_url = stripslashes($arreglo_get);
        $array_para_recibir_via_url = urldecode($array_para_recibir_via_url);
        $arreglo_get = unserialize($array_para_recibir_via_url);
        // print_r($arreglo_get["cat"]);exit;
        if ($_GET["sess"] <> '') {
            $id_session = ValidarSesionMP(Decodear3($_GET["sess"]) , $rut, $id_empresa);
        }
        // echo "id session $id_session";
        if ($id_session <> '' and $_SESSION["template"] == '') {
            $_SESSION["template"] = $id_session[0]->id_subcategoria;
            $array_MP_template[0]->template = $_SESSION["template"];
            $array_MP_template[0]->id_subcategoria = $_SESSION["template"];
        }
        elseif ($id_session == '' and $_SESSION["template"] <> '') {
            // $array_MP_template=MP_BuscaTemplate($rut, $id_empresa);
            $array_MP_template[0]->template = $_SESSION["template"];
            $array_MP_template[0]->id_subcategoria = $_SESSION["template"];
        }
        elseif ($id_session <> '' and $_SESSION["template"] <> '') {
            $_SESSION["template"] = $id_session[0]->id_subcategoria;
            $array_MP_template[0]->template = $_SESSION["template"];
            $array_MP_template[0]->id_subcategoria = $_SESSION["template"];
        }
        // echo "id sesion ".$array_MP_template[0]->id_subcategoria."<br />";
        // print_r($_POST); exit();
        if ($array_MP_template[0]->id_subcategoria <> '') {
            $subcategoria = $array_MP_template[0]->id_subcategoria;
        }
        $ord_by = mysql_real_escape_string(trim($arreglo_get["ord_by"]));
        $filt_by = mysql_real_escape_string(trim($arreglo_get["filt_by"]));
        $filt_cat = mysql_real_escape_string(trim($arreglo_get["filt_cat"]));
        $vp = mysql_real_escape_string(trim($arreglo_get["vp"]));
        $swa = mysql_real_escape_string(trim($arreglo_get["swa"]));
        $amb = mysql_real_escape_string(trim($arreglo_get["amb"]));
        $sg = mysql_real_escape_string(trim($arreglo_get["sg"]));
        $tag = mysql_real_escape_string(trim($arreglo_get["tag"]));
        $rut_enviado = mysql_real_escape_string(trim($arreglo_get["rut_enviado"]));
        $tipo_consulta = mysql_real_escape_string(trim($arreglo_get["tipo"]));
        $idcat = mysql_real_escape_string(trim($arreglo_get["idcat"]));
        $cat = mysql_real_escape_string(trim($arreglo_get["cat"]));
        $filt_cat = $idcat;
        $search = mysql_real_escape_string(trim($arreglo_get["q"]));
        $groupseguir = mysql_real_escape_string(trim($arreglo_get["groupseguir"]));
        $soloexpertos = mysql_real_escape_string(trim($arreglo_get["soloexpertos"]));
        $mp_ans = mysql_real_escape_string(trim($arreglo_get["mp_ans"]));
        $idme = mysql_real_escape_string(trim($arreglo_get["idme"]));
        $idmeid = mysql_real_escape_string(trim($arreglo_get["idmeid"]));
        $PRINCIPAL = FuncionesTransversales(file_get_contents("views/comunidad_mp/" . $id_empresa . "_com_mp_personal_solo_post.html"));
        $listadoPost = com_mp_personal_lista($PRINCIPAL, $id_empresa, $rut, $ord_by, $filt_by, $filt_cat, $vp, $tag, $rut_enviado, $tipo_consulta, $amb, $start_limit, $subcategoria, $idamb, $template);
        $listadoPost = str_replace("{NUMERO_COMENTARIOS}", $start_limit + 1, $listadoPost);
        // echo date("Y-m-d H:i:s");
        echo $listadoPost;
    }
    else if ($seccion == "test_webservice_soap") {
        $rut = $_SESSION["user_"];
        $id_empresa = $_SESSION["id_empresa"];
        $PRINCIPAL = (FuncionesTransversales(file_get_contents("views/home/test_soap.html")));
        $PRINCIPAL = BarraNavegacion($PRINCIPAL, $seccion);
        $PRINCIPAL = ColocaMenuSecundario($PRINCIPAL, $_SESSION["id_empresa"]);
        $PRINCIPAL = str_replace("{ROW_BCI_COINS_CARTOLA}", $arreglo_row_bcicoins[0], $PRINCIPAL);
        $PRINCIPAL = str_replace("{SUMATOTAL_PUNTOS_REPORTES}", $arreglo_row_bcicoins[1], $PRINCIPAL);
        if ($arreglo_oferta_abierta[0]->id > 0) {
            // echo "si";
            $PRINCIPAL = str_replace("{URLINSCRIBETE}", '?sw=home_bci_inscribete', $PRINCIPAL);
            $PRINCIPAL = str_replace("{IMAGENINSCRIBETE}", "", $PRINCIPAL);
        }
        else {
            // echo "no";
            $PRINCIPAL = str_replace("{URLINSCRIBETE}", "", $PRINCIPAL);
            $PRINCIPAL = str_replace("{IMAGENINSCRIBETE}", " ", $PRINCIPAL);
        }
        // print_r($arreglo_oferta_abierta);
        // ActualizaTablatblLmsReportePorRut($rut);
        $PRINCIPAL = str_replace("{AVANCEMALLATOTAL}", $arreglo_row_avance[1], $PRINCIPAL);
        $PRINCIPAL = str_replace("{ROW_LISTA_PROGRAMAS_OBLIGATORIOS}", $arreglo_row_avance[0], $PRINCIPAL);
        // opcional
        $PRINCIPAL = str_replace("{ROW_LISTA_PROGRAMAS_OPCIONAL}", $arreglo_row_avance_opcional[0], $PRINCIPAL);
        echo $PRINCIPAL;
    }
    else if ($seccion == "diploma") {
        $id_empresa = $_SESSION["id_empresa"];
        $nombre = Decodear3($_GET["name"]);
        $curso = Decodear3($_GET["course"]);
        $programa = Decodear3($_GET["program"]);
        $mes = Decodear3($_GET["month"]);
        $anno = Decodear3($_GET["year"]);
        $horas = Decodear3($_GET["hour"]);
        $PRINCIPAL = FuncionesTransversales(file_get_contents("views/diploma/" . $id_empresa . "_diploma.html"));
        $PRINCIPAL = str_replace("{NOMBRE}", $nombre, $PRINCIPAL);
        $PRINCIPAL = str_replace("{CURSO}", $curso, $PRINCIPAL);
        $PRINCIPAL = str_replace("{PROGRAMA}", $programa, $PRINCIPAL);
        $PRINCIPAL = str_replace("{HORAS}", $horas, $PRINCIPAL);
        $PRINCIPAL = str_replace("{MES}", $mes, $PRINCIPAL);
        $PRINCIPAL = str_replace("{ANO}", $anno, $PRINCIPAL);
        echo $PRINCIPAL;
    }
    else if ($seccion == "SaveMedicion") {
        // print_r($_POST);
        $id_empresa = $_SESSION["id_empresa"];
        $rut = $_SESSION["user_"];
        $id_encuesta = $_POST["id_encuesta"];
        $rut_colaborador = $_POST["rut_colaborador"];
        $id_medicion = $_POST["id_medicion"];
        $comentario_enc_sat_final = $_POST["comentario_enc_sat_final"];
        $url_back_med = $_POST["url_back_med"];
        if ($url_back_med <> '') {
            $url_back_med = $url_back_med;
        }
        else {
            $url_back_med = "medicion";
        }
        // traer la preguntas por encuesta
        // print_r($_POST); exit();
        $preguntas = PreguntasFinNivel($id_empresa, $id_encuesta, $rut_colaborador, $id_curso, $id_malla);
        // foreach por las preguntas de la encuesta
        // print_r($preguntas);
        foreach($preguntas as $preg) {
            // Por cada pregunta veo si estÃ¡ la alternativa
            if ($_POST[$rut_colaborador . $id_encuesta . $preg->id_pregunta]) {
                // echo "pregunta ".$preg->id_pregunta." respuesta ".$_POST[$rut_colaborador.$id_encuesta.$preg->id_pregunta]."<br />";
                //
                SaveMedicionData($id_empresa, $id_medicion, $id_encuesta, $preg->id_pregunta, $_POST[$rut_colaborador . $id_encuesta . $preg->id_pregunta], $rut, $rut_colaborador, $comentario_enc_sat_final);
            }
        }
        // echo "hola";
        // exit();
        echo "<script>location.href='?sw=" . $url_back_med . "';</script>";
    }
    else if ($seccion == "SaveMedicionFechaClima") {
        // echo "<pre>";print_r($_POST);
        $id_empresa = $_SESSION["id_empresa"];
        $rut = $_SESSION["user_"];
        $id_encuesta = $_POST["id_encuesta"];
        $rut_colaborador = $_POST["rut_colaborador"];
        $id_medicion = $_POST["id_medicion"];
        $fecha = $_POST["fecha"];
        $url_back_med = $_POST["url_back_med"];
        if ($url_back_med <> '') {
            $url_back_med = $url_back_med;
        }
        else {
            $url_back_med = "medicion";
        }
        $comentario = $_POST["comentario"];
        $edad = $_POST["edad"];
        $genero = $_POST["genero"];
        // echo "<br />rut colaborador    $rut_colaborador, rut $rut";
        if ($rut_colaborador == "") {
            $rut_colaborador = $rut;
            $url_back_med = "medicion_encuestas";
        }
        // echo "<br />rut colaborador    $rut_colaborador, rut $rut";
        // echo "SaveMedicionFecha $id_empresa, $id_encuesta, $id_medicion, $rut, $rutcol, $fecha";
        $preguntas = PreguntasMedicionColaboradoresFecha($id_empresa, $id_encuesta, $id_medicion, $rut, $rutcol, $fecha);
        // foreach por las preguntas de la encuesta
        foreach($preguntas as $preg) {
            // echo "<br />PreguntasMedicionColaboradoresFecha ";print_r($preg);
            // Por cada pregunta veo si estÃ¡ la alternativa
            if ($_POST[$rut_colaborador . $id_encuesta . $preg->id_pregunta]) {
                // echo "pregunta ".$preg->id_pregunta." respuesta ".$_POST[$rut_colaborador.$id_encuesta.$preg->id_pregunta]."<br />";
                //
                SaveMedicionDataFechaClima($id_empresa, $id_medicion, $id_encuesta, $preg->id_pregunta, $_POST[$rut_colaborador . $id_encuesta . $preg->id_pregunta], $rut, $rut_colaborador, $fecha, $comentario, $edad, $genero);
            }
        }
        // echo "hola";
        // exit();
        // exit();
        echo "<script>location.href='?sw=medicion_clima';</script>";
    }
    else if ($seccion == "SaveMedicionFecha") {
        // echo "<pre>";print_r($_POST);
        $id_empresa = $_SESSION["id_empresa"];
        $rut = $_SESSION["user_"];
        $id_encuesta = $_POST["id_encuesta"];
        $rut_colaborador = $_POST["rut_colaborador"];
        $id_medicion = $_POST["id_medicion"];
        $fecha = $_POST["fecha"];
        $url_back_med = $_POST["url_back_med"];
        if ($url_back_med <> '') {
            $url_back_med = $url_back_med;
        }
        else {
            $url_back_med = "medicion";
        }
        // echo "<br />rut colaborador    $rut_colaborador, rut $rut";
        if ($rut_colaborador == "") {
            $rut_colaborador = $rut;
            $url_back_med = "medicion_encuestas";
        }
        // echo "<br />rut colaborador    $rut_colaborador, rut $rut";
        // echo "SaveMedicionFecha $id_empresa, $id_encuesta, $id_medicion, $rut, $rutcol, $fecha";
        $preguntas = PreguntasMedicionColaboradoresFecha($id_empresa, $id_encuesta, $id_medicion, $rut, $rutcol, $fecha);
        // foreach por las preguntas de la encuesta
        foreach($preguntas as $preg) {
            // echo "<br />PreguntasMedicionColaboradoresFecha ";print_r($preg);
            // Por cada pregunta veo si estÃ¡ la alternativa
            if ($_POST[$rut_colaborador . $id_encuesta . $preg->id_pregunta]) {
                // echo "pregunta ".$preg->id_pregunta." respuesta ".$_POST[$rut_colaborador.$id_encuesta.$preg->id_pregunta]."<br />";
                //
                SaveMedicionDataFecha($id_empresa, $id_medicion, $id_encuesta, $preg->id_pregunta, $_POST[$rut_colaborador . $id_encuesta . $preg->id_pregunta], $rut, $rut_colaborador, $fecha);
            }
        }
        // echo "hola";
        // exit();
        // exit();
        echo "<script>location.href='?sw=" . $url_back_med . "';</script>";
    }
   else if ($seccion == "SaveMedicionEncuestaEvaluacionLB") {
        //echo "<pre>";print_r($_POST);//exit();

        $id_empresa = $_SESSION["id_empresa"];
        $rut = $_SESSION["user_"];
        $id_encuesta = $_POST["id_encuesta"];
        $rut_colaborador = $_POST["rut_colaborador"];
        $id_medicion = $_POST["id_medicion"];
        $fecha = $_POST["fecha"];
        $comentario = $_POST["comentario"];
        $num_preguntas = $_POST["num_preguntas"];

        $url_back_med = $_POST["url_back_med"];
        if ($url_back_med <> '') {
            $url_back_med = $url_back_med;
        }
        else {
            $url_back_med = "medicion";
        }
        // echo "<br />rut colaborador    $rut_colaborador, rut $rut";
        if ($rut_colaborador == "") {
            $rut_colaborador = $rut;
            $url_back_med = "medicion_encuestas";
        }
        // echo "<br />rut colaborador    $rut_colaborador, rut $rut";
        // echo "SaveMedicionFecha $id_empresa, $id_encuesta, $id_medicion, $rut, $rutcol, $fecha";
        $preguntas = PreguntasMedicionColaboradoresLibreFull($id_empresa, $id_encuesta, $id_medicion, $rut, $rutcol, $fecha);
        // foreach por las preguntas de la encuesta
        foreach($preguntas as $preg) {
            // echo "<br />PreguntasMedicionColaboradoresFecha ";//print_r($preg);
            // Por cada pregunta veo si estÃ¡ la alternativa
                //print_r($preg);
                if($preg->tipo=='SELMUL+OTRA'){

                    $respuesta   =  utf8_decode($_POST[$id_encuesta.$preg->id_pregunta."_otra"]);
                    //echo "<br>SELMUL+OTRA' ".$respuesta;

                }  else {

                    $respuesta   =  utf8_decode($_POST[$id_encuesta.$preg->id_pregunta]);
                    //echo "<br> ".$respuesta;

                }$puntajefinal=0;
                if($preg->tipo=='CHECKBOX'){
                  /*  echo "<br>idp ".$preg->id_pregunta;
                    echo "<br>...";
                    echo "<br>op ".$_POST[$id_encuesta.$preg->id_pregunta."_1"];
                    echo "<br>op ".$_POST[$id_encuesta.$preg->id_pregunta."_2"];
                    echo "<br>op ".$_POST[$id_encuesta.$preg->id_pregunta."_3"];
                    echo "<br>op ".$_POST[$id_encuesta.$preg->id_pregunta."_4"];
                    echo "<br>op ".$_POST[$id_encuesta.$preg->id_pregunta."_5"];
                    echo "<br>op ".$_POST[$id_encuesta.$preg->id_pregunta."_6"];
                    echo "<br>op ".$_POST[$id_encuesta.$preg->id_pregunta."_7"];
                    echo "<br>op ".$_POST[$id_encuesta.$preg->id_pregunta."_8"];
                    echo "<br>op ".$_POST[$id_encuesta.$preg->id_pregunta."_9"];
                    echo "<br>op ".$_POST[$id_encuesta.$preg->id_pregunta."_10"];  */

                    if($_POST[$id_encuesta.$preg->id_pregunta."_1"]<>'')    {$respuesta.="Op1_";    $puntaje=BuscaPuntajeEncEvalu($id_encuesta, $id_empresa, $preg->id_pregunta, "alt1puntos");$puntajefinal=$puntaje+$puntajefinal;}
                    if($_POST[$id_encuesta.$preg->id_pregunta."_2"]<>'')    {$respuesta.="Op2_";    $puntaje=BuscaPuntajeEncEvalu($id_encuesta, $id_empresa, $preg->id_pregunta, "alt2puntos");$puntajefinal=$puntaje+$puntajefinal;}
                    if($_POST[$id_encuesta.$preg->id_pregunta."_3"]<>'')    {$respuesta.="Op3_";    $puntaje=BuscaPuntajeEncEvalu($id_encuesta, $id_empresa, $preg->id_pregunta, "alt3puntos");$puntajefinal=$puntaje+$puntajefinal;}
                    if($_POST[$id_encuesta.$preg->id_pregunta."_4"]<>'')    {$respuesta.="Op4_";    $puntaje=BuscaPuntajeEncEvalu($id_encuesta, $id_empresa, $preg->id_pregunta, "alt4puntos");$puntajefinal=$puntaje+$puntajefinal;}
                    if($_POST[$id_encuesta.$preg->id_pregunta."_5"]<>'')    {$respuesta.="Op5_";    $puntaje=BuscaPuntajeEncEvalu($id_encuesta, $id_empresa, $preg->id_pregunta, "alt5puntos");$puntajefinal=$puntaje+$puntajefinal;}
                    if($_POST[$id_encuesta.$preg->id_pregunta."_6"]<>'')    {$respuesta.="Op6_";    $puntaje=BuscaPuntajeEncEvalu($id_encuesta, $id_empresa, $preg->id_pregunta, "alt6puntos");$puntajefinal=$puntaje+$puntajefinal;}
                    if($_POST[$id_encuesta.$preg->id_pregunta."_7"]<>'')    {$respuesta.="Op7_";    $puntaje=BuscaPuntajeEncEvalu($id_encuesta, $id_empresa, $preg->id_pregunta, "alt7puntos");$puntajefinal=$puntaje+$puntajefinal;}
                    if($_POST[$id_encuesta.$preg->id_pregunta."_8"]<>'')    {$respuesta.="Op8_";    $puntaje=BuscaPuntajeEncEvalu($id_encuesta, $id_empresa, $preg->id_pregunta, "alt8puntos");$puntajefinal=$puntaje+$puntajefinal;}
                    if($_POST[$id_encuesta.$preg->id_pregunta."_9"]<>'')    {$respuesta.="Op9_";    $puntaje=BuscaPuntajeEncEvalu($id_encuesta, $id_empresa, $preg->id_pregunta, "alt9puntos");$puntajefinal=$puntaje+$puntajefinal;}
                    if($_POST[$id_encuesta.$preg->id_pregunta."_10"]<>'')   {$respuesta.="Op10_";    $puntaje=BuscaPuntajeEncEvalu($id_encuesta, $id_empresa, $preg->id_pregunta, "alt10puntos");$puntajefinal=$puntaje+$puntajefinal;}
                        //echo "<br>puntajefinal $puntajefinal";
                    }

                if($respuesta<>''){$cuentares++;}
                //echo "pregunta ".$preg->id_pregunta." respuesta ".$_POST[$rut_colaborador.$id_encuesta.$preg->id_pregunta]."<br />";
                //
                    //echo "<br>".$preg->id_pregunta." respuesta $respuesta, cuenta res $cuentares, puntaje $puntajefinal";
                    SaveMedicionEncuestaEvaluacionDataLB($id_empresa, $id_medicion, $id_encuesta, $preg->id_pregunta,$rut, $respuesta,$comentario, $puntajefinal);

        }

        if($cuentares>=$num_preguntas) {
            echo "<script>location.href='?sw=medicion_encuestas_evaluacion_preguntas_lb_res&idm=".$id_encuesta."&sa=1';</script>";
        } else {
         echo "<script>alert('Te faltan preguntas por contestar!');</script>";
        echo "<script>location.href='?sw=medicion_encuestas_evaluacion_preguntas_lb&idm=".$id_encuesta."&sa=1';</script>";
        }
        exit();
        echo "<script>location.href='?sw=mis_encuestas_lb';</script>";
    }
   else if ($seccion == "SaveMedicionLB") {
        //echo "<pre>";print_r($_POST);

        $id_empresa = $_SESSION["id_empresa"];
        $rut = $_SESSION["user_"];
        $id_encuesta = $_POST["id_encuesta"];
        $rut_colaborador = $_POST["rut_colaborador"];
        $id_medicion = $_POST["id_medicion"];
        $fecha = $_POST["fecha"];
        $comentario = $_POST["comentario"];

        $url_back_med = $_POST["url_back_med"];
        if ($url_back_med <> '') {
            $url_back_med = $url_back_med;
        }
        else {
            $url_back_med = "medicion";
        }
        // echo "<br />rut colaborador    $rut_colaborador, rut $rut";
        if ($rut_colaborador == "") {
            $rut_colaborador = $rut;
            $url_back_med = "medicion_encuestas";
        }
        // echo "<br />rut colaborador    $rut_colaborador, rut $rut";
        // echo "SaveMedicionFecha $id_empresa, $id_encuesta, $id_medicion, $rut, $rutcol, $fecha";
        $preguntas = PreguntasMedicionColaboradoresLibreFull($id_empresa, $id_encuesta, $id_medicion, $rut, $rutcol, $fecha);
        // foreach por las preguntas de la encuesta
        foreach($preguntas as $preg) {
             //echo "<br />PreguntasMedicionColaboradoresFecha ";print_r($preg);
            // Por cada pregunta veo si estÃ¡ la alternativa
                //print_r($preg);
                if($preg->tipo=='SELMUL+OTRA'){

                    $respuesta   =  utf8_decode($_POST[$id_encuesta.$preg->id_pregunta."_otra"]);
                    //echo "<br>SELMUL+OTRA' ".$respuesta;
                }  else {

                    $respuesta   =  utf8_decode($_POST[$id_encuesta.$preg->id_pregunta]);
                    //echo "<br> ".$respuesta;
                }
                //echo "pregunta ".$preg->id_pregunta." respuesta ".$_POST[$rut_colaborador.$id_encuesta.$preg->id_pregunta]."<br />";
                //
                //echo "<br>".$preg->id_pregunta." respuesta $respuesta";
            SaveMedicionDataLB($id_empresa, $id_medicion, $id_encuesta, $preg->id_pregunta,$rut, $respuesta,$comentario);

        }
        echo "<script>location.href='?sw=mis_encuestas_lb';</script>";
    }

    else if ($seccion == "SaveMedicionAnimo") {
        $id_empresa = $_SESSION["id_empresa"];
        $rut = $_SESSION["user_"];
        $id_encuesta = $_POST["id_encuesta"];
        $rut_colaborador = $_POST["rut_colaborador"];
        $id_medicion = $_POST["id_medicion"];
        $fecha = $_POST["fecha"];
        $respuesta = $_POST["input-animo"];
        $url_back_med = "home_landing";
        SaveMedicionDataFecha($id_empresa, $id_medicion, $id_encuesta, "1", $respuesta, $rut, $rut, $fecha);
        // echo "hola";
        // exit();
        echo "<script>location.href='?sw=" . $url_back_med . "';</script>";
    }
    else if ($seccion == "medicion") {
        $rut = $_SESSION["user_"];
        $id_empresa = $_SESSION["id_empresa"];
        $PRINCIPAL = Noticias(FuncionesTransversales(file_get_contents("views/medicion/" . $id_empresa . "_index_medicion.html")) , 7, 2, "");
        $PRINCIPAL = BarraNavegacion($PRINCIPAL, $seccion);
        $PRINCIPAL = ColocarSliderPorNoticia($PRINCIPAL, $id_empresa);
        $PRINCIPAL = ColocaMenuSecundario($PRINCIPAL, $_SESSION["id_empresa"]);
        // BUSCA MEDICIONES PARA JEFE
        // $arreglo_row_avance=lms_medicion_por_jefe($rut, $id_empresa);
        // $PRINCIPAL = str_replace("{MIS_MEDICIONES}",$arreglo_row_avance[0], $PRINCIPAL);
        $arreglo_row_avance_pendientes = lms_medicion_por_jefe_por_estado($rut, "pendientes", $id_empresa);
        $PRINCIPAL = str_replace("{MIS_MEDICIONES_ACTIVAS_PENDIENTES}", $arreglo_row_avance_pendientes[0], $PRINCIPAL);
        $arreglo_row_avance_realizadas = lms_medicion_por_jefe_por_estado($rut, "realizadas", $id_empresa);
        $PRINCIPAL = str_replace("{MIS_MEDICIONES_REALIZADAS}", $arreglo_row_avance_realizadas[0], $PRINCIPAL);
        // $arreglo_row_avance=lms_medicion_por_jefe_por_estado($rut, $id_empresa);
        // $PRINCIPAL = str_replace("{MIS_MEDICIONES_INVISIBLES}",$arreglo_row_avance[0], $PRINCIPAL);
        // $PRINCIPAL=ColocaDatosPerfil($PRINCIPAL, $rut);
        echo $PRINCIPAL;
    }
    else if ($seccion == "medicion_clima") {
        $rut = $_SESSION["user_"];
        $id_empresa = $_SESSION["id_empresa"];
        $PRINCIPAL = Noticias(FuncionesTransversales(file_get_contents("views/medicion/" . $id_empresa . "_index_medicion_clima.html")) , 7, 2, "");
        $PRINCIPAL = BarraNavegacion($PRINCIPAL, $seccion);
        $PRINCIPAL = ColocarSliderPorNoticia($PRINCIPAL, $id_empresa);
        $PRINCIPAL = ColocaMenuSecundario($PRINCIPAL, $_SESSION["id_empresa"]);
        // BUSCA MEDICIONES PARA JEFE
        // $arreglo_row_avance=lms_medicion_por_jefe($rut, $id_empresa);
        // $PRINCIPAL = str_replace("{MIS_MEDICIONES}",$arreglo_row_avance[0], $PRINCIPAL);
        $arreglo_row_avance_pendientes = lms_medicion_encuestas_clima_por_estado($rut, "PENDIENTE", $id_empresa);
        $PRINCIPAL = str_replace("{MIS_MEDICIONES_ACTIVAS_PENDIENTES}", $arreglo_row_avance_pendientes[0], $PRINCIPAL);
        $arreglo_row_avance_realizadas = lms_medicion_encuestas_clima_por_estado($rut, "FINALIZADO", $id_empresa);
        $PRINCIPAL = str_replace("{MIS_MEDICIONES_REALIZADAS}", $arreglo_row_avance_realizadas[0], $PRINCIPAL);
        // $arreglo_row_avance=lms_medicion_por_jefe_por_estado($rut, $id_empresa);
        // $PRINCIPAL = str_replace("{MIS_MEDICIONES_INVISIBLES}",$arreglo_row_avance[0], $PRINCIPAL);
        // $PRINCIPAL=ColocaDatosPerfil($PRINCIPAL, $rut);
        echo $PRINCIPAL;
    }
    else if ($seccion == "medicion_encuestas") {
        $rut = $_SESSION["user_"];
        $id_empresa = $_SESSION["id_empresa"];
        $PRINCIPAL = Noticias(FuncionesTransversales(file_get_contents("views/medicion/" . $id_empresa . "_index_medicion_encuestas.html")) , 7, 2, "");
        $PRINCIPAL = BarraNavegacion($PRINCIPAL, $seccion);
        $PRINCIPAL = ColocarSliderPorNoticia($PRINCIPAL, $id_empresa);
        $PRINCIPAL = ColocaMenuSecundario($PRINCIPAL, $_SESSION["id_empresa"]);
        // BUSCA MEDICIONES PARA JEFE
        // $arreglo_row_avance=lms_medicion_por_jefe($rut, $id_empresa);
        // $PRINCIPAL = str_replace("{MIS_MEDICIONES}",$arreglo_row_avance[0], $PRINCIPAL);
        $arreglo_row_avance_pendientes = lms_medicion_encuestas_por_estado($rut, "pendientes", $id_empresa);
        $PRINCIPAL = str_replace("{MIS_MEDICIONES_ACTIVAS_PENDIENTES}", $arreglo_row_avance_pendientes[0], $PRINCIPAL);
        $arreglo_row_avance_realizadas = lms_medicion_encuestas_por_estado($rut, "realizadas", $id_empresa);
        $PRINCIPAL = str_replace("{MIS_MEDICIONES_REALIZADAS}", $arreglo_row_avance_realizadas[0], $PRINCIPAL);
        // $arreglo_row_avance=lms_medicion_por_jefe_por_estado($rut, $id_empresa);
        // $PRINCIPAL = str_replace("{MIS_MEDICIONES_INVISIBLES}",$arreglo_row_avance[0], $PRINCIPAL);
        // $PRINCIPAL=ColocaDatosPerfil($PRINCIPAL, $rut);
        echo $PRINCIPAL;
    }
        else if ($seccion == "medicion_encuestas_evaluacion") {
        $rut = $_SESSION["user_"];
        $id_empresa = $_SESSION["id_empresa"];
        $PRINCIPAL = Noticias(FuncionesTransversales(file_get_contents("views/medicion/" . $id_empresa . "_index_medicion_encuestas_evaluacion.html")) , 7, 2, "");
        $PRINCIPAL = BarraNavegacion($PRINCIPAL, $seccion);
        $PRINCIPAL = ColocarSliderPorNoticia($PRINCIPAL, $id_empresa);
        $PRINCIPAL = ColocaMenuSecundario($PRINCIPAL, $_SESSION["id_empresa"]);
        // BUSCA MEDICIONES PARA JEFE
        // $arreglo_row_avance=lms_medicion_por_jefe($rut, $id_empresa);
        // $PRINCIPAL = str_replace("{MIS_MEDICIONES}",$arreglo_row_avance[0], $PRINCIPAL);
        $arreglo_row_avance_pendientes = lms_medicion_encuestas_evaluacion_por_estado($rut, "PENDIENTE", $id_empresa);
        $PRINCIPAL = str_replace("{MIS_MEDICIONES_ACTIVAS_PENDIENTES}", $arreglo_row_avance_pendientes[0], $PRINCIPAL);
        $arreglo_row_avance_realizadas = lms_medicion_encuestas_evaluacion_por_estado($rut, "FINALIZADO", $id_empresa);
        $PRINCIPAL = str_replace("{MIS_MEDICIONES_REALIZADAS}", $arreglo_row_avance_realizadas[0], $PRINCIPAL);
        // $arreglo_row_avance=lms_medicion_por_jefe_por_estado($rut, $id_empresa);
        // $PRINCIPAL = str_replace("{MIS_MEDICIONES_INVISIBLES}",$arreglo_row_avance[0], $PRINCIPAL);
        // $PRINCIPAL=ColocaDatosPerfil($PRINCIPAL, $rut);
        echo $PRINCIPAL;
    }
    else if ($seccion == "mis_encuestas_lb") {
        $rut = $_SESSION["user_"];
        $id_empresa = $_SESSION["id_empresa"];

        $PRINCIPAL = Noticias(FuncionesTransversales(file_get_contents("views/medicion/" . $id_empresa . "_index_medicion_encuestas.html")) , 7, 2, "");
        $PRINCIPAL = BarraNavegacion($PRINCIPAL, $seccion);
        $PRINCIPAL = ColocarSliderPorNoticia($PRINCIPAL, $id_empresa);
        $PRINCIPAL = ColocaMenuSecundario($PRINCIPAL, $_SESSION["id_empresa"]);
        // BUSCA MEDICIONES PARA JEFE
        // $arreglo_row_avance=lms_medicion_por_jefe($rut, $id_empresa);
        // $PRINCIPAL = str_replace("{MIS_MEDICIONES}",$arreglo_row_avance[0], $PRINCIPAL);
        $arreglo_row_avance_pendientes = lms_medicion_encuestas_lb_por_estado($rut, "PENDIENTE", $id_empresa);
        //echo "hola"; print_r($_SESSION);
        if($arreglo_row_avance_pendientes[1]>0){$tit_pendientes="    <div class='alert alert-warning' role='alert'>
        <h4 class='alert-heading-bold'>Encuestas Pendientes de Realizar</h4>
    </div>   ";} else {$tit_pendientes="";}
        $PRINCIPAL = str_replace("{MIS_MEDICIONES_ACTIVAS_PENDIENTES}", $arreglo_row_avance_pendientes[0], $PRINCIPAL);

        $arreglo_row_avance_realizadas = lms_medicion_encuestas_lb_por_estado($rut, "FINALIZADO", $id_empresa);
        if($arreglo_row_avance_realizadas[1]>0){$tit_realizadas="    <div class='alert alert-success' role='alert'>
        <h4 class='alert-heading-bold'>Encuestas Realizadas</h4>
    </div>   ";} else {$tit_realizadas="";}

        $PRINCIPAL = str_replace("{MIS_MEDICIONES_REALIZADAS}", $arreglo_row_avance_realizadas[0], $PRINCIPAL);

        $PRINCIPAL = str_replace("{TITULO_PENDIENTES}", $tit_pendientes, $PRINCIPAL);
        $PRINCIPAL = str_replace("{TITULO_REALIZADAS}", $tit_realizadas, $PRINCIPAL);


        // $arreglo_row_avance=lms_medicion_por_jefe_por_estado($rut, $id_empresa);
        // $PRINCIPAL = str_replace("{MIS_MEDICIONES_INVISIBLES}",$arreglo_row_avance[0], $PRINCIPAL);
        // $PRINCIPAL=ColocaDatosPerfil($PRINCIPAL, $rut);
        echo $PRINCIPAL;
    }
    else if ($seccion == "medicion_preguntas") {
        $rut = $_SESSION["user_"];
        $id_empresa = $_SESSION["id_empresa"];
        $idm = $_GET["idm"];
        $fecha = $_GET["fecha"];
        $rutcol = $_GET["rutcol"];
        // echo "rut $rut, id_empresa $id_empresa, idm $idm, fecha $fecha";
        $PRINCIPAL = Noticias(FuncionesTransversales(file_get_contents("views/medicion/" . $id_empresa . "_index_medicion_preguntas.html")) , 7, 2, "");
        $PRINCIPAL = BarraNavegacion($PRINCIPAL, $seccion);
        $PRINCIPAL = ColocarSliderPorNoticia($PRINCIPAL, $id_empresa);
        $PRINCIPAL = ColocaMenuSecundario($PRINCIPAL, $_SESSION["id_empresa"]);
        // BUSCA     MEDICIONES PARA JEFE
        $arreglo_row_avance = lms_medicion_por_jefe_pregunta($rut, $rutcol, $idm, $fecha, $id_empresa);
        // echo "seccion==medicion_preguntas";        echo "<pre>";        print_r($arreglo_row_avance);        exit();
        $id_encuesta_array = MedBuscaIdEncuestraMed($idm, $id_empresa);
        $id_medicion = $idm;
        // print_r($id_encuesta_array);
        // echo "<br /><br />$id_medicion, $rutcol";
        $id_encuesta = $id_encuesta_array[0]->id_encuesta;
        $PRINCIPAL = str_replace("{MIS_MEDICIONES}", "mis med", $PRINCIPAL);
        $PRINCIPAL = str_replace("{ROW_PREGUNTAS}", $arreglo_row_avance, $PRINCIPAL);
        $PRINCIPAL = str_replace("{RUT_COLABORADOR}", $rutcol, $PRINCIPAL);
        $PRINCIPAL = str_replace("{ID_ENCUESTA}", $id_encuesta, $PRINCIPAL);
        $PRINCIPAL = str_replace("{ID_MEDICION}", $id_medicion, $PRINCIPAL);
        $PRINCIPAL = str_replace("{FECHA}", $fecha, $PRINCIPAL);
        $PRINCIPAL = ColocaDatosPerfil($PRINCIPAL, $rutcol);
        echo $PRINCIPAL;
    }
    else if ($seccion == "medicion_encuestas_preguntas") {
        $rut = $_SESSION["user_"];
        $id_empresa = $_SESSION["id_empresa"];
        $idm = $_GET["idm"];
        $fecha = $_GET["fecha"];
        $rutcol = $_GET["rutcol"];
        $tipo = $_GET["tipo"];
        if ($rutcol == "") {
            $rutcol = $rut;
        }
        if ($tipo == "clima") {
            $PRINCIPAL = FuncionesTransversales(file_get_contents("views/medicion/" . $id_empresa . "_index_medicion_encuestas_preguntas_clima.html"));
        }
        else {
            $PRINCIPAL = FuncionesTransversales(file_get_contents("views/medicion/" . $id_empresa . "_index_medicion_encuestas_preguntas.html"));
        }
        // echo "rut $rut, id_empresa $id_empresa, idm $idm, fecha $fecha, rutcol $rutcol";
        $PRINCIPAL = BarraNavegacion($PRINCIPAL, $seccion);
        $PRINCIPAL = ColocarSliderPorNoticia($PRINCIPAL, $id_empresa);
        $PRINCIPAL = ColocaMenuSecundario($PRINCIPAL, $_SESSION["id_empresa"]);
        // BUSCA     MEDICIONES PARA JEFE
        $arreglo_row_avance = lms_medicion_por_jefe_pregunta($rut, $rutcol, $idm, $fecha, $id_empresa);
        // echo "seccion==medicion_preguntas";
        // echo "<pre>";        print_r($arreglo_row_avance);
        $id_encuesta_array = MedBuscaIdEncuestraMed($idm, $id_empresa);
        $id_medicion = $idm;
        // print_r($id_encuesta_array);
        // echo "<br /><br />$id_medicion, $rutcol";
        $id_encuesta = $id_encuesta_array[0]->id_encuesta;
        $array_med = DatosMedicion($idm, $id_empresa);
        $url = "?sw=medicion";
        if ($tipo == "clima") {
            $url = "?sw=medicion_clima";
        }
        $PRINCIPAL = str_replace("{TITULO_MEDICION}", utf8_encode($array_med[0]->nombre) , $PRINCIPAL);
        $PRINCIPAL = str_replace("{DESCRIPCION_MEDICION}", utf8_encode($array_med[0]->descripcion) , $PRINCIPAL);
        $PRINCIPAL = str_replace("{URL}", ($url) , $PRINCIPAL);
        $PRINCIPAL = str_replace("{MIS_MEDICIONES}", "mis med", $PRINCIPAL);
        $PRINCIPAL = str_replace("{ROW_PREGUNTAS}", $arreglo_row_avance, $PRINCIPAL);
        $PRINCIPAL = str_replace("{RUT_COLABORADOR}", $rutcol, $PRINCIPAL);
        $PRINCIPAL = str_replace("{ID_ENCUESTA}", $id_encuesta, $PRINCIPAL);
        $PRINCIPAL = str_replace("{ID_MEDICION}", $id_medicion, $PRINCIPAL);
        $PRINCIPAL = str_replace("{FECHA}", $fecha, $PRINCIPAL);
        $PRINCIPAL = ColocaDatosPerfil($PRINCIPAL, $rutcol);
        echo $PRINCIPAL;
    }
    else if($seccion=="MuestraBloqueOpcion"){

    $tipo=$_POST["tipo"];
    $arreglo_row_opcion1 = lms_medicion_por_pregunta_lb_opcion($tipo, "", "", 12, $fecha, 77);
    echo $arreglo_row_opcion1;


    }
        else if($seccion=="OcultaBloqueOpcion"){

        //ececho date("H:i:s");
        echo "";
        }

   else if ($seccion == "medicion_encuestas_preguntas_lb") {
        $rut = $_SESSION["user_"];
        $id_empresa = $_SESSION["id_empresa"];
        $idm = $_GET["idm"];
        $fecha = $_GET["fecha"];
        $rutcol = $_GET["rutcol"];
        $tipo = $_GET["tipo"];

        if ($rutcol == "") {
            $rutcol = $rut;
        }

        $PRINCIPAL = FuncionesTransversales(file_get_contents("views/medicion/" . $id_empresa . "_index_medicion_encuestas_preguntas_lb.html"));
        $ARRAY_ENC_FRONT=datos_Encuesta_front_lb($idm) ;

        //print_r($ARRAY_ENC_FRONT);
       // echo "rut $rut, id_empresa $id_empresa, idm $idm, fecha $fecha, rutcol $rutcol";

        $PRINCIPAL = BarraNavegacion($PRINCIPAL, $seccion);
        $PRINCIPAL = ColocarSliderPorNoticia($PRINCIPAL, $id_empresa);
        $PRINCIPAL = ColocaMenuSecundario($PRINCIPAL, $_SESSION["id_empresa"]);
        // BUSCA     MEDICIONES PARA JEFE
        $arreglo_row_preguntageneral = lms_medicion_por_pregunta_lb($rut, $rutcol, $idm, $fecha, $id_empresa);
       //echo "<br>arreglo_row_preguntageneral<br>"; print_r($arreglo_row_preguntageneral);exit();
        $arreglo_row_opcion1 = lms_medicion_por_pregunta_lb_opcion("opcion1", $rut, $rutcol, $idm, $fecha, $id_empresa);
        $arreglo_row_opcion2 = lms_medicion_por_pregunta_lb_opcion("opcion2",$rut, $rutcol, $idm, $fecha, $id_empresa);


        // echo "seccion==medicion_preguntas";
        // echo "<pre>";        print_r($arreglo_row_avance);

        $id_encuesta_array = MedBuscaIdEncuestraMed($idm, $id_empresa);
        $id_medicion = $idm;
        //print_r($id_encuesta_array);
        // echo "<br /><br />$id_medicion, $rutcol";
        $id_encuesta = $id_encuesta_array[0]->id_encuesta;
        $array_med = DatosMedicion($idm, $id_empresa);
        $url = "?sw=medicion";
        $comentario=BuscaComentarioMedicionLB($id_empresa, $rut, $idm);

   //print_r($comentario);

        $PRINCIPAL = str_replace("{IMAGES}", utf8_encode($ARRAY_ENC_FRONT[0]->imagensuperior), $PRINCIPAL);
        $PRINCIPAL = str_replace("{DESCRIPCION_MEDICION}", utf8_encode($ARRAY_ENC_FRONT[0]->bajada_titulo), $PRINCIPAL);


        $PRINCIPAL = str_replace("{COMENTARIO}", utf8_encode($comentario), $PRINCIPAL);
        $PRINCIPAL = str_replace("{TITULO_MEDICION}", utf8_encode($array_med[0]->nombre) , $PRINCIPAL);
        $PRINCIPAL = str_replace("{TITULO_MEDICION}", utf8_encode($array_med[0]->nombre) , $PRINCIPAL);
        $PRINCIPAL = str_replace("{DESCRIPCION_MEDICION}", utf8_encode($array_med[0]->descripcion) , $PRINCIPAL);
        $PRINCIPAL = str_replace("{URL}", ($url) , $PRINCIPAL);
        $PRINCIPAL = str_replace("{MIS_MEDICIONES}", "mis med", $PRINCIPAL);
        $PRINCIPAL = str_replace("{ROW_PREGUNTAS}", $arreglo_row_preguntageneral, $PRINCIPAL);

        $PRINCIPAL = str_replace("{ROW_PREGUNTAS_OPCION1}", $arreglo_row_opcion1, $PRINCIPAL);
        $PRINCIPAL = str_replace("{ROW_PREGUNTAS_OPCION2}", $arreglo_row_opcion2, $PRINCIPAL);

        $PRINCIPAL = str_replace("{RUT_COLABORADOR}", $rutcol, $PRINCIPAL);
        $PRINCIPAL = str_replace("{ID_ENCUESTA}", $id_encuesta, $PRINCIPAL);
        $PRINCIPAL = str_replace("{ID_MEDICION}", $id_medicion, $PRINCIPAL);
        $PRINCIPAL = str_replace("{FECHA}", $fecha, $PRINCIPAL);
        $PRINCIPAL = ColocaDatosPerfil($PRINCIPAL, $rutcol);
        echo $PRINCIPAL;
    }
     else if ($seccion == "medicion_encuestas_evaluacion_preguntas_lb") {
        $rut = $_SESSION["user_"];
        $id_empresa = $_SESSION["id_empresa"];
        $idm = $_GET["idm"];
        $fecha = $_GET["fecha"];
        $rutcol = $_GET["rutcol"];
        $tipo = $_GET["tipo"];

        if ($rutcol == "") {
            $rutcol = $rut;
        }
         $cuenta_preguntas_med_enc=CuentaPreguntasMedEnc($idm, $id_empresa);
        $PRINCIPAL = FuncionesTransversales(file_get_contents("views/medicion/" . $id_empresa . "_index_medicion_encuestas_evaluacion_preguntas_lb.html"));
        $ARRAY_ENC_FRONT=datos_Encuesta_front_lb($idm) ;

        //print_r($ARRAY_ENC_FRONT);
       // echo "rut $rut, id_empresa $id_empresa, idm $idm, fecha $fecha, rutcol $rutcol";

        $PRINCIPAL = BarraNavegacion($PRINCIPAL, $seccion);
        $PRINCIPAL = ColocarSliderPorNoticia($PRINCIPAL, $id_empresa);
        $PRINCIPAL = ColocaMenuSecundario($PRINCIPAL, $_SESSION["id_empresa"]);
        // BUSCA     MEDICIONES PARA JEFE
        $arreglo_row_preguntageneral    = lms_medicion_por_pregunta_lb($rut, $rutcol, $idm, $fecha, $id_empresa);
       //echo "<br>arreglo_row_preguntageneral<br>"; print_r($arreglo_row_preguntageneral);exit();
        $arreglo_row_opcion1            = lms_medicion_por_pregunta_lb_opcion("opcion1", $rut, $rutcol, $idm, $fecha, $id_empresa);
        $arreglo_row_opcion2            = lms_medicion_por_pregunta_lb_opcion("opcion2",$rut, $rutcol, $idm, $fecha, $id_empresa);
                $cuenta_preguntas_med_enc=CuentaPreguntasMedEnc($idm, $id_empresa);
    $cuenta_preguntas_respondidas_med_enc=CuentaPreguntasRespMedEnc($idm, $id_empresa);
            $cuenta_preguntas_med_enc=CuentaPreguntasMedEnc($idm, $id_empresa);
        //echo   "cuenta_preguntas_med_enc $cuenta_preguntas_med_enc, res $cuenta_preguntas_respondidas_med_enc";
        // echo "seccion==medicion_preguntas";
        // echo "<pre>";        print_r($arreglo_row_avance);
        if($cuenta_preguntas_respondidas_med_enc>=$cuenta_preguntas_med_enc){
    echo "<script>location.href='?sw=medicion_encuestas_evaluacion_preguntas_lb_res&idm=".$idm."&sa=1';</script>";
        }

        // echo "seccion==medicion_preguntas";
        // echo "<pre>";        print_r($arreglo_row_avance);

        $id_encuesta_array = MedBuscaIdEncuestraMed($idm, $id_empresa);
        $id_medicion = $idm;
        //print_r($id_encuesta_array);
        // echo "<br /><br />$id_medicion, $rutcol";
        $id_encuesta = $id_encuesta_array[0]->id_encuesta;
        $array_med = DatosMedicion($idm, $id_empresa);
        $url = "?sw=medicion";
        $comentario=BuscaComentarioMedicionLB($id_empresa, $rut, $idm);

        //print_r($comentario);

        $PRINCIPAL = str_replace("{IMAGES}", utf8_encode($ARRAY_ENC_FRONT[0]->imagensuperior), $PRINCIPAL);
        $PRINCIPAL = str_replace("{DESCRIPCION_MEDICION}", utf8_encode($ARRAY_ENC_FRONT[0]->bajada_titulo), $PRINCIPAL);


        $PRINCIPAL = str_replace("{COMENTARIO}", utf8_encode($comentario), $PRINCIPAL);
        $PRINCIPAL = str_replace("{TITULO_MEDICION}", utf8_encode($array_med[0]->nombre) , $PRINCIPAL);
        $PRINCIPAL = str_replace("{TITULO_MEDICION}", utf8_encode($array_med[0]->nombre) , $PRINCIPAL);
        $PRINCIPAL = str_replace("{DESCRIPCION_MEDICION}", utf8_encode($array_med[0]->descripcion) , $PRINCIPAL);
        $PRINCIPAL = str_replace("{URL}", ($url) , $PRINCIPAL);
        $PRINCIPAL = str_replace("{MIS_MEDICIONES}", "mis med", $PRINCIPAL);
        $PRINCIPAL = str_replace("{ROW_PREGUNTAS}", $arreglo_row_preguntageneral, $PRINCIPAL);

        $PRINCIPAL = str_replace("{ROW_PREGUNTAS_OPCION1}", $arreglo_row_opcion1, $PRINCIPAL);
        $PRINCIPAL = str_replace("{ROW_PREGUNTAS_OPCION2}", $arreglo_row_opcion2, $PRINCIPAL);
        $cuenta_preg    =   CuentaPreguntasMedEnc($id_medicion, $id_empresa);

        $PRINCIPAL = str_replace("{CUENTAPREGUNTA}", $cuenta_preg, $PRINCIPAL);
        $PRINCIPAL = str_replace("{RUT_COLABORADOR}", $rutcol, $PRINCIPAL);
        $PRINCIPAL = str_replace("{ID_ENCUESTA}", $id_encuesta, $PRINCIPAL);
        $PRINCIPAL = str_replace("{ID_MEDICION}", $id_medicion, $PRINCIPAL);
        $PRINCIPAL = str_replace("{FECHA}", $fecha, $PRINCIPAL);
        $PRINCIPAL = ColocaDatosPerfil($PRINCIPAL, $rutcol);
        echo $PRINCIPAL;
    }

     else if ($seccion == "medicion_encuestas_evaluacion_preguntas_lb_res") {
        $rut = $_SESSION["user_"];
        $id_empresa = $_SESSION["id_empresa"];
        $idm = $_GET["idm"];
        $fecha = $_GET["fecha"];
        $rutcol = $_GET["rutcol"];
        $tipo = $_GET["tipo"];

        if ($rutcol == "") {
            $rutcol = $rut;
        }
         $cuenta_preguntas_med_enc=CuentaPreguntasMedEnc($idm, $id_empresa);
        $PRINCIPAL = FuncionesTransversales(file_get_contents("views/medicion/" . $id_empresa . "_index_medicion_encuestas_evaluacion_preguntas_lb_res.html"));
        $ARRAY_ENC_FRONT=datos_Encuesta_front_lb($idm) ;

        //print_r($ARRAY_ENC_FRONT);
       // echo "rut $rut, id_empresa $id_empresa, idm $idm, fecha $fecha, rutcol $rutcol";
        $resultado_final=Resultado_encuestas_evaluacion_avg($rut, $id_empresa,$idm );
                $PRINCIPAL = str_replace("{PROMEDIO}", round($resultado_final), $PRINCIPAL);

        $PRINCIPAL = BarraNavegacion($PRINCIPAL, $seccion);
        $PRINCIPAL = ColocarSliderPorNoticia($PRINCIPAL, $id_empresa);
        $PRINCIPAL = ColocaMenuSecundario($PRINCIPAL, $_SESSION["id_empresa"]);
        // BUSCA     MEDICIONES PARA JEFE
        $arreglo_row_preguntageneral    = lms_medicion_por_pregunta_lb($rut, $rutcol, $idm, $fecha, $id_empresa);
       //echo "<br>arreglo_row_preguntageneral<br>"; print_r($arreglo_row_preguntageneral);exit();
        $arreglo_row_opcion1            = lms_medicion_por_pregunta_lb_opcion("opcion1", $rut, $rutcol, $idm, $fecha, $id_empresa);
        $arreglo_row_opcion2            = lms_medicion_por_pregunta_lb_opcion("opcion2",$rut, $rutcol, $idm, $fecha, $id_empresa);


        // echo "seccion==medicion_preguntas";
        // echo "<pre>";        print_r($arreglo_row_avance);

        $id_encuesta_array = MedBuscaIdEncuestraMed($idm, $id_empresa);
        $id_medicion = $idm;
        //print_r($id_encuesta_array);
        // echo "<br /><br />$id_medicion, $rutcol";
        $id_encuesta = $id_encuesta_array[0]->id_encuesta;
        $array_med = DatosMedicion($idm, $id_empresa);
        $url = "?sw=medicion";
        $comentario=BuscaComentarioMedicionLB($id_empresa, $rut, $idm);

        //print_r($comentario);

        $PRINCIPAL = str_replace("{IMAGES}", utf8_encode($ARRAY_ENC_FRONT[0]->imagensuperior), $PRINCIPAL);
        $PRINCIPAL = str_replace("{DESCRIPCION_MEDICION}", utf8_encode($ARRAY_ENC_FRONT[0]->bajada_titulo), $PRINCIPAL);


        $PRINCIPAL = str_replace("{COMENTARIO}", utf8_encode($comentario), $PRINCIPAL);
        $PRINCIPAL = str_replace("{TITULO_MEDICION}", utf8_encode($array_med[0]->nombre) , $PRINCIPAL);
        $PRINCIPAL = str_replace("{TITULO_MEDICION}", utf8_encode($array_med[0]->nombre) , $PRINCIPAL);
        $PRINCIPAL = str_replace("{DESCRIPCION_MEDICION}", utf8_encode($array_med[0]->descripcion) , $PRINCIPAL);
        $PRINCIPAL = str_replace("{URL}", ($url) , $PRINCIPAL);
        $PRINCIPAL = str_replace("{MIS_MEDICIONES}", "mis med", $PRINCIPAL);
        $PRINCIPAL = str_replace("{ROW_PREGUNTAS}", $arreglo_row_preguntageneral, $PRINCIPAL);

        $PRINCIPAL = str_replace("{ROW_PREGUNTAS_OPCION1}", $arreglo_row_opcion1, $PRINCIPAL);
        $PRINCIPAL = str_replace("{ROW_PREGUNTAS_OPCION2}", $arreglo_row_opcion2, $PRINCIPAL);
        $cuenta_preg    =   CuentaPreguntasMedEnc($id_medicion, $id_empresa);

        $PRINCIPAL = str_replace("{CUENTAPREGUNTA}", $cuenta_preg, $PRINCIPAL);
        $PRINCIPAL = str_replace("{RUT_COLABORADOR}", $rutcol, $PRINCIPAL);
        $PRINCIPAL = str_replace("{ID_ENCUESTA}", $id_encuesta, $PRINCIPAL);
        $PRINCIPAL = str_replace("{ID_MEDICION}", $id_medicion, $PRINCIPAL);
        $PRINCIPAL = str_replace("{FECHA}", $fecha, $PRINCIPAL);
        $PRINCIPAL = ColocaDatosPerfil($PRINCIPAL, $rutcol);
        echo $PRINCIPAL;
    }

    else if ($seccion == "home_bci_capacitacion") {  //echo "hola";sleep(2);
        echo "<script>location.href='?sw=home_bci_new';</script>";
        exit();
        // echo  "home_bci_capacitacion sesion";
        // print_r($_SESSION);
    }
    else if ($seccion == "home_bci_intnova") {
        $im = $_GET["im"];
        $rut = $_SESSION["user_"];
        $back_home = $_GET["back_home"];
        $id_programa = "bci_intnova";
        if ($back_home <> '') {
            echo "<script>
                location.href='?sw=malla3&nivel=" . $datos_nivel[0]->idorden . "&mod=" . $id_curso . "&id_template=" . $todoMalla . "&im=" . $im . "&back_home=" . $todoMalla[0]->template . "';
                </script>";
        }
        // $vv=$_GET["vv"];
        // $viovideo_visto=0;
        // $viovideoarray=vio_vide_intro($rut, "home_canales_digitalesp", $id_empresa);
        // print_r($viovideoarray);
        // $cuentaVideoArray=$viovideoarray[0]->cuenta;
        // if($cuentaVideoArray>0){$viovideo_visto=1;}
        // echo "vv $vv , viovideo_visto $viovideo_visto";
        // if($vv==1 and $viovideo_visto==0){    inserta_vio_video($rut, "home_canales_digitalesp", $id_empresa);}
        $id_empresa = $_SESSION["id_empresa"];
        $PRINCIPAL = (FuncionesTransversales(file_get_contents("views/templates/bci_intnova.html")));
        $PRINCIPAL = BarraNavegacion($PRINCIPAL, $seccion);
        $PRINCIPAL = ColocaMenuSecundario($PRINCIPAL, $_SESSION["id_empresa"]);
        $PRINCIPAL = str_replace("{ID_MALLA_ENCODEADA}", $im, $PRINCIPAL);
        $PRINCIPAL = str_replace("{RUT}", utf8_encode($rut) , $PRINCIPAL);
        $PRINCIPAL = str_replace("{CLAVE_RUT}", substr($rut, 0, 4) , $PRINCIPAL);
        $PRINCIPAL = ColocaDatosPerfil($PRINCIPAL, $rut);
        $PRINCIPAL = BuscaCursosPrograma($PRINCIPAL, $id_programa, $id_empresa);
        echo $PRINCIPAL;
    }
    else if ($seccion == "home_bci_new") {
    	
			//echo "<h1>HomeBciNew ".date("Y-m-d H:i:s")."<br>";
      //session_start();
    	//print_r($_SESSION);
    	//exit();
					ControlDotacionInsertaAccesoLogin($_SESSION["user_"], $email, $response, $response->email, "Login home_bci_new",  $_SESSION,$_POST["idt"]);

    	
        echo "<script>location.href='?sw=potencial_landing';</script>";exit();
       
    }
    
 
    else if ($seccion == "home_bci_new2") {
        // echo "<script>location.href='?sw=com_mp_personal&destroysess=1';</script>";exit();
        // echo  "home_bci_capacitacion sesion";
        // print_r($_SESSION);
        // sleep(5);
        $_SESSION["id_empresa"] = 62;
        $rut = $_SESSION["user_"];
        $id_empresa = $_SESSION["id_empresa"];
        $_SESSION["malla"] = "";
        // echo "$rut $id_empresa";
        $PRINCIPAL = FuncionesTransversales(file_get_contents("views/templates/bcistation/index.html"));
        $PRINCIPAL = ColocaIndicadoresVarios($PRINCIPAL);
        $PRINCIPAL = BloqueMovimientosInternos($PRINCIPAL, "", $id_empresa);
        $PRINCIPAL = BarraNavegacion($PRINCIPAL, $seccion);
        $PRINCIPAL = ColocarSliderPorNoticia($PRINCIPAL, $id_empresa);
        $PRINCIPAL = ColocaMenuSecundario($PRINCIPAL, $_SESSION["id_empresa"]);
        $arreglo_row_bcicoins = lms_busca_puntos_reportes($rut, $id_empresa);
        $PRINCIPAL = str_replace("{ROW_BCI_COINS_CARTOLA}", $arreglo_row_bcicoins[0], $PRINCIPAL);
        $arreglo_row_bcicursosrealizados = lms_busca_cursos_realizados($rut, $id_empresa);
        $PRINCIPAL = str_replace("{ROW_BCI_MIS_CURSOS_REALIZADOS}", $arreglo_row_bcicursosrealizados[0], $PRINCIPAL);
        $PRINCIPAL = str_replace("{SUMATOTAL_PUNTOS_REPORTES}", $arreglo_row_bcicoins[1], $PRINCIPAL);
        $arreglo_oferta_abierta = lms_busca_posibles_postulaciones($rut, $id_empresa);
        if ($arreglo_oferta_abierta[0]->id > 0) {
            // echo "si";
            $PRINCIPAL = str_replace("{URLINSCRIBETE}", '?sw=home_bci_inscribete', $PRINCIPAL);
            $PRINCIPAL = str_replace("{IMAGENINSCRIBETE}", "", $PRINCIPAL);
        }
        else {
            // echo "no";
            $PRINCIPAL = str_replace("{URLINSCRIBETE}", "", $PRINCIPAL);
            $PRINCIPAL = str_replace("{IMAGENINSCRIBETE}", " ", $PRINCIPAL);
        }
        //    $esta_cotalker=estacotalker($rut);
        //    if($esta_cotalker[0]->cuenta==1)
        $boton1 = "<div class='col-xs-12 col-lg-3  col-md-3'>
                            <a  href='?sw=home_bci_checkin'><img src='img/Bci_boton_tusala.png' alt=' class='img-rounded' style='visibility: visible; opacity: 1; display: block;'></a>
                        </div>";
        $boton2 = "<div class='col-xs-12 col-lg-3  col-md-3'>
                            <a  href='{URLINSCRIBETE}'><img src='img/Bci_boton_inscribete.png' alt='' class='img-rounded' style='visibility: visible; opacity: 1; display: block;'></a>
                        </div>";
        $arrayEmail = BuscaEmail($rut);
        $email_base64 = base64_encode($arrayEmail[0]->email);
        $word = $arrayEmail[0]->email . $secret;
        // echo "<br />word $word<br />";
        $secret = "0rcywyht45kuydf2svx4ctxzll1yr7gby8q0wz51";
        $word = $arrayEmail[0]->email . $secret;
        $token_hash = hash('sha256', $word);
        // echo $token_hash;
        $boton3 = "<div class='col-xs-12 col-lg-3  col-md-3'>
    <a target='_blank' href='https://www.cotalker.com/auth/local?source=bcicapacitacion&email=" . $email_base64 . "&token=" . $token_hash . "'>
    <img src='img/Bci_boton_buddy.png' alt='' class='img-rounded' style='visibility: visible; opacity: 1; display: block;'></a>
    </div>";
        $boton4 = "<div class='col-xs-12 col-lg-34  col-md-3'>
    <a target='_blank' href='https://www.compartebci.cl'><img src='img/Bci_boton_comunidad.png' alt='' class='img-rounded' style='visibility: visible; opacity: 1; display: block;'></a>
    </div>";
        $PRINCIPAL = str_replace("{BOTON1}", $boton1, $PRINCIPAL);
        $PRINCIPAL = str_replace("{BOTON2}", $boton2, $PRINCIPAL);
        $PRINCIPAL = str_replace("{BOTON3}", $boton3, $PRINCIPAL);
        $PRINCIPAL = str_replace("{BOTON4}", $boton4, $PRINCIPAL);
        // print_r($arreglo_oferta_abierta);
        // ActualizaTablatblLmsReportePorRut($rut);
        // BUSCA LISTA PROGRAMAS
        $arreglo_row_avance = lms_integracion_programas($rut, $id_empresa, "");
        $PRINCIPAL = str_replace("{AVANCEMALLATOTAL}", $arreglo_row_avance[1], $PRINCIPAL);
        $PRINCIPAL = str_replace("{ROW_LISTA_PROGRAMAS_OBLIGATORIOS}", $arreglo_row_avance[0], $PRINCIPAL);
        // BUSCA LISTA PROGRAMAS PENDIENTES
        $arreglo_row_avance = lms_integracion_programas_estado($rut, $id_empresa, "", "PENDIENTE");
        $PRINCIPAL = str_replace("{ROW_LISTA_PROGRAMAS_OBLIGATORIOS_PENDIENTES}", $arreglo_row_avance[0], $PRINCIPAL);
        // BUSCA LISTA PROGRAMAS FINALIZADOS
        $arreglo_row_avance = lms_integracion_programas_estado($rut, $id_empresa, "", "FINALIZADO");
        $PRINCIPAL = str_replace("{ROW_LISTA_PROGRAMAS_OBLIGATORIOS_FINALIZADOS}", $arreglo_row_avance[0], $PRINCIPAL);
        // BUSCA LISTA PROGRAMAS OPCIONALES
        $arreglo_row_avance_opcional = lms_integracion_programas($rut, $id_empresa, "opcional");
        $PRINCIPAL = str_replace("{ROW_LISTA_PROGRAMAS_OPCIONAL}", $arreglo_row_avance_opcional[0], $PRINCIPAL);
        // BUSCA LISTA CURSOS ESPECIALES (PRESENCIAL CON PARTE ELEARNING)
        $arreglo_row_cursos_especiales = lms_cursos_especiales($rut, $id_empresa, "", "", "4");
        $PRINCIPAL = str_replace("{ROW_LISTA_CURSOS_ESPECIALES}", $arreglo_row_cursos_especiales[0], $PRINCIPAL);
        // BUSCA LISTA CURSOS PRESENCIALES
        $arreglo_row_cursos_especiales = lms_cursos_especiales($rut, $id_empresa, "", "", "2");
        $PRINCIPAL = str_replace("{ROW_LISTA_CURSOS_PRESENCIALES}", $arreglo_row_cursos_especiales[0], $PRINCIPAL);
        $PRINCIPAL = str_replace("{SECCION_PREGUNTA}", ColocaBloquePreguntaPorObjeto($datos_objeto[0]->id, $rut, 4) , $PRINCIPAL);
        $PRINCIPAL = str_replace("{ROW_PESTANAS_LI_FOCOS}", ColocaPestanasFocosHome($rut, $id_empresa) , $PRINCIPAL);
        $PRINCIPAL = ColocaDatosPerfil($PRINCIPAL, $rut);
        echo $PRINCIPAL;
    }
    else if ($seccion == "home_bci_new_4") {
        // echo "<script>location.href='?sw=com_mp_personal&destroysess=1';</script>";exit();
        // echo  "home_bci_capacitacion sesion";
        // print_r($_SESSION);
        // sleep(5);
        $_SESSION["id_empresa"] = 62;
        $rut = $_SESSION["user_"];
        $id_empresa = $_SESSION["id_empresa"];
        $_SESSION["malla"] = "";
        // echo "$rut $id_empresa";
        $PRINCIPAL = Noticias(FuncionesTransversales(file_get_contents("views/templates/bci_2018/index4.html")) , 7, 2, "");
        // $PRINCIPAL=ColocaIndicadoresVarios($PRINCIPAL);
        $PRINCIPAL = BloqueMovimientosInternos($PRINCIPAL, "", $id_empresa);
        $PRINCIPAL = BarraNavegacion($PRINCIPAL, $seccion);
        $PRINCIPAL = ColocarSliderPorNoticia($PRINCIPAL, $id_empresa);
        $PRINCIPAL = ColocaMenuSecundario($PRINCIPAL, $_SESSION["id_empresa"]);
        $arreglo_row_bcicoins = lms_busca_puntos_reportes($rut, $id_empresa);
        $PRINCIPAL = str_replace("{ROW_BCI_COINS_CARTOLA}", $arreglo_row_bcicoins[0], $PRINCIPAL);
        $arreglo_row_bcicursosrealizados = lms_busca_cursos_realizados($rut, $id_empresa);
        $PRINCIPAL = str_replace("{ROW_BCI_MIS_CURSOS_REALIZADOS}", $arreglo_row_bcicursosrealizados[0], $PRINCIPAL);
        $PRINCIPAL = str_replace("{SUMATOTAL_PUNTOS_REPORTES}", $arreglo_row_bcicoins[1], $PRINCIPAL);
        $arreglo_oferta_abierta = lms_busca_posibles_postulaciones($rut, $id_empresa);
        if ($arreglo_oferta_abierta[0]->id > 0) {
            // echo "si";
            $PRINCIPAL = str_replace("{URLINSCRIBETE}", '?sw=home_bci_inscribete', $PRINCIPAL);
            $PRINCIPAL = str_replace("{IMAGENINSCRIBETE}", "", $PRINCIPAL);
        }
        else {
            // echo "no";
            $PRINCIPAL = str_replace("{URLINSCRIBETE}", "", $PRINCIPAL);
            $PRINCIPAL = str_replace("{IMAGENINSCRIBETE}", " ", $PRINCIPAL);
        }
        //    $esta_cotalker=estacotalker($rut);
        //    if($esta_cotalker[0]->cuenta==1)
        $boton1 = "<div class='col-xs-12 col-lg-3  col-md-3'>
                            <a  href='?sw=home_bci_checkin'><img src='img/Bci_boton_tusala.png' alt=' class='img-rounded' style='visibility: visible; opacity: 1; display: block;'></a>
                        </div>";
        $boton2 = "<div class='col-xs-12 col-lg-3  col-md-3'>
                            <a  href='{URLINSCRIBETE}'><img src='img/Bci_boton_inscribete.png' alt='' class='img-rounded' style='visibility: visible; opacity: 1; display: block;'></a>
                        </div>";
        $arrayEmail = BuscaEmail($rut);
        $email_base64 = base64_encode($arrayEmail[0]->email);
        $word = $arrayEmail[0]->email . $secret;
        // echo "<br />word $word<br />";
        $secret = "0rcywyht45kuydf2svx4ctxzll1yr7gby8q0wz51";
        $word = $arrayEmail[0]->email . $secret;
        $token_hash = hash('sha256', $word);
        // echo $token_hash;
        $boton3 = "<div class='col-xs-12 col-lg-3  col-md-3'>
    <a target='_blank' href='https://www.cotalker.com/auth/local?source=bcicapacitacion&email=" . $email_base64 . "&token=" . $token_hash . "'>
    <img src='img/Bci_boton_buddy.png' alt='' class='img-rounded' style='visibility: visible; opacity: 1; display: block;'></a>
    </div>";
        $boton4 = "<div class='col-xs-12 col-lg-34  col-md-3'>
    <a target='_blank' href='https://www.compartebci.cl'><img src='img/Bci_boton_comunidad.png' alt='' class='img-rounded' style='visibility: visible; opacity: 1; display: block;'></a>
    </div>";
        $PRINCIPAL = str_replace("{BOTON1}", $boton1, $PRINCIPAL);
        $PRINCIPAL = str_replace("{BOTON2}", $boton2, $PRINCIPAL);
        $PRINCIPAL = str_replace("{BOTON3}", $boton3, $PRINCIPAL);
        $PRINCIPAL = str_replace("{BOTON4}", $boton4, $PRINCIPAL);
        // print_r($arreglo_oferta_abierta);
        // ActualizaTablatblLmsReportePorRut($rut);
        // BUSCA LISTA PROGRAMAS
        $arreglo_row_avance = lms_integracion_programas($rut, $id_empresa, "");
        $PRINCIPAL = str_replace("{AVANCEMALLATOTAL}", $arreglo_row_avance[1], $PRINCIPAL);
        $PRINCIPAL = str_replace("{ROW_LISTA_PROGRAMAS_OBLIGATORIOS}", $arreglo_row_avance[0], $PRINCIPAL);
        // BUSCA LISTA PROGRAMAS PENDIENTES
        $arreglo_row_avance = lms_integracion_programas_estado($rut, $id_empresa, "", "PENDIENTE");
        $PRINCIPAL = str_replace("{ROW_LISTA_PROGRAMAS_OBLIGATORIOS_PENDIENTES}", $arreglo_row_avance[0], $PRINCIPAL);
        // echo "hola2";
        // BUSCA LISTA PROGRAMAS FINALIZADOS
        $arreglo_row_avance = lms_integracion_programas_estado($rut, $id_empresa, "", "FINALIZADO");
        $PRINCIPAL = str_replace("{ROW_LISTA_PROGRAMAS_OBLIGATORIOS_FINALIZADOS}", $arreglo_row_avance[0], $PRINCIPAL);
        // echo "hola3";
        // BUSCA LISTA PROGRAMAS OPCIONALES
        $arreglo_row_avance_opcional = lms_integracion_programas($rut, $id_empresa, "opcional");
        $PRINCIPAL = str_replace("{ROW_LISTA_PROGRAMAS_OPCIONAL}", $arreglo_row_avance_opcional[0], $PRINCIPAL);
        // echo "hola4";
        // BUSCA LISTA CURSOS ESPECIALES (PRESENCIAL CON PARTE ELEARNING)
        $arreglo_row_cursos_especiales = lms_cursos_especiales($rut, $id_empresa, "", "", "4");
        $PRINCIPAL = str_replace("{ROW_LISTA_CURSOS_ESPECIALES}", $arreglo_row_cursos_especiales[0], $PRINCIPAL);
        // BUSCA LISTA CURSOS PRESENCIALES
        //  $arreglo_row_cursos_especiales=lms_cursos_especiales($rut, $id_empresa,"","", "2");
        //  $PRINCIPAL = str_replace("{ROW_LISTA_CURSOS_PRESENCIALES}",$arreglo_row_cursos_especiales[0], $PRINCIPAL);
        // echo "hola5";
        $PRINCIPAL = str_replace("{SECCION_PREGUNTA}", ColocaBloquePreguntaPorObjeto($datos_objeto[0]->id, $rut, 4) , $PRINCIPAL);
        $PRINCIPAL = str_replace("{ROW_PESTANAS_LI_FOCOS}", ColocaPestanasFocosHome($rut, $id_empresa) , $PRINCIPAL);
        $PRINCIPAL = colocarNotificacionesEncuestasImpacto($PRINCIPAL, $id_empresa, $rut, $hoy);
        $PRINCIPAL = ColocaDatosPerfil($PRINCIPAL, $rut);
        echo $PRINCIPAL;
    }
    else if ($seccion == "home_bci_capacitacion2") {
        $_SESSION["id_empresa"] = 62;
        $rut = $_SESSION["user_"];
        $id_empresa = $_SESSION["id_empresa"];
        // echo "$rut $id_empresa";
        $PRINCIPAL = FuncionesTransversales(file_get_contents("views/templates/bcistation/index.html"));
        $PRINCIPAL = ColocaIndicadoresVarios($PRINCIPAL);
        $PRINCIPAL = BloqueMovimientosInternos($PRINCIPAL, "", $id_empresa);
        $PRINCIPAL = BarraNavegacion($PRINCIPAL, $seccion);
        $PRINCIPAL = ColocarSliderPorNoticia($PRINCIPAL, $id_empresa);
        $PRINCIPAL = ColocaMenuSecundario($PRINCIPAL, $_SESSION["id_empresa"]);
        $arreglo_row_bcicoins = lms_busca_puntos_reportes($rut, $id_empresa);
        $PRINCIPAL = str_replace("{ROW_BCI_COINS_CARTOLA}", $arreglo_row_bcicoins[0], $PRINCIPAL);
        $arreglo_row_bcicursosrealizados = lms_busca_cursos_realizados($rut, $id_empresa);
        $PRINCIPAL = str_replace("{ROW_BCI_MIS_CURSOS_REALIZADOS}", $arreglo_row_bcicursosrealizados[0], $PRINCIPAL);
        $PRINCIPAL = str_replace("{SUMATOTAL_PUNTOS_REPORTES}", $arreglo_row_bcicoins[1], $PRINCIPAL);
        $arreglo_oferta_abierta = lms_busca_posibles_postulaciones($rut, $id_empresa);
        if ($arreglo_oferta_abierta[0]->id > 0) {
            // echo "si";
            $PRINCIPAL = str_replace("{URLINSCRIBETE}", '?sw=home_bci_inscribete', $PRINCIPAL);
            $PRINCIPAL = str_replace("{IMAGENINSCRIBETE}", "", $PRINCIPAL);
        }
        else {
            // echo "no";
            $PRINCIPAL = str_replace("{URLINSCRIBETE}", "", $PRINCIPAL);
            $PRINCIPAL = str_replace("{IMAGENINSCRIBETE}", " ", $PRINCIPAL);
        }
        $esta_cotalker = estacotalker($rut);
        if ($esta_cotalker[0]->cuenta == 1) {
            $arrayEmail = BuscaEmail($rut);
            $email_base64 = base64_encode($arrayEmail[0]->email);
            $word = $arrayEmail[0]->email . $secret;
            // echo "<br />word $word<br />";
            $secret = "0rcywyht45kuydf2svx4ctxzll1yr7gby8q0wz51";
            $word = $arrayEmail[0]->email . $secret;
            $token_hash = hash('sha256', $word);
            // echo $token_hash;
            $boton3 = "<div class='col-xs-12 col-lg-4  col-md-4'>
    <a target='_blank' href='https://www.cotalker.com/auth/local?source=bcicapacitacion&email=" . $email_base64 . "&token=" . $token_hash . "'>
    <img src='img/Bci_boton_buddy.png' alt='' class='img-rounded' style='visibility: visible; opacity: 1; display: block;'></a>
    </div>";
        }
        else {
            $boton3 = "<div class='col-xs-12 col-lg-4  col-md-4'>
    <a target='_blank' href='http://compartebci.cl'><img src='img/Bci_boton_comunidad.png' alt='' class='img-rounded' style='visibility: visible; opacity: 1; display: block;'></a>
    </div>";
        }
        $PRINCIPAL = str_replace("{BOTON3}", $boton3, $PRINCIPAL);
        // print_r($arreglo_oferta_abierta);
        // ActualizaTablatblLmsReportePorRut($rut);
        $arreglo_row_avance = lms_integracion_programas_pendientes($rut, $id_empresa, "");
        $PRINCIPAL = str_replace("{AVANCEMALLATOTAL}", $arreglo_row_avance[1], $PRINCIPAL);
        $PRINCIPAL = str_replace("{SUMATOTAL_CURSOS_PENDIENTES}", $arreglo_row_avance[numcursos], $PRINCIPAL);
        $PRINCIPAL = str_replace("{ROW_LISTA_PROGRAMAS_PENDIENTES}", $arreglo_row_avance[0], $PRINCIPAL);
        // opcional
        $arreglo_row_avance_opcional = lms_integracion_programas_realizados($rut, $id_empresa);
        $PRINCIPAL = str_replace("{SUMATOTAL_CURSOS_REALIZADOS}", $arreglo_row_avance_opcional[numcursos], $PRINCIPAL);
        $PRINCIPAL = str_replace("{ROW_LISTA_PROGRAMAS_REALIZADOS}", $arreglo_row_avance_opcional[0], $PRINCIPAL);
        $PRINCIPAL = str_replace("{SECCION_PREGUNTA}", ColocaBloquePreguntaPorObjeto($datos_objeto[0]->id, $rut, 4) , $PRINCIPAL);
        $PRINCIPAL = str_replace("{ROW_PESTANAS_LI_FOCOS}", ColocaPestanasFocosHome($rut, $id_empresa) , $PRINCIPAL);
        $PRINCIPAL = ColocaDatosPerfil($PRINCIPAL, $rut);
        echo $PRINCIPAL;
    }
  else if ($seccion == "home_bci_esc_robci") {
        // echo "<script>location.href='?sw=com_mp_personal';</script>";exit();
        // echo  "home_bci_capacitacion sesion";
        // print_r($_SESSION);
        // sleep(5);
        // echo Encodear3("bci_er_br_ea");
        $_SESSION["id_empresa"] = 62;
        $rut = $_SESSION["user_"];
        $id_empresa = $_SESSION["id_empresa"];
        $_SESSION["malla"] = "";
        $id_malla = Decodear3($_GET["im"]);
        //$id_malla = "bci_escro_m1";
        $id_clasificacion = $_GET["cla"];
        $im = Encodear3($id_malla);
        $viovideo_visto = 0;
        $viovideoarray = vio_vide_intro($rut, "bci_escuela_riesgo_intro", $id_empresa);
        $cuentaVideoArray = $viovideoarray[0]->cuenta;
        if ($cuentaVideoArray > 0) {
            $viovideo_visto = 1;
        }
        $viovideoarray = vio_vide_intro($rut, "bci_escuela_riesgo_intro", $id_empresa);
        $cuentaVideoArray = $viovideoarray[0]->cuenta;
        if ($cuentaVideoArray > 0) {
            $viovideo_visto = 1;
        }
        if ($viovideo_visto == 0) {
            inserta_vio_video($rut, "bci_escuela_riesgo_intro", $id_empresa);
            $PRINCIPAL = Noticias(FuncionesTransversales(file_get_contents("views/templates/bci_escuela_riesgo_home.html")) , 7, 2, "");
            //      $PRINCIPAL=Noticias(FuncionesTransversales(file_get_contents("views/templates/bci_escuela_riesgo_home_intro.html")), 7, 2, "");
        }
        else {

          //sweetalert
        $viovideo_visto_sa = 0;
        $viovideoarray_sa = vio_vide_intro($rut, "bci_escuela_riesgo_intro_sweet_alert", $id_empresa);
        $cuentaVideoArray_sa = $viovideoarray_sa[0]->cuenta;

        $PRINCIPAL = Noticias(FuncionesTransversales(file_get_contents("views/templates/bci_escuela_riesgo_home.html")) , 7, 2, "");
           // echo "<br>cuentaVideoArray_sa $cuentaVideoArray_sa";
        if ($cuentaVideoArray_sa == 0) {
            $viovideo_visto = 1;
             $PRINCIPAL = str_replace("{SWEETALERT}", "swal(
    '¡Bienvenido a la Escuela de Riesgo Bci!',
    '¡Te invitamos a Reforzar nuestra Cultura de Riesgo! Por medio de estos mensajes iremos guiándote en tu camino de aprendizaje',
    'success'
)", $PRINCIPAL);
        inserta_vio_video($rut, "bci_escuela_riesgo_intro_sweet_alert", $id_empresa);
        } else {

                  $PRINCIPAL = str_replace("{SWEETALERT}", "", $PRINCIPAL);

        }





        }
        // echo "$rut $id_empresa";
        // $PRINCIPAL=ColocaIndicadoresVarios($PRINCIPAL);
        // $PRINCIPAL=BloqueMovimientosInternos($PRINCIPAL, "", $id_empresa);
        $PRINCIPAL = BarraNavegacion($PRINCIPAL, $seccion);
        $PRINCIPAL = ColocarSliderPorNoticia($PRINCIPAL, $id_empresa);
        $PRINCIPAL = ColocaMenuSecundario($PRINCIPAL, $_SESSION["id_empresa"]);
        $arreglo_row_bcicoins = lms_busca_puntos_reportes($rut, $id_empresa);
        $PRINCIPAL = str_replace("{ROW_BCI_COINS_CARTOLA}", $arreglo_row_bcicoins[0], $PRINCIPAL);
        $arreglo_row_bcicursosrealizados = lms_busca_cursos_realizados($rut, $id_empresa);
        $PRINCIPAL = str_replace("{ROW_BCI_MIS_CURSOS_REALIZADOS}", $arreglo_row_bcicursosrealizados[0], $PRINCIPAL);
        $PRINCIPAL = str_replace("{SUMATOTAL_PUNTOS_REPORTES}", $arreglo_row_bcicoins[1], $PRINCIPAL);
        $arreglo_oferta_abierta = lms_busca_posibles_postulaciones($rut, $id_empresa);
        $arrayEmail = BuscaEmail($rut);
        $email_base64 = base64_encode($arrayEmail[0]->email);
        $word = $arrayEmail[0]->email . $secret;
        // echo "<br />word $word<br />";
        $secret = "0rcywyht45kuydf2svx4ctxzll1yr7gby8q0wz51";
        $word = $arrayEmail[0]->email . $secret;
        $token_hash = hash('sha256', $word);
        // echo $token_hash;
        $boton3 = "https://www.cotalker.com/auth/local?source=bcicapacitacion&email=" . $email_base64 . "&token=" . $token_hash . "";
        $boton4 = "https://www.compartebci.cl";
        $PRINCIPAL = str_replace("{BOTON1}", $boton1, $PRINCIPAL);
        $PRINCIPAL = str_replace("{BOTON2}", $boton2, $PRINCIPAL);
        $PRINCIPAL = str_replace("{BOTON3}", $boton3, $PRINCIPAL);
        $PRINCIPAL = str_replace("{BOTON4}", $boton4, $PRINCIPAL);
        $arreglo_row_avance = lms_integracion_programas($rut, $id_empresa, "");
        $PRINCIPAL = str_replace("{AVANCEMALLATOTAL}", $arreglo_row_avance[1], $PRINCIPAL);
        $PRINCIPAL = str_replace("{ID_MALLA_ENCODEADA}", $_GET["im"], $PRINCIPAL);

        $PRINCIPAL = str_replace("{ROW_LISTA_PROGRAMAS_OBLIGATORIOS}", $arreglo_row_avance[0], $PRINCIPAL);
        $arreglo_row_avance_opcional = lms_integracion_programas($rut, $id_empresa, "opcional");
        $PRINCIPAL = str_replace("{ROW_LISTA_PROGRAMAS_OPCIONAL}", $arreglo_row_avance_opcional[0], $PRINCIPAL);
        $PRINCIPAL = str_replace("{SECCION_PREGUNTA}", ColocaBloquePreguntaPorObjeto($datos_objeto[0]->id, $rut, 4) , $PRINCIPAL);
        $PRINCIPAL = str_replace("{ROW_PESTANAS_LI_FOCOS}", ColocaPestanasFocosHome($rut, $id_empresa) , $PRINCIPAL);
        $PRINCIPAL = str_replace("{ID_MALLA_ENCODEADO}", $im, $PRINCIPAL);
        $PRINCIPAL = ColocaDatosPerfil($PRINCIPAL, $rut);
        echo $PRINCIPAL;
    }
    else if ($seccion == "home_bci_etica") {
        // echo "hola";
        // echo "<script>location.href='?sw=com_mp_personal';</script>";exit();
        // echo  "home_bci_capacitacion sesion";
        // print_r($_SESSION);
        // sleep(5);

        ///print_r($_POST);
                $q=$_POST["q"];
                 if($q<>''){
                     $respuesta="<strong>COMPORTAMIENTO ETICO</strong>:
                     <BR><BR>
                     Como colaboradores debemos tener un comportamiento acorde con los estándares profesionales de nuestra organización, tanto en nuestras relaciones internas como en la vinculación con accionistas, clientes, proveedores y otros grupos de interés.<br><br>Por esto, estamos llamados a actuar como dueños, obtener lo mejor de las personas, apasionarnos por el cliente y lograr objetivos ambiciosos.";
                 }   else {$respuesta="";}


        $_SESSION["id_empresa"] = 62;
        $rut = $_SESSION["user_"];
        $id_empresa = $_SESSION["id_empresa"];
        $_SESSION["malla"] = "";
        $id_malla = Decodear3($_GET["im"]);
        $id_malla = "bci_escro_m1";
        $id_clasificacion = $_GET["cla"];
        $im = Encodear3($id_malla);
        // echo "$rut $id_empresa";
        $PRINCIPAL = Noticias(FuncionesTransversales(file_get_contents("views/home/bci_etica.html")) , 7, 2, "");
        // $PRINCIPAL=ColocaIndicadoresVarios($PRINCIPAL);
        // $PRINCIPAL=BloqueMovimientosInternos($PRINCIPAL, "", $id_empresa);
        $PRINCIPAL = BarraNavegacion($PRINCIPAL, $seccion);
        $PRINCIPAL = ColocarSliderPorNoticia($PRINCIPAL, $id_empresa);
        $PRINCIPAL = ColocaMenuSecundario($PRINCIPAL, $_SESSION["id_empresa"]);
        $arreglo_row_bcicoins = lms_busca_puntos_reportes($rut, $id_empresa);
        $PRINCIPAL = str_replace("{ROW_BCI_COINS_CARTOLA}", $arreglo_row_bcicoins[0], $PRINCIPAL);
        $arreglo_row_bcicursosrealizados = lms_busca_cursos_realizados($rut, $id_empresa);
        $PRINCIPAL = str_replace("{ROW_BCI_MIS_CURSOS_REALIZADOS}", $arreglo_row_bcicursosrealizados[0], $PRINCIPAL);
        $PRINCIPAL = str_replace("{SUMATOTAL_PUNTOS_REPORTES}", $arreglo_row_bcicoins[1], $PRINCIPAL);

        $PRINCIPAL = str_replace("{BCI_ETICA_RESULTADOS_BUSCADOR}", $respuesta, $PRINCIPAL);




        $arreglo_oferta_abierta = lms_busca_posibles_postulaciones($rut, $id_empresa);
        $arrayEmail = BuscaEmail($rut);
        $email_base64 = base64_encode($arrayEmail[0]->email);
        $word = $arrayEmail[0]->email . $secret;
        // echo "<br />word $word<br />";
        $secret = "0rcywyht45kuydf2svx4ctxzll1yr7gby8q0wz51";
        $word = $arrayEmail[0]->email . $secret;
        $token_hash = hash('sha256', $word);
        // echo $token_hash;
        $boton3 = "https://www.cotalker.com/auth/local?source=bcicapacitacion&email=" . $email_base64 . "&token=" . $token_hash . "";
        $boton4 = "https://www.compartebci.cl";
        $PRINCIPAL = str_replace("{BOTON1}", $boton1, $PRINCIPAL);
        $PRINCIPAL = str_replace("{BOTON2}", $boton2, $PRINCIPAL);
        $PRINCIPAL = str_replace("{BOTON3}", $boton3, $PRINCIPAL);
        $PRINCIPAL = str_replace("{BOTON4}", $boton4, $PRINCIPAL);
        $arreglo_row_avance = lms_integracion_programas($rut, $id_empresa, "");
        $PRINCIPAL = str_replace("{AVANCEMALLATOTAL}", $arreglo_row_avance[1], $PRINCIPAL);
        $PRINCIPAL = str_replace("{ROW_LISTA_PROGRAMAS_OBLIGATORIOS}", $arreglo_row_avance[0], $PRINCIPAL);
        $arreglo_row_avance_opcional = lms_integracion_programas($rut, $id_empresa, "opcional");
        $PRINCIPAL = str_replace("{ROW_LISTA_PROGRAMAS_OPCIONAL}", $arreglo_row_avance_opcional[0], $PRINCIPAL);
        $PRINCIPAL = str_replace("{SECCION_PREGUNTA}", ColocaBloquePreguntaPorObjeto($datos_objeto[0]->id, $rut, 4) , $PRINCIPAL);
        $PRINCIPAL = str_replace("{ROW_PESTANAS_LI_FOCOS}", ColocaPestanasFocosHome($rut, $id_empresa) , $PRINCIPAL);
        $PRINCIPAL = str_replace("{ID_MALLA_ENCODEADO}", $im, $PRINCIPAL);
        $PRINCIPAL = ColocaDatosPerfil($PRINCIPAL, $rut);
        echo $PRINCIPAL;
    }
   else if ($seccion == "home_bci_etica_ok") {
        // echo "hola";
        // echo "<script>location.href='?sw=com_mp_personal';</script>";exit();
        // echo  "home_bci_capacitacion sesion";
        // print_r($_SESSION);
        // sleep(5);

        ///print_r($_POST);
                $q=$_POST["q"];
                 if($q<>''){
                     $respuesta="<strong>COMPORTAMIENTO ETICO</strong>:
                     <BR><BR>
                     Como colaboradores debemos tener un comportamiento acorde con los estándares profesionales de nuestra organización, tanto en nuestras relaciones internas como en la vinculación con accionistas, clientes, proveedores y otros grupos de interés.<br><br>Por esto, estamos llamados a actuar como dueños, obtener lo mejor de las personas, apasionarnos por el cliente y lograr objetivos ambiciosos.";
                 }   else {$respuesta="";}


        $_SESSION["id_empresa"] = 62;
        $rut = $_SESSION["user_"];
        $id_empresa = $_SESSION["id_empresa"];
        $_SESSION["malla"] = "";
        $id_malla = Decodear3($_GET["im"]);
        $id_malla = "bci_escro_m1";
        $id_clasificacion = $_GET["cla"];
        $im = Encodear3($id_malla);
FinalizaObjetoFullDatos($rut, "bci_eti_c1_m1", $id_empresa, $nota_sugerida);
// echo "hola"; exit();
        // echo "$rut $id_empresa";
        $PRINCIPAL = Noticias(FuncionesTransversales(file_get_contents("views/home/bci_etica_ok.html")) , 7, 2, "");
        // $PRINCIPAL=ColocaIndicadoresVarios($PRINCIPAL);
        // $PRINCIPAL=BloqueMovimientosInternos($PRINCIPAL, "", $id_empresa);
        $PRINCIPAL = BarraNavegacion($PRINCIPAL, $seccion);
        $PRINCIPAL = ColocarSliderPorNoticia($PRINCIPAL, $id_empresa);
        $PRINCIPAL = ColocaMenuSecundario($PRINCIPAL, $_SESSION["id_empresa"]);
        $arreglo_row_bcicoins = lms_busca_puntos_reportes($rut, $id_empresa);
        $PRINCIPAL = str_replace("{ROW_BCI_COINS_CARTOLA}", $arreglo_row_bcicoins[0], $PRINCIPAL);
        $arreglo_row_bcicursosrealizados = lms_busca_cursos_realizados($rut, $id_empresa);
        $PRINCIPAL = str_replace("{ROW_BCI_MIS_CURSOS_REALIZADOS}", $arreglo_row_bcicursosrealizados[0], $PRINCIPAL);
        $PRINCIPAL = str_replace("{SUMATOTAL_PUNTOS_REPORTES}", $arreglo_row_bcicoins[1], $PRINCIPAL);

        $PRINCIPAL = str_replace("{BCI_ETICA_RESULTADOS_BUSCADOR}", $respuesta, $PRINCIPAL);





        $arreglo_oferta_abierta = lms_busca_posibles_postulaciones($rut, $id_empresa);
        $arrayEmail = BuscaEmail($rut);
        $email_base64 = base64_encode($arrayEmail[0]->email);
        $word = $arrayEmail[0]->email . $secret;
        // echo "<br />word $word<br />";
        $secret = "0rcywyht45kuydf2svx4ctxzll1yr7gby8q0wz51";
        $word = $arrayEmail[0]->email . $secret;
        $token_hash = hash('sha256', $word);
        // echo $token_hash;
        $boton3 = "https://www.cotalker.com/auth/local?source=bcicapacitacion&email=" . $email_base64 . "&token=" . $token_hash . "";
        $boton4 = "https://www.compartebci.cl";
        $PRINCIPAL = str_replace("{BOTON1}", $boton1, $PRINCIPAL);
        $PRINCIPAL = str_replace("{BOTON2}", $boton2, $PRINCIPAL);
        $PRINCIPAL = str_replace("{BOTON3}", $boton3, $PRINCIPAL);
        $PRINCIPAL = str_replace("{BOTON4}", $boton4, $PRINCIPAL);
        $arreglo_row_avance = lms_integracion_programas($rut, $id_empresa, "");
        $PRINCIPAL = str_replace("{AVANCEMALLATOTAL}", $arreglo_row_avance[1], $PRINCIPAL);
        $PRINCIPAL = str_replace("{ROW_LISTA_PROGRAMAS_OBLIGATORIOS}", $arreglo_row_avance[0], $PRINCIPAL);
        $arreglo_row_avance_opcional = lms_integracion_programas($rut, $id_empresa, "opcional");
        $PRINCIPAL = str_replace("{ROW_LISTA_PROGRAMAS_OPCIONAL}", $arreglo_row_avance_opcional[0], $PRINCIPAL);
        $PRINCIPAL = str_replace("{SECCION_PREGUNTA}", ColocaBloquePreguntaPorObjeto($datos_objeto[0]->id, $rut, 4) , $PRINCIPAL);
        $PRINCIPAL = str_replace("{ROW_PESTANAS_LI_FOCOS}", ColocaPestanasFocosHome($rut, $id_empresa) , $PRINCIPAL);
        $PRINCIPAL = str_replace("{ID_MALLA_ENCODEADO}", $im, $PRINCIPAL);
        $PRINCIPAL = ColocaDatosPerfil($PRINCIPAL, $rut);
        echo $PRINCIPAL;
    }

   else if ($seccion == "home_bci_esc_robci_tu_malla_transversal") {
        $rut = $_SESSION["user_"];
        $programa = "bci_esc_robci";
                $id_malla = Decodear3($_GET["im"]);

        $array_malla = buscamallaPorPrograma($rut, $programa, $id_empresa);
        $id_malla = Decodear3($_GET["im"]);
        // echo $id_malla;
        $id_clasificacion = "bci_esc_ro_rf";
        $array_curso_rf = BuscaCursosDadoMallaPrograma($id_malla, $id_clasificacion, $programa, $id_empresa);
        //echo "<pre>";print_r($array_curso_rf);
        $arreglo_rf = "";
        $cuenta_rmm_ok = 0;
        $cuenta_roc_ok = 0;
        $cuenta_rf_ok = 0;
        $cuenta_rf = 0;
        $cuenta_rmm = 0;
        $cuenta_roc = 0;
        foreach($array_curso_rf as $unico) {
            // echo "<br />unico";    print_r($unico);
            if ($unico->nivel <> 'TRANSVERSAL') {
                continue;
            }
            $cuenta_rf++;
            $avance_array = BuscaAvanceIdCursoActualizaReportes($rut, $unico->id_curso, $id_empresa);
            // print_r($avance_array);
            if ($avance_array[0]->avance == "") {
                $avance_array[0]->avance = 0;
            }
            if ($avance_array[0]->avance >= 100) {
                $cuenta_rf_ok++;
                $avance = "verde";
                $txt_estado = "<center><i class='fas fa-check-circle'></i> Curso Aprobado</center>";
                $css_up = "er_back_finalizado";
                $css_up2 = "er_finalizado";
                $css_ico = "<i class='fas fa-check'></i>";
                $css_txt = "Realizado";
                $css_borde = "sl-border_aprobado";
            }
            if ($avance_array[0]->avance >= 0 and $avance_array[0]->avance < 100) {
                $avance = "amarillo";
                $txt_estado = "<center><i class='fas fa-exclamation-circle'></i> Curso Pendiente</center>";
                $css_up = "er_back_pendiente";
                $css_up2 = "er_pendiente";
                $css_ico = "<i class='far fa-bookmark'></i>";
                            $css_txt = "Obligatorio";
                                $css_borde = "sl-border_no_iniciado";
            }
            if ($avance_array[0]->avance == 0) {
                $avance = "rojo";
                $txt_estado = "<center><i class='fas fa-exclamation-circle'></i> Curso No Iniciado</center>";
                $css_up = "er_back_no_iniciado";
                $css_up2 = "er_no_iniciado";
                $css_ico = "<i class='fas fa-mouse-pointer'></i>";
                $css_txt = "Obligatorio";
                $css_borde = "sl-border_no_iniciado";
            }
            $idc = Encodear3($unico->id_curso);
            $arreglo_rf[$unico->nivel].= "

 <a href='?sw=detalle_cursoCap&idc=" . Encodear3($unico->id_curso) . "'>
                            <div class='sl-element dontHide " . $css_up . " " . $css_borde . "'>
                                <div class='sl-ico " . $css_up2 . "'>" . $css_ico . "</div>
                                <div class='sl-ico_left " . $css_up2 . "'><i class='fas fa-asterisk'></i> " . $css_txt . "</span></div>

                                <div class='sl-title'> " . utf8_encode($unico->curso) . "</div>
                                 <center> <span class='badge badge-pill badge-gris_v2 " . $css_up2 . "'>Duraci&oacute;n: " . $unico->tiempo . "</span></center>
                            </div>
                            </a>
    ";
        }
        $id_clasificacion = "bci_esc_ro_rmm";
        $array_curso_rmm = BuscaCursosDadoMallaPrograma($id_malla, $id_clasificacion, $programa, $id_empresa);
        $arreglo_rmm = "";
        foreach($array_curso_rmm as $unico) {
            // echo "<br />unico";
            if ($unico->nivel <> 'TRANSVERSAL') {
                continue;
            }
            $cuenta_rmm++;
            $avance_array = BuscaAvanceIdCursoActualizaReportes($rut, $unico->id_curso, $id_empresa);
            // print_r($avance_array);
            if ($avance_array[0]->avance == "") {
                $avance_array[0]->avance = 0;
            }
            if ($avance_array[0]->avance >= 100) {
                $cuenta_rmm_ok++;
                $avance = "verde";
                $txt_estado = "<center><i class='fas fa-check-circle'></i> Curso Aprobado</center>";
                $css_up = "er_back_finalizado";
                $css_up2 = "er_finalizado";
                $css_ico = "<i class='fas fa-check'></i>";
                                $css_txt = "Realizado";
                $css_borde = "sl-border_aprobado";

                $cuenta_rmm_ok++;
            }
            if ($avance_array[0]->avance >= 0 and $avance_array[0]->avance < 100) {
                $avance = "amarillo";
                $txt_estado = "<center><i class='fas fa-exclamation-circle'></i> Curso Pendiente</center>";
                $css_up = "er_back_pendiente";
                $css_up2 = "er_pendiente";
                $css_ico = "<i class='far fa-bookmark'></i>";
                                            $css_txt = "Obligatorio";
                                $css_borde = "sl-border_no_iniciado";
            }
            if ($avance_array[0]->avance == 0) {
                $avance = "rojo";
                $txt_estado = "<center><i class='fas fa-exclamation-circle'></i> Curso Pendiente</center>";
                $css_up = "er_back_no_iniciado";
                $css_up2 = "er_no_iniciado";
                $css_ico = "<i class='fas fa-mouse-pointer'></i>";
                $css_txt = "Obligatorio";
                $css_borde = "sl-border_no_iniciado";
            }
            $idc = Encodear3($unico->id_curso);
            if ($avance_array[0]->avance == "") {
                $avance_array[0]->avance = 0;
            }
            $arreglo_rmm[$unico->nivel].= "
 <a href='?sw=detalle_cursoCap&idc=" . Encodear3($unico->id_curso) . "'>
                            <div class='sl-element dontHide " . $css_up . " " . $css_borde . "'>
                                <div class='sl-ico " . $css_up2 . "'>" . $css_ico . "</div>
                                <div class='sl-ico_left " . $css_up2 . "'><i class='fas fa-asterisk'></i> " . $css_txt . "</span></div>

                                <div class='sl-title'> " . utf8_encode($unico->curso) . "</div>
                                 <center> <span class='badge badge-pill badge-gris_v2 " . $css_up2 . "'>Duraci&oacute;n: " . $unico->tiempo . "</span></center>
                            </div>
                            </a>
        ";
        }
        $id_clasificacion = "bci_esc_ro_roc";
        $array_curso_roc = BuscaCursosDadoMallaPrograma($id_malla, $id_clasificacion, $programa, $id_empresa);
        // print_r($array_curso_roc);
        $arreglo_roc = "";
        foreach($array_curso_roc as $unico) {
            $avance_array = BuscaAvanceIdCursoActualizaReportes($rut, $unico->id_curso, $id_empresa);
            // print_r($avance_array);
            // echo "<br /><br /><br /> id_curso ".$unico->id_curso." nombre ".$unico->curso." <br /><br /> ";
            // print_r($avance_array);
            // echo "<br />";
            if ($unico->nivel <> 'TRANSVERSAL') {
                continue;
            }
            $cuenta_roc++;
            if ($avance_array[0]->avance == "") {
                $avance_array[0]->avance = 0;
            }
            if ($avance_array[0]->avance >= 100) {
                $cuenta_roc_ok++;
                $avance = "verde";
                $txt_estado = "<center><i class='fas fa-check-circle'></i> Curso Aprobado</center>";
                $css_up = "er_back_finalizado";
                $css_up2 = "er_finalizado";
                $css_ico = "<i class='fas fa-check'></i>";
                                                    $css_txt = "Realizado";
                                $css_borde = "sl-border_aprobado";
            }
            if ($avance_array[0]->avance >= 0 and $avance_array[0]->avance < 100) {
                $avance = "amarillo";
                $txt_estado = "<center><i class='fas fa-exclamation-circle'></i> Curso Pendiente</center>";
                $css_up = "er_back_pendiente";
                $css_up2 = "er_pendiente";
                $css_ico = "<i class='far fa-bookmark'></i>";                             $css_txt = "Obligatorio";
                                $css_borde = "sl-border_no_iniciado";
            }
            if ($avance_array[0]->avance == 0) {
                $avance = "rojo";
                $txt_estado = "<center><i class='fas fa-exclamation-circle'></i> Curso No Iniciado</center>";
                $css_up = "er_back_no_iniciado";
                $css_up2 = "er_no_iniciado";
                $css_ico = "<i class='fas fa-mouse-pointer'></i>";                               $css_txt = "Obligatorio";
                                $css_borde = "sl-border_no_iniciado";
            }
            if ($avance_array[0]->avance == "") {
                $avance_array[0]->avance = 0;
            }
            $arreglo_roc[$unico->nivel].= "

 <a href='?sw=detalle_cursoCap&idc=" . Encodear3($unico->id_curso) . "'>
                            <div class='sl-element dontHide " . $css_up . " " . $css_borde . "'>
                                <div class='sl-ico " . $css_up2 . "'>" . $css_ico . "</div>
                                <div class='sl-ico_left " . $css_up2 . "'><i class='fas fa-asterisk'></i> " . $css_txt . "</span></div>

                                <div class='sl-title'> " . utf8_encode($unico->curso) . "</div>
                                 <center> <span class='badge badge-pill badge-gris_v2 " . $css_up2 . "'>Duraci&oacute;n: " . $unico->tiempo . "</span></center>
                            </div>
                            </a>
            ";
        }
        if (($arreglo_rf["TRANSVERSAL"]) == '') {
            $arreglo_rf["TRANSVERSAL"] = "<center><span class='badge badge-pill badge-gris'>Este nivel no tiene cursos disponibles</span>";
        }
        if (($arreglo_rmm["TRANSVERSAL"]) == '') {
            $arreglo_rmm["TRANSVERSAL"] = "<center><span class='badge badge-pill badge-gris'>Este nivel no tiene cursos disponibles</span>";
        }
        if (($arreglo_roc["TRANSVERSAL"]) == '') {
            $arreglo_roc["TRANSVERSAL"] = "<center><span class='badge badge-pill badge-gris'>Este nivel no tiene cursos disponibles</span>";
        }
        if (($arreglo_rf["BASICO"]) == '') {
            $arreglo_rf["BASICO"] = "<center><span class='badge badge-pill badge-gris'>Este nivel no tiene cursos disponibles</span>";
        }
        if (($arreglo_rmm["BASICO"]) == '') {
            $arreglo_rmm["BASICO"] = "<center><span class='badge badge-pill badge-gris'>Este nivel no tiene cursos disponibles</span>";
        }
        if (($arreglo_roc["BASICO"]) == '') {
            $arreglo_roc["BASICO"] = "<center><span class='badge badge-pill badge-gris'>Este nivel no tiene cursos disponibles</span>";
        }
        if (($arreglo_rf["MEDIO"]) == '') {
            $arreglo_rf["MEDIO"] = "<center><span class='badge badge-pill badge-gris'>Este nivel no tiene cursos disponibles</span>";
        }
        if (($arreglo_rmm["MEDIO"]) == '') {
            $arreglo_rmm["MEDIO"] = "<center><span class='badge badge-pill badge-gris'>Este nivel no tiene cursos disponibles</span>";
        }
        if (($arreglo_roc["MEDIO"]) == '') {
            $arreglo_roc["MEDIO"] = "<center><span class='badge badge-pill badge-gris'>Este nivel no tiene cursos disponibles</span>";
        }
        if (($arreglo_rf["AVANZADO"]) == '') {
            $arreglo_rf["AVANZADO"] = "<center><span class='badge badge-pill badge-gris'>Este nivel no tiene cursos disponibles</span>";
        }
        if (($arreglo_rmm["AVANZADO"]) == '') {
            $arreglo_rmm["AVANZADO"] = "<center><span class='badge badge-pill badge-gris'>Este nivel no tiene cursos disponibles</span>";
        }
        if (($arreglo_roc["AVANZADO"]) == '') {
            $arreglo_roc["AVANZADO"] = "<center><span class='badge badge-pill badge-gris'>Este nivel no tiene cursos disponibles</span>";
        }
        // echo "<br />".$unico->id_curso." avance ".$avance_array[0]->avance." css $css_up";
        $id_empresa = $_SESSION["id_empresa"];

    //sweetalert
                $viovideo_visto_sa = 0;
                $viovideoarray_sa = vio_vide_intro($rut, "bci_escuela_riesgo_intro_sweet_alert_transversales", $id_empresa);
                $cuentaVideoArray_sa = $viovideoarray_sa[0]->cuenta;

                $PRINCIPAL = Noticias(FuncionesTransversales(file_get_contents("views/templates/bci_escuela_riesgo_tu_malla_transversal.html")) , 7, 2, "");

                if ($cuentaVideoArray_sa == 0) {
                        $viovideo_visto = 1; //echo "muestra sa";
        $PRINCIPAL = str_replace("{SWEETALERT}", "swal(
        '¡Bienvenido a tus Cursos Transversales!',
        '¡Recuerda que estos cursos son obligatorios, y debes realizarlos para ir avanzando en tu Malla!. Si alguno de estos cursos ya los realizaste anteriormente, ya estarán pre-aprobados.',
        ''
)", $PRINCIPAL);
                inserta_vio_video($rut, "bci_escuela_riesgo_intro_sweet_alert_transversales", $id_empresa);
                } else {

                                        $PRINCIPAL = str_replace("{SWEETALERT}", "", $PRINCIPAL);

                }

        $PRINCIPAL = BarraNavegacion($PRINCIPAL, $seccion);
        $PRINCIPAL = ColocarSliderPorNoticia($PRINCIPAL, $id_empresa);
        $PRINCIPAL = ColocaMenuSecundario($PRINCIPAL, $_SESSION["id_empresa"]);
        $PRINCIPAL = str_replace("{ROBCI_RF_TRANSVERSAL}", $arreglo_rf["TRANSVERSAL"], $PRINCIPAL);
        $PRINCIPAL = str_replace("{ROBCI_RF_BASICO}", $arreglo_rf["BASICO"], $PRINCIPAL);
        $PRINCIPAL = str_replace("{ROBCI_RF_MEDIO}", $arreglo_rf["MEDIO"], $PRINCIPAL);
        $PRINCIPAL = str_replace("{ROBCI_RF_AVANZADO}", $arreglo_rf["AVANZADO"], $PRINCIPAL);
        $PRINCIPAL = str_replace("{ROBCI_RMM_TRANSVERSAL}", $arreglo_rmm["TRANSVERSAL"], $PRINCIPAL);
        $PRINCIPAL = str_replace("{ROBCI_RMM_BASICO}", $arreglo_rmm["BASICO"], $PRINCIPAL);
        $PRINCIPAL = str_replace("{ROBCI_RMM_MEDIO}", $arreglo_rmm["MEDIO"], $PRINCIPAL);
        $PRINCIPAL = str_replace("{ROBCI_RMM_AVANZADO}", $arreglo_rmm["AVANZADO"], $PRINCIPAL);
        $PRINCIPAL = str_replace("{ROBCI_ROC_TRANSVERSAL}", $arreglo_roc["TRANSVERSAL"], $PRINCIPAL);
        $PRINCIPAL = str_replace("{ROBCI_ROC_BASICO}", $arreglo_roc["BASICO"], $PRINCIPAL);
        $PRINCIPAL = str_replace("{ROBCI_ROC_MEDIO}", $arreglo_roc["MEDIO"], $PRINCIPAL);
        $PRINCIPAL = str_replace("{ROBCI_ROC_AVANZADO}", $arreglo_roc["AVANZADO"], $PRINCIPAL);
        $PRINCIPAL = str_replace("{ROBCI_ROP_TRANSVERSAL}", $arreglo_rop["TRANSVERSAL"], $PRINCIPAL);
        $PRINCIPAL = str_replace("{ROBCI_ROP_BASICO}", $arreglo_rop["BASICO"], $PRINCIPAL);
        $PRINCIPAL = str_replace("{ROBCI_ROP_MEDIO}", $arreglo_rop["MEDIO"], $PRINCIPAL);
        $PRINCIPAL = str_replace("{ROBCI_ROP_AVANZADO}", $arreglo_rop["AVANZADO"], $PRINCIPAL);
        $PRINCIPAL = str_replace("{AVANCE_RF}", round(100 * $cuenta_rf_ok / $cuenta_rf) , $PRINCIPAL);
        $PRINCIPAL = str_replace("{NUM_RF}", $cuenta_rf, $PRINCIPAL);
        $PRINCIPAL = str_replace("{AVANCE_ROC}", round(100 * $cuenta_roc_ok / $cuenta_roc) , $PRINCIPAL);
        $PRINCIPAL = str_replace("{NUM_ROC}", $cuenta_roc, $PRINCIPAL);
        $PRINCIPAL = str_replace("{AVANCE_RMM}", round(100 * $cuenta_rmm_ok / $cuenta_rmm) , $PRINCIPAL);
        $PRINCIPAL = str_replace("{NUM_RMM}", $cuenta_rmm, $PRINCIPAL);
        $PRINCIPAL = str_replace("{BOTON1}", $boton1, $PRINCIPAL);
        $PRINCIPAL = str_replace("{BOTON2}", $boton2, $PRINCIPAL);
        $arreglo_row_avance = lms_integracion_programas($rut, $id_empresa);
        $datos_usuario = DatosUsuarioLeftJefe($rut);
        $resultados_usuario[0]->puntos = 0;
        $PRINCIPAL = str_replace("{AVATAR_USUARIO}", $datos_usuario[0]->avatar, $PRINCIPAL);
        $PRINCIPAL = str_replace("{NOMBRE_USUARIO}", $datos_usuario[0]->nombre_completo, $PRINCIPAL);
        $PRINCIPAL = str_replace("{CARGO_USUARIO}", $datos_usuario[0]->cargo, $PRINCIPAL);
        $PRINCIPAL = str_replace("{PUNTOS_USUARIO}", $resultados_usuario[0]->puntos, $PRINCIPAL);
        $PRINCIPAL = str_replace("{RANKING_USUARIO}", $resultados_usuario[0]->puntos, $PRINCIPAL);
        $PRINCIPAL = str_replace("{MEDALLAS_USUARIO}", $resultados_usuario[0]->puntos, $PRINCIPAL);
        $PRINCIPAL = str_replace("{RANKING_MEDALLAS}", $resultados_usuario[0]->puntos, $PRINCIPAL);
        $PRINCIPAL = str_replace("{EMBLEMAS_USUARIO}", $resultados_usuario[0]->puntos, $PRINCIPAL);
        $PRINCIPAL = str_replace("{CERTIFICACIONES_USUARIO}", $resultados_usuario[0]->puntos, $PRINCIPAL);
        $PRINCIPAL = str_replace("{AVANCEMALLATOTAL}", $arreglo_row_avance[1], $PRINCIPAL);
        $PRINCIPAL = str_replace("{ROW_LISTA_PROGRAMAS_OBLIGATORIOS}", $arreglo_row_avance[0], $PRINCIPAL);
        $arreglo_row_avance_opcional = lms_integracion_programas($rut, $id_empresa, "opcional");
        $PRINCIPAL = str_replace("{ROW_LISTA_PROGRAMAS_OPCIONAL}", $arreglo_row_avance_opcional[0], $PRINCIPAL);
        $PRINCIPAL = str_replace("{SECCION_PREGUNTA}", ColocaBloquePreguntaPorObjeto($datos_objeto[0]->id, $rut, 4) , $PRINCIPAL);
        $PRINCIPAL = str_replace("{ROW_PESTANAS_LI_FOCOS}", ColocaPestanasFocosHome($rut, $id_empresa) , $PRINCIPAL);
        $PRINCIPAL = str_replace("{ID_MALLA_ENCODEADO}", $_GET["im"], $PRINCIPAL);
        $PRINCIPAL = str_replace("{ID_MALLA_ENCODEADA}", $_GET["im"], $PRINCIPAL);
        $arrayEmail = BuscaEmail($rut);
        $email_base64 = base64_encode($arrayEmail[0]->email);
        $word = $arrayEmail[0]->email . $secret;
        // echo "<br />word $word<br />";
        $secret = "0rcywyht45kuydf2svx4ctxzll1yr7gby8q0wz51";
        $word = $arrayEmail[0]->email . $secret;
        $token_hash = hash('sha256', $word);
        // echo $token_hash;
        $boton3 = "https://www.cotalker.com/auth/local?source=bcicapacitacion&email=" . $email_base64 . "&token=" . $token_hash . "";
        $boton4 = "https://www.compartebci.cl";
        $PRINCIPAL = str_replace("{BOTON1}", $boton1, $PRINCIPAL);
        $PRINCIPAL = str_replace("{BOTON2}", $boton2, $PRINCIPAL);
        $PRINCIPAL = str_replace("{BOTON3}", $boton3, $PRINCIPAL);
        $PRINCIPAL = str_replace("{BOTON4}", $boton4, $PRINCIPAL);
        $PRINCIPAL = ColocaDatosPerfil($PRINCIPAL, $rut);
        echo $PRINCIPAL;
    }

  else if ($seccion == "home_bci_esc_robci_tu_malla_diagnostico") {
        //echo "home_bci_esc_robci_tu_malla_diagnostico";
        $rut = $_SESSION["user_"];
        $programa = "bci_esc_robci";
        $array_malla = buscamallaPorPrograma($rut, $programa, $id_empresa);
        $id_malla = Decodear3($_GET["im"]);
        $idc= Decodear3($_GET["idc"]);
        $diag= ($_GET["diag"]);

          //echo "idc $idc diag $diag";
          if($idc<>'' and $diag<>''){
              Lms_Reprueba_primerObjetoCurso($rut, $idc, $id_empresa);
          }

        // echo $id_malla;
        $id_clasificacion = "bci_esc_ro_rf";
        $array_curso_rf = BuscaCursosDadoMallaPrograma($id_malla, $id_clasificacion, $programa, $id_empresa);
        //echo "<pre>";print_r($array_curso_rf);
        $arreglo_rf = "";
        $cuenta_rmm_ok = 0;
        $cuenta_roc_ok = 0;
        $cuenta_rf_ok = 0;
        $cuenta_rf = 0;
        $cuenta_rmm = 0;
        $cuenta_roc = 0;
        foreach($array_curso_rf as $unico) {
            // echo "<br />unico";    print_r($unico);
            if ($unico->nivel <> 'BASICO' AND $unico->nivel <> 'MEDIO') {
                continue;
            }
            $cuenta_rf++;
            $avance_array = BuscaAvanceIdCursoActualizaReportes($rut, $unico->id_curso, $id_empresa);
             //print_r($avance_array);
            if ($avance_array[0]->avance == "") {
                $avance_array[0]->avance = 0;
            }
            if ($avance_array[0]->avance >= 100) {
                $cuenta_rf_ok++;
                $avance = "verde";
                $txt_estado = "<center><i class='fas fa-check-circle'></i> Curso Aprobado</center>";
                $css_up = "er_back_finalizado";
                $css_up2 = "er_finalizado";
                $css_ico = "<i class='fas fa-check'></i>";
                $css_txt = "Aprobado";
                $css_borde = "sl-border_aprobado";
            }
            if ($avance_array[0]->avance > 0 and $avance_array[0]->avance < 100) { continue;
                $avance = "amarillo";
                $txt_estado = "<center><i class='fas fa-exclamation-circle'></i> Curso Pendiente</center>";
                $css_up = "er_back_pendiente";
                $css_up2 = "er_pendiente";
                $css_ico = "<i class='far fa-bookmark'></i>";
                            $css_txt = "Obligatorio";
                                $css_borde = "sl-border_no_iniciado";
            }
            if ($avance_array[0]->avance == 0) {
                    $cuenta_obj_fin=BuscaCursosObjetosFinalizados($unico->id_curso, $rut);

            if($cuenta_obj_fin>0){continue;}

                $avance = "rojo";
                $txt_estado = "<center><i class='fas fa-exclamation-circle'></i> Curso No Iniciado</center>";
                $css_up = "er_back_no_iniciado";
                $css_up2 = "er_no_iniciado";
                $css_ico = "<i class='fas fa-mouse-pointer'></i>";
                $css_txt = "Obligatorio";
                $css_borde = "sl-border_no_iniciado";
            }
            $idc = Encodear3($unico->id_curso);
            if($avance_array[0]->avance >= 100) {
                  $texto_convalida="";
            }   else {
                $texto_convalida="   <center>   <span class='badge badge-pill badge-gris_v3 er_no_iniciado'>¿Deseas convalidar este curso?</span>
        <br>
        <a href='?sw=detalle_cursoCap&idc=" . Encodear3($unico->id_curso) . "' class='btn btn-success'><span class='blanco'>Si!</span></a>
        <a href='?sw=home_bci_esc_robci_tu_malla_diagnostico&im=".$_GET["im"]."&idc=" . Encodear3($unico->id_curso) . "&diag=1' class='btn btn-danger'><span class='blanco'>No</span></a>
    </center>";
            }
            $arreglo_rf[$unico->nivel].= "


<div class='sl-element dontHide " . $css_up . " " . $css_borde . "'>
    <div class='sl-ico " . $css_up2 . "'>" . $css_ico . "</div>
    <div class='sl-ico_left " . $css_up2 . "'><i class='fas fa-asterisk'></i> " . $css_txt . "</span></div>
    <div class='sl-title'> " . utf8_encode($unico->curso) . "</div>

 $texto_convalida
</div>

    ";
        }
        $id_clasificacion = "bci_esc_ro_rmm";
        $array_curso_rmm = BuscaCursosDadoMallaPrograma($id_malla, $id_clasificacion, $programa, $id_empresa);
        $arreglo_rmm = "";
        foreach($array_curso_rmm as $unico) {
            // echo "<br />unico";
            if ($unico->nivel <> 'BASICO' AND $unico->nivel <> 'MEDIO') {
                continue;
            }
            $cuenta_rmm++;
            $avance_array = BuscaAvanceIdCursoActualizaReportes($rut, $unico->id_curso, $id_empresa);
            // print_r($avance_array);
            if ($avance_array[0]->avance == "") {
                $avance_array[0]->avance = 0;
            }
            if ($avance_array[0]->avance >= 100) {
                $cuenta_rmm_ok++;
                $avance = "verde";
                $txt_estado = "<center><i class='fas fa-check-circle'></i> Curso Aprobado</center>";
                $css_up = "er_back_finalizado";
                $css_up2 = "er_finalizado";
                $css_ico = "<i class='fas fa-check'></i>";
                                $css_txt = "Aprobado";
                $css_borde = "sl-border_aprobado";

                $cuenta_rmm_ok++;
            }
            if ($avance_array[0]->avance > 0 and $avance_array[0]->avance < 100) { continue;
                $avance = "amarillo";
                $txt_estado = "<center><i class='fas fa-exclamation-circle'></i> Curso Pendiente</center>";
                $css_up = "er_back_pendiente";
                $css_up2 = "er_pendiente";
                $css_ico = "<i class='far fa-bookmark'></i>";
                                            $css_txt = "Obligatorio";
                                $css_borde = "sl-border_no_iniciado";
            }
            if ($avance_array[0]->avance == 0) {
                                    $cuenta_obj_fin=BuscaCursosObjetosFinalizados($unico->id_curso, $rut);

            if($cuenta_obj_fin>0){continue;}
                $avance = "rojo";
                $txt_estado = "<center><i class='fas fa-exclamation-circle'></i> Curso Pendiente</center>";
                $css_up = "er_back_no_iniciado";
                $css_up2 = "er_no_iniciado";
                $css_ico = "<i class='fas fa-mouse-pointer'></i>";
                $css_txt = "Obligatorio";
                $css_borde = "sl-border_no_iniciado";
            }
            $idc = Encodear3($unico->id_curso);
            if ($avance_array[0]->avance == "") {
                $avance_array[0]->avance = 0;
            }
                                    if($avance_array[0]->avance >= 100) {
                                    $texto_convalida="";
                        }   else {
                                $texto_convalida="   <center>   <span class='badge badge-pill badge-gris_v3 er_no_iniciado'>¿Deseas convalidar este curso?</span>
                <br>
                <a href='?sw=detalle_cursoCap&idc=" . Encodear3($unico->id_curso) . "' class='btn btn-success'><span class='blanco'>Si!</span></a>
                <a href='?sw=home_bci_esc_robci_tu_malla_diagnostico&im=".$_GET["im"]."&idc=" . Encodear3($unico->id_curso) . "&diag=1' class='btn btn-danger'><span class='blanco'>No</span></a>
        </center>";
                        }
            $arreglo_rmm[$unico->nivel].= "
<div class='sl-element dontHide " . $css_up . " " . $css_borde . "'>
    <div class='sl-ico " . $css_up2 . "'>" . $css_ico . "</div>
    <div class='sl-ico_left " . $css_up2 . "'><i class='fas fa-asterisk'></i> " . $css_txt . "</span></div>
    <div class='sl-title'> " . utf8_encode($unico->curso) . "</div>
 $texto_convalida

</div>
        ";
        }
        $id_clasificacion = "bci_esc_ro_roc";
        $array_curso_roc = BuscaCursosDadoMallaPrograma($id_malla, $id_clasificacion, $programa, $id_empresa);
        // print_r($array_curso_roc);
        $arreglo_roc = "";
        foreach($array_curso_roc as $unico) {
            $avance_array = BuscaAvanceIdCursoActualizaReportes($rut, $unico->id_curso, $id_empresa);
            // print_r($avance_array);
            // echo "<br /><br /><br /> id_curso ".$unico->id_curso." nombre ".$unico->curso." <br /><br /> ";
            // print_r($avance_array);
            // echo "<br />";
            if ($unico->nivel <> 'BASICO' AND $unico->nivel <> 'MEDIO') {
                continue;
            }
            $cuenta_roc++;
            if ($avance_array[0]->avance == "") {
                $avance_array[0]->avance = 0;
            }
            if ($avance_array[0]->avance >= 100) {
                $cuenta_roc_ok++;
                $avance = "verde";
                $txt_estado = "<center><i class='fas fa-check-circle'></i> Curso Aprobado</center>";
                $css_up = "er_back_finalizado";
                $css_up2 = "er_finalizado";
                $css_ico = "<i class='fas fa-check'></i>";
                $css_txt = "Aprobado";
                $css_borde = "sl-border_aprobado";
            }
            if ($avance_array[0]->avance > 0 and $avance_array[0]->avance < 100) {  continue;
                $avance = "amarillo";
                $txt_estado = "<center><i class='fas fa-exclamation-circle'></i> Curso Pendiente</center>";
                $css_up = "er_back_pendiente";
                $css_up2 = "er_pendiente";
                $css_ico = "<i class='far fa-bookmark'></i>";                             $css_txt = "Obligatorio";
                                $css_borde = "sl-border_no_iniciado";
            }
            if ($avance_array[0]->avance == 0) {
                                    $cuenta_obj_fin=BuscaCursosObjetosFinalizados($unico->id_curso, $rut);

            if($cuenta_obj_fin>0){continue;}
                $avance = "rojo";
                $txt_estado = "<center><i class='fas fa-exclamation-circle'></i> Curso No Iniciado</center>";
                $css_up = "er_back_no_iniciado";
                $css_up2 = "er_no_iniciado";
                $css_ico = "<i class='fas fa-mouse-pointer'></i>";                               $css_txt = "Obligatorio";
                                $css_borde = "sl-border_no_iniciado";
            }
            if ($avance_array[0]->avance == "") {
                $avance_array[0]->avance = 0;
            }
                                    if($avance_array[0]->avance >= 100) {
                                    $texto_convalida="";
                        }   else {
                                $texto_convalida="   <center>   <span class='badge badge-pill badge-gris_v3 er_no_iniciado'>¿Deseas convalidar este curso?</span>
                <br>
                <a href='?sw=detalle_cursoCap&idc=" . Encodear3($unico->id_curso) . "' class='btn btn-success'><span class='blanco'>Si!</span></a>
                <a href='?sw=home_bci_esc_robci_tu_malla_diagnostico&im=".$_GET["im"]."&idc=" . Encodear3($unico->id_curso) . "&diag=1' class='btn btn-danger'><span class='blanco'>No</span></a>
        </center>";
                        }
            $arreglo_roc[$unico->nivel].= "
<div class='sl-element dontHide " . $css_up . " " . $css_borde . "'>
    <div class='sl-ico " . $css_up2 . "'>" . $css_ico . "</div>
    <div class='sl-ico_left " . $css_up2 . "'><i class='fas fa-asterisk'></i> " . $css_txt . "</span></div>
    <div class='sl-title'> " . utf8_encode($unico->curso) . "</div>
 $texto_convalida

</div>
            ";
        }
        if (($arreglo_rf["TRANSVERSAL"]) == '') {
            $arreglo_rf["TRANSVERSAL"] = "<center><span class='badge badge-pill badge-gris'>Este nivel no tiene cursos disponibles</span>";
        }
        if (($arreglo_rmm["TRANSVERSAL"]) == '') {
            $arreglo_rmm["TRANSVERSAL"] = "<center><span class='badge badge-pill badge-gris'>Este nivel no tiene cursos disponibles</span>";
        }
        if (($arreglo_roc["TRANSVERSAL"]) == '') {
            $arreglo_roc["TRANSVERSAL"] = "<center><span class='badge badge-pill badge-gris'>Este nivel no tiene cursos disponibles</span>";
        }
        if (($arreglo_rf["BASICO"]) == '') {
            $arreglo_rf["BASICO"] = "<center><span class='badge badge-pill badge-gris'>Este nivel no tiene cursos disponibles</span>";
        }
        if (($arreglo_rmm["BASICO"]) == '') {
            $arreglo_rmm["BASICO"] = "<center><span class='badge badge-pill badge-gris'>Este nivel no tiene cursos disponibles</span>";
        }
        if (($arreglo_roc["BASICO"]) == '') {
            $arreglo_roc["BASICO"] = "<center><span class='badge badge-pill badge-gris'>Este nivel no tiene cursos disponibles</span>";
        }
        if (($arreglo_rf["MEDIO"]) == '') {
            $arreglo_rf["MEDIO"] = "<center><span class='badge badge-pill badge-gris'>Este nivel no tiene cursos disponibles</span>";
        }
        if (($arreglo_rmm["MEDIO"]) == '') {
            $arreglo_rmm["MEDIO"] = "<center><span class='badge badge-pill badge-gris'>Este nivel no tiene cursos disponibles</span>";
        }
        if (($arreglo_roc["MEDIO"]) == '') {
            $arreglo_roc["MEDIO"] = "<center><span class='badge badge-pill badge-gris'>Este nivel no tiene cursos disponibles</span>";
        }
        if (($arreglo_rf["AVANZADO"]) == '') {
            $arreglo_rf["AVANZADO"] = "<center><span class='badge badge-pill badge-gris'>Este nivel no tiene cursos disponibles</span>";
        }
        if (($arreglo_rmm["AVANZADO"]) == '') {
            $arreglo_rmm["AVANZADO"] = "<center><span class='badge badge-pill badge-gris'>Este nivel no tiene cursos disponibles</span>";
        }
        if (($arreglo_roc["AVANZADO"]) == '') {
            $arreglo_roc["AVANZADO"] = "<center><span class='badge badge-pill badge-gris'>Este nivel no tiene cursos disponibles</span>";
        }
        // echo "<br />".$unico->id_curso." avance ".$avance_array[0]->avance." css $css_up";
        $id_empresa = $_SESSION["id_empresa"];
        $PRINCIPAL = FuncionesTransversales(file_get_contents("views/templates/bci_escuela_riesgo_tu_malla_diagnostico.html"));

         //sweetalert
        $viovideo_visto_sa = 0;
        $viovideoarray_sa = vio_vide_intro($rut, "bci_escuela_riesgo_intro_sweet_alert_convalidacion", $id_empresa);
        $cuentaVideoArray_sa = $viovideoarray_sa[0]->cuenta;

        $PRINCIPAL = Noticias(FuncionesTransversales(file_get_contents("views/templates/bci_escuela_riesgo_tu_malla_diagnostico.html")) , 7, 2, "");

        if ($cuentaVideoArray_sa == 0) {
            $viovideo_visto = 1; //echo "muestra sa";
    $PRINCIPAL = str_replace("{SWEETALERT}", "swal(
    '¡Bienvenido a la Convalidación de Cursos!',
    '¡Pon a prueba tu conocimiento realizando las evaluaciones diagnósticas de los cursos en cada uno de los 3 ámbitos de Riesgo. Si apruebas la evaluación diagnóstica, el curso queda instantáneamente aprobado y así vas avanzando más rápido en tu Malla',
    ''
)", $PRINCIPAL);
        inserta_vio_video($rut, "bci_escuela_riesgo_intro_sweet_alert_convalidacion", $id_empresa);
        } else {

                    $PRINCIPAL = str_replace("{SWEETALERT}", "", $PRINCIPAL);

        }



        $PRINCIPAL = BarraNavegacion($PRINCIPAL, $seccion);
        $PRINCIPAL = ColocarSliderPorNoticia($PRINCIPAL, $id_empresa);
        $PRINCIPAL = ColocaMenuSecundario($PRINCIPAL, $_SESSION["id_empresa"]);
        $PRINCIPAL = str_replace("{ROBCI_RF_TRANSVERSAL}", $arreglo_rf["TRANSVERSAL"], $PRINCIPAL);
        $PRINCIPAL = str_replace("{ROBCI_RF_BASICO}", $arreglo_rf["BASICO"], $PRINCIPAL);
        $PRINCIPAL = str_replace("{ROBCI_RF_MEDIO}", $arreglo_rf["MEDIO"], $PRINCIPAL);
        $PRINCIPAL = str_replace("{ROBCI_RF_AVANZADO}", $arreglo_rf["AVANZADO"], $PRINCIPAL);
        $PRINCIPAL = str_replace("{ROBCI_RMM_TRANSVERSAL}", $arreglo_rmm["TRANSVERSAL"], $PRINCIPAL);
        $PRINCIPAL = str_replace("{ROBCI_RMM_BASICO}", $arreglo_rmm["BASICO"], $PRINCIPAL);
        $PRINCIPAL = str_replace("{ROBCI_RMM_MEDIO}", $arreglo_rmm["MEDIO"], $PRINCIPAL);
        $PRINCIPAL = str_replace("{ROBCI_RMM_AVANZADO}", $arreglo_rmm["AVANZADO"], $PRINCIPAL);
        $PRINCIPAL = str_replace("{ROBCI_ROC_TRANSVERSAL}", $arreglo_roc["TRANSVERSAL"], $PRINCIPAL);
        $PRINCIPAL = str_replace("{ROBCI_ROC_BASICO}", $arreglo_roc["BASICO"], $PRINCIPAL);
        $PRINCIPAL = str_replace("{ROBCI_ROC_MEDIO}", $arreglo_roc["MEDIO"], $PRINCIPAL);
        $PRINCIPAL = str_replace("{ROBCI_ROC_AVANZADO}", $arreglo_roc["AVANZADO"], $PRINCIPAL);
        $PRINCIPAL = str_replace("{ROBCI_ROP_TRANSVERSAL}", $arreglo_rop["TRANSVERSAL"], $PRINCIPAL);
        $PRINCIPAL = str_replace("{ROBCI_ROP_BASICO}", $arreglo_rop["BASICO"], $PRINCIPAL);
        $PRINCIPAL = str_replace("{ROBCI_ROP_MEDIO}", $arreglo_rop["MEDIO"], $PRINCIPAL);
        $PRINCIPAL = str_replace("{ROBCI_ROP_AVANZADO}", $arreglo_rop["AVANZADO"], $PRINCIPAL);
        $PRINCIPAL = str_replace("{AVANCE_RF}", round(100 * $cuenta_rf_ok / $cuenta_rf) , $PRINCIPAL);
        $PRINCIPAL = str_replace("{NUM_RF}", $cuenta_rf, $PRINCIPAL);
        $PRINCIPAL = str_replace("{AVANCE_ROC}", round(100 * $cuenta_roc_ok / $cuenta_roc) , $PRINCIPAL);
        $PRINCIPAL = str_replace("{NUM_ROC}", $cuenta_roc, $PRINCIPAL);
        $PRINCIPAL = str_replace("{AVANCE_RMM}", round(100 * $cuenta_rmm_ok / $cuenta_rmm) , $PRINCIPAL);
        $PRINCIPAL = str_replace("{NUM_RMM}", $cuenta_rmm, $PRINCIPAL);
        $PRINCIPAL = str_replace("{BOTON1}", $boton1, $PRINCIPAL);
        $PRINCIPAL = str_replace("{BOTON2}", $boton2, $PRINCIPAL);
        $arreglo_row_avance = lms_integracion_programas($rut, $id_empresa);
        $datos_usuario = DatosUsuarioLeftJefe($rut);
        $resultados_usuario[0]->puntos = 0;
        $PRINCIPAL = str_replace("{AVATAR_USUARIO}", $datos_usuario[0]->avatar, $PRINCIPAL);
        $PRINCIPAL = str_replace("{NOMBRE_USUARIO}", $datos_usuario[0]->nombre_completo, $PRINCIPAL);
        $PRINCIPAL = str_replace("{CARGO_USUARIO}", $datos_usuario[0]->cargo, $PRINCIPAL);
        $PRINCIPAL = str_replace("{PUNTOS_USUARIO}", $resultados_usuario[0]->puntos, $PRINCIPAL);
        $PRINCIPAL = str_replace("{RANKING_USUARIO}", $resultados_usuario[0]->puntos, $PRINCIPAL);
        $PRINCIPAL = str_replace("{MEDALLAS_USUARIO}", $resultados_usuario[0]->puntos, $PRINCIPAL);
        $PRINCIPAL = str_replace("{RANKING_MEDALLAS}", $resultados_usuario[0]->puntos, $PRINCIPAL);
        $PRINCIPAL = str_replace("{EMBLEMAS_USUARIO}", $resultados_usuario[0]->puntos, $PRINCIPAL);
        $PRINCIPAL = str_replace("{CERTIFICACIONES_USUARIO}", $resultados_usuario[0]->puntos, $PRINCIPAL);
        $PRINCIPAL = str_replace("{AVANCEMALLATOTAL}", $arreglo_row_avance[1], $PRINCIPAL);
        $PRINCIPAL = str_replace("{ROW_LISTA_PROGRAMAS_OBLIGATORIOS}", $arreglo_row_avance[0], $PRINCIPAL);
        $arreglo_row_avance_opcional = lms_integracion_programas($rut, $id_empresa, "opcional");
        $PRINCIPAL = str_replace("{ROW_LISTA_PROGRAMAS_OPCIONAL}", $arreglo_row_avance_opcional[0], $PRINCIPAL);
        $PRINCIPAL = str_replace("{SECCION_PREGUNTA}", ColocaBloquePreguntaPorObjeto($datos_objeto[0]->id, $rut, 4) , $PRINCIPAL);
        $PRINCIPAL = str_replace("{ROW_PESTANAS_LI_FOCOS}", ColocaPestanasFocosHome($rut, $id_empresa) , $PRINCIPAL);
        $PRINCIPAL = str_replace("{ID_MALLA_ENCODEADO}",$_GET["im"], $PRINCIPAL);
        $PRINCIPAL = str_replace("{ID_MALLA_ENCODEADA}",$_GET["im"], $PRINCIPAL);
        $arrayEmail = BuscaEmail($rut);
        $email_base64 = base64_encode($arrayEmail[0]->email);
        $word = $arrayEmail[0]->email . $secret;
        // echo "<br />word $word<br />";
        $secret = "0rcywyht45kuydf2svx4ctxzll1yr7gby8q0wz51";
        $word = $arrayEmail[0]->email . $secret;
        $token_hash = hash('sha256', $word);
        // echo $token_hash;
        $boton3 = "https://www.cotalker.com/auth/local?source=bcicapacitacion&email=" . $email_base64 . "&token=" . $token_hash . "";
        $boton4 = "https://www.compartebci.cl"; //echo "2ton3 $boton3";
        $PRINCIPAL = str_replace("{BOTON1}", $boton1, $PRINCIPAL);
        $PRINCIPAL = str_replace("{BOTON2}", $boton2, $PRINCIPAL);
        $PRINCIPAL = str_replace("{BOTON3}", $boton3, $PRINCIPAL);
        $PRINCIPAL = str_replace("{BOTON4}", $boton4, $PRINCIPAL);
        $PRINCIPAL = ColocaDatosPerfil($PRINCIPAL, $rut);
        echo $PRINCIPAL;
    }


	else if($seccion=="BuscaPersonas2020"){ 
		  $search = $_POST['search'];
		 $busqueda=BuscaPersonas2020($search);
			
		 foreach($busqueda as $bus){
							$esta_hoy_en_otro_lado=ControlDotacionVerificoRutEnOtroLado($bus->rut);
							$dato_oficina=ControlDotacionTraeDatosOficina($esta_hoy_en_otro_lado[0]->id_oficina);
							$response[] = array(
							"value"=>$bus->rut,
							"label"=>utf8_encode($bus->nombre),
							"alerta_otro_lado"=>$dato_oficina[0]->oficina,
							"alerta_2"=>'<div class="alert alert-warning" role="alert">
				  								This is a warning alert—check it out!
													</div>', 
							"alerta_cargos_criticos"=>'Alerta Cargos Criticos'); 
		 }
			echo json_encode($response);
			exit;
	}

else if ($seccion == "potencial_landing") {
					ControlDotacionInsertaAccesoLogin($_SESSION["user_"], $email, $response, $response->email, "Potencial Landing",  $_SESSION,$_POST["idt"]);	
	
        $rut = $_SESSION["user_"];
        $id_empresa = $_SESSION["id_empresa"];
  
  				//	ControlDotacionInsertaAccesoLogin($_SESSION["user_"], $email, $response, $response->email, "Potencial Landing V2",  $_SESSION,$_POST["idt"]);	

        $id_inst = ($_GET["id_inst"]);
        $profile = ($_GET["profile"]);
        $rut_col = Decodear3($_GET["rut_enc"]);
					
				$Array_sinJefe=Potencial_BuscaLineasSinJefedeJefe($id_empresa);
				foreach ($Array_sinJefe as $line ){
						Potencial_ActualizaJefedeJefe($line->id_comite, $line->rut_lider);
				}
        $perfil =Potencial_Perfil_Usuarios($rut, $id_empresa);
 				if($perfil==""){
 					echo "    <script>   alert('No tienes perfil de Socio ni Lider. Por favor, envianos un email a soporte@gop.cl');      location.href='?sw=logout';     </script>"; exit;
 				}

        $PRINCIPAL = (FuncionesTransversales(file_get_contents("views/potencial/" . $id_empresa . "_potencial_landing.html")));
        
        // busca AD sin estado pendientes en proceso no iniciada
        $alerta_acciones_desarrollo_ficha="<br><br>";
        $arrauRut=PotencialBuscaRutBajoRutLider($rut);
        //print_r($arrauRut);
        foreach ($arrauRut as $unico){
        	
									        		//ALertas Acciones Desarrollo sinEstado yt mas de 3 Meses 
										 $MonthThreeAgo = strtotime("-3 month");
										 $AlertasAD=PotencialBuscaAccionesSinEstado($unico->rut, $MonthThreeAgo);
												//echo "<br>rut ".$unico->rut;
												// print_r($AlertasAD);
										 //$alerta_acciones_desarrollo_ficha="";
										if(count($AlertasAD)>0){
											
											$alerta_acciones_desarrollo_ficha.="<div class='alert alert-danger'>";
											foreach ($AlertasAD as $unico){
												$UsuaAlertaAD=DatosUsuario_($unico->rut, $id_empresa);
												$alerta_acciones_desarrollo_ficha.="- <a href='?sw=potencial_ficha&rut_col=".Encodear3($unico->rut)."' class='btn btn-link' >
														<span style='color:#666'>" .$UsuaAlertaAD[0]->nombre_completo."</span>
														</a> tiene Acciones de Desarrollo con mas de 3 meses desde la fecha de definición sin Estado - ".utf8_encode($unico->plan)."<br>";
											}
											$alerta_acciones_desarrollo_ficha.="</div>";
										} else {
											
										}
								
        	
        }
        
 
        $PRINCIPAL = str_replace("{ALERTA_DESARROLLO}", $alerta_acciones_desarrollo_ficha, $PRINCIPAL);
        $PRINCIPAL = str_replace("{PERFIL}", $perfil, $PRINCIPAL);
        


        
        $PRINCIPAL = ColocaDatosPerfil($PRINCIPAL, $rut);
        echo $PRINCIPAL;
    }
 
 else if($seccion=="potencial_accdes_cuadrante_api_csv"){
 	
 	$v=$_GET["v"];
    
    if($v=="1"){

								$ahora				=		date('Y-m-d');
								$head_csv   	=   array('rut;plan;fundamento;estado;periodo;rut_creador');
								$filename="Potencial_Acciones_Desarrollo.csv";

							   $f = fopen('php://memory', 'w'); 
							   fputcsv($f, $head_csv);  
							   $array=potencial_csv_acciones_desarrollo_api_data();
							   //print_r($array);

							    foreach ($array as $line) { 
							    		$i++;
							          $line_csv[0]=$line->rut;
							       	  $line_csv[1]=$line->plan;
											  $line_csv[2]=$line->fundamento;
											  $line_csv[3]=$line->estado;

											  $line_csv[4]=$line->periodo;
											  $line_csv[5]=$line->rut_creador;
		
												
							   fputcsv($f, $line_csv,';');
							           
							    }
							 
							 
							    // reset the file pointer to the start of the file
							    fseek($f, 0);
							    header('Content-Type: application/csv');
							    header('Content-Disposition: attachment; filename="'.$filename.'";');
							    fpassthru($f);
								
								exit();	
    	
    }
 	
     if($v=="2"){

								$ahora				=		date('Y-m-d');
								$head_csv   	=   array('rut;cuadrante;fecha_cuadrante;periodo');
								$filename="Potencial_UltimoCuadrante.csv";

							   $f = fopen('php://memory', 'w'); 
							   fputcsv($f, $head_csv);  
							   $array=potencial_csv_ultimo_cuadrante_api_data();
							   //print_r($array);

							    foreach ($array as $line) { 
							    		$i++;
							          $line_csv[0]=$line->rut;
							       	  $line_csv[1]=$line->cuadrante;
											  $line_csv[2]=$line->fecha_cuadrante;
											  $line_csv[3]=$line->periodo;
		
												
							   fputcsv($f, $line_csv,';');
							           
							    }
							 
							 
							    // reset the file pointer to the start of the file
							    fseek($f, 0);
							    header('Content-Type: application/csv');
							    header('Content-Disposition: attachment; filename="'.$filename.'";');
							    fpassthru($f);
								
								exit();	
    	
    }	
 	
 }   
    
    else if($seccion=="sucesion_csv_informes"){
    
    $v=$_GET["v"];
    
    if($v=="1"){

								$ahora				=		date('Y-m-d');
								$head_csv   	=   array('GerenciaCargoasuceder;FondoCargoasuceder;DependenciaCargoasuceder;Cargoasuceder;Rutocupanteactualdelcargo;NombrecompletoOcupanteacutaldelcargo;Temporalidad;RutSucesor;NombreCompletoSucesor;FechaComite;GerenciaSucesor;FondoSucesor;DependenciaSucesor;CuadranteactualSucesor;FechacomitecuadranteactualSucesor;Tipodemovimiento');
								$filename="Informe_Sucesion_Actual_".$ahora.".csv";

							   $f = fopen('php://memory', 'w'); 
							   fputcsv($f, $head_csv);  
							   $array=sucesion_csv_informes_data_1($filtro);
							   //print_r($array);

							    foreach ($array as $line) { 
							    		$i++;
							          $line_csv[0]=$line->GerenciaCargoasuceder;
							       	  $line_csv[1]=$line->FondoCargoasuceder;
											  $line_csv[2]=$line->DependenciaCargoasuceder;
											  $line_csv[3]=$line->Cargoasuceder;

											  $line_csv[4]=$line->Rutocupanteactualdelcargo;
											  $line_csv[5]=$line->NombrecompletoOcupanteacutaldelcargo;
											  $line_csv[6]=$line->Temporalidad;
											 	$line_csv[7]=$line->RutSucesor;
											  $line_csv[8]=$line->NombreCompletoSucesor;
											  $line_csv[9]=$line->FechaComite;
											  $line_csv[10]=$line->GerenciaSucesor;
											 	$line_csv[11]=$line->FondoSucesor;
												$line_csv[12]=$line->DependenciaSucesor;
												$line_csv[13]=$line->CuadranteactualSucesor;
												$line_csv[14]=$line->FechacomitecuadranteactualSucesor;
												$line_csv[15]=$line->Tipodemovimiento;
		
												
							   fputcsv($f, $line_csv,';');
							           
							    }
							 
							 
							    // reset the file pointer to the start of the file
							    fseek($f, 0);
							    header('Content-Type: application/csv');
							    header('Content-Disposition: attachment; filename="'.$filename.'";');
							    fpassthru($f);
								
								exit();	
    	
    }
    
     if($v=="2"){

								$ahora				=		date('Y-m-d');
								$head_csv   	=   array('RutSucesor;NombreCompletoSucesor;FechaComite;GerenciaSucesor;FondoSucesor;DependenciaSucesor;CuadranteactualSucesor;Fechacomite;Tipodemovimiento;Vigencia;GerenciaCargoaSuceder;FondoCargoaSuceder;DependenciaCargoaSuceder;CargoaSuceder;Rutocupanteactualdelcargo;NombrecompletoOcupanteAcutaldelCargo;Temporalidad');
								$filename="Informe_Sucesion_Historico_".$ahora.".csv";

							   $f = fopen('php://memory', 'w'); 
							   fputcsv($f, $head_csv);  
							   $array=sucesion_csv_informes_data_2($filtro);
							   //print_r($array);

							    foreach ($array as $line) { 
							    		$i++;
							    			if($line->RutSucesor==""){continue;}
							    			if($line->Cargoasuceder==""){continue;}
							    			
							          $line_csv[0]=$line->RutSucesor;
							       	  $line_csv[1]=$line->NombreCompletoSucesor;
											  $line_csv[2]=$line->fecha;
											  $line_csv[3]=$line->GerenciaSucesor;
											  $line_csv[4]=$line->FondoSucesor;
											  $line_csv[5]=$line->DependenciaSucesor;
											  $line_csv[6]=$line->CuadranteactualSucesor;
											 	$line_csv[7]=$line->FechacomitecuadranteactualSucesor;
												$line_csv[10]=$line->Tipodemovimiento;
												$line_csv[11]="";
												$line_csv[12]=$line->GerenciaCargoasuceder;
												$line_csv[13]=$line->FondoCargoasuceder;
												$line_csv[14]=$line->DependenciaCargoasuceder;
												
												
												
												$line_csv[15]=$line->Cargoasuceder;
												$line_csv[16]=$line->Rutocupanteactualdelcargo;
												$line_csv[17]=$line->NombrecompletoOcupanteacutaldelcargo;
												$line_csv[18]=$line->Temporalidad;


												
							   fputcsv($f, $line_csv,';');
							           
							    }
							 
							 
							    // reset the file pointer to the start of the file
							    fseek($f, 0);
							    header('Content-Type: application/csv');
							    header('Content-Disposition: attachment; filename="'.$filename.'";');
							    fpassthru($f);
								
								exit();	
    	
    }   						
 
      if($v=="3"){

								$ahora				=		date('Y-m-d');
								$head_csv   	=   array('Posicion_Sin_Sucesion;Gerencia;Fondo;Dependencia');
								
								$filename="Informe_Posicion_Sin_Sucesion_".$ahora.".csv";
							   $f = fopen('php://memory', 'w'); 
							   fputcsv($f, $head_csv);  
							   $array=Potencial_DataBciPosicionVsPropuestosR2();
							   //print_r($array);

							    foreach ($array as $line) { 
							    		$i++;
							          $line_csv[0]=$line->d151;
							          $line_csv[1]=$line->d31;
							          $line_csv[2]=$line->d33;
							          $line_csv[3]=$line->d35;

										   fputcsv($f, $line_csv,';');
							    }
							 
							 
							    // reset the file pointer to the start of the file
							    fseek($f, 0);
							    header('Content-Type: application/csv');
							    header('Content-Disposition: attachment; filename="'.$filename.'";');
							    fpassthru($f);
								
								exit();	
    	
    }   
    	
    	exit();
    	
    }

else if ($seccion == "potencial_sucesion") {
        $rut = $_SESSION["user_"];
        $id_empresa = $_SESSION["id_empresa"];
        $id_inst = ($_GET["id_inst"]);
        $profile = ($_GET["profile"]);
        $rut_col = Decodear3($_GET["rut_enc"]);

				//busca perfil
        //$perfil ="USUARIO";
        $perfil =	Potencial_Perfil_Sucesion_Usuarios($rut, $id_empresa);
				$Rx			=	MiRx($rut);
				//echo "Rx $Rx";
 				//echo "Perfil Suc $perfil";
 				if($perfil==""){
 					echo "    <script>   alert('No tienes perfil de Socio ni Lider. Por favor, envianos un email a soporte@gop.cl');      location.href='?sw=com_mp_home';     </script>"; exit;
 				}

				if(Decodear3($_GET["id_del"])<>""){
					Potencial_EliminaComite_Sucesion(Decodear3($_GET["id_del"]));
				}
        
        if($_POST["nuevo_comite"]<>''){
                //echo "<br>guarda<br>";
              $rut_lider      =   LimpiaRutFront($_POST["rut_lider"]);
              $nombre_comite  =   ($_POST["nombre_comite"]);
              $fecha_comite  	=   ($_POST["fecha_comite"]);
              $gerenciaR1  	=   	LimpiaRutFront($_POST["rut_save"]);
             
              $UsuaLider      =   DatosUsuario_($rut_lider, $id_empresa);
              Potencial_Mis_Comites_insert_Nuevo_Comite_Sucesion_data($nombre_comite, $gerenciaR1, $rut, $fecha_comite, $id_empresa);

							$template_correo="template_potencial";
							$datos_usuario = mp_buscaDATOSPERSONAS($rut, $id_empresa);
							$titulo1 = "Creaste un nuevo Comité ".$nombre_comite;
							$subject = "Creaste un nuevo Comité ".$nombre_comite;
							$subtitulo1 = "Estimado(a) ".$datos_usuario[0]->nombre_completo."<br> <br>Has creado el comité ".$nombre_comite."<br><br>El siguiente paso es agregar Rut de Colaboradores y Rut Lider. ";
							$texto1 = "";$texto2 = "";$texto4 = "";$texto3 = "";$tipomensaje = "PotencialBci";
							$rut = $datos_usuario[0]->rut; $key = $datos_usuario[0]->rut;$to = $datos_usuario[0]->email;
							$nombreto = utf8_encode($datos_usuario[0]->nombre_completo);
							//SendGrid_Email($to, $nombreto, $from, $nombrefrom, $tipo, $subject, $titulo1, $subtitulo1, $texto1, $url, $texto_url, $texto2, $texto3, $texto4, $logo, $id_empresa, $url, $tipomensaje, $rut, $key,$template_correo);

        }

        $PRINCIPAL = (FuncionesTransversales(file_get_contents("views/potencial/" . $id_empresa . "_potencial_sucesion_index.html")));
							
							//echo "perfil $perfil";
							
				      if($perfil=="SOCIO DE NEGOCIO" or $perfil=="SUPER USER"){
				        $boton_crear_comite_SUCESION =   "
																							    <div class='alert alert-gris' style='    min-height: 120px;'>
																							    
																							<div class='titulo-heading'><img src='https://www.paneldeliderazgobci.cl/front/img/widget-link.png'> 
																							                                    	Crear Nuevo Comité de Sucesión</div>   
																							  <br>  
																							    <form action='?sw=potencial_sucesion' id='crear_comite' name='crear_comite' method='post'>
																							<div class='col-sm-4' style='    text-align: left;font-weight: bold;'><span class='bci_potencial_txt'> Nombre Comit&eacute;</span><br>
																							    <input type='text'   id='nombre_comite' name='nombre_comite' class='form form-control' style='font-weight: 300;' required/>
																							</div>
																							<div class='col-sm-3' style='    text-align: left;font-weight: bold;'><span class='bci_potencial_txt'>Nombre Jefatura de cargos a Suceder</span><br>
																							    
																 <input type='text' id='autocomplete' class='form form-control'>
																 <input type='hidden' id='selectuser_id' name='rut_save' />
																							    
																							</div>																							
																							<div class='col-sm-3' style='    text-align: left;font-weight: bold;'><span class='bci_potencial_txt'>Fecha de Realizaci&oacute;n</span><br>
																							    <input type='date'   id='fecha_comite' name='fecha_comite' class='form form-control' style='font-weight: 300;' required/>
																							</div>
																							<div class='col-sm-2' style='    text-align: left;font-weight: bold;'><span class=''></span><br>
																							      <input type='submit' class='btn btn-info' value='Crear Comit&eacute;' style='margin-top:0px;' />
																							</div>


																							    <input type='hidden' id='nuevo_comite' name='nuevo_comite' class='form form-control' value='1' style='margin-top:20px;' />

																							    </form>
																							</div>

				                                ";
												$texto_intro="Bienvenido(a) a Potencial Bci. Podrás crear comités, cargar colaboradores a ser mapeados y asignarles un Líder";                                
												
				        } else {
				                $boton_crear_comite_SUCESION="";
												$texto_intro="Bienvenido(a) a Potencial Bci. A continuación se despliegan los comités en los que tienes el rol de Líder para mapear a tus colaboradores.";                
				        }
        
        $texto_intro="";
                                //echo "PERFIL $perfil";
        $PRINCIPAL = str_replace("{BOTON_CREAR_COMITE_POTENCIAL_SUCESION}", $boton_crear_comite_SUCESION, $PRINCIPAL);
        $PRINCIPAL = str_replace("{TEXTO_INTRODUCTORIO_SEGUN_PERFIL}", $texto_intro, $PRINCIPAL);
        $PRINCIPAL = str_replace("{PERFIL}", $perfil, $PRINCIPAL);

					// Descarga Super Users
					$EsSU_descarga=Potencial_Es_SuperUsers($rut);
					if($EsSU_descarga>0){
						$reporteria_csv="<br><br><center><a href='?sw=potencial_descarga_reporte' class='btn btn-success'>Descarga Reporte Potencial</a></center>";
					} else {
						$reporteria_csv="";
					}
					$reporteria_csv="";
					        $PRINCIPAL = str_replace("{DESCARGA_REPORTERIA_CSV}", $reporteria_csv, $PRINCIPAL);

					//Descarga Socios Negocios
					$EsSN_descarga=Potencial_Es_SuperUsers($rut);
					if($rut=="17810781"){
						$EsSN_descarga=0;
					}
					
					if($EsSN_descarga>0){
							
						$DataBci_Gerencia			=Potencial_Data_Bci_groupby("d30");
						$DataBci_Fondo				=Potencial_Data_Bci_groupby("d32");
						$DataBci_Dependencia	=Potencial_Data_Bci_groupby("d34");

							$Options_Fondo.= "<option value=''></option>";
							$Options_Dependencia.= "<option value=''></option>";
						
						foreach ($DataBci_Gerencia as $UGer){
							$Options_Gerencia.= "<option value='".$UGer->dato."'>".$UGer->dato."</option>";
						}
						foreach ($DataBci_Fondo as $UFon){

							$Options_Fondo.= "<option value='".$UFon->dato."'>".$UFon->dato."</option>";
						}
						foreach ($DataBci_Dependencia as $UDep){
							$Options_Dependencia.= "<option value='".$UDep->dato."'>".$UDep->dato."</option>";
						}
						
						$reporteria_SN_csv_BK="<br><br>
						<center>
								
								<form name='descarga_csv' action='?sw=potencial_descarga_reporte' method='post'>
								
								<div class='col-lg-3'>Gerencia<br>
													<select name='gerencia' class='form form-control'>
														<option value=''></option>
															".$Options_Gerencia."
													</select>
								</div>
									
								<div class='col-lg-3'>Fondo<br>
												<select name='fondo' class='form form-control'>
																<option value=''></option>
															".$Options_Fondo."	
												</select>
								</div>
								<div class='col-lg-3'>Dependencia<br>
								
												<select name='dependencia' class='form form-control'>
															<option value=''></option>
															".$Options_Dependencia."
												</select>

								
								</div>
								<div class='col-lg-3'><br><input type='submit' class='btn btn-success' value='Descargar Reporte'></div>
								<input type='hidden' name='descarga_tipo' value='SN'>
								</form>
							
							</center><br><br>aaa";
							$reporteria_SN_csv=file_get_contents("views/potencial/" . $id_empresa . "_potencial_combobox.html");
							$reporteria_SN_csv = str_replace("{OPTIONS_GERENCIAS}", $Options_Gerencia, $reporteria_SN_csv);
							$reporteria_SN_csv = str_replace("{OPTIONS_FONDO}", $Options_Fondo, $reporteria_SN_csv);
							$reporteria_SN_csv = str_replace("{OPTIONS_DEPENDENCIA}", $Options_Dependencia, $reporteria_SN_csv);
							
					} else {
						$reporteria_SN_csv="";
					}

        $PRINCIPAL = str_replace("{DESCARGA_REPORTERIA_SN_CSV}", $reporteria_SN_csv, $PRINCIPAL);



				$EsSN_descarga=Potencial_Es_SuperUsers($rut);
			if($EsSN_descarga>0){
			$reporteria_SN_csv_descarga_sucesion="
			
			<div class='row'>
					<div class='col-lg-4'><center><a href='?sw=sucesion_csv_informes&v=1' class='btn btn-info'>Informe de Sucesi&oacute;n</a></center></div>
					<div class='col-lg-4'><center><a href='?sw=sucesion_csv_informes&v=2' class='btn btn-info' >Informe Hist&oacute;rico de Sucesores</a></center></div>
					<div class='col-lg-4'><center><a href='?sw=sucesion_csv_informes&v=3' class='btn btn-info' >Informe Sin Sucesi&oacute;n</a></center></div>
			</div>
			<br><br>
			";
				} else {
						$reporteria_SN_csv_descarga_sucesion="";
					}
        $PRINCIPAL = str_replace("{DESCARGA_REPORTERIA_SN_CSV_SUCESION}", $reporteria_SN_csv_descarga_sucesion, $PRINCIPAL);


        $PRINCIPAL = Potencial_Sucesion_Mis_Comites_estado_activo($PRINCIPAL, $rut, $perfil, $id_empresa, "activo");
        $PRINCIPAL = Potencial_Sucesion_Mis_Comites_estado_cierre($PRINCIPAL, $rut, $perfil, $id_empresa, "cerrado");

        $PRINCIPAL = ColocaDatosPerfil($PRINCIPAL, $rut);
        echo $PRINCIPAL;
    }
    
	else if($seccion=="filtro_dependencia_dado_gerencia_fondo"){
		$gerencia=$_POST["gerencia"];
		$fondo=$_POST["fondo"];
		$dependencia=TraigoDependenciaDadoGerenciaFondo($gerencia, $fondo);
		$options.="<option value=''></option>";
		foreach($dependencia as $dep){
			$options.="<option value='".$dep->dato."'>".$dep->dato."</option>";
		}
		echo $options;
	}
	else if($seccion=="filtro_fondo_dado_gerencia"){
		$gerencia=$_POST["gerencia"];
		$fondos=TraigoFondo($gerencia);
		$options.="<option value=''></option>";
		foreach($fondos as $fond){
			$options.="<option value='".$fond->dato."'>".$fond->dato."</option>";
		}
		echo $options;
	}
	
	else if($seccion=="filtro_dependencia_dado_gerencia"){
		$gerencia=$_POST["gerencia"];
		$dependencia=TraigoDependencia($gerencia);
		$options.="<option value=''></option>";
		foreach($dependencia as $dep){
			$options.="<option value='".$dep->dato."'>".$dep->dato."</option>";
			
		}
		echo $options;
		
	}
 else if ($seccion == "potencial_descarga_reporte")    {
	
								if($_POST["descarga_tipo"]=="SN"){
									$gerencia				= $_POST["gerencia"];
									$fondo					= $_POST["fondo"];
									$dependencia		= $_POST["dependencia"];
									
									$rut = $_SESSION["user_"];
									$Array_Rut_Potencial	=Potencial_Es_SuperUsers($rut);
									//print_r($Array_Rut_Potencial);
									
									$DataBci_Gerencia			=Potencial_Data_Bci_groupby("d30");
									$DataBci_Fondo				=Potencial_Data_Bci_groupby("d32");
									$DataBci_Dependencia	=Potencial_Data_Bci_groupby("d34");
									
									//echo "<br>$gerencia $fondo $dependencia";
									if($gerencia<>"")			{$JG=" and d30='".$gerencia."' ";}
									if($fondo<>"")				{$JF=" and d32='".$fondo."' ";}
									if($dependencia<>"")	{$JD=" and d34='".$dependencia."' ";}
									
									if($Array_Rut_Potencial>0){
										//echo "<h1>a</h1>";
										$JPers=" ";
									} else {
										$JPers=" and d30<>'GERENCIA CORPORATIVA GESTION PERSONAS' and rut<>'6926510'
										
										and rut<>'6461785'
and rut<>'6785528'
and rut<>'6966517'
and rut<>'7438369'
and rut<>'7663689'
and rut<>'7799138'
and rut<>'8576943'
and rut<>'10243251'
and rut<>'10269066'
and rut<>'10535909'
and rut<>'10667871'
and rut<>'10671495'
and rut<>'10739385'
										
										";
									}		
									
									$filtro=" where rut<>'' $JG $JF $JD $JPers";
								} else {
									//echo "<h1>b</h1>";
									$filtro="";
								}

								$ahora				=		date('Y-m-d');
								$head_csv   	=   array('Rut;Nombre;1er_Apellido;2do_Apellido;Gerencia;Fondo;Dependencia;Nombre_Puesto;Cuadrante_Actual_registrado_en_comite;Fecha_registro_Cuadrante_Actual;Comentario1;Comentario2;Comentario3;Comentario4;Fecha_Reporte');
								$filename="Reporte_Potencial_".$ahora.".csv";

							   $f = fopen('php://memory', 'w'); 
							   fputcsv($f, $head_csv);  
							   $array=Potencial_Busca_Array_reporte($filtro);
							   //print_r($array);

							    foreach ($array as $line) { 
							    		$i++;

							    	
							          $line_csv[0]=$line->rut_completo;
							       	  $line_csv[1]=$line->nombre;
											  $line_csv[2]=$line->paterno;
											  $line_csv[3]=$line->materno;
											  $line_csv[4]=$line->gerencia;
											  $line_csv[5]=$line->fondo;
											  $line_csv[6]=$line->dependencia;
											 	$line_csv[7]=$line->puesto;
											 	$cuadrante="";$fecha="";
											 	if($line->cuadrante_2020){
												 	$cuadrante=$line->cuadrante_2020;
											 		$fecha=$line->fecha_cuadrante_2020;
											 	} else {
												 	$cuadrante=$line->cuadrante_actual;
											 		$fecha=$line->fecha_actual;	 		
											 	}
											 	
											 	if($cuadrante=="") {continue;}
											 	
											 	
											 	if($cuadrante=="10"){$cuadrante="5+";}
										 		$line_csv[8]=$cuadrante;
												$line_csv[9]=$fecha;


									   $Unico->Comentario4 = str_replace("<br>", "", $Unico->Comentario4);
									   $Unico->Comentario4 = str_replace(";", ",", $Unico->Comentario4); 
									   $Unico->Comentario4 = str_replace("'", "", $Unico->Comentario4); 		    
										 $Unico->Comentario4 = str_replace(array("\r", "\n"), '',  $Unico->Comentario4);
										 $Unico->Comentario4 = str_replace(array("\r", "\n"), '',  $Unico->Comentario4);
										 $Unico->Comentario4 = str_replace(array("\r", "\n"), '',  $Unico->Comentario4);

									   $Unico->Comentario3 = str_replace("<br>", "", $Unico->Comentario3);
									   $Unico->Comentario3 = str_replace(";", ",", $Unico->Comentario3); 
									   $Unico->Comentario3 = str_replace("'", "", $Unico->Comentario3); 		    
										 $Unico->Comentario3 = str_replace(array("\r", "\n"), '',  $Unico->Comentario3);
										 $Unico->Comentario3 = str_replace(array("\r", "\n"), '',  $Unico->Comentario3);
										 $Unico->Comentario3 = str_replace(array("\r", "\n"), '',  $Unico->Comentario3);
										 
									   $Unico->Comentario2 = str_replace("<br>", "", $Unico->Comentario2);
									   $Unico->Comentario2 = str_replace(";", ",", $Unico->Comentario2); 
									   $Unico->Comentario2 = str_replace("'", "", $Unico->Comentario2); 		    
										 $Unico->Comentario2 = str_replace(array("\r", "\n"), '',  $Unico->Comentario2);
										 $Unico->Comentario2 = str_replace(array("\r", "\n"), '',  $Unico->Comentario2);
										 $Unico->Comentario2 = str_replace(array("\r", "\n"), '',  $Unico->Comentario2);
										 
									   $Unico->Comentario1 = str_replace("<br>", "", $Unico->Comentario1);
									   $Unico->Comentario1 = str_replace(";", ",", $Unico->Comentario1); 
									   $Unico->Comentario1 = str_replace("'", "", $Unico->Comentario1); 		    
										 $Unico->Comentario1 = str_replace(array("\r", "\n"), '',  $Unico->Comentario1);
										 $Unico->Comentario1 = str_replace(array("\r", "\n"), '',  $Unico->Comentario1);
										 $Unico->Comentario1 = str_replace(array("\r", "\n"), '',  $Unico->Comentario1);			 			 			 					
												
												
												
												$line_csv[10]=$line->Comentario1;
												$line_csv[11]=$line->Comentario2;
												$line_csv[12]=$line->Comentario3;
												$line_csv[13]=$line->Comentario4;
												$line_csv[14]=$line->ahora;
												
												//echo "hola";
												//echo "<br> $line_csv";
												
							   fputcsv($f, $line_csv,';');
							           
							    }
							 
							 
							    // reset the file pointer to the start of the file
							    fseek($f, 0);
							    header('Content-Type: application/csv');
							    header('Content-Disposition: attachment; filename="'.$filename.'";');
							    fpassthru($f);
								
								exit();
								
								
							}
							  
							else if($seccion=="test_buscador"){
								
								$PRINCIPAL = (FuncionesTransversales(file_get_contents("views/potencial/test_buscador.html")));
									echo $PRINCIPAL;
									
							}

								else if($seccion=="BuscaPersonas2020_v2"){ 
									  $search = $_POST['search'];
									 $busqueda=BuscaPersonas2020_v2($search);
										
									 foreach($busqueda as $bus){
										
										$response[] = array(
										"value"=>$bus->rut,
										"label"=>utf8_encode($bus->nombre_completo),
										"alerta_otro_lado"=>$dato_oficina[0]->oficina,
										"alerta_2"=>'<div class="alert alert-warning" role="alert">
							  This is a warning alert—check it out!
							</div>', 
										"alerta_cargos_criticos"=>'Alerta Cargos Criticos'); 
									 }
									echo json_encode($response);
									exit;
	}
	
	

else if ($seccion == "potencial_sucesion_comite") {
	
//ini_set('display_errors', 1);ini_set('display_startup_errors', 1);error_reporting(E_ALL);//exit();//

	
        $rut = $_SESSION["user_"];
        $id_empresa = $_SESSION["id_empresa"];
        $id_inst = ($_GET["id_inst"]);
        $profile = ($_GET["profile"]);
        $rut_col = Decodear3($_GET["rut_enc"]);
 				$id_comite = Decodear3($_GET["id_comite"]);
 				
        $CC = ($_GET["CC"]);
        if($CC=="1"){
        	Potencial_Sucesion_Update_Cierre_Comite($id_comite);
        	sleep(1);
        }
   
        $array_comite=Potencial_Sucesion_Comites_data($id_comite,$id_empresa);
       	//print_r($array_comite);        //exit();

 				Potencial_Sucesion_Actualiza_GerentesR2($array_comite[0]->gerenciaR1,$id_empresa, $id_comite);  

        $perfil ="USUARIO";
        $perfil =Potencial_Perfil_Sucesion_Usuarios($rut, $id_empresa);
  
        //echo "perfil $perfil";
        $saveform = ($_GET["saveform"]);

        if($saveform=="sf"){
                $nuevo_cuadrante    =   $_POST["nuevo_cuadrante"];
                $comentario         =   $_POST["comentario"];
                $id                 =   $_POST["id"];
								$rut_col_sf         =   Decodear3($_POST["rut_col"]);
        				//print_r($_POST);
        				
        				if($perfil=="LIDER"){
        					//Potencial_comite_update_tbl_data_bci_lider($nuevo_cuadrante, $comentario, $id_comite, $rut, $id, $id_empresa,$perfil, $rut_col_sf);
        				} else {
        					//Potencial_comite_update_tbl_data_bci_socio($nuevo_cuadrante, $comentario, $id_comite, $rut, $id, $id_empresa,$perfil, $rut_col_sf);	
        				}
                


								if($nuevo_cuadrante=="10"){$nuevo_cuadrante="5+";}
								$array_usu=Potencial_BuscaColaborador($id, $id_empresa);
								//print_r($array_usu);
								$datos_colaborador = UsuarioEnBasePersonas($array_usu[0]->rut, $rutcontodo);
								$datos_lider = UsuarioEnBasePersonas($array_usu[0]->rut_lider, $rutcontodo);
								$datos_usuario = UsuarioEnBasePersonas($rut, $rutcontodo);
								$datos_socio = UsuarioEnBasePersonas($array_usu[0]->rut_socio, $rutcontodo);
								//print_r($datos_colaborador);
								    if($perfil=="SOCIO DE NEGOCIO")     {

								$template_correo="template_potencial"; $tipo="";
								$datos_usuario = mp_buscaDATOSPERSONAS($rut, $id_empresa);
								$titulo1 = "Has modificado el cuadrante de ".$datos_colaborador[0]->nombre_completo;
								$subject = "Has modificado el cuadrante de ".$datos_colaborador[0]->nombre_completo;
								$subtitulo1 = "Estimado(a) ".$datos_usuario[0]->nombre_completo."<br> <br>Has modificado el cuadrante de ".$datos_colaborador[0]->nombre_completo.", que pertenece al lider ".$datos_lider[0]->nombre_completo. "";
								$texto1 = "<br> Nuevo Cuadrante: ".$nuevo_cuadrante."<br>Comentario: ".($comentario);$texto2 = "";$texto4 = "";$texto3 = "";$tipomensaje = "PotencialBci";
								$rut = $datos_usuario[0]->rut; $key = $datos_usuario[0]->rut;$to = $datos_usuario[0]->email;
								$nombreto = utf8_encode($datos_usuario[0]->nombre_completo);
								$to= ($datos_usuario[0]->email);
								//SendGrid_Email($to, $nombreto, $from, $nombrefrom, $tipo, $subject, $titulo1, $subtitulo1, $texto1, $url, $texto_url, $texto2, $texto3, $texto4, $logo, $id_empresa, $url, $tipomensaje, $rut, $key,$template_correo);

								$template_correo="template_potencial"; $tipo="";
								$datos_usuario = mp_buscaDATOSPERSONAS($rut, $id_empresa);
								$titulo1 = "Han modificado el cuadrante de ".$datos_colaborador[0]->nombre_completo;
								$subject = "Han modificado el cuadrante de ".$datos_colaborador[0]->nombre_completo;
								$subtitulo1 = "Estimado(a) ".$datos_lider[0]->nombre_completo."<br> <br>El Socio de Negocio ".$datos_usuario[0]->nombre_completo.", ha modificado el cuadrante de ".$datos_colaborador[0]->nombre_completo."";
								$texto1 = "<br> Nuevo Cuadrante: ".$nuevo_cuadrante."<br>Comentario: ".($comentario);$texto2 = "";$texto4 = "";$texto3 = "";$tipomensaje = "PotencialBci";
								$rut = $datos_usuario[0]->rut; $key = $datos_usuario[0]->rut;$to = $datos_usuario[0]->email;
								$nombreto = utf8_encode($datos_lider[0]->nombre_completo);
								$to= ($datos_lider[0]->email);
								//SendGrid_Email($to, $nombreto, $from, $nombrefrom, $tipo, $subject, $titulo1, $subtitulo1, $texto1, $url, $texto_url, $texto2, $texto3, $texto4, $logo, $id_empresa, $url, $tipomensaje, $rut, $key,$template_correo);

								        }
								    if($perfil=="LIDER")     {
								$template_correo="template_potencial"; $tipo="";
								$datos_usuario = mp_buscaDATOSPERSONAS($rut, $id_empresa);
								$titulo1 = "Has modificado el cuadrante de ".$datos_colaborador[0]->nombre_completo;
								$subject = "Has modificado el cuadrante de ".$datos_colaborador[0]->nombre_completo;
								$subtitulo1 = "Estimado(a) ".$datos_usuario[0]->nombre_completo."<br> <br>Has modificado el cuadrante de ".$datos_colaborador[0]->nombre_completo."";
								$texto1 = "<br> Nuevo Cuadrante: ".$nuevo_cuadrante."<br>Comentario: ".($comentario);$texto2 = "";$texto4 = "";$texto3 = "";$tipomensaje = "PotencialBci";
								$rut = $datos_usuario[0]->rut; $key = $datos_usuario[0]->rut;$to = $datos_usuario[0]->email;
								$nombreto = utf8_encode($datos_usuario[0]->nombre_completo);
								$to= ($datos_usuario[0]->email);
								//SendGrid_Email($to, $nombreto, $from, $nombrefrom, $tipo, $subject, $titulo1, $subtitulo1, $texto1, $url, $texto_url, $texto2, $texto3, $texto4, $logo, $id_empresa, $url, $tipomensaje, $rut, $key,$template_correo);

								$template_correo="template_potencial"; $tipo="";
								$datos_usuario = mp_buscaDATOSPERSONAS($rut, $id_empresa);
								$titulo1 = "Han modificado el cuadrante de ".$datos_colaborador[0]->nombre_completo;
								$subject = "Han modificado el cuadrante de ".$datos_colaborador[0]->nombre_completo;
								$subtitulo1 = "Estimado(a) ".$datos_socio[0]->nombre_completo."<br> <br>El Lider ".$datos_lider[0]->nombre_completo.", ha modificado el cuadrante de ".$datos_colaborador[0]->nombre_completo."";
								$texto1 = "<br> Nuevo Cuadrante: ".$nuevo_cuadrante."<br>Comentario: ".($comentario);$texto2 = "";$texto4 = "";$texto3 = "";$tipomensaje = "PotencialBci";
								$rut = $datos_usuario[0]->rut; $key = $datos_usuario[0]->rut;$to = $datos_usuario[0]->email;
								$nombreto = utf8_encode($datos_socio[0]->nombre_completo);
								$to= ($datos_socio[0]->email);
								//SendGrid_Email($to, $nombreto, $from, $nombrefrom, $tipo, $subject, $titulo1, $subtitulo1, $texto1, $url, $texto_url, $texto2, $texto3, $texto4, $logo, $id_empresa, $url, $tipomensaje, $rut, $key,$template_correo);

                        }

        }

        $PRINCIPAL = (FuncionesTransversales(file_get_contents("views/potencial/" . $id_empresa . "_potencial_sucesion_comite.html")));
        $id_comite = Decodear3($_GET["id_comite"]);
        
				if($perfil=="SOCIO DE NEGOCIO"){


				        $boton_subir_colaboradores =   "
				        <div class='alert alert-gris'>

										<div class='titulo-heading'><img src='https://www.paneldeliderazgobci.cl/front/img/widget-link.png'> Subir Colaboradores a ser mapeados</div>

				            <form name='importa' method='post' action='?sw=potencial_save_colaboradores' id='importa' enctype='multipart/form-data'>
				                <div class=''>


				                <a href='https://www.potencialbci.cl/front/docs/subir_colaboradores.xlsx?v2'
				                class='btn btn-link' style='    color: #007cc6;background: #d9edf7;'>Descargar Plantilla</a>

				                        <p> <center><input type='file' name='excel' style='display:inline;' />
				                             <button type='submit' class='btn btn-info ' style='display:inline;'>
				                    	<i class='fas fa-upload'></i> Subir Colaboradores
				                    </button>
				                    <input type='hidden' value='upload' name='action' /> </center></p>
				                    <input type='hidden' id='id_comite' name='id_comite' value='".$id_comite."' />

				                </div>
				            </form>

				        </div>

				                                ";
				    } else {
				     $boton_subir_colaboradores =   "";
				}
				
			if($rut=="17810781"){
						$boton_subir_colaboradores="";
			}

        $PRINCIPAL = str_replace("{BOTON_SUBIR_NOMINA_COMITE_POTENCIAL}", $boton_subir_colaboradores, $PRINCIPAL);
        $PRINCIPAL = str_replace("{LIDER_COMITE}",      utf8_encode($array_comite[0]->nombre_completo), $PRINCIPAL);
        $PRINCIPAL = str_replace("{NOMBRE_COMITE}",     utf8_encode($array_comite[0]->nombre), $PRINCIPAL);
        $PRINCIPAL = str_replace("{ID_COMITE_ENC}",     $_GET["id_comite"], $PRINCIPAL);

				if($_SESSION["user_"]==$array_comite[0]->rut or $_SESSION["user_"]=="10365815"){
						
						if($array_comite[0]->comite_cerrado<>"SI"){
						$boton_cierra_SN="
						<center style='float: right;'>
							<form name='potencial_comite_cerrar' id='potencial_comite_cerrar' action='?sw=potencial_sucesion_comite&id_comite=".Encodear3($id_comite)."&CC=1' method='post'>
								<input type='submit' class='btn btn-danger' value='Cerrar el Comité' style='padding-bottom: 3px;padding-top: 3px;'> <input type='checkbox' class='' name='email_lider' id='email_lider'> Chequea aquí si quieres enviar email a Líderes 
							</form>
						</center>
						<br>";	
						} else {
						$boton_cierra_SN="";	
						}
						
				} else {
						$boton_cierra_SN="";
				}

				 $PRINCIPAL = str_replace("{POTENCIAL_CIERRE_POTENCIAL_SN}", $boton_cierra_SN, $PRINCIPAL);

				if($array_comite[0]->comite_cerrado=="SI"){
					$alert_comite_cerrado="<br><br><center><div class='alert alert-danger'>Comité Cerrado</div></center>";
				} else {
					$alert_comite_cerrado="";
				}
			
			//echo "perfil $perfil";
			
				$PRINCIPAL = str_replace("{COMITE_CERRADO}", $alert_comite_cerrado, $PRINCIPAL);
        $PRINCIPAL = Potencial_Sucesion_Colaboradores_Comites($PRINCIPAL, $id_comite, $rut, $perfil, $id_empresa);
        
        $boxfiltro = ($_GET["boxfiltro"]);
        //$PRINCIPAL = Potencial_Box9_Comites($PRINCIPAL, $id_comite, $rut, $perfil, $boxfiltro, $id_empresa);
        //$PRINCIPAL = Potencial_Bitacora_Comites($PRINCIPAL, $id_comite, $rut, $perfil, $id_empresa);

        $PRINCIPAL = ColocaDatosPerfil($PRINCIPAL, $rut);
        echo $PRINCIPAL;
}


else if ($seccion == "potencial") {
        $rut = $_SESSION["user_"];
        $id_empresa = $_SESSION["id_empresa"];
        $id_inst = ($_GET["id_inst"]);
        $profile = ($_GET["profile"]);
        $rut_col = Decodear3($_GET["rut_enc"]);

        $gerencia_est 		= ($_POST["gerencia_est"]);
        $fondo_est 				= ($_POST["fondo_est"]);
        $dependencia_est 	= ($_POST["dependencia_est"]);

				//echo 		"gerencia est $gerencia_est $fondo_est $dependencia_est";
				$Array_sinJefe=Potencial_BuscaLineasSinJefedeJefe($id_empresa);
					//print_r($Array_sinJefe);
				foreach ($Array_sinJefe as $line ){
						Potencial_ActualizaJefedeJefe($line->id_comite, $line->rut_lider);
				}

				//busca perfil
        //$perfil ="USUARIO";
        $perfil =Potencial_Perfil_Usuarios($rut, $id_empresa);
				
 				//echo "perfil $perfil ";
 				if($perfil==""){
 					echo "    <script>   alert('No tienes perfil de Socio ni Lider. Por favor, envianos un email a soporte@gop.cl');      location.href='?sw=com_mp_home';     </script>"; exit;
 				}

				if(Decodear3($_GET["id_del"])<>""){
					Potencial_EliminaComite(Decodear3($_GET["id_del"]));
				}
        //print_r($_POST);
        if($_POST["nuevo_comite"]<>''){
                //echo "<br>guarda<br>";
              $rut_lider      =   LimpiaRutFront($_POST["rut_lider"]);
              $nombre_comite  =   ($_POST["nombre_comite"]);
              $fecha_comite  =   ($_POST["fecha_comite"]);
              $UsuaLider      =   DatosUsuario_($rut_lider, $id_empresa);
              Potencial_Mis_Comites_insert_Nuevo_Comite_data($nombre_comite, $rut, $fecha_comite, $id_empresa);

							$template_correo="template_potencial";
							$datos_usuario = mp_buscaDATOSPERSONAS($rut, $id_empresa);
							$titulo1 = "Creaste un nuevo Comité ".$nombre_comite;
							$subject = "Creaste un nuevo Comité ".$nombre_comite;
							$subtitulo1 = "Estimado(a) ".$datos_usuario[0]->nombre_completo."<br> <br>Has creado el comité ".$nombre_comite."<br><br>El siguiente paso es agregar Rut de Colaboradores y Rut Lider. ";
							$texto1 = "";$texto2 = "";$texto4 = "";$texto3 = "";$tipomensaje = "PotencialBci";
							$rut = $datos_usuario[0]->rut; $key = $datos_usuario[0]->rut;$to = $datos_usuario[0]->email;
							$nombreto = utf8_encode($datos_usuario[0]->nombre_completo);
							//SendGrid_Email($to, $nombreto, $from, $nombrefrom, $tipo, $subject, $titulo1, $subtitulo1, $texto1, $url, $texto_url, $texto2, $texto3, $texto4, $logo, $id_empresa, $url, $tipomensaje, $rut, $key,$template_correo);

        }


        $PRINCIPAL = (FuncionesTransversales(file_get_contents("views/potencial/" . $id_empresa . "_potencial_index.html")));

				      if($perfil=="SOCIO DE NEGOCIO"){
				        $boton_crear_comite =   "
				    <div class='alert alert-gris' style='    min-height: 120px;'>
				    
				<div class='titulo-heading'><img src='https://www.paneldeliderazgobci.cl/front/img/widget-link.png'> 
				                                    	Crear Nuevo Comité</div>   
				  <br>  
				    <form action='?sw=potencial' id='crear_comite' name='crear_comite' method='post'>
				<div class='col-sm-6' style='    text-align: left;font-weight: bold;'><span class='bci_potencial_txt'> Nombre Comit&eacute;</span><br>
				    <input type='text'   id='nombre_comite' name='nombre_comite' class='form form-control' style='font-weight: 300;' required/>
				</div>
				<div class='col-sm-3' style='    text-align: left;font-weight: bold;'><span class='bci_potencial_txt'>Fecha de Realizaci&oacute;n</span><br>
				    <input type='date'   id='fecha_comite' name='fecha_comite' class='form form-control' style='font-weight: 300;' required/>
				</div>
				<div class='col-sm-3' style='    text-align: left;font-weight: bold;'><span class=''></span><br>
				      <input type='submit' class='btn btn-info' value='Crear Comit&eacute;' style='margin-top:0px;' />
				</div>

				    <input type='hidden' id='nuevo_comite' name='nuevo_comite' class='form form-control' value='1' style='margin-top:20px;' />

				    </form>
				</div>

				                                ";
				$texto_intro="Bienvenido(a) a Potencial Bci. Podrás crear comités, cargar colaboradores a ser mapeados y asignarles un Líder";                                
				        } else {
				                $boton_crear_comite="";
				$texto_intro="Bienvenido(a) a Potencial Bci. A continuación se despliegan los comités en los que tienes el rol de Líder para mapear a tus colaboradores.";                
				        }
        
        
        
                                //echo "PERFIL $perfil";
	        $PRINCIPAL = str_replace("{BOTON_CREAR_COMITE_POTENCIAL}", $boton_crear_comite, $PRINCIPAL);
	        $PRINCIPAL = str_replace("{TEXTO_INTRODUCTORIO_SEGUN_PERFIL}", $texto_intro, $PRINCIPAL);
	        $PRINCIPAL = str_replace("{PERFIL}", $perfil, $PRINCIPAL);

					// Descarga Super Users
					$EsSU_descarga=Potencial_Es_SuperUsers($rut);
					if($EsSU_descarga>0){
						$reporteria_csv="<br><br><center><a href='?sw=potencial_descarga_reporte' class='btn btn-success'>Descarga Reporte Potencial</a></center>";
					} else {
						$reporteria_csv="";
					}
					$reporteria_csv="";
					
					$PRINCIPAL = str_replace("{DESCARGA_REPORTERIA_CSV}", $reporteria_csv, $PRINCIPAL);

					//Descarga Socios Negocios
					$EsSN_descarga=Potencial_Es_Socio($rut);
					if($rut=="17810781"){
						$EsSN_descarga=0;
					}
					
					if($EsSN_descarga>0){
							
						$DataBci_Gerencia			=Potencial_Data_Bci_groupby("d30");
						$DataBci_Fondo				=Potencial_Data_Bci_groupby("d32");
						$DataBci_Dependencia	=Potencial_Data_Bci_groupby("d34");
						
							$Options_Gerencia.= "<option value=''></option>";
						foreach ($DataBci_Gerencia as $UGer){
							$Options_Gerencia.= "<option value='".$UGer->dato."'>".$UGer->dato."</option>";
						}
							$Options_Fondo.= "<option value=''></option>";

						foreach ($DataBci_Fondo as $UFon){
							$Options_Fondo.= "<option value='".$UFon->dato."'>".$UFon->dato."</option>";
						}

							$Options_Dependencia.= "<option value=''></option>";

						foreach ($DataBci_Dependencia as $UDep){
							$Options_Dependencia.= "<option value='".$UDep->dato."'>".$UDep->dato."</option>";
						}
						
						$reporteria_SN_csv_BK="<br><br>
														<center>
																
																<form name='descarga_csv' action='?sw=potencial_descarga_reporte' method='post'>
																
																<div class='col-lg-3'>Gerencia<br>
																					<select name='gerencia' class='form form-control'>
																						<option value=''></option>
																							".$Options_Gerencia."
																					</select>
																</div>
																	
																<div class='col-lg-3'>Fondo<br>
																				<select name='fondo' class='form form-control'>
																								<option value=''></option>
																							".$Options_Fondo."	
																				</select>
																</div>
																<div class='col-lg-3'>Dependencia<br>
																
																				<select name='dependencia' class='form form-control'>
																							<option value=''></option>
																							".$Options_Dependencia."
																				</select>

																
																</div>
																<div class='col-lg-3'><br><input type='submit' class='btn btn-success' value='Descargar Reporte'></div>
																<input type='hidden' name='descarga_tipo' value='SN'>
																</form>
															
															</center><br>
															
															
															<br>
											<div class='col-lg-3'>
												<a href='?sw=potencial_descarga_reporte_acciones_desarrollo' class='btn btn-info'>Descargar Acciones de Desarrollo (Api)</a>
											</div>
											<div class='col-lg-3'>
												<a href='?sw=potencial_descarga_reporte_ultimo_cuadradnte' class='btn btn-info'>Descargar Ultimo Cuadrante (Api)</a>
											</div>
											<div class='col-lg-3'>Ingresar RUT para ver Ficha <br>							

													<form name='potencial_ficha' action='?sw=potencial_ficha' method='post'>
													<input type='text' id='rut_col' name='rut_col'>
											</div>
											<div class='col-lg-3'><br>
																<input type='submit' class='btn btn-success' value='Ver Ficha'>
											</div>
													</form>

															
							";
							$reporteria_SN_csv=file_get_contents("views/potencial/" . $id_empresa . "_potencial_combobox.html");
							$reporteria_SN_csv = str_replace("{OPTIONS_GERENCIAS}", $Options_Gerencia, $reporteria_SN_csv);
							$reporteria_SN_csv = str_replace("{OPTIONS_FONDO}", $Options_Fondo, $reporteria_SN_csv);
							$reporteria_SN_csv = str_replace("{OPTIONS_DEPENDENCIA}", $Options_Dependencia, $reporteria_SN_csv);

											$Estadis=Potencial_Estadisticas($id_empresa, $gerencia_est, $fondo_est, $dependencia_est);				
											
											
								$reporteria_SN_csv = str_replace("{NUMERO_COMITES}", $Estadis[1], $reporteria_SN_csv);
								$reporteria_SN_csv = str_replace("{NUMERO_COMITES_ABIERTOS}", $Estadis[2], $reporteria_SN_csv);
								$reporteria_SN_csv = str_replace("{NUMERO_COMITES_CERRADOS}", $Estadis[3], $reporteria_SN_csv);

								$reporteria_SN_csv = str_replace("{NUMERO_COLABORADORES}", $Estadis[4], $reporteria_SN_csv);
								$reporteria_SN_csv = str_replace("{NUMERO_2_3_6}", $Estadis[5], $reporteria_SN_csv);
								$reporteria_SN_csv = str_replace("{NUMERO_COLABORADORES_5_5+}", $Estadis[6], $reporteria_SN_csv);
								$reporteria_SN_csv = str_replace("{NUMERO_COLABORADORES_1_4_7_8_9}", $Estadis[7], $reporteria_SN_csv);

				
							
							
					} else {
						$reporteria_SN_csv="";
					}

        $PRINCIPAL = str_replace("{DESCARGA_REPORTERIA_SN_CSV}", $reporteria_SN_csv, $PRINCIPAL);

					$EsSN_descarga=Potencial_Es_Socio($rut);
					if($rut=="17810781"){
						$EsSN_descarga=0;
					}
				
				if($EsSN_descarga>0){
				//echo "<h1>AAA</h1>";
						
						$Options_Gerencia="";
						$Options_Fondo="";
						$Options_Dependencia="";
						
						$DataBci_Gerencia			=Potencial_Data_Bci_groupby("d30");
						$DataBci_Fondo				=Potencial_Data_Bci_groupby("d32");
						$DataBci_Dependencia	=Potencial_Data_Bci_groupby("d34");
						
							$Options_Gerencia.= "<option value=''></option>";
						foreach ($DataBci_Gerencia as $UGer){
							$Options_Gerencia.= "<option value='".$UGer->dato."'>".$UGer->dato."</option>";
						}
							$Options_Fondo.= "<option value=''></option>";

						foreach ($DataBci_Fondo as $UFon){
							$Options_Fondo.= "<option value='".$UFon->dato."'>".$UFon->dato."</option>";
						}

							$Options_Dependencia.= "<option value=''></option>";

						foreach ($DataBci_Dependencia as $UDep){
							$Options_Dependencia.= "<option value='".$UDep->dato."'>".$UDep->dato."</option>";
						}
						
						$reporteria_SN_csv_BK="<br><br>
														<center>
																
																<form name='descarga_csv' action='?sw=potencial_descarga_reporte' method='post'>
																
																<div class='col-lg-3'>Gerencia<br>
																					<select name='gerencia' class='form form-control'>
																						<option value=''></option>
																							".$Options_Gerencia."
																					</select>
																</div>
																	
																<div class='col-lg-3'>Fondo<br>
																				<select name='fondo' class='form form-control'>
																								<option value=''></option>
																							".$Options_Fondo."	
																				</select>
																</div>
																<div class='col-lg-3'>Dependencia<br>
																
																				<select name='dependencia' class='form form-control'>
																							<option value=''></option>
																							".$Options_Dependencia."
																				</select>

																
																</div>
																<div class='col-lg-3'><br><input type='submit' class='btn btn-success' value='Descargar Reporte'></div>
																<input type='hidden' name='descarga_tipo' value='SN'>
																</form>
															
															</center><br>
															
															
															<br>
											<div class='col-lg-3'>
												<a href='?sw=potencial_descarga_reporte_acciones_desarrollo' class='btn btn-info'>Descargar Acciones de Desarrollo (Api)</a>
											</div>
											<div class='col-lg-3'>
												<a href='?sw=potencial_descarga_reporte_ultimo_cuadradnte' class='btn btn-info'>Descargar Ultimo Cuadrante (Api)</a>
											</div>
											<div class='col-lg-3'>Ingresar RUT para ver Ficha<br>							

													<form name='potencial_ficha' action='?sw=potencial_ficha' method='post'>
													<input type='text' id='rut_col' name='rut_col'>
											</div>
											<div class='col-lg-3'><br>
																<input type='submit' class='btn btn-success' value='Ver Ficha'>
											</div>
													</form>

															
							";
							
							$reporteria_SN_busqueda_csv=file_get_contents("views/potencial/" . $id_empresa . "_potencial_combobox_2.html");
							$reporteria_SN_busqueda_csv = str_replace("{OPTIONS_GERENCIAS}", $Options_Gerencia, $reporteria_SN_busqueda_csv);
							$reporteria_SN_busqueda_csv = str_replace("{OPTIONS_FONDO}", $Options_Fondo, $reporteria_SN_busqueda_csv);
							$reporteria_SN_busqueda_csv = str_replace("{OPTIONS_DEPENDENCIA}", $Options_Dependencia, $reporteria_SN_busqueda_csv);
											
				
							
							
					} 				
				
				else {
					
					//echo "<h1>bbb</h1>";
						$reporteria_SN_busqueda_csv="";
					}

				//echo "<br><h3>reporteria_SN_busqueda_csv</h3>".$reporteria_SN_busqueda_csv;
				// Filtros por Cuadrantes
				$row_cols_filtro="";
				//TipoCuadrante
				if($_POST["TipoCuadrante"]<>""){
					
					 
					 if($_POST["TipoDescarga"]=="Excel"){
					 	
												$ahora				=		date('Y-m-d');
												$head_csv   	=   array('Rut;Nombre;1er_Apellido;2do_Apellido;Cargo;Gerencia;Fondo;Dependencia;Cuadrante;Fecha');
												$filename="Reporte_Potencial_TipoCuadrante.csv";

											   $f = fopen('php://memory', 'w'); 
											   fputcsv($f, $head_csv);  

							$Array_Cols_Por_Tipo_Cuadrante	=	Potencial_Cols_Por_Tipo_Cuadrante($_POST["TipoCuadrante"],$_POST["gerencia_est2"],$_POST["fondo_est2"],$_POST["dependencia_est2"]);
					
							$row_cols_filtro.="
									<div class='row'>
											<div class='col-lg-1 card-title' style=' padding-left: 20px;'>RUT</div>
											<div class='col-lg-4 card-title' style=' padding-left: 20px;'>NOMBRE</div>
											<div class='col-lg-4 card-title' style=' padding-left: 20px;'>CARGO</div>
											<div class='col-lg-1 card-title' style=' padding-left: 20px;'>CUAD</div>
											<div class='col-lg-2 card-title' style=' padding-left: 20px;'>FECHA</div>
									</div>
							";
							
					foreach ($Array_Cols_Por_Tipo_Cuadrante as $unico){
						
							$PotUsu=PotencialTraeDatosBci2021($unico->rut);
							//echo "<h1>".$unico->rut."</h1>";
							//print_r($PotUsu);
							
							$continue=PotChecKMisUsuarioFuera($unico->rut);	
							//echo "<br>continue $continue";
							if($continue=="1"){
								continue;
							}
							
							//echo "<br>--->PotUsu <> gerencia_est2 POST ".$_POST["gerencia_est2"]." - ".$PotUsu[0]->d30;
							
							if($_POST["gerencia_est2"]<>""){
								if($PotUsu[0]->d30<>$_POST["gerencia_est2"]){
									continue;
								}
							}
							
							//echo "<br>--->fondo_est2 <> -  POST ".$_POST["fondo_est2"]."";

							if($_POST["fondo_est2"]<>""){
								if($PotUsu[0]->d32<>$_POST["fondo_est2"]){
									continue;
								}
							}		
							
							//echo "<br>--->dependencia_est2 <> POST ".$_POST["dependencia_est2"]."";

							if($_POST["dependencia_est2"]<>""){
								if($PotUsu[0]->d34<>$_POST["dependencia_est2"]){
									continue;
								}
							}		
							

							
				  $line_csv[0]=$PotUsu[0]->rut;
				  $line_csv[1]=$PotUsu[0]->d7;
				  $line_csv[2]=$PotUsu[0]->d8;
				  $line_csv[3]=$PotUsu[0]->d9;
				  $line_csv[4]=$PotUsu[0]->d145;
															  
				$line_csv[5]=$PotUsu[0]->d30;
				$line_csv[6]=$PotUsu[0]->d32;
				$line_csv[7]=$PotUsu[0]->d34;						  
															  
															  $line_csv[8]=$unico->cuadrante;
															  $line_csv[9]=$unico->fecha;
							 fputcsv($f, $line_csv,';');
					}





											 
											    // reset the file pointer to the start of the file
											    fseek($f, 0);
											    header('Content-Type: application/csv');
											    header('Content-Disposition: attachment; filename="'.$filename.'";');
											    fpassthru($f);
												
												

					 	
					 	exit();
					 }
					
					$Array_Cols_Por_Tipo_Cuadrante=Potencial_Cols_Por_Tipo_Cuadrante($_POST["TipoCuadrante"],$_POST["gerencia_est2"],$_POST["fondo_est2"],$_POST["dependencia_est2"]);
					
								$row_cols_filtro.="
									<div class='row'>
											<div class='col-lg-1 card-title' style='    padding-left: 20px;'>RUT</div>
											<div class='col-lg-4 card-title' style='    padding-left: 20px;'>NOMBRE</div>
											<div class='col-lg-4 card-title' style='    padding-left: 20px;'>CARGO</div>
											<div class='col-lg-1 card-title' style='    padding-left: 20px;'>CUAD</div>
											<div class='col-lg-2 card-title' style='    padding-left: 20px;'>FECHA</div>
									</div>
							";
							
					foreach ($Array_Cols_Por_Tipo_Cuadrante as $unico){
						
							$PotUsu=PotencialTraeDatosBci2021($unico->rut);
							//echo "<h1>".$unico->rut."</h1>";
							//print_r($PotUsu);
							
							$continue=PotChecKMisUsuarioFuera($unico->rut);
							if($continue=="1"){
								continue;
							}
							if($_POST["gerencia_est2"]<>""){
								if($PotUsu[0]->d30<>$_POST["gerencia_est2"]){
									continue;
								}
							}

							if($_POST["fondo_est2"]<>""){
								if($PotUsu[0]->d32<>$_POST["fondo_est2"]){
									continue;
								}
							}			

							if($_POST["dependencia_est2"]<>""){
								if($PotUsu[0]->d34<>$_POST["dependencia_est2"]){
									continue;
								}
							}		
							
							$row_cols_filtro.="
									<div class='row'>
											<div class='col-lg-1 txt_azul_box_noPad' style='min-height: 0px;'>".$PotUsu[0]->rut."</div>
											<div class='col-lg-4 txt_azul_box_noPad' style='min-height: 0px;'>".$PotUsu[0]->d7." ".$PotUsu[0]->d8." ".$PotUsu[0]->d9."</div>
											<div class='col-lg-4 txt_azul_box_noPad' style='min-height: 0px;'>".$PotUsu[0]->d145."</div>
											<div class='col-lg-1 txt_azul_box_noPad' style='min-height: 0px;'><center><strong>".$unico->cuadrante."</strong></center></div>
											<div class='col-lg-2 txt_azul_box_noPad' style='min-height: 0px;'>".$unico->fecha."</div>
									</div>
							";
							
					}

				}

        $PRINCIPAL = str_replace("{reporteria_SN_busqueda_csv}", $reporteria_SN_busqueda_csv, $PRINCIPAL);
        $PRINCIPAL = str_replace("{LISTA_COLABORADORES_POR_CUADRANTE_FILTROS_2021}", $row_cols_filtro, $PRINCIPAL);

        $PRINCIPAL = Potencial_Mis_Comites_estado_activo($PRINCIPAL, $rut, $perfil, $id_empresa, "activo");
        $PRINCIPAL = Potencial_Mis_Comites_estado_cierre($PRINCIPAL, $rut, $perfil, $id_empresa, "cerrado");

        $PRINCIPAL = ColocaDatosPerfil($PRINCIPAL, $rut);
        echo $PRINCIPAL;
    }

else if ($seccion == "potencial_sucesionBl") {
        $rut = $_SESSION["user_"];
        $id_empresa = $_SESSION["id_empresa"];
        $id_inst = ($_GET["id_inst"]);
        $profile = ($_GET["profile"]);
        $rut_col = Decodear3($_GET["rut_enc"]);
echo "<h1>A</h1>";exit();
				//busca perfil
        //$perfil ="USUARIO";
        $perfil =Potencial_Perfil_Sucesion_Usuarios($rut, $id_empresa);
 				
 				if($perfil==""){
 					echo "    <script>   alert('No tienes perfil de Socio ni Lider. Por favor, envianos un email a soporte@gop.cl');      location.href='?sw=com_mp_home';     </script>"; exit;
 				}

				if(Decodear3($_GET["id_del"])<>""){
					Potencial_EliminaComite_Sucesion(Decodear3($_GET["id_del"]));
				}
        //print_r($_POST);
        if($_POST["nuevo_comite"]<>''){
                //echo "<br>guarda<br>";
              $rut_lider      =   LimpiaRutFront($_POST["rut_lider"]);
              $nombre_comite  =   ($_POST["nombre_comite"]);
              $fecha_comite  	=   ($_POST["fecha_comite"]);
              $gerenciaR1  	=   	LimpiaRutFront($_POST["rut_g1"]);
             
              $UsuaLider      =   DatosUsuario_($rut_lider, $id_empresa);
              Potencial_Mis_Comites_insert_Nuevo_Comite_Sucesion_data($nombre_comite, $gerenciaR1, $rut, $fecha_comite, $id_empresa);

							$template_correo="template_potencial";
							$datos_usuario = mp_buscaDATOSPERSONAS($rut, $id_empresa);
							$titulo1 = "Creaste un nuevo Comité ".$nombre_comite;
							$subject = "Creaste un nuevo Comité ".$nombre_comite;
							$subtitulo1 = "Estimado(a) ".$datos_usuario[0]->nombre_completo."<br> <br>Has creado el comité ".$nombre_comite."<br><br>El siguiente paso es agregar Rut de Colaboradores y Rut Lider. ";
							$texto1 = "";$texto2 = "";$texto4 = "";$texto3 = "";$tipomensaje = "PotencialBci";
							$rut = $datos_usuario[0]->rut; $key = $datos_usuario[0]->rut;$to = $datos_usuario[0]->email;
							$nombreto = utf8_encode($datos_usuario[0]->nombre_completo);
							//SendGrid_Email($to, $nombreto, $from, $nombrefrom, $tipo, $subject, $titulo1, $subtitulo1, $texto1, $url, $texto_url, $texto2, $texto3, $texto4, $logo, $id_empresa, $url, $tipomensaje, $rut, $key,$template_correo);

        }

        $PRINCIPAL = (FuncionesTransversales(file_get_contents("views/potencial/" . $id_empresa . "_potencial_sucesion_index.html")));

				      if($perfil=="SOCIO DE NEGOCIO"){
				        $boton_crear_comite_SUCESION =   "
																							    <div class='alert alert-gris' style='    min-height: 120px;'>
																							    
																							<div class='titulo-heading'><img src='https://www.paneldeliderazgobci.cl/front/img/widget-link.png'> 
																							                                    	Crear Nuevo Comité de Sucesión</div>   
																							  <br>  
																							    <form action='?sw=potencial_sucesion' id='crear_comite' name='crear_comite' method='post'>
																							<div class='col-sm-4' style='    text-align: left;font-weight: bold;'><span class='bci_potencial_txt'> Nombre Comit&eacute;</span><br>
																							    <input type='text'   id='nombre_comite' name='nombre_comite' class='form form-control' style='font-weight: 300;' required/>
																							</div>
																							<div class='col-sm-3' style='    text-align: left;font-weight: bold;'><span class='bci_potencial_txt'>Rut Jefatura de cargos a Suceder</span><br>
																							    <input type='text'   id='rut_g1' name='rut_g1' class='form form-control' style='font-weight: 300;' required/>
																							</div>																							
																							<div class='col-sm-3' style='    text-align: left;font-weight: bold;'><span class='bci_potencial_txt'>Fecha de Realizaci&oacute;n</span><br>
																							    <input type='date'   id='fecha_comite' name='fecha_comite' class='form form-control' style='font-weight: 300;' required/>
																							</div>
																							<div class='col-sm-2' style='    text-align: left;font-weight: bold;'><span class=''></span><br>
																							      <input type='submit' class='btn btn-info' value='Crear Comit&eacute;' style='margin-top:0px;' />
																							</div>


																							    <input type='hidden' id='nuevo_comite' name='nuevo_comite' class='form form-control' value='1' style='margin-top:20px;' />

																							    </form>
																							</div>

				                                ";
				$texto_intro="Bienvenido(a) a Potencial Bci. Podrás crear comités, cargar colaboradores a ser mapeados y asignarles un Líder";                                
				        } else {
				                $boton_crear_comite_SUCESION="";
												$texto_intro="Bienvenido(a) a Potencial Bci. A continuación se despliegan los comités en los que tienes el rol de Líder para mapear a tus colaboradores.";                
				        }
        
                                //echo "PERFIL $perfil";
        $PRINCIPAL = str_replace("{BOTON_CREAR_COMITE_POTENCIAL_SUCESION}", $boton_crear_comite_SUCESION, $PRINCIPAL);
        $PRINCIPAL = str_replace("{TEXTO_INTRODUCTORIO_SEGUN_PERFIL}", $texto_intro, $PRINCIPAL);
        $PRINCIPAL = str_replace("{PERFIL}", $perfil, $PRINCIPAL);


$EsSN_descarga=Potencial_Es_Socio($rut);
			if($EsSN_descarga>0){
			$reporteria_SN_csv_descarga_sucesion="
			
			<div class='row'>
					<div class='col-lg-6'><a href='?sw=sucesion_csv_informes&v=1' class='btn btn-info'>Informe de Sucesi&oacute;n</a></div>
					<div class='col-lg-6'><a href='?sw=sucesion_csv_informes&v=2' class='btn btn-info' >Informe Hist&oacute;rico de Sucesores</a></div>
			</div>
			";
				} else {
						$reporteria_SN_csv_descarga_sucesion="";
					}




					$MiRX=MiRx($rut);
					//echo "miRx es $MiRX";

					// Descarga Super Users
					$EsSU_descarga=Potencial_Es_SuperUsers($rut);
					if($EsSU_descarga>0){
						$reporteria_csv="<br><br><center><a href='?sw=potencial_descarga_reporte' class='btn btn-success'>Descarga Reporte Potencial</a></center>";
					} else {
						$reporteria_csv="";
					}
					$reporteria_csv="";
					        $PRINCIPAL = str_replace("{DESCARGA_REPORTERIA_CSV}", $reporteria_csv, $PRINCIPAL);

					//Descarga Socios Negocios
					$EsSN_descarga=Potencial_Es_Socio($rut);
					if($rut=="17810781"){
						$EsSN_descarga=0;
					}
					
					if($EsSN_descarga>0){
							
						$DataBci_Gerencia			=Potencial_Data_Bci_groupby("d30");
						$DataBci_Fondo				=Potencial_Data_Bci_groupby("d32");
						$DataBci_Dependencia	=Potencial_Data_Bci_groupby("d34");

							$Options_Fondo.= "<option value=''></option>";
							$Options_Dependencia.= "<option value=''></option>";
						
						foreach ($DataBci_Gerencia as $UGer){
							$Options_Gerencia.= "<option value='".$UGer->dato."'>".$UGer->dato."</option>";
						}
						foreach ($DataBci_Fondo as $UFon){

							$Options_Fondo.= "<option value='".$UFon->dato."'>".$UFon->dato."</option>";
						}
						foreach ($DataBci_Dependencia as $UDep){
							$Options_Dependencia.= "<option value='".$UDep->dato."'>".$UDep->dato."</option>";
						}
						
						$reporteria_SN_csv_BK="<br><br>
						<center>
								
								<form name='descarga_csv' action='?sw=potencial_descarga_reporte' method='post'>
								
								<div class='col-lg-3'>Gerencia<br>
													<select name='gerencia' class='form form-control'>
														<option value=''></option>
															".$Options_Gerencia."
													</select>
								</div>
									
								<div class='col-lg-3'>Fondo<br>
												<select name='fondo' class='form form-control'>
																<option value=''></option>
															".$Options_Fondo."	
												</select>
								</div>
								<div class='col-lg-3'>Dependencia<br>
								
												<select name='dependencia' class='form form-control'>
															<option value=''></option>
															".$Options_Dependencia."
												</select>

								
								</div>
								<div class='col-lg-3'><br><input type='submit' class='btn btn-success' value='Descargar Reporte'></div>
								<input type='hidden' name='descarga_tipo' value='SN'>
								</form>
							
							</center><br><br>";
							$reporteria_SN_csv=file_get_contents("views/potencial/" . $id_empresa . "_potencial_combobox.html");
							$reporteria_SN_csv = str_replace("{OPTIONS_GERENCIAS}", $Options_Gerencia, $reporteria_SN_csv);
							$reporteria_SN_csv = str_replace("{OPTIONS_FONDO}", $Options_Fondo, $reporteria_SN_csv);
							$reporteria_SN_csv = str_replace("{OPTIONS_DEPENDENCIA}", $Options_Dependencia, $reporteria_SN_csv);
							
					} else {
						$reporteria_SN_csv="";
					}

        $PRINCIPAL = str_replace("{DESCARGA_REPORTERIA_SN_CSV}", $reporteria_SN_csv, $PRINCIPAL);
        $PRINCIPAL = str_replace("{DESCARGA_REPORTERIA_SN_CSV_SUCESION_XXXX}", $reporteria_SN_csv_descarga_sucesion, $PRINCIPAL);

        $PRINCIPAL = Potencial_Sucesion_Mis_Comites_estado_activo($PRINCIPAL, $rut, $perfil, $id_empresa, "activo");
        $PRINCIPAL = Potencial_Sucesion_Mis_Comites_estado_cierre($PRINCIPAL, $rut, $perfil, $id_empresa, "cerrado");

        $PRINCIPAL = ColocaDatosPerfil($PRINCIPAL, $rut);
        echo $PRINCIPAL;
    }
    
	else if($seccion=="filtro_dependencia_dado_gerencia_fondo"){
		$gerencia=$_POST["gerencia"];
		$fondo=$_POST["fondo"];
		$dependencia=TraigoDependenciaDadoGerenciaFondo($gerencia, $fondo);
		$options.="<option value=''></option>";
		foreach($dependencia as $dep){
			$options.="<option value='".$dep->dato."'>".$dep->dato."</option>";
		}
		echo $options;
	}
	else if($seccion=="filtro_fondo_dado_gerencia"){
		$gerencia=$_POST["gerencia"];
		$fondos=TraigoFondo($gerencia);
		$options.="<option value=''></option>";
		foreach($fondos as $fond){
			$options.="<option value='".$fond->dato."'>".$fond->dato."</option>";
		}
		echo $options;
	}
	
	else if($seccion=="filtro_dependencia_dado_gerencia"){
		$gerencia=$_POST["gerencia"];
		$dependencia=TraigoDependencia($gerencia);
		$options.="<option value=''></option>";
		foreach($dependencia as $dep){
			$options.="<option value='".$dep->dato."'>".$dep->dato."</option>";
			
		}
		echo $options;
		
	}
 else if ($seccion == "potencial_descarga_reporte")    {
	
								if($_POST["descarga_tipo"]=="SN"){
									$gerencia				= $_POST["gerencia"];
									$fondo					= $_POST["fondo"];
									$dependencia		= $_POST["dependencia"];
									
									$rut = $_SESSION["user_"];
									$Array_Rut_Potencial	=Potencial_Es_SuperUsers($rut);
									
									if($gerencia<>"")			{$JG=" and h.d30='".$gerencia."' ";}
									if($fondo<>"")				{$JF=" and h.d32='".$fondo."' ";}
									if($dependencia<>"")	{$JD=" and h.d34='".$dependencia."' ";}
									
									if($Array_Rut_Potencial>0){
										//echo "<h1>a</h1>";
										$JPers=" ";
									} else {
										$JPers=" and h.d30<>'GERENCIA CORPORATIVA GESTION PERSONAS' and h.d23<>'6926510'";
									}		
									
									$filtro=" where h.rut<>'' $JG $JF $JD $JPers";
								} else {
									//echo "<h1>b</h1>";
									$filtro="";
								}
								
								

								$ahora				=		date('Y-m-d');
								$head_csv   	=   array('Rut;Nombre;1er_Apellido;2do_Apellido;Gerencia;Fondo;Dependencia;Nombre_Puesto;Cuadrante_Actual_registrado_en_comite;Fecha_registro_Cuadrante_Actual;Comentario1;Comentario2;Comentario3;Comentario4;Fecha_Reporte');
								$filename="Reporte_Potencial_".$ahora.".csv";

							   $f = fopen('php://memory', 'w'); 
							   fputcsv($f, $head_csv);  
							   $array=Potencial_Busca_Array_reporte($filtro);
							   //print_r($array);



							    foreach ($array as $line) { 
							    		$i++;

							    	
							          $line_csv[0]=$line->rut_completo;
							       	  $line_csv[1]=$line->nombre;
											  $line_csv[2]=$line->paterno;
											  $line_csv[3]=$line->materno;
											  $line_csv[4]=$line->gerencia;
											  $line_csv[5]=$line->fondo;
											  $line_csv[6]=$line->dependencia;
											 	$line_csv[7]=$line->puesto;
											 	$cuadrante="";$fecha="";
											 	if($line->cuadrante_2020){
												 	$cuadrante=$line->cuadrante_2020;
											 		$fecha=$line->fecha_cuadrante_2020;
											 	} else {
												 	$cuadrante=$line->cuadrante_actual;
											 		$fecha=$line->fecha_actual;	 		
											 	}
											 	
											 	if($cuadrante=="") {continue;}
											 	
											 	
											 	if($cuadrante=="10"){$cuadrante="5+";}
										 		$line_csv[8]=$cuadrante;
												$line_csv[9]=$fecha;


									   $Unico->Comentario4 = str_replace("<br>", "", $Unico->Comentario4);
									   $Unico->Comentario4 = str_replace(";", ",", $Unico->Comentario4); 
									   $Unico->Comentario4 = str_replace("'", "", $Unico->Comentario4); 		    
										 $Unico->Comentario4 = str_replace(array("\r", "\n"), '',  $Unico->Comentario4);
										 $Unico->Comentario4 = str_replace(array("\r", "\n"), '',  $Unico->Comentario4);
										 $Unico->Comentario4 = str_replace(array("\r", "\n"), '',  $Unico->Comentario4);

									   $Unico->Comentario3 = str_replace("<br>", "", $Unico->Comentario3);
									   $Unico->Comentario3 = str_replace(";", ",", $Unico->Comentario3); 
									   $Unico->Comentario3 = str_replace("'", "", $Unico->Comentario3); 		    
										 $Unico->Comentario3 = str_replace(array("\r", "\n"), '',  $Unico->Comentario3);
										 $Unico->Comentario3 = str_replace(array("\r", "\n"), '',  $Unico->Comentario3);
										 $Unico->Comentario3 = str_replace(array("\r", "\n"), '',  $Unico->Comentario3);
										 
									   $Unico->Comentario2 = str_replace("<br>", "", $Unico->Comentario2);
									   $Unico->Comentario2 = str_replace(";", ",", $Unico->Comentario2); 
									   $Unico->Comentario2 = str_replace("'", "", $Unico->Comentario2); 		    
										 $Unico->Comentario2 = str_replace(array("\r", "\n"), '',  $Unico->Comentario2);
										 $Unico->Comentario2 = str_replace(array("\r", "\n"), '',  $Unico->Comentario2);
										 $Unico->Comentario2 = str_replace(array("\r", "\n"), '',  $Unico->Comentario2);
										 
									   $Unico->Comentario1 = str_replace("<br>", "", $Unico->Comentario1);
									   $Unico->Comentario1 = str_replace(";", ",", $Unico->Comentario1); 
									   $Unico->Comentario1 = str_replace("'", "", $Unico->Comentario1); 		    
										 $Unico->Comentario1 = str_replace(array("\r", "\n"), '',  $Unico->Comentario1);
										 $Unico->Comentario1 = str_replace(array("\r", "\n"), '',  $Unico->Comentario1);
										 $Unico->Comentario1 = str_replace(array("\r", "\n"), '',  $Unico->Comentario1);			 			 			 					
												
												
												
												$line_csv[10]=$line->Comentario1;
												$line_csv[11]=$line->Comentario2;
												$line_csv[12]=$line->Comentario3;
												$line_csv[13]=$line->Comentario4;
												$line_csv[14]=$line->ahora;
												
												//echo "hola";
												//echo "<br> $line_csv";
												
							   fputcsv($f, $line_csv,';');
							           
							    }
							 
							 
							    // reset the file pointer to the start of the file
							    fseek($f, 0);
							    header('Content-Type: application/csv');
							    header('Content-Disposition: attachment; filename="'.$filename.'";');
							    fpassthru($f);
								
								exit();
								
								
							}
							  
							else if($seccion=="test_buscador"){
								
								$PRINCIPAL = (FuncionesTransversales(file_get_contents("views/potencial/test_buscador.html")));
									echo $PRINCIPAL;
									
							}

								else if($seccion=="BuscaPersonas2020_v2"){ 
									  $search = $_POST['search'];
									 $busqueda=BuscaPersonas2020_v2($search);
										
									 foreach($busqueda as $bus){
										
										$response[] = array(
										"value"=>$bus->rut,
										"label"=>utf8_encode($bus->nombre_completo),
										"alerta_otro_lado"=>$dato_oficina[0]->oficina,
										"alerta_2"=>'<div class="alert alert-warning" role="alert">
							  This is a warning alert—check it out!
							</div>', 
										"alerta_cargos_criticos"=>'Alerta Cargos Criticos'); 
									 }
									echo json_encode($response);
									exit;
	}
	
	

else if ($seccion == "potencial_sucesion_comite") {
        $rut = $_SESSION["user_"];
        $id_empresa = $_SESSION["id_empresa"];
        $id_inst = ($_GET["id_inst"]);
        $profile = ($_GET["profile"]);
        $rut_col = Decodear3($_GET["rut_enc"]);
 				$id_comite = Decodear3($_GET["id_comite"]);
 				
        $CC = ($_GET["CC"]);
        if($CC=="1"){
        	Potencial_Sucesion_Update_Cierre_Comite($id_comite);
        	sleep(1);
        }
   
        $array_comite=Potencial_Sucesion_Comites_data($id_comite,$id_empresa);
       	//print_r($array_comite);        //exit();

 				Potencial_Sucesion_Actualiza_GerentesR2($array_comite[0]->gerenciaR1,$id_empresa, $id_comite);  

        $perfil ="USUARIO";
        $perfil =Potencial_Perfil_Sucesion_Usuarios($rut, $id_empresa);
  
        //echo "perfil $perfil";
        $saveform = ($_GET["saveform"]);

        if($saveform=="sf"){
                $nuevo_cuadrante    =   $_POST["nuevo_cuadrante"];
                $comentario         =   $_POST["comentario"];
                $id                 =   $_POST["id"];
								$rut_col_sf         =   Decodear3($_POST["rut_col"]);
        				//print_r($_POST);
        				
        				if($perfil=="LIDER"){
        					//Potencial_comite_update_tbl_data_bci_lider($nuevo_cuadrante, $comentario, $id_comite, $rut, $id, $id_empresa,$perfil, $rut_col_sf);
        				} else {
        					//Potencial_comite_update_tbl_data_bci_socio($nuevo_cuadrante, $comentario, $id_comite, $rut, $id, $id_empresa,$perfil, $rut_col_sf);	
        				}
                


								if($nuevo_cuadrante=="10"){$nuevo_cuadrante="5+";}
								$array_usu=Potencial_BuscaColaborador($id, $id_empresa);
								//print_r($array_usu);
								$datos_colaborador = UsuarioEnBasePersonas($array_usu[0]->rut, $rutcontodo);
								$datos_lider = UsuarioEnBasePersonas($array_usu[0]->rut_lider, $rutcontodo);
								$datos_usuario = UsuarioEnBasePersonas($rut, $rutcontodo);
								$datos_socio = UsuarioEnBasePersonas($array_usu[0]->rut_socio, $rutcontodo);
								//print_r($datos_colaborador);
								    if($perfil=="SOCIO DE NEGOCIO")     {

								$template_correo="template_potencial"; $tipo="";
								$datos_usuario = mp_buscaDATOSPERSONAS($rut, $id_empresa);
								$titulo1 = "Has modificado el cuadrante de ".$datos_colaborador[0]->nombre_completo;
								$subject = "Has modificado el cuadrante de ".$datos_colaborador[0]->nombre_completo;
								$subtitulo1 = "Estimado(a) ".$datos_usuario[0]->nombre_completo."<br> <br>Has modificado el cuadrante de ".$datos_colaborador[0]->nombre_completo.", que pertenece al lider ".$datos_lider[0]->nombre_completo. "";
								$texto1 = "<br> Nuevo Cuadrante: ".$nuevo_cuadrante."<br>Comentario: ".($comentario);$texto2 = "";$texto4 = "";$texto3 = "";$tipomensaje = "PotencialBci";
								$rut = $datos_usuario[0]->rut; $key = $datos_usuario[0]->rut;$to = $datos_usuario[0]->email;
								$nombreto = utf8_encode($datos_usuario[0]->nombre_completo);
								$to= ($datos_usuario[0]->email);
								//SendGrid_Email($to, $nombreto, $from, $nombrefrom, $tipo, $subject, $titulo1, $subtitulo1, $texto1, $url, $texto_url, $texto2, $texto3, $texto4, $logo, $id_empresa, $url, $tipomensaje, $rut, $key,$template_correo);

								$template_correo="template_potencial"; $tipo="";
								$datos_usuario = mp_buscaDATOSPERSONAS($rut, $id_empresa);
								$titulo1 = "Han modificado el cuadrante de ".$datos_colaborador[0]->nombre_completo;
								$subject = "Han modificado el cuadrante de ".$datos_colaborador[0]->nombre_completo;
								$subtitulo1 = "Estimado(a) ".$datos_lider[0]->nombre_completo."<br> <br>El Socio de Negocio ".$datos_usuario[0]->nombre_completo.", ha modificado el cuadrante de ".$datos_colaborador[0]->nombre_completo."";
								$texto1 = "<br> Nuevo Cuadrante: ".$nuevo_cuadrante."<br>Comentario: ".($comentario);$texto2 = "";$texto4 = "";$texto3 = "";$tipomensaje = "PotencialBci";
								$rut = $datos_usuario[0]->rut; $key = $datos_usuario[0]->rut;$to = $datos_usuario[0]->email;
								$nombreto = utf8_encode($datos_lider[0]->nombre_completo);
								$to= ($datos_lider[0]->email);
								//SendGrid_Email($to, $nombreto, $from, $nombrefrom, $tipo, $subject, $titulo1, $subtitulo1, $texto1, $url, $texto_url, $texto2, $texto3, $texto4, $logo, $id_empresa, $url, $tipomensaje, $rut, $key,$template_correo);

								        }
								    if($perfil=="LIDER")     {
								$template_correo="template_potencial"; $tipo="";
								$datos_usuario = mp_buscaDATOSPERSONAS($rut, $id_empresa);
								$titulo1 = "Has modificado el cuadrante de ".$datos_colaborador[0]->nombre_completo;
								$subject = "Has modificado el cuadrante de ".$datos_colaborador[0]->nombre_completo;
								$subtitulo1 = "Estimado(a) ".$datos_usuario[0]->nombre_completo."<br> <br>Has modificado el cuadrante de ".$datos_colaborador[0]->nombre_completo."";
								$texto1 = "<br> Nuevo Cuadrante: ".$nuevo_cuadrante."<br>Comentario: ".($comentario);$texto2 = "";$texto4 = "";$texto3 = "";$tipomensaje = "PotencialBci";
								$rut = $datos_usuario[0]->rut; $key = $datos_usuario[0]->rut;$to = $datos_usuario[0]->email;
								$nombreto = utf8_encode($datos_usuario[0]->nombre_completo);
								$to= ($datos_usuario[0]->email);
								//SendGrid_Email($to, $nombreto, $from, $nombrefrom, $tipo, $subject, $titulo1, $subtitulo1, $texto1, $url, $texto_url, $texto2, $texto3, $texto4, $logo, $id_empresa, $url, $tipomensaje, $rut, $key,$template_correo);

								$template_correo="template_potencial"; $tipo="";
								$datos_usuario = mp_buscaDATOSPERSONAS($rut, $id_empresa);
								$titulo1 = "Han modificado el cuadrante de ".$datos_colaborador[0]->nombre_completo;
								$subject = "Han modificado el cuadrante de ".$datos_colaborador[0]->nombre_completo;
								$subtitulo1 = "Estimado(a) ".$datos_socio[0]->nombre_completo."<br> <br>El Lider ".$datos_lider[0]->nombre_completo.", ha modificado el cuadrante de ".$datos_colaborador[0]->nombre_completo."";
								$texto1 = "<br> Nuevo Cuadrante: ".$nuevo_cuadrante."<br>Comentario: ".($comentario);$texto2 = "";$texto4 = "";$texto3 = "";$tipomensaje = "PotencialBci";
								$rut = $datos_usuario[0]->rut; $key = $datos_usuario[0]->rut;$to = $datos_usuario[0]->email;
								$nombreto = utf8_encode($datos_socio[0]->nombre_completo);
								$to= ($datos_socio[0]->email);
								//SendGrid_Email($to, $nombreto, $from, $nombrefrom, $tipo, $subject, $titulo1, $subtitulo1, $texto1, $url, $texto_url, $texto2, $texto3, $texto4, $logo, $id_empresa, $url, $tipomensaje, $rut, $key,$template_correo);

                        }

        }

        $PRINCIPAL = (FuncionesTransversales(file_get_contents("views/potencial/" . $id_empresa . "_potencial_sucesion_comite.html")));
        $id_comite = Decodear3($_GET["id_comite"]);
        
				if($perfil=="SOCIO DE NEGOCIO"){


				        $boton_subir_colaboradores =   "
				        <div class='alert alert-gris'>

										<div class='titulo-heading'><img src='https://www.paneldeliderazgobci.cl/front/img/widget-link.png'> Subir Colaboradores a ser mapeados</div>

				            <form name='importa' method='post' action='?sw=potencial_save_colaboradores' id='importa' enctype='multipart/form-data'>
				                <div class=''>


				                <a href='https://www.potencialbci.cl/front/docs/subir_colaboradores.xlsx?v2'
				                class='btn btn-link' style='    color: #007cc6;background: #d9edf7;'>Descargar Plantilla</a>

				                        <p> <center><input type='file' name='excel' style='display:inline;' />
				                             <button type='submit' class='btn btn-info ' style='display:inline;'>
				                    	<i class='fas fa-upload'></i> Subir Colaboradores
				                    </button>
				                    <input type='hidden' value='upload' name='action' /> </center></p>
				                    <input type='hidden' id='id_comite' name='id_comite' value='".$id_comite."' />

				                </div>
				            </form>

				        </div>

				                                ";
				    } else {
				     $boton_subir_colaboradores =   "";
				}
				
			if($rut=="17810781"){
						$boton_subir_colaboradores="";
			}

        $PRINCIPAL = str_replace("{BOTON_SUBIR_NOMINA_COMITE_POTENCIAL}", $boton_subir_colaboradores, $PRINCIPAL);
        $PRINCIPAL = str_replace("{LIDER_COMITE}",      utf8_encode($array_comite[0]->nombre_completo), $PRINCIPAL);
        $PRINCIPAL = str_replace("{NOMBRE_COMITE}",     utf8_encode($array_comite[0]->nombre), $PRINCIPAL);
        $PRINCIPAL = str_replace("{ID_COMITE_ENC}",     $_GET["id_comite"], $PRINCIPAL);

				if($_SESSION["user_"]==$array_comite[0]->rut or $_SESSION["user_"]=="10365815"){
						
						if($array_comite[0]->comite_cerrado<>"SI"){
						$boton_cierra_SN="<center><a href='?sw=potencial_sucesion_comite&id_comite=".Encodear3($id_comite)."&CC=1' class='btn btn-danger'>Cerrar el Comité</a></center>";	
						} else {
						$boton_cierra_SN="";	
						}
						
				} else {
						$boton_cierra_SN="";
				}

				 $PRINCIPAL = str_replace("{POTENCIAL_CIERRE_POTENCIAL_SN}", $boton_cierra_SN, $PRINCIPAL);

				if($array_comite[0]->comite_cerrado=="SI"){
					$alert_comite_cerrado="<br><br><center><div class='alert alert-danger'>Comité Cerrado</div></center>";
				} else {
					$alert_comite_cerrado="";
				}
			
			//echo "perfil $perfil";
			
				$PRINCIPAL = str_replace("{COMITE_CERRADO}", $alert_comite_cerrado, $PRINCIPAL);
        $PRINCIPAL = Potencial_Sucesion_Colaboradores_Comites($PRINCIPAL, $id_comite, $rut, $perfil, $id_empresa);
        
        $boxfiltro = ($_GET["boxfiltro"]);
        //$PRINCIPAL = Potencial_Box9_Comites($PRINCIPAL, $id_comite, $rut, $perfil, $boxfiltro, $id_empresa);
        //$PRINCIPAL = Potencial_Bitacora_Comites($PRINCIPAL, $id_comite, $rut, $perfil, $id_empresa);

        $PRINCIPAL = ColocaDatosPerfil($PRINCIPAL, $rut);
        echo $PRINCIPAL;
}
else if ($seccion == "potencial_comite") {
        $rut = $_SESSION["user_"];
        $id_empresa = $_SESSION["id_empresa"];
        $id_inst = ($_GET["id_inst"]);
        $profile = ($_GET["profile"]);
        $rut_col = Decodear3($_GET["rut_enc"]);
 				$id_comite = Decodear3($_GET["id_comite"]);

if($id_comite==""){
	 echo "    <script>         location.href='?sw=potencial';     </script>"; exit;
}

        $CC = ($_GET["CC"]);
        if($CC=="1"){
        	if($_POST["email_lider"]=="on"){
        		//echo "On";
        			$lista_lideres_por_comite=Potencial_BuscaLideres_DadoComite($id_comite);
        			$fecha_comite_potencial=Potencial_BuscaFecha_DadoComite($id_comite);
        			foreach ($lista_lideres_por_comite as $uniL){
        					//echo "<br><br>Lider ".$uniL->rut_lider."<br>";    				
        					$lista_colaboradores_por_comite=Potencial_BuscaLideres_DadoComiteLider($id_comite,$uniL->rut_lider);
        					//print_r($lista_colaboradores_por_comite);
        					$linea_acciones_desarrollo="";
        					$linea_cuadrante="";
        						foreach ($lista_colaboradores_por_comite as $uniC){
        								$UsuaC=DatosUsuario_($uniC->rut, $id_empresa);
        								$cuadrante=Potencial_Check_Mapeado($uniC->rut);
        								if($cuadrante=="10"){$cuadrante="5+";}
        								
        								//echo "<br> RutCol 18011283 ".$uniC->rut." ".$UsuaC[0]->nombre_completo.",  cuadrante ".$cuadrante;
        								$linea_cuadrante.="<br><strong>- ".$UsuaC[0]->nombre_completo.",  cuadrante ".$cuadrante."</strong>";
        										$array_AD=Potencial_Acciones_Desarrollo_por_comite($uniC->rut, $id_comite, $id_empresa);
        											foreach($array_AD as $uniD){
					        								//echo "<br> RutCol 18011283 ".$uniC->rut." ".$UsuaC[0]->nombre_completo.",  acción ".$uniD->plan;
					        								$linea_acciones_desarrollo.="<br><strong>- ".$UsuaC[0]->nombre_completo.",  acción ".utf8_encode($uniD->plan)."</strong>";
        											}
        						}
        						
        			$email_text1="	Estimado Líder<br><br>De acuerdo al Comité de Gestión de Personas realizado el ".$fecha_comite_potencial.", el resultado de tus colaboradores es el siguiente:<br>";
        			$email_text2="	<br><br>Además se acordaron acciones de desarrollo, las cuales se detallan a continuación:<br>";
        			$email_text3="	<br><br>Recuerda coordinar estas acciones en conjunto con tu socio de negocio.
															<br><br>
															Para más información puedes volver a acceder al comité en www.potencialbci.cl
															<br><br>
															Equipo de Talento y Desarrollo
															<br><br>
															Saludos cordiales<br><br>";
        			$texto_email=$email_text1.$linea_cuadrante.$email_text2.$linea_acciones_desarrollo.$email_text3;

        				//$template_correo="template_potencial"; $tipo="";
								$datos_usuario = mp_buscaDATOSPERSONAS($uniL->rut_lider, $id_empresa);
								$titulo1 = " ";
								$subject = "Comite Cerrado";
								$subtitulo1 = $texto_email;
								//$texto1 = "<br> Nuevo Cuadrante: ".$nuevo_cuadrante."<br>Comentario: ".($comentario);$texto2 = "";$texto4 = "";$texto3 = "";$tipomensaje = "PotencialBci";
								$rut = $datos_usuario[0]->rut; $key = $datos_usuario[0]->rut;$to = $datos_usuario[0]->email;
								$nombreto = utf8_encode($datos_usuario[0]->nombre_completo);
								$to= ($datos_usuario[0]->email);
								
								$nombrefrom="Potencial Bci";
								SendGrid_Email($to, $nombreto, $from, $nombrefrom, $tipo, $subject, $titulo1, $subtitulo1, $texto1, $url, $texto_url, $texto2, $texto3, $texto4, $logo, $id_empresa, $url, $tipomensaje, $rut, $key,$template_correo);

        				
        			}
        			

        			

        			

        				
        		
        	} else {
        	//	echo "Off";
        	}
        	
        	
       
        	
        	Potencial_Update_Cierre_Comite($id_comite);
        	sleep(1);
      
        }
   
        $array_comite=Potencial_Comites_data($id_comite,$id_empresa);
        $perfil ="USUARIO";
        $perfil =Potencial_Perfil_Usuarios($rut, $id_empresa);
  
        $saveform = ($_GET["saveform"]);

        if($saveform=="sf"){
                $nuevo_cuadrante    =   $_POST["nuevo_cuadrante"];
                $comentario         =   $_POST["comentario"];
                $id                 =   $_POST["id"];
								$rut_col_sf         =   Decodear3($_POST["rut_col"]);
        				//print_r($_POST);
        				
        				if($perfil=="LIDER"){
        					Potencial_comite_update_tbl_data_bci_lider($nuevo_cuadrante, $comentario, $id_comite, $rut, $id, $id_empresa,$perfil, $rut_col_sf);
        				} else {
        					Potencial_comite_update_tbl_data_bci_socio($nuevo_cuadrante, $comentario, $id_comite, $rut, $id, $id_empresa,$perfil, $rut_col_sf);	
        				}
                


								if($nuevo_cuadrante=="10"){$nuevo_cuadrante="5+";}
								$array_usu=Potencial_BuscaColaborador($id, $id_empresa);
								//print_r($array_usu);
								$datos_colaborador = UsuarioEnBasePersonas($array_usu[0]->rut, $rutcontodo);
								$datos_lider = UsuarioEnBasePersonas($array_usu[0]->rut_lider, $rutcontodo);
								$datos_usuario = UsuarioEnBasePersonas($rut, $rutcontodo);
								$datos_socio = UsuarioEnBasePersonas($array_usu[0]->rut_socio, $rutcontodo);
								//print_r($datos_colaborador);
								    if($perfil=="SOCIO DE NEGOCIO")     {

								$template_correo="template_potencial"; $tipo="";
								$datos_usuario = mp_buscaDATOSPERSONAS($rut, $id_empresa);
								$titulo1 = "Has modificado el cuadrante de ".$datos_colaborador[0]->nombre_completo;
								$subject = "Has modificado el cuadrante de ".$datos_colaborador[0]->nombre_completo;
								$subtitulo1 = "Estimado(a) ".$datos_usuario[0]->nombre_completo."<br> <br>Has modificado el cuadrante de ".$datos_colaborador[0]->nombre_completo.", que pertenece al lider ".$datos_lider[0]->nombre_completo. "";
								$texto1 = "<br> Nuevo Cuadrante: ".$nuevo_cuadrante."<br>Comentario: ".($comentario);$texto2 = "";$texto4 = "";$texto3 = "";$tipomensaje = "PotencialBci";
								$rut = $datos_usuario[0]->rut; $key = $datos_usuario[0]->rut;$to = $datos_usuario[0]->email;
								$nombreto = utf8_encode($datos_usuario[0]->nombre_completo);
								$to= ($datos_usuario[0]->email);
								//SendGrid_Email($to, $nombreto, $from, $nombrefrom, $tipo, $subject, $titulo1, $subtitulo1, $texto1, $url, $texto_url, $texto2, $texto3, $texto4, $logo, $id_empresa, $url, $tipomensaje, $rut, $key,$template_correo);

								$template_correo="template_potencial"; $tipo="";
								$datos_usuario = mp_buscaDATOSPERSONAS($rut, $id_empresa);
								$titulo1 = "Han modificado el cuadrante de ".$datos_colaborador[0]->nombre_completo;
								$subject = "Han modificado el cuadrante de ".$datos_colaborador[0]->nombre_completo;
								$subtitulo1 = "Estimado(a) ".$datos_lider[0]->nombre_completo."<br> <br>El Socio de Negocio ".$datos_usuario[0]->nombre_completo.", ha modificado el cuadrante de ".$datos_colaborador[0]->nombre_completo."";
								$texto1 = "<br> Nuevo Cuadrante: ".$nuevo_cuadrante."<br>Comentario: ".($comentario);$texto2 = "";$texto4 = "";$texto3 = "";$tipomensaje = "PotencialBci";
								$rut = $datos_usuario[0]->rut; $key = $datos_usuario[0]->rut;$to = $datos_usuario[0]->email;
								$nombreto = utf8_encode($datos_lider[0]->nombre_completo);
								$to= ($datos_lider[0]->email);
								//SendGrid_Email($to, $nombreto, $from, $nombrefrom, $tipo, $subject, $titulo1, $subtitulo1, $texto1, $url, $texto_url, $texto2, $texto3, $texto4, $logo, $id_empresa, $url, $tipomensaje, $rut, $key,$template_correo);

								        }
								    if($perfil=="LIDER")     {
								$template_correo="template_potencial"; $tipo="";
								$datos_usuario = mp_buscaDATOSPERSONAS($rut, $id_empresa);
								$titulo1 = "Has modificado el cuadrante de ".$datos_colaborador[0]->nombre_completo;
								$subject = "Has modificado el cuadrante de ".$datos_colaborador[0]->nombre_completo;
								$subtitulo1 = "Estimado(a) ".$datos_usuario[0]->nombre_completo."<br> <br>Has modificado el cuadrante de ".$datos_colaborador[0]->nombre_completo."";
								$texto1 = "<br> Nuevo Cuadrante: ".$nuevo_cuadrante."<br>Comentario: ".($comentario);$texto2 = "";$texto4 = "";$texto3 = "";$tipomensaje = "PotencialBci";
								$rut = $datos_usuario[0]->rut; $key = $datos_usuario[0]->rut;$to = $datos_usuario[0]->email;
								$nombreto = utf8_encode($datos_usuario[0]->nombre_completo);
								$to= ($datos_usuario[0]->email);
								//SendGrid_Email($to, $nombreto, $from, $nombrefrom, $tipo, $subject, $titulo1, $subtitulo1, $texto1, $url, $texto_url, $texto2, $texto3, $texto4, $logo, $id_empresa, $url, $tipomensaje, $rut, $key,$template_correo);

								$template_correo="template_potencial"; $tipo="";
								$datos_usuario = mp_buscaDATOSPERSONAS($rut, $id_empresa);
								$titulo1 = "Han modificado el cuadrante de ".$datos_colaborador[0]->nombre_completo;
								$subject = "Han modificado el cuadrante de ".$datos_colaborador[0]->nombre_completo;
								$subtitulo1 = "Estimado(a) ".$datos_socio[0]->nombre_completo."<br> <br>El Lider ".$datos_lider[0]->nombre_completo.", ha modificado el cuadrante de ".$datos_colaborador[0]->nombre_completo."";
								$texto1 = "<br> Nuevo Cuadrante: ".$nuevo_cuadrante."<br>Comentario: ".($comentario);$texto2 = "";$texto4 = "";$texto3 = "";$tipomensaje = "PotencialBci";
								$rut = $datos_usuario[0]->rut; $key = $datos_usuario[0]->rut;$to = $datos_usuario[0]->email;
								$nombreto = utf8_encode($datos_socio[0]->nombre_completo);
								$to= ($datos_socio[0]->email);
								//SendGrid_Email($to, $nombreto, $from, $nombrefrom, $tipo, $subject, $titulo1, $subtitulo1, $texto1, $url, $texto_url, $texto2, $texto3, $texto4, $logo, $id_empresa, $url, $tipomensaje, $rut, $key,$template_correo);

                        }

        }

        $PRINCIPAL = (FuncionesTransversales(file_get_contents("views/potencial/" . $id_empresa . "_potencial_comite.html")));
        $id_comite = Decodear3($_GET["id_comite"]);
        
				if($perfil=="SOCIO DE NEGOCIO"){


				        $boton_subir_colaboradores =   "
				        <div class='alert alert-gris'>

										<div class='titulo-heading'><img src='https://www.paneldeliderazgobci.cl/front/img/widget-link.png'> Subir Colaboradores a ser mapeados</div>

				            <form name='importa' method='post' action='?sw=potencial_save_colaboradores' id='importa' enctype='multipart/form-data'>
				                <div class=''>


				                <a href='https://www.potencialbci.cl/front/docs/subir_colaboradores.xlsx?v2'
				                class='btn btn-link' style='    color: #007cc6;background: #d9edf7;'>Descargar Plantilla</a>
																				<br>
				                        <p> <center><input type='file' name='excel' style='display:inline;' />
				                        <br>
				                        <input type='checkbox' class='' name='email_lider' id='email_lider'>  Chequea aquí si quieres enviar email a Líderes 
				                        <br><br>
				                             <button type='submit' class='btn btn-info ' style='display:inline;'>
				                    	<i class='fas fa-upload'></i> Subir Colaboradores
				                    </button>
				                    <input type='hidden' value='upload' name='action' /> </center></p>
				                    <input type='hidden' id='id_comite' name='id_comite' value='".$id_comite."' />

				                </div>
				            </form>

				        </div>

				                                ";
				    } else {
				     $boton_subir_colaboradores =   "";
				}
				
			if($rut=="17810781"){
						$boton_subir_colaboradores="";
			}

        $PRINCIPAL = str_replace("{BOTON_SUBIR_NOMINA_COMITE_POTENCIAL}", $boton_subir_colaboradores, $PRINCIPAL);
        $PRINCIPAL = str_replace("{LIDER_COMITE}",      utf8_encode($array_comite[0]->nombre_completo), $PRINCIPAL);
        $PRINCIPAL = str_replace("{NOMBRE_COMITE}",     utf8_encode($array_comite[0]->nombre), $PRINCIPAL);
        $PRINCIPAL = str_replace("{ID_COMITE_ENC}",     $_GET["id_comite"], $PRINCIPAL);

				if($_SESSION["user_"]==$array_comite[0]->rut or $_SESSION["user_"]=="10365815"){
						
						if($array_comite[0]->comite_cerrado<>"SI"){
						$boton_cierra_SN="
						<center style='float: right;'>
							<form name='potencial_comite_cerrar' id='potencial_comite_cerrar' action='?sw=potencial_comite&id_comite=".Encodear3($id_comite)."&CC=1' method='post'>
								<input type='submit' class='btn btn-danger' value='Cerrar el Comité' style='padding-bottom: 3px;padding-top: 3px;'> <input type='checkbox' class='' name='email_lider' id='email_lider'> Chequea aquí si quieres enviar email a Líderes 
							</form>
						</center>
						<br>";	
						} else {
						$boton_cierra_SN="";	
						}
						
				} else {
						$boton_cierra_SN="";
				}

				 $PRINCIPAL = str_replace("{POTENCIAL_CIERRE_POTENCIAL_SN}", $boton_cierra_SN, $PRINCIPAL);

				if($array_comite[0]->comite_cerrado=="SI"){
					
					$alert_comite_cerrado="<br><br><center><div class='alert alert-danger'>Comité Cerrado</div></center>";
					$display_none_lider_mapeado="display:none;";
				} else {
					$alert_comite_cerrado="";
					$display_none_lider_mapeado="";
				}
			
				$PRINCIPAL = str_replace("{COMITE_CERRADO}", $alert_comite_cerrado, $PRINCIPAL);
				$PRINCIPAL = str_replace("{display_none_lider_mapeado}", $display_none_lider_mapeado, $PRINCIPAL);
				
				/*echo "<br><br><br><br><br><br><br><br><br><br><br><br><br><br><br>
				$id_comite, $rut, $perfil, $id_empresa";*/
        $PRINCIPAL = Potencial_Colaboradores_Comites($PRINCIPAL, $id_comite, $rut, $perfil, $id_empresa);
        $boxfiltro = ($_GET["boxfiltro"]);
        
        $PRINCIPAL = Potencial_Box9_Comites($PRINCIPAL, $id_comite, $rut, $perfil, $boxfiltro, $id_empresa);
        $PRINCIPAL = Potencial_Bitacora_Comites($PRINCIPAL, $id_comite, $rut, $perfil, $id_empresa);

        $PRINCIPAL = ColocaDatosPerfil($PRINCIPAL, $rut);
        echo $PRINCIPAL;
    }  

else if ($seccion == "potencial_mi_equipo_acciones_desarrollo") {
        $rut = $_SESSION["user_"];
        $id_empresa = $_SESSION["id_empresa"];
        $id_inst = ($_GET["id_inst"]);
        $profile = ($_GET["profile"]);
        $rut_col 			= Decodear3($_GET["rut_enc"]);
				$rut_completo	=	Potencial_BuscaRutCompletoDadorut($rut);
				
				
				$AD_idEdEst=Decodear3($_POST["idEdEst"]);
				if($AD_idEdEst>0){
					Potencial_Sucesion_Acciones_Desarrollo_Cambioestado($AD_idEdEst, $_POST["estado"], $_POST["fundamento"]);
				}
				
        $PRINCIPAL = (FuncionesTransversales(file_get_contents("views/potencial/" . $id_empresa . "_potencial_comite_acciones_desarrollo.html")));
        $PRINCIPAL = Potencial_Colaboradores_MiEquipo($PRINCIPAL, "acciones_desarrollo", $rut_completo, $perfil, $id_empresa);

        $PRINCIPAL = ColocaDatosPerfil($PRINCIPAL, $rut);
        echo $PRINCIPAL;
    }  

 else if ($seccion == "potencial_save_colaboradores") {
        $id_empresa = $_SESSION["id_empresa"];
       // echo "<br /><br />"; print_r($_POST); echo "<br /><br />";
        extract($_POST);
        $id_comite       = $_POST["id_comite"];
        $rut = $_SESSION["user_"];
        $id_empresa = $_SESSION["id_empresa"];
 				$email_lider = $_POST["email_lider"];
        $error_grave = "error";
        $archivo = $_FILES['excel']['name'];
        $tipo = $_FILES['excel']['type'];
        $destino = "tmp_archivo_" . $archivo;
 $array_comite=Potencial_Comites_data($id_comite,$id_empresa);
 $nombre_comite= $array_comite[0]->nombre;
    if (copy($_FILES['excel']['tmp_name'], $destino)) {} else { $error_grave = "Error Al subir Archivo<br />";}
    if (file_exists("tmp_archivo_" . $archivo)) {
        require_once '../admin/clases/PHPExcel.php';
        require_once '../admin/clases/PHPExcel/Reader/Excel2007.php';
        $objReader = new PHPExcel_Reader_Excel2007();
        $objPHPExcel = $objReader->load("tmp_archivo_" . $archivo);
        $objFecha = new PHPExcel_Shared_Date();
        $objPHPExcel->setActiveSheetIndex(0);
        $HojaActiva = $objPHPExcel->getActiveSheet();
        $total_filas = $HojaActiva->getHighestRow();
        $lastColumn = $HojaActiva->getHighestColumn();
        $total_columnas = PHPExcel_Cell::columnIndexFromString($lastColumn);
        $UltimaColumna = "A";
        $j = 0;
        $_DATOS_EXCEL = array();
        

        
        for ($i = 0; $i <= $total_columnas; $i++) {$_campo[$i] = trim(utf8_decode($HojaActiva->getCell($UltimaColumna . "1")->getCalculatedValue()));
            $UltimaColumna++;}
        for ($fila = 2; $fila <= $total_filas; $fila++) {for ($columna = 0; $columna <= $total_columnas - 1; $columna++) {$_DATOS_EXCEL[$j][$_campo[$columna]] = trim($HojaActiva->getCellByColumnAndRow($columna, $fila)->getCalculatedValue());}
            $j++;}

            potencial_colaboradores_comite($id_comite, $id_empresa);
    } else { $error_grave = "Necesitas importar el archivo";}
    $total_errores = 0;
    $total_actualizar = 0;
    $total_insertar = 0;
    $total_desabilitar = 0;
    $total_a_eliminar = 0;
    $lineaT = "";
    $linea = 2;
    //echo "<br />10125";

 potencial_colaboradores_comite($id_comite, $id_empresa);
 $rut_envio="";
foreach ($_DATOS_EXCEL as $unico) { 
	
										//echo "<br><br>";   print_r($unico);
							      //$emailUser=usernameEmail($unico['RUT Embajador'], $id_empresa);
							$l++;
							//outputProgress($l, $fila);
							 $hoy=date("Y-m-d");
							  //echo "hola";
							$rut_col            =LimpiaRutFront($unico['RUT-COLABORADOR']);
							$rut_lider          =LimpiaRutFront($unico['RUT-LIDER']);
							
							
							if($rut_col>0){
								
							} else {
								continue;
							}
							//echo "<br>AAA --> rut col $rut_col rut lider $rut_lider rut envio $rut_envio";


							if($rut_lider<>$rut_envio){
								
								if($_POST["email_lider"]=="on"){
								
							$rut_envio=$rut_lider;
							$template_correo="template_potencial";  $tipo="";
							$datos_usuario = mp_buscaDATOSPERSONAS($rut_lider, $id_empresa);
							$titulo1 = "Has sido invitado como Lider a ".utf8_encode($nombre_comite);
							$subject = "Has sido invitado como Lider a ".utf8_encode($nombre_comite);
							$subtitulo1 = "
							
						Estimado Líder<br> <br>

Ya tenemos en agenda nuestro ".utf8_encode($nombre_comite).". 
El propósito final de esta instancia es identificar el potencial y aportar al desarrollo de tus colaboradores, así como contar con las capacidades necesarias para responder a los desafíos del negocio. 
En concreto, los objetivos de este Comité son: 
<br>
 
<br>- Identificar de manera temprana al talento con alto potencial.
<br>- Definir acciones concretas de desarrollo con foco en Altos Potenciales y Altos Rendimientos Sostenidos
<br>- Incorporar la visión de otros líderes para (a) enriquecer las evaluaciones del propio equipo, (b)   acompañar a los colaboradores en su desarrollo profesional, (c) establecer planes de sucesión
<br>- Gestionar bajos desempeños y acciones
 <br> <br>
Para este comité utilizaremos la plataforma www.potencialbci.cl. Desde ya debes ingresar para preparar este comité, dentro de cada ficha, dando click en editar cuadrante, podrán registrar sus comentarios y argumentos para el cuadrante que ustedes propongan. No requiere usuario o contraseña, ya que ingresas a través de la cuenta Google Bci.
<br><br>
Te recuerdo la importancia de llegar preparado, ya que cada líder tendrá sólo 4 minutos máximo para poder presentar.
 <br><br>
Ante cualquier duda puedes contactar a tu  Socio de Negocios o a Valentina Burgos mariavalentina.burgos@bci.cl 
<br><br>
Quedamos atentos.

							
							";
							$texto1 = "";$texto2 = "";$texto4 = "";$texto3 = "";$tipomensaje = "PotencialBci";
							$rut = $datos_usuario[0]->rut; $key = $datos_usuario[0]->rut;
							$to = $datos_usuario[0]->email;
							$nombreto = utf8_encode($datos_usuario[0]->nombre_completo);
							
							//$to="rod@gop.cl";
							SendGrid_Email($to, $nombreto, $from, $nombrefrom, $tipo, $subject, $titulo1, $subtitulo1, $texto1, $url, $texto_url, $texto2, $texto3, $texto4, $logo, $id_empresa, $url, $tipomensaje, $rut, $key,$template_correo);
								}

							}else{
							       $rut_envio=$rut_lider;

							}
							//echo "<br>BBB --> rut col $rut_col rut lider $rut_lider rut envio $rut_envio";
							//echo "<br>Esta aca rut_col  $rut_col ";

								
								$soySuper=Potencial_SoySuper($_SESSION["user_"]);
								
								//echo "soy super $soySuper", exit();
								
								if($soySuper>0){
										
								} else {

										$Pot_Check_Usr_No_mapeables= Pot_Check_Usr_No_mapeables($rut_col);
										if($Pot_Check_Usr_No_mapeables>0)	{continue;}
									
								}

	
							//echo "<br>CCC --> rut col $rut_col rut lider $rut_lider rut envio $rut_envio";


								//echo "<h1>a</h1>";
								    Potencial_insert_colaboradores($rut_col,$rut_lider,$id_comite,$hoy,$id_empresa) ;
								//echo "<h1>b</h1>";
							
								$template_correo="template_potencial";  $tipo="";
								$datos_usuario = mp_buscaDATOSPERSONAS($rut, $id_empresa);
								$titulo1 = "Has subido nuevos Colaboradores y Lideres a ".utf8_encode($nombre_comite);
								$subject = "Has subido nuevos Colaboradores y Lideres a ".utf8_encode($nombre_comite);
								$subtitulo1 = "Estimado(a) ".$datos_usuario[0]->nombre_completo."<br> <br>Has subido nuevos Colaboradores y Lìderes en el comitè  ".utf8_encode($nombre_comite)."<br><br>El siguiente es ingresar a Potencial Bci y ajustar los cuadrantes de los colaboradores asignados. ";
								$texto1 = "";$texto2 = "";$texto4 = "";$texto3 = "";$tipomensaje = "PotencialBci";
								$rut = $datos_usuario[0]->rut; $key = $datos_usuario[0]->rut;$to = $datos_usuario[0]->email;
								$nombreto = utf8_encode($datos_usuario[0]->nombre_completo);
								//SendGrid_Email($to, $nombreto, $from, $nombrefrom, $tipo, $subject, $titulo1, $subtitulo1, $texto1, $url, $texto_url, $texto2, $texto3, $texto4, $logo, $id_empresa, $url, $tipomensaje, $rut, $key,$template_correo);


								    //echo "chau";exit();

}  	

	

//echo "salir"; exit();
    echo "<script> location.href='?sw=potencial_comite&id_comite=".Encodear3($id_comite)."';</script>";
    exit;
}


else if ($seccion == "potencial_ficha") {
	
	      $rut = $_SESSION["user_"];
        $id_empresa = $_SESSION["id_empresa"];
        $id_inst = ($_GET["id_inst"]);
        $profile = ($_GET["profile"]);
        $rut_col = Decodear3($_REQUEST["rut_col"]);
        $rut_col_ficha = LimpiaRutFront($_REQUEST["rut_col_ficha"]);
        $id_comite_enc = ($_GET["id_comite"]);
        $id_comite		= Decodear3($id_comite_enc);

        //
        if($_POST["tipo_email"]=="Feedback"){
        	
        				$rut_feedback=$_POST["rut_save"];
        				
        				$rut_col_feedback=Decodear3($_POST["rut_col_feedback"]);

        				
        				$Dest=Potencial_BuscaFullData($rut_feedback);
        				$Remit=Potencial_BuscaFullData($_SESSION["user_"]);
        				$Col=Potencial_BuscaFullData($rut_col_feedback);
        			
        			//echo "<br>Post";
        			//print_r($_POST);
        			
        			//echo "user session ".$_SESSION["user_"];
        			
        			//echo "<br>Remitente User Session";
        			//print_r($Remit);
        			
        			//echo "<br>Destinatario";
        			//print_r($Dest);
        			
        			//echo "<br>Colaborador";
        			//print_r($Col);
        			
        			$email_dest=$Dest[0]->d58;
        			//exit();
        			
        			$to=$email_dest;
        			$nombreto=$email_dest;
        				//echo "<br>Enviar a ".$to;
            	//print_r($_POST);
        			//exit(); 					
        					
        				$template_correo="template_potencial"; $tipo="";
								$datos_usuario = mp_buscaDATOSPERSONAS($rut, $id_empresa);
								$titulo1 = "Estimad@ ".$Dest[0]->d7." ".$Dest[0]->d8." ".$Dest[0]->d9."";
								$subject = "Solicitud de Feedback";
								$subtitulo1 = 
								"<br><br>".$Remit[0]->d7." ".$Remit[0]->d8." ".$Remit[0]->d9." 
								está preparando un Comité de Gestión De Personas y 
								para hacer este ejercicio de forma más integral, 
								te está solicitando feedback de ".$Col[0]->d7." ".$Col[0]->d8." ".$Col[0]->d9.".<br>
								<br>
								Te pedimos tomes contacto con ".$Remit[0]->d7." ".$Remit[0]->d8." ".$Remit[0]->d9."  
								y le comentes tu experiencia relacionada a ".$Col[0]->d7." ".$Col[0]->d8." ".$Col[0]->d9.".
								<br><br>
								Si tienes alguna duda o necesitas ayuda, no dudes en contactar a tu socio de negocios.";

								
								;

        				$to=$email_dest;
        				$nombreto=$email_dest;
								//$to="edo@gop.cl";
								$texto1 = "";
								$texto2 = "";$texto4 = "";$texto3 = "";$tipomensaje = "PotencialBciSolicitarFeedback";
								$rut = $rut_feedback->rut; $key = $rut_feedback;
								

								
								SendGrid_Email($to, $nombreto, $from, $nombrefrom, $tipo, $subject, $titulo1, $subtitulo1, $texto1, $url, $texto_url, $texto2, $texto3, $texto4, $logo, $id_empresa, $url, $tipomensaje, $rut, $key,$template_correo);
								echo "<script>alert('Solicitud de Feedback enviada a ".$to."');</script>
								";
								
 							echo "    <script>         location.href='?sw=potencial';     </script>"; exit;	

        	
        	
        	
        }
        
        if($rut_col=="" and $rut_col_ficha<>""){
        	// aplicar regla
        	$rut_col=$rut_col_ficha;
        }
        //echo "rut_col $rut_col rut_col_ficha $rut_col_ficha";
        
        $continue=PotChecKMisUsuarioFuera($rut_col);
        //echo "<br> rut_col $rut_col rut_col_ficha $rut_col_ficha continue $continue";
        if($continue=="1"){
        	echo "    <script>         location.href='?sw=home_bci_new';     </script>"; exit;	
        }
        $array_comite=Potencial_Comites_data($id_comite,$id_empresa);
        //print_r($array_comite);
        
        $perfil =Potencial_Perfil_Usuarios($rut, $id_empresa);
        $saveform = ($_GET["saveform"]);

        $delad = Decodear3($_GET["delad"]);
        //echo "perfil $perfil";
        
        if($delad<>""){
        	Potencial_Delete_Acciones_Desarrollo($delad);
        }
        
        if($_POST["plan_acciones_desarrollo"]<>"" and $_POST["rut_col_enc"]<>""){
        	$rut_enc_plan=Decodear3($_POST["rut_col_enc"]);
        	Potencial_Insert_Acciones_Desarrollo($rut_enc_plan, $id_comite, $_POST["plan_acciones_desarrollo"],$_POST["fundamento"]);

        }

				if($_SESSION["user_"]==$rut_col){
					echo "<script>alert('Lamentablemente no puedes revisar tu ficha');</script>";
					exit();
				}

				$editBit	=	Decodear3($_POST["editBit"]);
				$delBit		=	Decodear3($_GET["delBit"]);

				$AD_idEdEst=Decodear3($_POST["idEdEst"]);
				if($AD_idEdEst>0){
					Potencial_Sucesion_Acciones_Desarrollo_Cambioestado($AD_idEdEst, $_POST["estado"], $_POST["fundamento"]);
				}
				
				if($editBit>0){
	      	Potencial_EliminaBitacora($editBit);
	      }

				if($delBit>0){
	      	Potencial_EliminaBitacora($delBit);
	      }

                
        if($saveform=="sf"){
                $nuevo_cuadrante    =   $_POST["nuevo_cuadrante"];
                $comentario         =   $_POST["comentario"];
                $id                 =   $_POST["id"];
								$rut_col_sf         =   Decodear3($_POST["rut_col"]);
        				
        				
        				//echo "rut $rut, perfil $perfil, rut col $rut_col"; 
        				
        				if($perfil=="SOCIO DE NEGOCIO"){
        					$Check_SoyLider=Check_Usr_PrimerNivel_BloqueadoGGPP_soyLider($rut_col);
        					//echo "Check_SoyLider $Check_SoyLider";
        					if($Check_SoyLider>0){
        						$perfil="LIDER";	
        					}
        					
        				}
        				//echo "rut $rut, perfil $perfil, rut col $rut_col"; 

        				
        				
        				if($perfil=="LIDER"){
        					Potencial_comite_update_tbl_data_bci_lider($nuevo_cuadrante, $comentario, $id_comite, $rut, $id, $id_empresa,$perfil, $rut_col_sf);
        				} else {
        					Potencial_comite_update_tbl_data_bci_socio($nuevo_cuadrante, $comentario, $id_comite, $rut, $id, $id_empresa,$perfil, $rut_col_sf);	
        				}
                
                
      


								if($nuevo_cuadrante=="10"){$nuevo_cuadrante="5+";}
								$array_usu=Potencial_BuscaColaborador($id, $id_empresa);
								//print_r($array_usu);
								$datos_colaborador = UsuarioEnBasePersonas($array_usu[0]->rut, $rutcontodo);
								$datos_lider = UsuarioEnBasePersonas($array_usu[0]->rut_lider, $rutcontodo);
								$datos_usuario = UsuarioEnBasePersonas($rut, $rutcontodo);
								$datos_socio = UsuarioEnBasePersonas($array_usu[0]->rut_socio, $rutcontodo);
								//print_r($datos_colaborador);
								    if($perfil=="SOCIO DE NEGOCIO")     {

								$template_correo="template_potencial"; $tipo="";
								$datos_usuario = mp_buscaDATOSPERSONAS($rut, $id_empresa);
								$titulo1 = "Has modificado el cuadrante de ".$datos_colaborador[0]->nombre_completo;
								$subject = "Has modificado el cuadrante de ".$datos_colaborador[0]->nombre_completo;
								$subtitulo1 = "Estimado(a) ".$datos_usuario[0]->nombre_completo."<br> <br>Has modificado el cuadrante de ".$datos_colaborador[0]->nombre_completo.", que pertenece al lider ".$datos_lider[0]->nombre_completo. "";
								$texto1 = "<br> Nuevo Cuadrante: ".$nuevo_cuadrante."<br>Comentario: ".($comentario);$texto2 = "";$texto4 = "";$texto3 = "";$tipomensaje = "PotencialBci";
								$rut = $datos_usuario[0]->rut; $key = $datos_usuario[0]->rut;$to = $datos_usuario[0]->email;
								$nombreto = utf8_encode($datos_usuario[0]->nombre_completo);
								$to= ($datos_usuario[0]->email);
								//SendGrid_Email($to, $nombreto, $from, $nombrefrom, $tipo, $subject, $titulo1, $subtitulo1, $texto1, $url, $texto_url, $texto2, $texto3, $texto4, $logo, $id_empresa, $url, $tipomensaje, $rut, $key,$template_correo);

								$template_correo="template_potencial"; $tipo="";
								$datos_usuario = mp_buscaDATOSPERSONAS($rut, $id_empresa);
								$titulo1 = "Han modificado el cuadrante de ".$datos_colaborador[0]->nombre_completo;
								$subject = "Han modificado el cuadrante de ".$datos_colaborador[0]->nombre_completo;
								$subtitulo1 = "Estimado(a) ".$datos_lider[0]->nombre_completo."<br> <br>El Socio de Negocio ".$datos_usuario[0]->nombre_completo.", ha modificado el cuadrante de ".$datos_colaborador[0]->nombre_completo."";
								$texto1 = "<br> Nuevo Cuadrante: ".$nuevo_cuadrante."<br>Comentario: ".($comentario);$texto2 = "";$texto4 = "";$texto3 = "";$tipomensaje = "PotencialBci";
								$rut = $datos_usuario[0]->rut; $key = $datos_usuario[0]->rut;$to = $datos_usuario[0]->email;
								$nombreto = utf8_encode($datos_lider[0]->nombre_completo);
								$to= ($datos_lider[0]->email);
								//SendGrid_Email($to, $nombreto, $from, $nombrefrom, $tipo, $subject, $titulo1, $subtitulo1, $texto1, $url, $texto_url, $texto2, $texto3, $texto4, $logo, $id_empresa, $url, $tipomensaje, $rut, $key,$template_correo);

								        }
								    if($perfil=="LIDER")     {
								$template_correo="template_potencial"; $tipo="";
								$datos_usuario = mp_buscaDATOSPERSONAS($rut, $id_empresa);
								$titulo1 = "Has modificado el cuadrante de ".$datos_colaborador[0]->nombre_completo;
								$subject = "Has modificado el cuadrante de ".$datos_colaborador[0]->nombre_completo;
								$subtitulo1 = "Estimado(a) ".$datos_usuario[0]->nombre_completo."<br> <br>Has modificado el cuadrante de ".$datos_colaborador[0]->nombre_completo."";
								$texto1 = "<br> Nuevo Cuadrante: ".$nuevo_cuadrante."<br>Comentario: ".($comentario);$texto2 = "";$texto4 = "";$texto3 = "";$tipomensaje = "PotencialBci";
								$rut = $datos_usuario[0]->rut; $key = $datos_usuario[0]->rut;$to = $datos_usuario[0]->email;
								$nombreto = utf8_encode($datos_usuario[0]->nombre_completo);
								$to= ($datos_usuario[0]->email);
								//SendGrid_Email($to, $nombreto, $from, $nombrefrom, $tipo, $subject, $titulo1, $subtitulo1, $texto1, $url, $texto_url, $texto2, $texto3, $texto4, $logo, $id_empresa, $url, $tipomensaje, $rut, $key,$template_correo);

								$template_correo="template_potencial"; $tipo="";
								$datos_usuario = mp_buscaDATOSPERSONAS($rut, $id_empresa);
								$titulo1 = "Han modificado el cuadrante de ".$datos_colaborador[0]->nombre_completo;
								$subject = "Han modificado el cuadrante de ".$datos_colaborador[0]->nombre_completo;
								$subtitulo1 = "Estimado(a) ".$datos_socio[0]->nombre_completo."<br> <br>El Lider ".$datos_lider[0]->nombre_completo.", ha modificado el cuadrante de ".$datos_colaborador[0]->nombre_completo."";
								$texto1 = "<br> Nuevo Cuadrante: ".$nuevo_cuadrante."<br>Comentario: ".($comentario);$texto2 = "";$texto4 = "";$texto3 = "";$tipomensaje = "PotencialBci";
								$rut = $datos_usuario[0]->rut; $key = $datos_usuario[0]->rut;$to = $datos_usuario[0]->email;
								$nombreto = utf8_encode($datos_socio[0]->nombre_completo);
								$to= ($datos_socio[0]->email);
								//SendGrid_Email($to, $nombreto, $from, $nombrefrom, $tipo, $subject, $titulo1, $subtitulo1, $texto1, $url, $texto_url, $texto2, $texto3, $texto4, $logo, $id_empresa, $url, $tipomensaje, $rut, $key,$template_correo);

                        }

        }
   
   
				$Ficha					=	Potencial_Colaboradores_Matriz_tbl_data_bci_data($id_empresa, $rut_col);
				$Ficha21				=	Potencial_Colaboradores_Matriz_tbl_data_bci_2021_data($id_empresa, $rut_col);
				//echo "Ficha[0]->d128 ".$Ficha[0]->d128;
							
				if($Ficha[0]->d128<2.6 and $Ficha[0]->d128>0){
					
					$disclaimer="
						<div class=' col-lg-3'></div>
							<div class=' col-lg-6'>
								<div class='alert alert-danger'>
									<center>
										Obtiene lo mejor de las personas es menor a 2,6,<br>lo que impide que el colaborador sea mapeado sobre 5
									</center>
								</div>
							</div>
						<div class=' col-lg-3'></div>
						";
						
				} else {
					
					$disclaimer="";
					
				}
				//echo "rut $rut_col";
				$es_posicion_clave=Pot_CheckPosicion_Clave($rut_col);
				
				if($es_posicion_clave>0){
				$posicion_clave	=" 
						
							<div class=' col-lg-6'>
								<div class='badge badge-gray'  style='    background-color: transparent !important;padding-left: 0px!important;'>
									<center>
										<strong>Posición Clave</strong>
									</center>
								</div>
							</div>
					
						
						";
				} else {
				$posicion_clave="";	
				}

				$es_sucesor=Pot_Check_Es_Sucesor($rut_col);
				
				if($es_sucesor>0){
				$rut_es_sucesor	=" 
						
							<div class=' col-lg-6'>
								<div class='badge badge-gray'>
									<center>
										<strong>Es Sucesor </strong>(".$es_sucesor.")
									</center>
								</div>
							</div>
					
						
						";
				} else {
				$rut_es_sucesor="";	
				}
	
	
	//ALertas Acciones Desarrollo sinEstado yt mas de 3 Meses 
	 $MonthThreeAgo = strtotime("-3 month");
	 $AlertasAD=PotencialBuscaAccionesSinEstado($rut_col, $MonthThreeAgo);
		//	 print_r($AlertasAD);
	 $alerta_acciones_desarrollo_ficha="";
	if(count($AlertasAD)>0){
		
		$alerta_acciones_desarrollo_ficha.="<div class='alert alert-danger'>";
		foreach ($AlertasAD as $unico){
			$UsuaAlertaAD=DatosUsuario_($unico->rut, $id_empresa);
			$alerta_acciones_desarrollo_ficha.="- " .$UsuaAlertaAD[0]->nombre_completo." tiene Acciones de Desarrollo con mas de 3 meses desde la fecha de definición sin Estado - ".utf8_encode($unico->plan)."<br>";
		}
		$alerta_acciones_desarrollo_ficha.="</div>";
	} else {
		$alerta_acciones_desarrollo_ficha="";
	}
	

	
				$Pot_NombreLider="Lider: ".Potencial_Busca_Nombre_Lider($rut_col,$id_comite_enc);
	 
				$Cuadrante		=	Potencial_Colaboradores_Matriz_tbl_potencial_cuadrantes_data($id_empresa, $rut_col);
				$RutLider			= Potencial_Busca_Rut_Lider($rut_col,$id_comite_enc);
				//echo "rut lider $RutLider";
				
        $PRINCIPAL 		= (FuncionesTransversales(file_get_contents("views/potencial/" . $id_empresa . "_potencial_ficha.html")));
        $perfil 			="USUARIO";
        $perfil 			=	Potencial_Perfil_Usuarios($rut, $id_empresa);

				$UsuaCol=DatosUsuario_($rut_col, $id_empresa);

	        $PRINCIPAL = str_replace("{alerta_acciones_desarrollo_ficha}", 	$alerta_acciones_desarrollo_ficha, $PRINCIPAL);

 
 				$PRINCIPAL             = str_replace("{FOTO_PERSONA_COL}", VerificaFotoPersonal($rut_col), $PRINCIPAL);
 				$PRINCIPAL             = str_replace("{NOMBRE_COL}", $UsuaCol[0]->nombre_completo, $PRINCIPAL);
 				$PRINCIPAL             = str_replace("{CARGO_COL}",  $UsuaCol[0]->cargo, $PRINCIPAL);
 				
 				
 				$data2021=PotencialTraeDatosBci2021($rut_col);
 				
 				$PRINCIPAL             = str_replace("{POSICION_COL}", $data2021[0]->d151, $PRINCIPAL);

        $PRINCIPAL = str_replace("{DISCLAIMER_BAJO_26}", 	$disclaimer, $PRINCIPAL);
        $PRINCIPAL = str_replace("{DATA_BCI_D20}",				$Ficha21[0]->d20, $PRINCIPAL);
        $PRINCIPAL = str_replace("{POSICION}",				$Ficha21[0]->d145, $PRINCIPAL);
        $PRINCIPAL = str_replace("{POSICION_CLAVE}", 	$posicion_clave, $PRINCIPAL);
        $PRINCIPAL = str_replace("{ES_SUCESOR}", 			$rut_es_sucesor, $PRINCIPAL);
        $PRINCIPAL = str_replace("{NOMBRE_LIDER}", 			$Pot_NombreLider, $PRINCIPAL);
				
				if($_GET["sucesion"]=="1"){
						$volver_ficha="       
						<a href='?sw=potencial_ficha_sucesion&id_comite={ID_COMITE_ENC}&id_posicion_enc=".$_GET["id_posicion_enc"]."' class='btn btn-link pull-left' style='display: block;'>
							<span style='color: #31708f;'><i class='fas fa-arrow-alt-circle-left'></i> Volver</span>
						</a>";
				} else {
						$volver_ficha="       
						<a href='?sw=potencial_comite&id_comite={ID_COMITE_ENC}' class='btn btn-link pull-left' style='display: block;'>
							<span style='color: #31708f;'><i class='fas fa-arrow-alt-circle-left'></i> Volver</span>
						</a>";
				}
				
				if($_GET["accionesDesarrollo"]=="1"){
							$volver_ficha="       
						<a href='?sw=potencial_mi_equipo_acciones_desarrollo' class='btn btn-link pull-left' style='display: block;'>
							<span style='color: #31708f;'><i class='fas fa-arrow-alt-circle-left'></i> Volver</span>
						</a>";
				}
				
        $PRINCIPAL = str_replace("{VOLVER_POTENCIAL_FICHA_}", 			$volver_ficha, $PRINCIPAL);
        
 				if($Ficha[0]->d143<>""){
					$Ficha[0]->d143=round(100*$Ficha[0]->d143);
					$Ficha[0]->d143=$Ficha[0]->d143."%";}
        
        $PRINCIPAL = str_replace("{ENGAGEMENT_2019}",				$Ficha[0]->d143, $PRINCIPAL);

        $PRINCIPAL = str_replace("{BOTON_CREAR_COMITE_POTENCIAL}", $boton_crear_comite, $PRINCIPAL);
        $PRINCIPAL = str_replace("{PERFIL}", $perfil, $PRINCIPAL);
        $PRINCIPAL = str_replace("{ID_COMITE_ENC}", $id_comite_enc, $PRINCIPAL);
        
				$edad_antiguedad_en_bci_yyy_mm_dd=date("Y-m-d", strtotime($Ficha21[0]->d10));
				$edad_antiguedad_en_bci=calcular_edad($edad_antiguedad_en_bci_yyy_mm_dd);
				$edad_antiguedad_en_cargo_bci_yyy_mm_dd=date("Y-m-d", strtotime($Ficha21[0]->d16));
				$edad_antiguedad_en_bci_cargo=calcular_edad($edad_antiguedad_en_cargo_bci_yyy_mm_dd);
				//print_r($Ficha);

				$cuadrante_propuesta					=	$Cuadrante[0]->propuesta_cuadrante_2020;
				$cuadrante_actual_2020				=	$Cuadrante[0]->cuadrante_2020;
				$cuadrante_actual_fecha_2020	=	$Cuadrante[0]->fecha_cuadrante_2020;
				$cuadrante_lider							=	$Cuadrante[0]->cuadrante_2020_lider;
					//echo "<br>1 cuadrante_propuesta $cuadrante_propuesta";

					if($Cuadrante[0]->promedio_metas_2020=="" or $Cuadrante[0]->promedio_competencias_2020==""){
						$cuadrante_propuesta="";
					}
										
					//echo "<br>2 cuadrante_propuesta $cuadrante_propuesta";
				//print_r($Ficha);
				
				$cuadrante_actual							= $Ficha[0]->d103;
				$cuadrante_actual_fecha				= $Ficha[0]->d104;
				$cuadrante_anterior						= $Ficha[0]->d105;
				$cuadrante_anterior_fecha			= $Ficha[0]->d106;
				//echo "$cuadrante_actual";
				if($cuadrante_actual_2020<>""){
					$cuadrante_actual_real=$cuadrante_actual_2020;
					$cuadrante_actual_fecha=$cuadrante_actual_fecha_2020;
				} else {
					$cuadrante_actual_real=$cuadrante_actual;
					$cuadrante_actual_fecha=$cuadrante_actual_fecha;
				}
				
	      	if($Cuadrante[0]->cuadrante_2020<>""){

      		
      		$cuadrante_anterior			= $Ficha[0]->d103;
      	}  		
				
				//echo "cuadrante_actual_real $cuadrante_actual_real";

				$Cuadrante_Propuesta_txt		=	Potencial_Matriz_Box_Nuevo_Propuesta_Step($cuadrante_propuesta);
				$Cuadrante_Actual_txt				=	Potencial_Matriz_Box_Nuevo_Propuesta_Step($cuadrante_actual_real);
				$Cuadrante_Anterior_txt			=	Potencial_Matriz_Box_Nuevo_Propuesta_Step($cuadrante_anterior);
				$Cuadrante_Lider_txt			 =	Potencial_Matriz_Box_Nuevo_Propuesta_Step($cuadrante_lider);

				$cuadrante_lider_num=$cuadrante_lider;
				if($cuadrante_lider_num=="5+"){$cuadrante_lider_num="10";}				
				
				$cuadrante_propuesta_num=$cuadrante_propuesta;
				if($cuadrante_propuesta_num=="5+"){$cuadrante_propuesta_num="10";}
		
				$cuadrante_anterior_num=$cuadrante_anterior;
				if($cuadrante_anterior_num=="5+"){$cuadrante_anterior_num="10";}

				$cuadrante_actual_real_num=$cuadrante_actual_real;
				if($cuadrante_actual_real_num=="5+"){$cuadrante_actual_real_num="10";}

				$Cuad_PRP_text_desc=Potencial_Descripcion_Cuadrantes_TXT($cuadrante_propuesta_num);
				$PRINCIPAL = str_replace("{PRP".$cuadrante_propuesta_num."}", "
																					<div data-toggle='tooltip' data-placement='top' title='".$Cuad_PRP_text_desc."'><center>".$Cuadrante_Propuesta_txt."</center></div>"	, $PRINCIPAL);
				
				$Cuad_AC_text_desc=Potencial_Descripcion_Cuadrantes_TXT($cuadrante_actual_real_num);
				$PRINCIPAL = str_replace("{AC".$cuadrante_actual_real_num."}", 	
																					"<div data-toggle='tooltip' data-placement='top' title='".$Cuad_AC_text_desc."'><center>".$Cuadrante_Actual_txt."</center></div>"	, $PRINCIPAL);
				
				$Cuad_AN_text_desc=Potencial_Descripcion_Cuadrantes_TXT($cuadrante_anterior_num);
				$PRINCIPAL = str_replace("{AN".$cuadrante_anterior_num."}", 		
																					"<div data-toggle='tooltip' data-placement='top' title='".$Cuad_AN_text_desc."'><center>".$Cuadrante_Anterior_txt."</center></div>"	, $PRINCIPAL);

				$Cuad_PRPLI_text_desc=Potencial_Descripcion_Cuadrantes_TXT($cuadrante_anterior_num);
				$PRINCIPAL = str_replace("{PRPLI".$cuadrante_lider_num."}", 		
																					"<div data-toggle='tooltip' data-placement='top' title='".$Cuad_PRPLI_text_desc."'><center>".$Cuadrante_Lider_txt."</center></div>"	, $PRINCIPAL);



				$PRINCIPAL = str_replace("{CUADRANTE_ACTUAL_MODAL}", 		$Cuadrante_Actual_txt 	, $PRINCIPAL);
				$PRINCIPAL = str_replace("{CUADRANTE_PROPUESTO_MODAL}", $Cuadrante_Propuesta_txt 	, $PRINCIPAL);
				$PRINCIPAL = str_replace("{ID_COMITE_ENC}", 						Encodear3($id_comite_enc) 	, $PRINCIPAL);
				$PRINCIPAL = str_replace("{CUADRANTE_ACTUAL_FECHA}", $cuadrante_actual_fecha 	, $PRINCIPAL);

				$PRINCIPAL = str_replace("{PRPLI1}", ""	, $PRINCIPAL);
				$PRINCIPAL = str_replace("{PRPLI2}", ""	, $PRINCIPAL);
				$PRINCIPAL = str_replace("{PRPLI3}", ""	, $PRINCIPAL);
				$PRINCIPAL = str_replace("{PRPLI4}", ""	, $PRINCIPAL);
				$PRINCIPAL = str_replace("{PRPLI5}", ""	, $PRINCIPAL);
				$PRINCIPAL = str_replace("{PRPLI6}", ""	, $PRINCIPAL);
				$PRINCIPAL = str_replace("{PRPLI7}", ""	, $PRINCIPAL);
				$PRINCIPAL = str_replace("{PRPLI8}", ""	, $PRINCIPAL);
				$PRINCIPAL = str_replace("{PRPLI9}", ""	, $PRINCIPAL);
				$PRINCIPAL = str_replace("{PRPLI10}", ""	, $PRINCIPAL);

				$PRINCIPAL = str_replace("{PRP1}", ""	, $PRINCIPAL);
				$PRINCIPAL = str_replace("{PRP2}", ""	, $PRINCIPAL);
				$PRINCIPAL = str_replace("{PRP3}", ""	, $PRINCIPAL);
				$PRINCIPAL = str_replace("{PRP4}", ""	, $PRINCIPAL);
				$PRINCIPAL = str_replace("{PRP5}", ""	, $PRINCIPAL);
				$PRINCIPAL = str_replace("{PRP6}", ""	, $PRINCIPAL);
				$PRINCIPAL = str_replace("{PRP7}", ""	, $PRINCIPAL);
				$PRINCIPAL = str_replace("{PRP8}", ""	, $PRINCIPAL);
				$PRINCIPAL = str_replace("{PRP9}", ""	, $PRINCIPAL);
				$PRINCIPAL = str_replace("{PRP10}", ""	, $PRINCIPAL);

				$PRINCIPAL = str_replace("{AC1}", ""	, $PRINCIPAL);
				$PRINCIPAL = str_replace("{AC2}", ""	, $PRINCIPAL);
				$PRINCIPAL = str_replace("{AC3}", ""	, $PRINCIPAL);
				$PRINCIPAL = str_replace("{AC4}", ""	, $PRINCIPAL);
				$PRINCIPAL = str_replace("{AC5}", ""	, $PRINCIPAL);
				$PRINCIPAL = str_replace("{AC6}", ""	, $PRINCIPAL);
				$PRINCIPAL = str_replace("{AC7}", ""	, $PRINCIPAL);
				$PRINCIPAL = str_replace("{AC8}", ""	, $PRINCIPAL);
				$PRINCIPAL = str_replace("{AC9}", ""	, $PRINCIPAL);
				$PRINCIPAL = str_replace("{AC10}", ""	, $PRINCIPAL);
				
				$PRINCIPAL = str_replace("{AN1}", ""	, $PRINCIPAL);				
				$PRINCIPAL = str_replace("{AN2}", ""	, $PRINCIPAL);				
				$PRINCIPAL = str_replace("{AN3}", ""	, $PRINCIPAL);				
				$PRINCIPAL = str_replace("{AN4}", ""	, $PRINCIPAL);				
				$PRINCIPAL = str_replace("{AN5}", ""	, $PRINCIPAL);				
				$PRINCIPAL = str_replace("{AN6}", ""	, $PRINCIPAL);				
				$PRINCIPAL = str_replace("{AN7}", ""	, $PRINCIPAL);				
				$PRINCIPAL = str_replace("{AN8}", ""	, $PRINCIPAL);				
				$PRINCIPAL = str_replace("{AN9}", ""	, $PRINCIPAL);				
				$PRINCIPAL = str_replace("{AN10}", ""	, $PRINCIPAL);				
				//echo "<br>prop $cuadrante_propuesta actual $cuadrante_actual_real anterior $cuadrante_anterior";
				//echo "rut $rut, $RutLider";
				
				$comite_cerrado=$array_comite[0]->comite_cerrado;
				//echo "<br>comite_cerrado $comite_cerrado";
				if($comite_cerrado=="SI"){
				$boton_ver_editar_box   ="";
				$boton_ver_editar_box   ="";
				} else {

				if($RutLider==$rut){
					$boton_ver_editar_box   ="<button type='button' class='btn btn-info' data-toggle='modal' data-target='#".Encodear3($rut_col)."'>
        	<span class='blanco'><i class='fas fa-edit'></i> Proponer Cuadrante</span></button>";
					
				} else {
					$boton_ver_editar_box   ="<button type='button' class='btn btn-info' data-toggle='modal' data-target='#".Encodear3($rut_col)."'>
        	<span class='blanco'><i class='fas fa-edit'></i> Editar Cuadrante</span></button>";
				}
					$boton_ver_agregar_ad_box   ="<button type='button' class='btn btn-info' data-toggle='modal' data-target='#".Encodear3($rut_col)."'>
    	    <span class='blanco'><i class='fas fa-edit'></i> Agregar Acciones Desarrollo</span></button>";
				}

        $PRINCIPAL = str_replace("{BOTON_VER_EDITAR_BOX}", $boton_ver_editar_box	, $PRINCIPAL);	

				$boton_ver_agregar_ad_box   ="<button type='button' class='btn btn-info' data-toggle='modal' data-target='#AD_".Encodear3($rut_col)."'>
        <span class='blanco'><i class='fas fa-edit'></i> Agregar Acciones Desarrollo</span></button>";
        $PRINCIPAL = str_replace("{BOTON_VER_ACC_DES}", $boton_ver_agregar_ad_box	, $PRINCIPAL);	

				$boton_ver_solicitar_feedback="
					
						  <button class='btn btn-info' type='button' data-toggle='collapse' data-target='#collapseExample' aria-expanded='false' aria-controls='collapseExample'>
						    <span class='blanco'><i class='fas fa-edit'></i> Solicitar Feedback</span>
						  </button>
						
						<div class='collapse' id='collapseExample'>
														<div class='txt_2020'>Seleccionar nuevo colaborador</div>
														<br>
															<form method='POST' action='' id='form5' name='form5'>
																<div class='badge-gray_blue' style='font-size: 10px;'>
																	Escribe el Nombre del Colaborador y selecci&oacute;nalo de la Lista</div>
																	
																  <input type='text' id='autocomplete_3'  class='form form-control'>
																 <input type='hidden' id='selectuser_id_3' name='rut_save' />
																<!-- 
																 <div class='badge-gray_blue' style='font-size: 10px;' >Escribe tu fundamento</div>
																<input type='text' name='fundamento' name='fundamento' class='form form-control'  required>
																-->
																 
																  <input type='hidden' name='rut_col_feedback' value='".Encodear3($rut_col)."' />

																  <input type='hidden' name='tipo_email' value='Feedback' />
										  	          <br><br>
									  	          <input type='hidden' name='tipo_feed' id='tipo_feed' value='{TIPO_FEED}' />
																<input type='submit' class='btn btn-success' value='Solicitar Feedback'>
															</form>		
					

						</div>	
				";

        $PRINCIPAL = str_replace("{BOTON_SOLICITAR_FEEDBACK}", $boton_ver_solicitar_feedback	, $PRINCIPAL);	

        
        $PRINCIPAL = str_replace("{RUT_COL_ENC}", Encodear3($rut_col)	, $PRINCIPAL);	
        $PRINCIPAL = str_replace("{RUT_SUCESORES_ENC}", Encodear3($rut_col)	, $PRINCIPAL);	
        $PRINCIPAL = str_replace("{RUT_COL_LIMPIO}", ($rut_col)	, $PRINCIPAL);	

				if($Ficha[0]->d63>0){
					$m2019=round(100*$Ficha[0]->d63,0)."%";
				} else {
					$m2019="";
				}


				if($Ficha[0]->d61>0){
					$m2018=round(100*$Ficha[0]->d61,0)."%";
				} else {
					$m2018="";
				}


				if($Ficha[0]->d60>0){
					$m2017=round(100*$Ficha[0]->d60,0)."%";
				} else {
					$m2017="";
				}

				$PRINCIPAL = str_replace("{METAS_2019}", 	$m2019, $PRINCIPAL);				
				$PRINCIPAL = str_replace("{METAS_2018}", $m2018	, $PRINCIPAL);				
				$PRINCIPAL = str_replace("{METAS_2017}", $m2017, $PRINCIPAL);		
						
				$PRINCIPAL = str_replace("{DESEMPENO_2019}", $Ficha[0]->d132	, $PRINCIPAL);				
				$PRINCIPAL = str_replace("{DESEMPENO_2018}", $Ficha[0]->d58	, $PRINCIPAL);				
				$PRINCIPAL = str_replace("{DESEMPENO_2017}", $Ficha[0]->d57	, $PRINCIPAL);				
				if($Ficha[0]->d141<>""){
					$Ficha[0]->d141=round(100*$Ficha[0]->d141);
					$Ficha[0]->d141=$Ficha[0]->d141."%";}
				
				$PRINCIPAL = str_replace("{LIDERAZGO_2019}", $Ficha[0]->d141	, $PRINCIPAL);				
				$PRINCIPAL = str_replace("{LIDERAZGO_2018}", ""	, $PRINCIPAL);				
				$PRINCIPAL = str_replace("{LIDERAZGO_2017}", ""	, $PRINCIPAL);				

				$Array_Promedio_Banco= Potencial_PromedioBanco($rut_col);
				//print_r($Array_Promedio_Banco);

				$PRINCIPAL = str_replace("{TC_L}", $Ficha[0]->d130	, $PRINCIPAL);				
				$PRINCIPAL = str_replace("{TC_R}", $Ficha[0]->d120	, $PRINCIPAL);				
				$PRINCIPAL = str_replace("{TC_B}", $Array_Promedio_Banco[3], $PRINCIPAL);				

				$PRINCIPAL = str_replace("{AP_L}", $Ficha[0]->d129	, $PRINCIPAL);				
				$PRINCIPAL = str_replace("{AP_R}", $Ficha[0]->d119	, $PRINCIPAL);				
				$PRINCIPAL = str_replace("{AP_B}", $Array_Promedio_Banco[2], $PRINCIPAL);				

				$PRINCIPAL = str_replace("{OB_L}", $Ficha[0]->d128	, $PRINCIPAL);				
				$PRINCIPAL = str_replace("{OB_R}", $Ficha[0]->d118	, $PRINCIPAL);				
				$PRINCIPAL = str_replace("{OB_B}", $Array_Promedio_Banco[1], $PRINCIPAL);				

				$PRINCIPAL = str_replace("{AC_L}", $Ficha[0]->d127	, $PRINCIPAL);				
				$PRINCIPAL = str_replace("{AC_R}", $Ficha[0]->d117	, $PRINCIPAL);				
				$PRINCIPAL = str_replace("{AC_B}", $Array_Promedio_Banco[0], $PRINCIPAL);				

				$d70			 =	str_replace(".00","",$Ficha21[0]->d70);
				$d71			 =	str_replace(".00","",$Ficha21[0]->d71);
				$d69			 =	str_replace(".00","",$Ficha21[0]->d69);
				$d67			 =	str_replace(".00","",$Ficha21[0]->d67);

				$PRINCIPAL = str_replace("{TC_RE}", $d70	, $PRINCIPAL);				
				$PRINCIPAL = str_replace("{AP_RE}", $d71	, $PRINCIPAL);				
				$PRINCIPAL = str_replace("{OB_RE}", $d69	, $PRINCIPAL);				
				$PRINCIPAL = str_replace("{AC_RE}", $d67	, $PRINCIPAL);				

				$d75=str_replace(".00","",$Ficha21[0]->d75);
				$d76=str_replace(".00","",$Ficha21[0]->d76);
				$d74=str_replace(".00","",$Ficha21[0]->d74);
				$d72=str_replace(".00","",$Ficha21[0]->d72);


				$PRINCIPAL = str_replace("{TC_EN}", $d75	, $PRINCIPAL);				
				$PRINCIPAL = str_replace("{AP_EN}", $d76	, $PRINCIPAL);				
				$PRINCIPAL = str_replace("{OB_EN}", $d74	, $PRINCIPAL);				
				$PRINCIPAL = str_replace("{AC_EN}", $d72	, $PRINCIPAL);				
				
				$PRINCIPAL = str_replace("{ANTIGUEDAD_EN_BCI}", 			$edad_antiguedad_en_bci->y."a ".$edad_antiguedad_en_bci->m."m", $PRINCIPAL);
				$PRINCIPAL = str_replace("{ANTIGUEDAD_EN_POSICION}", 	$edad_antiguedad_en_bci_cargo->y."a ".$edad_antiguedad_en_bci_cargo->m."m", $PRINCIPAL);


//ACCIONES DE DESARROLLO

$lista_acciones = Potencial_Acciones_Desarrollo($rut_col, $id_empresa);
foreach ($lista_acciones as $unicoAD){
	
	
			if($unicoAD->estado=="Realizado"){
				$estado="<div class='badge badge-success'><span style='color:#fff'>Realizado</span></div>";
			}  elseif($unicoAD->estado=="Suspendido"){
				$estado="<div class='badge badge-danger'><span style='color:#fff'>Suspendido</span></div>";
			}   elseif($unicoAD->estado=="En Proceso"){
				$estado="<div class='badge badge-danger'><span style='color:#fff'>En Proceso</span></div>";
			} 
			elseif($unicoAD->estado=="No Iniciado"){
				$estado="<div class='badge badge-warning'><span style='color:#fff'>No Iniciado</span></div>";
			}
			 elseif($unicoAD->estado=="No Realizado"){
				$estado="<div class='badge badge-danger'><span style='color:#fff'>No Realizado</span></div>";
			} else {
				$estado="<div class='badge badge-gray'><span style='color:#fff'>Sin Información</span></div>";
			
			}
			if($unicoAD->fecha<>""){
				$fecha_periodo=$unicoAD->fecha;
			} else {
				$fecha_periodo=$unicoAD->periodo;
			}
	$AccDes.="
	
					  				
																<div class='col-md-5'><div class=''> <div class='alert alert-info'>".utf8_encode($unicoAD->plan)."</div></div></div>
																<div class='col-md-3'><div class=''> ".utf8_encode($unicoAD->fundamento)." </div></div>
																<div class='col-md-2'><div class=''> ".utf8_encode($estado)."

																<br><span style='    font-size: 10px;color: #337ab7;'>".utf8_encode($unicoAD->fecha_estado)." <br> ".utf8_encode($unicoAD->comentario_estado)."</span>
																
																
																 </div></div>
																 <div class='col-md-1'><div class=''> <small>".utf8_encode($fecha_periodo)."</small> </div></div>

																 
																<div class='col-md-1'><div class=''>  
																
																
							<button type='button' class='btn btn-link' data-toggle='modal' data-target='#exampleAD_Modal_".$unicoAD->id."' style='font-size: 12px; text-align: left;'>
  							<span style='color: #337ab7; text-align: left;'>		Editar Estado <!--<i class='fas fa-pen'></i>--> </span>
							</button>																


<div class='modal fade' id='exampleAD_Modal_".$unicoAD->id."' tabindex='-1' role='dialog' aria-labelledby='exampleModalLabel' aria-hidden='true'>
  <div class='modal-dialog' role='document'>
    <div class='modal-content'>
      <div class='modal-body'>
       	<br>Editar Estado de Acción de Desarrollo:  <strong>".utf8_encode($unicoAD->plan)."</strong>
       	<br><br>
       	
       	<form id='".$unicoAD->id."' name='".$unicoAD->id."' action='' method='post'>
       	<div class='txt_2020'>Estado</div>
       		<select name='estado' class='form form-control' required>
       				<option value='".$unicoAD->estado."'>".$unicoAD->estado."</option>
       				<option value='Realizado'>Realizado</option>
       				<option value='Suspendido'>Suspendido</option>
       				<option value='En Proceso'>En Proceso</option>
       				<option value='No Iniciado'>No Iniciado</option>

       		</select>
       		<div class='txt_2020'>Fundamento / Comentarios</div>
       		<input type='text' name='fundamento' id='fundamento'  class='form form-control' required value='".utf8_encode($unicoAD->fundamento)."'>
       		<input type='hidden' value='".Encodear3($unicoAD->id)."' name='idEdEst'>
       		<br><input type='submit' class='btn btn-info' name='editar' value='Actualizar Estado'>
       	</form>
      </div>
    </div>
  </div>
</div>
																
																</div></div>
															 <div class='col-md-12'><div class=''><hr> </div></div>
	";
	
	
}

								$PRINCIPAL = str_replace("{POTENCIAL_FICHA_ACCIONES_DESARROLLO}", $AccDes	, $PRINCIPAL);				
		
//bitacora

		$lista = Potencial_Bitacora_Comites_FullRut_data($rut_col, $id_empresa);
		//print_r($lista);

    $num_comentarios    =   count($lista);
    //echo "<br>num_comites $num_comites<br>";
    if($num_comentarios>0){
        $potencial_bitacora_titulo="

<div class='panel panel-info'>	<div class='panel-heading'>Comentarios</div>     <div class='panel-body'>
<div class=''>    <strong>   </strong></div>";
    }   else   {
        $potencial_bitacora_titulo="

<div class='panel panel-info'>	<div class='panel-heading'>Comentarios</div>     <div class='panel-body'>
<div class=''><div class=''><br>    <div class='col-sm-12 txt_title_pot_hohay'><center>[ No hay comentarios de cuadrantes ]</center></div>
    					<br></div></div>


";

    }
    //print_r($lista);
    foreach($lista as $unico) {
        //echo "<br>hola ".$unico->nombre;
        
        $EsSocioLider=EsSocioOLider($unico->rut);
        //print_r($EsSocioLider);
        
        if($EsSocioLider>0){
        	$agregado_socio="Cuadrante Final";
        	
        } else {
        	
        	$agregado_socio="Cuadrante Propuesto por Lider";
        }
        
        $row_lsita.= file_get_contents("views/potencial/" . $id_empresa . "_potencial_row_colaboradores_bitacora_ficha.html");
        //echo "<br>views/potencial/" . $id_empresa . "_potencial_row_comites.html";
        $row_lsita = str_replace("{COMITE}",     				"<strong>".utf8_encode($unico->comite)."</strong>", $row_lsita);       
        $row_lsita = str_replace("{fecha_COMITE}",     				"".utf8_encode($unico->fecha_comite)."", $row_lsita);       
        $row_lsita = str_replace("{NOMBRE_AUTOR}",      utf8_encode($unico->nombre_completo)."", $row_lsita);
        $row_lsita = str_replace("{TIPO_COMITE}",      utf8_encode($unico->tipo_bitacora)."", $row_lsita);
        $row_lsita = str_replace("{FOTO_AUTOR}",        VerificaFotoPersonal($unico->rut), $row_lsita);
        $row_lsita = str_replace("{PERFIL}",            utf8_encode($unico->perfil), $row_lsita);
        $row_lsita = str_replace("{FOTO_COLABORADOR}",  VerificaFotoPersonal($unico->rut_colaborador), $row_lsita);
        $row_lsita = str_replace("{NOMBRE_COLABORADOR}",utf8_encode($unico->nombre_completo_col), $row_lsita);
        $box_propuesto=Potencial_Matriz_Box_Nuevo_Propuesta($unico->box_propuesto);

if($unico->box_propuesto<>""){
	
	if($unico->box_propuesto>0){
		
	} else {
		$agregado_socio="Accion";
	}
	
	if($unico->box_propuesto=="10"){$unico->box_propuesto="5+";}
	      	$row_lsita = str_replace("{BOX}",   "<br>$agregado_socio: ".utf8_encode($unico->box_propuesto), $row_lsita);

} else {
	      	$row_lsita = str_replace("{BOX}",   "", $row_lsita);

}

        $row_lsita = str_replace("{COMENTARIO}", utf8_encode($unico->comentario), $row_lsita);
        $row_lsita = str_replace("{FECHA}", utf8_encode($unico->fecha), $row_lsita);
        $row_lsita = str_replace("{ID_ENC}", Encodear3($unico->id), $row_lsita);

        $row_lsita = str_replace("{RUT_COL_ENC}", Encodear3($rut_col), $row_lsita);
        $row_lsita = str_replace("{ID_COMITE_ENC}", ($id_comite_enc), $row_lsita);

        
        
        
        
      if($unico->rut==$rut){
      	
      
				$boton_ver_editar_BIT   ="<button type='button' class='btn btn-link' data-toggle='modal' data-target='#".Encodear3($unico->id)."'>
        <span class='azul_comite'><i class='fas fa-edit'></i> </span></button>";
        
				$boton_ver_borrar_BIT   ="<a href='?sw=potencial_ficha&rut_col=".Encodear3($rut_col)."&id_comite=".$id_comite_enc."&delBit=".Encodear3($unico->id)."'>
        <span class='azul_comite'><i class='fas fa-trash'></i> </span></a>";                
	} else {
		$boton_ver_editar_BIT   ="";
		$boton_ver_borrar_BIT   ="";
	}
        $row_lsita = str_replace("{EDITAR_BITACORA}", ($boton_ver_editar_BIT), $row_lsita);
        $row_lsita = str_replace("{BORRAR_BITACORA}", ($boton_ver_borrar_BIT), $row_lsita);

        
    }				


		//MET TRI
		$Met_tri_Ficha_Colaborador	=	"";
		
		$Met_tri_array=Pontencial_Busca_Met_Tri($rut_col, $id_empresa);
		if(count($Met_tri_array)>0){
			
			$row_Met_tri.="
			

							  <div class='card' style='max-width: 100%;'>
							    <div class='card-header' id='headingFour' style='color: #ffffff;background-color: #50748a;border-color: #bce8f1;min-height: 40px;'>
							      <h5 class='mb-0'>
							        <button class='btn btn-link' data-toggle='collapse' data-target='#collapseFour' aria-expanded='true' aria-controls='collapseFour'>
							          <span style='color:#fff'>
							          	Metas Trimestrales
							          </span>
							        </button>
							      </h5>
							    </div>
							    <div id='collapseFour' class='collapse' aria-labelledby='headingFour' data-parent='#accordion'>
							      <div class='card-body' style='padding: 10px;'>
				
										 
										 					<div class='row'>
																<div class='col-md-3'><div class='txt_2020'> A&ntilde;o </div></div>
																<div class='col-md-2'><center><div class='txt_2020'> T1</div></center></div>
																<div class='col-md-2'><center><div class='txt_2020'> T2 </div></center></div>
																<div class='col-md-2'><center><div class='txt_2020'> T3 </div></center></div>
																<div class='col-md-2'><center><div class='txt_2020'> T4 </div></center></div>
																<div class='col-md-1'><center><div class='txt_2020'> </div></div>
															</div>
										 
										";
	

			
			foreach ($Met_tri_array as $UniMetTri){
			
			/*	if($UniMetTri->year=="2019"){
						if($UniMetTri->t1>73)		{$t1_style="badge-success";} else {$t1_style="badge-danger";}
						if($UniMetTri->t2>55)		{$t2_style="badge-success";} else {$t2_style="badge-danger";}
						if($UniMetTri->t3>60)		{$t3_style="badge-success";} else {$t3_style="badge-danger";}
						if($UniMetTri->t4>50)		{$t4_style="badge-success";} else {$t4_style="badge-danger";}
				}

				if($UniMetTri->year=="2020"){
						if($UniMetTri->t1>60)		{$t1_style="badge-success";} else {$t1_style="badge-danger";}
						if($UniMetTri->t2>60)		{$t2_style="badge-success";} else {$t2_style="badge-danger";}
						if($UniMetTri->t3>60)		{$t3_style="badge-success";} else {$t3_style="badge-danger";}
						if($UniMetTri->t4>60)		{$t4_style="badge-success";} else {$t4_style="badge-danger";}
					
				}
			*/
						$t1_style=" badge-info ";		
						$t2_style=" badge-info ";
						$t3_style=" badge-info ";
						$t4_style=" badge-info ";
						
						$row_Met_tri.="<div class='row'>
																<div class='col-md-3'><div class='Txt_2020_title'><i class='fas fa-caret-right'></i> ".$UniMetTri->year." </div></div>
																<div class='col-md-2'><div class='Txt_2020_title'><center><div class='badge ".$t1_style."' style='color:#fff'> ".$UniMetTri->t1."</div></center></div></div>
																<div class='col-md-2'><div class='Txt_2020_title'><center><div class='badge ".$t2_style."' style='color:#fff'> ".$UniMetTri->t2."</div></center></div></div>
																<div class='col-md-2'><div class='Txt_2020_title'><center><div class='badge ".$t3_style."' style='color:#fff'> ".$UniMetTri->t3."</div></center></div></div>
																<div class='col-md-2'><div class='Txt_2020_title'><center><div class='badge ".$t4_style."' style='color:#fff'> ".$UniMetTri->t4."</div></center></div></div>
																<div class='col-md-1'></div>
															</div>
											";
			}
			
						$row_Met_tri.="
									</div>
							 </div>
						</div>";
						
			$Metas_Trim=$row_Met_tri;
			
		} else {
			
			$Metas_Trim	=	"";
			
		}
						$PRINCIPAL = str_replace("{METAS_TRIMESTRALES_FICHA_COLABORADOR}", $Metas_Trim	, $PRINCIPAL);				
					
		
		
		//SNES
		$Snes_Ficha_Colaborador	=	"";
		
		$SNES_array=Pontencial_Busca_Snes($rut_col, $id_empresa);
		if(count($SNES_array)>0){
			
			$row_snes.="
			
							  <div class='card' style='max-width: 100%;'>
							    <div class='card-header' id='headingNine' style='color: #ffffff;background-color: #50748a;border-color: #bce8f1;min-height: 40px;'>
							      <h5 class='mb-0'>
							        <button class='btn btn-link' data-toggle='collapse' data-target='#collapseNine' aria-expanded='true' aria-controls='collapseNine'>
							          <span style='color:#fff'>
							          	Snex
							          </span>
							        </button>
							      </h5>
							    </div>
							    <div id='collapseNine' class='collapse' aria-labelledby='headingNine' data-parent='#accordion'>
							      <div class='card-body' style='padding: 10px;'>			
			
										 
										 					<div class='row'>
																<div class='col-md-3'><div class='txt_2020'> A&ntilde;o </div></div>
																<div class='col-md-2'><center><div class='txt_2020'> T1</div></center></div>
																<div class='col-md-2'><center><div class='txt_2020'> T2 </div></center></div>
																<div class='col-md-2'><center><div class='txt_2020'> T3 </div></center></div>
																<div class='col-md-2'><center><div class='txt_2020'> T4 </div></center></div>
																<div class='col-md-1'><center><div class='txt_2020'> </div></div>
															</div>
										 
										";
	
	
	/*
	
	Adjunto tabla con los puntajes de corte por lo tanto deberían quedar rojos si están bajo este número por trimestre

BANCA PERSONAS: JEFE DE OFICINA BANCA PERSONAS
2019
BP	1T	2T	3T	4T
Meta minima BP (50%)	73	55	60	50

2020
BP	1T	2T
Meta minima BP (50%)	60	60

*/
			
			foreach ($SNES_array as $UniSnes){
			
			
			
							if($UniSnes->year=="2019"){
						if($UniSnes->t1>73)		{$t1_style="badge-success";} else {$t1_style="badge-danger";}
						if($UniSnes->t2>55)		{$t2_style="badge-success";} else {$t2_style="badge-danger";}
						if($UniSnes->t3>60)		{$t3_style="badge-success";} else {$t3_style="badge-danger";}
						if($UniSnes->t4>50)		{$t4_style="badge-success";} else {$t4_style="badge-danger";}
				}

				if($UniSnes->year=="2020"){
						if($UniSnes->t1>60)		{$t1_style="badge-success";} else {$t1_style="badge-danger";}
						if($UniSnes->t2>60)		{$t2_style="badge-success";} else {$t2_style="badge-danger";}
						if($UniSnes->t3>60)		{$t3_style="badge-success";} else {$t3_style="badge-danger";}
						if($UniSnes->t4>60)		{$t4_style="badge-success";} else {$t4_style="badge-danger";}
					
				}
			
						
						$row_snes.="<div class='row'>
																<div class='col-md-3'><div class='Txt_2020_title'><i class='fas fa-caret-right'></i> ".$UniSnes->year." </div></div>
																<div class='col-md-2'><div class='Txt_2020_title'><center><div class='badge ".$t1_style."' style='color:#fff'> ".$UniSnes->t1."</div></center></div></div>
																<div class='col-md-2'><div class='Txt_2020_title'><center><div class='badge ".$t2_style."' style='color:#fff'> ".$UniSnes->t2."</div></center></div></div>
																<div class='col-md-2'><div class='Txt_2020_title'><center><div class='badge ".$t3_style."' style='color:#fff'> ".$UniSnes->t3."</div></center></div></div>
																<div class='col-md-2'><div class='Txt_2020_title'><center><div class='badge ".$t4_style."' style='color:#fff'> ".$UniSnes->t4."</div></center></div></div>
																<div class='col-md-1'></div>
															</div>
											";
			}
			
						$row_snes.="
									</div>
							 </div>
						</div>";
						
			$Snes_Ficha_Colaborador=$row_snes;
			
		} else {
			
			$Snes_Ficha_Colaborador	=	"";
			
		}
						$PRINCIPAL = str_replace("{SNES_FICHA_COLABORADOR}", $Snes_Ficha_Colaborador	, $PRINCIPAL);				
			
			$array_EsSucesor=Pot_Full_Es_Sucesor($rut_col);
			//print_r($array_EsSucesor);
			
			if(count($array_EsSucesor)>0){
				
				
				
				
				$esSucesor.="<div class='card' style='max-width: 100%;'>
							    <div class='card-header' id='headingSuc' style='color: #ffffff;background-color: #50748a;border-color: #bce8f1;min-height: 40px;'>
							      <h5 class='mb-0'>
							        <button class='btn btn-link' data-toggle='collapse' data-target='#collapseSuc' aria-expanded='true' aria-controls='collapseSuc'>
							          <span style='color:#fff'>
							          	Sucesor de Cargos (".$es_sucesor.") <i class='fas fa-chevron-down' style='display: inline;'></i>
							          </span>
							        </button>
							      </h5>
							    </div>
							    <div id='collapseSuc' class='collapse' aria-labelledby='headingSuc' data-parent='#accordion'>
							      <div class='card-body' style='padding: 10px;'>			
			
										 
										 					<div class='row'>
																<div class='col-md-12'><div class='txt_2020'> Sucesor de Cargos </div></div>
															</div>
										 
										";
									
									
					foreach ($array_EsSucesor as $UniSuc){
			
			
			
						
						$esSucesor.="<div class='row'>
																<div class='col-md-6'>
																	<div class='Txt_2020_title'>
																		<i class='fas fa-caret-right'></i> ".$UniSuc->posicion." 
																	</div>
																</div>
																<div class='col-md-3'>
																	<div class='Txt_2020_title'>
																		<i class='fas fa-caret-right'></i> ".$UniSuc->tipo_sucesion." 
																	</div>
																</div>
																<div class='col-md-3'>
																	<div class='Txt_2020_title'>
																		<i class='fas fa-caret-right'></i> ".FechaCastellano2($UniSuc->fecha)." 
																	</div>
																</div>																																
															</div>
											";
			}					
											$esSucesor.="
									</div>
							 </div>
						</div>";					
										
			} else {
				$esSucesor="";
			}

						$PRINCIPAL = str_replace("{LISTA_ES_SUCESOR}", $esSucesor	, $PRINCIPAL);				

						
						$PRINCIPAL = str_replace("{TITULO_BITACORA}", $potencial_bitacora_titulo	, $PRINCIPAL);				
						$PRINCIPAL = str_replace("{MI_BITACORA}", $row_lsita	, $PRINCIPAL);				




$Desempeno_2020=Potencial_BuscaDesempeno_2020($rut_col);
//print_r($Desempeno_2020);
		
		

if($Desempeno_2020[0]->meta_2020==""){
	$meta_2020="-";
} else {

	$meta_2020=round(100*$Desempeno_2020[0]->meta_2020,2)."%";
}

if($Desempeno_2020[0]->desempeno_2020==""){
	$desempeno_2020="-";
} else {
	$desempeno_2020=$Desempeno_2020[0]->desempeno_2020;
}

if($Desempeno_2020[0]->clima_2020==""){
	$clima_2020="-";
} else {
	$clima_2020=round(100*$Desempeno_2020[0]->clima_2020,1)."%";
}

						$PRINCIPAL = str_replace("{METAS_2020}", $meta_2020	, $PRINCIPAL);				
						$PRINCIPAL = str_replace("{DESEMPENO_2020}", $desempeno_2020	, $PRINCIPAL);	

$Clima_Engagement_Liderazgo_2021=Potencial_tbl_tbl_potencial_clima_2021($rut_col);

if($Clima_Engagement_Liderazgo_2021[0]->clima==""){
	$clima_2021="-";
} else {
	$clima_2021=$Clima_Engagement_Liderazgo_2021[0]->clima;
}
if($Clima_Engagement_Liderazgo_2021[0]->compromiso==""){
	$engagement_2021="-";
}	else {
	$engagement_2021=$Clima_Engagement_Liderazgo_2021[0]->compromiso;
}
if($Clima_Engagement_Liderazgo_2021[0]->liderazgo==""){
	$liderazgo_2021="-";
}	else {
	$liderazgo_2021=$Clima_Engagement_Liderazgo_2021[0]->liderazgo;
}				
									
						$PRINCIPAL = str_replace("{CLIMA_2020}", 			$clima_2020	, $PRINCIPAL);				
						$PRINCIPAL = str_replace("{ENGAGEMENT_2020}", $engagement_2020	, $PRINCIPAL);				
						$PRINCIPAL = str_replace("{LIDERAZGO_2020}", 	$liderazgo_2020	, $PRINCIPAL);				

						$PRINCIPAL = str_replace("{CLIMA_2021}", 			$clima_2021	, $PRINCIPAL);				
						$PRINCIPAL = str_replace("{ENGAGEMENT_2021}", $engagement_2021	, $PRINCIPAL);				
						$PRINCIPAL = str_replace("{LIDERAZGO_2021}", 	$liderazgo_2021	, $PRINCIPAL);				

		
						$PRINCIPAL = str_replace("{AC_L_2020}", $Desempeno_2020[0]->acd	, $PRINCIPAL);				
						$PRINCIPAL = str_replace("{OB_L_2020}", $Desempeno_2020[0]->omp	, $PRINCIPAL);				
						$PRINCIPAL = str_replace("{AP_L_2020}", $Desempeno_2020[0]->sac	, $PRINCIPAL);				
						$PRINCIPAL = str_replace("{TC_L_2020}", $Desempeno_2020[0]->lob	, $PRINCIPAL);				

						$PRINCIPAL = str_replace("{AC_B_2020}", $Desempeno_2020[0]->acd_banco	, $PRINCIPAL);				
						$PRINCIPAL = str_replace("{OB_B_2020}", $Desempeno_2020[0]->omp_banco	, $PRINCIPAL);				
						$PRINCIPAL = str_replace("{AP_B_2020}", $Desempeno_2020[0]->sac_banco	, $PRINCIPAL);				
						$PRINCIPAL = str_replace("{TC_B_2020}", $Desempeno_2020[0]->lob_banco	, $PRINCIPAL);				



		
		// Panel de LIDERAZGO_2017
$year=date("Y");
//echo "YEAR $year";
//QUE
$arreglo_1	= PanelBuscaTipoDatos($PRINCIPAL, $id_empresa, $rut_col, "QUE", $year);
$PRINCIPAL	= $arreglo_1[0];
$res_1			= $arreglo_1[1];


//COMPETENCIAS
$arreglo_3	= PanelBuscaTipoDatos($PRINCIPAL, $id_empresa, $rut_col, "COMPETENCIAS", $year);
$PRINCIPAL	= $arreglo_3[0];
$res_3			= $arreglo_3[3];
  
//echo "Res1 $res_1, Res $res_2 Res3 $res_3";
$resultado_final_final		= 	PanelLiderazgoResultadoFinalCompleto($res_1,$res_3);		
		
//	echo 	"resultado ".$resultado_final_final;

						$PRINCIPAL = str_replace("{RESULTADO_METRICAS_LIDERAZGO}", $resultado_final_final."%"	, $PRINCIPAL);				
						$PRINCIPAL = str_replace("{YEAR_RESULTADO_METRICAS_LIDERAZGO}", $year, $PRINCIPAL);				

		
        $PRINCIPAL = ColocaDatosPerfil($PRINCIPAL, $rut_col);
        echo $PRINCIPAL;
    }

else if ($seccion == "potencial_ficha_sucesion") {
	
        $rut = $_SESSION["user_"];
        $id_empresa = $_SESSION["id_empresa"];
        $id_inst = ($_GET["id_inst"]);
        $profile = ($_GET["profile"]);
        $perfil = ($_GET["perfil"]);
        //echo "<br>perfil $perfil ".Decodear3($perfil);
        $rut_col = Decodear3($_REQUEST["rut_col"]);
        $id_comite_enc = ($_GET["id_comite"]);
        $id_comite		= Decodear3($id_comite_enc);
        $id_posicion = Decodear3($_REQUEST["id_posicion_enc"]);
        $array_comite=Potencial_Comites_Suc_data($id_comite,$id_empresa);

				$LiderSuc=Sucesion_Rut_Nombre_lider_posicion($id_posicion);
				if($LiderSuc[0]->rut==$_SESSION["user_"]){$soylider=1;} else {$soylider="";}
        $perfil = Decodear3($_GET["perfil"]);
        $delad = Decodear3($_GET["delad"]);
        //echo "perfil $perfil";
        
        if($delad<>""){
        	Potencial_Delete_Acciones_Desarrollo($delad);
        }
        
        if($_GET["close_posicion"]==1){
        	//echo "cierre posicion ".$id_posicion;
        	Sucesion_Update_Cierre_Posicion_lider($id_posicion);
        }
        
        if($_POST["plan_acciones_desarrollo"]<>"" and $_POST["rut_col_enc"]<>""){
        	$rut_enc_plan=Decodear3($_POST["rut_col_enc"]);
        	Potencial_Insert_Acciones_Desarrollo($rut_enc_plan, $id_comite, $_POST["plan_acciones_desarrollo"],$_POST["fundamento"]);
        }
        
        if(Decodear3($_GET["del"])<>""){
        	

        	
        	$rut_col_ed=Potencial_trae_rut_col_fromId_Sucesion(Decodear3($_GET["del"]));
        	Potencial_Insert_Col_Bitacora_Sucesion_CheckSave($rut, $perfil, $id_comite,$rut_col_ed,$_POST["fundamento"],"eliminado",$id_empresa);
        	Potencial_Del_tbl_potencial_sucesion_colaboradores_propuestos_r2(Decodear3($_GET["del"]), Decodear3($_GET["perfil_del"]));
        }
        
        if($_POST["tipo_sucesion_ficha"]<>""){
        	$id_sucesor=Decodear3($_POST["id_sucesor"]);
        	Potencial_Actualiza_tbl_potencial_sucesion_colaboradores_propuestos_r2($id_sucesor, $_POST["tipo_sucesion_ficha"]);
        	$rut_col_ed=Potencial_trae_rut_col_fromId_Sucesion($id_sucesor);
        	Potencial_Insert_Col_Bitacora_Sucesion_CheckSave($rut, $perfil, $id_comite,$rut_col_ed,$_POST["fundamento"],"editado",$id_empresa);
        }
       
        if($_POST["rut_save"]<>""){
        	
        			$rut_save       = LimpiaRutFront($_POST["rut_save"]);
							$miRx=MiRx($rut);
		        	$miRx_2=MiRx($rut_save);
		        	$sigue_save=CheckMiRxRxPropuesto($miRx,	$miRx_2);
		        	$PerfilSuperUser=0;
		        	$PerfilSuperUser=Potencial_Es_SuperUsers($rut);
		        	//echo "<br>PerfilSuperUser $PerfilSuperUser<br>";
		        	//exit();
		        	if($sigue_save=="SI" or $PerfilSuperUser>0){
		        		Potencial_Insert_Col_Sucesion_CheckSave($id_comite,$rut_save,$_POST["tipo_sucesion"],$id_posicion,$id_empresa, $soylider);
		        		Potencial_Insert_Col_Bitacora_Sucesion_CheckSave($rut, $perfil, $id_comite,$rut_save,$_POST["fundamento"],"agregado",$id_empresa);
		        		
		        	} else{
		        		echo "<script>alert('No puedes proponer colaboradores superiores a ".$miRx."');history.back();</script>";exit();
		        		
		        	}

        }
        
//externos

				//print_r($_POST);
				
				
				if($_POST["tipo_feed"]=="externo"){
					
					$rut_ficticio_usuario=DatosUsuarioMax();
					//echo "rut_ficticio_usuario $rut_ficticio_usuario";
					
					$nombre_externo=utf8_decode($_POST["nombre_externo"]);
					$cargo_externo=utf8_decode($_POST["empresa_externo"]);
					
					PotencialInsertUsuario($rut_ficticio_usuario,$nombre_externo,$cargo_externo, $id_empresa);
					
		      Potencial_Insert_Col_Sucesion_CheckSave($id_comite,$rut_ficticio_usuario,$_POST["tipo_sucesion"],$id_posicion,$id_empresa, $soylider);
        	Potencial_Insert_Col_Bitacora_Sucesion_CheckSave($rut, $perfil, $id_comite,$rut_ficticio_usuario,$_POST["observaciones"],"agregado",$id_empresa);
			
					
					
				}        
        
        //$perfil =Potencial_Perfil_Usuarios($rut, $id_empresa);
        $saveform = ($_GET["saveform"]);
				$editBit=Decodear3($_POST["editBit"]);
				$delBit=Decodear3($_GET["delBit"]);
				//echo "editbit $editBit delbit $delBit";
				
  			if($editBit>0){
        	Potencial_EliminaBitacora($editBit);
        }

  			if($delBit>0){
        	Potencial_EliminaBitacora($delBit);
        }
                
        if($saveform=="sf"){
                $nuevo_cuadrante    =   $_POST["nuevo_cuadrante"];
                $comentario         =   $_POST["comentario"];
                $id                 =   $_POST["id"];
								$rut_col_sf         =   Decodear3($_POST["rut_col"]);
        				
        				
        				if($perfil=="LIDER"){
        					Potencial_comite_update_tbl_data_bci_lider($nuevo_cuadrante, $comentario, $id_comite, $rut, $id, $id_empresa,$perfil, $rut_col_sf);
        				} else {
        					Potencial_comite_update_tbl_data_bci_socio($nuevo_cuadrante, $comentario, $id_comite, $rut, $id, $id_empresa,$perfil, $rut_col_sf);	
        				}
                
                
      


								if($nuevo_cuadrante=="10"){$nuevo_cuadrante="5+";}
								$array_usu=Potencial_BuscaColaborador($id, $id_empresa);
								//print_r($array_usu);
								$datos_colaborador = UsuarioEnBasePersonas($array_usu[0]->rut, $rutcontodo);
								$datos_lider = UsuarioEnBasePersonas($array_usu[0]->rut_lider, $rutcontodo);
								$datos_usuario = UsuarioEnBasePersonas($rut, $rutcontodo);
								$datos_socio = UsuarioEnBasePersonas($array_usu[0]->rut_socio, $rutcontodo);
								//print_r($datos_colaborador);
								    if($perfil=="SOCIO DE NEGOCIO")     {

								$template_correo="template_potencial"; $tipo="";
								$datos_usuario = mp_buscaDATOSPERSONAS($rut, $id_empresa);
								$titulo1 = "Has modificado el cuadrante de ".$datos_colaborador[0]->nombre_completo;
								$subject = "Has modificado el cuadrante de ".$datos_colaborador[0]->nombre_completo;
								$subtitulo1 = "Estimado(a) ".$datos_usuario[0]->nombre_completo."<br> <br>Has modificado el cuadrante de ".$datos_colaborador[0]->nombre_completo.", que pertenece al lider ".$datos_lider[0]->nombre_completo. "";
								$texto1 = "<br> Nuevo Cuadrante: ".$nuevo_cuadrante."<br>Comentario: ".($comentario);$texto2 = "";$texto4 = "";$texto3 = "";$tipomensaje = "PotencialBci";
								$rut = $datos_usuario[0]->rut; $key = $datos_usuario[0]->rut;$to = $datos_usuario[0]->email;
								$nombreto = utf8_encode($datos_usuario[0]->nombre_completo);
								$to= ($datos_usuario[0]->email);
								//SendGrid_Email($to, $nombreto, $from, $nombrefrom, $tipo, $subject, $titulo1, $subtitulo1, $texto1, $url, $texto_url, $texto2, $texto3, $texto4, $logo, $id_empresa, $url, $tipomensaje, $rut, $key,$template_correo);

								$template_correo="template_potencial"; $tipo="";
								$datos_usuario = mp_buscaDATOSPERSONAS($rut, $id_empresa);
								$titulo1 = "Han modificado el cuadrante de ".$datos_colaborador[0]->nombre_completo;
								$subject = "Han modificado el cuadrante de ".$datos_colaborador[0]->nombre_completo;
								$subtitulo1 = "Estimado(a) ".$datos_lider[0]->nombre_completo."<br> <br>El Socio de Negocio ".$datos_usuario[0]->nombre_completo.", ha modificado el cuadrante de ".$datos_colaborador[0]->nombre_completo."";
								$texto1 = "<br> Nuevo Cuadrante: ".$nuevo_cuadrante."<br>Comentario: ".($comentario);$texto2 = "";$texto4 = "";$texto3 = "";$tipomensaje = "PotencialBci";
								$rut = $datos_usuario[0]->rut; $key = $datos_usuario[0]->rut;$to = $datos_usuario[0]->email;
								$nombreto = utf8_encode($datos_lider[0]->nombre_completo);
								$to= ($datos_lider[0]->email);
								//SendGrid_Email($to, $nombreto, $from, $nombrefrom, $tipo, $subject, $titulo1, $subtitulo1, $texto1, $url, $texto_url, $texto2, $texto3, $texto4, $logo, $id_empresa, $url, $tipomensaje, $rut, $key,$template_correo);

								        }
								    if($perfil=="LIDER")     {
								$template_correo="template_potencial"; $tipo="";
								$datos_usuario = mp_buscaDATOSPERSONAS($rut, $id_empresa);
								$titulo1 = "Has modificado el cuadrante de ".$datos_colaborador[0]->nombre_completo;
								$subject = "Has modificado el cuadrante de ".$datos_colaborador[0]->nombre_completo;
								$subtitulo1 = "Estimado(a) ".$datos_usuario[0]->nombre_completo."<br> <br>Has modificado el cuadrante de ".$datos_colaborador[0]->nombre_completo."";
								$texto1 = "<br> Nuevo Cuadrante: ".$nuevo_cuadrante."<br>Comentario: ".($comentario);$texto2 = "";$texto4 = "";$texto3 = "";$tipomensaje = "PotencialBci";
								$rut = $datos_usuario[0]->rut; $key = $datos_usuario[0]->rut;$to = $datos_usuario[0]->email;
								$nombreto = utf8_encode($datos_usuario[0]->nombre_completo);
								$to= ($datos_usuario[0]->email);
								//SendGrid_Email($to, $nombreto, $from, $nombrefrom, $tipo, $subject, $titulo1, $subtitulo1, $texto1, $url, $texto_url, $texto2, $texto3, $texto4, $logo, $id_empresa, $url, $tipomensaje, $rut, $key,$template_correo);

								$template_correo="template_potencial"; $tipo="";
								$datos_usuario = mp_buscaDATOSPERSONAS($rut, $id_empresa);
								$titulo1 = "Han modificado el cuadrante de ".$datos_colaborador[0]->nombre_completo;
								$subject = "Han modificado el cuadrante de ".$datos_colaborador[0]->nombre_completo;
								$subtitulo1 = "Estimado(a) ".$datos_socio[0]->nombre_completo."<br> <br>El Lider ".$datos_lider[0]->nombre_completo.", ha modificado el cuadrante de ".$datos_colaborador[0]->nombre_completo."";
								$texto1 = "<br> Nuevo Cuadrante: ".$nuevo_cuadrante."<br>Comentario: ".($comentario);$texto2 = "";$texto4 = "";$texto3 = "";$tipomensaje = "PotencialBci";
								$rut = $datos_usuario[0]->rut; $key = $datos_usuario[0]->rut;$to = $datos_usuario[0]->email;
								$nombreto = utf8_encode($datos_socio[0]->nombre_completo);
								$to= ($datos_socio[0]->email);
								//SendGrid_Email($to, $nombreto, $from, $nombrefrom, $tipo, $subject, $titulo1, $subtitulo1, $texto1, $url, $texto_url, $texto2, $texto3, $texto4, $logo, $id_empresa, $url, $tipomensaje, $rut, $key,$template_correo);

                        }

        }
   
				$Ficha				=	Potencial_Colaboradores_Matriz_tbl_data_bci_data($id_empresa, $rut_col);
				//echo "Ficha[0]->d128 ".$Ficha[0]->d128;
				//echo "rut $rut_col";
				$es_posicion_clave=Pot_CheckPosicion_Clave($rut_col);
				
				if($es_posicion_clave>0){
					$posicion_clave	=" 
							<div class=' col-lg-3'></div>
								<div class=' col-lg-6'>
									<div class='badge badge-gray'  style='    background-color: transparent !important;padding-left: 0px!important;'>
										<center>
											<strong>Posición Clave</strong>
										</center>
									</div>
								</div>
							<div class=' col-lg-3'></div>
							
							";
				} else {
					$posicion_clave="";	
				}
	
				$Pot_NombreLider="Lider: ".Potencial_Busca_Nombre_Lider($rut_col,$id_comite_enc);
				//echo "rut lider $RutLider";
        $PRINCIPAL 		= (FuncionesTransversales(file_get_contents("views/potencial/" . $id_empresa . "_potencial_ficha_sucesion.html")));
        //$perfil 			="USUARIO";
        // $perfil 			=	Potencial_Perfil_Usuarios($rut, $id_empresa);
        $PRINCIPAL = str_replace("{DISCLAIMER_BAJO_26}", 	$disclaimer, $PRINCIPAL);
        $PRINCIPAL = str_replace("{DATA_BCI_D20}",				$Ficha[0]->d20, $PRINCIPAL);
        $PRINCIPAL = str_replace("{POSICION_CLAVE}", 			$posicion_clave, $PRINCIPAL);
        $PRINCIPAL = str_replace("{NOMBRE_LIDER}", 				$Pot_NombreLider, $PRINCIPAL);
        $PRINCIPAL = str_replace("{PERFIL_ENC}", 					$_GET["perfil"], $PRINCIPAL);
				$PRINCIPAL 		=	Potencial_Sucesion_Colaboradores_Comites_Ficha($PRINCIPAL, $id_comite, $rut, $perfil, $id_posicion, $id_empresa);
        $PRINCIPAL = str_replace("{POSICION}", 						$id_posicion, $PRINCIPAL);
			
				
        $PRINCIPAL = str_replace("{NOMBRE_LIDER_SUCESION}", 	$LiderSuc[0]->d7." ".$LiderSuc[0]->d8." ".$LiderSuc[0]->d9, $PRINCIPAL);

				

        
       if($Ficha[0]->d143<>"")
       {
					$Ficha[0]->d143=round(100*$Ficha[0]->d143);
					$Ficha[0]->d143=$Ficha[0]->d143."%";
			}



        
        $PRINCIPAL = str_replace("{ENGAGEMENT_2019}",				$Ficha[0]->d143, $PRINCIPAL);
        $PRINCIPAL = str_replace("{BOTON_CREAR_COMITE_POTENCIAL}", $boton_crear_comite, $PRINCIPAL);
        $PRINCIPAL = str_replace("{PERFIL}", $perfil, $PRINCIPAL);
        $PRINCIPAL = str_replace("{ID_COMITE_ENC}", $id_comite_enc, $PRINCIPAL);
				$comite_cerrado=$array_comite[0]->comite_cerrado;
				//echo "<br>comite_cerrado $comite_cerrado";
				if($comite_cerrado=="SI"){
				$display_none_edit=" display:none;";
				$boton_ver_editar_box   ="";
				} else {
					$display_none_edit=" ";

								if($RutLider==$rut){
								$boton_ver_editar_box   ="<button type='button' class='btn btn-info' data-toggle='modal' data-target='#".Encodear3($rut_col)."'>
				        <span class='blanco'><i class='fas fa-edit'></i> Proponer Cuadrante</span></button>";
									
								} else {
								$boton_ver_editar_box   ="<button type='button' class='btn btn-info' data-toggle='modal' data-target='#".Encodear3($rut_col)."'>
				        <span class='blanco'><i class='fas fa-edit'></i> Editar Cuadrante</span></button>";
									
								}
				}
        
        $PRINCIPAL = str_replace("{BOTON_VER_EDITAR_BOX}", $boton_ver_editar_box	, $PRINCIPAL);	
        $PRINCIPAL = str_replace("{RUT_COL_ENC}", Encodear3($rut_col)	, $PRINCIPAL);	

				$lista = Potencial_Bitacora_Comites_FullRut_data($rut_col, $id_empresa);
					//print_r($lista);

$posicion_validada=Sucesion_Check_Posicion_validada($id_posicion);

if($posicion_validada>0){
	
	$aprobar_cargo_lider.="<br><center><div class='alert alert-success'>Propuesta de Sucesión Cerrada por Líder</div>";
} else {
	
		$aprobar_cargo_lider.="<br><center><div class='alert alert-warning'>Propuesta de Sucesión Pendiente Líder</div>";
	
	if($soylider=="1"){
		$aprobar_cargo_lider.="<br><a href='?sw=potencial_ficha_sucesion&close_posicion=1&id_posicion_enc=".$_GET["id_posicion_enc"]."=&id_comite=".$_GET["id_comite"]."&perfil=".$_GET["perfil"]."' class='btn btn-success'>Cierre de Propuesta de Sucesión</a> ";
	}
	
	
}


        $PRINCIPAL = str_replace("{APROBAR_CARGO_LIDER}", $aprobar_cargo_lider	, $PRINCIPAL);	

   			$num_comentarios    =   count($lista);
    		//echo "<br>num_comites $num_comites<br>";
							    if($num_comentarios>0){
							        $potencial_bitacora_titulo="

							<div class='panel panel-info'>	<div class='panel-heading'>Bit&aacute;cora</div>     <div class='panel-body'>
							<div class=''>    <strong>   </strong></div>";
							    }   else   {
							        $potencial_bitacora_titulo="
							<div class='panel panel-info'>	<div class='panel-heading'>Bit&aacute;cora</div>     <div class='panel-body'>
							<div class=''><div class=''><br>    <div class='col-sm-12 txt_title_pot_hohay'><center>[ No hay bit&aacute;cora de cuadrantes ]</center></div>
							    					<br></div></div>
							";
							    }
						$PRINCIPAL = str_replace("{TITULO_BITACORA}", $potencial_bitacora_titulo	, $PRINCIPAL);				
						$PRINCIPAL = str_replace("{MI_BITACORA}", $row_lsita	, $PRINCIPAL);
						
				 $perfil =Potencial_Perfil_Sucesion_Usuarios($rut, $id_empresa);
				 //echo "<br>perfil $perfil";
				 
				 //SIEMPRE SE VerificaFotoPersonal
				 $display_none_edit="";
				 if($perfil=="SUPER USER"){
				 	$display_none_edit="";
				 }
						
						$PRINCIPAL = str_replace("{display_none_edit}", $display_none_edit	, $PRINCIPAL);
						
						
										
		        $PRINCIPAL = ColocaDatosPerfil($PRINCIPAL, $rut_col);
    	    echo $PRINCIPAL;
    }


    else if ($seccion == "home_profile_intro_form") {
        $rut = $_SESSION["user_"];
        $id_empresa = $_SESSION["id_empresa"];
        // echo "$rut $id_empresa";
        $PRINCIPAL = (FuncionesTransversales(file_get_contents("views/templates/" . $id_empresa . "_intro_form.html")));
        $PRINCIPAL = ColocaIndicadoresVarios($PRINCIPAL);
        $PRINCIPAL = BloqueMovimientosInternos($PRINCIPAL, "", $id_empresa);
        $PRINCIPAL = BarraNavegacion($PRINCIPAL, $seccion);
        $PRINCIPAL = ColocarSliderPorNoticia($PRINCIPAL, $id_empresa);
        $PRINCIPAL = ColocaMenuSecundario($PRINCIPAL, $_SESSION["id_empresa"]);
        $arreglo_row_bcicoins = lms_busca_puntos_reportes($rut, $id_empresa);
        $PRINCIPAL = str_replace("{ROW_BCI_COINS_CARTOLA}", $arreglo_row_bcicoins[0], $PRINCIPAL);
        $arreglo_row_bcicursosrealizados = lms_busca_cursos_realizados($rut, $id_empresa);
        $PRINCIPAL = str_replace("{ROW_BCI_MIS_CURSOS_REALIZADOS}", $arreglo_row_bcicursosrealizados[0], $PRINCIPAL);
        $PRINCIPAL = str_replace("{SUMATOTAL_PUNTOS_REPORTES}", $arreglo_row_bcicoins[1], $PRINCIPAL);
        $arreglo_oferta_abierta = lms_busca_posibles_postulaciones($rut, $id_empresa);
        $arreglo_row_avance = lms_integracion_programas($rut, $id_empresa, "");
        $PRINCIPAL = str_replace("{AVANCEMALLATOTAL}", $arreglo_row_avance[1], $PRINCIPAL);
        $PRINCIPAL = str_replace("{ROW_LISTA_PROGRAMAS_OBLIGATORIOS}", $arreglo_row_avance[0], $PRINCIPAL);
        // opcional
        $arreglo_row_avance_opcional = lms_integracion_programas($rut, $id_empresa, "opcional");
        $PRINCIPAL = str_replace("{ROW_LISTA_PROGRAMAS_OPCIONAL}", $arreglo_row_avance_opcional[0], $PRINCIPAL);
        $PRINCIPAL = str_replace("{SECCION_PREGUNTA}", ColocaBloquePreguntaPorObjeto($datos_objeto[0]->id, $rut, 4) , $PRINCIPAL);
        $PRINCIPAL = str_replace("{ROW_PESTANAS_LI_FOCOS}", ColocaPestanasFocosHome($rut, $id_empresa) , $PRINCIPAL);
        $PRINCIPAL = ColocaDatosPerfil($PRINCIPAL, $rut);
        echo $PRINCIPAL;
    }

    else if ($seccion == "home_profile_intro") { //echo "hola";
        $rut = $_SESSION["user_"];
        // check User Profile
        $arreglo_profile = Profile_check_data_biografia($rut, $id_empresa);
        if ($arreglo_profile[0]->id) {
            echo "<script>location.href='?sw=home_landing';</script>";
        }
        else {
            echo "<script>location.href='?sw=home_profile_intro_form_profile';</script>";
        }
    }
    else if ($seccion == "home_profile_intro_form_profile") {
        $rut = $_SESSION["user_"];
        $id_empresa = $_SESSION["id_empresa"];
        $PRINCIPAL = (FuncionesTransversales(file_get_contents("views/home_intro/" . $id_empresa . "_intro_form.html")));
        $PRINCIPAL = BarraNavegacion($PRINCIPAL, $seccion);
        $PRINCIPAL = ColocarSliderPorNoticia($PRINCIPAL, $id_empresa);
        $PRINCIPAL = ColocaMenuSecundario($PRINCIPAL, $_SESSION["id_empresa"]);
        $PRINCIPAL = str_replace("{ROW_BCI_COINS_CARTOLA}", $arreglo_row_bcicoins[0], $PRINCIPAL);
        $PRINCIPAL = str_replace("{ROW_BCI_MIS_CURSOS_REALIZADOS}", $arreglo_row_bcicursosrealizados[0], $PRINCIPAL);
        $PRINCIPAL = str_replace("{SUMATOTAL_PUNTOS_REPORTES}", $arreglo_row_bcicoins[1], $PRINCIPAL);
        $PRINCIPAL = str_replace("{AVANCEMALLATOTAL}", $arreglo_row_avance[1], $PRINCIPAL);
        $PRINCIPAL = str_replace("{ROW_LISTA_PROGRAMAS_OBLIGATORIOS}", $arreglo_row_avance[0], $PRINCIPAL);
        $PRINCIPAL = str_replace("{ROW_LISTA_PROGRAMAS_OPCIONAL}", $arreglo_row_avance_opcional[0], $PRINCIPAL);
        $PRINCIPAL = str_replace("{SECCION_PREGUNTA}", ColocaBloquePreguntaPorObjeto($datos_objeto[0]->id, $rut, 4) , $PRINCIPAL);
        $PRINCIPAL = str_replace("{ROW_PESTANAS_LI_FOCOS}", ColocaPestanasFocosHome($rut, $id_empresa) , $PRINCIPAL);
        $Arreglo_Datos_usuario = TraeDatosBiografiayUsuario($rut, $id_empresa);

    //    print_r($Arreglo_Datos_usuario);

        $nombre_pila = $Arreglo_Datos_usuario[0]->nombre;
        $nombre_completo = $Arreglo_Datos_usuario[0]->nombre_completo;
        $cargo = $Arreglo_Datos_usuario[0]->cargo;
        $unidad_negocio = $Arreglo_Datos_usuario[0]->unidad_negocio;
        $gerencia = $Arreglo_Datos_usuario[0]->gerencia;
        $area = $Arreglo_Datos_usuario[0]->area;
        $division = $Arreglo_Datos_usuario[0]->departamento;
        $telefono = $Arreglo_Datos_usuario[0]->telefono;
        $email = $Arreglo_Datos_usuario[0]->email;
        $biografia = $Arreglo_Datos_usuario[0]->biografia;
        $sueno = $Arreglo_Datos_usuario[0]->sueno;
        $logros = $Arreglo_Datos_usuario[0]->logros;
        $celular = $Arreglo_Datos_usuario[0]->micelular;
        $avatar = $Arreglo_Datos_usuario[0]->miavatar;
        $estudios = $Arreglo_Datos_usuario[0]->estudios;
        $institucion = $Arreglo_Datos_usuario[0]->profesion;

        $fecha_ingreso = $Arreglo_Datos_usuario[0]->fecha_ingreso;
        $recuerdos = $Arreglo_Datos_usuario[0]->recuerdos;
        $fecha_cumpleanos = $Arreglo_Datos_usuario[0]->fecha_cumpleanos;
        $capacitacion = $Arreglo_Datos_usuario[0]->capacitacion;
        $titulo = $Arreglo_Datos_usuario[0]->titulo;







        $foto_avatar = VerificaFotoPersonal($rut);
        // echo "//to_avatar $foto_avatar";
        $PRINCIPAL = str_replace("{NOMBRE_COMPLETO}", utf8_encode($nombre_completo) , $PRINCIPAL);
        $PRINCIPAL = str_replace("{BIOGRAFIA}", utf8_encode($biografia) , $PRINCIPAL);
        $PRINCIPAL = str_replace("{LOGROS}", utf8_encode($logros) , $PRINCIPAL);
        $PRINCIPAL = str_replace("{SUENO}", utf8_encode($sueno) , $PRINCIPAL);
        $PRINCIPAL = str_replace("{CELULAR}", utf8_encode($celular) , $PRINCIPAL);
        $PRINCIPAL = str_replace("{ESTUDIOS}", utf8_encode($estudios) , $PRINCIPAL);
        $PRINCIPAL = str_replace("{INSTITUCION}", utf8_encode($institucion) , $PRINCIPAL);
        $PRINCIPAL = str_replace("{NOMBRE_PILA}", utf8_encode($nombre_pila) , $PRINCIPAL);

        $PRINCIPAL = str_replace("{FECHA_INGRESO}", utf8_encode($fecha_ingreso) , $PRINCIPAL);
        $PRINCIPAL = str_replace("{RECUERDOS}", utf8_encode($recuerdos) , $PRINCIPAL);
        $PRINCIPAL = str_replace("{FECHA_CUMPLEAÑOS}", utf8_encode($fecha_cumpleanos) , $PRINCIPAL);
        $PRINCIPAL = str_replace("{OPTION_CAPACITACION}", "<option value=".utf8_encode($capacitacion)." >".utf8_encode($capacitacion)."" , $PRINCIPAL);
        $PRINCIPAL = str_replace("{TITULO}", utf8_encode($titulo) , $PRINCIPAL);



        $PRINCIPAL = str_replace("{AVATAR}", ($foto_avatar) , $PRINCIPAL);

        $PRINCIPAL = ColocaDatosPerfil($PRINCIPAL, $rut);
        echo $PRINCIPAL;
    }
 
   
    else if ($seccion == "com_mp_stories") {
        $rut = $_SESSION["user_"];
        $id_empresa = $_SESSION["id_empresa"];
        // echo "<br /><br /><br /><br />rut $rut";//print_r($_SESSION);
        $id_malla = Decodear3(mysql_real_escape_string(trim($_GET["im"])));
        if ($_GET["im"] <> '') {
            $_SESSION["id_malla"] = $id_malla;
        }
        if ($_GET["destroysess"] == '1') {
            $_SESSION["template"] = "";
        }
        if ($_GET["sess"] <> '') {
            $id_session = ValidarSesionMP(Decodear3($_GET["sess"]) , $rut, $id_empresa);
        }
        // echo "id session $id_session";
        if ($id_session <> '' and $_SESSION["template"] == '') {
            $_SESSION["template"] = $id_session[0]->id_subcategoria;
            $array_MP_template[0]->template = $_SESSION["template"];
            $array_MP_template[0]->id_subcategoria = $_SESSION["template"];
        }
        elseif ($id_session == '' and $_SESSION["template"] <> '') {
            // $array_MP_template=MP_BuscaTemplate($rut, $id_empresa);
            $array_MP_template[0]->template = $_SESSION["template"];
            $array_MP_template[0]->id_subcategoria = $_SESSION["template"];
        }
        elseif ($id_session <> '' and $_SESSION["template"] <> '') {
            $_SESSION["template"] = $id_session[0]->id_subcategoria;
            $array_MP_template[0]->template = $_SESSION["template"];
            $array_MP_template[0]->id_subcategoria = $_SESSION["template"];
        }
        // echo "<br /><br /><br /><br /> index 14579 sesion template ".$array_MP_template[0]->template;//echo " hola ".$array_MP_template[0]->template;
        if ($array_MP_template[0]->template <> '') {
            $template = $array_MP_template[0]->template . "/";
            $grupointeres = $array_MP_template[0]->template;
        }
        else {
            $template = "";
            $grupointeres = "";
        }
        // echo "<br /><br /><br /><br /> index 16552 template ".$template;
        // print_r($array_MP_template);
        $ord_by = mysql_real_escape_string(trim($_GET["ord_by"]));
        $filt_by = mysql_real_escape_string(trim($_GET["filt_by"]));
        $filt_cat = mysql_real_escape_string(trim($_GET["filt_cat"]));
        $vp = mysql_real_escape_string(trim($_REQUEST["vp"]));
        $swa = mysql_real_escape_string(trim($_GET["swa"]));
        $amb = mysql_real_escape_string(trim($_GET["amb"]));
        $sg = mysql_real_escape_string(trim($_GET["sg"]));
        $tag = mysql_real_escape_string(trim($_GET["tag"]));
        $rut_enviado = mysql_real_escape_string(trim($_GET["rut_enviado"]));
        $tipo_consulta = mysql_real_escape_string(trim($_GET["tipo"]));
        $idcat = mysql_real_escape_string(trim($_GET["idcat"]));
        $idamb = mysql_real_escape_string(trim($_GET["idamb"]));
        $cat = mysql_real_escape_string(trim($_GET["cat"]));
        $filt_cat = $idcat;
        $search = mysql_real_escape_string(trim($_REQUEST["q"]));
        $groupseguir = mysql_real_escape_string(trim($_GET["groupseguir"]));
        $soloexpertos = mysql_real_escape_string(trim($_REQUEST["soloexpertos"]));
        $mp_ans = mysql_real_escape_string(trim($_GET["mp_ans"]));
        $idme = mysql_real_escape_string(trim($_GET["idme"]));
        $idmeid = mysql_real_escape_string(trim($_GET["idmeid"]));
        $Arreglo_Datos_usuario = TraeDatosBiografiayUsuario($rut, $id_empresa);
        $nombre_completo = $Arreglo_Datos_usuario[0]->nombre_completo;
        $cargo = $Arreglo_Datos_usuario[0]->cargo;
        $unidad_negocio = $Arreglo_Datos_usuario[0]->unidad_negocio;
        $gerencia = $Arreglo_Datos_usuario[0]->gerencia;
        $area = $Arreglo_Datos_usuario[0]->area;
        $division = $Arreglo_Datos_usuario[0]->departamento;
        $telefono = $Arreglo_Datos_usuario[0]->telefono;
        $email = $Arreglo_Datos_usuario[0]->email;
        $biografia = $Arreglo_Datos_usuario[0]->biografia;
        $sueno = $Arreglo_Datos_usuario[0]->sueno;
        $logros = $Arreglo_Datos_usuario[0]->logros;
        $celular = $Arreglo_Datos_usuario[0]->micelular;
        $avatar = $Arreglo_Datos_usuario[0]->miavatar;
        $email = $Arreglo_Datos_usuario[0]->email;
        $arr_email = explode("@", $email);
        $nombre_email = $arr_email[0];
        if ($avatar == "") {
            $foto_avatar = "img/foto_avatar_default.jpg";
        }
        if ($avatar <> "") {
            $foto_avatar = "multimedia/" . $avatar;
        }
        if ($mp_ans == 1 and $idme <> '1' and $idmeid <> '') {
            SaveMpMiniEncuesta($rut, $id_empresa, $idme, $idmeid);
        }
        if ($search <> '' and $soloexpertos <> 1) {
            com_mp_guardabusquedas($rut, $id_empresa, $search);
        }
        $vistonotificacionesSeguidor = mysql_real_escape_string(trim($_GET["vistonotificacionesSeguidor"]));
        if ($vistonotificacionesSeguidor == 1) {
            SetvistonotificacionesSeguidor($rut, $id_empresa);
        }
        $vistonotificacionesMeGusta = mysql_real_escape_string(trim($_GET["vistonotificacionesMeGusta"]));
        if ($vistonotificacionesMeGusta == 1) {
            SetvistonotificacionesMeGusta($rut, $id_empresa);
        }
        if ($groupseguir == 1 and $idcat <> '') {
            com_mp_save_groupseguido($rut, $id_empresa, "GRUPOSEGUIDO", $idcat);
            $amb = "";
            $idcat = "";
            $swa = "";
        }
        if ($groupseguir == 2 and $idcat <> '') {
            com_mp_del_groupseguido($rut, $id_empresa, "GRUPOSEGUIDO", $idcat);
            $amb = "";
            $idcat = "";
            $swa = "";
        }
        if ($search <> '') {
            $amb = "mp_resultados";
            $tipo_consulta = $search;
            $swa = "";
        }
        if ($amb == "mp_cat" or $amb == "mp_tipo") {
            $tag = $cat;
            $swa = "";
        }
        if ($soloexpertos == 1) {
            $amb = "expertos";
        }
        if ($rut_enviado <> '') {
            $Rut_Perfil = $rut_enviado;
        }
        else {
            $Rut_Perfil = $rut;
        }
        $LI_RECIENTE = "";
        $LI_POPULARES = "";
        $LI_MISFAVORITAS = "";
        $LI_MISPRACTICAS = "";
        $LI_CATEGORIA = "";
        if ($rut_enviado <> '' and $sg == 1) {
            com_mp_seguir($rut, $rut_enviado, $id_empresa, "seguir");
        }
        if ($rut_enviado <> '' and $sg == 2) {
            com_mp_seguir($rut, $rut_enviado, $id_empresa, "dejardeseguir");
        }
        // echo $rut;
        if ($ord_by == "recent") {
            $LI_RECIENTE = " active";
        }
        if ($ord_by == "popular") {
            $LI_POPULARES = " active";
        }
        if ($filt_by == "misfav") {
            $LI_MISFAVORITAS = " active";
        }
        if ($filt_by == "mispr") {
            $LI_MISPRACTICAS = " active";
        }
        if ($ord_by == "" and $filt_by == "") {
            $LI_RECIENTE = " active";
        }
        // VIO BANNER
        $vv = mysql_real_escape_string(trim($_GET["vv"]));
        $viovideo_visto = 0;
        $viovideoarray = vio_vide_intro($rut, "com_mp_personal", $id_empresa);
        $cuentaVideoArray = $viovideoarray[0]->cuenta;
        if ($cuentaVideoArray > 0) {
            $viovideo_visto = 1;
        }
        // echo "$vv $viovideo_visto";
        if ($vv == 1 and $viovideo_visto == 0) {
            inserta_vio_video($rut, "com_mp_personal", $id_empresa);
        }
        if ($search <> "") {
            $PRINCIPAL = FuncionesTransversales(file_get_contents("views/comunidad_mp/" . $template . $id_empresa . "_com_mp_personal_resultados_busqueda.html"));
        }
        else {
            $PRINCIPAL = FuncionesTransversales(file_get_contents("views/comunidad_mp/" . $template . $id_empresa . "_com_mp_stories.html"));
        }
        $PRINCIPAL = str_replace("{COM_MP_MIS_DATOS_PUNTOS}", file_get_contents("views/comunidad_mp/" . $template . $id_empresa . "_com_mp_mis_datos_puntos.html") , $PRINCIPAL);
        if ($swa == 1) {
            if ($id_empresa == 62) {
                $PRINCIPAL = str_replace("{SWEET_ALERT}", file_get_contents("views/comunidad_mp/" . $template . $id_empresa . "_sweet_alert_post_ingresado.html") , $PRINCIPAL);
            }
            else {
                $PRINCIPAL = str_replace("{SWEET_ALERT}", "", $PRINCIPAL);
            }
        }
        elseif ($swa == 2) {
            $PRINCIPAL = str_replace("{SWEET_ALERT}", file_get_contents("views/comunidad_mp/" . $template . $id_empresa . "_sweet_alert_post_compartido.html") , $PRINCIPAL);
        }
        elseif ($swa == 4) {
            $PRINCIPAL = str_replace("{SWEET_ALERT}", file_get_contents("views/comunidad_mp/" . $template . $id_empresa . "_sweet_alert_banned.html") , $PRINCIPAL);
        }
        else {
            $PRINCIPAL = str_replace("{SWEET_ALERT}", "", $PRINCIPAL);
        }
        $PRINCIPAL = str_replace("{COM_MI_PERFIL_MINI}", file_get_contents("views/comunidad_mp/" . $template . $id_empresa . "_com_mp_perfil_mini.html") , $PRINCIPAL);
        // revisa notificaciones sin leer
        // $PRINCIPAL=TraeNotificacionesInteraccionSinLeerPersonal($PRINCIPAL, $rut, $tipo, $id_empresa);
        $datos_interaccion_personal = TraeBuscaInteraccionPersonal($rut, $id_empresa);
        if ($datos_interaccion_personal[0]->numbcicoins == "") {
            $num_coins = 0;
        }
        else {
            $num_coins = $datos_interaccion_personal[0]->numbcicoins;
        }
        if ($datos_interaccion_personal[0]->numaptitudesvalidadas == "") {
            $num_aptitudes = 0;
        }
        else {
            $num_aptitudes = $datos_interaccion_personal[0]->numaptitudesvalidadas;
        }
        if ($datos_interaccion_personal[0]->numpublicaciones == "") {
            $num_publicaciones = 0;
        }
        else {
            $num_publicaciones = $datos_interaccion_personal[0]->numpublicaciones;
        }
        if ($datos_interaccion_personal[0]->numseguidores == "") {
            $num_seguidores = 0;
        }
        else {
            $num_seguidores = $datos_interaccion_personal[0]->numseguidores;
        }
        $PRINCIPAL = str_replace("{NUM_BCICOINS}", $num_coins, $PRINCIPAL);
        $PRINCIPAL = str_replace("{GRUPO}", $grupo_embajadores[0]->grupo, $PRINCIPAL);
        $PRINCIPAL = str_replace("{NUM_SEGUIDORES}", $datos_interaccion_personal[0]->numseguidores, $PRINCIPAL);
        $PRINCIPAL = str_replace("{NUM_PUBLICACIONES}", $num_publicaciones, $PRINCIPAL);
        $PRINCIPAL = str_replace("{NUM_APTITUDESVALIDADAS}", $num_aptitudes, $PRINCIPAL);
        $datos_usuario = mp_buscaDATOSPERSONAS($rut, $id_empresa);
        // print_r($datos_usuario);
        // $datos_interaccion_personal=TraeBuscaInteraccionPersonal($rut, $id_empresa);
        $start_limit = 0;
        // echo "<br />Tipo Stories";
        $tipo_stories = $_GET["tipo"];
        // echo $tipo_stories;
        $PRINCIPAL = com_mp_stories_lista($PRINCIPAL, $id_empresa, $rut, $ord_by, $filt_by, $filt_cat, $vp, $tag, $rut_enviado, $tipo_consulta, $amb, $start_limit, $array_MP_template[0]->id_subcategoria, $idamb, $template, $tipo_stories);
        $PRINCIPAL = str_replace("{MENU_SECUNDARIO}", "", $PRINCIPAL);
        $PRINCIPAL = BarraNavegacion($PRINCIPAL, $seccion);
        $PRINCIPAL = str_replace("{MENU_SECUNDARIO}", "", $PRINCIPAL);
        $PRINCIPAL = str_replace("{BARRA_NAVEGACION_BUSCADOR}", "", $PRINCIPAL);
        // $PRINCIPAL=ColocaDatosPuntosMedallas($PRINCIPAL, $id_empresa, $rut);
        // $PRINCIPAL=ColocarDatosHomeBeFenCompetencias($PRINCIPAL, $rut, $id_empresa, $im, $nivel, $mod, $template_comp);
        $PRINCIPAL = str_replace("{VALUE_NOMBRE}", "", $PRINCIPAL);
        $PRINCIPAL = str_replace("{CONTENIDO_INGRESADO}", "", $PRINCIPAL);
        $PRINCIPAL = str_replace("{VALUE_OBJETIVO}", "", $PRINCIPAL);
        $PRINCIPAL = str_replace("{RUT_ENVIADO}", $Rut_Perfil, $PRINCIPAL);
        $PRINCIPAL = str_replace("{FOOTER_COMUNIDAD}", file_get_contents("views/comunidad_mp/" . $template . $id_empresa . "_com_mp_footer.html") , $PRINCIPAL);
        $PRINCIPAL = str_replace("{NOMBRE_COMPLETO}", utf8_encode($nombre_completo) , $PRINCIPAL);
        $PRINCIPAL = str_replace("{CARGO}", utf8_encode($cargo) , $PRINCIPAL);
        $PRINCIPAL = str_replace("{UNIDAD_NEGOCIO}", utf8_encode($unidad_negocio) , $PRINCIPAL);
        $PRINCIPAL = str_replace("{GERENCIA}", utf8_encode($gerencia) , $PRINCIPAL);
        $PRINCIPAL = str_replace("{AREA}", utf8_encode($area) , $PRINCIPAL);
        $PRINCIPAL = str_replace("{DIVISION}", utf8_encode($division) , $PRINCIPAL);
        $PRINCIPAL = str_replace("{TELEFONO}", $telefono, $PRINCIPAL);
        $PRINCIPAL = str_replace("{EMAIL}", $email, $PRINCIPAL);
        $PRINCIPAL = str_replace("{BIOGRAFIA}", utf8_encode($biografia) , $PRINCIPAL);
        $PRINCIPAL = str_replace("{SUENO}", utf8_encode($sueno) , $PRINCIPAL);
        $PRINCIPAL = str_replace("{LOGROS}", utf8_encode($logros) , $PRINCIPAL);
        $PRINCIPAL = str_replace("{CELULAR}", $celular, $PRINCIPAL);
        $PRINCIPAL = str_replace("{AVATAR}", $foto_avatar, $PRINCIPAL);
        // $PRINCIPAL = str_replace("{COM_MP_EMBAJADORES_MIS_TAREAS}",$row_emb_tareas, $PRINCIPAL);
        $PRINCIPAL = str_replace("{TITULO_EMBAJADORES}", $row_titulo_row_emb, $PRINCIPAL);
        $PRINCIPAL = str_replace("{TITULO_ASESOR}", $row_titulo_row_emb_asesor, $PRINCIPAL);
        $PRINCIPAL = str_replace("{VER_TODOS_TWITTS}", $ver_mas_twit_mp, $PRINCIPAL);
        $crea_tu_twit_mp = "<a href='?sw=com_mp_stories_createpost' class='btn btn-info btn-sm'><span class='blanco'><i class='fab fa-slack-hash'></i> Crea tu #minutoaminuto aquí</span></a>";
        $PRINCIPAL = str_replace("{CREA_TWIT_AQUI}", $crea_tu_twit_mp, $PRINCIPAL);
        //    $row_carrusel_stories_360_mp=MP_Row_Carrusel_360($id_empresa);
        //    $PRINCIPAL = str_replace("{ROW_CARRUSEL_STORIES_360_MP}",$row_carrusel_stories_360_mp, $PRINCIPAL);
        //    $row_carrusel_stories_twit_mp=MP_Row_Carrusel_twit($id_empresa);
        //    $PRINCIPAL = str_replace("{ROW_CARRUSEL_TWIT_MP}",$row_carrusel_stories_twit_mp, $PRINCIPAL);
        $PRINCIPAL = str_replace("{HEAD_DINAMICO_TEMPLATE}", file_get_contents("views/comunidad_mp/" . $template . $id_empresa . "_head_style.html") , $PRINCIPAL);
        $PRINCIPAL = str_replace("{AUTOPLAY}", "", $PRINCIPAL);
        echo $PRINCIPAL;
    }


    else if ($seccion == "com_mp_fotoGPTW") {
        $rut = $_SESSION["user_"];
        $id_empresa = $_SESSION["id_empresa"];
        $PRINCIPAL = FuncionesTransversales(file_get_contents("views/comunidad_mp/" . $template . $id_empresa . "_com_mp_fotosGPTW.html"));

        //&$PRINCIPAL = com_mp_foto_GPTW_listaTop10($PRINCIPAL, $id_empresa, $rut, $ord_by, $filt_by, $filt_cat, $vp, $tag, $rut_enviado, $tipo_consulta, $amb, $start_limit, $array_MP_template[0]->id_subcategoria, $idamb, $template, $tipo_stories);
        $PRINCIPAL = com_mp_foto_GPTW_lista($PRINCIPAL, $id_empresa, $rut, $ord_by, $filt_by, $filt_cat, $vp, $tag, $rut_enviado, $tipo_consulta, $amb, $start_limit, $array_MP_template[0]->id_subcategoria, $idamb, $template, $tipo_stories);

        $PRINCIPAL = str_replace("{MENU_SECUNDARIO}", "", $PRINCIPAL);
        $PRINCIPAL = BarraNavegacion($PRINCIPAL, $seccion);
        $PRINCIPAL = str_replace("{MENU_SECUNDARIO}", "", $PRINCIPAL);
        $PRINCIPAL = str_replace("{BARRA_NAVEGACION_BUSCADOR}", "", $PRINCIPAL);
        $PRINCIPAL = str_replace("{HEAD_DINAMICO_TEMPLATE}", file_get_contents("views/comunidad_mp/" . $template . $id_empresa . "_head_style.html") , $PRINCIPAL);
        $PRINCIPAL = str_replace("{AUTOPLAY}", "", $PRINCIPAL);
        echo $PRINCIPAL;
    }
    else if ($seccion == "com_mp_foto_grupo") {
        $rut = $_SESSION["user_"];
        $id_empresa = $_SESSION["id_empresa"];

        $grupo = $_GET["grupo"];
        //echo "grupo $grupo";
        $PRINCIPAL = FuncionesTransversales(file_get_contents("views/comunidad_mp/" . $template . $id_empresa . "_com_mp_fotos_grupo.html"));

        //&$PRINCIPAL = com_mp_foto_GPTW_listaTop10($PRINCIPAL, $id_empresa, $rut, $ord_by, $filt_by, $filt_cat, $vp, $tag, $rut_enviado, $tipo_consulta, $amb, $start_limit, $array_MP_template[0]->id_subcategoria, $idamb, $template, $tipo_stories);
        $PRINCIPAL = com_mp_foto_grupo_lista($PRINCIPAL, $id_empresa, $rut, $grupo, $ord_by, $filt_by, $filt_cat, $vp, $tag, $rut_enviado, $tipo_consulta, $amb, $start_limit, $array_MP_template[0]->id_subcategoria, $idamb, $template, $tipo_stories);

        if($grupo=="Tu_Transformacion") {$nombre_grupo="Tu Transformaci&oacute;n";}
        if($grupo=="Dia_Mini_Col")      {$nombre_grupo="D&iacute;a Mini Colaborador";}

        $PRINCIPAL = str_replace("{NOMBRE_GRUPO}", $nombre_grupo, $PRINCIPAL);

        $PRINCIPAL = str_replace("{MENU_SECUNDARIO}", "", $PRINCIPAL);
        $PRINCIPAL = BarraNavegacion($PRINCIPAL, $seccion);
        $PRINCIPAL = str_replace("{MENU_SECUNDARIO}", "", $PRINCIPAL);
        $PRINCIPAL = str_replace("{BARRA_NAVEGACION_BUSCADOR}", "", $PRINCIPAL);
        $PRINCIPAL = str_replace("{HEAD_DINAMICO_TEMPLATE}", file_get_contents("views/comunidad_mp/" . $template . $id_empresa . "_head_style.html") , $PRINCIPAL);
        $PRINCIPAL = str_replace("{AUTOPLAY}", "", $PRINCIPAL);
        echo $PRINCIPAL;
    }


    else if ($seccion == "com_mp_fotoGPTW_top") {
        $rut = $_SESSION["user_"];
        $id_empresa = $_SESSION["id_empresa"];
        $PRINCIPAL = FuncionesTransversales(file_get_contents("views/comunidad_mp/" . $template . $id_empresa . "_com_mp_fotosGPTW_top.html"));

        $PRINCIPAL = com_mp_foto_GPTW_listaTop10($PRINCIPAL, $id_empresa, $rut, $ord_by, $filt_by, $filt_cat, $vp, $tag, $rut_enviado, $tipo_consulta, $amb, $start_limit, $array_MP_template[0]->id_subcategoria, $idamb, $template, $tipo_stories);
        //$PRINCIPAL = com_mp_foto_GPTW_lista($PRINCIPAL, $id_empresa, $rut, $ord_by, $filt_by, $filt_cat, $vp, $tag, $rut_enviado, $tipo_consulta, $amb, $start_limit, $array_MP_template[0]->id_subcategoria, $idamb, $template, $tipo_stories);

        $PRINCIPAL = str_replace("{MENU_SECUNDARIO}", "", $PRINCIPAL);
        $PRINCIPAL = BarraNavegacion($PRINCIPAL, $seccion);
        $PRINCIPAL = str_replace("{MENU_SECUNDARIO}", "", $PRINCIPAL);
        $PRINCIPAL = str_replace("{BARRA_NAVEGACION_BUSCADOR}", "", $PRINCIPAL);
        $PRINCIPAL = str_replace("{HEAD_DINAMICO_TEMPLATE}", file_get_contents("views/comunidad_mp/" . $template . $id_empresa . "_head_style.html") , $PRINCIPAL);
        $PRINCIPAL = str_replace("{AUTOPLAY}", "", $PRINCIPAL);
        echo $PRINCIPAL;
    }

    else if($seccion=="com_mp_stories_createpost"){
        $rut=$_SESSION["user_"];
            //echo "<br><br><br>rut $rut";
            if($rut==""){
            echo '<link href="bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css">
            <br><br><br><div class="alert alert-danger" role="alert">
            <center> <strong>Cuidado</strong>: Perdiste la sesi&oacute;n, vuelve a loguearte!</center>
            </div>';
            sleep(3);
            }



    //print_r($_POST);

    if($_GET["destroysess"]=='1' or  $_SESSION["template"]=='' and $_GET["sess"]==''){
    $_SESSION["template"]=""; $_GET["sess"]="";$array_MP_template[0]->template=""; $id_session="";
    }

    if($_GET["sess"]<>''){
            $id_session=ValidarSesionMP(Decodear3($_GET["sess"]), $rut, $id_empresa);
    }

    //echo " hola ".$array_MP_template[0]->template;

    if($id_session<>'' and $_SESSION["template"]==''){
        $_SESSION["template"]=$id_session[0]->id_subcategoria;
        $array_MP_template[0]->template=$_SESSION["template"];
        $array_MP_template[0]->id_subcategoria=$_SESSION["template"];
                    $array_MP_template=MP_BuscaTemplate($rut, $id_empresa);
                if($array_MP_template[0]->template<>''){$template=$array_MP_template[0]->template."/";} else {$template="";}


    } elseif($id_session=='' and $_SESSION["template"]<>'') {
        //$array_MP_template=MP_BuscaTemplate($rut, $id_empresa);
        $array_MP_template[0]->template=$_SESSION["template"];
        $array_MP_template[0]->id_subcategoria=$_SESSION["template"];
                    $array_MP_template=MP_BuscaTemplate($rut, $id_empresa);
                if($array_MP_template[0]->template<>''){$template=$array_MP_template[0]->template."/";} else {$template="";}

    }
    elseif($id_session<>'' and $_SESSION["template"]<>'') {
        $_SESSION["template"]=$id_session[0]->id_subcategoria;
        $array_MP_template[0]->template=$_SESSION["template"];
        $array_MP_template[0]->id_subcategoria=$_SESSION["template"];
                $array_MP_template=MP_BuscaTemplate($rut, $id_empresa);
                if($array_MP_template[0]->template<>''){$template=$array_MP_template[0]->template."/";} else {$template="";}

    }
    else{
        $_SESSION["template"]="";
        $array_MP_template[0]->template="";
        $array_MP_template[0]->id_subcategoria="";
        $template="";
    }

    //print_r($_POST);
    //echo "<br><br><br><br> index 14579 sesion template ".$array_MP_template[0]->template;
    //echo " hola ".$array_MP_template[0]->template;
        //echo "template $template";

            $id_mp=Decodear3($_GET["i"]);
            $id_empresa=$_SESSION["id_empresa"];
            $detalle_mp=com_mp_full_data($id_empresa, $id_mp);
            $rut_autor=$detalle_mp[0]->rut;
            $ord_by=mysql_real_escape_string(trim($_GET["ord_by"]));
            $filt_by=mysql_real_escape_string(trim($_GET["filt_by"]));
            $filt_cat=mysql_real_escape_string(trim($_GET["filt_cat"]));
            $vp=mysql_real_escape_string(trim($_GET["vp"]));
            $swa=mysql_real_escape_string(trim($_GET["swa"]));
            $amb=mysql_real_escape_string(trim($_GET["amb"]));
            $sg=mysql_real_escape_string(trim($_GET["sg"]));
            $tag=mysql_real_escape_string(trim($_GET["tag"]));
            $rut_enviado=mysql_real_escape_string(trim($_GET["rut_enviado"]));
            $tipo_consulta=mysql_real_escape_string(trim($_GET["tipo"]));
            if($rut_enviado<>''){$Rut_Perfil=$rut_enviado;} else {$Rut_Perfil=$rut;}
            $LI_RECIENTE="";
            $LI_POPULARES="";
            $LI_MISFAVORITAS="";
            $LI_MISPRACTICAS="";
            $LI_CATEGORIA="";
            // echo "$rut_enviado $sg";
            if($rut_enviado<>'' and $sg==1){
            com_mp_seguir($rut,$rut_enviado,$id_empresa);
            }
            //echo $rut;
            if($ord_by=="recent"){$LI_RECIENTE=" active";}
            if($ord_by=="popular"){ $LI_POPULARES=" active";}
            if($filt_by=="misfav"){$LI_MISFAVORITAS=" active";}
            if($filt_by=="mispr"){$LI_MISPRACTICAS=" active";}
            if($ord_by=="" and $filt_by==""){$LI_RECIENTE=" active";}
            $PRINCIPAL=FormularioPost(FuncionesTransversales(file_get_contents("views/comunidad_mp/".$template.$id_empresa."_com_mp_stories_create.html")), $id_mp, $id_empresa);
            $PRINCIPAL = str_replace("{COM_MP_MIS_DATOS_PUNTOS}",file_get_contents("views/comunidad_mp/".$template.$id_empresa."_com_mp_mis_datos_puntos.html"),$PRINCIPAL);
            $PRINCIPAL = str_replace("{NUM_NOTIFICACIONES_SINVER_GLOBO}","",$PRINCIPAL);
            $PRINCIPAL = str_replace("{ID_SUBCATEGORIA}",$array_MP_template[0]->template,$PRINCIPAL);

            //echo "views/comunidad_mp/".$template.$id_empresa."_head_style.html";sleep(5);

            $PRINCIPAL = str_replace("{HEAD_DINAMICO_TEMPLATE}",file_get_contents("views/comunidad_mp/".$template.$id_empresa."_head_style.html"),$PRINCIPAL);
            echo $PRINCIPAL;
            }




    else if($seccion=="com_mp_personal_createpost"){
            $rut=$_SESSION["user_"];
            //echo "<br><br><br>rut $rut";
            if($rut==""){
            echo '<link href="bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css">
            <br><br><br><div class="alert alert-danger" role="alert">
            <center> <strong>Cuidado</strong>: Perdiste la sesi&oacute;n, vuelve a loguearte!</center>
            </div>';
            sleep(3);
            }



    //print_r($_POST);

    if($_GET["destroysess"]=='1' or  $_SESSION["template"]=='' and $_GET["sess"]==''){
    $_SESSION["template"]=""; $_GET["sess"]="";$array_MP_template[0]->template=""; $id_session="";
    }

    if($_GET["sess"]<>''){
            $id_session=ValidarSesionMP(Decodear3($_GET["sess"]), $rut, $id_empresa);
    }

    //echo " hola ".$array_MP_template[0]->template;

    if($id_session<>'' and $_SESSION["template"]==''){
        $_SESSION["template"]=$id_session[0]->id_subcategoria;
        $array_MP_template[0]->template=$_SESSION["template"];
        $array_MP_template[0]->id_subcategoria=$_SESSION["template"];
                    $array_MP_template=MP_BuscaTemplate($rut, $id_empresa);
                if($array_MP_template[0]->template<>''){$template=$array_MP_template[0]->template."/";} else {$template="";}


    } elseif($id_session=='' and $_SESSION["template"]<>'') {
        //$array_MP_template=MP_BuscaTemplate($rut, $id_empresa);
        $array_MP_template[0]->template=$_SESSION["template"];
        $array_MP_template[0]->id_subcategoria=$_SESSION["template"];
                    $array_MP_template=MP_BuscaTemplate($rut, $id_empresa);
                if($array_MP_template[0]->template<>''){$template=$array_MP_template[0]->template."/";} else {$template="";}

    }
    elseif($id_session<>'' and $_SESSION["template"]<>'') {
        $_SESSION["template"]=$id_session[0]->id_subcategoria;
        $array_MP_template[0]->template=$_SESSION["template"];
        $array_MP_template[0]->id_subcategoria=$_SESSION["template"];
                $array_MP_template=MP_BuscaTemplate($rut, $id_empresa);
                if($array_MP_template[0]->template<>''){$template=$array_MP_template[0]->template."/";} else {$template="";}

    }
    else{
        $_SESSION["template"]="";
        $array_MP_template[0]->template="";
        $array_MP_template[0]->id_subcategoria="";
        $template="";
    }

    //print_r($_POST);
    //echo "<br><br><br><br> index 14579 sesion template ".$array_MP_template[0]->template;
    //echo " hola ".$array_MP_template[0]->template;
        //echo "template $template";

            $id_mp=Decodear3($_GET["i"]);
            $id_empresa=$_SESSION["id_empresa"];
            $detalle_mp=com_mp_full_data($id_empresa, $id_mp);
            $rut_autor=$detalle_mp[0]->rut;
            $ord_by=mysql_real_escape_string(trim($_GET["ord_by"]));
            $filt_by=mysql_real_escape_string(trim($_GET["filt_by"]));
            $filt_cat=mysql_real_escape_string(trim($_GET["filt_cat"]));
            $vp=mysql_real_escape_string(trim($_GET["vp"]));
            $swa=mysql_real_escape_string(trim($_GET["swa"]));
            $amb=mysql_real_escape_string(trim($_GET["amb"]));
            $sg=mysql_real_escape_string(trim($_GET["sg"]));
            $tag=mysql_real_escape_string(trim($_GET["tag"]));
            $rut_enviado=mysql_real_escape_string(trim($_GET["rut_enviado"]));
            $tipo_consulta=mysql_real_escape_string(trim($_GET["tipo"]));
            if($rut_enviado<>''){$Rut_Perfil=$rut_enviado;} else {$Rut_Perfil=$rut;}
            $LI_RECIENTE="";
            $LI_POPULARES="";
            $LI_MISFAVORITAS="";
            $LI_MISPRACTICAS="";
            $LI_CATEGORIA="";
            // echo "$rut_enviado $sg";
            if($rut_enviado<>'' and $sg==1){
            com_mp_seguir($rut,$rut_enviado,$id_empresa);
            }
            //echo $rut;
            if($ord_by=="recent"){$LI_RECIENTE=" active";}
            if($ord_by=="popular"){ $LI_POPULARES=" active";}
            if($filt_by=="misfav"){$LI_MISFAVORITAS=" active";}
            if($filt_by=="mispr"){$LI_MISPRACTICAS=" active";}
            if($ord_by=="" and $filt_by==""){$LI_RECIENTE=" active";}
            $PRINCIPAL=FormularioPost(FuncionesTransversales(file_get_contents("views/comunidad_mp/".$template.$id_empresa."_com_mp_personal_createpost.html")), $id_mp, $id_empresa);
            $PRINCIPAL = str_replace("{COM_MP_MIS_DATOS_PUNTOS}",file_get_contents("views/comunidad_mp/".$template.$id_empresa."_com_mp_mis_datos_puntos.html"),$PRINCIPAL);
            $PRINCIPAL = str_replace("{NUM_NOTIFICACIONES_SINVER_GLOBO}","",$PRINCIPAL);
            $PRINCIPAL = str_replace("{ID_SUBCATEGORIA}",$array_MP_template[0]->template,$PRINCIPAL);

            //echo "views/comunidad_mp/".$template.$id_empresa."_head_style.html";sleep(5);

            $PRINCIPAL = str_replace("{HEAD_DINAMICO_TEMPLATE}",file_get_contents("views/comunidad_mp/".$template.$id_empresa."_head_style.html"),$PRINCIPAL);
            echo $PRINCIPAL;
            }

            else if($seccion=="com_mp_personal_anwserquestion"){
            $rut=$_SESSION["user_"];
            //echo "<br><br><br>rut $rut";
            if($rut==""){
            echo
            '<link href="bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css">
            <br><br><br><div class="alert alert-danger" role="alert">
            <center> <strong>Cuidado</strong>: Perdiste la sesi&oacute;n, vuelve a loguearte!</center>
            </div>';
            sleep(3);
            }
                    $array_MP_template=MP_BuscaTemplate($rut, $id_empresa);
            if($array_MP_template[0]->template<>''){$template=$array_MP_template[0]->template."/";} else {$template="";}
            $ord_by=mysql_real_escape_string(trim($_GET["ord_by"]));
            $filt_by=mysql_real_escape_string(trim($_GET["filt_by"]));
            $filt_cat=mysql_real_escape_string(trim($_GET["filt_cat"]));
            $vp=mysql_real_escape_string(trim($_GET["vp"]));
            $swa=mysql_real_escape_string(trim($_GET["swa"]));
            $amb=mysql_real_escape_string(trim($_GET["amb"]));
            $sg=mysql_real_escape_string(trim($_GET["sg"]));
            $tag=mysql_real_escape_string(trim($_GET["tag"]));
            $rut_enviado=mysql_real_escape_string(trim($_GET["rut_enviado"]));
            $tipo_consulta=mysql_real_escape_string(trim($_GET["tipo"]));
            $id_mp=Decodear3(mysql_real_escape_string(trim($_GET["i"])));
            $id_empresa=$_SESSION["id_empresa"];
            if($rut_enviado<>''){$Rut_Perfil=$rut_enviado;} else {$Rut_Perfil=$rut;}
            $LI_RECIENTE="";
            $LI_POPULARES="";
            $LI_MISFAVORITAS="";
            $LI_MISPRACTICAS="";
            $LI_CATEGORIA="";
            // echo "$rut_enviado $sg";
            if($rut_enviado<>'' and $sg==1){
            com_mp_seguir($rut,$rut_enviado,$id_empresa);
            }
            //echo $rut;
            if($ord_by=="recent"){$LI_RECIENTE=" active";}
            if($ord_by=="popular"){ $LI_POPULARES=" active";}
            if($filt_by=="misfav"){$LI_MISFAVORITAS=" active";}
            if($filt_by=="mispr"){$LI_MISPRACTICAS=" active";}
            if($ord_by=="" and $filt_by==""){$LI_RECIENTE=" active";}



            $PRINCIPAL=FormularioPost(FuncionesTransversales(file_get_contents("views/comunidad_mp/".$template.$id_empresa."_com_mp_personal_createanswer.html")), $id_mp, $id_empresa);
            $PRINCIPAL = str_replace("{COM_MP_MIS_DATOS_PUNTOS}",file_get_contents("views/comunidad_mp/".$template.$id_empresa."_com_mp_mis_datos_puntos.html"),$PRINCIPAL);
            $PRINCIPAL = str_replace("{NUM_NOTIFICACIONES_SINVER_GLOBO}","",$PRINCIPAL);
            $PRINCIPAL = str_replace("{HEAD_DINAMICO_TEMPLATE}",file_get_contents("views/comunidad_mp/".$template.$id_empresa."_head_style.html"),$PRINCIPAL);

            echo $PRINCIPAL;
            }


            else if($seccion=="com_mp_personal_createquestion"){
            $rut=$_SESSION["user_"];
            //echo "<br><br><br>rut $rut";
            if($rut==""){
            echo
            '<link href="bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css">
            <br><br><br><div class="alert alert-danger" role="alert">
            <center> <strong>Cuidado</strong>: Perdiste la sesi&oacute;n, vuelve a loguearte!</center>
            </div>';
            sleep(3);
            }
                    $array_MP_template=MP_BuscaTemplate($rut, $id_empresa);
            if($array_MP_template[0]->template<>''){$template=$array_MP_template[0]->template."/";} else {$template="";}
            $ord_by=$_GET["ord_by"];
            $filt_by=$_GET["filt_by"];
            $filt_cat=$_GET["filt_cat"];
            $mp_title_question=$_GET["mp_title_question"];
            $vp=$_GET["vp"];
            $swa=$_GET["swa"];
            $amb=$_GET["amb"];
            $sg=$_GET["sg"];
            $tag=$_GET["tag"];
            $rut_enviado=$_GET["rut_enviado"];
            $tipo_consulta=$_GET["tipo"];
            $id_mp=Decodear3($_GET["i"]);
            $id_empresa=$_SESSION["id_empresa"];
            if($rut_enviado<>''){$Rut_Perfil=$rut_enviado;} else {$Rut_Perfil=$rut;}
            $LI_RECIENTE="";
            $LI_POPULARES="";
            $LI_MISFAVORITAS="";
            $LI_MISPRACTICAS="";
            $LI_CATEGORIA="";
            // echo "$rut_enviado $sg";
            if($rut_enviado<>'' and $sg==1){
            com_mp_seguir($rut,$rut_enviado,$id_empresa);
            }
            //echo $rut;
            $array_MP_template=MP_BuscaTemplate($rut, $id_empresa);
            if($array_MP_template[0]->template<>''){$template=$array_MP_template[0]->template."/";} else {$template="";}
            if($ord_by=="recent"){$LI_RECIENTE=" active";}
            if($ord_by=="popular"){ $LI_POPULARES=" active";}
            if($filt_by=="misfav"){$LI_MISFAVORITAS=" active";}
            if($filt_by=="mispr"){$LI_MISPRACTICAS=" active";}
            if($ord_by=="" and $filt_by==""){$LI_RECIENTE=" active";}
            $PRINCIPAL=FormularioPostPregunta(FuncionesTransversales(file_get_contents("views/comunidad_mp/".$template.$id_empresa."_com_mp_personal_createquestion.html")), $id_mp, $id_empresa);
            $PRINCIPAL = str_replace("{PREGUNTA}",$mp_title_question,$PRINCIPAL);
            $PRINCIPAL = str_replace("{NUM_NOTIFICACIONES_SINVER_GLOBO}","",$PRINCIPAL);
            $PRINCIPAL = str_replace("{HEAD_DINAMICO_TEMPLATE}",file_get_contents("views/comunidad_mp/".$template.$id_empresa."_head_style.html"),$PRINCIPAL);

            echo $PRINCIPAL;
            }
            else if($seccion=="InsertaReplyPorReply"){
            //echo date('Y-m-d H:i:s');
            //print_R($_POST);
            $comentario=mysql_real_escape_string(trim(utf8_decode($_POST["comentario"])));
            $id_reply=$_POST["id"];
            $id_mp=$_POST["id_mp"];
            $rut=$_SESSION["user_"];
            $comentario_clean=0; $guarda=0;
            $Array_Banned=MP_SearchBannedWords($id_empresa);
            if (!mp_search_banned_words($comentario,$Array_Banned)) {
            $comentario_clean=1;}else{
            echo '<link href="bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css">
            <br><br><br><div class="alert alert-danger" role="alert">
            <center> <strong>Cuidado</strong>: el comentario contiene Palabras Prohibidas</center>
            </div>';
            sleep(3);
            }
            if($comentario_clean==1){
            $guarda==1;
            } else {
            echo "<script>window.history.back();</script>";
            exit();
            }
            // echo "$rut<>'' and $comentario<>'' and $idmp<>'' and $guarda==1, comentario_clean $comentario_clean";
            if($rut<>'' and $comentario<>'' and $id_mp<>'' and $comentario_clean==1){
            COMUNIDAD_ReplyPorReply_inserta($rut, $comentario, $id_reply, $id_mp);
            $ultimo_id=InsertaEntablaInteraccion($id_empresa, $rut, $rut, $comentario, "1",  "COMENTARIO", $id_mp);
            GAMIFICACIONInsertaPuntosPorObjeto($rut, $ultimo_id[0]->valor, "comunidadmpa", $id_empresa, "1", "0", "", "", "", "comunidadmpa");
            }
            $bloque_reply_reply=MuestraReplyPorReply($id_mp, $id_reply);
            echo $bloque_reply_reply;
            //echo "aca";
            }

    else if($seccion=="com_mp_full_stories"){
            $id_empresa=$_SESSION["id_empresa"];
            $rut=$_SESSION["user_"];
            $id_mp=$_GET["id_mp"];

            $alert=$_GET["alert"];
            if($alert==1){

            //echo "alert $alert $id_mp, $id_empresa";

            MP_Stories_Despublicar($id_mp, $id_empresa);


            echo "<script>
                        location.href='?sw=com_mp_personal';
                        </script>";
                        exit;

            }

            $PRINCIPAL=FuncionesTransversales(file_get_contents("views/comunidad_mp/".$template.$id_empresa."_row_stories_full.html"));

            $PRINCIPAL=com_mp_full_stories($PRINCIPAL, $id_empresa, $id_mp);
            $comentarios=MuestraComentariosPorPost($id_mp, 200, 1);

            $PRINCIPAL = str_replace("{FOOTER_COMUNIDAD}",file_get_contents("views/comunidad_mp/".$id_empresa."_com_mp_footer.html"),$PRINCIPAL);
            $PRINCIPAL = str_replace("{BLOQUE_COMENTARIOS_POR_POST}",$comentarios, $PRINCIPAL);

            $PRINCIPAL = str_replace("{HEAD_DINAMICO_TEMPLATE}",file_get_contents("views/comunidad_mp/".$template.$id_empresa."_head_style.html"),$PRINCIPAL);
            $PRINCIPAL = str_replace("{ID_MP}",$id_mp,$PRINCIPAL);









            echo $PRINCIPAL;

    }

    else if($seccion=="com_mp_full_fotoGPTW"){
            $id_empresa=$_SESSION["id_empresa"];
            $rut=$_SESSION["user_"];
            $id_mp=$_GET["id_mp"];

            $alert=$_GET["alert"];
            if($alert==1){

            //echo "alert $alert $id_mp, $id_empresa";

            MP_GPTW_Despublicar($id_mp, $id_empresa);


            echo "<script>
                        location.href='?sw=com_mp_personal';
                        </script>";
                        exit;

            }

            $PRINCIPAL=FuncionesTransversales(file_get_contents("views/comunidad_mp/".$template.$id_empresa."_row_full_GPTW.html"));

            $PRINCIPAL=com_mp_full_GPTW($PRINCIPAL, $id_empresa, $id_mp);
            $comentarios=MuestraComentariosPorPost($id_mp, 200, 1);

            $PRINCIPAL = str_replace("{FOOTER_COMUNIDAD}",file_get_contents("views/comunidad_mp/".$id_empresa."_com_mp_footer.html"),$PRINCIPAL);
            $PRINCIPAL = str_replace("{BLOQUE_COMENTARIOS_POR_POST}",$comentarios, $PRINCIPAL);

            $PRINCIPAL = str_replace("{HEAD_DINAMICO_TEMPLATE}",file_get_contents("views/comunidad_mp/".$template.$id_empresa."_head_style.html"),$PRINCIPAL);
            $PRINCIPAL = str_replace("{ID_MP}",$id_mp,$PRINCIPAL);


            $PRINCIPAL = str_replace("{HUINCHA_SOLO_MEGUSTA}", ColocaMegustaGPW($id_mp, $id_empresa, $rut) , $PRINCIPAL);






            echo $PRINCIPAL;

    }

    else if($seccion=="com_mp_full"){
            $id_empresa=$_SESSION["id_empresa"];
            $rut=$_SESSION["user_"];
            //echo $_SESSION["template"];

    if($_GET["destroysess"]=='1' or  ($_SESSION["template"]=='' and $_GET["sess"]=='')){
    $_SESSION["template"]=""; $_GET["sess"]="";$array_MP_template[0]->template=""; $id_session="";
    }

    if($_GET["sess"]<>''){
            $id_session=ValidarSesionMP(Decodear3($_GET["sess"]), $rut, $id_empresa);
    }

    //echo " hola ".$array_MP_template[0]->template;

    if($id_session<>'' and $_SESSION["template"]==''){
        $_SESSION["template"]=$id_session[0]->id_subcategoria;
        $array_MP_template[0]->template=$_SESSION["template"];
        $array_MP_template[0]->id_subcategoria=$_SESSION["template"];
                    $array_MP_template=MP_BuscaTemplate($rut, $id_empresa);
                if($array_MP_template[0]->template<>''){$template=$array_MP_template[0]->template."/";} else {$template="";}


    } elseif($id_session=='' and $_SESSION["template"]<>'') {
        //$array_MP_template=MP_BuscaTemplate($rut, $id_empresa);
        $array_MP_template[0]->template=$_SESSION["template"];
        $array_MP_template[0]->id_subcategoria=$_SESSION["template"];
                    $array_MP_template=MP_BuscaTemplate($rut, $id_empresa);
                if($array_MP_template[0]->template<>''){$template=$array_MP_template[0]->template."/";} else {$template="";}

    }
    elseif($id_session<>'' and $_SESSION["template"]<>'') {
        $_SESSION["template"]=$id_session[0]->id_subcategoria;
        $array_MP_template[0]->template=$_SESSION["template"];
        $array_MP_template[0]->id_subcategoria=$_SESSION["template"];
                $array_MP_template=MP_BuscaTemplate($rut, $id_empresa);
                if($array_MP_template[0]->template<>''){$template=$array_MP_template[0]->template."/";} else {$template="";}

    }
    else{
        $_SESSION["template"]="";
        $array_MP_template[0]->template="";
        $array_MP_template[0]->id_subcategoria="";
        $template="";
    }

            $ord_by=$_GET["ord_by"];
            $filt_by=$_GET["filt_by"];
            $filt_cat=$_GET["filt_cat"];
            $vp=$_GET["vp"];
            $swa=$_GET["swa"];
            $amb=$_GET["amb"];
            $id_mp=$_GET["id_mp"];
            $alert=$_GET["alert"];
            $detalle_mp=com_mp_full_data($id_empresa, $id_mp);



            if(!$detalle_mp){
            echo "    <script>         location.href='?sw=com_mp_personal';     </script>";
            exit;
            }
    $alerta_dos="";
    if($alert==2){

        $alerta_dos=" <div class='alert alert-danger' role='alert'>
                                    <br><center><strong>IMPORTANTE</strong><br><br>

                                    Al presionar el bot&oacute;n 'Despublicar por Contenido Impropio' se despublicará inmeditamente la Publicaci&oacute;n,
                                    y se enviará un email al Administrador de Compartebci.
                                    <br></center><br>

                                    <center><a href='?sw=com_mp_full&id_mp=".$id_mp."&alert=1' class='btn btn-danger'><span class='blanco'>Despublicar por Contenido Impropio</a></center><br>
                                </div>";

    }

    if($alert==1){
            //despublica mp
            MP_DespublicarAlert($rut, $id_mp, $id_empresa);

     $arreglo_MP=DatosMP($id_empresa, $id_mp);
     $arreglo_Usuario=mp_DATOSPERSONAS($rut, $id_empresa);
     $arreglo_Destinatario=mp_DATOSPERSONAS($arreglo_MP[0]->rut, $id_empresa);


    if($id_empresa=='62'){

    $subject="Se ha despublicado la: ".utf8_encode($arreglo_MP[0]->nombre);
    $subtitulo1=utf8_encode($arreglo_Usuario[0]->nombre_completo)." ha despublicado una publicaci&oacute;n!";
    $texto1="Se ha despublicado la Publicacion:  ";
    $texto2=utf8_encode($arreglo_MP[0]->nombre);
    $texto3="";
    $url=$url_base."/front/?sw=login_ext&ambiente=com_mp_full&id=".$arreglo_MP[0]->id_mp."&id_mp=".$arreglo_MP[0]->id_mp;

    $tipomensaje="Notificacion_Despublicacion_Comunidad";
    $rut=$arreglo_MP[0]->rut;
    $key=$arreglo_MP[0]->id_mp;
    $to="carolina.majluf@bci.cl";
    $nombreto="carolina.majluf@bci.cl";
    SendGrid_Email($to, $nombreto, $from, $nombrefrom, $tipo, $subject, $titulo1,$subtitulo1,$texto1,$url,$texto_url, $texto2, $texto3, $texto4, $logo, $id_empresa, $url,$tipomensaje, $rut, $key);


    $subject="Se ha despublicado la: ".utf8_encode($arreglo_MP[0]->nombre);
    $subtitulo1=utf8_encode($arreglo_Usuario[0]->nombre_completo)." ha despublicado una publicaci&oacute;n!";
    $texto1="Se ha despublicado la Publicaci&oacute;n:  ";
    $texto2=utf8_encode($arreglo_MP[0]->nombre);
    $texto3="";
    $url=$url_base."/front/?sw=login_ext&ambiente=com_mp_full&id=".$arreglo_MP[0]->id_mp."&id_mp=".$arreglo_MP[0]->id_mp;

    $tipomensaje="Notificacion_Despublicacion_Comunidad";
    $rut=$arreglo_MP[0]->rut;
    $key=$arreglo_MP[0]->id_mp;
    $to="paulina.cruz@bci.cl";
    $nombreto="carolina.majluf@bci.cl";
    SendGrid_Email($to, $nombreto, $from, $nombrefrom, $tipo, $subject, $titulo1,$subtitulo1,$texto1,$url,$texto_url, $texto2, $texto3, $texto4, $logo, $id_empresa, $url,$tipomensaje, $rut, $key);


    }
            //Interaccion guarda
            echo "    <script>         location.href='?sw=com_mp_personal&sa=dpbb';     </script>";
            exit;
    }


            if($id_mp==''){
            echo "    <script>         location.href='?sw=com_mp_personal';     </script>";
            exit;
            }

            $tag=$_GET["tag"];
            $rut_enviado=$_GET["rut_enviado"];
            $tipo_consulta=$_GET["tipo"];
            $search=$_POST["q"];
            $vistonotificacionesCompartido=$_GET["vistonotificacionesCompartido"];
            if($vistonotificacionesCompartido==1){
            SetvistonotificacionesCompartido($rut,$id_empresa);
            }
            $ultimo_id=InsertaEntablaInteraccion($id_empresa, $rut, $rut, "", "0",  "VISITA", $id_mp);
            if($rut_enviado<>''){$Rut_Perfil=$rut_enviado;} else {$Rut_Perfil=$rut;}
            $LI_RECIENTE="";
            $LI_POPULARES="";
            $LI_MISFAVORITAS="";
            $LI_MISPRACTICAS="";
            $LI_CATEGORIA="";
            if($search<>''){
            $amb="mp_resultados";
            $tipo_consulta=    $search;
            }
            //echo $rut;
            //if($ord_by=="recent"){$LI_RECIENTE=" active";}
            //if($ord_by=="popular"){ $LI_POPULARES=" active";}
            //if($filt_by=="misfav"){$LI_MISFAVORITAS=" active";}
            //if($filt_by=="mispr"){$LI_MISPRACTICAS=" active";}
            //if($ord_by=="" and $filt_by==""){$LI_RECIENTE=" active";}
            $PRINCIPAL=FuncionesTransversales(file_get_contents("views/comunidad_mp/".$template.$id_empresa."_com_mp_full.html"));
            //$PRINCIPAL = str_replace("{COM_MP_MIS_DATOS_PUNTOS}",file_get_contents("views/comunidad_mp/".$id_empresa."_com_mp_mis_datos_puntos.html"),$PRINCIPAL);
            //if($swa==1){
            ////$PRINCIPAL = str_replace("{SWEET_ALERT}",file_get_contents("views/comunidad_mp/".$template.$id_empresa."_sweet_alert_post_ingresado.html"),$PRINCIPAL);
            //}else{
            //$PRINCIPAL = str_replace("{SWEET_ALERT}","",$PRINCIPAL);
            //}



            $PRINCIPAL=com_mp_full($PRINCIPAL, $id_empresa, $id_mp);
            //$PRINCIPAL=ColocaDatosPuntosMedallas($PRINCIPAL, $id_empresa, $rut);
            //echo VerificaFotoPersonal($rut);


            $PRINCIPAL = str_replace("{ROW_FOTO_TIMELINE_PERSONAL}",VerificaFotoPersonal($Rut_Perfil),$PRINCIPAL);

            $PRINCIPAL = str_replace("{ALERTA_DESPUBLICAR_2}",$alerta_dos, $PRINCIPAL);


            $PRINCIPAL = str_replace("{LI_RECIENTE}",$LI_RECIENTE, $PRINCIPAL);
            $PRINCIPAL = str_replace("{LI_POPULARES}",$LI_POPULARES, $PRINCIPAL);
            $PRINCIPAL = str_replace("{LI_MISPRACTICAS}",$LI_MISPRACTICAS, $PRINCIPAL);
            $PRINCIPAL = str_replace("{LI_MISFAVORITAS}",$LI_MISFAVORITAS, $PRINCIPAL);
            $PRINCIPAL = str_replace("{LI_CATEGORIA}",$LI_CATEGORIA, $PRINCIPAL);
            $PRINCIPAL=BarraNavegacion($PRINCIPAL, $seccion);
            $PRINCIPAL = str_replace("{MENU_SECUNDARIO}","", $PRINCIPAL);
            $PRINCIPAL = str_replace("{BARRA_NAVEGACION_BUSCADOR}","", $PRINCIPAL);
            $PRINCIPAL = str_replace("{VALUE_NOMBRE}","", $PRINCIPAL);
            $PRINCIPAL = str_replace("{CONTENIDO_INGRESADO}","", $PRINCIPAL);
            $PRINCIPAL = str_replace("{VALUE_OBJETIVO}","", $PRINCIPAL);
            //$PRINCIPAL=MP_estadisticas_personales($PRINCIPAL, $rut, $id_empresa);
            $PRINCIPAL=ColocaDatosPerfil($PRINCIPAL, $rut);
            //$PRINCIPAL=ColocaMPEstadisticas($PRINCIPAL, $id_empresa);
            $comentarios=MuestraComentariosPorPost($id_mp, 200, 1);

            //$milista_aquienessigue=MPListaUsuariosQueSigo($rut,$id_empresa);
            //foreach($milista_aquienessigue as $quesigo){
            //print_r($quesigo);
            //$quesigo->email;
            //$cuerpoemail = explode("@", $quesigo->email);
            //$body=$cuerpoemail[0];
            //$milistaseguidor.="{username: '".$body."', fullname: '".$quesigo->nombre_completo."'},";
            //print_r($milistaseguidor);
            //echo "<br>";

            //echo "<br>";
            //print_r($milistaseguidor);


            //$PRINCIPAL = str_replace("{COLABORADORES QUE SIGO}",$milistaseguidor, $PRINCIPAL);
            $PRINCIPAL = str_replace("{FOOTER_COMUNIDAD}",file_get_contents("views/comunidad_mp/".$id_empresa."_com_mp_footer.html"),$PRINCIPAL);
            $PRINCIPAL = str_replace("{BLOQUE_COMENTARIOS_POR_POST}",$comentarios, $PRINCIPAL);

            $PRINCIPAL = str_replace("{HEAD_DINAMICO_TEMPLATE}",file_get_contents("views/comunidad_mp/".$template.$id_empresa."_head_style.html"),$PRINCIPAL);
            $PRINCIPAL = str_replace("{ID_MP}",$id_mp,$PRINCIPAL);
            $PRINCIPAL = str_replace("{AUTOPLAY}","autoplay",$PRINCIPAL);


            echo $PRINCIPAL;
            }
            else if($seccion=="com_mp_concurso"){
            $rut=$_SESSION["user_"];
            $ord_by=$_GET["ord_by"];
            $filt_by=$_GET["filt_by"];
            $filt_cat=$_GET["filt_cat"];
            $vp=$_GET["vp"];
            $swa=$_GET["swa"];
            $amb=$_GET["amb"];
            $id_mp="bci_concurso";
            $tag=$_GET["tag"];
            $rut_enviado=$_GET["rut_enviado"];
            $tipo_consulta=$_GET["tipo"];
            if($rut_enviado<>''){$Rut_Perfil=$rut_enviado;} else {$Rut_Perfil=$rut;}
                    $array_MP_template=MP_BuscaTemplate($rut, $id_empresa);
            if($array_MP_template[0]->template<>''){$template=$array_MP_template[0]->template."/";} else {$template="";}
            $LI_RECIENTE="";
            $LI_POPULARES="";
            $LI_MISFAVORITAS="";
            $LI_MISPRACTICAS="";
            $LI_CATEGORIA="";
            if($ord_by=="recent"){$LI_RECIENTE=" active";}
            if($ord_by=="popular"){ $LI_POPULARES=" active";}
            if($filt_by=="misfav"){$LI_MISFAVORITAS=" active";}
            if($filt_by=="mispr"){$LI_MISPRACTICAS=" active";}
            if($ord_by=="" and $filt_by==""){$LI_RECIENTE=" active";}
            $PRINCIPAL=FuncionesTransversales(file_get_contents("views/comunidad_mp/".$template.$id_empresa."_com_mp_concurso.html"));
            $PRINCIPAL = str_replace("{COM_MP_MIS_DATOS_PUNTOS}",file_get_contents("views/comunidad_mp/".$id_empresa."_com_mp_mis_datos_puntos.html"),$PRINCIPAL);
            if($swa==1){
            $PRINCIPAL = str_replace("{SWEET_ALERT}",file_get_contents("views/comunidad_mp/".$template.$id_empresa."_sweet_alert_post_ingresado.html"),$PRINCIPAL);
            }else{
            $PRINCIPAL = str_replace("{SWEET_ALERT}","",$PRINCIPAL);
            }
            $PRINCIPAL=com_mp_full($PRINCIPAL, $id_empresa, $id_mp);
            $PRINCIPAL=ColocaDatosPuntosMedallas($PRINCIPAL, $id_empresa, $rut);
            //echo VerificaFotoPersonal($rut);
            $PRINCIPAL = str_replace("{ROW_FOTO_TIMELINE_PERSONAL}",VerificaFotoPersonal($Rut_Perfil),$PRINCIPAL);
            $PRINCIPAL = str_replace("{LI_RECIENTE}",$LI_RECIENTE, $PRINCIPAL);
            $PRINCIPAL = str_replace("{LI_POPULARES}",$LI_POPULARES, $PRINCIPAL);
            $PRINCIPAL = str_replace("{LI_MISPRACTICAS}",$LI_MISPRACTICAS, $PRINCIPAL);
            $PRINCIPAL = str_replace("{LI_MISFAVORITAS}",$LI_MISFAVORITAS, $PRINCIPAL);
            $PRINCIPAL = str_replace("{LI_CATEGORIA}",$LI_CATEGORIA, $PRINCIPAL);
            $PRINCIPAL=BarraNavegacion($PRINCIPAL, $seccion);
            $PRINCIPAL = str_replace("{MENU_SECUNDARIO}","", $PRINCIPAL);
            $PRINCIPAL = str_replace("{BARRA_NAVEGACION_BUSCADOR}","", $PRINCIPAL);
            $PRINCIPAL = str_replace("{VALUE_NOMBRE}","", $PRINCIPAL);
            $PRINCIPAL = str_replace("{CONTENIDO_INGRESADO}","", $PRINCIPAL);
            $PRINCIPAL = str_replace("{VALUE_OBJETIVO}","", $PRINCIPAL);
            $PRINCIPAL=MP_estadisticas_personales($PRINCIPAL, $rut, $id_empresa);
            $PRINCIPAL=ColocaDatosPerfil($PRINCIPAL, $rut);
            $PRINCIPAL=ColocaMPEstadisticas($PRINCIPAL, $id_empresa);
            $comentarios=MuestraComentariosPorPost($id_mp, 10, 1);
            $PRINCIPAL = str_replace("{BLOQUE_COMENTARIOS_POR_POST}",$comentarios, $PRINCIPAL);
            echo $PRINCIPAL;
            }

      

        else if($seccion=="biblioteca"){
        $id_empresa=$_SESSION["id_empresa"];

        if($id_empresa=="52"){
            $PRINCIPAL=ListadoNoticias(FuncionesTransversales(file_get_contents("views/biblioteca/52_entorno.html")));
        }
        if($id_empresa=="83"){
            $PRINCIPAL=ListadoNoticias(FuncionesTransversales(file_get_contents("views/biblioteca/83_entorno.html")));
        }
         else {
        $PRINCIPAL=ListadoNoticias(FuncionesTransversales(file_get_contents("views/biblioteca/entorno.html")));
        }

        //$PRINCIPAL=BarraNavegacion($PRINCIPAL, $seccion);
        $PRINCIPAL=ColocaMenuSecundario($PRINCIPAL, $_SESSION["id_empresa"]);
        if($_GET["p"]=="principal"){

            $PRINCIPAL = str_replace("{ENTORNO_BIBLIOTECA}", biblioteca_inicio(FuncionesTransversales(file_get_contents("views/biblioteca/" . $id_empresa . "_principal.html")), $id_empresa), $PRINCIPAL);

        $PRINCIPAL = BuscaCategoriasEmpresa($PRINCIPAL, $id_empresa, $comunidad);
        $PRINCIPAL = ColocaBloquePrincipalCategorias($PRINCIPAL, $id_empresa);
        $PRINCIPAL = ColocaBloqueUltimosBiblio($PRINCIPAL, $id_empresa);
        $PRINCIPAL = ColocaBloqueUltimosDescargadosBiblio($PRINCIPAL, $id_empresa);
        }

        if($_GET["p"]=="full"){
        //--     PRINCIPAL = str_replace("{ENTORNO_BIBLIOTECA}", biblioteca_inicio_full(FuncionesTransversales(file_get_contents("views/biblioteca/" . $id_empresa . "_principal.html")), $id_empresa), $PRINCIPAL);
                   $PRINCIPAL = str_replace("{ENTORNO_BIBLIOTECA}", biblioteca_inicio_full(FuncionesTransversales(file_get_contents("views/biblioteca/" . $id_empresa . "_principal.html")), $id_empresa), $PRINCIPAL);
                $PRINCIPAL = BuscaCategoriasFullEmpresa($PRINCIPAL, $id_empresa, $comunidad);

        }
        //$PRINCIPAL = ColocaBloquePrincipalCategorias($PRINCIPAL, $id_empresa);
        //$PRINCIPAL = ColocaBloqueUltimosBiblio($PRINCIPAL, $id_empresa);
        //$PRINCIPAL = ColocaBloqueUltimosDescargadosBiblio($PRINCIPAL, $id_empresa);


        $PRINCIPAL = str_replace("{SWEET_ALERT}","",$PRINCIPAL);
        if ($_GET["p"]=="archivos"){
        $PRINCIPAL = str_replace("{ENTORNO_BIBLIOTECA}",biblioteca_archivos(FuncionesTransversales(file_get_contents("views/biblioteca/".$id_empresa."_lista_archivos.html")),$_GET["id"],$_GET["nsubcat"],$_GET["ncat"],$_GET["idcat"], $id_empresa),$PRINCIPAL);
        }
        if ($_GET["p"]=="subcategoria"){
        $datos_categoria_padre=TraeCategoria($_GET["id"]);
        $cuentasub=cuentaSubcategoria($_GET["id"]);
        if($datos_categoria_padre[0]->visible==1 OR $cuentasub==1){
        $SUBcategorias=TraeSubcategorias($_GET["id"]);
        echo "
        <script>
        location.href='?sw=biblioteca&p=archivos&id=".$SUBcategorias[0]->id."&nsubcat=".$datos_categoria_padre[0]->categoria."&ncat=".$datos_categoria_padre[0]->categoria."&idcat=".$_GET["id"]."';
        </script>";                exit;
        }
        //$PRINCIPAL=biblioteca_subcategoria(FuncionesTransversales(file_get_contents("views/biblioteca/index.html")),$_GET["id"],$_GET["ncat"]);
        $PRINCIPAL = str_replace("{ENTORNO_BIBLIOTECA}",biblioteca_subcategoria(FuncionesTransversales(file_get_contents("views/biblioteca/index.html")),$_GET["id"],$_GET["ncat"], $id_empresa),$PRINCIPAL);
        }
        if ($_GET["p"]=="buscar_archivos"){
        //$PRINCIPAL=biblioteca_archivos_busqueda(FuncionesTransversales(file_get_contents("views/biblioteca/resultados.html")),$_GET["id"]);
        $PRINCIPAL = str_replace("{ENTORNO_BIBLIOTECA}",biblioteca_archivos_busqueda(FuncionesTransversales(file_get_contents("views/biblioteca/resultados.html")),$_GET["id"], $id_empresa),$PRINCIPAL);
        }
        $PRINCIPAL=BarraNavegacion($PRINCIPAL, $seccion);
        echo $PRINCIPAL;
        }
        //Se migro al admin
        else if($seccion=="admin_galeriaBK"){
        if ($_GET["n"]=="1"){$PRINCIPAL=lista_carpetas(FuncionesTransversales(file_get_contents("views/admin/galeria/admin.html")));    }
        if ($_GET["n"]=="2"){$PRINCIPAL=lista_subcarpetas(FuncionesTransversales(file_get_contents("views/admin/galeria/admin.html")),$_GET["id"],$_GET["cn"]);    }
        if ($_GET["n"]=="3"){$PRINCIPAL=lista_galeria_archivos(FuncionesTransversales(file_get_contents("views/admin/galeria/archivos.html")),$_GET["id"],$_GET["cn"],$_GET["id_sub"],$_GET["nsub"]);    }
        if ($_GET["n"]=="fc"){$PRINCIPAL=nueva_carpeta(file_get_contents("views/admin/galeria/nueva_categoria.html"),$_GET["id_cat"]);    }
        if ($_GET["n"]=="fs"){$PRINCIPAL=nuevo_album(file_get_contents("views/admin/galeria/nueva_sub_categoria.html"),$_GET["id_cat"],$_GET["cn"],$_GET["id_subcat"]);    }
        if ($_GET["n"]=="fa"){$PRINCIPAL=subir_archivo_galeria(file_get_contents("views/admin/galeria/subir_archivo.html"),$_GET["id"],$_GET["cn"],$_GET["id_sub"],$_GET["nsub"],$_GET["id_ar"]);    }
        echo $PRINCIPAL;
        }
        else if($seccion=="galeria"){
        $PRINCIPAL=ListadoNoticias(FuncionesTransversales(file_get_contents("views/galeria/entorno.html")));
        $PRINCIPAL=BarraNavegacion($PRINCIPAL, $seccion);
        $PRINCIPAL=ColocaMenuSecundario($PRINCIPAL, $_SESSION["id_empresa"]);
        if ($_GET["p"]=="principal"){
        //Aca veo si tiene mas de una categoria,
        //si tiene solo 1, pasa directamente a la categoria a ver los albunes, si tiene mas de una, sigue igual
        $total_categorias=TraeCarpetasPorEmpresa($id_empresa);
        if(count($total_categorias)==1){
        $PRINCIPAL = str_replace("{ENTORNO_GALERIA}",galeria_subcategoria(FuncionesTransversales(file_get_contents("views/galeria/index.html")),$total_categorias[0]->id,$total_categorias[0]->categoria, $id_empresa, 2),$PRINCIPAL);
        }else{
        $PRINCIPAL = str_replace("{ENTORNO_GALERIA}",galeria_inicio(FuncionesTransversales(file_get_contents("views/galeria/principal.html")), $id_empresa),$PRINCIPAL);
        }
        //$PRINCIPAL = str_replace("{ENTORNO_GALERIA}",galeria_inicio(FuncionesTransversales(file_get_contents("views/galeria/principal.html")), $id_empresa),$PRINCIPAL);
        }
        if ($_GET["p"]=="subcategoria"){
        //$PRINCIPAL=galeria_subcategoria(FuncionesTransversales(file_get_contents("views/galeria/index.html")),$_GET["id"],$_GET["ncat"]);
        $PRINCIPAL = str_replace("{ENTORNO_GALERIA}",galeria_subcategoria(FuncionesTransversales(file_get_contents("views/galeria/index.html")),$_GET["id"],$_GET["ncat"], $id_empresa, 2),$PRINCIPAL);
        }
        if ($_GET["p"]=="buscar_archivos"){
        //$PRINCIPAL=biblioteca_archivos_busqueda(FuncionesTransversales(file_get_contents("views/biblioteca/resultados.html")),$_GET["id"]);
        $PRINCIPAL = str_replace("{ENTORNO_GALERIA}",biblioteca_archivos_busqueda(FuncionesTransversales(file_get_contents("views/biblioteca/resultados.html")),$_GET["id"]),$PRINCIPAL);
        }
        $PRINCIPAL=BarraNavegacion($PRINCIPAL, $seccion);
        echo $PRINCIPAL;
        }
        else if($seccion=="coment"){
        $usuario=$_SESSION["user_"];
        $id_noticia=$_POST['idnoticia'];
        $comentario = ($_POST['comment']);
        $fecha=date('Y-m-d H:i:s');
        InsertarComentario($id_noticia, $usuario, $comentario, $fecha);
        }
        else if($seccion=="likes"){
        $voto = $_POST["voto"];
        $user = $_SESSION["user_"];
        $id_noticia = $_POST["id"];
        $ExisteVoto=ExisteVoto($voto, $user, $id_noticia);
        $TraerVotos=TraerVotos($voto, $id_noticia);
        if($ExisteVoto){
        $muestralikes='a '.count($TraerVotos).' personas les gusta esto';
        }else{
        InsertarLike($voto, $user, $id_noticia);
        $TraerVotos=TraerVotos($voto, $id_noticia);
        $muestralikes='a ti y '.count($TraerVotos).' personas les gusta esto';
        }
        echo $muestralikes;
        }

        else if($seccion=="detnot"){
            $id_noticia=Decodear($_GET["id"]);
    //Aca actualizo el campo visitas del registro de la noticia
    ActualizarVisitasPorNoticia($id_noticia);
    $rut=$_SESSION["user_"];
    $id_empresa=$_SESSION["id_empresa"];
    //aca inserto registro de Log por Noticia
    InsertarLogNoticia($rut, $id_noticia, $id_empresa);
    $datos_noticia=NoticiaPorIdConVistas($id_noticia, $id_empresa);
    if($id_empresa=="41"){
    $PRINCIPAL=DetalleNoticia(FuncionesTransversales(file_get_contents("views/noticias/41_com_single.html")), $id_noticia, $id_empresa);
    }else{
    $PRINCIPAL=DetalleNoticia(FuncionesTransversales(file_get_contents("views/noticias/single.html")), $id_noticia, $id_empresa);

    }

    $PRINCIPAL=ColocaBloqueCategoriasNoticias($PRINCIPAL, $_SESSION["id_empresa"]);
    //$PRINCIPAL=ColocaBloqueMasVistas($PRINCIPAL, $_SESSION["id_empresa"]);
    $PRINCIPAL=ColocaBloqueMasVistas($PRINCIPAL, $_SESSION["id_empresa"]);
    //$PRINCIPAL=ColocaBloqueUltimasTres($PRINCIPAL, $_SESSION["id_empresa"]);
    $PRINCIPAL=ColocaBloqueNoticiasSimilares($PRINCIPAL, $_SESSION["id_empresa"], $datos_noticia[0]->categoria);
    $PRINCIPAL=BarraNavegacion($PRINCIPAL, $seccion);
    $PRINCIPAL=ColocaBloqueUltimasTres($PRINCIPAL, $_SESSION["id_empresa"]);
    $PRINCIPAL=BarraNavegacion($PRINCIPAL, $seccion);
    $PRINCIPAL=ColocaMenuSecundario($PRINCIPAL, $_SESSION["id_empresa"]);
    echo $PRINCIPAL;
    }

        else if($seccion=="miequipo"){
        //Funcion para saber cuales pueden ser los criterios de la malla
        $PRINCIPAL=MiEquipo(FuncionesTransversales(file_get_contents("views/equipo/entorno_equipo.html")), $_SESSION["user_"]);
        $PRINCIPAL=BarraNavegacion($PRINCIPAL, $seccion);
        echo $PRINCIPAL;
        }
        else if($seccion=="dlto"){
        $id_objetivo=Decodear3($_GET["i"]);
        $cargo=Decodear3($_GET["c"]);
        EliminarObjetivo($id_objetivo);
        echo "
        <script>
        location.href='?sw=DNC3&i=".Encodear3($cargo)."';
        </script>";
        }
        else if($seccion=="evJef"){
        $rut_evaluador=$_SESSION["user_"];
        $id_empresa=$_SESSION["id_empresa"];
        $rut_evaluado=Decodear3($_GET["ie"]);
        $id_programa=Decodear3($_GET["i"]);
        //Verifico si esta finalizado
        $evaluacion_jefe_finalizado=VerificaFinalizadoEvaluacionJefe($rut_evaluado, $rut_evaluador, $id_programa);
        if($evaluacion_jefe_finalizado){
        echo "<script>
        location.href='?sw=informeEvalJ&ie=".Encodear3($rut_evaluado)."&i=".Encodear3($id_programa)."';
        </script>";
        exit;
        $PRINCIPAL=MiEquipo(FuncionesTransversales(file_get_contents("views/equipo/entorno_equipo.html")), $_SESSION["user_"]);
        $PRINCIPAL=BarraNavegacion($PRINCIPAL, $seccion);
        echo $PRINCIPAL;
        exit;
        }
        //Funcion para saber cuales pueden ser los criterios de la malla
        $PRINCIPAL=MuestraEvaluacionJefe(FuncionesTransversales(file_get_contents("views/equipo/entorno_evaluacion.html")), $rut_evaluado, $rut_evaluador, $id_programa);
        $PRINCIPAL=BarraNavegacion($PRINCIPAL, $seccion);
        echo $PRINCIPAL;
        }
        else if($seccion=="informeEvalJ"){
        $evaluado=Decodear3($_GET["ie"]);
        $id_programa=Decodear3($_GET["i"]);
        $evaluador=$_SESSION["user_"];
        $PRINCIPAL=MuestraInformeEvaluacionJefatura(FuncionesTransversales(file_get_contents("views/equipo/informe/entorno_informe_evaluacion_jefe.html")),$id_programa, $evaluado, $evaluador);
        $PRINCIPAL=BarraNavegacion($PRINCIPAL, $seccion);
        echo $PRINCIPAL;
        }
        else if($seccion=="saveCondR"){
        $evaluado=Decodear3($_POST["e"]);
        $evaluador=Decodear3($_POST["er"]);
        $cargo=Decodear3($_POST["cr"]);
        //echo "$e, $er, $cr";
        $objetivos=ListadoObjetivosDncDadoCargo($cargo);
        foreach($objetivos as $ob){
        //Conducta 1
        $tiene_registro=TieneRegistroRespuestaEvConduccta($evaluado, $evaluador, $ob->id);
        //if($_POST["nivel_".$ob->id."_1"]){
        if($tiene_registro){
        //actualizo
        ActualizaNotaEConducta($evaluado, $evaluador, $_POST["nivel_".$ob->id."_1"], $ob->id, "1", $_POST["debilidad_".$ob->id."_1"]);
        }else{
        //inserto
        InsertoNotaEvConducta($evaluado, $evaluador, $_POST["nivel_".$ob->id."_1"], $ob->id, "1", $_POST["debilidad_".$ob->id."_1"]);
        }
        //}
        //Conducta 2
        $tiene_registro=TieneRegistroRespuestaEvConduccta($evaluado, $evaluador, $ob->id);
        //if($_POST["nivel_".$ob->id."_2"]){
        if($tiene_registro){
        //actualizo
        ActualizaNotaEConducta($evaluado, $evaluador, $_POST["nivel_".$ob->id."_2"], $ob->id, "2", $_POST["debilidad_".$ob->id."_2"]);
        }else{
        //inserto
        InsertoNotaEvConducta($evaluado, $evaluador, $_POST["nivel_".$ob->id."_2"], $ob->id, "2", $_POST["debilidad_".$ob->id."_2"]);
        }
        //}
        //Conducta 3
        $tiene_registro=TieneRegistroRespuestaEvConduccta($evaluado, $evaluador, $ob->id);
        //if($_POST["nivel_".$ob->id."_3"]){
        if($tiene_registro){
        //actualizo
        ActualizaNotaEConducta($evaluado, $evaluador, $_POST["nivel_".$ob->id."_3"], $ob->id, "3", $_POST["debilidad_".$ob->id."_3"]);
        }else{
        //inserto
        InsertoNotaEvConducta($evaluado, $evaluador, $_POST["nivel_".$ob->id."_3"], $ob->id, "3", $_POST["debilidad_".$ob->id."_3"]);
        }
        //}
        }
        //ACA veo si está finalizado, si es asi, ingreso el registro de finalizado
        if($_POST["f"]=="1"){
        InsertoRegistroFinalzadoEvalConductas($evaluado, $evaluador);
        echo "<script>
        location.href='?sw=DNC6&e=".Encodear3($evaluado)."';
        </script>";
        exit;
        }
        echo "<script>
        location.href='?sw=DNC5&e=".Encodear3($evaluado)."';
        </script>";
        exit;
        }
        else if($seccion=="muestraTextareaDadoValorSeleccionadoObjetivosCompass"){
        $id_empresa=$_SESSION["id_empresa"];
        $valor_seleccionado=$_POST["valor_seleccionado"];
        $id_objetivo=$_POST["id_objetivo"];
        if($valor_seleccionado<>5){
        $template_comentario=file_get_contents("views/sgd/evaluacion/".$id_empresa."_row_comentario_por_objetivo.html");
        $template_comentario= str_replace("{ID_OBJETIVO}",Encodear($id_objetivo),$template_comentario);
        echo $template_comentario;
        }
        }
        else if($seccion=="ReabrirProceso"){
        $rut_evaluado=Decodear3($_GET["re"]);
        $rut_evaluador=Decodear3($_GET["revr"]);
        $id_proceso=Decodear3($_GET["ip"]);
        $tipo=($_GET["ti"]);
        AbreEvaluacionSGD($rut_evaluado, $rut_evaluador, $id_proceso);
        if($tipo==1){
        //Autoevaluacion
        echo "<script>
        location.href='?sw=evind&ie=".Encodear3($rut_evaluado)."&ip=".Encodear3($id_proceso)."&ae=1';
        </script>";
        exit;
        }else if($tipo==2){
        //Descendente
        echo "<script>
        location.href='?sw=sgd2&ip=".Encodear3($id_proceso)."';
        </script>";
        exit;
        }
        }
        else if($seccion=="inf"){
        $rut=$_SESSION["user_"];
        $evaluador=$_SESSION["user_"];
        $id_proceso=Decodear3($_GET["ip"]);
        $id_empresa=$_SESSION["id_empresa"];
        $imprimir=$_GET["imp"];
        if($id_proceso){
        $_SESSION["id_proceso"]=$id_proceso;
        }
        $muestra_solo_ae=$_GET["mae"];
        $ve_evaluacion_final=$_GET["veEval"];
        $datos_proceso_plan=TraeProcesosDeEvaluacionPorEmpresaYDiProceso($id_empresa, $id_proceso);
        $_SESSION["id_proceso_anual"]=$datos_proceso_plan[0]->id_proceso_anual;
        $_SESSION["ano_proceso_anual"]=$datos_proceso_plan[0]->ano;
        $evaluado=Decodear3($_GET["ie"]);
        //echo "$rut, $evaluador, $id_proceso, $id_empresa, $evaluado";
        if($ve_evaluacion_final==1){
        $datos_evaluacion=ObtenerJefeRelPorProceso($evaluado, $id_proceso);
        }
        else if($evaluado<>$evaluador){
        $datos_evaluacion=ObtenerJefeRelPorProceso($evaluado, $id_proceso);
        }else if($evaluado==$evaluador){
        $datos_evaluacion=ObtenerJefeRelPorProcesoAE($evaluado, $id_proceso);
        }
        $datos_proceso_evaluacion=TraeProcesosDeEvaluacionPorEmpresaYDiProceso($id_empresa, $id_proceso);
        if($ve_evaluacion_final==1){
        $template_entorno_informe=file_get_contents("views/sgd/informe/".$id_empresa."_entorno_informe_dinamico_con_columna_ae.html");
        $PRINCIPAL=InformeIndividualEval(MuestaDatosEval(FuncionesTransversales($template_entorno_informe), $evaluado, $datos_evaluacion[0]->evaluador, $id_proceso), $evaluado, $datos_evaluacion[0]->evaluador, $id_proceso, $id_empresa, "");
        $PRINCIPAL = str_replace("{BOTON_EXPORTAR_PDF}",file_get_contents("views/sgd/informe/BotonExportarPdf.html"),$PRINCIPAL);
        $PRINCIPAL = str_replace("{RUT_EVALUADO_ENCODEADO}",Encodear3($evaluado),$PRINCIPAL);
        $PRINCIPAL = str_replace("{ID_PROCESO_ENCODEADO}",Encodear3($id_proceso),$PRINCIPAL);
        }else{
        if($muestra_solo_ae==1){
        $datos_evaluacion=ObtenerJefeRelPorProcesoAE($evaluado, $id_proceso);
        $template_entorno_informe=file_get_contents("views/sgd/informe/".$id_empresa."_entorno_informe_dinamico_externo.html");
        $PRINCIPAL=InformeIndividualEval(MuestaDatosEval(FuncionesTransversales($template_entorno_informe), $evaluado, $datos_evaluacion[0]->evaluador, $id_proceso), $evaluado, $datos_evaluacion[0]->evaluador, $id_proceso, $id_empresa);
        echo $PRINCIPAL;
        exit;
        }
        if($datos_proceso_evaluacion[0]->muestra_ae_evaluacion==1){
        if($evaluado==$evaluador){
        $template_entorno_informe=file_get_contents("views/sgd/informe/".$id_empresa."_entorno_informe_dinamico.html");
        $PRINCIPAL=InformeIndividualEval(MuestaDatosEval(FuncionesTransversales($template_entorno_informe), $evaluado, $datos_evaluacion[0]->evaluador, $id_proceso), $evaluado, $datos_evaluacion[0]->evaluador, $id_proceso, $id_empresa);
        }else{
        if($imprimir==1){
        echo "
        <script>
        window.print();
        </script>";
        $template_entorno_informe=file_get_contents("views/sgd/informe/entorno_informe_dinamico_con_columna_ae_imprimir.html");
        $PRINCIPAL=InformeIndividualEval(MuestaDatosEval(FuncionesTransversales($template_entorno_informe), $evaluado, $datos_evaluacion[0]->evaluador, $id_proceso), $evaluado, $datos_evaluacion[0]->evaluador, $id_proceso, $id_empresa, "");
        $PRINCIPAL=FuncionParaObtenerCalculoMientrasAvanzaPagina($PRINCIPAL, $evaluador, $id_proceso, $id_empresa, $evaluado, "");
        echo $PRINCIPAL;
        exit;
        }
        $template_entorno_informe=file_get_contents("views/sgd/informe/".$id_empresa."_entorno_informe_dinamico_con_columna_ae.html");
        $PRINCIPAL=InformeIndividualEval(MuestaDatosEval(FuncionesTransversales($template_entorno_informe), $evaluado, $datos_evaluacion[0]->evaluador, $id_proceso), $evaluado, $datos_evaluacion[0]->evaluador, $id_proceso, $id_empresa, "");
        $PRINCIPAL = str_replace("{BOTON_EXPORTAR_PDF}",file_get_contents("views/sgd/informe/BotonExportarPdf.html"),$PRINCIPAL);
        $PRINCIPAL = str_replace("{RUT_EVALUADO_ENCODEADO}",Encodear3($evaluado),$PRINCIPAL);
        $PRINCIPAL = str_replace("{ID_PROCESO_ENCODEADO}",Encodear3($id_proceso),$PRINCIPAL);
        }
        }else{
        $template_entorno_informe=file_get_contents("views/sgd/informe/entorno_informe_dinamico_eval.html");
        $PRINCIPAL=InformeIndividualEval(MuestaDatosEval(FuncionesTransversales($template_entorno_informe), $evaluado, $datos_evaluacion[0]->evaluador, $id_proceso), $evaluado, $datos_evaluacion[0]->evaluador, $id_proceso, $id_empresa);
        }
        }
        //BLOQUE PREGUNTAS_FINALES
        $PRINCIPAL=FuncionParaObtenerCalculoMientrasAvanzaPagina($PRINCIPAL, $evaluador, $id_proceso, $id_empresa, $evaluado, "");
        //}
        $PRINCIPAL = str_replace("{BOTON_VOLVER_LMS}",file_get_contents("views/cursos/contenidos/boton_volver_curso.html"),$PRINCIPAL);
        //$PRINCIPAL = str_replace("{ID_CURSO_ENCODEADO_VOLVER}",Encodear3($datos_objeto[0]->id_curso),$PRINCIPAL);
        $PRINCIPAL = str_replace("{ID_CURSO_ENCODEADO_VOLVER}",Encodear3($_SESSION["id_curso"]),$PRINCIPAL);
        ///$PRINCIPAL = str_replace("{ID_OBJETO_ENCODEADO}",Encodear3($id_objeto),$PRINCIPAL);
        $PRINCIPAL = str_replace("{ID_OBJETO_ENCODEADO}",Encodear3($_SESSION["id_objeto"]),$PRINCIPAL);
        $PRINCIPAL = str_replace("{ENVBOTON}","backcont",$PRINCIPAL);
        $PRINCIPAL = str_replace("{BOTON_FINALIZAR_LMS}",file_get_contents("views/cursos/contenidos/boton_siguiente_curso.html"),$PRINCIPAL);
        $PRINCIPAL=BarraNavegacion($PRINCIPAL, $seccion);
        $PRINCIPAL = ColocaPonderaciones($PRINCIPAL, $evaluado);
        //$PRINCIPAL = ColocaBotonera1($PRINCIPAL, 3);
        $PRINCIPAL = ColocaBotonera2($PRINCIPAL, "", $id_proceso);
        $PRINCIPAL = ColocaAvancesPorEvaluador($PRINCIPAL, $rut);
        $PRINCIPAL = ColocaBotonera3($PRINCIPAL, $id_proceso, $_SESSION["user_"]);
        if($ve_evaluacion_final==1){
        //Coloca bloque de Intereses de Desarrollo
        $bloque_intereses_desarrollo=BloqueInteresesDesarrollo($evaluado, $datos_evaluacion[0]->evaluador, $id_empresa, $id_proceso);
        $bloque_fijacon=BloquefijacionObjetivosPlanes($evaluado, $datos_evaluacion[0]->evaluador, $id_empresa, $id_proceso);
        $PRINCIPAL = str_replace("{BLOQUE_INTERESES_DESARROLLO}",$bloque_intereses_desarrollo,$PRINCIPAL);
        $PRINCIPAL = str_replace("{BLOQUE_FIJACION_OBJETIVOS_PLANES}",$bloque_fijacon,$PRINCIPAL);
        }else{
        $PRINCIPAL = str_replace("{BLOQUE_INTERESES_DESARROLLO}","",$PRINCIPAL);
        $PRINCIPAL = str_replace("{BLOQUE_FIJACION_OBJETIVOS_PLANES}","",$PRINCIPAL);
        }
        //Bloque Nota Final Por Promedio de Competencias
        $promedio_por_competencias=PromedioPorCompetencias($evaluado, $datos_evaluacion[0]->evaluador, $id_proceso);
        $datos_criterio_nota_fina=ObtenerCriterioPuntajeMatrizNotaFinal($promedio_por_competencias[0]->nota_promedio, "", 0, "nota_final", $datos_evaluacion[0]->evaluador, $id_proceso);
        $PRINCIPAL = str_replace("{NOTA_RESULTADO_FINAL_PROMEDIO_COMP}",round($promedio_por_competencias[0]->nota_promedio, 2),$PRINCIPAL);
        $PRINCIPAL = str_replace("{CRIERIO_RESULT_FINAL_PROM_COMP}",$datos_criterio_nota_fina[0],$PRINCIPAL);
        $PRINCIPAL = str_replace("{ETIQUETA_RESULTADO_FINAL_PROMEDIO_COMPETENCIAS}",$datos_criterio_nota_fina[2],$PRINCIPAL);
        echo $PRINCIPAL;
        }
        else if($seccion=="infExPDF"){
        $rut=$_SESSION["user_"];
        $evaluador=$_SESSION["user_"];
        $id_proceso=Decodear3($_GET["ip"]);
        $id_empresa=$_SESSION["id_empresa"];
        $imprimir=$_GET["imp"];
        $datos_empresa=DatosEmpresa($id_empresa);
        if($id_proceso){
        $_SESSION["id_proceso"]=$id_proceso;
        }
        $datos_proceso_plan=TraeProcesosDeEvaluacionPorEmpresaYDiProceso($id_empresa, $id_proceso);
        $_SESSION["id_proceso_anual"]=$datos_proceso_plan[0]->id_proceso_anual;
        $_SESSION["ano_proceso_anual"]=$datos_proceso_plan[0]->ano;
        $evaluado=Decodear3($_GET["ie"]);
        //echo "$rut, $evaluador, $id_proceso, $id_empresa, $evaluado";
        if($evaluado<>$evaluador){
        $datos_evaluacion=ObtenerJefeRelPorProceso($evaluado, $id_proceso);
        }else if($evaluado==$evaluador){
        $datos_evaluacion=ObtenerJefeRelPorProcesoAE($evaluado, $id_proceso);
        }
        $datos_proceso_evaluacion=TraeProcesosDeEvaluacionPorEmpresaYDiProceso($id_empresa, $id_proceso);
        $template_entorno_informe=file_get_contents("views/sgd/informe/entorno_informe_dinamico_con_columna_ae_pdf.html");
        $PRINCIPAL=InformeIndividualEval(MuestaDatosEval(FuncionesTransversales($template_entorno_informe), $evaluado, $datos_evaluacion[0]->evaluador, $id_proceso), $evaluado, $datos_evaluacion[0]->evaluador, $id_proceso, $id_empresa, "", "pdf");
        $PRINCIPAL = str_replace("{BOTON_EXPORTAR_PDF}",file_get_contents("views/sgd/informe/BotonExportarPdf.html"),$PRINCIPAL);
        $PRINCIPAL = str_replace("{RUT_EVALUADO_ENCODEADO}",Encodear3($evaluado),$PRINCIPAL);
        $PRINCIPAL = str_replace("{ID_PROCESO_ENCODEADO}",Encodear3($id_proceso),$PRINCIPAL);
        //BLOQUE PREGUNTAS_FINALES
        //}
        $mpdf=new mPDF('c', 'A4-P');
        $stylesheet2 = file_get_contents('bootstrap/css/bootstrap.min.css');
        $stylesheet = file_get_contents('bootstrap/css/empresa/'.$datos_empresa[0]->css_nombre.'');
        $mpdf->WriteHTML($stylesheet2,1);
        $mpdf->WriteHTML($stylesheet,1);
        $mpdf->WriteHTML($PRINCIPAL,2);
        $mpdf->Output("");
        echo $PRINCIPAL;
        }
        else if($seccion=="infPDF"){
        $rut=$_SESSION["user_"];
        $evaluador=$_SESSION["user_"];
        $id_proceso=Decodear3($_GET["ip"]);
        $id_empresa=$_SESSION["id_empresa"];
        $datos_empresa=DatosEmpresa($id_empresa);
        if($id_proceso){
        $_SESSION["id_proceso"]=$id_proceso;
        }
        $datos_proceso_plan=TraeProcesosDeEvaluacionPorEmpresaYDiProceso($id_empresa, $id_proceso);
        $_SESSION["id_proceso_anual"]=$datos_proceso_plan[0]->id_proceso_anual;
        $_SESSION["ano_proceso_anual"]=$datos_proceso_plan[0]->ano;
        $evaluado=Decodear3($_GET["ie"]);
        //echo "$rut, $evaluador, $id_proceso, $id_empresa, $evaluado";
        if($evaluado<>$evaluador){
        $datos_evaluacion=ObtenerJefeRelPorProceso($evaluado, $id_proceso);
        }else if($evaluado==$evaluador){
        $datos_evaluacion=ObtenerJefeRelPorProcesoAE($evaluado, $id_proceso);
        }
        $datos_proceso_evaluacion=TraeProcesosDeEvaluacionPorEmpresaYDiProceso($id_empresa, $id_proceso);
        if($datos_proceso_evaluacion[0]->muestra_ae_evaluacion==1){
        if($evaluado==$evaluador){
        $template_entorno_informe=file_get_contents("views/sgd/informe/entorno_informe_dinamico.html");
        $PRINCIPAL=InformeIndividualEval(MuestaDatosEval(FuncionesTransversales($template_entorno_informe), $evaluado, $datos_evaluacion[0]->evaluador, $id_proceso), $evaluado, $datos_evaluacion[0]->evaluador, $id_proceso, $id_empresa);
        }else{
        $template_entorno_informe=file_get_contents("views/sgd/informe/PDF_entorno_informe_dinamico_con_columna_ae.html");
        $PRINCIPAL=InformeIndividualEval(MuestaDatosEval(FuncionesTransversales($template_entorno_informe), $evaluado, $datos_evaluacion[0]->evaluador, $id_proceso), $evaluado, $datos_evaluacion[0]->evaluador, $id_proceso, $id_empresa, "", "si");
        $PRINCIPAL = str_replace("{BOTON_EXPORTAR_PDF}",file_get_contents("views/sgd/informe/BotonExportarPdf.html"),$PRINCIPAL);
        }
        }else{
        $template_entorno_informe=file_get_contents("views/sgd/informe/entorno_informe_dinamico_eval.html");
        $PRINCIPAL=InformeIndividualEval(MuestaDatosEval(FuncionesTransversales($template_entorno_informe), $evaluado, $datos_evaluacion[0]->evaluador, $id_proceso), $evaluado, $datos_evaluacion[0]->evaluador, $id_proceso, $id_empresa);
        }
        $mpdf=new mPDF('c', 'A4-L');
        $stylesheet2 = file_get_contents('bootstrap/css/bootstrap.min.css');
        $stylesheet = file_get_contents('bootstrap/css/empresa/'.$datos_empresa[0]->css_nombre.'');
        $mpdf->WriteHTML($stylesheet2,1);
        $mpdf->WriteHTML($stylesheet,1);
        $mpdf->WriteHTML($PRINCIPAL,2);
        //$mpdf->Output('SGD_2016_Objetivos_'.$evaluado.'.pdf','F');
        $mpdf->Output("");
        //echo $PRINCIPAL;
        }
        else if($seccion=="infext"){
        $rut=$_SESSION["user_"];
        $id_proceso=Decodear3($_GET["ip"]);
        $evaluado=Decodear3($_GET["ie"]);
        $datos_evaluacion=ObtenerJefeRelPorProceso($evaluado, $id_proceso);
        $datos_proceso_evaluacion=TraeProcesosDeEvaluacionPorEmpresaYDiProceso($id_empresa, $id_proceso);
        $template_entorno_informe=file_get_contents("views/sgd/informe/entorno_informe_dinamico_con_columna_ae.html");
        $PRINCIPAL=InformeIndividualEval(MuestaDatosEval(FuncionesTransversales($template_entorno_informe), $evaluado, $datos_evaluacion[0]->evaluador, $datos_evaluacion[0]->id_proceso), $evaluado, $datos_evaluacion[0]->evaluador, $datos_evaluacion[0]->id_proceso, $id_empresa, "feedback");
        $PRINCIPAL=ColocaBloqueFeedback($PRINCIPAL, $datos_evaluacion, $id_empresa);
        $PRINCIPAL=BarraNavegacion($PRINCIPAL, $seccion);
        $PRINCIPAL = ColocaPonderaciones($PRINCIPAL, $evaluado);
        $PRINCIPAL=FuncionParaObtenerCalculoMientrasAvanzaPagina($PRINCIPAL, $datos_evaluacion[0]->evaluador, $datos_evaluacion[0]->id_proceso, $id_empresa, $evaluado, "");
        $PRINCIPAL = ColocaBotonera2($PRINCIPAL, "", $id_proceso);
        $PRINCIPAL = ColocaAvancesPorEvaluador($PRINCIPAL, $rut);
        echo $PRINCIPAL;
        }
        else if($seccion=="addFeedback"){
        $evaluado=Decodear3($_POST["re"]);
        $evaluador=Decodear3($_POST["rer"]);
        $id_proceso=Decodear3($_POST["ip"]);
        $feedback_realizado=$_POST["realizado"];
        $pregunta1=utf8_decode(trim($_POST["pregunta1"]));
        $pregunta2=utf8_decode(trim($_POST["pregunta2"]));
        $pregunta3=utf8_decode(trim($_POST["pregunta3"]));
        $pregunta4=utf8_decode(trim($_POST["pregunta4"]));
        InsertaFeedbackEvaluado($evaluado, $evaluador, $id_proceso, $id_empresa, $feedback_realizado, $pregunta1, $pregunta2, $pregunta3, $pregunta4);
        InsertaFeedbackEvaluadoFinalizado($evaluado, $evaluador, $id_proceso, $id_empresa);
        echo "<script>
        location.href='?sw=infext&ie=".Encodear3($evaluado)."&ip=".Encodear3($id_proceso)."&ipr=".Encodear3($id_proceso)."$#pag';
        </script>";
        }
        else if($seccion=="guardaRespComp"){
        $alternativa_seleccionada=$_GET["altc"];
        $evaluado=($_GET["idvax"]);
        $texto=file_get_contents("views/sgd/evaluacion/texto_respuesta_guardada.html");
        //echo $texto;
        }
        else if($seccion=="guardaResp"){
        $id_objetivo=Decodear3($_GET["iobjx"]);
        $id_proceso=Decodear3($_GET["ipro"]);
        $evaluado=Decodear3($_GET["re"]);
        $evaluador=Decodear3($_GET["revr"]);
        $valor=$_GET["altsel"];
        $tiene_respuesta=TieneRespuestaCompetenciaObjetivoPorProceso($evaluado, $evaluador, $id_objetivo, $id_proceso);
        $datos_criterio=ObtenerCriterioPuntajeMatrizNotaFinal($valor, $evaluado, 0, "");
        if($tiene_respuesta){
        ActualizaRespuestasObj2($evaluado, $evaluador, $valor, $id_objetivo, $datos_criterio, $id_proceso);
        }else{
        InsertaRespuestasObj($evaluado, $evaluador, $valor, $id_objetivo, $datos_criterio, $id_proceso);
        }
        $texto=file_get_contents("views/sgd/evaluacion/texto_respuesta_guardada.html");
        echo $texto;
        }
        else if($seccion=="evind"){
        $evaluado=Decodear3($_GET["ie"]);
        $solo_ae=$_GET["ae"];
        $id_empresa=$_SESSION["id_empresa"];
        $evaluador=$_SESSION["user_"];
        $pagina=Decodear3($_GET["p"]);
        $id_proceso=Decodear3($_GET["ip"]);
        //Veo si la Evaluacion está finalizada, si es asi, lo redirecciono al informe
        $eval_finalizada=FinalizadoEvaluadoEvaluadorProProceso($evaluado, $evaluador, $id_proceso);
        if($eval_finalizada){
        echo "<script>location.href='?sw=inf&ip=".Encodear3($id_proceso)."&ie=".Encodear3($evaluado)."';</script>";
        exit;
        }
        $id_objeto=Decodear3($_GET["iob"]);
        if($id_objeto){
        $_SESSION["id_objeto"]=$id_objeto;
        }
        $datos_empresa=DatosEmpresa($id_empresa);
        //echo "evaluado $evaluado id_proceso ".$id_proceso." pagina $pagina <br>";
        //exit;
        if($id_proceso){
        $_SESSION["id_proceso"]=$id_proceso;
        }else{
        $id_proceso=$_SESSION["id_proceso"];
        }
        if($_GET["pagi"]==1){
        ActualizoSesion($evaluado, $evaluador, $pagina, $id_proceso);
        }
        //$parametros=explode(";", Decodear3($_GET["p"]));
        //$evaluado=$parametros[0];
        //$evaluador=$parametros[1];
        //echo "evaluado $evaluado evaluador $evaluador";
        //$PRINCIPAL=EntornoEvaluacion(FuncionesTransversales(file_get_contents("views/sgd/evaluacion/entorno_evaluacion.html")), $evaluado, $evaluador);
        if(!$pagina){
        //verifico si hay pagina en la tabla sesion
        //$tiene_sesion=SesionSGDSoloEvaluador($evaluador, $id_proceso);
        $tiene_sesion=SesionSGDSoloEvaluadorEvaluado($evaluador, $id_proceso, $evaluado);
        $pagina=$tiene_sesion[0]->pagina;
        if(!$pagina){
        $pagina=1;
        }
        }
        //echo "proceso ".$_SESSION["id_proceso"]." pagina $pagina<br>";
        $id_proceso_evaluacion=$_SESSION["id_proceso"];
        //Con la siguiente funcion, se ocupo para Emiliana, para evaluar solo las competencias
        //$PRINCIPAL=EntornoEvaluacionListado(FuncionesTransversales(file_get_contents("views/sgd/evaluacion/entorno_evaluacion.html")), $evaluador, $pagina);
        //Con la siguiente, se utiliza para evaluar preguntas por competencias.
        //if($id_empresa==28){
        if($datos_empresa[0]->sgd_version==2){
        //Traigo los datos de la relacion, para ver qa que perfil pertenece, y que subperfil, y ver si se le muestran los graficos o no
        $datos_evaluacion=TraeDatosRelacionEvaluadoEvaluadorProceso($evaluado, $evaluador, $id_proceso);
        //if($datos_evaluacion[0]->muestra_graficos==1){
        if($evaluado==$evaluador){
        $PRINCIPAL=EntornoEvaluacionListadoAlternativasDinamicas(FuncionesTransversales(file_get_contents("views/sgd/evaluacion/".$id_empresa."_entorno_evaluacion_ae.html")), $evaluador, $pagina, $id_empresa, $_SESSION["id_proceso"], $evaluado);
        }else{
        $PRINCIPAL=EntornoEvaluacionListadoAlternativasDinamicas(FuncionesTransversales(file_get_contents("views/sgd/evaluacion/".$id_empresa."_entorno_evaluacion.html")), $evaluador, $pagina, $id_empresa, $_SESSION["id_proceso"], $evaluado);
        }
        //}else{
        //    $PRINCIPAL=EntornoEvaluacionListadoAlternativasDinamicas(FuncionesTransversales(file_get_contents("views/sgd/evaluacion/entorno_evaluacion_chilquinta_sin_graficos.html")), $evaluador, $pagina, $id_empresa, $_SESSION["id_proceso"], $evaluado);
        //}
        }else{
        $PRINCIPAL=EntornoEvaluacionListadoAlternativasDinamicas(FuncionesTransversales(file_get_contents("views/sgd/evaluacion/entorno_evaluacion.html")), $evaluador, $pagina, $id_empresa, $_SESSION["id_proceso"], $evaluado);
        }
        //$PRINCIPAL = ColocaPonderaciones($PRINCIPAL, $evaluado);
        $PRINCIPAL=BarraNavegacion($PRINCIPAL, $seccion);
        $PRINCIPAL = ColocaBotonera1($PRINCIPAL, 3);
        $PRINCIPAL = ColocaBotonera2($PRINCIPAL, 4, $id_proceso_evaluacion);
        $PRINCIPAL = ColocaAvancesPorEvaluador($PRINCIPAL, $evaluador);
        //$PRINCIPAL = str_replace("{TABLA_DATOS_USUARIO_SUPERIOR}",file_get_contents("views/sgd/tabla_datos_superior_usuario.html"),$PRINCIPAL);
        $PRINCIPAL = str_replace("{TABLA_DATOS_USUARIO_SUPERIOR}","",$PRINCIPAL);
        //$PRINCIPAL = str_replace("{GRAFICO}","",$PRINCIPAL);
        $PRINCIPAL=FuncionParaObtenerCalculoMientrasAvanzaPagina($PRINCIPAL, $evaluador, $id_proceso, $id_empresa, $evaluado);
        $PRINCIPAL = ColocaBotonera3($PRINCIPAL, $id_proceso, $_SESSION["user_"]);
        $PRINCIPAL=ColocaDatosUsuario($PRINCIPAL, $evaluador, "");
        $PRINCIPAL = str_replace("{BOTON_VOLVER_LMS}",file_get_contents("views/cursos/contenidos/boton_volver_curso.html"),$PRINCIPAL);
        //$PRINCIPAL = str_replace("{ID_CURSO_ENCODEADO_VOLVER}",Encodear3($datos_objeto[0]->id_curso),$PRINCIPAL);
        //$PRINCIPAL = str_replace("{ID_OBJETO_ENCODEADO}",Encodear3($id_objeto),$PRINCIPAL);
        $PRINCIPAL = str_replace("{ID_CURSO_ENCODEADO_VOLVER}",Encodear3($_SESSION["id_curso"]),$PRINCIPAL);
        $PRINCIPAL = str_replace("{ID_OBJETO_ENCODEADO}",Encodear3($_SESSION["id_objeto"]),$PRINCIPAL);
        $PRINCIPAL = str_replace("{ENVBOTON}","backcont",$PRINCIPAL);
        $PRINCIPAL = str_replace("{BOTON_FINALIZAR_LMS}",file_get_contents("views/cursos/contenidos/boton_siguiente_curso.html"),$PRINCIPAL);
        $PRINCIPAL = str_replace("{TABLA_DATOS_USUARIO_SUPERIOR}","",$PRINCIPAL);
        echo $PRINCIPAL;
        }
        else if($seccion=="DLTsession"){
        $rut_evaluador=Decodear3($_POST["rut"]);
        $id_proceso=Decodear3($_POST["id_proceso"]);
        //InsertoSesion("evaluado".$rut_evaluador, "evaluador", "pagina", "proceso".$id_proceso);
        //InsertoSesion("evaluado", $rut_evaluador, "69", "proceso");
        //print_r($_POST);
        BorroSesionEvaluacion2($rut_evaluador, $id_proceso);
        //InsertoSesion("evaluado1", $rut_evaluador, "69", "proceso");
        }
        else if($seccion=="ev"){
        $id_empresa=$_SESSION["id_empresa"];
        $evaluador=$_SESSION["user_"];
        $pagina=Decodear3($_GET["p"]);
        $id_proceso=Decodear3($_GET["ip"]);
        $datos_empresa=DatosEmpresa($id_empresa);
        $version_sgd=$datos_empresa[0]->sgd_version;
        //echo "id_proceso ".$id_proceso." pagina $pagina <br>";
        if($id_proceso){
        $_SESSION["id_proceso"]=$id_proceso;
        }
        //$parametros=explode(";", Decodear3($_GET["p"]));
        //$evaluado=$parametros[0];
        //$evaluador=$parametros[1];
        //echo "evaluado $evaluado evaluador $evaluador";
        //$PRINCIPAL=EntornoEvaluacion(FuncionesTransversales(file_get_contents("views/sgd/evaluacion/entorno_evaluacion.html")), $evaluado, $evaluador);
        if(!$pagina){
        //verifico si hay pagina en la tabla sesion
        $tiene_sesion=SesionSGDSoloEvaluador($evaluador, $id_proceso);
        $pagina=$tiene_sesion[0]->pagina;
        if(!$pagina){
        $pagina=1;
        }
        }
        //echo "proceso ".$_SESSION["id_proceso"]." pagina $pagina<br>";
        $id_proceso_evaluacion=$_SESSION["id_proceso"];
        //Con la siguiente funcion, se ocupo para Emiliana, para evaluar solo las competencias
        //$PRINCIPAL=EntornoEvaluacionListado(FuncionesTransversales(file_get_contents("views/sgd/evaluacion/entorno_evaluacion.html")), $evaluador, $pagina);
        //Con la siguiente, se utiliza para evaluar preguntas por competencias.
        if($version_sgd==2){
        //$PRINCIPAL=EntornoEvaluacionListadoAlternativasDinamicas(FuncionesTransversales(file_get_contents("views/sgd/evaluacion/".$id_empresa."_entorno_evaluacion_chilquinta.html")), $evaluador, $pagina, $id_empresa, $_SESSION["id_proceso"], "");
        $PRINCIPAL=EntornoEvaluacionListadoAlternativasDinamicas(FuncionesTransversales(file_get_contents("views/sgd/evaluacion/".$id_empresa."_entorno_evaluacion.html")), $evaluador, $pagina, $id_empresa, $_SESSION["id_proceso"], "");
        }else{
        $PRINCIPAL=EntornoEvaluacionListadoAlternativasDinamicas(FuncionesTransversales(file_get_contents("views/sgd/evaluacion/entorno_evaluacion.html")), $evaluador, $pagina, $id_empresa, $_SESSION["id_proceso"], "");
        }
        //$PRINCIPAL = ColocaPonderaciones($PRINCIPAL, $evaluado);
        $PRINCIPAL=BarraNavegacion($PRINCIPAL, $seccion);
        $PRINCIPAL = ColocaBotonera1($PRINCIPAL, 3);
        $PRINCIPAL = ColocaBotonera2($PRINCIPAL, 4, $id_proceso_evaluacion);
        $PRINCIPAL = ColocaAvancesPorEvaluador($PRINCIPAL, $evaluador);
        $PRINCIPAL = str_replace("{TABLA_DATOS_USUARIO_SUPERIOR}",file_get_contents("views/sgd/tabla_datos_superior_usuario.html"),$PRINCIPAL);
        $PRINCIPAL = str_replace("{GRAFICO}","",$PRINCIPAL);
        $PRINCIPAL=ColocaDatosUsuario($PRINCIPAL, $evaluador, "");
        $PRINCIPAL = ColocaBotonera3($PRINCIPAL, $id_proceso, $_SESSION["user_"]);
        echo $PRINCIPAL;
        }else if($seccion=="listobj"){
        $evaluador=$_SESSION["user_"];
        $datos_empresa=DatosEmpresa($id_empresa);
        $sgd_version=$datos_empresa[0]->sgd_version;
        $id_proceso=Decodear3($_GET["ip"]);
        if($id_proceso){
        $_SESSION["id_proceso"]=$id_proceso;
        }
        $datos_validacion_evaluador=ObtenerDatosAvancesPorEvaluador($evaluador);
        //if($datos_validacion_evaluador[0]==100){
        if($datos_validacion_evaluador[0]==0){
        if($sgd_version==2){
        $PRINCIPAL=ListadoValidaObjetivosJefe(FuncionesTransversales(file_get_contents("views/sgd/lectura1_sgd_version2.html")), $evaluador, "");
        }else{
        $PRINCIPAL=ListadoValidaObjetivosJefe(FuncionesTransversales(file_get_contents("views/sgd/lectura1.html")), $evaluador, "", "", $id_proceso);
        }
        $PRINCIPAL=ColocaDatosUsuario($PRINCIPAL, $evaluador, 2);
        $PRINCIPAL=BarraNavegacion($PRINCIPAL, $seccion);
        $PRINCIPAL = str_replace("{PAGINACION_EVALUACION}","",$PRINCIPAL);
        $PRINCIPAL = ColocaBotonera1($PRINCIPAL, 3);
        $PRINCIPAL = ColocaBotonera2($PRINCIPAL, 1);
        $PRINCIPAL = ColocaAvancesPorEvaluador($PRINCIPAL, $evaluador);
        echo $PRINCIPAL;
        exit;
        }
        if($sgd_version==2){
        $PRINCIPAL=ListadoValidaObjetivosJefe(FuncionesTransversales(file_get_contents("views/sgd/sgd_version2/entorno_valida_jefe.html")), $evaluador, "", $sgd_version);
        }else{
        $PRINCIPAL=ListadoValidaObjetivosJefe(FuncionesTransversales(file_get_contents("views/sgd/entorno_valida_jefe.html")), $evaluador, "", $sgd_version, $id_proceso);
        }
        //en la siguiente Seccion, valido si este jefe tiene todo ok para poder enviar a Validar con el Validador.
        /*$verifica_objetivos_validados=VerificaSiObjetivosEstanValidadosDadoEvaluador($evaluador);
        if($verifica_objetivos_validados){
        $PRINCIPAL = str_replace("{BOTON_ENVIA_A_VALIDAR_OBJETIVOS}","",$PRINCIPAL);
        }else{
        //verifico mediante una funcion, si se muestra o no el boton enviar a Validar
        $PRINCIPAL = str_replace("{BOTON_ENVIA_A_VALIDAR_OBJETIVOS}","",$PRINCIPAL);
        }*/
        $PRINCIPAL=BarraNavegacion($PRINCIPAL, $seccion);
        $PRINCIPAL = str_replace("{PAGINACION_EVALUACION}","",$PRINCIPAL);
        $PRINCIPAL = ColocaBotonera1($PRINCIPAL, 3);
        $PRINCIPAL = ColocaBotonera2($PRINCIPAL, 1);
        $PRINCIPAL = ColocaAvancesPorEvaluador($PRINCIPAL, $evaluador, $_SESSION["id_proceso"], $_SESSION["id_empresa"]);
        echo $PRINCIPAL;
        }
        else if($seccion=="edobindje"){
        $id_objetivo=Decodear3($_GET["ioi"]);
        $id_proceso=Decodear3($_GET["ip"]);
        $evaluador=$_SESSION["user_"];
        if($_SESSION["id_proceso"]){
        $id_proceso=$_SESSION["id_proceso"];
        }
        $datos_empresa=DatosEmpresa($id_empresa);
        $sgd_version=$datos_empresa[0]->sgd_version;
        if($sgd_version==2){
        $PRINCIPAL=ListadoValidaObjetivosJefe(FuncionesTransversales(file_get_contents("views/sgd/sgd_version2/entorno_valida_jefe.html")), $evaluador, $id_objetivo, $sgd_version);
        }else{
        $PRINCIPAL=ListadoValidaObjetivosJefe(FuncionesTransversales(file_get_contents("views/sgd/entorno_valida_jefe.html")), $evaluador, $id_objetivo, $sgd_version, $id_proceso);
        }
        $PRINCIPAL=BarraNavegacion($PRINCIPAL, $seccion);
        $PRINCIPAL = str_replace("{PAGINACION_EVALUACION}","",$PRINCIPAL);
        $PRINCIPAL = ColocaBotonera1($PRINCIPAL, 3);
        $PRINCIPAL = ColocaBotonera2($PRINCIPAL, 1);
        $PRINCIPAL = ColocaAvancesPorEvaluador($PRINCIPAL, $evaluador);
        echo $PRINCIPAL;
        }
        else if($seccion=="svcind"){
        $evaluador=$_SESSION["user_"];
        $evaluado=Decodear3($_POST["evr"]);
        $id_competencia=$_POST["ic"];
        $comentario_por_competencia= trim(utf8_decode($_POST["comp_".$id_competencia]));
        $comentario_por_pregunta= trim(utf8_decode($_POST["comen_".$id_competencia]));
        $pagina_anterior=$_POST["back"];
        $id_proceso_evaluacion=$_SESSION["id_proceso"];
        $datos_proceso=TraeProcesosDeEvaluacionPorEmpresaYDiProceso($id_empresa, $id_proceso_evaluacion);
        //Comentario por competencia
        if($comentario_por_competencia){
        $comentario_por_comp=TieneComentarioPorCompetencia($evaluado, $evaluador, $id_competencia, $id_empresa, $id_proceso_evaluacion);
        if($comentario_por_comp){
        //echo "actualiza comentario";
        ActualizaComentarioPorCompetencia($evaluado, $evaluador, $id_competencia, $id_empresa, $id_proceso_evaluacion, $comentario_por_competencia);
        }else{
        //echo "inserta comentario";
        InsertaComentarioPorCompetencia($evaluado, $evaluador, $id_competencia, $id_empresa, $id_proceso_evaluacion, $comentario_por_competencia);
        }
        }
        //PREGUNTAS POR COMPETENCIAS
        $preguntas=PreguntasPorCompetencia($id_competencia);
        //Esto es para cencosud, si respestas con 1, todas deben quedar con 1
        $tiene_letra_c=0;
        foreach($preguntas as $preg){
        if($_POST[$evaluado."-".$preg->id]==1){
        $tiene_letra_c++;
        }
        $tiene_respuesta=TieneRespuestaCompetenciaProProceso($evaluado, $evaluador, $preg->id, $id_proceso_evaluacion);
        //$datos_para_respuesta=DevuelveDatosEval($evaluado, $evaluador, $preg->id);
        $datos_para_respuesta=DevuelveDatosEvalPorProceso($evaluado, $evaluador, $preg->id, $id_proceso_evaluacion);
        $datos_criterio=TransformaAlternativaAPuntaje($_POST[$evaluado."-".$preg->id], $datos_para_respuesta[0], $id_empresa, $datos_para_respuesta[4]);
        //print_r($datos_criterio);exit;
        if($tiene_respuesta){
        ActualizaRespuestas($evaluado, $evaluador, $_POST[$evaluado."-".$preg->id], $preg->id, $datos_para_respuesta[0], $datos_para_respuesta[1], $id_proceso_evaluacion, $datos_para_respuesta[3], $datos_para_respuesta[4], $datos_para_respuesta[5], $datos_criterio, utf8_decode($_POST["c".$evaluado."-".$preg->id]));
        }else{
        InsertaRespuestas($evaluado, $evaluador, $_POST[$evaluado."-".$preg->id], $preg->id, $datos_para_respuesta[0], $datos_para_respuesta[1], $id_proceso_evaluacion, $datos_para_respuesta[3], $datos_para_respuesta[4], $datos_para_respuesta[5], $datos_criterio, utf8_decode($_POST["c".$evaluado."-".$preg->id]));
        }
        }
        if($id_empresa==61){
        if($tiene_letra_c>0){
        foreach($preguntas as $preg){
        $respuesta=1;
        $tiene_respuesta=TieneRespuestaCompetenciaProProceso($evaluado, $evaluador, $preg->id, $id_proceso_evaluacion);
        //$datos_para_respuesta=DevuelveDatosEval($evaluado, $evaluador, $preg->id);
        $datos_para_respuesta=DevuelveDatosEvalPorProceso($evaluado, $evaluador, $preg->id, $id_proceso_evaluacion);
        $datos_criterio=TransformaAlternativaAPuntaje($respuesta, $datos_para_respuesta[0], $id_empresa, $datos_para_respuesta[4]);
        //print_r($datos_criterio);exit;
        if($tiene_respuesta){
        ActualizaRespuestas($evaluado, $evaluador, $respuesta, $preg->id, $datos_para_respuesta[0], $datos_para_respuesta[1], $id_proceso_evaluacion, $datos_para_respuesta[3], $datos_para_respuesta[4], $datos_para_respuesta[5], $datos_criterio, utf8_decode($_POST["c".$evaluado."-".$preg->id]));
        }else{
        InsertaRespuestas($evaluado, $evaluador, $respuesta, $preg->id, $datos_para_respuesta[0], $datos_para_respuesta[1], $id_proceso_evaluacion, $datos_para_respuesta[3], $datos_para_respuesta[4], $datos_para_respuesta[5], $datos_criterio, utf8_decode($_POST["c".$evaluado."-".$preg->id]));
        }
        }
        }
        }
        $pagina_actual=SesionSGDSoloEvaluadorEvaluado($evaluador, $_SESSION["id_proceso"], $evaluado);
        if($pagina_actual){
        if($pagina_anterior>0){
        $pagina_siguiente=$pagina_actual[0]->pagina-1;
        }else{
        $pagina_siguiente=$pagina_actual[0]->pagina+1;
        }
        $perfiles=TotalPerfilesDadoEvaluador1PorEvaluado($evaluador, $evaluado, $id_proceso_evaluacion);
        $total_paginas=TotalCompetenciasPorPerfil($perfiles[0]->id_perfil_ev);
        if($datos_proceso[0]->tiene_especificos==1){
        if($pagina_siguiente>count($total_paginas)+1){
        //Comentado porue esta funcion ya se ejecuta arriba
        //$evaluados=EvaluadosDadoEvaluadorPorProceso($evaluador, $id_proceso_evaluacion);
        //InsertaEvaluadorFinalizado($evaluador, $id_proceso);
        //Aca ,por cada uno de los evaluados del evaluador, se inserta registro de finalizado evaluado evaluador
        //foreach($evaluados as $evaluad){
        //InsertaEvaluadoEvaluadorFinalizado($evaluado, $evaluador, $id_proceso_evaluacion);
        echo "<script>location.href='?sw=pregFinales&ip=".Encodear3($id_proceso_evaluacion)."&ie=".Encodear3($evaluado)."';</script>";
        exit;
        //}
        echo "<script>location.href='?sw=sgd2&ip=".Encodear3($id_proceso_evaluacion)."';</script>";
        exit;
        }else{
        ActualizoSesion($evaluado, $evaluador, $pagina_siguiente, $id_proceso_evaluacion);
        }
        }else{
        //echo "aca";
        //echo "pagina siguiente $pagina_siguiente totalpaginas ".$total_paginas[0];
        //echo "aca1";exit;
        if($pagina_siguiente>count($total_paginas)){
        //$evaluados=EvaluadosDadoEvaluadorPorProceso($evaluador, $id_proceso_evaluacion);
        //InsertaEvaluadorFinalizado($evaluador, $id_proceso);
        //Aca ,por cada uno de los evaluados del evaluador, se inserta registro de finalizado evaluado evaluador
        //foreach($evaluados as $evaluad){
        /**************/
        /** ]COMENTARE ESTE, PARA QUE ANTES DE FINALIZAR
        * SE VAYA A LA VISTA DE INGRESAR COMENTARIOS */
        //InsertaEvaluadoEvaluadorFinalizado($evaluado, $evaluador, $id_proceso_evaluacion);
        //}
        }
        //exit;
        if($pagina_siguiente>count($total_paginas)){
        //exit("2");
        //echo "<script>location.href='?sw=sgd2&ip=".Encodear3($id_proceso_evaluacion)."';</script>";
        //echo "<script>location.href='?sw=inf&ip=".Encodear3($id_proceso_evaluacion)."&ie=".Encodear3($evaluado)."';</script>";
        echo "<script>location.href='?sw=pregFinales&ip=".Encodear3($id_proceso_evaluacion)."&ie=".Encodear3($evaluado)."';</script>";
        exit;
        }else{
        ActualizoSesion($evaluado, $evaluador, $pagina_siguiente, $id_proceso_evaluacion);
        }
        }
        }else{
        $pagina_siguiente=2;
        InsertoSesion($evaluado, $evaluador, $pagina_siguiente, $id_proceso_evaluacion);
        }
        if($_GET["ae"]==1){
        echo "<script>
        location.href='?sw=evind&ie=".Encodear3($evaluado)."&p=".Encodear3($pagina_siguiente)."&ipr=".Encodear3($id_proceso)."&ae=1$#pag';
        </script>";
        exit;
        }else{
        echo "<script>
        location.href='?sw=evind&ie=".Encodear3($evaluado)."&p=".Encodear3($pagina_siguiente)."&ipr=".Encodear3($id_proceso)."$#pag';
        </script>";
        exit;
        }
        }
        else if($seccion=="svc"){
        $evaluador=$_SESSION["user_"];
        $id_competencia=$_POST["ic"];
        $id_pregunta=$_POST["ip"];
        $pagina_anterior=$_POST["back"];
        /*if(Decodear3($_GET["ipr"])){
        $id_proceso=Decodear3($_GET["ipr"]);
        }else{
        $id_proceso=$_SESSION["id_proceso"];
        }*/
        $id_proceso_evaluacion=$_SESSION["id_proceso"];
        $datos_proceso=TraeProcesosDeEvaluacionPorEmpresaYDiProceso($id_empresa, $id_proceso_evaluacion);
        //$evaluados=EvaluadosDadoEvaluadorPorProceso($evaluador, $id_proceso_evaluacion);
        $evaluados=EvaluadosDadoEvaluadorPorProcesoSinAe($evaluador, $id_proceso_evaluacion);
        foreach($evaluados as $eva){
        //esta validacion corresponde porque puede que no corresponda la pregunta, si pertenece
        //a otro perfil
        $corresponde_pregunta=EvaluadoParaEstaPregunta("", $id_pregunta, $eva->evaluado, $eva->perfil_evaluacion);
        if($corresponde_pregunta=="si"){
        //$tiene_respuesta=TieneRespuestaCompetencia($eva->evaluado, $evaluador, $id_pregunta);
        $tiene_respuesta=TieneRespuestaCompetenciaProProceso($eva->evaluado, $evaluador, $id_pregunta, $id_proceso_evaluacion);
        //$datos_para_respuesta=DevuelveDatosEval($eva->evaluado, $evaluador, $id_pregunta);
        $datos_para_respuesta=DevuelveDatosEvalPorProceso($eva->evaluado, $evaluador, $id_pregunta, $id_proceso_evaluacion);
        $datos_criterio=TransformaAlternativaAPuntaje($_POST[$eva->evaluado."-".$id_pregunta], $datos_para_respuesta[0], $id_empresa, $datos_para_respuesta[4]);
        if($_POST[$eva->evaluado."-".$id_pregunta]){
        //print_r($datos_criterio);exit;
        if($tiene_respuesta){
        ActualizaRespuestas($eva->evaluado, $evaluador, $_POST[$eva->evaluado."-".$id_pregunta], $id_pregunta, $datos_para_respuesta[0], $datos_para_respuesta[1], $id_proceso_evaluacion, $id_empresa, $datos_para_respuesta[4], $datos_para_respuesta[5], $datos_criterio, utf8_decode($_POST["c".$eva->evaluado."-".$id_pregunta]));
        }else{
        InsertaRespuestas($eva->evaluado, $evaluador, $_POST[$eva->evaluado."-".$id_pregunta], $id_pregunta, $datos_para_respuesta[0], $datos_para_respuesta[1], $id_proceso_evaluacion, $id_empresa, $datos_para_respuesta[4], $datos_para_respuesta[5], $datos_criterio, utf8_decode($_POST["c".$eva->evaluado."-".$id_pregunta]));
        }
        }
        }
        }
        $pagina_actual=SesionSGDSoloEvaluador($evaluador, $_SESSION["id_proceso"]);
        if($pagina_actual){
        if($pagina_anterior>0){
        $pagina_siguiente=$pagina_actual[0]->pagina-1;
        }else{
        $pagina_siguiente=$pagina_actual[0]->pagina+1;
        }
        $total_paginas=TotalComponentesPorEvaluador($evaluador);
        if($datos_proceso[0]->tiene_especificos==1){
        if($pagina_siguiente>$total_paginas[0]+1){
        if($_SESSION["id_empresa"]==66){
        echo "<script>location.href='?sw=pregFinalesPorEquipo&ip=".Encodear3($id_proceso_evaluacion)."&ie=".Encodear3($evaluado)."';</script>";
        exit;
        }else{
        //InsertaEvaluadorFinalizado($evaluador, $id_proceso);
        foreach($evaluados as $evaluad){
        InsertaEvaluadoEvaluadorFinalizado($evaluad->evaluado, $evaluador, $id_proceso_evaluacion);
        }
        echo "<script>location.href='?sw=vistaFinalizadoEvaluador';</script>";
        exit;
        }
        /*InsertaEvaluadorFinalizado($evaluador, $id_proceso);
        foreach($evaluados as $evaluad){
        InsertaEvaluadoEvaluadorFinalizado($evaluad->evaluado, $evaluador, $id_proceso_evaluacion);
        }
        *
        * */
        //echo "<script>location.href='?sw=sgd2';</script>";
        }else{
        ActualizoSesion("", $evaluador, $pagina_siguiente, $id_proceso_evaluacion);
        }
        }else{
        //echo "aca";
        //echo "pagina siguiente $pagina_siguiente totalpaginas ".$total_paginas[0];
        //echo "aca1";exit;
        if($pagina_siguiente>$total_paginas[0]){
        $evaluados=EvaluadosDadoEvaluadorPorProceso($evaluador, $id_proceso_evaluacion);
        InsertaEvaluadorFinalizado($evaluador, $id_proceso);
        //Aca ,por cada uno de los evaluados del evaluador, se inserta registro de finalizado evaluado evaluador
        foreach($evaluados as $evaluad){
        InsertaEvaluadoEvaluadorFinalizado($evaluad->evaluado, $evaluador, $id_proceso_evaluacion);
        }
        }
        //exit;
        if($pagina_siguiente>$total_paginas[0]){
        echo "<script>location.href='?sw=vistaFinalizadoEvaluador';</script>";
        exit;
        }else{
        ActualizoSesion("", $evaluador, $pagina_siguiente, $id_proceso_evaluacion);
        }
        }
        }else{
        $pagina_siguiente=2;
        InsertoSesion("", $evaluador, $pagina_siguiente, $id_proceso_evaluacion);
        }
        echo "<script>
        location.href='?sw=ev&p=".Encodear3($pagina_siguiente)."&ip=".Encodear3($id_proceso_evaluacion)."$#pag';
        </script>";
        exit;
        }
        else if($info){
        }
        else if($seccion=="savevj"){
        $id_programa=Decodear3($_POST["ip"]);
        $evaluado=Decodear3($_POST["ev"]);
        $evaluador=$_SESSION["user_"];
        $finalizado=$_POST["f"];
        $mejora=utf8_decode(trim($_POST["mejora"]));
        //Con el id del programa, obtengo las conductas
        $conductas=ObtenerConductasPorPrograma($id_programa);
        foreach($conductas as $cond){
        //Si existe, se actualiza, si no existe, se ingresa
        $tiene_respuesta=TieneRespuestasEvaluacionJefe($evaluado, $evaluador, $cond->id, $id_programa);
        if($tiene_respuesta){
        //Actualizo Registro
        ActualizaRespuestasEvaluacionJefe($evaluado, $evaluador, $cond->id, $id_programa, $_POST["preg".$cond->id], $_POST["sel".$cond->id]);
        }else{
        //Inserto Registro
        InsertaRegistroEvaluacionJefe($evaluado, $evaluador, $cond->id, $id_programa, $_POST["preg".$cond->id], $_POST["sel".$cond->id]);
        }
        }
        //Veo si tiene comentarios.
        $tiene_comentarios=TieneComentarioEvaluacionJefe($evaluado, $evaluador, $id_programa);
        if($tiene_comentarios){
        ActualizoComentarioEvaluacionJefatura($evaluado, $evaluador, $id_programa, $mejora);
        }else{
        InsertaComentarioEvaluacionJefe($evaluado, $evaluador, $id_programa, $mejora);
        }
        if($finalizado=="1"){
        //Inserto Evaluacion de Jefe Finalizado
        InsertarFinalizadoEvaluacionJefatura($evaluado, $evaluador, $id_programa);
        echo "<script>
        location.href='?sw=informeEvalJ&ie=".Encodear3($evaluado)."&i=".Encodear3($id_programa)."';
        </script>";
        exit;
        }
        echo "<script>
        location.href='?sw=evJef&ie=".Encodear3($evaluado)."&i=".Encodear3($id_programa)."';
        </script>";
        exit;
        }
        else if($seccion=="noticiasBK"){
        $PRINCIPAL=ListadoNoticias(FuncionesTransversales(file_get_contents("views/noticias/index.html")));
        echo $PRINCIPAL;
        }
        else if($seccion=="ReportEncSa"){
        $id_encuesta=Decodear3($_GET["iden"]);
        $id_objeto=Decodear3($_GET["i"]);
        $id_curso=Decodear3($_GET["idc"]);
        $datos_objeto=DatosObjeto($id_objeto);
        $id_curso=$datos_objeto[0]->id_curso;
        //echo "id encuesta $id_encuesta id objeto $id_objeto id curso $id_curso";
        $PRINCIPAL=ColocaDatosPerfil(FuncionesTransversales(file_get_contents("views/encuesta.html")), $rut);
        if($id_empresa==62){
        //echo "id_empresa $id_empresa";
        $PRINCIPAL=ColocaDatosPerfil(FuncionesTransversales(file_get_contents("views/encuesta/62_homeEncuesta.html")), $rut);
        $datos_usuario=UsuarioEnBasePersonas($_SESSION["user_"]);
        $PRINCIPAL = str_replace("{NOMBRE_USUARIO}",utf8_encode($datos_usuario[0]->nombre_completo),$PRINCIPAL);
        $PRINCIPAL = str_replace("{CODIGO_CURSO_ENCODEADO}",Encodear3($id_curso),$PRINCIPAL);
        }
        $PRINCIPAL=BloqueFooterContenido($PRINCIPAL);
        $PRINCIPAL=BarraNavegacion($PRINCIPAL, $seccion);
        $PRINCIPAL=ColocaMenuSecundario($PRINCIPAL, $_SESSION["id_empresa"]);
        if($datos_objeto[0]->checkin==1){
        $PRINCIPAL=MuestraInformeEnc($PRINCIPAL, $id_encuesta, $id_empresa, $id_objeto, $id_curso);
        }else{
        //$PRINCIPAL=MuestraInformeEnc($PRINCIPAL, $id_encuesta, $id_empresa, $id_objeto, $id_curso);
        $PRINCIPAL=MuestraInformeSoloMensaje($PRINCIPAL, $id_empresa, $id_encuesta, $id_objeto, $id_curso);
        }
        echo $PRINCIPAL;
        }
        else if($seccion=="homeEncuesta"){
        $hl=$_GET["hl"];
        if($hl==1){
        session_start();
        $_SESSION["user_"]=Decodear3($_GET["r"]);
        $_SESSION["id_empresa"]=62;
        }
        $id_objeto=Decodear3($_GET["i"]);
        $id_empresa=$_SESSION["id_empresa"];
        $id_inscripcion=Decodear3($_GET["ii"]);
        $id_encuesta=Decodear3($_GET["ienc"]);
        $rut=$_SESSION["user_"];
        $id_curso=Decodear3($_GET["idc"]);
        $id_inscripcion=($_GET["id_mp"]);
        $datos_objeto=DatosObjeto($id_objeto);
        if($id_empresa==62){
        $ArrayObjeto=DatosInscripcionEncuestaObjeto($id_inscripcion, $id_empresa);
        $id_objeto=$ArrayObjeto[0]->id_objeto;
        $id_encuesta=$ArrayObjeto[0]->id_encuesta;
        if(count($ArrayObjeto)==0){
        $id_objeto=$id_objeto=Decodear3($_GET["i"]);
        $datos_objeto=DatosObjeto($id_objeto);
        $id_encuesta=$datos_objeto[0]->id_encuesta;
        }
        }else{
        $id_encuesta=$datos_objeto[0]->id_encuesta;
        }
        //echo "<br>id_objeto $id_objeto, id_encuesta $id_encuesta";
        //$id_encuesta=$datos_objeto[0]->id_encuesta;
        if($id_empresa==19){
        $id_encuesta=Decodear3($_GET["ienc"]);
        }
        //$usuario_en_curso=CI_verificausuariocurso($rut,$id_curso, $id_empresa);
        $usuario_en_curso=CI_verificausuariocurso($rut,$id_inscripcion, $id_empresa);
        //print_r($usuario_en_curso);
        if($usuario_en_curso[0]->relator==1){
        echo "<script>location.href='?sw=ReportEncSa&iden=".Encodear3($id_encuesta)."&i=".Encodear3($id_objeto)."&idc=".Encodear3($id_curso)."';</script>";
        exit;
        }
        //echo "12025 $id_objeto $id_empresa $rut $id_encuesta";
        if($id_objeto){
        $objeto_finalizado=ObjetoFinalizadoDadoIdYRut($rut, $id_objeto);
        if($objeto_finalizado){
        echo "<script>location.href='?sw=ReportEncSa&iden=".Encodear3($id_encuesta)."&i=".Encodear3($id_objeto)."&idc=".Encodear3($id_curso)."';</script>";
        exit;
        $PRINCIPAL=ColocaDatosPerfil(FuncionesTransversales(file_get_contents("views/encuesta.html")), $rut);
        if($id_empresa==62){
        echo "<script>location.href='?sw=ReportEncSa&iden=".Encodear3($id_encuesta)."&i=".Encodear3($id_objeto)."&idc=".Encodear3($id_curso)."';</script>";
        exit;
        //$PRINCIPAL = str_replace("{BLOQUE_ENCUESTA}",FuncionesTransversales(file_get_contents("views/encuesta/62_template_enc_sat_fin_generico.html")),$PRINCIPAL);
        }else{
        $PRINCIPAL = str_replace("{BLOQUE_ENCUESTA}",FuncionesTransversales(file_get_contents("views/encuesta/template_enc_sat_fin_generico.html")),$PRINCIPAL);
        }
        $PRINCIPAL=BloqueFooterContenido($PRINCIPAL);
        $PRINCIPAL=BarraNavegacion($PRINCIPAL, $seccion);
        $PRINCIPAL=ColocaMenuSecundario($PRINCIPAL, $_SESSION["id_empresa"]);
        $PRINCIPAL=colocarReconocimientosPorRut($PRINCIPAL, $_SESSION["id_empresa"], $rut);
        $PRINCIPAL=colocarColaboradoresPorRut($PRINCIPAL, $_SESSION["id_empresa"], $rut);
        $datos_encuesta=ObtenerEncuestaDadaEmpresa($id_empresa);
        $PRINCIPAL = str_replace("{TITULO}",utf8_encode($datos_encuesta[0]->titulo),$PRINCIPAL);
        echo $PRINCIPAL;exit;
        }
        }
        if(!$id_inscripcion){
        if($_POST["ii"]){
        $id_inscripcion=Decodear3($_POST["ii"]);
        }
        }
        //Traigo la encuesta, por mientras solo veré la primera
        //verifico si tiene sesion.
        //Lo mismo que hice para mostrar las encuestas en la funcion
        //Si viene dato de Objeto, busco sesion, en tabla con variables
        //objeto, empresa, rut
        //si no viene con valor de objeto
        //Busco con valor empresa, rut y objeto null
        if($id_objeto){
        $tiene_session=EncTieneSesionPorObjeto($rut, $id_empresa, $id_objeto);
        }else if($id_encuesta){
        $tiene_session=EncTieneSesionPorEncuesta($rut, $id_empresa, $id_encuesta, $id_objeto);
        }else{
        $tiene_session=EncTieneSesion($rut, $id_empresa);
        }
        //print_r($tiene_session);
        //echo "<br>rut $rut, id_inscripcion $id_inscripcion";
        //if(!$pagina){
        if(!$tiene_session){
        $pagina=1;
        EncInsertaRegistroSesion($rut, $id_empresa, $pagina, $id_inscripcion, $id_objeto, $id_encuesta);
        //echo "hola";
        }else{
        $pagina=$tiene_session[0]->pagina;
        //echo "chau";
        }
        //if($id_empresa=="38"){
        if($id_empresa==62){
        //echo "id_empresa $id_empresa";
        $PRINCIPAL=ColocaDatosPerfil(FuncionesTransversales(file_get_contents("views/encuesta/62_homeEncuesta.html")), $rut);
        $datos_usuario=UsuarioEnBasePersonas($_SESSION["user_"]);
        $PRINCIPAL = str_replace("{NOMBRE_USUARIO}",utf8_encode($datos_usuario[0]->nombre_completo),$PRINCIPAL);
        $PRINCIPAL = str_replace("{CODIGO_CURSO_ENCODEADO}",Encodear3($datos_objeto[0]->id_curso),$PRINCIPAL);
        }
        if($id_empresa==19){
        //echo "id_empresa $id_empresa";
        $PRINCIPAL=ColocaDatosPerfil(FuncionesTransversales(file_get_contents("views/encuesta/62_homeEncuesta.html")), $rut);
        $datos_usuario=UsuarioEnBasePersonas($_SESSION["user_"]);
        $PRINCIPAL = str_replace("{NOMBRE_USUARIO}",utf8_encode($datos_usuario[0]->nombre_completo),$PRINCIPAL);
        $PRINCIPAL = str_replace("{CODIGO_CURSO_ENCODEADO}",Encodear3($datos_objeto[0]->id_curso),$PRINCIPAL);
        }
        else if($id_empresa==63){
        $PRINCIPAL=ColocaDatosPerfil(FuncionesTransversales(file_get_contents("views/cursos/contenidos/63_detalle_contenidoDesafios.html")), $rut);
        $datos_usuario=UsuarioEnBasePersonas($_SESSION["user_"]);
        $PRINCIPAL = str_replace("{NOMBRE_USUARIO}",utf8_encode($datos_usuario[0]->nombre_completo),$PRINCIPAL);
        $PRINCIPAL = str_replace("{URL_VOLVER_CHECKIN}",utf8_encode($datos_objeto[0]->url_volver_checkin),$PRINCIPAL);
        $PRINCIPAL = str_replace("{CODIGO_CURSO_ENCODEADO}",Encodear3($datos_objeto[0]->id_curso),$PRINCIPAL);
        $PRINCIPAL = str_replace("{BOTON_FINALIZAR}",file_get_contents("views/cursos/contenidos/boton_finaliza_curso.html"),$PRINCIPAL);
        $PRINCIPAL = str_replace("{BOTON_VOLVER}",file_get_contents("views/cursos/contenidos/CAP_boton_volver_curso.html"),$PRINCIPAL);
        $PRINCIPAL = str_replace("{ID_CURSO_ENCODEADO_VOLVER}",Encodear3($datos_objeto[0]->id_curso),$PRINCIPAL);
        $PRINCIPAL = str_replace("{ENVBOTON}","backcont",$PRINCIPAL);
        } else if($id_empresa==59){
        $PRINCIPAL=ColocaDatosPerfil(FuncionesTransversales(file_get_contents("views/cursos/contenidos/59_detalle_contenidoDesafios.html")), $rut);
        $datos_usuario=UsuarioEnBasePersonas($_SESSION["user_"]);
        $PRINCIPAL = str_replace("{NOMBRE_USUARIO}",utf8_encode($datos_usuario[0]->nombre_completo),$PRINCIPAL);
        $PRINCIPAL = str_replace("{URL_VOLVER_CHECKIN}",utf8_encode($datos_objeto[0]->url_volver_checkin),$PRINCIPAL);
        $PRINCIPAL = str_replace("{CODIGO_CURSO_ENCODEADO}",Encodear3($datos_objeto[0]->id_curso),$PRINCIPAL);
        $PRINCIPAL = str_replace("{BOTON_FINALIZAR}",file_get_contents("views/cursos/contenidos/boton_finaliza_curso.html"),$PRINCIPAL);
        $PRINCIPAL = str_replace("{BOTON_VOLVER}",file_get_contents("views/cursos/contenidos/CAP_boton_volver_curso.html"),$PRINCIPAL);
        $PRINCIPAL = str_replace("{ID_CURSO_ENCODEADO_VOLVER}",Encodear3($datos_objeto[0]->id_curso),$PRINCIPAL);
        $PRINCIPAL = str_replace("{ENVBOTON}","backcont",$PRINCIPAL);
        } else if($id_empresa==69){
        $PRINCIPAL=ColocaDatosPerfil(FuncionesTransversales(file_get_contents("views/cursos/contenidos/69_detalle_contenidoDesafios.html")), $rut);
        $datos_usuario=UsuarioEnBasePersonas($_SESSION["user_"]);
        $PRINCIPAL = str_replace("{NOMBRE_USUARIO}",utf8_encode($datos_usuario[0]->nombre_completo),$PRINCIPAL);
        $PRINCIPAL = str_replace("{URL_VOLVER_CHECKIN}",utf8_encode($datos_objeto[0]->url_volver_checkin),$PRINCIPAL);
        $PRINCIPAL = str_replace("{CODIGO_CURSO_ENCODEADO}",Encodear3($datos_objeto[0]->id_curso),$PRINCIPAL);
        $PRINCIPAL = str_replace("{BOTON_FINALIZAR}",file_get_contents("views/cursos/contenidos/boton_finaliza_curso.html"),$PRINCIPAL);
        $PRINCIPAL = str_replace("{BOTON_VOLVER}",file_get_contents("views/cursos/contenidos/CAP_boton_volver_curso.html"),$PRINCIPAL);
        $PRINCIPAL = str_replace("{ID_CURSO_ENCODEADO_VOLVER}",Encodear3($datos_objeto[0]->id_curso),$PRINCIPAL);
        $PRINCIPAL = str_replace("{ENVBOTON}","backcont",$PRINCIPAL);
        }
        else if($id_empresa==70){
        $PRINCIPAL=ColocaDatosPerfil(FuncionesTransversales(file_get_contents("views/cursos/contenidos/70_detalle_contenidoDesafios.html")), $rut);
        $datos_usuario=UsuarioEnBasePersonas($_SESSION["user_"]);
        $PRINCIPAL = str_replace("{NOMBRE_USUARIO}",utf8_encode($datos_usuario[0]->nombre_completo),$PRINCIPAL);
        $PRINCIPAL = str_replace("{URL_VOLVER_CHECKIN}",utf8_encode($datos_objeto[0]->url_volver_checkin),$PRINCIPAL);
        $PRINCIPAL = str_replace("{CODIGO_CURSO_ENCODEADO}",Encodear3($datos_objeto[0]->id_curso),$PRINCIPAL);
        $PRINCIPAL = str_replace("{BOTON_FINALIZAR}",file_get_contents("views/cursos/contenidos/boton_finaliza_curso.html"),$PRINCIPAL);
        $PRINCIPAL = str_replace("{BOTON_VOLVER}",file_get_contents("views/cursos/contenidos/CAP_boton_volver_curso.html"),$PRINCIPAL);
        $PRINCIPAL = str_replace("{ID_CURSO_ENCODEADO_VOLVER}",Encodear3($datos_objeto[0]->id_curso),$PRINCIPAL);
        $PRINCIPAL = str_replace("{ENVBOTON}","backcont",$PRINCIPAL);
        }
        else{
        $PRINCIPAL=ColocaDatosPerfil(FuncionesTransversales(file_get_contents("views/encuesta.html")), $rut);
        }
        /*$PRINCIPAL=ColocaDatosPerfil(FuncionesTransversales(file_get_contents("views/encuesta/".$id_empresa."_homeEncuesta.html")), $rut);
        $datos_usuario=UsuarioEnBasePersonas($_SESSION["user_"]);
        $PRINCIPAL = str_replace("{NOMBRE_USUARIO}",utf8_encode($datos_usuario[0]->nombre_completo),$PRINCIPAL);
        */
        if($id_empresa==62 ){
        $PRINCIPAL = str_replace("{BLOQUE_ENCUESTA}",ColocarDatosEncuesta($rut, $pagina, $id_empresa, $id_inscripcion,"2", $id_objeto, $id_encuesta),$PRINCIPAL);
        }else if($id_empresa==61 ){
        $PRINCIPAL = str_replace("{BLOQUE_ENCUESTA}",ColocarDatosEncuesta($rut, $pagina, $id_empresa, $id_inscripcion,"2", $id_objeto, $id_encuesta),$PRINCIPAL);
        }else if($id_empresa==19 ){
        $PRINCIPAL = str_replace("{BLOQUE_ENCUESTA}",ColocarDatosEncuesta($rut, $pagina, $id_empresa, $id_inscripcion,"2", $id_objeto, $id_encuesta),$PRINCIPAL);
        }else{
        $PRINCIPAL = str_replace("{BLOQUE_OBJETO}",ColocarDatosEncuesta($rut, $pagina, $id_empresa, $id_inscripcion,"2", $id_objeto, $id_encuesta),$PRINCIPAL);
        }
        $PRINCIPAL = str_replace("{ID_OBJETO_ENCODEADO}",Encodear3($id_objeto),$PRINCIPAL);
        $PRINCIPAL=BloqueFooterContenido($PRINCIPAL);
        $PRINCIPAL=BarraNavegacion($PRINCIPAL, $seccion);
        $PRINCIPAL=ColocaMenuSecundario($PRINCIPAL, $_SESSION["id_empresa"]);
        $PRINCIPAL=colocarReconocimientosPorRut($PRINCIPAL, $_SESSION["id_empresa"], $rut);
        $PRINCIPAL=colocarColaboradoresPorRut($PRINCIPAL, $_SESSION["id_empresa"], $rut);
        //}else{
        //        $PRINCIPAL=ColocarDatosEncuesta($pagina, $id_empresa, $id_inscripcion);
        //    }
        //EncActualizaRegistroSesion($rut, $id_empresa, $pagina+1);
        echo $PRINCIPAL;
        }
        else if($seccion=="EncSatFin"){
        $rut=$_SESSION["user_"];
        $id_empresa=$_SESSION["id_empresa"];
        $datos_encuesta=ObtenerEncuestaDadaEmpresa($id_empresa);
        $id_encuesta=Decodear3($_GET["iden"]);
        $id_objeto=Decodear3($_GET["i"]);
        $id_curso=Decodear3($_GET["idc"]);
        //print_r($_GET);
        $datos_encuesta=DDatosEncSatis($id_encuesta);
        //echo "$id_encuesta $id_objeto $id_curso";
        //if($id_empresa=="38"){
        if($id_empresa==62){
        //$PRINCIPAL=ColocaDatosPerfil(FuncionesTransversales(file_get_contents("views/encuesta/62_homeEncuesta.html")), $rut);
        //$datos_usuario=UsuarioEnBasePersonas($_SESSION["user_"]);
        //$PRINCIPAL = str_replace("{NOMBRE_USUARIO}",utf8_encode($datos_usuario[0]->nombre_completo),$PRINCIPAL);
        //echo "hola";exit;
        echo "<script>location.href='?sw=ReportEncSa&iden=".Encodear3($id_encuesta)."&i=".Encodear3($id_objeto)."&idc=".Encodear3($id_curso)."';</script>";
        exit;
        }else{
        $PRINCIPAL=ColocaDatosPerfil(FuncionesTransversales(file_get_contents("views/encuesta.html")), $rut);
        }
        //$PRINCIPAL=ColocaDatosPerfil(FuncionesTransversales(file_get_contents("views/encuesta.html")), $rut);
        //$PRINCIPAL = str_replace("{BLOQUE_ENCUESTA}",FuncionesTransversales(file_get_contents("views/encuesta/template_enc_sat_fin_generico.html")),$PRINCIPAL);
        $PRINCIPAL = str_replace("{BLOQUE_ENCUESTA}",FuncionesTransversales(file_get_contents("views/encuesta/".$id_empresa."_template_enc_mensaje_final.html")),$PRINCIPAL);
        $PRINCIPAL = str_replace("{ID_CURSO_ENCODEADO}",Encodear3($id_curso),$PRINCIPAL);
        $PRINCIPAL=BloqueFooterContenido($PRINCIPAL);
        $PRINCIPAL=BarraNavegacion($PRINCIPAL, $seccion);
        $PRINCIPAL=ColocaMenuSecundario($PRINCIPAL, $_SESSION["id_empresa"]);
        $PRINCIPAL=colocarReconocimientosPorRut($PRINCIPAL, $_SESSION["id_empresa"], $rut);
        $PRINCIPAL=colocarColaboradoresPorRut($PRINCIPAL, $_SESSION["id_empresa"], $rut);
        $PRINCIPAL = str_replace("{TITULO}",utf8_encode($datos_encuesta[0]->titulo),$PRINCIPAL);
        //}else{
        //    $PRINCIPAL=FuncionesTransversales(file_get_contents("views/encuesta/template_enc_sat_fin.html"));
        //        $PRINCIPAL = str_replace("{IMAGEHEADER}",$datos_encuesta[0]->imagenheader,$PRINCIPAL);
        //    $PRINCIPAL = str_replace("{TITULO}",utf8_encode($datos_encuesta[0]->titulo),$PRINCIPAL);
        //}
        echo $PRINCIPAL;
        //unset($_SESSION);
        //session_start(); $_SESSION = array(); if (isset($_COOKIE[session_name()])) {    setcookie(session_name(), '', time()-42000, '/'); } session_destroy();
        }
    else if ($seccion == "autocompletarNombreCargo") {
        $id_empresa = $_SESSION["id_empresa"];
        $buscar = utf8_decode($_GET["q"]);
        $allData = allPersonasPorNombreCargoPorEmpresa($buscar, $id_empresa);
        // $allData = allPersonasPorNombre($buscar);
        echo $allData;
    }
    else if ($seccion == "autocompletarNombresinDivPersonas") {
        $id_empresa = $_SESSION["id_empresa"];
        $buscar = utf8_decode($_GET["q"]);
        $allData = allPersonasPorNombreCargoPorEmpresaSinDivPersonas($buscar, $id_empresa);
        // $allData = allPersonasPorNombre($buscar);
        echo $allData;
    }
    else if ($seccion == "autocompletarCuiconNombre") {
        $id_empresa = $_SESSION["id_empresa"];
        $buscar = utf8_decode($_GET["q"]);
        $allData = allCuiPorNombreOficina($buscar, $id_empresa);
        //print_r($allData);
        // $allData = allPersonasPorNombre($buscar);
        echo $allData;
    }
    else if ($seccion == "autocompletarNombresinDivPersonasJefe") {
        $id_empresa = $_SESSION["id_empresa"];
        $buscar = utf8_decode($_GET["q"]);
        $allData = allPersonasPorNombreCargoPorEmpresaSinDivPersonasJefe($buscar, $id_empresa);
        // $allData = allPersonasPorNombre($buscar);
        echo $allData;
    }
    else if ($seccion == "ColocaResponsablesPorDpto") {
        $id_empresa = $_SESSION["id_empresa"];
        $codigo_departamento = $usuarios = UsuarioPorDepartamento($id_empresa, $_POST["departamento_responsable"]);
        echo "<option value=''>-[Seleccione]-</option>";
        foreach($usuarios as $usu) {
            echo "<option value='" . $usu->rut . "'>" . $usu->nombre_completo . "</option>";
        }
    }
    else if ($seccion == "autocompletarNombreCui") {
        $id_empresa = $_SESSION["id_empresa"];
        $buscar = utf8_decode($_GET["q"]);
        $allData = allCuiPorEmpresa($buscar, $id_empresa);
        // $allData = allPersonasPorNombre($buscar);
        echo $allData;
    }
    else if ($seccion == "autocompletarDealer") {
        $id_empresa = $_SESSION["id_empresa"];
        $buscar = utf8_decode($_GET["q"]);
        $allData = allPersonasPorDealer($buscar, $id_empresa);
        // $allData = allPersonasPorNombre($buscar);
        echo $allData;
    }
    else if ($seccion == "autocompletarNombreTNT") {
        $id_empresa = $_SESSION["id_empresa"];
        $buscar = utf8_decode($_GET["q"]);
        $allData = allPersonasPorNombrePorEmpresa($buscar, $id_empresa);
        // $allData = allPersonasPorNombre($buscar);
        echo $allData;
    }
    else if ($seccion == "autocompletarNombreMP") {
        $id_empresa = $_SESSION["id_empresa"];
        $buscar = utf8_decode($_GET["q"]);
        $allData = allPersonasPorNombrePorEmpresaMP($buscar, $id_empresa);
        // $allData = allPersonasPorNombre($buscar);
        echo $allData;
    }
    else if ($seccion == "autocompletarBiblioteca") {
        $id_empresa = $_SESSION["id_empresa"];
        $buscar = utf8_decode($_GET["q"]);
        $allData = allArchivosBibliotecaPorEmpresaMP($buscar, $id_empresa);
        // $allData = allPersonasPorNombre($buscar);
        echo $allData;
    }
    else if ($seccion == "autocompletarNombreMP_GOPLAY") {
        $id_empresa = $_SESSION["id_empresa"];
        $buscar = utf8_decode($_GET["q"]);
        $allData = allPersonasPorNombrePorEmpresaMP_GOPLAY($buscar, $id_empresa);
        // $allData = allPersonasPorNombre($buscar);
        echo $allData;
    }
    else if ($seccion == "autocompletarNombreMP2") {
        $rut = $_SESSION["user_"];
        $buscar = utf8_decode($_GET["q"]);
        $allData = allPersonasPorNombrePorEmpresaGenerico($buscar, $id_empresa, $rut);
        echo $allData;
        // echo "<option> OK OK OK </option>";
    }
    else if ($seccion == "autocompletarNombre") {
        $rut = $_SESSION["user_"];
        $buscar = utf8_decode($_GET["q"]);
        // $allData = allPersonasPorNombre($buscar);
        $allData = allPersonasPorNombrePorEmpresa($buscar, $id_empresa, $rut);
        echo $allData;
    }
  
    else {
        session_start();
        $_SESSION = array();
        if (isset($_COOKIE[session_name() ])) {
            setcookie(session_name() , '', time() - 42000, '/');
        }
        session_destroy();
        // echo "<br />hola";
        $PRINCIPAL = FuncionesTransversales(file_get_contents("" . $url_front . "/front/views/home/login.html"));
        $token_fecha_hora = Encodear3(date("Y-m-d") . " " . date("H:i:s"));
        $PRINCIPAL = str_replace("{TOKEN_FECHA_HORA}", $token_fecha_hora, $PRINCIPAL);
        session_start();
        $_SESSION["token"] = $token_fecha_hora;
        echo $PRINCIPAL;
    }
?>