<?php
function Potencial_DataBciPosicionVsPropuestosR2(){
				global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);   $fecha = date("Y-m-d");
	
						$sql= "
						select h.d15, h.d151, 
						h.d31, h.d33, h.d35,
						(select id FROM tbl_potencial_sucesion_colaboradores_propuestos_r2 where posicion=h.d151 limit 1) as ExistePropuesto
						from tbl_data_bci_2021 h

						where (h.d153='R1' or h.d153='R2' or h.d153='R3')
						and (select id FROM tbl_potencial_sucesion_colaboradores_propuestos_r2 where posicion=h.d151 limit 1) is NULL
						and (h.d151 not like '%secretaria%')
						and (h.d151 not like '%chofer%')
						and (h.d151 not like '%mayordomo%')
						group by h.d151
						order by h.d151						
						";	
						
	      $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();
        return ($cod);	
}
function Potencial_tbl_tbl_potencial_clima_2020($rut){
				global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);   $fecha = date("Y-m-d");
				$sql=" 	select h.* from tbl_potencial_clima_2020 h where h.rut='$rut' ";
        $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();
        return ($cod);	
}
function Potencial_tbl_tbl_potencial_clima_2021($rut){
				global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);   $fecha = date("Y-m-d");
				$sql=" 	select h.* from tbl_potencial_clima_2021 h where h.rut='$rut' ";
        $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();
        return ($cod);	
}
function potencial_csv_acciones_desarrollo_api_data(){
				global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);   $fecha = date("Y-m-d");
				$sql="  select h.rut, h.plan, h.fundamento, h.estado, h.periodo, h.rut_creador as rut_creador from tbl_potencial_sucesion_acciones_desarrollo h order by h.periodo DESC";
        $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();
        return ($cod);			
}

function potencial_csv_ultimo_cuadrante_api_data(){
				global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);   $fecha = date("Y-m-d");
				$sql=" 	
						select rut, IF(cuadrante_2020='10','5+',cuadrante_2020) as cuadrante, fecha_cuadrante_2020 as fecha_cuadrante, periodo from tbl_potencial_cuadrantes_api
				";
				//echo $sql; exit();
        $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();
        return ($cod);	
}

function Potencial_PreguntasRespuesta(){

				global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);   $fecha = date("Y-m-d");

				$sql=" 	select h.* 
				 				from tbl_potencial_pregunta_respuesta h  
				 				";
     
        $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();
        return ($cod);		
	
}
function ControlDotacionInsertaAccesoLogin($rut, $email, $arreglo, $response_email, $key, $sesion, $token){
 		global $c_host, $c_user, $c_pass, $c_db;
		$database = new database($c_host, $c_user, $c_pass);   
    
		$fecha=date("Y-m-d");
		$hora  = date("H:i:s");	
		
		 

		$sql = "	INSERT INTO tbl_acceso_log_potencial (rut, fecha, hora, email, arreglo, response_email, key_data, sesion, token, ip) 
 						VALUES ('$rut', '$fecha', '$hora', '$email', '".json_encode($arreglo)."','".$response_email."', '".$key."', '".json_encode($sesion)."', '$token', '".$_SERVER['REMOTE_ADDR']."')";	
 						
  	$database->setquery($sql);
   	$database->query(); 			
}

function Potencial_BuscaDesempeno_2020($rut_col){
	
				global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);   $fecha = date("Y-m-d");

				$sql=" 	select h.* 
				 				from tbl_potencial_metas_desempeno_2020 h  
				 				where rut='$rut_col'";
     
        $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();
        return ($cod);			
	
}

function sucesion_csv_informes_data_1(){
	
				global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);   $fecha = date("Y-m-d");

				$sql=" 	

select h.*, 
(SELECT d31 FROM tbl_data_bci_2021 WHERE d151 = h.posicion  limit 1) as  GerenciaCargoasuceder,
(SELECT d33 FROM tbl_data_bci_2021 WHERE d151 = h.posicion  limit 1) as  FondoCargoasuceder,
(SELECT d35 FROM tbl_data_bci_2021 WHERE d151 = h.posicion  limit 1) as  DependenciaCargoasuceder,
h.posicion as Cargoasuceder,

(SELECT d1 FROM tbl_data_bci_2021 WHERE d151 = h.posicion  limit 1) as  Rutocupanteactualdelcargo,
(SELECT d7 FROM tbl_data_bci_2021 WHERE d151 = h.posicion limit 1 ) as  Nombreocupanteactualdelcargo,
(SELECT d8 FROM tbl_data_bci_2021 WHERE d151 = h.posicion  limit 1) as  Apellidoocupanteactualdelcargo,
(SELECT d9 FROM tbl_data_bci_2021 WHERE d151 = h.posicion  limit 1) as  ApellidoMocupanteactualdelcargo,
(SELECT d153 FROM tbl_data_bci_2021 WHERE d151 = h.posicion  limit 1) as  nivelRocupanteactualdelcargo,

Concat((SELECT d7 FROM tbl_data_bci_2021 WHERE d151 = h.posicion  limit 1),' ',(SELECT d8 FROM tbl_data_bci_2021 WHERE d151 = h.posicion  limit 1),' ',(SELECT d9 FROM tbl_data_bci_2021 WHERE d151 = h.posicion  limit 1)) as NombrecompletoOcupanteacutaldelcargo, 
h.tipo_sucesion as Temporalidad,
(SELECT d1 FROM tbl_data_bci_2021 WHERE rut = h.rut_col ) as  RutSucesor,
Concat((SELECT d7 FROM tbl_data_bci_2021 WHERE rut = h.rut_col ),' ',(SELECT d8 FROM tbl_data_bci_2021 WHERE rut = h.rut_col ),' ',(SELECT d9 FROM tbl_data_bci_2021 WHERE rut = h.rut_col )) as NombreCompletoSucesor, 
(select fecha_comite from tbl_potencial_comites_sucesion  where id_comite=h.id_comite and id_empresa='62') as FechaComite,
(SELECT d31 FROM tbl_data_bci_2021 WHERE rut = h.rut_col ) as  GerenciaSucesor,
(SELECT d33 FROM tbl_data_bci_2021 WHERE rut = h.rut_col) as  FondoSucesor,
(SELECT d35 FROM tbl_data_bci_2021 WHERE rut = h.rut_col ) as  DependenciaSucesor,

(select cuadrante from tbl_potencial_cuadrantes_api_full where rut=h.rut_col) as CuadranteactualSucesor,
(select fecha from tbl_potencial_cuadrantes_api_full where rut=h.rut_col) as FechacomitecuadranteactualSucesor,

'' as Tipodemovimiento,


(select nombre from tbl_potencial_comites_sucesion  where id_comite=h.id_comite and id_empresa='62') as nombre_comite,
(select gerenciaR1 from tbl_potencial_comites_sucesion  where id_comite=h.id_comite and id_empresa='62') as rut_a_suceder,
(select comite_cerrado from tbl_potencial_comites_sucesion  where id_comite=h.id_comite and id_empresa='62') as comite_cerrado

 from tbl_potencial_sucesion_colaboradores_propuestos_r2 h where id_empresa='62' and id_comite is not null				
 and (SELECT d1 FROM tbl_data_bci_2021 WHERE rut = h.rut_col )<>''
 and (select nombre from tbl_potencial_comites_sucesion  where id_comite=h.id_comite and id_empresa='62') is not null
 and (SELECT d1 FROM tbl_data_bci_2021 WHERE d151 = h.posicion  limit 1) <>''		
				";
     
        $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();
        return ($cod);		
	
}


function sucesion_csv_informes_data_2(){
	
				global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);   $fecha = date("Y-m-d");

				$sql=" 	

select h.*, 
(SELECT d31 FROM tbl_data_bci_2021 WHERE d151 = h.posicion  limit 1) as  GerenciaCargoasuceder,
(SELECT d33 FROM tbl_data_bci_2021 WHERE d151 = h.posicion  limit 1) as  FondoCargoasuceder,
(SELECT d35 FROM tbl_data_bci_2021 WHERE d151 = h.posicion  limit 1) as  DependenciaCargoasuceder,
h.posicion as Cargoasuceder,

(SELECT d1 FROM tbl_data_bci_2021 WHERE d151 = h.posicion  limit 1) as  Rutocupanteactualdelcargo,
(SELECT d7 FROM tbl_data_bci_2021 WHERE d151 = h.posicion  limit 1) as  Nombreocupanteactualdelcargo,
(SELECT d8 FROM tbl_data_bci_2021 WHERE d151 = h.posicion  limit 1) as  Apellidoocupanteactualdelcargo,
(SELECT d9 FROM tbl_data_bci_2021 WHERE d151 = h.posicion  limit 1) as  ApellidoMocupanteactualdelcargo,

Concat((SELECT d7 FROM tbl_data_bci_2021 WHERE d151 = h.posicion  limit 1),' ',(SELECT d8 FROM tbl_data_bci_2021 WHERE d151 = h.posicion  limit 1),' ',(SELECT d9 FROM tbl_data_bci_2021 WHERE d151 = h.posicion  limit 1)) as NombrecompletoOcupanteacutaldelcargo, 
h.tipo_sucesion as Temporalidad,
(SELECT d1 FROM tbl_data_bci_2021 WHERE rut = h.rut_col ) as  RutSucesor,
Concat((SELECT d7 FROM tbl_data_bci_2021 WHERE rut = h.rut_col ),' ',(SELECT d8 FROM tbl_data_bci_2021 WHERE rut = h.rut_col ),' ',(SELECT d9 FROM tbl_data_bci_2021 WHERE rut = h.rut_col )) as NombreCompletoSucesor, 
(select fecha_comite from tbl_potencial_comites_sucesion  where id_comite=h.id_comite and id_empresa='62') as FechaComite,
(SELECT d31 FROM tbl_data_bci_2021 WHERE rut = h.rut_col ) as  GerenciaSucesor,
(SELECT d33 FROM tbl_data_bci_2021 WHERE rut = h.rut_col) as  FondoSucesor,
(SELECT d35 FROM tbl_data_bci_2021 WHERE rut = h.rut_col ) as  DependenciaSucesor,

(select cuadrante from tbl_potencial_cuadrantes_api_full where rut=h.rut_col) as CuadranteactualSucesor,
(select fecha from tbl_potencial_cuadrantes_api_full where rut=h.rut_col) as FechacomitecuadranteactualSucesor,

'' as Tipodemovimiento,


(select nombre from tbl_potencial_comites_sucesion  where id_comite=h.id_comite and id_empresa='62') as nombre_comite,
(select gerenciaR1 from tbl_potencial_comites_sucesion  where id_comite=h.id_comite and id_empresa='62') as rut_a_suceder,
(select comite_cerrado from tbl_potencial_comites_sucesion  where id_comite=h.id_comite and id_empresa='62') as comite_cerrado

 from tbl_potencial_sucesion_colaboradores_propuestos_r2 h where id_empresa='62' and id_comite is null				
				
				";
     
        $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();
        return ($cod);		
	
}

function MiRx($rut){
	
				global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);   $fecha = date("Y-m-d");

				$sql=" 	select h.d153 as rx
				 				from tbl_data_bci_2021 h  
				 				where rut='$rut'";
     		//echo $sql;
        $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();
        return ($cod[0]->rx);		
	
}

function PotencialBuscaRutBajoRutLider($rut_lider){
	
	  global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);   $fecha = date("Y-m-d");

				$sql=" 
				
					select h.rut from tbl_potencial_comites_colaboradores h where h.rut_lider='$rut_lider'
						union
					select h.rut from tbl_potencial_sucesion_comites_colaboradores h where h.rut_lider='$rut_lider';				
				
				";
     		
        $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();
        
        return $cod;	
		
	
}
function Potencial_Cols_Por_Tipo_Cuadrante($TipoCuadrante,$gerencia,$fondo,$dependencia){
	
// echo "<br>FN Potencial_Cols_Por_Tipo_Cuadrante($TipoCuadrante,$gerencia,$fondo,$dependencia)";
 global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);   $fecha = date("Y-m-d");

if($TipoCuadrante=="2-3-6"){
	$JqueryCuad=" and (h.cuadrante='2' or  h.cuadrante='3' or  h.cuadrante='6') ";
}

if($TipoCuadrante=="5-5+"){
	$JqueryCuad=" and (h.cuadrante='5' or  h.cuadrante='5+') ";
}


if($TipoCuadrante=="1-4-7-8-9"){
	$JqueryCuad=" and (h.cuadrante='1' or  h.cuadrante='4' or  h.cuadrante='7' or  h.cuadrante='8' or  h.cuadrante='9') ";
}


				$sql=" 	select h.*
				 				from tbl_potencial_cuadrantes_api_full h  
				 				where rut<>''
				 				$JqueryCuad
				 				
				 				
				 				
				 				";
     
//echo $sql; exit();
        $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();
        return ($cod);	
	
	
	
}


function PotencialTraeDatosBci2021($rut){

        global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);   $fecha = date("Y-m-d");

				$sql=" 	select h.rut, h.d1, h.d7, h.d8, h.d9, d31 as d30, d33 as d32, d35 as d34, d145, d151
				 				from tbl_data_bci_2021 h  
				 				where rut='$rut'";
     
        $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();
        return ($cod);	
	
}


function PotencialBuscaAccionesSinEstado($rut, $fecha){

	  global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);   $fecha = date("Y-m-d");

				$sql=" 
				select *  from tbl_potencial_sucesion_acciones_desarrollo 
				where 
				rut='$rut' and 
				fecha_estado>'$fecha' and 
				(estado is null or estado='En Proceso' or estado='No Iniciado')";
     		
 				//echo $sql;
        $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();
        
        return $cod;	
	
	
}

function EsSocioOLider($rut) {
	
	
			  global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);   $fecha = date("Y-m-d");

				$sql=" 
				select id  from tbl_potencial_perfil where rut='$rut'";
     
        $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();
        
        return $cod[0]->id;
	
}



function PotencialInsertUsuario($rut_ficticio_usuario,$nombre_externo,$cargo_externo, $id_empresa){
			      global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);   $fecha = date("Y-m-d");
		    $fecha = date("Y-m-d");
    		$hora  = date("H:i:s");

				$sql   = "insert into tbl_usuario 
		    
		    (rut,nombre_completo,cargo, id_empresa, vigencia_descripcion)
        VALUES
        ('$rut_ficticio_usuario','$nombre_externo','$cargo_externo', '$id_empresa', 'Externo');";

				//echo $sql;
				//exit();

    $database->setquery($sql);
    $database->query();		
	
	
}



function DatosUsuarioMax(){
	
	
		      global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);   $fecha = date("Y-m-d");

				$sql=" 
				select (max(round(rut))) as max from tbl_usuario";
     
     		//echo $sql;
        $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();
        
        //print_r($cod);
        $max_uno=round($cod[0]->max)+1;
        
        //echo "max uno ".$max_uno."<br>";
        return $max_uno;	
	
}
function Potencial_Busca_Acciones_Desarrollo_Dado_Rut($rut){
	
	      global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);   $fecha = date("Y-m-d");

				$sql=" 
				select h.* 
				from tbl_potencial_sucesion_acciones_desarrollo h  
				where h.rut='$rut'";
     
        $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();
        return $cod;	
	
}


function Potencial_BuscaRutCompletoDadorut($rut){
        global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);   $fecha = date("Y-m-d");

				$sql=" select h.d1 as rut_completo from tbl_data_bci h  where rut='$rut'";
     
        $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();
        return ($cod[0]->rut_completo);	
}

function Potencial_BuscaFullData($rut){
        global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);   $fecha = date("Y-m-d");

				$sql=" select h.* from tbl_data_bci_2021 h  where rut='$rut'";
     
        $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();
        return ($cod);	
}

function Potencial_Colaboradores_MiEquipo_data($rut_completo, $perfil, $id_empresa){

        global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);   $fecha = date("Y-m-d");


     $sql   = "

     select h.* 
     
     from 
     
     tbl_data_bci h 

     where h.d23='$rut_completo'

     ";
        //echo "sql $sql";
        $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();
        return ($cod);

}

function Potencial_Baja_Igual_Sube($box_propuesta, $box_lider) {
	
			//echo "<br>Potencial_Baja_Igual_Sube actual $box_propuesta, lider $box_lider";
				if($box_propuesta=="1" and  
						($box_lider=="2" or $box_lider=="3" or $box_lider=="6"  or $box_lider=="5" or $box_lider=="10")	
				)	{	$respuesta="SUBE";}	
	
				if($box_propuesta=="1" and  
						($box_lider=="4" or $box_lider=="7" or $box_lider=="8")	
				)	{	$respuesta="BAJA";}		
	
					if($box_propuesta=="1" and  
						($box_lider=="1" or $box_lider=="9")	
				)	{	$respuesta="MANTIENE";}		
	

				if($box_propuesta=="2" and  
						($box_lider=="3")	
				)	{	$respuesta="SUBE";}	
	
				if($box_propuesta=="2" and  
						($box_lider=="6" or $box_lider=="2" )	
				)	{	$respuesta="MANTIENE";}		
	
					if($box_propuesta=="2" and  
						($box_lider=="1" or $box_lider=="5" or $box_lider=="10" or $box_lider=="4" or $box_lider=="7" or $box_lider=="8" or $box_lider=="9")	
				)	{	$respuesta="BAJA";}			
	

	
					if($box_propuesta=="3" and  
						($box_lider=="3" )	
				)	{	$respuesta="MANTIENE";}		
	
						if($box_propuesta=="3" and  
						($box_lider=="1" or $box_lider=="2" or $box_lider=="4" or $box_lider=="5" or $box_lider=="10" or $box_lider=="6" or $box_lider=="7" or $box_lider=="8" or $box_lider=="9")	
				)	{	$respuesta="BAJA";}			
	
	
	
				if($box_propuesta=="4" and  
						($box_lider=="1" or $box_lider=="2" or $box_lider=="3" or $box_lider=="5"  or $box_lider=="10" or $box_lider=="6"  or $box_lider=="9")	
				)	{	$respuesta="SUBE";}	
	
				if($box_propuesta=="4" and  
						($box_lider=="7")	
				)	{	$respuesta="BAJA";}		
	
					if($box_propuesta=="4" and  
						($box_lider=="4" or $box_lider=="8")	
				)	{	$respuesta="MANTIENE";}			
	

	
				if($box_propuesta=="5" and  
						($box_lider=="2" or $box_lider=="3" or $box_lider=="10"  or $box_lider=="6")	
				)	{	$respuesta="SUBE";}	
	
				if($box_propuesta=="5" and  
						($box_lider=="1" or $box_lider=="4"  or $box_lider=="7" or $box_lider=="8" or $box_lider=="9" )	
				)	{	$respuesta="BAJA";}		
	
					if($box_propuesta=="5" and  
						($box_lider=="5")	
				)	{	$respuesta="MANTIENE";}		
				
				
				if($box_propuesta=="6" and  
						($box_lider=="3")	
				)	{	$respuesta="SUBE";}	
	
				if($box_propuesta=="6" and  
						($box_lider=="1" or $box_lider=="4" or $box_lider=="5" or $box_lider=="10" or $box_lider=="7" or $box_lider=="8" or $box_lider=="9")	
				)	{	$respuesta="BAJA";}		
	
					if($box_propuesta=="6" and  
						($box_lider=="6" or $box_lider=="2")	
				)	{	$respuesta="MANTIENE";}						
					

				if($box_propuesta=="7" and  
						($box_lider=="1" or $box_lider=="2" or $box_lider=="3" or $box_lider=="4"  or $box_lider=="5" or $box_lider=="10" or $box_lider=="6"  or $box_lider=="8" or $box_lider=="9")	
				)	{	$respuesta="SUBE";}	
	

	
					if($box_propuesta=="7" and  
						($box_lider=="7")	
				)	{	$respuesta="MANTIENE";}		



				if($box_propuesta=="8" and  
						($box_lider=="1" or $box_lider=="2" or $box_lider=="3"  or $box_lider=="5" or $box_lider=="10" or $box_lider=="6"  or $box_lider=="7" or $box_lider=="9")	
				)	{	$respuesta="SUBE";}	
	
				if($box_propuesta=="8" and  
						($box_lider=="7")	
				)	{	$respuesta="BAJA";}		
	
					if($box_propuesta=="8" and  
						($box_lider=="8" or $box_lider=="4")	
				)	{	$respuesta="MANTIENE";}		


				if($box_propuesta=="9" and  
						($box_lider=="2" or $box_lider=="3" or $box_lider=="4"  or $box_lider=="5" or $box_lider=="10" or $box_lider=="6" )	
				)	{	$respuesta="SUBE";}	
	
				if($box_propuesta=="9" and  
						($box_lider=="4" or $box_lider=="7" or $box_lider=="8")	
				)	{	$respuesta="BAJA";}		
	
					if($box_propuesta=="9" and  
						($box_lider=="9" or $box_lider=="1")	
				)	{	$respuesta="MANTIENE";}		
	
	
		if($box_propuesta=="" or $box_lider=="")										
				{	$respuesta="VACIO";}	
		
	
				
	return $respuesta;		
				
}

function Potencial_Mi_Cuadrante_Actual($rut_col){
	
	        global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);   $fecha = date("Y-m-d");
				$sql="
				
						select 
						
						h.d103  as cuadrante_actual,
						h.d104  as fecha_actual,
						(select cuadrante_2020 from tbl_potencial_cuadrantes where rut=h.rut) as cuadrante_2020,
						(select fecha_cuadrante_2020 from tbl_potencial_cuadrantes where rut=h.rut) as fecha_cuadrante_2020

						from tbl_data_bci h	
						
						where h.rut='$rut_col'";	
				//echo $sql;
        $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();	
        
        if($cod[0]->cuadrante_2020<>""){
        	$cuadrante_actual=$cod[0]->cuadrante_2020;
        } else {
        	$cuadrante_actual=$cod[0]->cuadrante_actual;
        }
        
				return ($cuadrante_actual);	
}


function Potencial_Mi_Cuadrante_Actual_mas_Fecha($rut_col){
	
	        global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);   $fecha = date("Y-m-d");
				$sql="
				
						select 
						
						h.d103  as cuadrante_actual,
						h.d104  as fecha_actual,
						(select cuadrante_2020 from tbl_potencial_cuadrantes where rut=h.rut) as cuadrante_2020,
						(select fecha_cuadrante_2020 from tbl_potencial_cuadrantes where rut=h.rut) as fecha_cuadrante_2020

						from tbl_data_bci h	
						
						where h.rut='$rut_col'";	
				//echo $sql;
        $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();	
        
        if($cod[0]->cuadrante_2020<>""){
        	$cuadrante_actual=$cod[0]->cuadrante_2020;
        	$fecha_actual=$cod[0]->fecha_cuadrante_2020;
        } else {
        	$cuadrante_actual=$cod[0]->cuadrante_actual;
        	$fecha_Explode=explode("-",$cod[0]->fecha_actual);
        	$fecha_actual=$fecha_Explode[2]."-".$fecha_Explode[1]."-".$fecha_Explode[0];
        }
        $arreglo[0]=$cuadrante_actual;
        $arreglo[1]=$fecha_actual;
        
				return ($arreglo);	
}

function Potencial_Estadisticas($id_empresa, $gerencia, $fondo, $dependencia){
	
		    global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);

if($gerencia<>"")		{	$gerencia			= " and gerencia='$gerencia' ";	}
if($fondo<>"")			{	$fondo				= " and fondo='$fondo' ";	}
if($dependencia)		{	$dependencia	= " and dependencia='$dependencia' ";	}
        	
				$SQL_SU="select count(id) as cuenta from tbl_potencial_comites where id_empresa='$id_empresa'";
        $database->setquery($SQL_SU);
        $database->query();
        $COD_SU = $database->listObjects();	
				$numero_comites=$COD_SU[0]->cuenta;

				$SQL_SU="select count(id) as cuenta from tbl_potencial_comites where id_empresa='$id_empresa' and comite_cerrado='SI'";
        $database->setquery($SQL_SU);
        $database->query();
        $COD_SU = $database->listObjects();	
				$numero_comites_cerrados=$COD_SU[0]->cuenta;
				$numero_comites_abiertos=$numero_comites-$numero_comites_cerrados;

				$SQL_SU="select count(DISTINCT(rut)) as cuenta from tbl_potencial_cuadrantes_actual_2020_anterior  
				where id>0 $gerencia $fondo $dependencia
				";
				//echo $SQL_SU;
        $database->setquery($SQL_SU);
        $database->query();
        $COD_SU = $database->listObjects();	
				$num_colaboradores=$COD_SU[0]->cuenta;
      
				$SQL_SU="select count(DISTINCT(rut)) as cuenta from tbl_potencial_cuadrantes_actual_2020_anterior 
				where  (cuadrante='2' or cuadrante='3' or cuadrante='6')
				$gerencia $fondo $dependencia
				";
        $database->setquery($SQL_SU);
        $database->query();
        $COD_SU = $database->listObjects();	
				$num_colaboradores_236=$COD_SU[0]->cuenta;

				$SQL_SU="select count(DISTINCT(rut)) as cuenta from tbl_potencial_cuadrantes_actual_2020_anterior 
				where  (cuadrante='5' or cuadrante='5+' or cuadrante='10')
				$gerencia $fondo $dependencia
				";
        $database->setquery($SQL_SU);
        $database->query();
        $COD_SU = $database->listObjects();	
				$num_colaboradores_5_5mas=$COD_SU[0]->cuenta;

				$SQL_SU="select count(DISTINCT(rut)) as cuenta from tbl_potencial_cuadrantes_actual_2020_anterior 
				where  (cuadrante='1' or cuadrante='4' or cuadrante='7' or cuadrante='8' or cuadrante='9')
				$gerencia $fondo $dependencia
				";
        $database->setquery($SQL_SU);
        $database->query();
        $COD_SU = $database->listObjects();	
				$num_colaboradores_14789=$COD_SU[0]->cuenta;				


        
	$arreglo[1]=$numero_comites;
	$arreglo[2]=$numero_comites_abiertos;
	$arreglo[3]=$numero_comites_cerrados;

	$arreglo[4]=$num_colaboradores;
	$arreglo[5]=$num_colaboradores_236;
	$arreglo[6]=$num_colaboradores_5_5mas;
	$arreglo[7]=$num_colaboradores_14789;

	
	return $arreglo;
}

function Potencial_Mi_Cuadrante_Lider($rut_col){
	
	        global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);   $fecha = date("Y-m-d");
				$sql="
				
select cuadrante_2020_lider from tbl_potencial_cuadrantes where rut='$rut_col'";	
				//echo $sql;
        $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();	
        
        if($cod[0]->cuadrante_2020_lider<>""){
        	$cuadrante_actual=$cod[0]->cuadrante_2020_lider;
        } else {
        	$cuadrante_actual="";
        }
        
				return ($cuadrante_actual);	
}

// panel de liderazgo

function Potencial_Mi_data($id_empresa, $rut_col){
	
        global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);   $fecha = date("Y-m-d");
				$sql_1="select * from tbl_potencial_cuadrantes where rut='$rut_col'";
        $database->setquery($sql_1);
        $database->query();
        $cod_1 = $database->listObjects();	
				return ($cod_1);	
	
}

function PanelLiderazgoResultadoFinalCompleto($res_que,$res_como){
	
		$resultado	=	round((50*$res_que+50*$res_como)/100);
	//&&echo "<br>resultado $resultado<br>$res_DS,$res_2_AE,$res_3_ASC,$res_3_PAR";
	return $resultado;
	
}

function PanelBuscoFlexPersonaYDanCotinue($rut_col, $id_empresa){
	    	global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);	
        
        $sql=" select tipo_flexible from tbl_panel_liberado where rut='$rut_col'";
				//echo "sql $sql";
        $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();
        if($cod[0]->tipo_flexible=="ft"){$kpi_continue="fp";}
        if($cod[0]->tipo_flexible=="fp"){$kpi_continue="ft";}
        
        return $kpi_continue;	
}

function PanelBuscaPanelCriterios($tipo, $id_empresa){
	    	global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);	
        
        $sql=" select * from tbl_panel_criterios where tipo='$tipo' and id_empresa='$id_empresa'";
				//echo "sql $sql";
        $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();
        return $cod;
}

function PanelBuscaResultadoKpiInicioFinal($id_kpi, $rut_col, $id_empresa, $year){
	    	global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);	

				//echo "<br>PanelBuscaResultadoKpiInicioFinal($id_kpi, $rut_col, $id_empresa)<br>";

   			$campo1=$id_kpi."_d";
   			$campo2=$id_kpi."_n";
   			$campo3=$id_kpi."_c";
	 	    $campo4=$id_kpi."_m";
           
				
				
				if($id_kpi=="en"){

        $sql_inicio	=" select eng_c as cumplimiento from tbl_panel_data where rut='$rut_col' and eng_c<>'' and year='$year' order by month ASC limit 1";
        $sql_final	=" select eng_c cumplimiento from tbl_panel_data where rut='$rut_col' and eng_c<>'' and year='$year' order by month DESC limit 1";
				//echo "<br>sql_inicio $sql_inicio<br>sql_final $sql_final<br>";

					
				} 
				
				elseif($id_kpi=="de"){

        $sql_inicio	=" select de_c as cumplimiento from tbl_panel_data where rut='$rut_col' and de_c<>'' and year='$year' order by month ASC limit 1";
        $sql_final	=" select sum(de_c) cumplimiento from tbl_panel_data where rut='$rut_col' and de_c<>'' and year='$year' order by month DESC limit 1";
				//echo "<br>sql_inicio $sql_inicio<br>sql_final $sql_final<br>";

					
				}				
				else {

        $sql_inicio	=" select $campo1 as dotacion,$campo2 as numerador,$campo3 as cumplimiento,$campo4 as aspiracional from tbl_panel_data where rut='$rut_col' and year='$year' order by month ASC limit 1";
        $sql_final	=" select $campo1 as dotacion,$campo2 as numerador,$campo3 as cumplimiento,$campo4 as aspiracional from tbl_panel_data where rut='$rut_col' and year='$year' order by month DESC limit 1";
				//echo "<br>sql_inicio $sql_inicio<br>sql_final $sql_final<br>";

					
				}
								//echo "<br>sql_inicio $sql_inicio<br>sql_final $sql_final<br>";

        $database->setquery($sql_inicio);        $database->query();
        $cod_inicio = $database->listObjects();
        $database->setquery($sql_final);        $database->query();
        $cod_final = $database->listObjects();
        
        $arreglo[0]=$cod_inicio;
        $arreglo[1]=$cod_final;

        
        return $arreglo;	
}

function PanelGeneraGestionDadoKpi($res_inicio, $res_final){
	    	global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);	
//echo "$res_inicio, $res_final";
if($res_final>$res_inicio)		{$flecha_gestion	=	"<div class='panel_flecha'><i class='fas fa-level-up-alt'></i></div>";}
if($res_final==$res_inicio)		{$flecha_gestion	=	"<div class='panel_flecha'><i class='fas fa-exchange-alt'></i></div>";}
if($res_final<$res_inicio)		{$flecha_gestion	=	"<div class='panel_flecha'><i class='fas fa-level-down-alt'></i></div>";}
        
        
        return $flecha_gestion;	
}


function PanelGeneraSemaforoDadoKpi($res_inicio, $res_final, $kpi_aspiracional){
//echo "<br>$res_inicio, $res_final";
$cincoporciento=(5*$kpi_aspiracional/100);
$rango_inferior=$kpi_aspiracional-$cincoporciento;

//echo "<br>aspiracional $kpi_aspiracional, $res_inicio, $res_final, $kpi_aspiraciona";
   
   if($res_final>$res_inicio)		{$flecha_gestion	=	"<div class='panel_flecha'><i class='fas fa-level-up-alt'></i></div>";}
if($res_final==$res_inicio)		{$flecha_gestion	=	"<div class='panel_flecha'><i class='fas fa-exchange-alt'></i></div>";}
if($res_final<$res_inicio)		{$flecha_gestion	=	"<div class='panel_flecha'><i class='fas fa-level-down-alt'></i></div>";}
     
if($res_final >= $kpi_aspiracional)		{$semaforo				=	"<div class='panel_semaforo_verde'><i class='fas fa-dot-circle'></i></div>";}
if($res_final >=$rango_inferior and $res_final < $kpi_aspiracional)		{$semaforo				=	"<div class='panel_semaforo_amarillo'><i class='fas fa-dot-circle'></i></div>";}
if($res_final < $rango_inferior)			{$semaforo				=	"<div class='panel_semaforo_rojo'><i class='fas fa-dot-circle'></i></div>";}

  if($res_final>$res_inicio)	{
  	$semaforo				=	"<div class='panel_semaforo_verde'><i class='fas fa-dot-circle'></i></div>";
  }

//echo "semaforo $semaforo	";

        return $semaforo;	
}


function PanelGeneraTxtSemaforoDadoKpi($res_inicio, $res_final, $kpi_aspiracional){

$cincoporciento=(5*$kpi_aspiracional/100);
$rango_inferior=$kpi_aspiracional-$cincoporciento;

//echo "<br>aspiracional $kpi_aspiracional, $cincoporciento, rango inferior $rango_inferior";
     
if($res_final >= $kpi_aspiracional)		{$semaforo				=	"verde";}

        return $semaforo;	
}

function PanelResultadoCuentaVerdes($cuenta_verde,$cuenta_todos){
	///echo "<br>PanelResultadoCuentaVerdes cuenta_verde $cuenta_verde";
	if($cuenta_verde>=6 and $cuenta_verde<100)			{$resultado="130";}
	elseif($cuenta_verde>=5 and $cuenta_verde<6)			{$resultado="115";}	
	elseif($cuenta_verde>=4 and $cuenta_verde<5)			{$resultado="100";}	
	elseif($cuenta_verde>=3 and $cuenta_verde<4)			{$resultado="90";}
	elseif($cuenta_verde>=2 and $cuenta_verde<3)			{$resultado="60";}
	elseif($cuenta_verde>=1 and $cuenta_verde<2)			{$resultado="30";}
	elseif($cuenta_verde>=0 and $cuenta_verde<1)			{$resultado="0";}

	return $resultado;

}

function PanelBuscaResultadoKpiInicioFinalEngLid($id_kpi, $rut_col, $id_empresa, $year){
	
	//echo "<br>PanelBuscaResultadoKpiInicioFinalEng($id_kpi, $rut_col, $id_empresa, $year)";
	
	    	global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);	
          
        $sql_inicio	=" select $id_kpi as dato from tbl_panel_data where rut='$rut_col' and id_empresa='$id_empresa' and $id_kpi<>'' and year='$year' order by year DESC, month DESC limit 1 ";
				//echo "<br>PanelBuscaResultadoKpiInicioFinalEngLid $sql_inicio";
        $database->setquery($sql_inicio);        $database->query();
        $cod_inicio = $database->listObjects();
        //print_r($cod_inicio);
        return $cod_inicio[0]->dato;	
}

function PanelResCompetenciaLinea($res_ae,$res_ds,$res_mp,$res_as){
	//echo "<br>PanelResCompetenciaLinea(ae $res_ae, ds $res_ds, mp $res_mp, as $res_as)";
	
	$res_ae = str_replace(',', '.', $res_ae);
	$res_ds = str_replace(',', '.', $res_ds);
	$res_mp = str_replace(',', '.', $res_mp);
	$res_as = str_replace(',', '.', $res_as);
	
		if($res_ds<>"" and $res_ae<>"" and $res_as<>"" and $res_mp<>""){
				$resultado	=	round((10*$res_ae+50*$res_ds+15*$res_mp+25*$res_as)/100,2);
				$pon_ae=10;
				$pon_ds=50;
				$pon_mp=15;
				$pon_as=25;
			}

		elseif($res_ds<>"" and $res_ae<>"" and $res_as<>"" and $res_mp==""){
				$resultado	=	round((15*$res_ae+50*$res_ds+35*$res_as)/100,2);
				$pon_ae=15;
				$pon_ds=50;
				$pon_mp=0;
				$pon_as=35;
			}

		elseif($res_ds<>"" and $res_ae<>"" and $res_as=="" and $res_mp<>""){
				$resultado	=	round((15*$res_ae+60*$res_ds+25*$res_mp)/100,2);
				$pon_ae=15;
				$pon_ds=60;
				$pon_mp=25;
				$pon_as=0;
			}

		elseif($res_ds<>"" and $res_ae=="" and $res_as<>"" and $res_mp<>""){
				$resultado	=	round((50*$res_ds+25*$res_mp+35*$res_as)/100,2);
				$pon_ae=0;
				$pon_ds=50;
				$pon_mp=25;
				$pon_as=35;
				
			}

		elseif($res_ds<>"" and $res_ae<>"" and $res_as=="" and $res_mp==""){
				$resultado	=	"NA";
				$pon_ae=0;
				$pon_ds=0;
				$pon_mp=0;
				$pon_as=0;
			}
		else {
				$resultado	=	"NA";
				$pon_ae=0;
				$pon_ds=0;
				$pon_mp=0;
				$pon_as=0;				
			}

		
		
$arreglo_resultado[0]=$resultado;
$arreglo_resultado[1]=$pon_ds;
$arreglo_resultado[2]=$pon_as;
$arreglo_resultado[3]=$pon_mp;
$arreglo_resultado[4]=$pon_ae;
	
	//echo "<br>resultado $resultado<br>";
	//exit();
	return $arreglo_resultado;
}

function PanelBuscaResultadosCompetencias($id_kpi, $rut_col, $year, $id_empresa){
	    	global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);	
        
        $sql=" select evaluacion, $id_kpi as resultado from tbl_panel_data_competencias where rut='$rut_col' and year='$year' and id_empresa='$id_empresa'";
				//echo "<br>PanelBuscaResultadosCompetencias <br>sql $sql<br>";
        $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();
        return $cod;		
}


function PanelBuscaAspiracionalCriterio($id_kpi){
	
		    global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);	

				$sql="select kpi_aspiracional from tbl_panel_criterios where id_kpi='$id_kpi' limit 1";
        //echo "sql $sql";
        $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();
        return $cod[0]->kpi_aspiracional;	
	
}

//panel liderazgo

function Check_Usr_PrimerNivel_BloqueadoGGPP_soyLider($rut_col){
	
	     global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);
        	
				$SQL_SU="select count(id) as cuenta from tbl_potencial_comites_colaboradores 
				where rut_lider='".$_SESSION["user_"]."' and rut='$rut_col' and id_empresa='62'";
				//echo $SQL_SU;	
        $database->setquery($SQL_SU);
        $database->query();
        $COD_SU = $database->listObjects();	

        return $COD_SU[0]->cuenta;	
	
	
}


function Sucesion_Update_Cierre_Posicion_lider($id_posicion){
	
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $fecha = date("Y-m-d");
    $sql = "update tbl_potencial_sucesion_colaboradores_propuestos_r2 
    set validado_lider='SI', fecha_validacion='".$fecha."'

    
    where posicion='$id_posicion'";
 //echo $sql;  exit();

   $database->setquery($sql);
    $database->query();
    $datos = $database->listObjects();
    return $datos;		
	
}


function Sucesion_Check_Posicion_validada($id_posicion){
	
		      global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);
        	
				$SQL_SU="select count(id) as cuenta from tbl_potencial_sucesion_colaboradores_propuestos_r2 
				where posicion='$id_posicion' and validado_lider='SI'";
				//echo $SQL_SU;	
        $database->setquery($SQL_SU);
        $database->query();
        $COD_SU = $database->listObjects();	

        return $COD_SU[0]->cuenta;	
	
}
function Sucesion_Rut_Nombre_lider_posicion($id_posicion){
	
	      global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);
        	
				$SQL_SU="select rut, d7, d8, d9 from tbl_data_bci_2021 where d151='$id_posicion'";
				//echo $SQL_SU;	
        $database->setquery($SQL_SU);
        $database->query();
        $COD_SU = $database->listObjects();	

        return $COD_SU;			
}


function Check_Usr_PrimerNivel_Bloqueado($rut_col) {
	$bloqueado="";    
if($rut_col=="6461785" 
	or $rut_col=="6926510"	    
 or $rut_col=="7438369"
 or $rut_col=="7663689"
 or $rut_col=="6461785"
 or $rut_col=="10667871"
 or $rut_col=="7799138"
 or $rut_col=="10671495"
 or $rut_col=="10269066"
 or $rut_col=="10243251"
 or $rut_col=="10739385"
 or $rut_col=="6966517"
 or $rut_col=="6785528"
 or $rut_col=="8576943"
 or $rut_col=="10535909"){
 	$bloqueado=1;
 }
	    
        return $bloqueado;		
	
	
}
function Check_Usr_PrimerNivel_BloqueadoGGPP($rut_col) {
	      global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);
        	
				$SQL_SU="select rut from tbl_data_bci_2021 where rut='$rut_col' and d31='GERENCIA CORPORATIVA GESTION PERSONAS'";
			
        $database->setquery($SQL_SU);
        $database->query();
        $COD_SU = $database->listObjects();	

        return $COD_SU[0]->rut;		
	
	
}


function Potencial_SoySuper($rut){
	      global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);
        	
				$SQL_SU="select id from tbl_potencial_perfil_super where rut='$rut'";
        $database->setquery($SQL_SU);
        $database->query();
        $COD_SU = $database->listObjects();	

        return $COD_SU[0]->id;	
	
}

function Potencial_BuscaFecha_DadoComite($id_comite){
	
	      global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);

				$sql   = "select fecha_comite from tbl_potencial_comites where id_comite='$id_comite'  ";
				
    		$database->setquery($sql);
   		 	$database->query();	
	
        $cod = $database->listObjects();
        return $cod;		
	
	
}
function Potencial_BuscaLideres_DadoComiteLider($id_comite,$rut_lider){
	
	      global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);

				$sql   = "select * from tbl_potencial_comites_colaboradores where id_comite='$id_comite' and rut_lider='$rut_lider'  ";
				
    		$database->setquery($sql);
   		 	$database->query();	
	
        $cod = $database->listObjects();
        return $cod;		
	
	
}
function Potencial_BuscaLideres_DadoComite($id_comite){
	
	      global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);

				$sql   = "select * from tbl_potencial_comites_colaboradores where id_comite='$id_comite' and rut_lider<>'' group by rut_lider ";
				
    		$database->setquery($sql);
   		 	$database->query();	
	
        $cod = $database->listObjects();
        return $cod;			
}
function Potencial_Sucesion_Acciones_Desarrollo_Cambioestado($AD_idEdEst, $estado, $fundamento){
	
  global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);

					$fundamento=utf8_decode($fundamento);


		    $fecha = date("Y-m-d");
    		$hora  = date("H:i:s");

    $sql = "update tbl_potencial_sucesion_acciones_desarrollo h 
    set estado='".$estado."', fecha_estado='".$fecha."',
     rut_autor_estado='".$_SESSION["user_"]."', fundamento='".$fundamento."'
    
      where id='$AD_idEdEst' ";

		//echo $sql;
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;	
	
	
	
	
}


function Potencial_Delete_Acciones_Desarrollo($delad){
	
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "delete from tbl_potencial_sucesion_acciones_desarrollo where id='$delad'";
 
   	$database->setquery($sql);
    $database->query();
    $datos = $database->listObjects();
    return $datos;		
	
	
}


function Potencial_Acciones_Desarrollo($rut_col, $id_empresa){
	
	      global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);

			

				$sql   = "select * from tbl_potencial_sucesion_acciones_desarrollo where rut='$rut_col' order by fecha DESC ";

    		$database->setquery($sql);
   		 	$database->query();	
	
	        $cod = $database->listObjects();
        return $cod;		
	
	
}

function Potencial_Acciones_Desarrollo_por_comite($rut_col, $id_comite, $id_empresa){
	
	      global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);

			

				$sql   = "select * from tbl_potencial_sucesion_acciones_desarrollo where rut='$rut_col' and id_comite='$id_comite' order by fecha DESC ";

    		$database->setquery($sql);
   		 	$database->query();	
	
	        $cod = $database->listObjects();
        return $cod;		
	
	
}

function Potencial_Busca_Acciones_Desarrollo($rut_col){
	      global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);

			

				$sql   = "select * from tbl_potencial_sucesion_acciones_desarrollo where rut='$rut_col' ";

    		$database->setquery($sql);
   		 	$database->query();	
	
	        $cod = $database->listObjects();
        return $cod;	
	
}


function Potencial_Busca_Bitacora_Desarrollo($rut_col){
	      global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);

			

				$sql   = "
					select h.*, 
					
					(select nombre_completo from tbl_usuario where rut=h.rut) as nombre_completo,
					(select nombre from tbl_potencial_comites_sucesion where id_comite=h.id_comite) as comite
					
					
				 from tbl_potencial_bitacora_sucesion h where h.rut_colaborador='$rut_col' 
				 group by h.accion, h.comentario
order by id DESC				  ";

				//echo $sql;

    		$database->setquery($sql);
   		 	$database->query();	
	
	        $cod = $database->listObjects();
        return $cod;	
	
}

function Potencial_Insert_Acciones_Desarrollo($rut_col, $id_comite, $plan_acciones_desarrollo, $fundamento){
	      global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);

					$plan_acciones_desarrollo=utf8_decode($plan_acciones_desarrollo);
					$fundamento=utf8_decode($fundamento);


		    $fecha = date("Y-m-d");
    		$hora  = date("H:i:s");

				$sql   = "insert into tbl_potencial_sucesion_acciones_desarrollo 
		    
		    (rut,id_comite,plan,fecha, rut_creador, fundamento, estado)
        VALUES
        ('$rut_col','$id_comite', '$plan_acciones_desarrollo', '$fecha','".$_SESSION["user_"]."','$fundamento','No Iniciado');";

			//

    $database->setquery($sql);
    $database->query();	
	
	
	
}


function Potencial_Del_tbl_potencial_sucesion_colaboradores_propuestos_r2($del, $perfil){
	   
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $fecha = date("Y-m-d");
    
    if($perfil=="SOCIO DE NEGOCIO"){
    	$rut_lider="";
    } else {
    	$rut_lider=$_SESSION["user_"];
    }
    

    
    $sql = "
    update 
    tbl_potencial_sucesion_colaboradores_propuestos_r2 
    set estado='No es sucesor', rutlider='".$rut_lider."', fechalider='$fecha'

    
    
    where id='$del'";
 //echo $sql;  exit();

   $database->setquery($sql);
    $database->query();
    $datos = $database->listObjects();
    return $datos;	
	
	
}
function Potencial_Actualiza_tbl_potencial_sucesion_colaboradores_propuestos_r2($id_sucesor, $tipo_sucesion_ficha){
	
        global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);
        $hoy   = date('Y-m-d');
        $sql="update tbl_potencial_sucesion_colaboradores_propuestos_r2 set tipo_sucesion='$tipo_sucesion_ficha' where id='$id_sucesor' ";
        //echo $sql;exit;
        $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();
        return $cod;	
	
}
function Potencial_trae_rut_col_fromId_Sucesion($id_sucesor){
	
	
	      global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);

				$sql   = "select rut_col from tbl_potencial_sucesion_colaboradores_propuestos_r2 where id='$id_sucesor' ";
				
    		$database->setquery($sql);
   		 	$database->query();	
	
        $cod = $database->listObjects();
        
      
        return $cod[0]->rut_col;	

	
}



function Potencial_Insert_Col_Bitacora_Sucesion_CheckSave($rut, $perfil, $id_comite,$rut_save,$fundamento,$accion,$id_empresa){
      global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);
	$fundamento=utf8_decode($fundamento);
		    $fecha = date("Y-m-d");
    		$hora  = date("H:i:s");

				$sql   = "insert into tbl_potencial_bitacora_sucesion 
		    
		    (rut,perfil,id_comite,rut_colaborador,comentario,accion,fecha,hora,id_empresa)
        VALUES
        ('$rut', '$perfil', '$id_comite','$rut_save','$fundamento','$accion', '$fecha', '$hora','$id_empresa');";

    $database->setquery($sql);
    $database->query();	
	
	
}
function Potencial_Insert_Col_Sucesion_CheckSave($id_comite,$rut_col,$tipo,$posicion,$id_empresa, $soylider){
	
	      global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);
        
            $fecha = date("Y-m-d");
    		$hora  = date("H:i:s");
if($soylider>0){
					$sql   = "insert into tbl_potencial_sucesion_colaboradores_propuestos_r2 
		    
		    (id_comite,rut_col,fecha,hora,tipo_sucesion,posicion,estado,id_empresa, rutlider, fechalider)
        VALUES
        ('$id_comite','$rut_col', '$fecha', '$hora','$tipo', '$posicion','Es Sucesor','$id_empresa','".$_SESSION["user_"]."','$fecha');";
} else {
					$sql   = "insert into tbl_potencial_sucesion_colaboradores_propuestos_r2 
		    
		    (id_comite,rut_col,fecha,hora,tipo_sucesion,posicion,estado,id_empresa)
        VALUES
        ('$id_comite','$rut_col', '$fecha', '$hora','$tipo', '$posicion', 'Es Sucesor', '$id_empresa');";
}
		



    $database->setquery($sql);
    $database->query();
	
}

function Potencial_Sucesion_CheckSave($rut,$posicion,$id_comite,$id_empresa){
	
	      global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);

    $sql   = "insert into tbl_potencial_sucesion_comites_colaboradores (id_comite, posicion, rut, id_empresa)
        VALUES
        ('$id_comite','$posicion', '$rut', '$id_empresa');";
 
    $database->setquery($sql);
    $database->query();
	
}
function BuscaPersonas2020_v2($search){

	global $c_host,$c_user,$c_pass,$c_db;

	$search=utf8_decode($search);

	$database = new database($c_host,$c_user,$c_pass);

	$database->setDb($c_db);

	  

	//$sql = "SELECT * FROM tbl_usuario WHERE nombre_completo like'%".$search."%'";
	
	
	
	$sql="
	
		SELECT h.*, (select rut from tbl_data_bci where rut=h.rut) as databci,
    MATCH (h.nombre_completo) AGAINST ('$search') AS relevance
    
    FROM tbl_usuario h
    
    WHERE h.vigencia='0' and  MATCH (h.nombre_completo) AGAINST ('$search') and MATCH (h.nombre_completo) AGAINST ('$search') >0
		and (select rut from tbl_data_bci where rut=h.rut)>0
		
		limit 30
		
		";
	
	//echo $sql;
	//exit();
	
	$database->setquery($sql);

	$database->query();	

	$datos = $database->listObjects();

	return $datos;

}

function PotencialSucesion_Vista_Colaboradores_Posicion($id_comite, $rut, $id_empresa, $tipo, $posicion){
	
	      global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);
	      $sql=" 	select * 
	      				from tbl_potencial_sucesion_colaboradores_propuestos_r2  
	      				where posicion='$posicion' and id_comite='$id_comite' and id_empresa='$id_empresa' and tipo_sucesion='$tipo'";     

 $sql=" 	select * 
	      				from tbl_potencial_sucesion_colaboradores_propuestos_r2  
	      				where posicion='$posicion' and id_empresa='$id_empresa' and tipo_sucesion='$tipo'";  								
				//echo "<br><br>".$sql."<br><br>";
	  
	      $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();	
				return ($cod);			
	
	
}


function PotencialSucesion_Vista_Colaboradores($id_comite, $rut, $id_empresa, $tipo){
	
	      global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);
	      $sql=" 	select * 
	      				from tbl_potencial_sucesion_colaboradores_propuestos_r2  
	      				where rut='$rut' and id_comite='$id_comite' and id_empresa='$id_empresa' and tipo_sucesion='$tipo'";     
		  
	      $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();	
				return ($cod);			
	
	
}

function BuscaPersonas2020($search){

	global $c_host,$c_user,$c_pass,$c_db;
	$search=utf8_decode($search);
	$database = new database($c_host,$c_user,$c_pass);
	$database->setDb($c_db);

	//$sql = "SELECT * FROM tbl_usuario WHERE nombre_completo like'%".$search."%'";
	$sql="SELECT tbl_usuario.*,
       MATCH (nombre_completo) AGAINST ('$search') AS relevance
    FROM tbl_usuario
    WHERE vigencia='0' and  MATCH (nombre_completo) AGAINST ('$search') and MATCH (nombre_completo) AGAINST ('$search') >0";
	
	//echo $sql;
	
	$database->setquery($sql);
	$database->query();	
	$datos = $database->listObjects();

	return $datos;

}


function Potencial_Sucesion_Insert($id_comite, $rut, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $fecha = date("Y-m-d");
    $hora  = date("H:i:s");
		$Usua=DatosUsuario_($rut, $id_empresa);
		$jefe=$Usua[0]->jefe;

    $sql   = "insert into tbl_potencial_sucesion_comites_colaboradores (id_comite, rut, id_empresa)
        VALUES
        ('$id_comite','$rut', '$id_empresa');";

    $database->setquery($sql);
    $database->query();
}

function Potencial_Sucesion_Colaboradores_Comites_data($id_comite, $rut, $perfil, $id_empresa){

        global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);   $fecha = date("Y-m-d");

//echo "perfil $perfil";

//if($perfil=="SOCIO DE NEGOCIO") {$query=" and (select rut from tbl_potencial_comites where id_comite='$id_comite')='$rut' ";}
if($perfil=="SOCIO DE NEGOCIO") 			{}
if($perfil=="LIDER")            			{$query=" and h.rut='$rut' ";}
if($perfil=="VISUALIZADOR")           {$query=" and (
	
																								rut_jefe_socio='$rut' or 
																								rut_jefe_jefe_socio='$rut' or 
																								rut_jefe_lider='$rut' or 
																								rut_jefe_jefe_lider='$rut')

";}

if($perfil=="USUARIO")          {exit();}
     $sql   = "

     select h.*,
     (select nombre_completo    from tbl_usuario            where rut=h.rut)                as nombre_completo,
     (select nombre_completo    from tbl_usuario            where rut=h.rut_lider)                as nombre_lider,
     (select d151   from tbl_data_bci_2021            where rut=h.rut)                				as cargo_col

     from tbl_potencial_sucesion_comites_colaboradores h

     where h.id>0 $query and h.id_comite='$id_comite' and h.id_empresa='$id_empresa'
     and (select nombre_completo    from tbl_usuario            where rut=h.rut)<>''
     
     order by (select nombre_completo    from tbl_usuario            where rut=h.rut) ASC

     ";
     //and h.posicion='GERENTE CUMPLIMIENTO CORPORATIVO Y PREVENCION'
        
       // echo "<br><br><br><br><br><br><br><br><br><br><br><br>sql<br> $sql";
        
        $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();
        return ($cod);

}

function Potencial_Sucesion_Comites_data($id_comite,$id_empresa){

        global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);   $fecha = date("Y-m-d");

     $sql   = "

     select h.*,
     (select nombre_completo    from tbl_usuario            where rut=h.rut)                as nombre_completo

     from tbl_potencial_comites_sucesion h

     where h.id_comite='$id_comite' and h.id_empresa='$id_empresa'
     order by (select nombre_completo    from tbl_usuario   where rut=h.rut) ASC

     ";
        //echo "sql $sql"; 
        $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();
        return ($cod);

}

function Potencial_Sucesion_Truncate($id_comite){
	
	
	       global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);
        $sql="delete from tbl_potencial_sucesion_comites_colaboradores where id_comite='$id_comite' ";
        //echo $sql;exit;
        $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();
        return $cod;
	
}

function PotencialSucesion_BuscaR2($rut_R1, $id_empresa){
         global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);   $fecha = date("Y-m-d");
     		$sql   = 
     		
     		"
     		
        select h.*,
				(select d1 from tbl_data_bci_2021 where rut='$rut_R1') as rut_completo_r1,
				(select count(rut) from tbl_data_bci_2021 where d23=(select d1 from tbl_data_bci_2021 where rut='$rut_R1')) as dep

				from tbl_data_bci_2021 h

				where h.d23=(select d1 from tbl_data_bci_2021 where rut='$rut_R1')
				and
				(select count(rut) from tbl_data_bci_2021 where d23=(select d1 from tbl_data_bci_2021 where rut=h.d1)) >0
				group by h.d145
     		";
     		
     		$sql="
     		
select h.*, (select d1 from tbl_data_bci_2021 where rut='$rut_R1') as rut_completo_r1,
(select count(rut) from tbl_data_bci_2021 where d23=(select d1 from tbl_data_bci where rut='$rut_R1')) as dep 
from tbl_data_bci_2021 h 
where h.d23=(select d1 from tbl_data_bci_2021 where rut='$rut_R1') 
and (select count(rut) from tbl_data_bci_2021 where d23=(select d1 from tbl_data_bci_2021 where rut=h.d1)) >0 
group by h.d151
     		
     		";
     		
     		//echo $sql;
     		//exit();
        $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();
        return $cod;
}
function Potencial_Sucesion_d145_databci($rut){
	
        global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);   $fecha = date("Y-m-d");
	
		$sql="select d151 from tbl_data_bci_2021 where rut='$rut'";

        $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();
        return ($cod[0]->d151);
	
}
function Potencial_Sucesion_Mis_Comites_data($id_empresa, $rut, $perfil){

        global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);   $fecha = date("Y-m-d");
      
      	$sql_jefe="select d23 from tbl_data_bci_2021 where rut='$rut'";
        $database->setquery($sql_jefe);
        $database->query();          	
				$cod_jefe = $database->listObjects();      
      	
      	$rut_jefe=LimpiaRutFront($cod_jefe[0]->d23);
				
				if($perfil=="SUPER USER"){

 $sql="   
				   select 

							h.*,
							(select d1 from tbl_data_bci_2021 where rut='$rut') as rut_completo,
							(select d1 from tbl_data_bci_2021 where rut=h.gerenciaR1) as rut_completo_r1,
							(select rut from tbl_data_bci_2021 where rut='$rut' and d23=(select d1 from tbl_data_bci_2021 where rut=(select d1 from tbl_data_bci_2021 where rut=h.gerenciaR1))) as rut_dependiente,
							(select count(rut) from tbl_data_bci_2021 where d23=(select d1 from tbl_data_bci_2021 where rut=h.gerenciaR1)) as dep

							from tbl_potencial_comites_sucesion h

							where 

							
							

							
							 h.id_empresa='62'
							";
					
				} else {
					
				
				 $sql="   
				   select 

							h.*,
							(select d1 from tbl_data_bci_2021 where rut='$rut') as rut_completo,
							(select d1 from tbl_data_bci_2021 where rut=h.gerenciaR1) as rut_completo_r1,
							(select rut from tbl_data_bci_2021 where rut='$rut' and d23=(select d1 from tbl_data_bci_2021 where rut=(select d1 from tbl_data_bci_2021 where rut=h.gerenciaR1))) as rut_dependiente,
							(select count(rut) from tbl_data_bci_2021 where d23=(select d1 from tbl_data_bci_2021 where rut=h.gerenciaR1)) as dep

							from tbl_potencial_comites_sucesion h

							where 

							
							
								 (
								h.rut='$rut' or
								h.gerenciaR1='$rut'
								or h.rut_socio_2='$rut'
								or h.rut_socio_3='$rut'
								or h.rut_socio_4='$rut'
								or((select rut from tbl_data_bci_2021 where rut='$rut' and d23=(select d1 from tbl_data_bci_2021 where rut=(select d1 from tbl_data_bci_2021 where rut=h.gerenciaR1)))
								and 
									(select count(rut) from tbl_data_bci_2021 where d23=(select d1 from tbl_data_bci_2021 where rut=h.gerenciaR1))>0
								)
							)
							
							and h.id_empresa='62'
							";

						}
						
			    foreach ($cod as $key => $row) {
			        $aux[$key] = $row->fecha_comite;
			    }
			    //echo "<br>AUX<br>";
			    //print_r($aux);
			    //echo "<br>FIn AUX<br>";
			    array_multisort($aux, SORT_DESC, $cod);
							
				//echo "<h3>".$sql."</h3>";
        $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();
        return ($cod);

}

function Pontencial_Busca_Snes($rut_col, $id_empresa)  {
	      global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);
	      $sql=" 	select * from tbl_potencial_snes  where rut='$rut_col' order by year DESC";     
		  
	      $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();	
				return ($cod);		
}

function Pontencial_Busca_Met_Tri($rut_col, $id_empresa)  {
	
	      global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);
	      $sql=" 	select * from tbl_potencial_met_tri  where rut='$rut_col' order by year DESC";     
		  
	       $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();	
				return ($cod);		
	
	
}


function TraigoDependenciaDadoGerenciaFondo($gerencia, $fondo){
	      global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);
	      $sql=" 	select distinct(d34) as dato from tbl_data_bci  where d30='$gerencia' and d32='$fondo'
		  ";     
		  
       $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();	
				return ($cod);			
}



function TraigoDependencia($gerencia){
	      global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);
	      $sql=" 	select distinct(d34) as dato from tbl_data_bci  where d30='$gerencia' 
		  ";     
       $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();	
				return ($cod);			
}


function TraigoFondo($gerencia){
	      global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);
	      $sql=" 	select distinct(d32) as dato from tbl_data_bci  where d30='$gerencia' 
		  ";     
       $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();	
				return ($cod);			
}
function Potencial_Sucesion_Num_Sucesores($rut){
	      global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);
	      $sql=" 	select count(id) as cuenta from tbl_potencial_sucesion_colaboradores_propuestos_r2 where rut_col='$rut' ";     
	      //echo $sql;
        $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();	
				return $cod[0]->cuenta;		
}


function Potencial_Check_Mapeado_oAnterior($rut){
	      global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);
	      $sql=" 	select cuadrante_2020 from tbl_potencial_cuadrantes where rut='$rut' order by id DESC limit 1";     
	      echo $sql;
        $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();	
				return $cod[0]->cuadrante_2020;		
}

function CheckMapeadoCerrado($rut){
	      global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);	
				$sql=" select 
				h.* 
				from tbl_potencial_cuadrantes h 
				where h.rut='$rut' and h.cerrado is NULL";

        $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();	
        
        if(count($cod)>0){
        	//echo "<br>Analizando ".$rut;
  				$sql2=" 
			  			select h.* , 
							(select comite_cerrado from tbl_potencial_comites where id_comite=h.id_comite) as estado
							from tbl_potencial_comites_colaboradores h 
							where h.rut='$rut' and h.id_empresa='62'
							and 
							(select comite_cerrado from tbl_potencial_comites where id_comite=h.id_comite) ='SI'";      	
				
					//echo ".-".$sql2;
          $database->setquery($sql2);
        	$database->query();      	
        	$cod2 = $database->listObjects();	
        	if(count($cod2)>0)	{
        		$sql3="update tbl_potencial_cuadrantes set cerrado='1' where rut='$rut'";
            $database->setquery($sql3);
        		$database->query();           		
        	}
        	
        
        }
        
				//return $cod[0]->cuadrante_2020;		
	
	
}

function Potencial_Check_Mapeado($rut){
	      global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);
	      $sql=" 	select cuadrante_2020 from tbl_potencial_cuadrantes where rut='$rut' order by id DESC limit 1";     
        $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();	
				return $cod[0]->cuadrante_2020;		
}
function Potencial_Check_Mapeado_Cerrado($rut){
	      global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);
	      $sql=" 	select id from tbl_potencial_cuadrantes where rut='$rut' and cerrado='1' order by id DESC limit 1";   
	     // echo "<br>".$sql."<br>";  
        $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();	
       
				return $cod[0]->id;		
}

function Potencial_BuscaUltimoComitedeRut($rut){
	
	      global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);
	      $sql=" 	select h.id_comite, (select comite_cerrado from tbl_potencial_comites where id_comite=h.id_comite) as cerrado from tbl_potencial_comites_colaboradores h where h.rut='$rut' order by h.id DESC limit 1";   
	     // echo "<br>".$sql."<br>";  
        $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();	
       
				return $cod[0]->cerrado;			
	
	
	
}


function Potencial_Genero($rut){
	      global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);
	      $sql=" 	select d54 as genero from tbl_data_bci where rut='$rut'";     
	      //echo $sql;
        $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();	
				return $cod[0]->genero;		
}


function Potencial_Data_Bci_groupby($field){
	      global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);
	      $sql=" 	select $field as dato from tbl_data_bci group by $field order by $field ";     
        $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();	
				return ($cod);			
}


function Potencial_Es_SuperUsers($rut){
	      global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);
	      $sql=" 	select id from tbl_potencial_perfil_super where rut='$rut' and rut<>'17810781' ";     
	      
	      
				//echo "<br>sql<br>".$sql."<br>";
        $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();	
				return ($cod[0]->id);		
}

function Potencial_Es_Socio($rut) {
	      global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);
	      $sql=" 	select id from tbl_potencial_perfil where rut='$rut' ";     
        $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();	
				return ($cod[0]->id);			
}

function Potencial_Busca_Nombre_Lider($rut_col,$id_comite_enc){
	
	      global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);   $fecha = date("Y-m-d");	
        $id_comite=Decodear3($id_comite_enc);
	//echo "<br>Potencial_Busca_Nombre_Lider<br>$rut_col,$id_comite";
	        $sql="
        
        select h.rut_lider, (select d7 from tbl_data_bci where rut=h.rut_lider) as nombre, (select d8 from tbl_data_bci where rut=h.rut_lider) as apellido
 from tbl_potencial_comites_colaboradores h where h.rut='$rut_col' and h.id_comite='$id_comite'

        
        ";
        
                $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();	
        $nombre=$cod[0]->nombre." ".$cod[0]->apellido;
				return ($nombre);	
	
}

function Potencial_Busca_Rut_Lider($rut_col,$id_comite_enc){
	
	       global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);   $fecha = date("Y-m-d");	
        $id_comite=Decodear3($id_comite_enc);
	//echo "<br>Potencial_Busca_Nombre_Lider<br>$rut_col,$id_comite";
	        $sql="
        
        select h.rut_lider
 				from tbl_potencial_comites_colaboradores h where h.rut='$rut_col' and h.id_comite='$id_comite'

        
        ";
        
                $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();	
        $rut_lider=$cod[0]->rut_lider;
				return ($rut_lider);	
	
}

function Pot_CheckPosicion_Clave($rut) {
	
	       global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);   $fecha = date("Y-m-d");
        
        $sql="
        
        select h.id, h.posicion_clave, (select d151 from tbl_data_bci_2021 where rut='$rut') from tbl_potencial_posicion_clave h   where
				(select d151 from tbl_data_bci_2021 where rut='$rut') = h.posicion_clave

        
        ";
        
                $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();	
				return ($cod[0]->id);	

}
function Pot_Check_Es_Sucesor($rut) {
	
	       global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);   $fecha = date("Y-m-d");
        
        $sql="
        
        	select count(id) as cuenta
        	from
         tbl_potencial_sucesion_colaboradores_propuestos_r2 h
         where
					h.rut_col='$rut' and h.id_comite is null
        and h.id_empresa='62'

UNION 

         select count(id) as cuenta
        	from
         tbl_potencial_sucesion_colaboradores_propuestos_r2 h
         where
					h.rut_col='$rut' and h.id_comite is not null 
					and (select comite_cerrado from tbl_potencial_comites_sucesion where id_comite=h.id_comite)='SI'
        and h.id_empresa='62'   
        ";
        
        $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();	
        foreach ( $cod as $unico){
        	$cuenta=$unico->cuenta+$cuenta;
        }
				return ($cuenta);	

}


function Pot_Full_Es_Sucesor($rut) {
	
	       global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);   $fecha = date("Y-m-d");
        
        $sql="
        
	select *
        	from
         tbl_potencial_sucesion_colaboradores_propuestos_r2 h
         where
					h.rut_col='$rut' and h.id_comite is null
        and h.id_empresa='62'

UNION 
select
         *
        	from
         tbl_potencial_sucesion_colaboradores_propuestos_r2 h
         where
					h.rut_col='$rut' and h.id_comite is not null 
					and (select comite_cerrado from tbl_potencial_comites_sucesion where id_comite=h.id_comite)='SI'
        and h.id_empresa='62'   
					
        
        ";
        //and id_empresa='62'
                $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();	
				return ($cod);	

}

function Potencial_Busca_Array_reporte($filtro){
	
        global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);   $fecha = date("Y-m-d");
				$sql_1="	
				
						select 
						h.rut,
						h.d1 as rut_completo, 
						h.d7 as nombre, 
						h.d8 as paterno, 
						h.d9 as materno, 
						h.d30  as gerencia,
						h.d32  as fondo,
						h.d34  as dependencia,
						h.d103  as cuadrante_actual,
						h.d104  as fecha_actual,
						h.d145 as puesto,
						h.cuadrante_2020,
						h.fecha_cuadrante_2020,
						h.Comentario1,
						h.Comentario2,
						h.Comentario3,
						h.Comentario4,
						h.Comentario5,
						h.Comentario6

						from tbl_data_bci_full h	
						
						$filtro
				";
		   
       //echo $sql_1;exit();
			
        $database->setquery($sql_1);
        $database->query();
        $cod_1 = $database->listObjects();	
        

			 return ($cod_1);		
	
}

function Potencial_ActualizaJefedeJefe($id_comite, $rut_lider){
	
//	echo "<br>Potencial_ActualizaJefedeJefe<br>$id_comite, $rut_lider";
	
	      global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);   $fecha = date("Y-m-d");
				$sql_1="	select rut  from tbl_potencial_comites h where id_comite='$id_comite' ";
        $database->setquery($sql_1);
        $database->query();
        $cod_1 = $database->listObjects();	
	
				//print_r($cod_1);
				//echo "<br>rut socio ".$cod_1[0]->rut;
				//echo "<br>rut lider ".$rut_lider;
	
				$rut_jefe_socio=PotencialBuscaJefetbl_data_bci($cod_1[0]->rut);
				$rut_jefe_jefe_socio=PotencialBuscaJefetbl_data_bci($rut_jefe_socio);
	
				$rut_jefe_lider=PotencialBuscaJefetbl_data_bci($rut_lider);
				$rut_jefe_jefe_lider=PotencialBuscaJefetbl_data_bci($rut_jefe_lider);
	
//	echo "<br>	rut_jefe_socio $rut_jefe_socio	, rut_jefe_jefe_socio $rut_jefe_jefe_socio
//				<br>  rut_jefe_lider $rut_jefe_lider	, rut_jefe_jefe_lider $rut_jefe_jefe_lider";
	
			    $sql   = "update tbl_potencial_comites_colaboradores set rut_jefe_socio='$rut_jefe_socio', rut_jefe_jefe_socio='$rut_jefe_jefe_socio' where id_comite='$id_comite'";
    			$database->setquery($sql);
    			$database->query();
    			
			    $sql   = "update tbl_potencial_comites_colaboradores set rut_jefe_lider='$rut_jefe_lider', rut_jefe_jefe_lider='$rut_jefe_jefe_lider' where rut_lider='$rut_lider'";
    			$database->setquery($sql);
    			$database->query();    			
	
	
	
}

function PotencialBuscaJefetbl_data_bci($rut){
	
        global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);   $fecha = date("Y-m-d");
				$sql_1="	select d23 as jefe from tbl_data_bci where rut='$rut' ";
        $database->setquery($sql_1);
        $database->query();
        $cod_1 = $database->listObjects();	
        
        $jefe       = LimpiaRutFront($cod_1[0]->jefe);
        
				return ($jefe);		
	
}

function Potencial_BuscaLineasSinJefedeJefe($id_empresa){
	
        global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);   $fecha = date("Y-m-d");
				$sql_1="	select h.* from tbl_potencial_comites_colaboradores h where h.rut_jefe_socio is NULL and h.id_empresa='$id_empresa' group by h.rut_lider, h.id_comite ";
        $database->setquery($sql_1);
        $database->query();
        $cod_1 = $database->listObjects();	
				return ($cod_1);	
	
}
function  Potencial_EliminaBitacora($id) {

        global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);
        $sql="delete from tbl_potencial_bitacora where id='$id' ";
        //echo $sql;exit;
        $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();
        return $cod;

}

function Potencial_PromedioBanco($rut){
				//$rut="18393769";

	      global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);   $fecha = date("Y-m-d");
				$sql_1="select * from tbl_potencial_tipo_perfil where rut='$rut' limit 1";
        $database->setquery($sql_1);
        $database->query();
        $cod_1 = $database->listObjects();	
        $tipo_perfil	=		$cod_1[0]->tipo_perfil;
        
        //echo "select * from tbl_potencial_tipo_perfil where rut='$rut' limit 1 $tipo_perfil " ;
        
 				$sql_2="select * from tbl_potencial_tipo_perfil_dato where tipoperfil='$tipo_perfil'";
        $database->setquery($sql_2);
        $database->query();
        $cod_2 = $database->listObjects();       
        $i=0;
        foreach ($cod_2 as $unico){
        	$arreglo[$i]=$unico->dato;
        	$i++;
        }
        //print_r($arreglo);
        
				return ($arreglo);	
	
}


function Potencial_Colaboradores_Matriz_tbl_potencial_cuadrantes_data($id_empresa, $rut_col){
	
        global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);   $fecha = date("Y-m-d");
        
        
        
				$sql_1="select * from tbl_potencial_cuadrantes where rut='$rut_col'";
        $database->setquery($sql_1);
        $database->query();
        $cod_1 = $database->listObjects();	
				return ($cod_1);	
	
}


function Potencial_comite_update_tbl_data_bci_socio($nuevo_cuadrante,$comentario, $id_comite,  $rut, $id, $id_empresa , $perfil, $rut_col){
        global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);   $fecha = date("Y-m-d");
    $fecha = date("Y-m-d");
    $hora  = date("H:i:s");
    if($perfil=="SOCIO DE NEGOCIO")     {   $query=" set cuadrante_2020='$nuevo_cuadrante', fecha_cuadrante_2020='$fecha' ";}
    if($perfil=="LIDER")     {   $query=" set cuadrante_2020='$nuevo_cuadrante', fecha_cuadrante_2020='$fecha' ";}
    //if($perfil=="LIDER")     {   $query=" set propuesta_lider='$nuevo_cuadrante' ";}
    $comentario=utf8_decode($comentario);

    $sql   = "update tbl_potencial_cuadrantes
    $query
    where rut='$rut_col'";
    $database->setquery($sql);
    $database->query();
    //echo "<br>sql $sql";
    
    
    
     //$sql   = "     select h.rut from tbl_potencial_matriz h where h.id='$id' and h.id_empresa='$id_empresa' limit 1     ";
    //echo "<br>sql $sql";
        //$database->setquery($sql);
       // $database->query();
       // $cod = $database->listObjects();
        //$rut_col    =   $cod[0]->rut;

     $sql   = "
     select count(id) as cuenta from tbl_potencial_bitacora h where h.rut='$rut' and rut_colaborador='$rut_col'
     and box_propuesto='$nuevo_cuadrante' and comentario='$comentario' and h.id_empresa='$id_empresa' limit 1
     ";
        $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();
        $cuenta    =   $cod[0]->cuenta;
        if($cuenta==0){
    $sql   = "insert into tbl_potencial_bitacora
        (rut,   perfil, id_comite,   rut_colaborador,comentario,  box_propuesto,fecha,hora, id_empresa)
        VALUES
        ('$rut','$perfil', '$id_comite','$rut_col',    '$comentario','$nuevo_cuadrante','$fecha','$hora','$id_empresa');";
     }
    //echo "<br>sql $sql";
    $database->setquery($sql);
    $database->query();


}

function Potencial_comite_update_tbl_data_bci_lider($nuevo_cuadrante,$comentario, $id_comite,  $rut, $id, $id_empresa , $perfil, $rut_col){
        global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);   $fecha = date("Y-m-d");
		    $fecha = date("Y-m-d");
    		$hora  = date("H:i:s");
    
    		$query=" set cuadrante_2020_lider='$nuevo_cuadrante', fecha_cuadrante_2020_lider='$fecha' ";
    		$comentario=utf8_decode($comentario);

    $sql   = "update tbl_potencial_cuadrantes
    $query
    where rut='$rut_col'";
    $database->setquery($sql);
    $database->query();
    //echo "<br>sql $sql";
    
    //echo "<br>sql $sql";
    
     //$sql   = "     select h.rut from tbl_potencial_matriz h where h.id='$id' and h.id_empresa='$id_empresa' limit 1     ";
    //echo "<br>sql $sql";
        //$database->setquery($sql);
       // $database->query();
       // $cod = $database->listObjects();
        //$rut_col    =   $cod[0]->rut;

     $sql   = "
     select count(id) as cuenta from tbl_potencial_bitacora h where h.rut='$rut' and rut_colaborador='$rut_col'
     and box_propuesto='$nuevo_cuadrante' and comentario='$comentario' and h.id_empresa='$id_empresa' limit 1
     ";
        $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();
        $cuenta    =   $cod[0]->cuenta;
        if($cuenta==0){
    $sql   = "insert into tbl_potencial_bitacora
        (rut,   perfil, id_comite,   rut_colaborador,comentario,  box_propuesto,fecha,hora, id_empresa)
        VALUES
        ('$rut','$perfil', '$id_comite','$rut_col',    '$comentario','$nuevo_cuadrante','$fecha','$hora','$id_empresa');";
     }
    
    $database->setquery($sql);
    $database->query();


}

function Potencial_Cuadrantes_Data($rut){
        global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);   $fecha = date("Y-m-d");


				$sql_1="select * from tbl_potencial_cuadrantes where rut='$rut'";
        $database->setquery($sql_1);
        $database->query();
        $cod_1 = $database->listObjects();	
				return ($cod_1);
}

function Potencial_Update_data_tbl_bci($promedio_metas,$promedio_competencias,$box_propuesta,$rut){
        global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);   $fecha = date("Y-m-d");


				$sql_1="select * from tbl_potencial_cuadrantes where rut='$rut'";
        $database->setquery($sql_1);
        $database->query();
        $cod_1 = $database->listObjects();
        
        if($cod_1[0]->id>0){
         $sql   = "update tbl_potencial_cuadrantes
    set promedio_metas_2020='$promedio_metas',
    promedio_competencias_2020='$promedio_competencias',
    propuesta_cuadrante_2020='$box_propuesta'
    
    where rut='$rut' ";   	
        	
        } else {
  
      $sql   = "insert into tbl_potencial_cuadrantes
        (rut, promedio_metas_2020, promedio_competencias_2020, propuesta_cuadrante_2020)
        VALUES
        ('$rut','$promedio_metas','$promedio_competencias','$box_propuesta');";
        //echo $sql; exit();exit();

        	
        }

			$database->setquery($sql);
    	$database->query();


   if($cod_1[0]->fecha_propuesta_cuadrante_2020==""){
   	 $hoy   = date('Y-m-d');
   	
   	 $sql   = "update tbl_potencial_cuadrantes
    set fecha_propuesta_cuadrante_2020='$hoy'
    
    where rut='$rut' ";  
    			$database->setquery($sql);
    	$database->query(); 	
   }
   
    
        $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();
        return ($cod);

}

function Potencial_Colaboradores_Matriz_tbl_data_bci_data($id_empresa, $rut){

        global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);   $fecha = date("Y-m-d");

     $sql   = "

     				select h.* from tbl_data_bci h where h.rut='$rut' 

     ";
        //echo "sql $sql"; 
        $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();
        return ($cod);

}
function Potencial_Colaboradores_Matriz_tbl_data_bci_2021_data($id_empresa, $rut){

        global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);   $fecha = date("Y-m-d");

     $sql   = "

     				select h.* from tbl_data_bci_2021 h where h.rut='$rut' 

     ";
        //echo "sql $sql"; 
        $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();
        return ($cod);

}
function Potencial_Colaboradores_Matriz_Fields_tbl_data_bci_data($rut){

        global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);   $fecha = date("Y-m-d");

     $sql   = "

     				select h.rut,
     				
     				h.d133 as resultado_desempeno, 
     				h.d59 as meta_2016,
     				h.d60 as meta_2017,
     				h.d61 as meta_2018,
     				h.d62 as meta_2015,
     				h.d63 as meta_2019,
     				
     				h.d132 as competencia_2019,
     				h.d98 as competencia_miscolaboradores_2018,
     				
     				h.d103 as cuadrante_actual,
     				h.d104 as fecha_cuadrante_actual,
     				
     				h.d105 as cuadrante_anterior,
     				h.d106 as meses_cuadrante_anterior,
     				
     				h.d127 as d127,
     				h.d128 as d128,
     				h.d129 as d129,
     				h.d130 as d130,
     			
     				
     				h.d79 as d79,
     				h.d80 as d80,
     				h.d77 as d77,
     				
     				h.d87 as d87,
     				h.d77 as d77
     				
     				
     				
     				
     				
     				from tbl_data_bci h where h.rut='$rut' 

     ";
        //echo "sql $sql"; 
        $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();
        return ($cod);

}


function  Potencial_Update_Cierre_Comite($id_comite) {

        global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);
        $hoy   = date('Y-m-d');
        $sql="update tbl_potencial_comites set comite_cerrado='SI', fecha_cerrado='$hoy' where id_comite='$id_comite' ";
        //echo $sql;exit;
        $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();
        return $cod;

}

function  Potencial_Sucesion_Update_Cierre_Comite($id_comite) {

        global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);
        $hoy   = date('Y-m-d');
        $sql="update tbl_potencial_comites_sucesion set comite_cerrado='SI', fecha_cerrado='$hoy' where id_comite='$id_comite' ";
        //echo $sql;exit;
        $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();
        return $cod;

}

function  Potencial_EliminaComite($id_comite) {

        global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);
        $sql="update tbl_potencial_comites set id_empresa='99' where id_comite='$id_comite' ";
        //echo $sql;exit;
        $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();
        return $cod;

}

function  Potencial_EliminaComite_Sucesion($id_comite) {

        global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);
        $sql="update tbl_potencial_comites_sucesion set id_empresa='99' where id_comite='$id_comite' ";
        //echo $sql;exit;
        $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();
        return $cod;

}

function Potencial_Mis_Comites_insert_Nuevo_Comite_data($nombre, $rut, $fecha_comite, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $fecha = date("Y-m-d");
    $hora  = date("H:i:s");
    $nombre =   utf8_decode($nombre);
        $sql   = "

            select max(id) as id_max from tbl_potencial_comites order by id DESC limit 1

        ";
        $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();
        
       // print_r($cod); exit();
        $id_antiguo=$cod[0]->id_max;
        $id_nuevo=  $id_antiguo+1;
        
        $id_comite="pot_".$rut_lider."_".$id_nuevo;

    		$sql   = "insert into tbl_potencial_comites
        (nombre, descripcion, rut, fecha_comite, fecha, hora, id_empresa, id_comite, rut_lider, nombre_lider)
        VALUES
        ('$nombre','$descripcion','$rut','$fecha_comite','$fecha','$hora', '$id_empresa',
         '$id_comite','$rut_lider','$nombre_lider');";
        //echo $sql; exit();exit();
    $database->setquery($sql);
    $database->query();
}

function Potencial_Mis_Comites_insert_Nuevo_Comite_Sucesion_data($nombre, $rut_g1, $rut, $fecha_comite, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $fecha = date("Y-m-d");
    $hora  = date("H:i:s");
    $nombre =   utf8_decode($nombre);
        $sql   = "

            select max(id) as id_max from tbl_potencial_comites_sucesion order by id DESC limit 1

        ";
        $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();
        
       // print_r($cod); exit();
        $id_antiguo=$cod[0]->id_max;
        $id_nuevo=  $id_antiguo+1;
        
        $id_comite="pot_suc_".$id_nuevo;

    		$sql   = "insert into tbl_potencial_comites_sucesion
        (nombre, descripcion, gerenciaR1, rut, fecha_comite, fecha, hora, id_empresa, id_comite, rut_lider, nombre_lider)
        VALUES
        ('$nombre','$descripcion', '$rut_g1', '$rut','$fecha_comite','$fecha','$hora', '$id_empresa',
         '$id_comite','$rut_lider','$nombre_lider');";
        //echo $sql; exit();exit();
    $database->setquery($sql);
    $database->query();
}


function Potencial_Perfil_Usuarios($rut, $id_empresa){
        global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);   $fecha = date("Y-m-d");

     		$sql   = " select h.id from tbl_potencial_perfil h where h.rut='$rut' and h.id_empresa='$id_empresa'  limit 1";
        //echo "<br>sql $sql"; 
        $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();
        
     		$sql1   = " select h.id from tbl_potencial_comites_colaboradores h where h.rut_lider='$rut' and h.id_empresa='$id_empresa'  limit 1";
        //echo "<br>sql1 $sql1"; 
        $database->setquery($sql1);
        $database->query();
        $cod1 = $database->listObjects();


     		$sql2   = " select h.id from tbl_potencial_comites_colaboradores h where 
     		(h.rut_jefe_socio='$rut' or h.rut_jefe_jefe_socio='$rut' or h.rut_jefe_lider='$rut' or h.rut_jefe_jefe_lider='$rut')
     		 and h.id_empresa='$id_empresa'  limit 1";
     		//echo $sql2;
     		//exit();
        $database->setquery($sql2);
        $database->query();
        $cod2 = $database->listObjects();
       
        //echo "<br>cod1[0]->id>0 lider ".$cod1[0]->id." and cod[0]->id>0 ".$cod[0]->id."";

				if($cod2[0]->id>0){
					$perfil="VISUALIZADOR";
				}

				if($cod1[0]->id>0 and $cod[0]->id>0){
        	$perfil="SOCIO DE NEGOCIO";
        }

				if($cod1[0]->id==0 and $cod[0]->id>0){
        	$perfil="SOCIO DE NEGOCIO";
        }
        
        if($cod1[0]->id>0 and $cod[0]->id==0){
        	$perfil="LIDER";
        }
    
         if($cod1[0]->id==0 and $cod[0]->id==0 and $cod2[0]->id==0){
        	$perfil="";
        }    
        
        if($perfil==""){
        	
        	//check 
        $sqlSU   = " select h.id from tbl_potencial_perfil_super h where h.rut='$rut' and h.id_empresa='$id_empresa'  limit 1";
        //echo "<br>sql $sql"; 
        $database->setquery($sqlSU);
        $database->query();
        $codSU = $database->listObjects();
        	if($codSU[0]->id > 0){
        		$perfil="SUPER USER";
        	}
        	
        }
        
        //echo "perfil $perfil"; exit();
  
  			//vista socio 2 y 3
         if($perfil==""){

        $sqlSOc_2_3   = " select h.id from tbl_potencial_comites h where (h.rut='$rut' or h.rut_socio_2='$rut' or h.rut_socio_3='$rut' or h.rut_socio_4='$rut') 
        and h.id_empresa='$id_empresa'  limit 1";
        //echo "<br>sql $sql"; 
        $database->setquery($sqlSOc_2_3);
        $database->query();
        $codSOc_2_3 = $database->listObjects();
        	if($codSOc_2_3[0]->id > 0){
        		$perfil="SOCIO DE NEGOCIO";
        	}         	
         	
         	
        } 			
        
        return $perfil;
}


function Potencial_Perfil_Sucesion_Usuarios($rut, $id_empresa){
        global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);   $fecha = date("Y-m-d");

     		$sql   = " select h.id from tbl_potencial_perfil h where h.rut='$rut' and h.id_empresa='$id_empresa'  limit 1";
        //echo "<br>sql $sql"; 
        $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();
        
     		$sql1   = " select h.id from tbl_potencial_sucesion_comites_colaboradores h where h.rut='$rut' and h.id_empresa='$id_empresa'  limit 1";
        //echo "<br>sql1 $sql1"; 
        $database->setquery($sql1);
        $database->query();
        $cod1 = $database->listObjects();


     		$sql2   = " select h.id from tbl_potencial_sucesion_comites_colaboradores h where 
     		(h.rut_jefe_socio='$rut' or h.rut_jefe_jefe_socio='$rut' or h.rut_jefe_lider='$rut' or h.rut_jefe_jefe_lider='$rut')
     		 and h.id_empresa='$id_empresa'  limit 1";
     		//echo $sql2;
     		//exit();
        $database->setquery($sql2);
        $database->query();
        $cod2 = $database->listObjects();
       
        //echo "<br>cod1[0]->id>0 lider ".$cod1[0]->id." and cod[0]->id>0 ".$cod[0]->id."";

				if($cod2[0]->id>0){
					$perfil="VISUALIZADOR";
				}

				if($cod1[0]->id>0 and $cod[0]->id>0){
        	$perfil="SOCIO DE NEGOCIO";
        }

				if($cod1[0]->id==0 and $cod[0]->id>0){
        	$perfil="SOCIO DE NEGOCIO";
        }
        
        if($cod1[0]->id>0 and $cod[0]->id==0){
        	$perfil="LIDER";
        }
    
         if($cod1[0]->id==0 and $cod[0]->id==0 and $cod2[0]->id==0){
        	$perfil="";
        }    
        
        //if($perfil==""){
        	//check 
        $sqlSU   = " select h.id from tbl_potencial_perfil_super h where h.rut='$rut' and h.id_empresa='$id_empresa'  limit 1";
        //echo "<br>sql tbl_potencial_perfil_super <br> $sql <br>"; 
        $database->setquery($sqlSU);
        $database->query();
        $codSU = $database->listObjects();
        	if($codSU[0]->id > 0){
        		$perfil="SUPER USER";
        	}
        	
        //}
        
        //echo "perfil $perfil"; exit();
  
  			//vista socio 2 y 3
         if($perfil==""){

        $sqlSOc_2_3   = " select h.id from tbl_potencial_comites_sucesion h where (h.rut='$rut' or h.gerenciaR1='$rut' or h.rut_socio_2='$rut' or h.rut_socio_3='$rut' or h.rut_socio_4='$rut') 
        and h.id_empresa='$id_empresa'  limit 1";
        //echo "<br>sql $sql"; 
        $database->setquery($sqlSOc_2_3);
        $database->query();
        $codSOc_2_3 = $database->listObjects();
        	if($codSOc_2_3[0]->id > 0){
        		$perfil="SOCIO DE NEGOCIO";
        	}         	
         	
         	
        } 			
        
        return $perfil;
}

function Pot_Check_Usr_No_mapeables($rut_col){
	
	       global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);   $fecha = date("Y-m-d");


     $sql   = "

    	select rut from tbl_data_bci
	    where rut='$rut_col' and d30='GERENCIA CORPORATIVA GESTION PERSONAS'

			limit 1
     ";
      //echo "<br>sql $sql";
        $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();
        return ($cod[0]->rut);
	
	
}
function Potencial_Bitacora_Comites_data($id_comite, $rut, $perfil, $id_empresa){
         global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);   $fecha = date("Y-m-d");
if($perfil=="SOCIO DE NEGOCIO") {$query=" and (select rut from tbl_potencial_comites where id_comite='$id_comite')='$rut' ";}
if($perfil=="LIDER")            {$query="and  (select rut_lider from tbl_potencial_comites_colaboradores where id_comite='$id_comite' and rut=h.rut_colaborador)
='$rut' ";}
if($perfil=="USUARIO")          {exit();}

     $sql   = "

    select h.*,
        (select nombre_completo from tbl_usuario where rut=h.rut) as nombre_completo,
        (select avatar from tbl_usuario where rut=h.rut) as avatar,
        (select nombre_completo from tbl_usuario where rut=h.rut_colaborador) as nombre_completo_col,
        (select avatar from tbl_usuario where rut=h.rut_colaborador) as avatar_col

    from tbl_potencial_bitacora h

    where h.id>0 $query
    and (select count(id) from tbl_potencial_comites_colaboradores  where id_comite='$id_comite' and rut=h.rut_colaborador)>0
    and h.id_comite='$id_comite' and h.id_empresa='$id_empresa'  order by (select nombre_completo from tbl_usuario where rut=h.rut_colaborador), id DESC

     ";
      //echo "sql $sql";
        $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();
        return ($cod);
}

function Potencial_Bitacora_Comites_FullRut_data($rut_col,  $id_empresa){
         global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);   $fecha = date("Y-m-d");


     $sql   = "

    select h.*,
    		(select nombre from tbl_potencial_comites where id_comite=h.id_comite) as comite,
    		(select fecha_comite from tbl_potencial_comites where id_comite=h.id_comite) as fecha_comite,
        (select nombre_completo from tbl_usuario where rut=h.rut) as nombre_completo,
        (select avatar from tbl_usuario where rut=h.rut) as avatar,
        (select nombre_completo from tbl_usuario where rut=h.rut_colaborador) as nombre_completo_col,
        (select avatar from tbl_usuario where rut=h.rut_colaborador) as avatar_col,
        'Potencial' as tipo_bitacora

    from tbl_potencial_bitacora h

     where rut_colaborador='$rut_col'

		UNION
		
    select h.*,
    		(select nombre from tbl_potencial_comites_sucesion where id_comite=h.id_comite) as comite,
    		(select fecha_comite from tbl_potencial_comites_sucesion where id_comite=h.id_comite) as fecha_comite,
        (select nombre_completo from tbl_usuario where rut=h.rut) as nombre_completo,
        (select avatar from tbl_usuario where rut=h.rut) as avatar,
        (select nombre_completo from tbl_usuario where rut=h.rut_colaborador) as nombre_completo_col,
        (select avatar from tbl_usuario where rut=h.rut_colaborador) as avatar_col,
        'Sucesin' as tipo_bitacora

    from tbl_potencial_bitacora_sucesion h

     where rut_colaborador='$rut_col'		
     
    order by fecha DESC

     ";
    
        $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();
        return ($cod);
}

function BuscaPotencialActualizado($id, $id_empresa){

        global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);   $fecha = date("Y-m-d");

     $sql   = "
     select h.propuesta_lider,h.propuesta_socio,h.propuesta_final  from tbl_potencial_matriz h where h.id='$id' and h.id_empresa='$id_empresa'  order by id DESC
     ";
      //echo "<br>sql $sql";
        $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();
$box="";
if($cod[0]->propuesta_lider<>'')    {$box=$cod[0]->propuesta_lider;}
if($cod[0]->propuesta_socio<>'')    {$box=$cod[0]->propuesta_socio;}
if($cod[0]->propuesta_final<>'')    {$box=$cod[0]->propuesta_final;}




        return ($box);

}
function Potencial_BuscaColaborador($id, $id_empresa)
{
            global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);   $fecha = date("Y-m-d");

     $sql   = "
select h.*,

(select rut_lider from tbl_potencial_comites_colaboradores where rut=h.rut and id_comite=h.id_comite) as rut_lider,
(select rut from tbl_potencial_comites where id_comite=h.id_comite) as rut_socio
 from tbl_potencial_matriz h where h.id='$id' and h.id_empresa='$id_empresa'";
 //echo "<br>sql $sql";
        $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();
        return $cod;
}

function potencial_comite_update_socio($nuevo_cuadrante,$comentario, $id_comite,  $rut, $id, $id_empresa , $perfil){
        global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);   $fecha = date("Y-m-d");
    $fecha = date("Y-m-d");
    $hora  = date("H:i:s");
    if($perfil=="SOCIO DE NEGOCIO")     {   $query=" set propuesta_socio='$nuevo_cuadrante' ";}
    if($perfil=="LIDER")     {   $query=" set propuesta_lider='$nuevo_cuadrante' ";}
    $comentario=utf8_decode($comentario);

    $sql   = "update tbl_potencial_matriz
    $query
    where id='$id' and id_empresa='$id_empresa'";
    $database->setquery($sql);
    $database->query();
    //echo "<br>sql $sql";
     $sql   = "
     select h.rut from tbl_potencial_matriz h where h.id='$id' and h.id_empresa='$id_empresa' limit 1
     ";
    //echo "<br>sql $sql";
        $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();
        $rut_col    =   $cod[0]->rut;

     $sql   = "
     select count(id) as cuenta from tbl_potencial_bitacora h where h.rut='$rut' and rut_colaborador='$rut_col'
     and box_propuesto='$nuevo_cuadrante' and comentario='$comentario' and h.id_empresa='$id_empresa' limit 1
     ";
        $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();
        $cuenta    =   $cod[0]->cuenta;
        if($cuenta==0){
    $sql   = "insert into tbl_potencial_bitacora
        (rut,   perfil, id_comite,   rut_colaborador,comentario,  box_propuesto,fecha,hora, id_empresa)
        VALUES
        ('$rut','$perfil', '$id_comite','$rut_col',    '$comentario','$nuevo_cuadrante','$fecha','$hora','$id_empresa');";
     }
    //echo "<br>sql $sql";
    $database->setquery($sql);
    $database->query();


}

function Potencial_Lista_Colaboradores_Reales($id_comite, $id_empresa){
        global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);   $fecha = date("Y-m-d");
        
	$sql   = "
			select count(h.id) as cuenta
			
			from 
				
			tbl_potencial_comites_colaboradores h
	
			where 
			
			h.id_comite='$id_comite' and h.id_empresa='$id_empresa'
  ";

	//echo "<br>Potencial_Lista_Colaboradores_Reales $sql ";
	
  $database->setquery($sql);
  $database->query();
  $cod = $database->listObjects();
  return ($cod[0]->cuenta);	
}

function Potencial_lista_colabordores_comite($cuadrante, $id_comite, $rut, $perfil, $id_empresa) {

        global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);   $fecha = date("Y-m-d");



$queryw="";
if($perfil=="LIDER")                        { $queryw=" AND  (select count(id) from tbl_potencial_comites_colaboradores where rut=h.rut and rut_lider='$rut' and id_comite='$id_comite' limit 1) >0 ";}
//if($perfil=="SOCIO DE NEGOCIO")             { $queryw=" AND  (select count(id) from tbl_potencial_comites where rut='$rut' and id_comite='$id_comite' limit 1) >0";}
if($perfil=="USUARIO")                      { $queryw=""; exit();}


if($_SESSION["user_"]=="10365815"){
	
	
	$query_rod=" and h.rut='13461734' ";
	$query_rod="  ";

} else {
	$query_rod="  ";
}





if($cuadrante=="10"){
$sql   = "

	select h.* ,
	(select nombre_completo from tbl_usuario where rut=h.rut) as nombre_completo,
	(select promedio_metas_2020 from tbl_potencial_cuadrantes where rut=h.rut) as promedio_metas_2020,
	(select promedio_competencias_2020 from tbl_potencial_cuadrantes where rut=h.rut) as promedio_competencias_2020,
	(select propuesta_cuadrante_2020 from tbl_potencial_cuadrantes where rut=h.rut) as propuesta_cuadrante_2020,
	(select fecha_propuesta_cuadrante_2020 from tbl_potencial_cuadrantes where rut=h.rut) as fecha_propuesta_cuadrante_2020,
	(select cuadrante_2020 from tbl_potencial_cuadrantes where rut=h.rut) as cuadrante_2020,
	(select fecha_cuadrante_2020 from tbl_potencial_cuadrantes where rut=h.rut) as fecha_cuadrante_2020,
	(select cuadrante_2020_lider from tbl_potencial_cuadrantes where rut=h.rut) as cuadrante_2020_lider,
	(select d103 from tbl_data_bci where rut=h.rut) as cuadrante_actual_bci

	from 

	tbl_potencial_comites_colaboradores h

	where h.id_comite='$id_comite'
	and (
					(select propuesta_cuadrante_2020 from tbl_potencial_cuadrantes where rut=h.rut)='$cuadrante' 
					or (select propuesta_cuadrante_2020 from tbl_potencial_cuadrantes where rut=h.rut)='5+' 
					or (select cuadrante_2020 from tbl_potencial_cuadrantes where rut=h.rut)='$cuadrante' 
					or (select cuadrante_2020 from tbl_potencial_cuadrantes where rut=h.rut)='5+' 
 				  or (select cuadrante_2020_lider from tbl_potencial_cuadrantes where rut=h.rut)='5+'
					or (select cuadrante_2020_lider from tbl_potencial_cuadrantes where rut=h.rut)='$cuadrante'

					or (select d103 from tbl_data_bci where rut=h.rut)='$cuadrante'
					or (select d103 from tbl_data_bci where rut=h.rut)='5+'
	)
	
	
	$queryw
	
	$query_rod
     ";	
} else {
$sql   = "

	select h.* ,
	(select nombre_completo from tbl_usuario where rut=h.rut) as nombre_completo,
	(select promedio_metas_2020 from tbl_potencial_cuadrantes where rut=h.rut) as promedio_metas_2020,
	(select promedio_competencias_2020 from tbl_potencial_cuadrantes where rut=h.rut) as promedio_competencias_2020,
	(select propuesta_cuadrante_2020 from tbl_potencial_cuadrantes where rut=h.rut) as propuesta_cuadrante_2020,
	(select fecha_propuesta_cuadrante_2020 from tbl_potencial_cuadrantes where rut=h.rut) as fecha_propuesta_cuadrante_2020,
	(select cuadrante_2020 from tbl_potencial_cuadrantes where rut=h.rut) as cuadrante_2020,
	(select fecha_cuadrante_2020 from tbl_potencial_cuadrantes where rut=h.rut) as fecha_cuadrante_2020,
	(select cuadrante_2020_lider from tbl_potencial_cuadrantes where rut=h.rut) as cuadrante_2020_lider,
	(select d103 from tbl_data_bci where rut=h.rut) as cuadrante_actual_bci

	from 

	tbl_potencial_comites_colaboradores h

	where h.id_comite='$id_comite'
	and (
					(select propuesta_cuadrante_2020 from tbl_potencial_cuadrantes where rut=h.rut)='$cuadrante' 
					or (select cuadrante_2020 from tbl_potencial_cuadrantes where rut=h.rut)='$cuadrante'
					or (select cuadrante_2020_lider from tbl_potencial_cuadrantes where rut=h.rut)='$cuadrante'
					or (select d103 from tbl_data_bci where rut=h.rut)='$cuadrante'
	)
	
	
	$queryw
	
	$query_rod
     ";	
}
 	
 	

 
 if($_SESSION["user_"]=="10365815"){
 	if($cuadrante>5){
 		 	//echo $sql;
 	}

 	
 } 	
  $database->setquery($sql);
  $database->query();
  $cod = $database->listObjects();
  return ($cod);



}




function Potencial_Update_data($meta,$competencia,$box_propuesta,$id, $id_comite, $id_empresa){
        global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);   $fecha = date("Y-m-d");


    $sql   = "update tbl_potencial_matriz
    set niv_cumplimiento_metas='$meta',
    niv_competencias='$competencia',
    propuesta='$box_propuesta',
    id_comite='$id_comite'
    where id='$id' and id_empresa='$id_empresa'";
    echo "sql $sql"; exit();
        $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();
        return ($cod);

}
function  potencial_colaboradores_comite($id_comite, $id_empresa) {

        global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);
        $sql="delete from tbl_potencial_comites_colaboradores where id_comite='$id_comite' ";
        //echo $sql;exit;
        $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();
        return $cod;

}
function Potencial_insert_colaboradores($rut_col,$rut_lider,$id_comite,$hoy,$id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $fecha = date("Y-m-d");
    $hora  = date("H:i:s");
//$Usua=DatosUsuario_($rut, $id_empresa);
//$jefe=$Usua[0]->jefe;
         $sql   = "

            select count(h.id) as cuenta from tbl_potencial_comites_colaboradores h
            where h.id_empresa='$id_empresa' and  rut='$rut_col' and rut_lider='$rut_lider' and id_comite='$id_comite'

        ";
        $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();
        //echo "sql $sql";
        if($cod[0]->cuenta==0 and $rut_col<>'' and $rut_lider<>''){
    			$sql   = "insert into tbl_potencial_comites_colaboradores (rut,rut_lider,id_comite,fecha,id_empresa)
  	      VALUES
	        ('$rut_col','$rut_lider','$id_comite','$hoy','$id_empresa');";
			    // echo "<br>".$sql;
			    $database->setquery($sql);
			    $database->query();        
    		}
}
function Potencial_Mis_Comites_insert_data($nombre, $descripcion, $rut, $rut_lider, $nombre_lider, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $fecha = date("Y-m-d");
    $hora  = date("H:i:s");
    $nombre =   utf8_decode($nombre);
        $sql   = "

            select h.id from tbl_potencial_comites h where h.id_empresa='$id_empresa' order by id DESC limit 1

        ";
        $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();
        $id_antiguo=$cod[0]->id;
        $id_nuevo=  $id_antiguo+1;
        $id_comite="pot_".$rut_lider."_".$cod[0]->id;

    $sql   = "insert into tbl_potencial_comites
        (nombre, descripcion, rut, fecha, hora, id_empresa, id_comite, rut_lider, nombre_lider)
        VALUES
        ('$nombre','$descripcion','$rut','$fecha','$hora', '$id_empresa',
         '$id_comite','$rut_lider','$nombre_lider');";
        //echo $sql; exit();exit();
    $database->setquery($sql);
    $database->query();
}
function Potencial_Busca_Cantidad_Colaboradores_lider($rut, $id_comite, $id_empresa){
        global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);   $fecha = date("Y-m-d");
     $sql   = "
           select count(h.id) as cuenta from tbl_potencial_comites_colaboradores h where h.id_empresa='$id_empresa' and rut_lider='$rut' and id_comite='$id_comite'
     ";
        //echo "sql $sql";
        $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();
        $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();
        return ($cod[0]->cuenta);
}
function PotencialBuscaLideres($id_comite, $id_empresa){
         global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);   $fecha = date("Y-m-d");
     $sql   = "
           select h.rut_lider from tbl_potencial_comites_colaboradores h where h.id_empresa='$id_empresa' and id_comite='$id_comite'  group by h.rut_lider
     ";
//        echo "sql $sql";
        $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();
        return $cod;
}
function Potencial_Busca_Cantidad_Colaboradores_socio($rut, $id_comite, $id_empresa){
        global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);   $fecha = date("Y-m-d");
     $sql   = "
           select count(h.id) as cuenta from tbl_potencial_comites_colaboradores h where h.id_empresa='$id_empresa' and id_comite='$id_comite'
     ";
     //   echo "sql $sql";
        $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();
        $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();
        return ($cod[0]->cuenta);
}
function Potencial_Mis_Comites_data($id_empresa, $rut, $perfil,$mijefe){

				//echo "<br>$id_empresa, $rut, $perfil,$mijefe";
        global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);   $fecha = date("Y-m-d");
      
				$sql_update_99 = "update tbl_potencial_comites_colaboradores h
													set h.id_empresa='99'
													where (select id_empresa from tbl_potencial_comites where id_comite=h.id_comite) <>h.id_empresa";

        $database->setquery($sql_update_99);
        $database->query();    
        
					$Query="";
					if($perfil=="USUARIO")					{	EXIT();	}
					if($perfil=="")									{	EXIT();	}
					if($perfil=="SOCIO DE NEGOCIO")	{ $Query=" and h.rut='$rut' ";	}
					if($perfil=="LIDER")						{ $Query=" and (select count(id) from tbl_potencial_comites_colaboradores where rut_lider='$rut' and id_comite=h.id_comite) >0 ";	}

				//	if($perfil=="SOCIO DE NEGOCIO"){ $Query=" and h.rut='$rut' ";}
				if($perfil=="SOCIO DE NEGOCIO"){
			     $sql   = "	select h.* from tbl_potencial_comites h where id>0 $Query and h.id_empresa='$id_empresa'  order by fecha_comite DESC	";
				  } else {
			    
					}

			 $sql="   
			     select h.*, 
			     (select id_comite from tbl_potencial_comites where id_comite=h.id_comite) as id_comite_real,
			     (select rut from tbl_potencial_comites where id_comite=h.id_comite) as socio,
			     (select fecha_comite from tbl_potencial_comites where id_comite=h.id_comite) as fecha_comite,
			     (select nombre from tbl_potencial_comites where id_comite=h.id_comite) as nombre
										
			      from tbl_potencial_comites_colaboradores h where 
      
						(h.rut_lider='$rut' or rut_jefe_socio='$rut' or rut_jefe_socio='$rut_jefe' or rut_jefe_jefe_socio='$rut' or rut_jefe_lider='$rut' or rut_jefe_jefe_lider='$rut' 
						or (select rut from tbl_potencial_comites where id_comite=h.id_comite)='$rut'
						or (select rut_socio_2 from tbl_potencial_comites where id_comite=h.id_comite)='$rut'
						or (select rut_socio_3 from tbl_potencial_comites where id_comite=h.id_comite)='$rut'
						or (select rut_socio_4 from tbl_potencial_comites where id_comite=h.id_comite)='$rut'
						or (select rut_backup_socio from tbl_potencial_comites where id_comite=h.id_comite)='$rut'
						or rut_jefe_socio='$mijefe'
						)
						and (select id_comite from tbl_potencial_comites where id_comite=h.id_comite)<>''
						and h.id_empresa='62'
				
					group by h.id_comite
					

				UNION 


				     select j.id_comite as id , j.id_comite, 
							j.rut as rut,
							j.id_empresa as id_empresa,
							null as rut_lider,
							j.fecha as fecha,
							null as fecha_comite,
							null as hora_inicio_comite,
							null as hora_termino_comite,
							null as lugar,
							null as rut_jefe_socio,
							null as rut_jefe_jefe_socio,
							null as rut_jefe_lider,
							null as rut_jefe_jefe_lider,
							null as rut_backup_socio,
							j.id_comite as id_comite_real,
							j.rut as socio,
							j.fecha_comite as fecha_comite1,
							j.nombre as nombre
							

				    
				     
				      from tbl_potencial_comites j
				  				       where (select count(id) from tbl_potencial_comites_colaboradores where id_comite=j.id_comite)='0'
    
								and (j.rut='$rut')
								and j.id_empresa='62'
								
								group by j.id_comite
				
			";

				$SQL_SU="select id from tbl_potencial_perfil_super where rut='$rut'";
        $database->setquery($SQL_SU);
        $database->query();
        $COD_SU = $database->listObjects();
        
        if($COD_SU[0]->id>0){
         $sql="   
				     select h.*, 
				     (select id_comite from tbl_potencial_comites where id_comite=h.id_comite) as id_comite_real,
				     (select rut from tbl_potencial_comites where id_comite=h.id_comite) as socio,
				     (select fecha_comite from tbl_potencial_comites where id_comite=h.id_comite) as fecha_comite,
				     (select nombre from tbl_potencial_comites where id_comite=h.id_comite) as nombre
				     
				      from tbl_potencial_comites_colaboradores h 
				      
				      where (select id_comite from tbl_potencial_comites where id_comite=h.id_comite)<>''
								and h.id_empresa='62'		
							group by h.id_comite
											
							UNION

				     select j.id_comite as id , j.id_comite, 
							j.rut as rut,
							j.id_empresa as id_empresa,
							null as rut_lider,
							j.fecha as fecha,
							null as fecha_comite,
							null as hora_inicio_comite,
							null as hora_termino_comite,
							null as lugar,
							null as rut_jefe_socio,
							null as rut_jefe_jefe_socio,
							null as rut_jefe_lider,
							null as rut_jefe_jefe_lider,
							null as rut_backup_socio,
							j.id_comite as id_comite_real,
							j.rut as socio,
							j.fecha_comite as fecha_comite1,
							j.nombre as nombre

				      from tbl_potencial_comites j
				      
				       where (select count(id) from tbl_potencial_comites_colaboradores where id_comite=j.id_comite)='0'
				       and j.id_empresa='62'
										
							group by j.id_comite
					
			";	
        }
		
		
			/* $sql="   
	     select h.*, 
	     (select rut from tbl_potencial_comites where id_comite=h.id_comite) as socio,
	     (select fecha from tbl_potencial_comites where id_comite=h.id_comite) as fecha_comite,
	     (select nombre from tbl_potencial_comites where id_comite=h.id_comite) as nombre
	     
	      from tbl_potencial_comites_colaboradores h where 
							(h.rut_lider='$rut' or rut_jefe_socio='$rut' or rut_jefe_jefe_socio='$rut' or rut_jefe_lider='$rut' or rut_jefe_jefe_lider='$rut' or (select rut from tbl_potencial_comites where id_comite=h.id_comite)='$rut')
					group by id_comite
				";*/
 				//echo "sql<br> $sql";	   exit();

        $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();

       	//echo "<br><br>$id_empresa, $rut, $perfil<br><br>";
        //echo "ArregloOriginal<br><pre>";
        //rint_r($cod);
        //echo "</pre>";
        //echo "<br>Fin Oridinal<br>";
        
       // foreach ($cod as $unico){
        	
        	//echo "<hr>";
        	//print_r($unico);
       // }
        
        //foreach ($cod as $clave => $fila) {
        	//echo "<hr>";
        	//print_r($clave);
        	//echo "<hr>";
        	//print_r($fila);
        	
        	//echo "<br>Feca Comite fil ".$fila->fecha_comite;
        	    	$fecha_comite[$clave] = $fila->fecha_comite;
    						$fecha[$clave] 				= $fila->fecha;
    			//$fecha_comite[$clave] = $fila["fecha_comite"];
			//	}
				
  /*      echo "<br>Arreglofecha_comite<br><pre>";
				print_r($fecha_comite);
        echo "<br>FinArreglofecha_comite<br><pre>";
			
        echo "<br>Arreglofecha<br><pre>";
        
				print_r($fecha);
				 echo "</pre>";
        echo "<br>FinArreglofecha<br><pre>";

$fecha_comite  = array_column($cod, 'fecha_comite');
$fecha = array_column($cod, 'fecha');
*/

        	//$cod_ordenado=array_multisort($fecha_comite, SORT_DESC, $fecha, SORT_ASC, $cod);
         	//echo "<br>ArregloOrdenado<br><br>";
        	//echo "<pre>";
        	//print_r($cod_ordenado);
        	//echo "</pre>";
        	
//$a=array("Dog","Cat","Horse","Bear","Zebra");
//array_multisort($a);
//print_r($a);

    foreach ($cod as $key => $row) {
        $aux[$key] = $row->fecha_comite;
    }
    //echo "<br>AUX<br>";
    //print_r($aux);
    //echo "<br>FIn AUX<br>";
    array_multisort($aux, SORT_DESC, $cod);
		//print_r($cod);
   	//echo "<br>ArregloOrdenado2<br><br>";
   	//echo "<pre>";
   	//echo "</pre>";
       
       
        	
       // exit();
        return ($cod);

}



function Potencial_Colaboradores_Matriz_data($id_empresa, $rut){

        global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);   $fecha = date("Y-m-d");

     $sql   = "

     select h.* from tbl_potencial_matriz h where h.rut='$rut' and h.id_empresa='$id_empresa'  order by id DESC

     ";
        //echo "sql $sql"; exit();
        $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();
        return ($cod);

}



function Potencial_Comites_data($id_comite,$id_empresa){

        global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);   $fecha = date("Y-m-d");

     $sql   = "

     select h.*,
     (select nombre_completo    from tbl_usuario            where rut=h.rut)                as nombre_completo

     from tbl_potencial_comites h

     where h.id_comite='$id_comite' and h.id_empresa='$id_empresa'
     order by (select nombre_completo    from tbl_usuario   where rut=h.rut) ASC

     ";
        //echo "sql $sql"; 
        $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();
        return ($cod);

}

function Potencial_Comites_Suc_data($id_comite,$id_empresa){

        global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);   $fecha = date("Y-m-d");

     $sql   = "

     select h.*,
     (select nombre_completo    from tbl_usuario            where rut=h.rut)                as nombre_completo

     from tbl_potencial_comites_sucesion h

     where h.id_comite='$id_comite' and h.id_empresa='$id_empresa'
     order by (select nombre_completo    from tbl_usuario   where rut=h.rut) ASC

     ";
        //echo "sql $sql"; 
        $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();
        return ($cod);

}
function Potencial_Colaboradores_Comites_data($id_comite, $rut, $perfil, $id_empresa){

        global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);   $fecha = date("Y-m-d");

//echo "perfil $perfil";

//if($perfil=="SOCIO DE NEGOCIO") {$query=" and (select rut from tbl_potencial_comites where id_comite='$id_comite')='$rut' ";}
if($perfil=="SOCIO DE NEGOCIO") 			{}
if($perfil=="LIDER")            			{$query=" and 
	
	
	(
			h.rut_lider='$rut'  or
			h.rut_jefe_lider='$rut'  or
			h.rut_jefe_jefe_lider='$rut' 
			
		)
	
	
	
	";}
if($perfil=="VISUALIZADOR")           {$query=" and (
	
																								rut_jefe_socio='$rut' or 
																								rut_jefe_jefe_socio='$rut' or 
																								rut_jefe_lider='$rut' or 
																								rut_jefe_jefe_lider='$rut')

";}

if($perfil=="USUARIO")          {exit();}
     $sql   = "

     select h.*,
     (select nombre_completo    from tbl_usuario            where rut=h.rut)                as nombre_completo,
     (select nombre_completo    from tbl_usuario            where rut=h.rut_lider)                as nombre_lider,
     (select d151    from tbl_data_bci_2021            where rut=h.rut)                				as cargo_col

     from tbl_potencial_comites_colaboradores h

     where h.id>0 $query and h.id_comite='$id_comite' and h.id_empresa='$id_empresa'
     and (select nombre_completo    from tbl_usuario            where rut=h.rut)<>''
     order by (select nombre_completo    from tbl_usuario            where rut=h.rut) ASC

     ";
        //echo "sql $sql";
        $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();
        return ($cod);

}
function skill_busca_referencia($rut_col, $id_inst_col, $id_empresa){

        global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);

$sql_EXPERTO = "select h.* from tbl_checklist_matriz_cursos h where h.id_cargo='$id_inst_col' and h.id_empresa='$id_empresa' AND h.nivel_cargo='EXPERTO' LIMIT 1;";
$database->setquery($sql_EXPERTO);$database->query();
$cod_EXPERTO = $database->listObjects();

$sql_MEDIO = "select h.* from tbl_checklist_matriz_cursos h where h.id_cargo='$id_inst_col' and h.id_empresa='$id_empresa' AND h.nivel_cargo='MEDIO' LIMIT 1;";
$database->setquery($sql_MEDIO);$database->query();
$cod_MEDIO = $database->listObjects();

$sql_BASE = "select h.* from tbl_checklist_matriz_cursos h where h.id_cargo='$id_inst_col' and h.id_empresa='$id_empresa' AND h.nivel_cargo='BASE' LIMIT 1;";
$database->setquery($sql_BASE);$database->query();
$cod_BASE = $database->listObjects();

$arreglo["ec_02_BASE"]      =$cod_BASE[0]->ec_02_anos;
$arreglo["ec_03_BASE"]      =$cod_BASE[0]->ec_03_estudios;
$arreglo["ec_04_BASE"]      =$cod_BASE[0]->ec_04_tareas;
$arreglo["ec_05_BASE"]      =$cod_BASE[0]->ec_05impacto;
$arreglo["ec_06_BASE"]      =$cod_BASE[0]->ec_06_meto;

$arreglo["ec_02_MEDIO"]     =$cod_MEDIO[0]->ec_02_anos;
$arreglo["ec_03_MEDIO"]     =$cod_MEDIO[0]->ec_03_estudios;
$arreglo["ec_04_MEDIO"]     =$cod_MEDIO[0]->ec_04_tareas;
$arreglo["ec_05_MEDIO"]     =$cod_MEDIO[0]->ec_05impacto;
$arreglo["ec_06_MEDIO"]     =$cod_MEDIO[0]->ec_06_meto;

$arreglo["ec_02_EXPERTO"]   =$cod_EXPERTO[0]->ec_02_anos;
$arreglo["ec_03_EXPERTO"]   =$cod_EXPERTO[0]->ec_03_estudios;
$arreglo["ec_04_EXPERTO"]   =$cod_EXPERTO[0]->ec_04_tareas;
$arreglo["ec_05_EXPERTO"]   =$cod_EXPERTO[0]->ec_05impacto;
$arreglo["ec_06_EXPERTO"]   =$cod_EXPERTO[0]->ec_06_meto;



        return ($arreglo);

}
function SkillChallengeInscribeCursos($id_curso, $id_skill, $id_cargo, $proceso, $rut, $id_empresa){
      //echo   "($id_curso, $id_skill, $id_cargo, $proceso, $rut, $id_empresa"; exit();
     global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $fecha = date("Y-m-d");

    $sql="select id from tbl_checklist_inscripcion_cursos_usuarios where rut='$rut' and id_cargo='$id_cargo' and id_skill='$id_skill'
    and id_curso='$id_curso' and id_empresa='$id_empresa'";
        $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();

        if($cod[0]->id>0){


        }   else {
    $sql   = "insert into tbl_checklist_inscripcion_cursos_usuarios (id_curso,id_skill,id_cargo,fecha,hora,rut,id_empresa,proceso)
        VALUES
        ('$id_curso','$id_skill','$id_cargo','$fecha','$hora','$rut', '$id_empresa', '$proceso');";

        }

        //echo $sql; exit();
    $database->setquery($sql);
    $database->query();

}

function ActualizaSkillChallengeUpdateResultado($rut_col,$id_inst,$id_empresa,$porcentaje_ajuste_base,$porcentaje_ajuste_medio,$porcentaje_ajuste_experto,$mayor_ajuste,$nivel_ec,$ajuste_final){

        global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);   $fecha = date("Y-m-d");

     $sql   = "update tbl_checklist_rut_cargo set

        ajustenivelbase     ='$porcentaje_ajuste_base',
        ajustenivelmedio    ='$porcentaje_ajuste_medio',
        ajustenivelexperto  ='$porcentaje_ajuste_experto',
        nivel_skill         ='$mayor_ajuste',
        nivel_experiencia   ='$nivel_ec',
        mayorajuste         ='$ajuste_final'


    where rut='$rut_col' and id_cargo='$id_inst'  and id_empresa='$id_empresa'";
    //echo "sql $sql"; exit();
        $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();
        return ($cod);
}
function Skill_IdCargo_full($id_empresa){
         global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);

        $sql = "
            select h.id_cargo, h.cargo from tbl_checklist_matriz_cursos h where h.id_empresa='$id_empresa'	 group by h.id_cargo order by h.cargo

        ";

        //echo $sql;

        $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();
        return ($cod);
}
function Skill_cierra_calibracion($rut_col, $rut_jefe, $id_cargo, $id_empresa){
         global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);   $fecha = date("Y-m-d");


    $sql   = "update tbl_checklist_rut_cargo set fecha_calibracion='$fecha', calibracion='SI'
    where rut='$rut_col' and id_cargo='$id_cargo'  and rut_jefe='$rut_jefe' and id_empresa='$id_empresa'";
    //echo "sql $sql"; exit();
        $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();
        return ($cod);
}
function skill_buscaData_validacion_data($rut, $id_cargo, $id_empresa){

        global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);

        $sql = "
            select count(id) as cuenta

            from tbl_checklist_rut_cargo

            where rut='$rut'

            and id_cargo='$id_cargo'
            and id_empresa='$id_empresa'
            and calibracion is not null
        ";

        //echo $sql;

        $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();
        return ($cod[0]->cuenta);

}
function Busca_Acreditacion_rut_skill_cargo($rut_col, $id_skill,$id_inst, $id_empresa){
         global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);

        $sql = "
            select h.* from tbl_checklist_documentos h
            where h.id_empresa='$id_empresa' and h.id_skill='$id_skill'  and h.rut='$rut_col'
            and h.id_cargo='$id_inst'

        ";

        //echo $sql;

        $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();
        return ($cod);
}
function Busca_Respuestas_Plan_rut_skill_cargo($rut_col, $id_skill,$id_inst, $id_empresa){
         global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);

        $sql = "
            select h.* from tbl_checklist_skill_usuarios h
            where h.id_empresa='$id_empresa' and h.id_skill='$id_skill'  and h.rut='$rut_col'
            and h.id_cargo='$id_inst'

        ";
        //echo $sql;
        $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();
        return ($cod);
}
function Skill_Busca_datos_id_Cargo($id_inst, $id_empresa){

        global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);

        $sql = "
            select h.* from tbl_checklist_matriz_cursos h
            where h.id_empresa='$id_empresa' and h.id_cargo='$id_inst'
            group by h.id_skill order by h.skill ASC
        ";
        //echo $sql;
        $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();
        return ($cod);


}

function Ass_Busca_Equipo_con_Rut_Cargo_skill($rut, $id_empresa){

        global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);

        $sql = "
            select h.*,
(select nombre_completo from tbl_usuario where rut=h.rut) as nombre_completo,
(select cargo from tbl_usuario where rut=h.rut) as cargo,
(select cargo from tbl_checklist_matriz_cursos where id_cargo=h.id_cargo limit 1) as cargo_skill

from tbl_checklist_rut_cargo h
where h.id_empresa='$id_empresa' and h.rut_jefe='$rut'
and (select nombre_completo from tbl_usuario where rut=h.rut) is not null
        ";

        //echo "sql $sql";
        $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();
        return ($cod);

}

function Ass_Busca_Equipo_con_RutCol_Cargo_skill($rut, $id_empresa){

        global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);

        $sql = "
            select h.*,
(select nombre_completo from tbl_usuario where rut=h.rut) as nombre_completo,
(select cargo from tbl_usuario where rut=h.rut) as cargo,
(select cargo from tbl_checklist_matriz_cursos where id_cargo=h.id_cargo limit 1) as cargo_skill

from tbl_checklist_rut_cargo h
where h.id_empresa='$id_empresa' and h.rut='$rut'
        ";

        //echo "sql $sql";
        $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();
        return ($cod);

}

function  TraigoUltimoJsonPorRut($rut) {

        global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);

        $sql = "select * from tbl_json_ext where rut='$rut' order by fecha desc, hora desc";
        $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();
        return ($cod);

}


function  InsertaSQLDinamico($sql) {

        global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);
        //$sql="delete  from tbl_checklist_impacto where id='$id' ";
        //echo $sql;exit;
        $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();
        return $cod;

}


function  EliminaImpacto($id) {

        global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);
        $sql="delete  from tbl_checklist_impacto where id='$id' ";
        $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();
        return $cod;

}


function  EliminaMetodologia($id) {

        global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);
        $sql="delete  from tbl_checklist_metodologia where id='$id' ";
        $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();
        return $cod;

}

function  EliminaEstudios($id) {

        global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);
        $sql="delete from tbl_checklist_estudios_formales where id='$id' ";

        $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();
        return $cod;

}


function  EliminaExperiencias($id) {

        global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);
        $sql="delete from tbl_checklist_experiencias_laborales where id='$id' ";
        $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();
        return $cod;

}

function AssChequeaConvalidacionDocumentacion($id_inst,$id_skill,$DATA,$rut_col,$rut_jefe, $id_empresa){

    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $fecha = date("Y-m-d");

    $sql="select id from tbl_checklist_documentos where rut='$rut_col' and id_cargo='$id_inst' and id_skill='$id_skill' and id_empresa='$id_empresa'";
    //echo "sql $sql";

    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod[0]->id;

}
function ass_save_respuesta_plan_validacion($id_inst,$id_skill,$nivel,$rut_col,$rut_jefe, $id_empresa){
    //echo "<br> $id_inst,$id_skill,$nivel,$rut_col,$rut_jefe, $id_empresa";
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $fecha = date("Y-m-d");

    $sql="select id from tbl_checklist_skill_usuarios where rut='$rut_col' and id_cargo='$id_inst' and id_skill='$id_skill' and rut_jefe='$rut_jefe' and id_empresa='$id_empresa'";
        $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();

        if($cod[0]->id>0){
    $sql   = "update tbl_checklist_skill_usuarios set opcion_por_desarrollar='$nivel'
    where rut='$rut_col' and id_cargo='$id_inst' and id_skill='$id_skill' and rut_jefe='$rut_jefe' and id_empresa='$id_empresa'";

        }   else {
    $sql   = "insert into tbl_checklist_skill_usuarios (id_cargo,id_skill,opcion_por_desarrollar,rut,rut_jefe,fecha,id_empresa)
        VALUES
        ('$id_inst','$id_skill','$nivel','$rut_col','$rut_jefe','$fecha', '$id_empresa');";

        }

        //echo $sql; exit();
    $database->setquery($sql);
    $database->query();
    //echo $sql;
}
function SkillSaveNewCargoRut($rut,$id_cargo, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $fecha = date("Y-m-d");
    $hora  = date("H:i:s");
$Usua=DatosUsuario_($rut, $id_empresa);
$jefe=$Usua[0]->jefe;
    $sql   = "insert into tbl_checklist_rut_cargo (rut,id_cargo,rut_jefe,id_empresa)
        VALUES
        ('$rut','$id_cargo','$jefe','$id_empresa');";

        //echo $sql; exit();exit();
    $database->setquery($sql);
    $database->query();
}
function InsertaTalSkill_Acreditacion($rut,$id_skill,$id_cargo,$fecha,$documento, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $hoy   = date('Y-m-d');
    $fecha = date("Y-m-d");
    $hora  = date("H:i:s");
    $sql   = "insert into tbl_checklist_documentos (rut,id_skill,id_cargo,fecha,documento,id_empresa)
        VALUES
        ('$rut','$id_skill','$id_cargo','$fecha','$documento', '$id_empresa');";
        //echo $sql; exit();exit();
    $database->setquery($sql);
    $database->query();
}
function SkillBuscaJefatura($rut, $id_empresa){
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $hoy   = date('Y-m-d');
    $fecha = date("Y-m-d");
    $hora  = date("H:i:s");
    $sql   = "select h.rut_jefe
    from tbl_checklist_rut_cargo h
    where h.rut='$rut' and h.id_empresa='$id_empresa'
    limit 1";
    //echo "<br>".$sql;
    $database->setquery($sql);
    $database->query();

    $cod = $database->listObjects();
    return $cod[0]->rut_jefe;
}
function Skill_BuscaAcreditacion($rut, $id_empresa, $id_skill, $id_inst){
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $hoy   = date('Y-m-d');
    $fecha = date("Y-m-d");
    $hora  = date("H:i:s");
    $sql   = "select h.* ,
    (select skill from tbl_checklist_matriz_cursos where id_skill=h.id_skill limit 1) as skill
    from tbl_checklist_documentos h
    where h.rut='$rut' and h.id_empresa='$id_empresa' and h.id_skill='$id_skill'
    and h.id_cargo='$id_inst' and h.documento<>''";
    //echo "<br>".$sql;
    $database->setquery($sql);
    $database->query();

    $cod = $database->listObjects();
    return $cod;

}
function Skill_BuscaAcreditacionVistaJefe($rut, $id_empresa, $id_inst){
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $hoy   = date('Y-m-d');
    $fecha = date("Y-m-d");
    $hora  = date("H:i:s");
    $sql   = "select h.*,
    (select skill from tbl_checklist_matriz_cursos  where id_cargo='$id_inst' and id_skill=h.id_skill  limit 1) as SkillNombre
    from tbl_checklist_documentos h
    where h.rut='$rut' and h.id_empresa='$id_empresa'
    and h.id_cargo='$id_inst' and h.documento<>''";
    //echo $sql;
    $database->setquery($sql);
    $database->query();

    $cod = $database->listObjects();
    return $cod;

}
function InsertaMetodologia($rut, $id_empresa, $ec_met, $ec_met_otro)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $hoy   = date('Y-m-d');
    $fecha = date("Y-m-d");
    $hora  = date("H:i:s");
    $ec_met=utf8_encode($ec_met);
    $ec_met_otro=utf8_encode($ec_met_otro);
    $sql   = "insert into tbl_checklist_metodologia (rut, id_empresa, metodologia, metodologia_otro)
        VALUES
        ( '$rut', '$id_empresa', '$ec_met', '$ec_met_otro');";

    $database->setquery($sql);
    $database->query();
}
function DatosMEtodologia($id_empresa, $rut)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "    select * from tbl_checklist_metodologia where rut='$rut' and id_empresa='$id_empresa'    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return ($cod);
}

function InsertaImpacto($rut, $id_empresa, $ec_14, $ec_15, $ec_16)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $hoy   = date('Y-m-d');
    $fecha = date("Y-m-d");
    $hora  = date("H:i:s");
    $sql   = "insert into tbl_checklist_impacto (rut, id_empresa, volumen, complejidad, dificultades)
        VALUES
        ( '$rut', '$id_empresa', '$ec_14', '$ec_15', '$ec_16');";

    $database->setquery($sql);
    $database->query();
}

function DatosImpacto($id_empresa, $rut)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "    select * from tbl_checklist_impacto where rut='$rut' and id_empresa='$id_empresa'    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return ($cod);
}


function InsertaExperienciaLaboral($rut, $id_empresa, $ec_11, $ec_12, $ec_13)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $hoy   = date('Y-m-d');
    $fecha = date("Y-m-d");
      $ec_13=($ec_13);

    $hora  = date("H:i:s");
    $sql   = "insert into tbl_checklist_experiencias_laborales (rut, id_empresa, tareas, empresa, duracion)
        VALUES
        ( '$rut', '$id_empresa', '$ec_11', '$ec_12', '$ec_13');";

    $database->setquery($sql);
    $database->query();
}

function DatosExperienciasLaborales($id_empresa, $rut)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "    select * from tbl_checklist_experiencias_laborales where rut='$rut' and id_empresa='$id_empresa'    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return ($cod);
}


function InsertaEstudiosFormales($rut, $id_empresa, $ec_tes, $ec_fi, $ec_tit, $ec_ft, $ec_cf, $ec_sta, $ec_tes_otro, $ec_tit_otro, $ec_cf_otro)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $hoy   = date('Y-m-d');
    $fecha = date("Y-m-d");
    $hora  = date("H:i:s");
    $sql   = "insert into tbl_checklist_estudios_formales (rut, id_empresa, tipo_estudio, fecha_inicio, nombre_estudio, fecha_termino, casa_estudio, situacion_actual, otro_estudio, otro_nombre_estudio, otra_casa_estudio )
        VALUES
        ( '$rut', '$id_empresa', '$ec_tes', '$ec_fi', '$ec_tit', '$ec_ft', '$ec_cf', '$ec_sta', '$ec_tes_otro', '$ec_tit_otro', '$ec_cf_otro');";
    $database->setquery($sql);
    $database->query();
}


function DatosOtrosEstudiosFormales($id_empresa, $rut)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "   SELECT
    tbl_checklist_estudios_formales.*, nombre_estudio.nombre_item, nombre_casa_estudio.nombre_item as descripcion_casa_estudio
FROM
    tbl_checklist_estudios_formales

left join tbl_checklist_item as nombre_estudio on nombre_estudio.id_item=tbl_checklist_estudios_formales.nombre_estudio and nombre_estudio.tipo='titulos'
left join tbl_checklist_item as nombre_casa_estudio on nombre_casa_estudio.id_item=tbl_checklist_estudios_formales.casa_estudio and nombre_casa_estudio.tipo='centro_formacion'

WHERE
    rut = '$rut'
AND tbl_checklist_estudios_formales.id_empresa = '$id_empresa'";


    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return ($cod);
}


function MP_SearchBannedWordsInjection($id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "    SELECT
    * FROM tbl_sql_injection
    ";

    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return ($cod);
}

function BuscaAgradecimientobasadoenId($id, $id_empresa){
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql="

    select h.*
    from tbl_reconoce_gracias h
    where h.id_empresa='$id_empresa' and h.id='$id' ";
    //echo $sql;
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    //echo "<br>LMS_BuscarJuego_todosCasosPistas $sql";
    return $cod;
}

function LMS_BuscarJuego_todosCasosPistas($id_juego, $rut, $id_empresa){


    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql="

    select h.*,
    (select correcta from tbl_lms_juego_caso_respuestas_pistas where id_juego=h.id_juego and id_pista=h.id_pista and id_caso=h.id_caso and rut='$rut') as PistaCorrecta
    from tbl_lms_juego_caso h
    where h.id_empresa='$id_empresa' and h.id_juego='$id_juego' ";
    //echo $sql;
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    //echo "<br>LMS_BuscarJuego_todosCasosPistas $sql";
    return $cod;


}
function LG_obtener_malla_individual($rut, $id_empresa){
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select id_malla from rel_lms_malla_persona where rut='$rut' and id_empresa='$id_empresa'
    and id_malla like 'lg_desafios%'";
    //echo $sql;
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod[0]->id_malla;
}
function JuegoAgregaPuntosPistas($id_caso, $id_pista, $id_juego, $puntosPistas, $respuesta, $rut, $correcta, $id_empresa){


    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);

            $fecha = date("Y-m-d");
            $hora  = date("H:i:s");

            $sql="SELECT count(id) as cuenta from tbl_lms_juego_caso_respuestas_pistas where
            id_juego='$id_juego' and id_pista='$id_pista' and id_caso='$id_caso' and   rut='$rut' and id_empresa='$id_empresa'


             ";
        $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();

        //print_r($cod); sleep(3);
      if($cod[0]->cuenta>0) {
         $sql   = "UPDATE  tbl_lms_juego_caso_respuestas_pistas set respuesta='$respuesta', correcta='$correcta' , puntos='$puntosPistas'
                        where    id_juego='$id_juego' and id_pista='$id_pista' and id_caso='$id_caso' and     rut='$rut' and id_empresa='$id_empresa' ";
      }   else {


            $sql   = "INSERT INTO

            tbl_lms_juego_caso_respuestas_pistas

            (id_juego,id_pista,id_caso,rut,respuesta,id_empresa,correcta,puntos,fecha,hora)

            values
            ('$id_juego','$id_pista','$id_caso','$rut',
            '$respuesta','$id_empresa','$correcta','$puntosPistas','$fecha','$hora')

            ";
      }
    //echo $sql; sleep(3);
    $database->setquery($sql);
    $database->query();
    return $cod;

}

function JuegoAgregaPuntosRespuestas($id_caso, $id_juego, $puntos, $respuesta, $rut, $correcta, $id_empresa){


    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);

            $fecha = date("Y-m-d");
            $hora  = date("H:i:s");

            $sql="SELECT count(id) as cuenta from tbl_lms_juego_caso_respuestas where
            id_juego='$id_juego' and id_caso='$id_caso' and   rut='$rut' and id_empresa='$id_empresa'


             ";
        $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();

        //print_r($cod); sleep(3);
      if($cod[0]->cuenta>0) {
         $sql   = "UPDATE  tbl_lms_juego_caso_respuestas set respuesta='$respuesta', correcta='$correcta'
                        where    id_juego='$id_juego'  and id_caso='$id_caso' and   rut='$rut' and id_empresa='$id_empresa' ";
      }   else {


            $sql= "INSERT INTO

            tbl_lms_juego_caso_respuestas

            (id_juego,id_caso,rut,respuesta,id_empresa,correcta,puntos,fecha,hora)

            values
            ('$id_juego','$id_caso','$rut',
            '$respuesta','$id_empresa','$correcta','$puntos','$fecha','$hora')

            ";
      }
                                                                                              //  echo $sql; sleep(3);
    $database->setquery($sql);
    $database->query();
    return $cod;

}

function LMS_BuscarCasoPregunta_Juego($id_caso, $id_pista, $id_juego, $rut, $id_empresa){


    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql="

    select h.* from tbl_lms_juego_caso h where h.id_empresa='$id_empresa' and h.id_juego='$id_juego' and h.id_caso='$id_caso' and h.id_pista='$id_pista'  ";
    //echo $sql;
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    //echo "<br>$sql";
    return $cod;


}

function BuscaNombreFinalJuego($id_juego, $id_caso, $id_pista, $id_empresa){

        global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);
        $respuesta=utf8_decode($respuesta);
        $sql="
           select h.*
            from tbl_lms_juego_caso h where
             h.id_empresa='$id_empresa'
        and h.id_juego='$id_juego' and h.id_caso='$id_caso' and id_pista='$id_pista'
        ";
        //echo "<br>BuscaNombreFinalJuego ".$sql;echo "<br>";

        $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();   //print_r($cod); exit();
        return $cod;

}

function BuscaNombreFinalJuegoCorrecta($id_juego, $id_caso, $id_empresa){

        global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);
        $respuesta=utf8_decode($respuesta);
        $sql="
           select h.*
            from tbl_lms_juego_caso h where
             h.id_empresa='$id_empresa'
        and h.id_juego='$id_juego' and h.id_caso='$id_caso' and id_pista=correcta
        ";
        //echo "<br>BuscaNombreFinalJuego ".$sql;echo "<br>";

        $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();   //print_r($cod); exit();
        return $cod;

}

function BuscaRespuestaFinalJuego($rut,$id_juego,$id_caso, $id_empresa){

        global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);
        $respuesta=utf8_decode($respuesta);
        $sql="
           select h.*
            from tbl_lms_juego_caso_respuestas h where
             h.id_empresa='$id_empresa' and h.rut='$rut'
        and h.id_juego='$id_juego' and h.id_caso='$id_caso'
        ";
      // echo "<br>BuscaRespuestaFinalJuego ".$sql;echo "<br>";

        $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();   //print_r($cod); exit();
        return $cod;

}

function BuscaRespuestaPregunta_Juego($id_caso, $id_pista, $id_juego, $respuesta, $id_empresa){

        global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);
        $respuesta=utf8_decode($respuesta);
        $sql="
           select count(h.id) as correcta, h.puntospistas, h.puntos
            from tbl_lms_juego_caso h where h.id_empresa='$id_empresa'
        and h.id_juego='$id_juego' and h.id_pista='$id_pista' and h.id_caso='$id_caso' and h.respuesta like '%$respuesta%'
        ";
        //echo "<br>BuscaRespuestaPregunta_Juego ".$sql;echo "<br>";

        $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();   //print_r($cod); exit();
        return $cod;

}

function BuscaRespuestaFinalPregunta_Juego($id_caso, $respuesta, $id_juego, $id_empresa){

        global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);
        $respuesta=utf8_decode($respuesta);
        $sql="
           select count(h.id) as correcto, h.puntos
            from tbl_lms_juego_caso h where h.id_empresa='$id_empresa'
        and h.id_juego='$id_juego' and h.id_caso='$id_caso' and h.correcta = '$respuesta'
        ";
       // echo "<br>BuscaRespuestaFinalPregunta_Juego ".$sql;echo "<br>";

        $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();   //print_r($cod); exit();
        return $cod;

}
function BuscaPistasCorrectas_Juego($rut, $id_juego, $id_empresa){

        global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);

        $sql="
           select h.* from tbl_lms_juego_caso_respuestas_pistas h where h.id_empresa='$id_empresa'
           and h.id_juego='$id_juego' and h.rut='$rut'
           and h.id_juego='$id_juego' and h.rut='$rut'
        ";
        //echo "<br>BuscaPistasCorrectas_Juego ".$sql;;

        $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();
        return $cod;

}

function BuscaRespuestasCorrectas_Juego($rut, $id_juego, $id_empresa){

        global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);

        $sql="
           select h.* from tbl_lms_juego_caso_respuestas h where h.id_empresa='$id_empresa'
           and h.id_juego='$id_juego' and h.rut='$rut'
        ";
       // echo "<br>BuscaRespuestasCorrectas_Juego ".$sql;;

        $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();
        return $cod;

}


function Ben_benDimension($id_empresa, $id_dimension){

        global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);

        $sql="
           select h.* from tbl_beneficios h where h.id_empresa='$id_empresa' and h.id_dimension='$id_dimension'  group by h.id_dimension
        ";  //echo $sql;

        $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();
        return $cod;

}

function Ben_benItemsDimension($id_empresa, $id_dimension, $id_items){

        global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);

        $sql="
           select h.* from tbl_beneficios h where h.id_empresa='$id_empresa' and h.id_dimension='$id_dimension'
           and h.id_beneficios='$id_items'  group by h.id_beneficios
        ";  //echo $sql;

        $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();
        return $cod;

}

function Ben_benlistaPorDimension_data($id_empresa, $rut, $id_dimension){

        global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);
$QueryFiltro="";
if($id_empresa=="61"){

$Usua=DatosUsuario_($rut, $id_empresa);
$mundo= $Usua[0]->mundo;

//echo "mundo $mundo";

$QueryFiltro= " and (h.filtro1<>'$mundo') and (h.filtro2<>'$mundo')";
}

        $sql="
            select h.* from tbl_beneficios h where h.id_empresa='$id_empresa' and h.id_dimension='$id_dimension' $QueryFiltro order by h.orden, h.nombre
        ";
       // echo $sql;

        $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();
        //print_r($cod);
        return $cod;

}
function SkillVerificaEtapa2ColSave($rut, $id_empresa){

       global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);

        $sql="select h.* ,

(select count(id) from tbl_checklist_estudios_formales where rut=h.rut and id_empresa=h.id_empresa) as cuenta1,
(select count(id) from tbl_checklist_experiencias_laborales where rut=h.rut and id_empresa=h.id_empresa) as cuenta2,
(select count(id) from tbl_checklist_impacto where rut=h.rut and id_empresa=h.id_empresa) as cuenta3,
(select count(id) from tbl_checklist_metodologia where rut=h.rut and id_empresa=h.id_empresa) as cuenta4

from tbl_checklist_rut_cargo h

where h.rut='$rut' and h.id_empresa='$id_empresa' limit 1 ";  //echo $sql;
       //echo "<br>sql $sql";//exit();
        $database->setquery($sql);
         $database->query();
        $cod = $database->listObjects();
        $verifica=0;
        if($cod[0]->cuenta1>0 and $cod[0]->cuenta2>0 and $cod[0]->cuenta3>0 and $cod[0]->cuenta4>0) {$verifica=1;}

        return $verifica;

}
function Ass_busca_skills($id_inst, $id_empresa){

        global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);

        $sql="select h.* from tbl_checklist_respuestas h where h.id_empresa='$id_empresa' and h.id_instrumento='$id_inst' and h.ec is null
         group by h.id_skill ";  //echo $sql;

        $database->setquery($sql);
         $database->query();
        $cod = $database->listObjects();
        return $cod;
}
function Ass_Busca_nivel_esperado_skill_cargo($id_inst, $id_skill, $nivel, $id_empresa){
         global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);

            $sql="select h.* from tbl_checklist_matriz_cursos h where h.id_empresa='$id_empresa'
        and h.id_skill='$id_skill' and h.id_cargo='$id_inst' and h.nivel_cargo='$nivel'   LIMIT 1";
        //echo "sql $sql"; exit();
        $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();

         if(count($cod)=='0'){
               $sql="select h.* from tbl_checklist_matriz_cursos h where h.id_empresa='$id_empresa'
                and h.id_skill='$id_skill' and h.id_cargo='$id_inst'   LIMIT 1";
                $database->setquery($sql);
                $database->query();
                $cod = $database->listObjects();
         }
        // print_r($cod);
        // exit();
        //print_r($cod);
        if($cod[0]->nivel_skill=="A"){$nivel_esperado=4;}
        if($cod[0]->nivel_skill=="M"){$nivel_esperado=3;}
        if($cod[0]->nivel_skill=="B"){$nivel_esperado=2;}
        //echo "<br>nivel_esperado $nivel_esperado";
        return $nivel_esperado;
}
function Ass_busca_rut_ins_perfil_respuestas_x_skill($rut, $id_inst, $skill, $id_empresa){
       // echo "<br>$rut, $id_inst, $skill, $id_empresa";
         global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);

        $sql="select h.col_respuesta, h.jefe_respuesta,
        (select nombre_completo from tbl_usuario where rut=h.rut_colaborador) as nombre_completo
        from tbl_checklist_respuestas h
        where h.id_empresa='$id_empresa' and h.rut_colaborador='$rut'
        and h.id_instrumento='$id_inst' and h.id_skill='$skill' and h.ec is null";

        //echo "<br>".$sql;
        //exit();

        $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();
        return $cod;
}

function Ass_busca_rut_ins_perfil_respuestas_x_skill_limit1($rut, $id_inst, $id_empresa){
       // echo "<br>$rut, $id_inst, $skill, $id_empresa";
         global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);

        $sql="select col_comentario from tbl_checklist_respuestas where id_empresa='$id_empresa' and rut_colaborador='$rut'
        and id_instrumento='$id_inst' and col_comentario<>'' and ec is null limit 1";
        //echo "<br>".$sql;exit();
        $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();
        return $cod;
}

function Ass_busca_rut_ins_perfil_respuestas_exp_crit($rut, $id_inst, $id_empresa){
       // echo "<br>$rut, $id_inst, $skill, $id_empresa";
         global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);

        $sql="  select id_skill, respuesta_abierta, jefe_respuesta from tbl_checklist_respuestas
                where id_empresa='$id_empresa' and rut_colaborador='$rut'
                and id_instrumento='$id_inst' and ec='ec' ";
$sql="  select id_skill, respuesta_abierta, jefe_respuesta from tbl_checklist_respuestas
                where id_empresa='$id_empresa' and rut_colaborador='$rut'
                and  ec='ec' ";
                //echo "<br><br><br><br>sql<br>".$sql;
        $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();
        return $cod;
}

function Skill_busca_respuestas_etapa2($rut, $rut_col,$id_inst_col, $id_empresa){

          global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);

        $sql="select count(h.id) as cuenta

        from tbl_checklist_respuestas h

        where

         h.id_empresa='$id_empresa' and h.rut_colaborador='$rut_col'
         and h.rut_jefe='$rut'
         and h.id_instrumento='$id_inst_col'
         and h.jefe_respuesta<>''
         and h.ec='ec'

         order by id_skill ASC";  //echo $sql;
         //echo "<br>".$sql;exit();
        $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();
        return $cod;

}

function Skill_busca_respuestas_etapa2_detalle($rut, $rut_col,$id_inst_col, $id_empresa){

          global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);

        $sql="select h.*

        from tbl_checklist_respuestas h

        where

         h.id_empresa='$id_empresa' and h.rut_colaborador='$rut_col'
         and h.rut_jefe='$rut'
         and h.id_instrumento='$id_inst_col'
         and h.jefe_respuesta<>''
         and h.ec='ec'

         order by id_skill ASC";  //echo $sql;
         //echo "<br>".$sql;exit();
        $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();
        return $cod;

}

function Ass_busca_rut_ins_perfil_respuestas($rut, $id_inst, $id_skill, $id_empresa){

         global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);

        $sql="select h.col_respuesta, h.jefe_respuesta, h.col_comentario,
         (select nombre_completo from tbl_usuario where rut=h.rut_colaborador) as nombre_completo
         from tbl_checklist_respuestas h where
         h.id_empresa='$id_empresa' and h.rut_colaborador='$rut'
         and h.id_instrumento='$id_inst' and h.id_skill='$id_skill' and h.ec is null order by id_skill ASC";  //echo $sql;
         //echo "<br>".$sql;exit();
        $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();
        return $cod;
}
function Ass_busca_rut_ins_perfil_respuestas_jefe($rut, $rut_col, $id_inst, $id_skill, $id_empresa){

         global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);

        $sql="select h.col_respuesta, h.jefe_respuesta, h.col_comentario,
         (select nombre_completo from tbl_usuario where rut=h.rut_colaborador) as nombre_completo
         from tbl_checklist_respuestas h where
         h.id_empresa='$id_empresa' and h.rut_jefe='$rut'  and h.rut_colaborador='$rut_col'
         and h.id_instrumento='$id_inst' and h.id_skill='$id_skill' and h.ec is null order by id_skill ASC";  //echo $sql;
         //echo "<br>".$sql;exit();
        $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();
        return $cod;
}
function Ass_busca_rut_ins_Full_respuestas($rut, $id_inst, $id_empresa){

         global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);

        $sql="select col_respuesta from tbl_checklist_respuestas where id_empresa='$id_empresa' and rut_colaborador='$rut'
        and id_instrumento='$id_inst' ";  //echo $sql;
        $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();
        return $cod;
}

function SkillBuscaIdCargoRut($rut, $id_empresa){
         global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);

        $sql="select id_cargo from tbl_checklist_rut_cargo where id_empresa='$id_empresa' and rut='$rut'  order by id DESC limit 1
        ";
        //echo "SkillBuscaIdCargoRut<br>".$sql;
        $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();
        return $cod[0]->id_cargo;
}
function SkillBuscaFullCargoRut($rut, $id_empresa){
         global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);

        $sql="select * from tbl_checklist_rut_cargo where id_empresa='$id_empresa' and rut='$rut'  order by id DESC limit 1
        ";
        //echo "SkillBuscaIdCargoRut<br>".$sql;
        $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();
        return $cod;
}
function ass_save_respuesta_data($id_instrumento,$id_empresa,$fecha,$hora,$id_skill,$col_respuesta,$col_comentario,
                                    $rut_colaborador,$jefe_respuesta,$jefe_comentario,$rut_jefe)  {
      /*/
        echo "<br>ass_save_respuesta_data<br>
        $id_instrumento,$id_empresa,$fecha,$hora,$id_skill,$col_respuesta,$col_comentario,
        $rut_colaborador,$jefe_respuesta,$jefe_comentario,$rut_jefe";   sleep(1);      */

        global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);

        $sql="select id from tbl_checklist_respuestas where id_empresa='$id_empresa' and rut_colaborador='$rut_colaborador'
        and id_instrumento='$id_instrumento' and id_skill='$id_skill'";
        $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();


        //echo "<br><br>"; echo $sql;
        //sleep(5); echo "<br><br>";

        if($rut_colaborador==''){
                                    echo "Falta RUT del Colaborador"; sleep(3);
        } else {

                if($cod[0]->id<>'' and $rut_jefe<>''){

                                       $fecha = date("Y-m-d");
                                        $sql = "update

                                        tbl_checklist_respuestas

                                        set

                                        rut_jefe='$rut_jefe',
                                        jefe_respuesta='$jefe_respuesta',
                                        fecha_calibracion='$fecha'
                                        where id_empresa='$id_empresa'
                                        and rut_colaborador='$rut_colaborador'
                                        and id_instrumento='$id_instrumento' and id_skill='$id_skill' ";
                                        $database->setquery($sql);
                                        $database->query();
                }
                    else  if($cod[0]->id<>'' and $rut_colaborador<>''){


                                        $sql = "update

                                        tbl_checklist_respuestas

                                        set

                                        rut_colaborador='$rut_colaborador',
                                        col_respuesta='$col_respuesta'

                                        where id_empresa='$id_empresa'
                                        and rut_colaborador='$rut_colaborador'
                                        and id_instrumento='$id_instrumento'  and id_skill='$id_skill' ";
                                        $database->setquery($sql);
                                        $database->query();

                } else {


                                        $fecha = date("Y-m-d");
                                        $hora  = date("H:i:s");

                                        $fecha_estado=$fecha;


                                        $sql   = "INSERT INTO

                                        tbl_checklist_respuestas

                                        (id_instrumento,id_empresa,
                                        fecha,hora,id_skill,col_respuesta,col_comentario,
                                        rut_colaborador,jefe_respuesta,jefe_comentario,rut_jefe)

                                        values

                                        ('$id_instrumento','$id_empresa',
                                        '$fecha','$hora','$id_skill','$col_respuesta','$col_comentario',
                                        '$rut_colaborador','$jefe_respuesta','$jefe_comentario','$rut_jefe')";

                                        $database->setquery($sql);
                                        $database->query();


                }
        // echo "<br><br>RESPUESTA "; echo $sql;
        //sleep(5); echo "<br><br>";

        }

}

function ass_save_respuesta_ec_data($id_instrumento,$id_empresa,$fecha,$hora,$id_skill,$col_respuesta,$col_comentario,
                                                                        $rut_colaborador,$jefe_respuesta,$jefe_comentario,$rut_jefe, $ec, $respuesta_abierta)  {



                global $c_host, $c_user, $c_pass, $c_db;
                $database = new database($c_host, $c_user, $c_pass);
                $database->setDb($c_db);
                   $respuesta_abierta=utf8_decode($respuesta_abierta);
                $sql="select id from tbl_checklist_respuestas where id_empresa='$id_empresa' and rut_colaborador='$rut_colaborador'
                and id_instrumento='$id_instrumento' and id_skill='$id_skill' and ec='$ec'";
                $database->setquery($sql);
                $database->query();
                $cod = $database->listObjects();


               // echo "<br><br>"; echo $sql;
               // sleep(5); echo "<br><br>";

                if($rut_colaborador==''){
                                                                        echo "Falta RUT del Colaborador"; sleep(3);
                } else {

                                if($cod[0]->id<>'' and $rut_jefe<>''){


                                                                                $sql = "update

                                                                                tbl_checklist_respuestas

                                                                                set

                                                                                rut_jefe='$rut_jefe',
                                                                                jefe_respuesta='$jefe_respuesta'

                                                                                where id_empresa='$id_empresa'
                                                                                and ec='$ec'
                                                                                and rut_colaborador='$rut_colaborador'
                                                                                and id_instrumento='$id_instrumento' and id_skill='$id_skill' ";
                                                                                $database->setquery($sql);
                                                                                $database->query();
                                }
                                        else  if($cod[0]->id<>'' and $rut_colaborador<>'' and $respuesta_abierta<>''){


                                                                                $sql = "update

                                                                                tbl_checklist_respuestas

                                                                                set

                                                                                rut_colaborador='$rut_colaborador',
                                                                                respuesta_abierta='$respuesta_abierta'

                                                                                where id_empresa='$id_empresa'
                                                                                 and ec='$ec'
                                                                                and rut_colaborador='$rut_colaborador'
                                                                                and id_instrumento='$id_instrumento'  and id_skill='$id_skill' ";
                                                                                $database->setquery($sql);
                                                                                $database->query();

                                } else {


                                                                                $fecha = date("Y-m-d");
                                                                                $hora  = date("H:i:s");

                                                                                $fecha_estado=$fecha;


                                                                                $sql   = "INSERT INTO

                                                                                tbl_checklist_respuestas

                                                                                (id_instrumento,id_empresa,
                                                                                fecha,hora,id_skill,col_respuesta,col_comentario,
                                                                                rut_colaborador,jefe_respuesta,jefe_comentario,rut_jefe, ec, respuesta_abierta)

                                                                                values

                                                                                ('$id_instrumento','$id_empresa',
                                                                                '$fecha','$hora','$id_skill','','$col_comentario',
                                                                                '$rut_colaborador','$jefe_respuesta','$jefe_comentario','$rut_jefe','$ec', '$respuesta_abierta')";

                                                                                $database->setquery($sql);
                                                                                $database->query();


                                }
                //echo "<br><br>RESPUESTA "; echo $sql;exit();

                }

}

function Ass_busca_rut_ins_perfil_ec_respuestas($rut_col,$id_inst,  $id_empresa){

    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql="

    select h.jefe_respuesta from tbl_checklist_respuestas h where h.id_empresa='$id_empresa' and h.rut_colaborador='$rut_col'
    and h.id_instrumento='$id_inst' and jefe_respuesta<>'' and ec='ec'

    ";
    //echo "<br>Ass_busca_rut_ins_perfil_ec_respuestas<br>".$sql;exit();
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    //echo "<br>$sql";
    return $cod;

}


function TraigoOrganigramasPorEmpresa($id_empresa){

    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql="select * from tbl_organigrama_gerencia where id_empresa='$id_empresa'";
    //echo $sql;
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    //echo "<br>$sql";
    return $cod;

}




function Com_Mp_BuscaPost_Grupo($grupointeres, $id_empresa){


    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql="

    select count(h.id) as cuenta from tbl_mp h where h.id_empresa='$id_empresa' and h.id_subcategoria='$grupointeres'     and h.id_estado>=5

    ";  // echo $sql;
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    //echo "<br>$sql";
    return $cod[0]->cuenta;

}

function Lista_eventos_postulables_mp_com_generalSUma_data($id_empresa, $codigo){


    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql="

    select count(h.id) as cuenta from tbl_eventos_inscritos h where h.id_empresa='$id_empresa' and h.id_dimension='com_ev'
    and h.codigo='$codigo'

    ";  // echo $sql;
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    //echo "<br>$sql";
    return $cod[0]->cuenta;


}


function Lista_eventos_postulables_mp_com_generalRut_data($id_empresa, $rut, $codigo){


    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql="

    select h.* from tbl_eventos_inscritos h where h.id_empresa='$id_empresa' and h.id_dimension='com_ev'
    and h.rut='$rut' and h.codigo='$codigo'

    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    //echo "<br>$sql";
    return $cod;


}

function Lista_eventos_postulables_mp_com_general_data($id_empresa){

    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $hoy=date("Y-m-d");
    $sql="

    select h.*, (select count(id) from tbl_eventos_inscritos where codigo=h.codigo) as cuenta
    from tbl_eventos h where h.id_empresa='$id_empresa' and h.id_dimension='com_ev' and h.postulable='SI'
     and  h.fecha_inicio >'$hoy'

and h.invisible='0'

    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    //echo "<br>$sql";
    return $cod;

}

function BuscaASignacionPuntosGamificado($tipo, $rut, $id_empresa){

    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);

    $sql="SELECT count(id) as cuenta FROM tbl_gamificado_puntos WHERE rut='$rut' and id_empresa='$id_empresa' and id_curso LIKE '".$tipo."%' limit 1";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    //echo "<br>$sql cuenta ".$cod[0]->cuenta;

    if($cod[0]->cuenta>1){$cod[0]->cuenta=1;}
    return $cod[0]->cuenta;

}
function Triv_BuscaDimensionesArana($id_evaluacion, $id_empresa){
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql="select h.*, (select nombre from tbl_conductas where id=h.id_conducta) as Dimension from tbl_evaluaciones_preguntas h
    where h.evaluacion='$id_evaluacion' group by (select nombre from tbl_conductas where id=h.id_conducta)";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    //echo "<br>$sql";
    return $cod;
}

function Triv_BuscaDatosArana($rut,$id_evaluacion,$dimension, $id_empresa)    {

    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
$sql="SELECT
    h.*, (
        SELECT
            puntaje
        FROM
            tbl_evaluaciones_respuestas
        WHERE
            rut = '$rut'
        AND id_pregunta = h.id
    ) AS puntaje,
(
        SELECT
            nombre
        FROM
            tbl_conductas
        WHERE
            id = h.id_conducta
    ) AS Dimension
FROM
    tbl_evaluaciones_preguntas h
WHERE
    h.evaluacion = '$id_evaluacion'
and
(
        SELECT
            nombre
        FROM
            tbl_conductas
        WHERE
            id = h.id_conducta
    )='$dimension'";

   // echo "<br>$sql";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();

    return $cod;
}


function InsertTblAnalitica($rut, $id_empresa, $ambiente, $detalle)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $fecha      = date("Y-m-d");
    $hora       = date("H:i:s");
    $fechahora  = date("Y-m-d H:i:s");

    $sql   = "
INSERT INTO tbl_analitica
(rut,     ambiente,    detalle,    fecha,    hora,    fechahora,    id_empresa)
" . "VALUES
('$rut', '$ambiente', '$detalle', '$fecha', '$hora', '$fechahora', '$id_empresa')";
//echo "<br><br>$sql<br><br>";sleep(10);
    $database->setquery($sql);
    $database->query();
}

function BuscaAvanceCursoRut($rut, $id_curso, $id_empresa){

     global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_inscripcion_cierre   where rut='$rut' and id_empresa='$id_empresa' and id_curso='$id_curso' order by avance DESC limit 1";
    //echo $sql;
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();

    return $cod;

}

function BuscaUsuariosInscripcionUsuariosMalla($rut, $id_malla, $id_empresa){

     global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_inscripcion_usuarios   where rut='$rut' and id_empresa='$id_empresa' and id_malla='$id_malla'";
    //echo $sql;
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();

    return $cod;

}

function BacBuseliminaResponsable($id_solicitud, $id_empresa){

    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "update tbl_sis_seguimiento_situaciones
     set rut_res='', estado_registro='Sin Iniciar' where id='$id_solicitud' and id_empresa='$id_empresa'
    ";

   // echo $sql;
    $database->setquery($sql);
    $database->query();

}

function DatosMPGPW($id_empresa, $id_mp)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_mp_fotomensaje  where id='$id_mp' and id_empresa='$id_empresa'";

    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();

    return $cod;
}


function TieneMEgustaGPWPorPost($id, $id_empresa){

    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql="select * from tbl_mp_interacciones where id_mp='$id' and id_empresa='$id_empresa'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();

    return $cod;

}



function TieneMEgustaGPW($id, $id_empresa, $rut){

    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql="select * from tbl_mp_interacciones where id_mp='$id' and id_empresa='$id_empresa' and rut='$rut'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();

    return $cod;

}



function BuscaUsuarios_NoGerentes($rut, $id_empresa){

         global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);
        $sql="SELECT
    count(id) as cuenta
FROM
    tbl_usuario
WHERE
    rut = '$rut'  and id_empresa='$id_empresa'
AND cargo NOT LIKE '%gte%'
AND cargo NOT LIKE '%grte%'

AND cargo NOT LIKE '%GERENTE%'
AND cargo NOT LIKE '%gerente%'
AND cargo NOT LIKE '%Jefe de Ventas 1%'
AND cargo NOT LIKE '%Jefe de Ventas 2%'
AND cargo NOT LIKE '%Jefe de Ventas 3%'
AND cargo NOT LIKE '%Jefe de Ventas 4%' ";

                            // echo "sql $sql";  sleep(2);
        $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();

        //print_r($cod);    sleep(4);
        return $cod[0]->cuenta;

}
function  BuscoRespuestasDadoRutCursoInscripcion($rut, $id_curso, $id_inscripcion,$id_objeto){

   global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql="select count(id) as cuenta from tbl_evaluaciones_respuestas where rut='$rut' and id_objeto='$id_objeto';";
              // echo "sql $sql";  sleep(2);
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();


        $sql="select count(id) as cuenta from tbl_evaluaciones_respuestas where rut='$rut' and id_objeto='$id_objeto' and id_inscripcion='$id_inscripcion';
;";
                            // echo "sql $sql";  sleep(2);
        $database->setquery($sql);
        $database->query();
        $cod2 = $database->listObjects();
$borrar=0;

if($cod[0]->cuenta>0 and $cod2[0]->cuenta==0)  {$borrar=1;}
    //print_r($cod);    sleep(4);
    return $borrar=1;;


}

function ActualizaIdInscripcionNull_RUT($rut)
    {
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "update tbl_inscripcion_cierre h set id_inscripcion=h.id_curso where (select modalidad from tbl_lms_curso where id=h.id_curso)='1' and
            (h.id_inscripcion is null OR h.id_inscripcion='')  and h.rut='$rut'
    ";

   // echo $sql;
    $database->setquery($sql);
    $database->query();
}


function BuscaInscripcionCierreDuplicadosRut($rut)
    {
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "SELECT h.rut, h.id_inscripcion, h.id_curso,
    (select modalidad from tbl_lms_curso where id=h.id_curso), COUNT(*)

    FROM tbl_inscripcion_cierre h

    where   h.rut='$rut' and

    (select modalidad from tbl_lms_curso where id=h.id_curso) is not NULL
    and (select modalidad from tbl_lms_curso where id=h.id_curso)<>'4'
    GROUP BY h.rut, h.id_inscripcion, h.id_curso
    HAVING COUNT(*) > 1
    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    foreach($cod as $unico)
        {
        $buscaInstanciasCierre = BuscaInstanciasCierreDadoCursoInscrRutRut($unico->rut, $unico->id_inscripcion, $unico->id_curso);
        foreach($buscaInstanciasCierre as $uniIdCierre)
            {
            echo "<br /> rut " . $uniIdCierre->rut . " id curso " . $uniIdCierre->id_curso . " id inscripcion " . $uniIdCierre->id_inscripcion . "
                    nota " . $uniIdCierre->nota . " avance " . $uniIdCierre->avance . " estado " . $uniIdCierre->estado . " estado descripcion " . $uniIdCierre->estado_descripcion . " id_empresa " . $uniIdCierre->id_empresa;
            }

        // echo "<br /><hr><br />";

        }

    return $cod;
    }

    function BuscaInstanciasCierreDadoCursoInscrRutRut($rut, $id_inscripcion, $id_curso)
    {
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "SELECT h.rut, h.id_curso, h.id_inscripcion, h.nota, h.avance, h.estado, h.estado_descripcion
            FROM tbl_inscripcion_cierre h
        where rut='$rut' and h.id_curso='$id_curso' and h.id_inscripcion='$id_inscripcion'

        order by h.nota ASC, h.avance ASC, h.estado DESC, h.estado_descripcion ASC, h.id_inscripcion ASC
";
    $sql = "update tbl_inscripcion_cierre h set id_empresa='999'  where rut='$rut' and h.id_curso='$id_curso' and h.id_inscripcion='$id_inscripcion'

        order by h.nota ASC, h.avance ASC, h.estado DESC, h.estado_descripcion ASC, h.id_inscripcion ASC limit 1";


    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
    }


function GAMIFICACIONBuscaPuntosAcumuladosPorCursoRutEmpresa($id_curso, $rut, $id_empresa){

    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql="select sum(puntos) as puntos from tbl_gamificado_puntos where rut='$rut' and id_curso='$id_curso' and id_empresa='$id_empresa'";
              // echo "sql $sql";  sleep(2);
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();

    //print_r($cod);    sleep(4);
    return $cod[0]->puntos;


}


function VerificaUsuarioEmail($email, $id_empresa){


   global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql="select rut from tbl_usuario where email='$email' and id_empresa='$id_empresa'";
              // echo "sql $sql";  sleep(2);
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();

    //print_r($cod);    sleep(4);
    return $cod[0]->rut;

}
function VerificaUsuarioUserRut($user, $id_empresa){


   global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql="select rut from tbl_usuario where rut='$user'";
              // echo "sql $sql";  sleep(2);
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();

    //print_r($cod);    sleep(4);
    return $cod[0]->rut;

}
function LogEmailInsertUsuario($rut,$nombre,$email,$rut_empresa,$codigo,$id_empresa){


    global $c_host, $c_user, $c_pass, $c_db;    $database = new database($c_host, $c_user, $c_pass);    $database->setDb($c_db);

    $sql = "select id  from tbl_usuario where id_empresa='$id_empresa' and rut='$rut'";
    //echo $sql;
    $database->setquery($sql);
    $database->query();    $cod = $database->listObjects();
    //print_r($cod);    //sleep(5);
    $nombre=utf8_decode($nombre);

    if ($cod[0]->id > 0) {

    $sql = " UPDATE tbl_usuario set nombre_completo='$nombre', email='$email', empresa_holding='$rut_empresa', division='$codigo'
        where rut='" . $rut. "' ";
    } else {
        $sql = "INSERT INTO tbl_usuario (rut, id_empresa, nombre_completo, email, empresa_holding, division) " . "
        VALUES        ('$rut', '$id_empresa',  '$nombre','$email', '$rut_empresa', '$codigo');";
    }
//    echo  "<br> $c_host, $c_user, $c_pass, $c_db";
//    echo "<br>";
 //echo $sql; sleep(2);

    $database->setquery($sql);    $database->query();    return $codigo;

}

function ActualizaInscripcionCierre($rut, $id_curso, $avance, $nota, $estado, $id_empresa){

    global $c_host, $c_user, $c_pass, $c_db;    $database = new database($c_host, $c_user, $c_pass);    $database->setDb($c_db);

    $sql = "select id  from tbl_inscripcion_cierre where id_empresa='$id_empresa' and rut='$rut' and id_curso='$id_curso'";
   // echo $sql;
    $database->setquery($sql);
    $database->query();    $cod = $database->listObjects();
    //print_r($cod);    //sleep(5);
    $nombre=utf8_decode($nombre);

    if ($cod[0]->id > 0) {

    $sql = " UPDATE tbl_inscripcion_cierre set avance='$avance', nota='$nota', estado='$estado'
        where rut='" . $rut. "' and id_curso='" . $id_curso. "' and id_empresa='" . $id_empresa. "'";
    } else {
        $sql = "INSERT INTO tbl_inscripcion_cierre (rut, id_curso, avance, nota, estado, id_empresa) " . "
        VALUES        ('$rut', '$id_curso', '$avance', '$nota', '$estado', '$id_empresa');";
    }
//    echo  "<br> $c_host, $c_user, $c_pass, $c_db";
//    echo "<br>";
 //echo $sql; sleep(2);

    $database->setquery($sql);    $database->query();    return $codigo;

}

function LogInsertUsuario($rut,$id_empresa){


    global $c_host, $c_user, $c_pass, $c_db;    $database = new database($c_host, $c_user, $c_pass);    $database->setDb($c_db);


        $sql = "INSERT INTO tbl_usuario (rut, id_empresa) " . "
        VALUES        ('$rut', '$id_empresa');";

//    echo  "<br> $c_host, $c_user, $c_pass, $c_db";
//    echo "<br>";
//echo $sql; sleep(2);

    $database->setquery($sql);    $database->query();    return $codigo;

}

function YoMeEdu_Empresas_Dominio($dominio){

    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql="select * from tbl_empresas_ext where dominio='$dominio'";
    //           echo "sql $sql";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();

    //print_r($cod);    sleep(4);
    return $cod;

}


function YoMeEdu_BuscoDivisiones($Rut_Empresa){

     global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
$sql="select * from tbl_empresas_ext_division where rut='$Rut_Empresa'";
     //echo $sql;
 $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;


}

function CENCO_SIC_totalSolicitudesEstadoValidadosGerenteRRHH(){



    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
$sql="select * from tbl_sis_seguimiento where estado_registro='Aprobado Gerente RRHH' and tipo_registro='JAD'";

 $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;




}


function  CENCO_actualizaControlGestion($id, $gestion_cargo_presupuestado, $gestion_posicion_people_soft, $gestion_gasto_personal, $gestion_contrato_empresa){


    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);

    $sql="update tbl_sis_seguimiento set
            gestion_cargo_presupuestado='$gestion_cargo_presupuestado',
            gestion_posicion_people_soft='$gestion_posicion_people_soft',
            gestion_gasto_personal='$gestion_gasto_personal',
            gestion_contrato_empresa='$gestion_contrato_empresa'



            where id='$id'";

    $database->setquery($sql);
    $database->query();
    //    $cod = $database->listObjects();
    return $cod;


}



function CENCO_SIC_totalSolicitudesEstadoValidadosPorGerentePrimeraLinea(){



    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
$sql="select * from tbl_sis_seguimiento where estado_registro='Aprobado Gerente 1 linea'";

 $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;




}





function CENCO_SIC_totalSolicitudesEstadoValidadosPorControlDeGestion(){



    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
$sql="select * from tbl_sis_seguimiento where estado_registro='Aprobado Control de Gestion'";

 $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;




}




function  ActualizaEstadoCenco($id,$estado){


    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);

    $sql="update tbl_sis_seguimiento set estado_registro='$estado' where id='$id'";

    $database->setquery($sql);
    $database->query();
    //    $cod = $database->listObjects();
    return $cod;


}


function CENCO_SIC_totalSolicitudesEstadoVacio(){



    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
$sql="select * from tbl_sis_seguimiento where estado_registro='Sin Iniciar'";

 $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;




}


function Sis_seguimiento_SaveCenco($nombre, $rut_jefe, $cargo, $gerencia, $gerente, $telefono_contacto, $nombre_cargo, $objetivo_cargo, $razon_social, $centro_costo, $causa_solicitud,
$tipo_contrato, $reemplaza_a, $rut_contrato, $fecha_esperada_ingreso, $duracion, $cargo_nuevo, $requiere_computador, $requiere_computador_encaso, $requiere_computador_categoria,
$requiere_computador_presupuesto, $puesto_trabajo, $gestion_cargo_presupuestado, $gestion_posicion_people_soft, $gestion_gasto_personal, $gestion_contrato_empresa, $compensaciones_ggs,
$compensaciones_bono_anual, $compensaciones_nombre_cargo, $id_empresa, $jad_justificacion, $jad_costo, $jad_presupuestado, $jad_motivo)
{


    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $motiva_atencion = utf8_decode($motiva_atencion);
    $antecedentes    = utf8_decode($antecedentes);
    $solicitud       = utf8_decode($solicitud);
    $observaciones   = utf8_decode($observaciones);

    if($causa_solicitud=="Aumento dotacion"){
        $tipo_registro="JAD";
    }else{
        $tipo_registro="SIC";
    }

    $sql             = "INSERT INTO tbl_sis_seguimiento
        (nombre, rut, cargo, gerencia, gerente, telefono_contacto, nombre_cargo, objetivo_cargo, razon_social, centro_costo, causa_solicitud, tipo_contrato, reemplaza_a, rut_contrato,
        fecha_esperada_ingreso, duracion, cargo_nuevo, requiere_computador, requiere_computador_encaso, requiere_computador_categoria, requiere_computador_presupuesto, puesto_trabajo,
        gestion_cargo_presupuestado, gestion_posicion_people_soft, gestion_gasto_personal, gestion_contrato_empresa, compensaciones_ggs, compensaciones_bono_anual, compensaciones_nombre_cargo,
        id_empresa, estado_registro, jad_justificacion, jad_costo, jad_presupuestado, jad_motivo, tipo_registro


        ) values
        ('$nombre','
        $rut_jefe',
        '$cargo',
        '$gerencia','$gerente',
        '$telefono_contacto','$nombre_cargo','$objetivo_cargo','$razon_social',
        '$centro_costo','$causa_solicitud','$tipo_contrato','$reemplaza_a','$rut_contrato','$fecha_esperada_ingreso','$duracion',
        '$cargo_nuevo','$requiere_computador','$requiere_computador_encaso','$requiere_computador_categoria',
        '$requiere_computador_presupuesto','$puesto_trabajo','$gestion_cargo_presupuestado','$gestion_posicion_people_soft','$gestion_gasto_personal',
        '$gestion_contrato_empresa', '$compensaciones_ggs', '$compensaciones_bono_anual', '$compensaciones_nombre_cargo', '$id_empresa', 'Sin Iniciar',
        '$jad_justificacion', '$jad_costo', '$jad_presupuestado', '$jad_motivo', '$tipo_registro')";

    //sleep(10);
    $database->setquery($sql);
    $database->query();
    $datos       = $database->listObjects();
    // return $datos;
    $sql_last_id = "select max(id) as id from tbl_sis_seguimiento ";
    $database->setquery($sql_last_id);
    $database->query();
    $datos = $database->listObjects();
    //echo "<br>dato<br>";
    //echo $datos[0]->id;
    return $datos[0]->id;
}


function mp_buscaNumPostGrupoCerrado($id_grupo, $id_empresa){



    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
$sql="select count(h.id) as cuenta from tbl_mp h where h.id_subcategoria='$id_grupo' and h.id_empresa='$id_empresa' and h.id_estado>=5";

//echo $sql;  exit();
$database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod[0]->cuenta;






}

function BuscaMallaUnica($id_curso, $rut, $id_empresa){

    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);

$id_empresa=$_SESSION["id_empresa"];

    $sql = "


select count(id) as cuenta  from rel_lms_malla_curso h where id_curso='$id_curso' and id_empresa='$id_empresa'

    ";

   // echo $sql;

    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();


    if($cod[0]-> cuenta=='1'){

     $sql = "


select id_malla  from rel_lms_malla_curso h where id_curso='$id_curso' and id_empresa='$id_empresa'

    ";

    };
       //echo "<br>".$sql;
     $database->setquery($sql);
    $database->query();
    $cod2 = $database->listObjects();

    return $cod2[0]-> id_malla;



}



function Trivia_BuscaNotaCierre($id_curso, $id_empresa, $rut){

    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);

    $sql="select nota from tbl_inscripcion_cierre where rut='$rut' and id_curso='$id_curso' and id_empresa='$id_empresa' order by nota DESC  limit 1";
    //echo $sql; sleep(5);
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod[0]->nota;

}

function  ActualizaFCInvisibleItem($id_postulable,$id_empresa){


    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);

    $sql="
        update tbl_postulables set invisible='1' where id_postulable='$id_postulable' and id_empresa='$id_empresa'
            ";

//        echo $sql;

    $database->setquery($sql);
    $database->query();
    //    $cod = $database->listObjects();
    return $cod;


}



function EliminaObjetoFinalizado($rut, $id_objeto, $id_empresa, $id_curso)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = sprintf("DELETE from tbl_objetos_finalizados WHERE rut = '$rut'  and id_objeto='$id_objeto' and id_curso='$id_curso' ");

    $database->setquery($sql);
    $database->query();
}


function EstaEnInscripcionCierreConImparticion($rut, $id_curso, $id_empresa, $id_inscripcion){

    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);

    $id_empresa=$_SESSION["id_empresa"];

    $sql = " select * from tbl_inscripcion_cierre where rut='$rut' and id_curso='$id_curso' and id_empresa='$id_empresa' and id_inscripcion='$id_inscripcion'    ";



   $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;


}


function EstaEnInscripcionCierre($rut, $id_curso, $id_empresa){

    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);

    $id_empresa=$_SESSION["id_empresa"];

    $sql = " select * from tbl_inscripcion_cierre where rut='$rut' and id_curso='$id_curso' and id_empresa='$id_empresa'    ";



   $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;


}


function BuscaEmailCodRut($id, $rut_col,$id_empresa){

    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);

$id_empresa=$_SESSION["id_empresa"];

    $sql = "


select count(id) as cuenta  from tbl_log_emails h where rut='$rut_col' and dato='$id' and id_empresa='$id_empresa'

    ";

    //echo $sql;

    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod[0]-> cuenta;


}

function BuscaDatosRegistroBacBusDCR($SisenviarAgente, $id_empresa){
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);

$id_empresa=$_SESSION["id_empresa"];

    $sql = "


select h.*, (select sucursal from tbl_usuario where local=h.id_cui limit 1) as sucursal from tbl_sis_seguimiento h where h.id='$SisenviarAgente' and h.id_empresa='$id_empresa'

    ";

    //echo $sql;

    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}

function BuscaSucursalCui_data($id_cui_col,$id_empresa){
     global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);

    $id_empresa=$_SESSION["id_empresa"];

    $sql = "
        select sucursal from tbl_usuario where local='$id_cui_col' and id_empresa='$id_empresa' and sucursal<>'' limit 1
    ";

    //echo $sql; sleep(3);

    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}

function CertEscribeInscripcionCierreEnProceso($rut, $id_malla){


    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);

$id_empresa=$_SESSION["id_empresa"];

    $sql = "


select h.rut, h.id_inscripcion, h.id_curso,

(select count(distinct(id))  from tbl_inscripcion_cierre where id_curso=h.id_curso and estado='1' and rut=h.rut) as cuenta_inscripcion_cierre,
(select count(distinct(id))  from tbl_objetos_finalizados where id_objeto=(select id from tbl_objeto where id_curso=h.id_curso and tipo_objeto=5 limit 1) and rut=h.rut) as cuenta_objeto_finalizado,
(select count(distinct(id))  from tbl_evaluaciones_respuestas_intentos where id_objeto=(select id from tbl_objeto where id_curso=h.id_curso and tipo_objeto=5 limit 1) and rut=h.rut) as cuenta_usuarios_respuestas_intentos,
(select count(distinct(id))  from tbl_evaluaciones_respuestas where id_objeto=(select id from tbl_objeto where id_curso=h.id_curso and tipo_objeto=5 limit 1 ) and rut=h.rut) as cuenta_usuarios_respuestas

from tbl_inscripcion_usuarios h where h.id_malla='$id_malla' and h.rut='$rut'


and (select id from tbl_objeto where id_curso=h.id_curso and tipo_objeto=5 limit 1) is not null


and (select count(distinct(id))  from tbl_inscripcion_cierre where id_curso=h.id_curso and estado='1' and rut=h.rut)='0'
and (select count(distinct(id))  from tbl_evaluaciones_respuestas where id_objeto=(select id from tbl_objeto where id_curso=h.id_curso and tipo_objeto=5 limit 1 ) and rut=h.rut) >0



    ";

    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();


    //print_r($cod);

    foreach($cod as $unico){
        if($unico->cuenta_inscripcion_cierre==0){

    $sql   = "INSERT INTO

    tbl_inscripcion_cierre

(rut,id_empresa,estado, avance, id_curso, id_inscripcion)

values

('$rut','$id_empresa','3','50','".$unico->id_curso."','".$unico->id_inscripcion."')";


        } else {

                $sql="
        update tbl_inscripcion_cierre set id_empresa='$id_empresa', estado='3', avance='50' where rut='$rut'
        and id_curso='".$unico->id_curso."'
        and id_inscripcion='".$unico->id_inscripcion."'
        and id_empresa='$id_empresa'
            ";


        }



    }
//        echo $sql;exit();

    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();



    return ($cod);



}

function TraeObjetosPorCurso($id_curso, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_objeto where id_curso='$id_curso' and id_empresa='$id_empresa'";

    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return ($cod);
}


    function Emb_Lista_PostMasPublicador($id_empresa, $id_grupo_interes){

    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
$sql="select h.*, (select count(id) from tbl_mp where rut=h.rut and id_empresa=h.id_empresa and id_estado>=5 and id_subcategoria='$id_grupo_interes' )   as publicaciones ,
(select nombre_completo from tbl_usuario where rut=h.rut) as nombre_completo
from tbl_mp h where h.id_empresa='$id_empresa'  and h.id_estado>=5
and h.id_subcategoria='$id_grupo_interes'
group by h.rut order by (select count(id) from tbl_mp where rut=h.rut and id_empresa=h.id_empresa and id_estado>=5) DESC limit 10";
$database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;

}


function Emb_Lista_PostMeGusta_Data($id_empresa, $id_grupo_interes){

    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
$sql="select h.*,
(select count(id) from tbl_mp_interacciones where id_mp=h.id_mp and id_empresa=h.id_empresa and (tipo='MEGUSTA' or tipo='MEGUSTA_POST') ) as MeGusta
from tbl_mp h where h.id_empresa='$id_empresa'

and h.id_subcategoria='$id_grupo_interes'  and h.id_estado>=5

order by (select count(id) from tbl_mp_interacciones where id_mp=h.id_mp and id_empresa=h.id_empresa and (tipo='MEGUSTA' or tipo='MEGUSTA_POST') ) DESC
Limit 10";

//echo $sql;
$database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;

}


function BuscaObjetosFinalizados($codigo, $rut){

    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);

    $sql="select count(id) as cuenta from tbl_objetos_finalizados where id_objeto='$codigo' and rut ='$rut'


    ";


    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();

    return $cod[0]->cuenta;


}
function BuscaCursosObjetosFinalizados($id_curso, $rut){

    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);

    $sql="select count(id) as cuenta from tbl_objetos_finalizados where id_curso='$id_curso' and rut ='$rut'


    ";

     // echo $sql;
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();

    return $cod[0]->cuenta;


}
function BuscaObjetosNotaFinalizados($codigo, $rut){

    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);

    $sql="select nota from tbl_objetos_finalizados where id_objeto='$codigo' and rut ='$rut'


    ";


    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();

    return $cod[0]->nota;


}

function BuscaIdInscripcionDadoObjetoRut($id_objeto, $rut, $id_empresa){


    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);

    $sql=" select h.id_curso from tbl_objeto h where h.id='$id_objeto' limit 1 ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    $id_curso= $cod[0]->id_curso;

    $sql=" select id_inscripcion from tbl_inscripcion_usuarios where id_curso='$id_curso' and rut='$rut' and id_empresa='$id_empresa' order by id DESC Limit 1 ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();



    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();

    return $cod[0]->id_inscripcion;


}

function VerificaRutPremioExclusion($rut,$id_premio, $id_empresa) {

    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);

    $sql="select id from tbl_premios_puntos_excepcion

    where

    rut='$rut' and id_premio='$id_premio' and id_empresa='$id_empresa' limit 1
    ";
//    echo $sql;

    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();

    return $cod[0]->id;

}

function LMS_MiEquipoVista_Data($id_empresa, $rut, $id_curso, $id_programa, $id_foco)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $limit = " limit 10 ";
    $groupby = " group by h.$groupby ";

    // $order = "order by poc_aprobados DESC, total_medallas DESC, total_puntos DESC ";

    if ($id_programa == "") {
        $query_id_programa = "  ";
        $query_id_programaH = "  ";
    }
    else {
        $query_id_programa = "        AND tbl_lms_reportes.id_programa = '$id_programa'";
        $query_id_programaH = "        AND h.id_programa = '$id_programa'";
    }

    if ($id_foco == "") {
        $query_id_foco = "  ";
        $query_id_focoH = "  ";
    }
    else {
        $query_id_foco = "        AND tbl_lms_reportes.id_foco = '$id_foco'";
        $query_id_focoH = "        AND h.id_foco = '$id_foco'";
    }

    if ($rut == "") {
        $query_rut = "  ";
    }
    else {
        $query_rut = " and
            (
                h.jefe ='$rut'

            )
            ";
        $limit = " limit 10 ";
        $order = "order by poc_aprobados DESC, total_medallas DESC, total_puntos DESC ";
    }




    $sql = "select h.rut, h.nombre ,  h.cargo, h.c1, h.c2, h.c3, h.c4,
sum(h.puntos) as total_puntos,
sum(h.medallas) as total_medallas,
count(id) as total_cursos,
(
        SELECT
            count(tbl_lms_reportes.id)
        FROM
            tbl_lms_reportes
        INNER JOIN rel_lms_malla_curso ON rel_lms_malla_curso.id_curso = tbl_lms_reportes.id_curso
        WHERE
            tbl_lms_reportes.id_empresa = '$id_empresa'
        AND rut = h.rut
        $query_id_programa
        $query_id_foco
        AND rel_lms_malla_curso.inactivo = '0'
    and tbl_lms_reportes.estado='APROBADO'
    ) AS num_aprobados,
(
        SELECT
            count(tbl_lms_reportes.id)
        FROM
            tbl_lms_reportes
        INNER JOIN rel_lms_malla_curso ON rel_lms_malla_curso.id_curso = tbl_lms_reportes.id_curso
        WHERE
            tbl_lms_reportes.id_empresa = '$id_empresa'
        AND rut = h.rut
        $query_id_programa
        $query_id_foco
        AND rel_lms_malla_curso.inactivo = '0'
    and (tbl_lms_reportes.estado='APROBADO' or tbl_lms_reportes.estado='REPROBADO')
    ) AS num_realizados




from tbl_lms_reportes h

where

h.id_empresa='$id_empresa'

and h.id_curso<>''

$query_id_programaH
$query_id_focoH
$query_rut

and (select inactivo from rel_lms_malla_curso where id_curso=h.id_curso and id_malla=h.id_malla)='0'
and h.nombre<>''
and h.nombre<>'USUARIO INACTIVO'
group by h.rut

ORDER BY

h.nombre


";

    // and h.nombre<>''
    // and h.nombre<>'USUARIO INACTIVO'
   // echo "<br />SQL<br /><br />$sql<br />";exit();

    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();

    // echo "<br />DATA Ranking_desafios_avance_Data <br />$sql<br />";

    return $cod;
}

function LMS_MiEquipoVista_Cursos_disponibles_Data($id_empresa, $rut, $id_curso, $id_programa, $id_foco)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $limit = " limit 10 ";
    $groupby = " group by h.$groupby ";

    // $order = "order by poc_aprobados DESC, total_medallas DESC, total_puntos DESC ";

    if ($id_programa == "") {
        $query_id_programa = "  ";
        $query_id_programaH = "  ";
    }
    else {
        $query_id_programa = "        AND tbl_lms_reportes.id_programa = '$id_programa'";
        $query_id_programaH = "        AND h.id_programa = '$id_programa'";
    }

    if ($id_foco == "") {
        $query_id_foco = "  ";
        $query_id_focoH = "  ";
    }
    else {
        $query_id_foco = "        AND tbl_lms_reportes.id_foco = '$id_foco'";
        $query_id_focoH = "        AND h.id_foco = '$id_foco'";
    }

    if ($rut == "") {
        $query_rut = "  ";
    }
    else {
        $query_rut = " and
            (
                h.jefe ='$rut'

            )
            ";
        $limit = " limit 10 ";
        $order = "order by poc_aprobados DESC, total_medallas DESC, total_puntos DESC ";
    }




    $sql = "select h.* from tbl_lms_curso h   where h.modalidad='2'  order by h.nombre limit 50";
   //  echo $sql;
    // and h.nombre<>''
    // and h.nombre<>'USUARIO INACTIVO'
   // echo "<br />SQL<br /><br />$sql<br />";exit();

    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();

    // echo "<br />DATA Ranking_desafios_avance_Data <br />$sql<br />";

    return $cod;
}

function LMS_DNC_MiEquipoVista_Data($id_empresa, $rut, $id_curso, $id_programa, $id_foco)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $limit = " limit 10 ";
    $groupby = " group by h.$groupby ";

    // $order = "order by poc_aprobados DESC, total_medallas DESC, total_puntos DESC ";

    if ($id_programa == "") {
        $query_id_programa = "  ";
        $query_id_programaH = "  ";
    }
    else {
        $query_id_programa = "        AND tbl_lms_reportes.id_programa = '$id_programa'";
        $query_id_programaH = "        AND h.id_programa = '$id_programa'";
    }

    if ($id_foco == "") {
        $query_id_foco = "  ";
        $query_id_focoH = "  ";
    }
    else {
        $query_id_foco = "        AND tbl_lms_reportes.id_foco = '$id_foco'";
        $query_id_focoH = "        AND h.id_foco = '$id_foco'";
    }

    if ($rut == "") {
        $query_rut = "  ";
    }
    else {
        $query_rut = " and
            (
                h.jefe ='$rut'

            )
            ";
        $limit = " limit 10 ";
        $order = "order by poc_aprobados DESC, total_medallas DESC, total_puntos DESC ";
    }




    $sql = "select h.rut, h.nombre ,  h.cargo, h.c1, h.c2, h.c3, h.c4,
sum(h.puntos) as total_puntos,
sum(h.medallas) as total_medallas,
count(id) as total_cursos,
(
        SELECT
            count(tbl_lms_reportes.id)
        FROM
            tbl_lms_reportes
        INNER JOIN rel_lms_malla_curso ON rel_lms_malla_curso.id_curso = tbl_lms_reportes.id_curso
        WHERE
            tbl_lms_reportes.id_empresa = '$id_empresa'
        AND rut = h.rut
        $query_id_programa
        $query_id_foco
        AND rel_lms_malla_curso.inactivo = '0'
    and tbl_lms_reportes.estado='APROBADO'
    ) AS num_aprobados,
(
        SELECT
            count(tbl_lms_reportes.id)
        FROM
            tbl_lms_reportes
        INNER JOIN rel_lms_malla_curso ON rel_lms_malla_curso.id_curso = tbl_lms_reportes.id_curso
        WHERE
            tbl_lms_reportes.id_empresa = '$id_empresa'
        AND rut = h.rut
        $query_id_programa
        $query_id_foco
        AND rel_lms_malla_curso.inactivo = '0'
    and (tbl_lms_reportes.estado='APROBADO' or tbl_lms_reportes.estado='REPROBADO')
    ) AS num_realizados




from tbl_lms_reportes h

where

h.id_empresa='$id_empresa'

and h.id_curso<>''

$query_id_programaH
$query_id_focoH
$query_rut

and (select inactivo from rel_lms_malla_curso where id_curso=h.id_curso and id_malla=h.id_malla)='0'
and h.nombre<>''
and h.nombre<>'USUARIO INACTIVO'
group by h.rut

ORDER BY

h.nombre


";

    // and h.nombre<>''
    // and h.nombre<>'USUARIO INACTIVO'
   // echo "<br />SQL<br /><br />$sql<br />";exit();

    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();

    // echo "<br />DATA Ranking_desafios_avance_Data <br />$sql<br />";

    return $cod;
}

function LMS_MiEquiposVista_Cursos_Data($id_empresa, $rut, $id_curso, $id_programa, $id_foco)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $limit = " limit 10 ";
    $groupby = " group by h.$groupby ";

    if($id_empresa=="61"){$quer_quita=" and h.id_programa<>'rf_cert_rg' and h.id_programa<>'rf_cert_rgcn' ";}      else {$quer_quita=" ";}
    // $order = "order by poc_aprobados DESC, total_medallas DESC, total_puntos DESC ";

    if ($id_programa == "") {
        $query_id_programa = "  ";
        $query_id_programaH = "  ";
    }
    else {
        $query_id_programa  = "        AND tbl_lms_reportes.id_programa = '$id_programa'";
        $query_id_programaH = "        AND h.id_programa = '$id_programa'";
    }

    if ($id_foco == "") {
        $query_id_foco  = "  ";
        $query_id_focoH = "  ";
    }
    else {
        $query_id_foco  = "        AND tbl_lms_reportes.id_foco = '$id_foco'";
        $query_id_focoH = "        AND h.id_foco = '$id_foco'";
    }


    if ($rut == "") {
        $query_rut = "  ";
    }
    else {
        $query_rut = " and
            (
                h.rut ='$rut'

            )
            ";
        $limit = " limit 10 ";
        $order = "order by poc_aprobados DESC, total_medallas DESC, total_puntos DESC ";
    }

    $sql = "

select h.*,
(select round(avg(avance)) from tbl_lms_reportes where rut=h.rut and id_programa=h.id_programa and curso_opcional='0' ) as AvancePromedio,

(select nombre from tbl_lms_curso where id=h.id_curso limit 1) as nombre_curso,
(
        SELECT
            nombre_programa
        FROM
            tbl_lms_programas_bbdd
        WHERE
            id_programa = h.id_programa
        LIMIT 1
    ) as nombre_programa,
(select opcional from tbl_lms_programas_bbdd where id_programa=h.id_programa limit 1) as opcional_programa,
(select inactivo from tbl_lms_programas_bbdd where id_programa=h.id_programa limit 1) as inactivo_programa


from tbl_lms_reportes h

where

 h.id_empresa='$id_empresa'

    and h.id_curso<>''

    $query_id_programaH
    $query_id_focoH
    $query_rut

and (select inactivo from rel_lms_malla_curso where id_curso=h.id_curso and id_malla=h.id_malla)='0'
and h.nombre<>'' and h.nombre<>'USUARIO INACTIVO'

AND (select opcional from tbl_lms_programas_bbdd where id_programa=h.id_programa limit 1) is null
AND (select inactivo from tbl_lms_programas_bbdd where id_programa=h.id_programa limit 1) is null
AND

(
                (
                    SELECT
                        opcional
                    FROM
                        rel_lms_malla_persona
                    WHERE
                        id_malla = h.id_malla and rut=h.rut
                    LIMIT 1
                ) is null

or


                (
                    SELECT
                        opcional
                    FROM
                        rel_lms_malla_persona
                    WHERE
                        id_malla = h.id_malla and rut=h.rut
                    LIMIT 1
                ) =''

)
$quer_quita

GROUP BY h.id_programa

ORDER BY (
        SELECT
            nombre_programa
        FROM
            tbl_lms_programas_bbdd
        WHERE
            id_programa = h.id_programa
        LIMIT 1
    )


";

    // and h.nombre<>''
    // and h.nombre<>'USUARIO INACTIVO'
   //echo "<br />SQL<br /><br />$sql<br />";

    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();

    // echo "<br />DATA Ranking_desafios_avance_Data <br />$sql<br />";

    return $cod;
}

function Save_DNC_curso_mes($rut, $id_empresa, $unico, $mes){
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $fecha = date("Y-m-d");
    $hora  = date("H:i:s");

    $fecha_estado=$fecha;


    $sql   = "INSERT INTO tbl_dnc_cursos_calendario
                    (id_curso,mes,rut,id_empresa,fecha)
                     values
              ('$unico','$mes','$rut','$id_empresa','$fecha')";

    $database->setquery($sql);
    $database->query();

}
function Obtener_medallas_sin_puntos($rut, $id_empresa){
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "

select h.*, (select titulo from tbl_objeto where id=h.id_objeto) as NombreObjeto,
(select id_curso from tbl_objeto where id=h.id_objeto) as IdCurso,
(select nombre from tbl_lms_curso where id=(select id_curso from tbl_objeto where id=h.id_objeto) )as Curso

from tbl_gamificado_puntos h where h.rut='$rut' and h.id_empresa='$id_empresa'

and h.medallas>0
and (SELECT id FROM tbl_premios_puntos_usuarios WHERE rut=h.rut and descripcion=(select nombre from tbl_lms_curso where id=(select id_curso from tbl_objeto where id=h.id_objeto) )) is null

    ";
    //echo $sql;
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function Save_Medallas_sin_puntos($rut,$fecha,$puntos,$tipo,$descripcion,$id_empresa)
 {
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $fecha = date("Y-m-d");
    $hora  = date("H:i:s");
    $sql   = "insert into tbl_premios_puntos_usuarios
     (rut,fecha,puntos,tipo,descripcion,id_empresa) values
     ('$rut','$fecha','$puntos','$tipo','$descripcion','$id_empresa')";
    $database->setquery($sql);
    $database->query();
}
 function Busca_Data_curso($id_curso, $id_empresa){

    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);


    $sql = "

        select * from tbl_dnc_cursos where id_curso='$id_curso'

    ";
    // echo "Busca_DNC_curso_mes sql $sql";

    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();

    // echo "<br />DATA Ranking_desafios_avance_Data <br />$sql<br />";

    return $cod;

 }
function Busca_DNC_curso_mes($rut, $id_empresa, $mes)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);


    $sql = "

        select h.* , (select curso from tbl_dnc_cursos where id_curso=h.id_curso) as curso,
        (select count(id) from tbl_dnc_cursos_inscritos where rut='$rut' and h.id_empresa='$id_empresa' and  mes='$mes' and  id_curso=h.id_curso) as cuentainscritos

        from tbl_dnc_cursos_calendario h

        where h.id_empresa='$id_empresa'   and rut='$rut' and mes='$mes' and    (select curso from tbl_dnc_cursos where id_curso=h.id_curso)<>''


    ";
    //echo "Busca_DNC_curso_mes sql $sql";

    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();

    // echo "<br />DATA Ranking_desafios_avance_Data <br />$sql<br />";

    return $cod;
}
function Busca_DNC_inscritos_curso_mes($id_curso, $mes, $rut, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);


    $sql = "
       select h.*,
(select nombre_completo from tbl_usuario where rut=h.rut_inscrito) as nombre_completo,
(select cargo from tbl_usuario where rut=h.rut_inscrito) as cargo

from tbl_dnc_cursos_inscritos h where h.rut='$rut' and h.mes='$mes' and h.id_curso='$id_curso'   and h.id_empresa='$id_empresa'

    ";
    //echo "Busca_DNC_curso_mes sql $sql";

    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();

    // echo "<br />DATA Ranking_desafios_avance_Data <br />$sql<br />";

    return $cod;
}
function LMS_DNC_MiCurso_Data($id_empresa, $rut, $id_curso, $id_programa, $id_foco)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $limit = " limit 10 ";
    $groupby = " group by h.$groupby ";

    $sql = "

        select h.*

        from tbl_dnc_cursos h

        where h.id_empresa='$id_empresa'


    ";
    //echo "LMS_DNC_MiCurso_Data sql $sql";

    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();

    // echo "<br />DATA Ranking_desafios_avance_Data <br />$sql<br />";

    return $cod;
}

function Ranking_desafios_avance_Data($rut, $id_programa, $id_foco, $id_empresa, $jefe, $groupby)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $limit = " limit 10 ";
    $groupby = " group by h.$groupby ";

    // $order = "order by poc_aprobados DESC, total_medallas DESC, total_puntos DESC ";

    if ($id_programa == "") {
        $query_id_programa = "  ";
        $query_id_programaH = "  ";
    }
    else {
        $query_id_programa = "        AND tbl_lms_reportes.id_programa = '$id_programa'";
        $query_id_programaH = "        AND h.id_programa = '$id_programa'";
    }

    if ($id_foco == "") {
        $query_id_foco = "  ";
        $query_id_focoH = "  ";
    }
    else {
        $query_id_foco = "        AND tbl_lms_reportes.id_foco = '$id_foco'";
        $query_id_focoH = "        AND h.id_foco = '$id_foco'";
    }

    if ($rut == "") {
        $query_rut = "  ";
    }
    else {
        $query_rut = " and h.rut='$rut' and h.id_malla='$id_malla'";
        $limit = " limit 10 ";
        $order = "order by poc_aprobados DESC, total_medallas DESC, total_puntos DESC ";
    }

    if ($jefe == "") {
        $query_jefe = "  ";
    }
    else {
        $query_jefe = " and (
        (select jefe from tbl_usuario where rut=h.rut) ='$jefe' or (select lider from tbl_usuario where rut=h.rut) ='$jefe'
        )";
        $limit = "";
        $order = " order by h.id_malla,  poc_aprobados DESC, total_medallas DESC, total_puntos DESC ";
    }

    $sql = "select h.rut, h.nombre ,  h.cargo, h.c1, h.c2, h.c3, h.c4,
sum(h.puntos) as total_puntos,
sum(h.medallas) as total_medallas,
count(id) as total_cursos,
(
        SELECT
            count(tbl_lms_reportes.id)
        FROM
            tbl_lms_reportes
        INNER JOIN rel_lms_malla_curso ON rel_lms_malla_curso.id_curso = tbl_lms_reportes.id_curso
        WHERE
            tbl_lms_reportes.id_empresa = '$id_empresa'
        AND rut = h.rut
        $query_id_programa
        $query_id_foco
        AND rel_lms_malla_curso.inactivo = '0'
    and tbl_lms_reportes.estado='APROBADO'
    ) AS num_aprobados,
(
        SELECT
            count(tbl_lms_reportes.id)
        FROM
            tbl_lms_reportes
        INNER JOIN rel_lms_malla_curso ON rel_lms_malla_curso.id_curso = tbl_lms_reportes.id_curso
        WHERE
            tbl_lms_reportes.id_empresa = '$id_empresa'
        AND rut = h.rut
        $query_id_programa
        $query_id_foco
        AND rel_lms_malla_curso.inactivo = '0'
    and (tbl_lms_reportes.estado='APROBADO' or tbl_lms_reportes.estado='REPROBADO')
    ) AS num_realizados,



 round(
         (
            (
                SELECT
                    AVG(tbl_lms_reportes.avance)
                FROM
                    tbl_lms_reportes
                INNER JOIN rel_lms_malla_curso ON rel_lms_malla_curso.id_curso = tbl_lms_reportes.id_curso
                WHERE
                    tbl_lms_reportes.id_empresa = '$id_empresa'
                AND rut = h.rut
                $query_id_programa
                $query_id_foco
                AND rel_lms_malla_curso.inactivo = '0'
                AND tbl_lms_reportes.avance >0
            )
        )
    ) as avance
from tbl_lms_reportes h

where

h.id_empresa='$id_empresa'

and h.id_curso<>''

$query_id_programaH
$query_id_focoH
$query_rut
$query_jefe

and (select inactivo from rel_lms_malla_curso where id_curso=h.id_curso and id_malla=h.id_malla)='0'
and h.nombre<>''
and h.nombre<>'USUARIO INACTIVO'

$groupby

ORDER BY

 round(
         (
            (
                SELECT
                    AVG(tbl_lms_reportes.avance)
                FROM
                    tbl_lms_reportes
                INNER JOIN rel_lms_malla_curso ON rel_lms_malla_curso.id_curso = tbl_lms_reportes.id_curso
                WHERE
                    tbl_lms_reportes.id_empresa = '$id_empresa'
                AND rut = h.rut
                $query_id_programa
                $query_id_foco
                AND rel_lms_malla_curso.inactivo = '0'
                AND tbl_lms_reportes.avance >0
            )
        )
    ) DESC,

 (
        SELECT
            count(tbl_lms_reportes.id)
        FROM
            tbl_lms_reportes
        INNER JOIN rel_lms_malla_curso ON rel_lms_malla_curso.id_curso = tbl_lms_reportes.id_curso
        WHERE
            tbl_lms_reportes.id_empresa = '$id_empresa'
        AND rut = h.rut
        $query_id_programa
        $query_id_foco
        AND rel_lms_malla_curso.inactivo = '0'
    and tbl_lms_reportes.estado='APROBADO'
    ) DESC
,

sum(h.puntos) DESC

    $limit
";

    // and h.nombre<>''
    // and h.nombre<>'USUARIO INACTIVO'
    //  echo "<br />SQL<br /><br />$sql<br />";exit();

    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();

    // echo "<br />DATA Ranking_desafios_avance_Data <br />$sql<br />";

    return $cod;
}

function VerificaEtapa1Col($rut, $id_cargo, $id_empresa){

    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);


    $sql = "

      select count(h.id) as cuenta from

tbl_checklist_respuestas h

where
id_instrumento='$id_cargo' and
id_empresa='$id_empresa' and
rut_colaborador='$rut'


    ";
    //echo "LMS_DNC_MiCurso_Data sql $sql";

    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();

    // echo "<br />DATA Ranking_desafios_avance_Data <br />$sql<br />";

    return $cod[0]->cuenta;

}

function Ranking_desafios_puntos_Data($rut, $id_programa, $id_foco, $id_empresa, $jefe, $groupby)
    {
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $limit = " limit 10 ";
    $order = " order by  sum(h.puntos) DESC     ";

if($groupby=="rut") { $groupby=" group by h.rut ";}
if($groupby=="c1") { $groupby=" group by (select c1 from tbl_lms_reportes where rut=h.rut limit 1)='c1'";}
if($groupby=="c2") { $groupby=" group by (select c2 from tbl_lms_reportes where rut=h.rut limit 1)='c2'";}
if($groupby=="c3") { $groupby=" group by (select c3 from tbl_lms_reportes where rut=h.rut limit 1)='c3'";}
if($groupby=="c4") { $groupby=" group by (select c4 from tbl_lms_reportes where rut=h.rut limit 1)='c4'";}

   $wheretipocargo="";
   if($id_programa=="tipo_cargo"){$wheretipocargo=" and (select tipo_cargo from tbl_usuario where rut=h.rut)='$id_foco' ";}
    if ($rut == "")
        {
        $query_rut = "  ";
        }
      else
        {
        $query_rut = " and h.rut='$rut' and h.id_malla='$id_malla'";
        $limit = " limit 10 ";
        $order = "order by poc_aprobados DESC, total_medallas DESC, total_puntos DESC ";
        }

    if ($jefe == "")
        {
        $query_jefe = "  ";
        }
      else
        {
        $query_jefe = " and (
        (select jefe from tbl_usuario where rut=h.rut) ='$jefe' or (select lider from tbl_usuario where rut=h.rut) ='$jefe'
        )";
        $limit = "";
        $order = " order by h.id_malla,  poc_aprobados DESC, total_medallas DESC, total_puntos DESC ";
        }

    $sql = "


  SELECT
    h.rut,
sum(h.puntos) as total_puntos,
ROUND((select count(id) from tbl_badges_ganados where rut=h.rut and id_empresa=h.id_empresa )) as total_medallas
FROM
    tbl_gamificado_puntos h
WHERE

 h.id_empresa = '$id_empresa'
 $wheretipocargo
 $groupby


    $order
    $limit


";

    //echo "<br />DATA Ranking_desafios_PUNTOS_Data <br />$sql<br />";

    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();

    // echo "<br /><br />$sql<br />";

    return $cod;
    }

 function ObtenerMedallasBajo80($rut, $id_empresa){
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
select h.*,
(select  medallas from tbl_objeto where id=h.id_objeto) as medallas
 from tbl_objetos_finalizados h where h.rut='$rut' and h.id_objeto like 'lg_desafio_%' and nota>=75
    ";
    //echo $sql;
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function Save_Medallas_Bajo80($rut,$id_objeto, $medallas)
 {
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $fecha = date("Y-m-d");
    $hora  = date("H:i:s");
    $sql   = "update  tbl_gamificado_puntos set medallas='$medallas' where rut='$rut' and id_objeto='$id_objeto'";
  // echo $sql; $database->setquery($sql);
    $database->query();
}
function Ranking_desafios_avance_C1C2C3C4_Data($c1c2c3c4, $id_programa, $id_foco, $id_empresa, $jefe, $groupby)
    {
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $limit = " limit 10 ";

    if($id_empresa=="75"){
        $query_Sacar=" and h.c1<>'gerencia' and h.c1<>'GERENCIA GENERAL'";
    }   else {
        $query_Sacar="";
    }
        $wherec1c2c3c4= " and h.$groupby <>'' ";
        $qgerencia=" h.$groupby as gerencia ";

        $groupby = " group by h.$groupby ";
        // $order = "order by poc_aprobados DESC, total_medallas DESC, total_puntos DESC ";

            if ($id_programa == "")
                {
                $query_id_programa = "  ";
                $query_id_programaH = "  ";
                }
            else
                {
                $query_id_programa = "        AND tbl_lms_reportes.id_programa = '$id_programa'";
                $query_id_programaH = "        AND h.id_programa = '$id_programa'";

                }
            if ($id_foco == "")
                {
                $query_id_foco = "  ";
                $query_id_focoH = "  ";
                }
            else
                {
                $query_id_foco = "        AND tbl_lms_reportes.id_foco = '$id_foco'";
                $query_id_focoH ="        AND h.id_foco = '$id_foco'";
                }

    if ($rut == "")
        {
        $query_rut = "  ";
        }
      else
        {
        $query_rut = " and h.rut='$rut' and h.id_malla='$id_malla'";
        $limit = " limit 10 ";
        $order = "order by poc_aprobados DESC, total_medallas DESC, total_puntos DESC ";
        }

    if ($jefe == "")
        {
        $query_jefe = "  ";
        }
      else
        {
        $query_jefe = " and (
        (select jefe from tbl_usuario where rut=h.rut) ='$jefe' or (select lider from tbl_usuario where rut=h.rut) ='$jefe'
        )";
        $limit = "";
        $order = " order by h.id_malla,  poc_aprobados DESC, total_medallas DESC, total_puntos DESC ";
        }

    $sql = "select h.c1, h.c2, h.c3, h.c4,
            sum(h.puntos) as total_puntos,
            sum(h.medallas) as total_medallas,
            count(id) as total_cursos,
            round(avg(avance)) as avance,
            round(avg(avance)) AS avance,
            sum(avance) AS SumAvance,
            count(avance) AS CountAvance,
            round(sum(avance) / count(avance)) AS PorcAvance,
            $qgerencia

            from tbl_lms_reportes h

            where

            h.id_empresa='$id_empresa'

            and h.id_curso<>''

            $query_id_programaH
            $query_id_focoH

            and (select inactivo from rel_lms_malla_curso where id_curso=h.id_curso and id_malla=h.id_malla)='0'
            and h.nombre<>''
            and h.nombre<>'USUARIO INACTIVO'
            $wherec1c2c3c4
            $query_Sacar
            $groupby

            order by round(sum(avance) / count(avance))  DESC



";
 //and h.nombre<>''
//and h.nombre<>'USUARIO INACTIVO'
  //echo "<br>SQL<br><br> Ranking_desafios_avance_C1C2C3C4_Data $sql<br>";exit();

    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();

    // echo "<br />DATA Ranking_desafios_avance_C1C2C3C4_Data <br />$sql<br />";

    return $cod;
    }
function Wa_Ranking_desafios($rut, $id_malla, $id_empresa, $jefe){

    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);

     $limit =" limit 10 ";    $order ="order by poc_aprobados DESC, total_medallas DESC, total_puntos DESC ";
    if($rut==""){

        $query_rut="  ";
    } else {

        $query_rut=" and h.rut='$rut' and h.id_malla='$id_malla'";
        $limit =" limit 10 ";
        $order ="order by poc_aprobados DESC, total_medallas DESC, total_puntos DESC ";
    }


    if($jefe==""){
        $query_jefe="  ";

$sql="select h.rut, h.nombre ,
(select inactivo from rel_lms_malla_curso where id_curso=h.id_curso and id_malla=h.id_malla),
sum(h.puntos) as total_puntos,
sum(h.medallas) as total_medallas,
count(id) as total_cursos,
(
        SELECT
            count(tbl_lms_reportes.id)
        FROM
            tbl_lms_reportes
        INNER JOIN rel_lms_malla_curso ON rel_lms_malla_curso.id_curso = tbl_lms_reportes.id_curso
        WHERE
            tbl_lms_reportes.id_empresa = '$id_empresa'
        AND rut = h.rut
        AND rel_lms_malla_curso.id_malla = '$id_malla'
        AND rel_lms_malla_curso.id_clasificacion = 'wa_desafios'
        AND rel_lms_malla_curso.inactivo = '0'
    and tbl_lms_reportes.estado='APROBADO'
    ) AS num_aprobados,
(
        SELECT
            count(tbl_lms_reportes.id)
        FROM
            tbl_lms_reportes
        INNER JOIN rel_lms_malla_curso ON rel_lms_malla_curso.id_curso = tbl_lms_reportes.id_curso
        WHERE
            tbl_lms_reportes.id_empresa = '$id_empresa'
        AND rut = h.rut
        AND rel_lms_malla_curso.id_malla = '$id_malla'
        AND rel_lms_malla_curso.id_clasificacion = 'wa_desafios'
        AND rel_lms_malla_curso.inactivo = '0'
    and (tbl_lms_reportes.estado='APROBADO' or tbl_lms_reportes.estado='REPROBADO')
    ) AS num_realizados,



round(100*(( SELECT count(tbl_lms_reportes.id) FROM tbl_lms_reportes INNER JOIN rel_lms_malla_curso ON rel_lms_malla_curso.id_curso = tbl_lms_reportes.id_curso WHERE tbl_lms_reportes.id_empresa = '$id_empresa' AND rut = h.rut AND rel_lms_malla_curso.id_malla = '$id_malla' AND rel_lms_malla_curso.id_clasificacion = 'wa_desafios' AND rel_lms_malla_curso.inactivo = '0' and tbl_lms_reportes.estado='APROBADO' )/count(id))) as poc_aprobados,
 round(
         (
            (
                SELECT
                    AVG(tbl_lms_reportes.avance)
                FROM
                    tbl_lms_reportes
                INNER JOIN rel_lms_malla_curso ON rel_lms_malla_curso.id_curso = tbl_lms_reportes.id_curso
                WHERE
                    tbl_lms_reportes.id_empresa = '$id_empresa'
                AND rut = h.rut
                AND tbl_lms_reportes.id_malla = '$id_malla'
                AND tbl_lms_reportes.id_clasificacion = 'wa_desafios'
            )
        )
    ) as avance
from tbl_lms_reportes h

where

h.id_empresa='$id_empresa'

and h.id_curso<>''

and h.id_clasificacion='wa_desafios'

$query_rut

$query_jefe


and (select inactivo from rel_lms_malla_curso where id_curso=h.id_curso and id_malla=h.id_malla)='0'
and h.nombre<>''
and h.nombre<>'USUARIO INACTIVO'
group by h.rut
    $order
    $limit
";

    } else {
        $query_jefe=" and (
        (select jefe from tbl_usuario where rut=h.rut) ='$jefe' or (select lider from tbl_usuario where rut=h.rut) ='$jefe'
        )";

        $limit="";
        $order =" order by h.id_malla,  poc_aprobados DESC, total_medallas DESC, total_puntos DESC ";

$sql="select h.rut, h.nombre ,
(select inactivo from rel_lms_malla_curso where id_curso=h.id_curso and id_malla=h.id_malla),
sum(h.puntos) as total_puntos,
sum(h.medallas) as total_medallas,
count(id) as total_cursos,
(
        SELECT
            count(tbl_lms_reportes.id)
        FROM
            tbl_lms_reportes
        WHERE
            tbl_lms_reportes.id_empresa = '$id_empresa'
        AND rut =h.rut
        AND tbl_lms_reportes.id_clasificacion = 'wa_desafios'
        AND (
            tbl_lms_reportes.estado = 'APROBADO'
        )
    ) AS num_aprobados,
    (
SELECT
            count(tbl_lms_reportes.id)
        FROM
            tbl_lms_reportes
        WHERE
            tbl_lms_reportes.id_empresa = '$id_empresa'
        AND rut =h.rut
        AND tbl_lms_reportes.id_clasificacion = 'wa_desafios'
        AND (
            tbl_lms_reportes.estado = 'APROBADO'
            OR tbl_lms_reportes.estado = 'REPROBADO'
        )
    ) AS num_realizados,
    round(
        100 * (
            (
SELECT
            count(tbl_lms_reportes.id)
        FROM
            tbl_lms_reportes
        WHERE
            tbl_lms_reportes.id_empresa = '$id_empresa'
        AND rut =h.rut
        AND tbl_lms_reportes.id_clasificacion = 'wa_desafios'
        AND (
            tbl_lms_reportes.estado = 'APROBADO'
        )
            ) / count(id)
        )
    ) AS poc_aprobados,
    round(
        (
            (
                SELECT
                    AVG(tbl_lms_reportes.avance)
                FROM
                    tbl_lms_reportes
                WHERE
                    tbl_lms_reportes.id_empresa = '$id_empresa'
                AND rut = h.rut
                AND tbl_lms_reportes.id_clasificacion = 'wa_desafios'
            )
        )
    ) AS avance
from tbl_lms_reportes h

where

h.id_empresa='$id_empresa'

and h.id_curso<>''

and h.id_clasificacion='wa_desafios'

$query_rut

$query_jefe


and (select inactivo from rel_lms_malla_curso where id_curso=h.id_curso and id_malla=h.id_malla)='0'
and h.nombre<>''
and h.nombre<>'USUARIO INACTIVO'
group by h.rut
    $order
    $limit
";
  }



//echo "<br><br>".$sql;exit();
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();

   // echo "<br><br>$sql<br>";

    return $cod;

}

function  mi_equipo_lider_xls_data($tipo_reporte,$rut, $id_empresa){

  global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);

       $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
        if($tipo_reporte=="Consolidado"){ $jquery="GROUP BY  h.rut";}
        if($tipo_reporte=="Detalle"){ $jquery="GROUP BY  h.rut, h.id_curso";}

$sql="

SELECT
    h.rut_completo,
    h.nombre,
    h.cargo,
    h.email,
    h.c1,
    h.c2,
    h.c3,
    h.id_malla,
    h.id_curso,
    (
        SELECT
            nombre
        FROM
            tbl_lms_curso
        WHERE
            id = h.id_curso
    ) AS curso,

sum(h.puntos),
sum(h.medallas),
h.estado,
round(avg(h.avance)) as avance,
    (
        SELECT
            inactivo
        FROM
            rel_lms_malla_curso
        WHERE
            id_curso = h.id_curso
        AND id_malla = h.id_malla
        LIMIT 1
    ) AS inactivo,
round(avg(h.resultado)) AS nota


FROM
    tbl_lms_reportes h
WHERE
    (
        h.jefe = '$rut'
        OR h.lider = '$rut'
    )

$jquery


            " ;

    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();

    //echo "<br><br>SQL $sql<br>";

    return $cod;

}

function Ranking_Cursos_individual_c3_c4($id_curso, $id_tipo, $campoc3, $campoc4, $c3, $c4, $id_empresa){

    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);

       //echo  "$id_curso, $id_tipo, $id_empresa";

if($id_tipo=="individual")  {

$sql="select h.*,
(select $campoc3 from tbl_usuario where rut=h.rut) as c3,
(select $campoc4 from tbl_usuario where rut=h.rut) as c4
 from tbl_inscripcion_cierre h where h.id_curso ='$id_curso' and id_empresa='$id_empresa'
 and (select $campoc3 from tbl_usuario where rut=h.rut)='$c3'
 and (select $campoc4 from tbl_usuario where rut=h.rut)='$c4'

  order by nota DESC, id ASC limit 10";

  }

if($id_tipo=="c3")
{

$sql="SELECT
    round(avg(h.nota)) as nota, (
        SELECT
            $campoc3
        FROM
            tbl_usuario
        WHERE
            rut = h.rut
    ) AS c3, count(id) as Cuenta, (select count(id) from tbl_usuario where id_empresa=h.id_empresa and $campoc3=(
        SELECT
            $campoc3
        FROM
            tbl_usuario
        WHERE
            rut = h.rut
    )),

round(100*(  count(id)/(select count(id) from tbl_usuario where id_empresa=h.id_empresa and $campoc3=(
        SELECT
            $campoc3
        FROM
            tbl_usuario
        WHERE
            rut = h.rut
    ))),1) as avance,


    (
        SELECT
$campoc4
        FROM
            tbl_usuario
        WHERE
            rut = h.rut
    ) AS c4
FROM
    tbl_inscripcion_cierre h
WHERE
    h.id_curso = '$id_curso'
AND id_empresa = '$id_empresa'

group by (
        SELECT
            $campoc3
        FROM
            tbl_usuario
        WHERE
            rut = h.rut
    )

ORDER BY

round(100*(  count(id)/(select count(id) from tbl_usuario where id_empresa=h.id_empresa and $campoc3=(
        SELECT
            $campoc3
        FROM
            tbl_usuario
        WHERE
            rut = h.rut
    )))) ASC,


    nota DESC
LIMIT 10" ;

}


if($id_tipo=="c4")
{

$sql="SELECT
    round(avg(h.nota)) as nota, (
        SELECT
            $campoc4
        FROM
            tbl_usuario
        WHERE
            rut = h.rut
    ) AS c3, count(id) as Cuenta,
    (select count(id) from tbl_usuario where id_empresa=h.id_empresa and $campoc4=(
        SELECT
            $campoc3
        FROM
            tbl_usuario
        WHERE
            rut = h.rut
    )),

round(100*(  count(id)/(select count(id) from tbl_usuario where id_empresa=h.id_empresa and $campoc4=(
        SELECT
            $campoc4
        FROM
            tbl_usuario
        WHERE
            rut = h.rut
    ))),1) as avance,


    (
        SELECT
$campoc4
        FROM
            tbl_usuario
        WHERE
            rut = h.rut
    ) AS c4
FROM
    tbl_inscripcion_cierre h
WHERE
    h.id_curso = '$id_curso'
AND id_empresa = '$id_empresa'

group by (
        SELECT
            $campoc4
        FROM
            tbl_usuario
        WHERE
            rut = h.rut
    )

ORDER BY

round(100*(  count(id)/(select count(id) from tbl_usuario where id_empresa=h.id_empresa and $campoc4=(
        SELECT
            $campoc4
        FROM
            tbl_usuario
        WHERE
            rut = h.rut
    )))) ASC,


    nota DESC
LIMIT 10" ;

}

    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();

   //echo "<br><br>SQL $sql<br>";

    return $cod;

}

function BuscaTemplatePrograma($id_programa, $id_empresa){

    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);

    $sql="select template_programa from tbl_lms_programas_bbdd

    where

    id_programa='$id_programa' and id_empresa='$id_empresa' limit 1
    ";
    //echo $sql;

    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();

    return $cod[0]->template_programa;


}

function BuscaJefaturaReco($rut, $id_empresa){

    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);

    $sql="select jefe from tbl_usuario

    where

    rut='$rut' and id_empresa='$id_empresa' limit 1
    ";
    //echo $sql;

    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();

    return $cod[0]->jefe;


}

function nombre_categoria_reco($categoria, $id_empresa){

    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);

    $sql="select categoria

    from tbl_reconoce_categorias

    where     id_categoria='$categoria' and id_empresa='$id_empresa' limit 1
    ";
//echo $sql; sleep(2);

    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();

    return $cod[0]->categoria;


}


 function nombre_categoria_reco_full($categoria, $id_empresa){

    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);

    $sql="select *

    from tbl_reconoce_categorias

    where     id_categoria='$categoria' and id_empresa='$id_empresa' limit 1
    ";
    // echo $sql; sleep(2);

    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();

    return $cod;


}

function BuscaComentariosFinalEncuestasat($id_encuesta,$id_medicion, $rut, $id_empresa){

        global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);

    $sql="select comentario from tbl_enc_elearning_respuestas where
    id_encuesta='$id_encuesta' and id_medicion='$id_medicion' and id_empresa='$id_empresa'
    and rut='$rut' and comentario<>''

    limit 1";
    //echo $sql;
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();


    return $cod;

}



function BuscaCantidadInstanciasInscripcionUsuario($id_curso, $id_malla, $id_empresa, $rut){


    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);

    $sql="select * from tbl_inscripcion_usuarios where id_curso='$id_curso' and id_malla='$id_malla' and rut='$rut' and id_empresa='$id_empresa'";
    //echo $sql;
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();


    return $cod;


}
function Busca_Reco_Aprobado($rut_destinatario,$rut_remitente, $id_empresa){


    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);

$sql="select id from tbl_inscripcion_cierre where estado='APROBADO' and rut_remitente='$rut_remitente' and rut_destinatario='$rut_destinatario' and id_empresa='$id_empresa'";
 echo "<br>$sql";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod[0]->id;

}
function premios_puntos_a_vencer($rut, $saldo_puntos, $id_empresa) {

    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);

    $sql="
    select sum(puntos) as puntos, fecha from tbl_premios_puntos_usuarios where rut='$rut'  and id_empresa='$id_empresa' group by fecha order by id ASC limit 1
    ";

    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    $puntos=$cod[0]->puntos;
     // echo   "puntos $puntos>= saldo $saldo_puntos" ;
    if($puntos>=$saldo_puntos){$puntos_a_vencer=$saldo_puntos;}
    if($puntos<    $saldo_puntos){$puntos_a_vencer=$puntos;}

    $new_fecha= date('Y-m-d H:i:s', strtotime('+1 years', strtotime($cod[0]->fecha)));

    $arreglo[0]->puntos=$puntos_a_vencer;
    $arreglo[0]->fecha=($new_fecha);

    //print_r($arreglo);exit();

    return $arreglo;

}

function VerificaEstadoCursoRut($rut, $id_curso, $id_empresa) {

    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);

$sql="select avance from tbl_inscripcion_cierre where id_curso='$id_curso' and rut='$rut' and id_empresa='$id_empresa'";

    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod[0]->avance;

}

function Lms_Busca_MasdeunaMalla($rut, $id_programa, $id_empresa) {

    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);

$sql="select count(h.id) as cuenta from rel_lms_malla_persona h where rut='$rut'
and (select id_programa from rel_lms_malla_curso where id_malla=h.id_malla limit 1) ='$id_programa'
and h.id_empresa='$id_empresa'";

    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod[0]->cuenta;

}



function Lms_Busca_MasdeunaMalla_Array($rut, $id_programa, $id_empresa) {

    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);

$sql="select id_malla from  rel_lms_malla_persona h where rut='$rut'
and (select id_programa from rel_lms_malla_curso where id_malla=h.id_malla limit 1) ='$id_programa'
and h.id_empresa='$id_empresa'";


//echo $sql;
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;


}


function RelInt_Busca_Relatores_data($id_empresa){

    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql= "

    select h.*
from tbl_badges_ganados h where h.id_empresa='$id_empresa' and h.badge='Relator Interno'

and (select rut from tbl_usuario where rut=h.rut)<>''

order by (select nombre_completo from tbl_usuario where rut=h.rut)

    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;


}


function BuscaProgramaInd($rut, $id_empresa, $id_programa) {

    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql= "


    select count(h.id) as cuenta

    from rel_lms_malla_persona h where h.id_empresa='$id_empresa' and  h.rut='$rut'

    and (select id_programa from rel_lms_malla_curso where id_malla=h.id_malla limit 1)='$id_programa'

    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;

}

function OtrosPostMismaFechaHoraAntes($rut, $id_empresa, $fecha, $hora){

    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql= "select * from tbl_mp where id_empresa='$id_empresa' and fecha = '$fecha' and hora>'$hora' and rut<>'$rut'  ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
    }

    function OtrosPostFechaPosterior($rut, $id_empresa, $fecha){

    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql= "select * from tbl_mp where id_empresa='".$id_empresa."' and fecha>'$fecha' and rut<>'$rut'  ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
    }


function UltimoAccesoAlForo($rut, $id_empresa){

     global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);


    $sql= "select * from tbl_log_sistema where rut='$rut' and ambiente='com_mp_personal' and id_empresa='$id_empresa' order by id desc limit 1
    ";


    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;


}



function Postulaciones_busca_BeneficiosValidar($rut, $id_empresa){

    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);


    $sql= "
    select h.*,
    (select nombre_completo from tbl_usuario where rut=h.rut) as nombre_completo,
    (select premio from tbl_premios where id_premio=h.id_premio limit 1) as premio,

    (select jefe from tbl_usuario where rut=h.rut limit 1)

    from tbl_premios_canje h

    where h.id_empresa='$id_empresa'
    and (select jefe from tbl_usuario where rut=h.rut limit 1)='$rut' and h.estadovalidacion='2'
    ";


    //echo "<br>$sql";

    //and tbl_mp.id_mp='62_mp935'
    //$query_arreglo_GrupoInteres
    //$query_arreglo_PersonaSeguida

    //echo $sql;
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;


}


function Postulaciones_busca_PostulacionesValidar($rut, $id_empresa){

     global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);


    $sql= "
    select h.*,
    (select nombre_completo from tbl_usuario where rut=h.rut) as nombre_completo,
    (select dimension from tbl_postulables where id_postulable=h.id_postulable) as dimension,
    (select nombre from tbl_postulables where id_postulable=h.id_postulable) as nombre,
    (select descripcion from tbl_postulables where id_postulable=h.id_postulable) as descripcion,


   h.jefe  from tbl_postulaciones h where h.id_empresa='$id_empresa'
and h.jefe='$rut' and h.jefeok=''
    ";


    //echo "<br>$sql";

    //and tbl_mp.id_mp='62_mp935'
    //$query_arreglo_GrupoInteres
    //$query_arreglo_PersonaSeguida

    //echo $sql;
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;


}

function CuentaPostulaciones($rut, $tipo_postulable, $id_empresa){

     global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);


    $sql= "
    SELECT    count(id) as cuenta

        from tbl_postulaciones

    where id_empresa='$id_empresa' and tipo_postulable='$tipo_postulable' and rut='$rut'  and jefeok<>'NO'
    ";


    //echo "<br>$sql";

    //and tbl_mp.id_mp='62_mp935'
    //$query_arreglo_GrupoInteres
    //$query_arreglo_PersonaSeguida

    //echo $sql;
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;

}

function CuentaPostulacionesFecha($rut, $tipo_postulable, $fecha, $id_empresa){

     global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);


    $sql= "
    SELECT    count(id) as cuenta

        from tbl_postulaciones

    where id_empresa='$id_empresa' and fecha>'$fecha' and tipo_postulable='$tipo_postulable' and rut='$rut'  and jefeok<>'NO'
    ";


    //echo "<br>$sql";

    //and tbl_mp.id_mp='62_mp935'
    //$query_arreglo_GrupoInteres
    //$query_arreglo_PersonaSeguida

    //echo $sql;
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;

}

function CuentaPostulacionesItem($rut, $tipo_postulable, $ide, $id_empresa){

     global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);


    $sql= "
    SELECT    count(id) as cuenta

        from tbl_postulaciones

    where id_empresa='$id_empresa' and tipo_postulable='$tipo_postulable' and rut='$rut'
    and id_postulable='$ide' and jefeok<>'NO'
    ";


    //echo "<br>$sql";

    //and tbl_mp.id_mp='62_mp935'
    //$query_arreglo_GrupoInteres
    //$query_arreglo_PersonaSeguida

    //echo $sql;
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;

}

function com_mp_lista_stories($id_empresa, $rut, $ord_by, $filt_by, $filt_cat, $vp, $arreglo_tags, $tag, $rut_enviado, $ambiente, $com_limit, $com_start, $start_limit, $subcategoria, $id_amb, $tipo_stories)
{
    // echo $start_limit;
    // echo "$id_empresa, $rut, $ord_by, $filt_by, $filt_cat, $vp, $arreglo_tags, $tag, $rut_enviado, $ambiente,
    // $com_limit, $com_start, $start_limit, $subcategoria, $id_amb";
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    if ($tipo_stories == "stories_twit") {
        $query = " and h.stories<>'' ";
    }
    if ($tipo_stories == "stories_360") {
        $query = " and h.video<>'' ";
    }
    $sql = "
    SELECT    h.* from tbl_mp_stories h where h.id_empresa='$id_empresa' and h.id_categoria='$tipo_stories' $query order by h.id DESC
    $limite

    ";
    // echo "<br />$sql";
    // and tbl_mp.id_mp='62_mp935'
    // $query_arreglo_GrupoInteres
    // $query_arreglo_PersonaSeguida
    // echo $sql;
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}

function com_mp_lista_fotoGPTW_data($id_empresa, $rut, $ord_by, $filt_by, $filt_cat, $vp, $arreglo_tags, $tag, $rut_enviado, $ambiente, $com_limit, $com_start, $start_limit, $subcategoria, $id_amb, $tipo_stories)
{
    // echo $start_limit;
    // echo "$id_empresa, $rut, $ord_by, $filt_by, $filt_cat, $vp, $arreglo_tags, $tag, $rut_enviado, $ambiente,
    // $com_limit, $com_start, $start_limit, $subcategoria, $id_amb";
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);

    $sql = "


SELECT
    h.*
FROM
    tbl_mp_fotomensaje h
WHERE
    h.id_empresa = '$id_empresa'
AND h.foto <> ''
AND h.mensaje <> ''
AND h.rut <> ''
order by h.nombre_completo

    ";
    //echo "<br />com_mp_lista_fotoGPTW_data data $sql";
    // and tbl_mp.id_mp='62_mp935'
    // $query_arreglo_GrupoInteres
    // $query_arreglo_PersonaSeguida
    //echo $sql;
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function com_mp_lista_grupo_data($id_empresa, $rut, $grupo, $ord_by, $filt_by, $filt_cat, $vp, $arreglo_tags, $tag, $rut_enviado, $ambiente, $com_limit, $com_start, $start_limit, $subcategoria, $id_amb, $tipo_stories)
{
    // echo $start_limit;
    // echo "$id_empresa, $rut, $ord_by, $filt_by, $filt_cat, $vp, $arreglo_tags, $tag, $rut_enviado, $ambiente,
    // $com_limit, $com_start, $start_limit, $subcategoria, $id_amb";
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);

    $sql = "


SELECT
    h.*
FROM
    tbl_mp_fotomensaje h
WHERE
    h.id_empresa = '$id_empresa'
AND h.foto <> ''
AND h.mensaje <> ''
AND h.rut <> ''
and grupo='$grupo'
order by h.nombre_completo

    ";
   // echo   "$id_empresa, $rut, $grupo";
  //  echo "<br>sql <br>$sql";
    //echo "<br />com_mp_lista_fotoGPTW_data data $sql";
    // and tbl_mp.id_mp='62_mp935'
    // $query_arreglo_GrupoInteres
    // $query_arreglo_PersonaSeguida
    //echo $sql;
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function com_mp_lista_fotoGPTW_Top10_data($id_empresa, $rut, $ord_by, $filt_by, $filt_cat, $vp, $arreglo_tags, $tag, $rut_enviado, $ambiente, $com_limit, $com_start, $start_limit, $subcategoria, $id_amb, $tipo_stories)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);

    $sql = "
    SELECT
    h.*, (
        SELECT
            nombre_completo
        FROM
            tbl_usuario
        WHERE
            rut = h.rut
    ) AS nombre,
    (
        SELECT
            count(id)
        FROM
            tbl_mp_interacciones
        WHERE
            id_mp = CONCAT(h.id_empresa, '_gpw_', h.id)
    ) AS cuentaMeGusta
    FROM
        tbl_mp_fotomensaje h
    WHERE
        h.id_empresa = '$id_empresa'
    AND h.foto <> ''
    AND h.mensaje <> ''
    AND h.rut <> ''
    ORDER BY
    (
            SELECT
                count(id)
            FROM
                tbl_mp_interacciones
            WHERE
                id_mp = CONCAT(h.id_empresa, '_gpw_', h.id)
        ) DESC
    LIMIT 10

    ";

    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}

function BuscaCursosProgramaData($id_programa, $id_empresa){

    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);

$sql="select h.*,

    (select nombre from tbl_lms_curso where id=h.id_curso) as nombre_curso,
    (select descripcion from tbl_lms_curso where id=h.id_curso) as descripcion_curso,
    (select imagen from tbl_lms_curso where id=h.id_curso) as imagen_curso

    from rel_lms_malla_curso h

    where h.id_programa='$id_programa' and h.id_empresa='$id_empresa' order by h.orden_curso";


 //echo $sql;
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;

}
function MP_Row_Carrusel_Vista_data($id_empresa){

    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);

    $sql="
        select h.* from
        tbl_mp_stories h
        where h.id_empresa='$id_empresa'
        order by h.id DESC
        limit 10
            ";

    //echo $sql;

    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}

function BuscaRutdadoEmail($email, $id_empresa){

    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);

    $sql="
        select * from tbl_usuario where email='$email' and id_empresa='$id_empresa'  limit 1
            ";

    //echo $sql;

    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}


function MP_Busca_mi_360_data($rut,$id_empresa){

        global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);

    $sql="
        select h.id_st as id_st from
        tbl_mp_stories h
        where h.id_empresa='$id_empresa' and h.rut='$rut'
        and id_categoria='stories_360'

        limit 1
            ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;


}

function MP_Busca_mi_fotoGPTW_data($rut,$id_empresa){

        global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);

    $sql="
        select h.*, h.id as id_st

        from

        tbl_mp_fotomensaje h

        where h.id_empresa='$id_empresa' and h.rut='$rut'

        limit 1
            ";
        //echo $sql;
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;


}
function MP_Busca_mi_fotoTUTRANS_DIA_GRUPO_data($rut,$grupo,$id_empresa){

        global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);

    $sql="
        select h.*, h.id as id_st

        from

        tbl_mp_fotomensaje h

        where h.id_empresa='$id_empresa' and h.rut='$rut' and h.grupo='$grupo'
        limit 1
            ";
        //echo $sql;
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;


}
function MP_Row_Carrusel_FotoGPTW_data($id_empresa){

    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);

    $sql="
        select h.* from
        tbl_mp_fotomensaje h
        where h.id_empresa='$id_empresa' and rut<>'' and foto<>'' and mensaje<>''
        order by h.id DESC
        limit 10
            ";

    //echo $sql;

    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function MP_Row_Carrusel_FotoTuTransDia_data($id_empresa, $grupo){

    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);

        $sql="
                select h.* from
                tbl_mp_fotomensaje h
                where h.id_empresa='$id_empresa' and rut<>'' and foto<>'' and mensaje<>''    and grupo='$grupo'
and (h.id='744' or

h.id='743' or

h.id='813' or

h.id='1157' or

h.id='785' or

h.id='1187' )



                        ";
            //    order by h.id DESC
            //          limit 20

        //echo $sql;

    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function MP_Row_Tendecias_TAG_MP_data($id_empresa){

    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);

    $sql="

    SELECT
    h.*, (
        SELECT DISTINCT(count(id_mp))
        FROM
            tbl_mp_tag
        WHERE
            tag = h.tag
    ) AS cuenta

from tbl_mp_tag_admin h
WHERE
    id_empresa = '$id_empresa'


    order by (
        SELECT DISTINCT(count(id_mp))
        FROM
            tbl_mp_tag
        WHERE
            tag = h.tag
    ) DESC

    limit 15

            ";

    //echo $sql;

    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}


function MP_Row_Carrusel_360_data($id_empresa){

    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);

    $sql="
        select h.* from
        tbl_mp_stories h
        where h.id_empresa='$id_empresa' and id_categoria='stories_360' and video<>'' and imagen<>''
        order by h.id DESC
        limit 10
            ";

    //echo $sql;

    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ValidaMalla_epf($id_empresa, $rut){

    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select count(id) as cuenta from rel_lms_malla_persona where rut='$rut' and id_empresa='$id_empresa' and id_malla='e_p_f'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();

    if($rut=='12463565'){ echo "<br>1 sql $sql, cod ".$cod[0]->cuenta;}

    if($cod[0]->cuenta==0){

    $sql   = "INSERT INTO

                rel_lms_malla_persona

                (rut, id_malla, id_empresa)

                values
                ('$rut','e_p_f','$id_empresa')

                ";// echo $sql;
    $database->setquery($sql);
    $database->query();



    }

    if($rut=='12463565'){ echo "<br> 2 sql inserta $sql";}


    if($cod[0]->cuenta>1){

        $sql="delete * from rel_lms_malla_persona where id_empresa='$id_empresa' and rut='$rut' and id_malla='e_p_f' ";
        $database->setquery($sql);
        $database->query();

    if($rut=='12463565'){ echo "<br>3 sql borra $sql";}


         $sql   = "INSERT INTO

                rel_lms_malla_persona

                (rut, id_malla, id_empresa)

                values
                ('$rut','e_p_f','$id_empresa')

                ";// echo $sql;
    $database->setquery($sql);
    $database->query();

        if($rut=='12463565'){ echo "<br>4 sql INSERT $sql";}


    }

    return $cod[0]->cuenta;


}
function MP_Stories_Despublicar($id_mp, $id_empresa){


    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);

    $sql="
        update tbl_mp_stories set id_empresa='99' where id_st='$id_mp'
            ";

    //echo $sql;

    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;

}

function MP_GPTW_Despublicar($id_mp, $id_empresa){


    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);

    $sql="
        update tbl_mp_fotomensaje set id_empresa='99' where id='$id_mp'
            ";

    //echo $sql;

    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;

}



function MP_Row_Carrusel_twit_data($id_empresa){

    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);

    $sql="
        select h.* from
        tbl_mp_stories h
        where h.id_empresa='$id_empresa'   and id_categoria='stories_twit' and stories<>''
        order by h.id DESC
        limit 20
            ";

    //echo $sql;

    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}

function SEGUIMIENTO_EsDealerEncargado($rut, $id_empresa){

    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);

    $sql="
        select
            tbl_sis_seguimiento_dealer_encargados.*, tbl_usuario.tipo_servicio as id_dealer
        from tbl_sis_seguimiento_dealer_encargados

        inner join tbl_usuario
        on tbl_usuario.rut=tbl_sis_seguimiento_dealer_encargados.rut
            where
                tbl_sis_seguimiento_dealer_encargados.rut='$rut' and
                tbl_sis_seguimiento_dealer_encargados.id_empresa='$id_empresa'


            ";

    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}


function allDealers($buscar, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "SELECT * FROM tbl_sis_seguimiento_dealer
     WHERE  id_dealer like '%" . $buscar . "%' OR  descripcion like '%" . $buscar . "%'

     ORDER BY descripcion";
    $database->setquery($sql);
    $database->query();
    $datos = $database->listObjects();
    return $datos;
}
function BACBUS_Procesa_Grafico_general_data($filtro_reporte,$filtro_desde,$filtro_hasta,$filtro_tipo,$filtro_zona_reporte,$filtro_etapa, $id_empresa){


//echo "<br>filtro $filtro_reporte, desde $filtro_desde, hasta $filtro_hasta, tipo $filtro_tipo, zona_depto $filtro_zona_reporte, etapa $filtro_etapa";




    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);

     $qt="";
     if($filtro_tipo=="BAC")    { $qt=" and  h.tipo_registro='BAC' ";}
     if($filtro_tipo=="BUS")    { $qt=" and  h.tipo_registro='BUS' ";}
     if($filtro_tipo=="BAC+BUS"){ $qt=" and  (h.tipo_registro='BAC' or h.tipo_registro='BUS') ";}
     if($filtro_tipo=="DCR")    { $qt=" and  (h.tipo_registro='DCR') ";}

    $qfd=""; if($filtro_desde<>''){ $qfd=" and h.fecha_visita>='$filtro_desde' ";}
    $qfh=""; if($filtro_hasta<>''){ $qfh=" and h.fecha_visita<='$filtro_hasta' ";}
    $qfe=""; if($filtro_etapa<>''){ $qfe=" and h.estado_registro='$filtro_etapa'";}

    $qzn=""; if($filtro_zona_reporte<>''){ $qzn=" and (select departamento from tbl_usuario where rut=h.rut_col)='$filtro_zona_reporte' ";}
    //zona

if($filtro_reporte=="visita" or $filtro_reporte=="solicitud" or $filtro_reporte=="tiposolicitudes"){

$sql="
    select h.*, (select count(id) from tbl_sis_seguimiento_situaciones where id_seguimiento=h.id) as cuenta_situaciones,
    (select regional from tbl_usuario  where id_unidad_negocio=h.id_cui_col limit 1) as region

    from tbl_sis_seguimiento h

    WHERE

    id_empresa='$id_empresa'
    $qfd $qfh $qt $qfe $qzn
";

}




    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();


    return $cod;


}




function SEGUIMIENTO_UltimoComentarioDeSupervisor($id, $rut){

    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);


$sql="
    select
        tbl_sis_seguimiento_comentarios.*, tbl_usuario.nombre_completo
            from tbl_sis_seguimiento_comentarios

            inner join tbl_usuario
            on tbl_usuario.rut=tbl_sis_seguimiento_comentarios.rut

        where tbl_sis_seguimiento_comentarios.id_registro='$id'
            and tbl_sis_seguimiento_comentarios.rut='$rut'
            order by tbl_sis_seguimiento_comentarios.id desc limit 1";

    //echo $sql;
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();


    return $cod;

}


function TraeNoticiasSecundariasSinConcurso($id_empresa, $limit)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    if ($id_empresa == 22) {
        $datos_usuario_session = UsuarioEnBasePersonas($_SESSION["user_"], $rutcontodo);
        if ($datos_usuario_session[0]->unidad_negocio == "Sucursales") {
            $filtro_mundo = "and (tbl_noticias.id_mundo='0' or tbl_noticias.id_mundo='2')";
        } else if ($datos_usuario_session[0]->unidad_negocio == "Santiago") {
            $filtro_mundo = "and (tbl_noticias.id_mundo='0' or tbl_noticias.id_mundo='1')";
        }
    }
    $sql = "


     SELECT
     tbl_noticias.*, tbl_noticias_categorias.categoria AS nombre_categoria
    FROM
     tbl_noticias
INNER JOIN tbl_noticias_categorias ON tbl_noticias_categorias.id = tbl_noticias.categoria




WHERE
     estado = '1'
AND tbl_noticias.id_empresa = '$id_empresa'
and tbl_noticias.principal=0
and slider_activo=0
and tbl_noticias.categoria<>'72'



$filtro_mundo
order by orden is  null, orden asc, fecha_creacion desc


$limit


     ";


    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}



function premios_buscaSaldo($rut, $id_empresa){

    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);

$sql="

select sum(puntos) as puntos, 'ingreso' from tbl_premios_puntos_usuarios
where rut='$rut' and id_empresa='$id_empresa'

UNION

select (1)*sum(puntos) as puntos,  'egreso' from tbl_premios_canje
where rut='$rut' and id_empresa='$id_empresa'

";



    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();


    return $cod;

}

    function PremioBuscaNombre($id_premio, $id_empresa){

       global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);


$sql="select premio

from tbl_premios

where id_premio='$id_premio' and id_empresa='$id_empresa'

";


    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();


    return $cod[0]->premio;


    }

function premios_busca_cartola($rut, $id_empresa, $limit){

    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);



    if($limit<>''){ $qlimit=" limit $limit ";} else {$qlimit="";    }


$sql="select id, rut, fecha, puntos, tipo, descripcion, 'ingreso'

from tbl_premios_puntos_usuarios

where rut='$rut' and id_empresa='$id_empresa'

UNION

select

id, rut, fecha, puntos, id_premio, estadovalidacion, 'egreso'

from tbl_premios_canje

where rut='$rut' and id_empresa='$id_empresa' and estadovalidacion<>'3'

order by fecha DESC, id DESC $qlimit";

    //echo $sql;

    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();


    return $cod;

}


function Becas_SAVE($rut,$id_empresa,$fecha,$hora,$estado,$fecha_estado,
$tipo_beca,$nombre_beca,$ficha_postulacion,$certificado_notas,$pago_arancel,
$certificado_carga,$concentracion_notas,$licencia_edmedia,$boletinpsu,
$certificado_egreso,$certificado_acredita,

$ficha_vivienda_rut_propietario,
$ficha_vivienda_nombre_propietario,
$ficha_vivienda_fecha_escritura,
$ficha_vivienda_valor,
$ficha_vivienda_direccion,
$target_file_vivienda_foto_escritura,
$target_file_vivienda_cedula,
$target_file_vivienda_residencia,
$target_file_vivienda_matrimonio,    $num_celular,
        $anexo,
        $carrera,
        $otracarrera,
        $tipocarrera,
        $casaestudios,
        $otracasa,
        $prosecucion,
        $semestre,
        $montototal,$fecha_inicio,
    $fecha_termino, $dia, $dia2, $fecha_nac,
    $tipo_wf){

    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);

    $sql="select id from tbl_becas where id_empresa='$id_empresa' and rut='$rut'
    and tipo_beca='$tipo_beca'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
   /*/echo "$rut,$id_empresa,$fecha,$hora,$estado,$fecha_estado,
$tipo_beca,$nombre_beca,$ficha_postulacion,$certificado_notas,$pago_arancel,
$certificado_carga,$concentracion_notas,$licencia_edmedia,$boletinpsu,
$certificado_egreso,$certificado_acredita,

$ficha_vivienda_rut_propietario,
$ficha_vivienda_nombre_propietario,
$ficha_vivienda_fecha_escritura,
$ficha_vivienda_valor,
$ficha_vivienda_direccion,
$target_file_vivienda_foto_escritura,
$target_file_vivienda_cedula,
$target_file_vivienda_residencia,
$target_file_vivienda_matrimonio,    $num_celular,
        $anexo,
        $carrera,
        $otracarrera,
        $tipocarrera,
        $casaestudios,
        $otracasa,
        $prosecucion,
        $semestre,
        $montototal"; sleep(2);  /**/

  // echo "<br><br>"; echo $sql;
  // sleep(5); echo "<br><br>";

    if($cod[0]->id<>''){

    $id_update=$cod[0]->id;

    $sql = "update

    tbl_becas

    set ficha_postulacion='$ficha_postulacion',certificado_notas='$certificado_notas',
    pago_arancel='$pago_arancel',
    certificado_carga='$certificado_carga',concentracion_notas='$concentracion_notas',
    licencia_edmedia='$licencia_edmedia',boletinpsu='$boletinpsu',
    certificado_egreso='$certificado_egreso',certificado_acredita='$certificado_acredita',
    ficha_vivienda_rut_propietario='$ficha_vivienda_rut_propietario',
    ficha_vivienda_nombre_propietario   ='$ficha_vivienda_nombre_propietario',
ficha_vivienda_fecha_escritura  ='$ficha_vivienda_fecha_escritura',
ficha_vivienda_valor    ='$ficha_vivienda_valor',
ficha_vivienda_direccion    ='$ficha_vivienda_direccion',
vivienda_foto_escritura ='$target_file_vivienda_foto_escritura',
vivienda_cedula ='$target_file_vivienda_cedula',
vivienda_residencia ='$target_file_vivienda_residencia',
vivienda_matrimonio ='$target_file_vivienda_matrimonio' ,
num_celular     ='$num_celular',
anexo           ='$anexo',
carrera         ='$carrera',
otracarrera     ='$otracarrera',
tipocarrera     ='$tipocarrera',
casaestudios    ='$casaestudios',
otracasa        ='$otracasa',
prosecucion     ='$prosecucion',
semestre        ='$semestre',
fecha_inicio    ='$fecha_inicio',
fecha_termino   ='$fecha_termino',
dia             ='$dia',
dia2            ='$dia2',
fecha_nac       ='$fecha_nac',
tipo_wf         ='$tipo_wf'

where id='$id_update' ";
    $database->setquery($sql);
    $database->query();


    } else {


    $fecha = date("Y-m-d");
    $hora  = date("H:i:s");

    $fecha_estado=$fecha;
    $estado="POSTULACION";

    $sql   = "

    INSERT INTO

    tbl_becas

(rut,id_empresa,fecha,hora,estado,fecha_estado,
tipo_beca,nombre_beca,ficha_postulacion,certificado_notas,pago_arancel,
certificado_carga,concentracion_notas,licencia_edmedia,boletinpsu,
certificado_egreso,certificado_acredita,
ficha_vivienda_rut_propietario,
ficha_vivienda_nombre_propietario,
ficha_vivienda_fecha_escritura,
ficha_vivienda_valor,
ficha_vivienda_direccion,
vivienda_foto_escritura,
vivienda_cedula,
vivienda_residencia,
vivienda_matrimonio,
num_celular,
anexo,
carrera,
otracarrera,
tipocarrera,
casaestudios,
otracasa,
prosecucion,
semestre,
montotal,
fecha_inicio,
fecha_termino,
dia,
dia2,
fecha_nac,
tipo_wf
)

values

('$rut','$id_empresa','$fecha','$hora','$estado','$fecha_estado',
'$tipo_beca','$nombre_beca','$ficha_postulacion','$certificado_notas','$pago_arancel',
'$certificado_carga','$concentracion_notas','$licencia_edmedia','$boletinpsu',
'$certificado_egreso','$certificado_acredita',

'$ficha_vivienda_rut_propietario',
'$ficha_vivienda_nombre_propietario',
'$ficha_vivienda_fecha_escritura',
'$ficha_vivienda_valor',
'$ficha_vivienda_direccion',
'$target_file_vivienda_foto_escritura',
'$target_file_vivienda_cedula',
'$target_file_vivienda_residencia',
'$target_file_vivienda_matrimonio',
'$num_celular',
'$anexo',
'$carrera',
'$otracarrera',
'$tipocarrera',
'$casaestudios',
'$otracasa',
'$prosecucion',
'$semestre',
'$montototal',
'$fecha_inicio',
'$fecha_termino',
'$dia',
'$dia2',
'$fecha_nac',
'$tipo_wf')";

    $database->setquery($sql);
    $database->query();



    }



//echo $sql;sleep(5);





}

function DatosEvento($id_evento, $id_empresa){

    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);

    $sql="select h.* from tbl_eventos h where h.id_empresa='$id_empresa' and h.codigo='$id_evento'";

    //echo $sql; sleep(5);
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();

    return $cod;

}
function DatosPostulable($id_postulable, $id_empresa){

    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);

    $sql="select h.* from tbl_postulables h where h.id_empresa='$id_empresa' and h.id_postulable='$id_postulable'";

    //echo $sql; sleep(5);
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();

    return $cod;

}

function DatosPremioId($id_premio, $id_empresa){

    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);

    $sql="select h.* from tbl_premios h where h.id_empresa='$id_empresa' and h.id_premio='$id_premio' limit 1";

    //echo $sql; sleep(5);
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();

    return $cod;

}

function Postulaciones_SAVE($rut,$id_empresa,$fecha,$hora,$estado,$fecha_estado,$jefeok,
    $tipo_postulable, $id_postulable, $id_registro){

    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $Usua=DatosUsuario_($rut, $id_empresa);
    $sql="select id from tbl_postulaciones where id_empresa='$id_empresa' and rut='$rut'
    and tipo_postulable='$tipo_postulable' and id_postulable='$id_postulable'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();

     $jefe=$Usua[0]->jefe;
  // echo "<br><br>"; echo $sql;
  // sleep(5); echo "<br><br>";

    if($cod[0]->id<>''){
    echo "No puedes postular al mismo item dos veces"; sleep(3);
    } else {

        if($id_registro<>''){


                    $sql = "update

                    tbl_postulaciones

                set jefeok='$jefeok',fechajefe='$fechajefe'

                    where id='$id_registro' ";
                    $database->setquery($sql);
                    $database->query();


                    } else {


                    $fecha = date("Y-m-d");
                    $hora  = date("H:i:s");

                    $fecha_estado=$fecha;


                    $sql   = "INSERT INTO

                    tbl_postulaciones

                (rut,id_empresa,fecha,hora,estado,fecha_estado,tipo_postulable,
                nombre_postulable,descripcion_postulacion,jefeok,
                fechajefe,validacionok,fechavalidacion, id_postulable, jefe)

                values

                ('$rut','$id_empresa','$fecha','$hora','$estado','$fecha_estado','$tipo_postulable',
                '$nombre_postulable','$descripcion_postulacion','$jefeok',
                '$fechajefe',
                '$validacionok','$fechavalidacion','$id_postulable','$jefe')";

                    $database->setquery($sql);
                    $database->query();


                    }

                }

}


function  MP_DeleteInscripcionEvento($ide,$id_empresa) {

        global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);

        $sql="delete * from tbl_eventos_inscritos where id_empresa='$id_empresa' and id='$ide' ";
       // echo $sql;
        $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();
        return $cod;

}

function MP_Lee_misPostulaciones_eventos($rut,  $id_empresa){

        global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);
        $hoy=date("Y-m-d");
        $sql="select h.*,
(select nombre from tbl_eventos where id_empresa=h.id_empresa and codigo=h.codigo) as nombre_evento,
(select descripcion from tbl_eventos where id_empresa=h.id_empresa and codigo=h.codigo) as descripcion_evento
from tbl_eventos_inscritos h
where h.id_empresa='$id_empresa' and h.rut='$rut'
and h.id_dimension='com_ev' and  h.fecha >'$hoy'

and (select invisible from tbl_eventos where id_empresa=h.id_empresa and codigo=h.codigo)='0'";
      // echo $sql;
        $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();
        return $cod;

}

function Inscripcion_Eventos_SAVE($rut,$id_empresa,$fecha,$hora,$estado,
$codigo,$id_categoria,$id_dimension){

        global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);

        $sql="select id from tbl_eventos_inscritos where id_empresa='$id_empresa' and rut='$rut'
        and codigo='$codigo'";
        $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();


    // echo "<br><br>"; echo $sql;
    // sleep(5); echo "<br><br>";

        if($cod[0]->id<>''){
        echo "No puedes postular al mismo item dos veces"; sleep(3);
        } else {




                                        $fecha = date("Y-m-d");
                                        $hora  = date("H:i:s");

                                        $fecha_estado=$fecha;


                                        $sql   = "INSERT INTO

                                        tbl_eventos_inscritos

                                (rut,id_empresa,fecha,hora,estado,codigo,id_categoria,id_dimension)

                                values

                                ('$rut','$id_empresa','$fecha','$hora','$estado','$codigo','$id_categoria','$id_dimension')";

                                        $database->setquery($sql);
                                        $database->query();




                                }

}

function buscaDatosPremio($ide, $id_empresa){


    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);

    $sql="select id_premio from tbl_premios_canje where id_empresa='$id_empresa' and id='$ide'  limit 1
    ";


    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();


    return $cod[0]->id_premio;

}

function ActualizaJefe_beneficios_validar($idimte, $validacion, $id_empresa){


    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $hoy=date("Y-m-d");
    $sql="update tbl_becas set validacionok='$validacion', fechavalidacion='$hoy'
      where id_empresa='$id_empresa' and id='$idimte'  limit 1
    ";

     //echo "ActualizaJefe_beneficios_validar $sql"; exit();
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();


    return $cod[0]->id_premio;

}

function buscaDatosBeneItem($ide, $id_empresa){


    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);

    $sql="select nombre from tbl_beneficios where id_empresa='$id_empresa' and id_beneficios='$ide'  limit 1
    ";

    echo "<br>sql $sql";

    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();


    return $cod[0]->nombre;

}
function buscaDatosPostulacion($ide, $id_empresa){


    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);

    $sql="select id_postulable from tbl_postulables where id_empresa='$id_empresa' and id='$ide'
    ";

//    echo $sql;


    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();


    return $cod[0]->id_postulable;

}
function buscaDatosPostulacionRealizada($ide, $id_empresa){


           global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);

    $sql="select id_postulable from tbl_postulaciones where id_empresa='$id_empresa' and id='$ide'
    ";

//    echo $sql;


    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();


    return $cod[0]->id_postulable;

}




function EliminaCanjePuntosCero($id, $id_empresa, $puntos) {

    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);

        $fecha = date("Y-m-d");
        $hora  = date("H:i:s");
        $fecha_estado=$fecha;

    $sql="update tbl_premios_canje set puntos='0' where id_empresa='$id_empresa' and id='$id'";


    // echo $sql; sleep(5);
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();

}




function Postulaciones_DesisteUsuarios($id,$id_empresa,$v){

    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);

        $fecha = date("Y-m-d");
        $hora  = date("H:i:s");
        $fecha_estado=$fecha;

    $sql="delete from tbl_postulaciones  where id_empresa='$id_empresa' and id='$id'";

    // echo $sql; sleep(5);
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();


}

function Postulaciones_UPDATEJEFE($id,$id_empresa,$v){

    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);

        $fecha = date("Y-m-d");
        $hora  = date("H:i:s");
        $fecha_estado=$fecha;

    $sql="update tbl_postulaciones set jefeok='$v',fechajefe='$fecha' where id_empresa='$id_empresa' and id='$id'";

    // echo $sql; sleep(5);
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();


}

function Beneficios_UPDATEJEFE($id,$id_empresa,$v){

    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);

        $fecha = date("Y-m-d");
        $hora  = date("H:i:s");
        $fecha_estado=$fecha;

    $sql="update tbl_premios_canje set estadovalidacion='$v',fechavalidacion='$fecha' where id_empresa='$id_empresa' and id='$id'";
     //echo $sql; sleep(5);
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();


}


function Becas_busca_MisPostulaciones($rut, $id_empresa){
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);

    $sql="select h.*  from tbl_becas  h where h.id_empresa='$id_empresa' and h.rut='$rut'
    ";


    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();


    return $cod;


}

function BuscarFiltroPositivoFC($rut, $id_empresa){

    global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);

        $sql="
        select count(h.id) as cuenta
        from tbl_postulables_usuarios_filtro h
        where h.rut='$rut' and h.id_empresa='$id_empresa'


        ";
        //echo "&nbsp;$sql";
        $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();


        return $cod[0]->cuenta;

}

function BuscarFiltroPositivoFCFull($rut, $id_empresa){

    global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);

        $sql="
        select h.*
        from tbl_postulables_usuarios_filtro h
        where h.rut='$rut' and h.id_empresa='$id_empresa'


        ";
        //echo "<br>&nbsp;$sql";
        $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();


        return $cod;

}

function Becas_busca_MisPostulacionesaValidar($rut, $id_empresa){
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);

    $sql="
    select h.*, (select nombre_completo from tbl_usuario where rut=h.rut) as nombre_completo


 from tbl_becas  h where h.id_empresa='$id_empresa'
 and h.tipo_wf='SI'

and
    (
(select jefe from tbl_usuario where rut=h.rut)='$rut'



    )
    and (h.validacionok  is null)
    ";
/*
(select lider from tbl_usuario where rut=h.rut)='$rut'
OR
(select responsable from tbl_usuario where rut=h.rut)='$rut'
  */
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();


    return $cod;


}
function Becas_busca_MisPostulacionesaValidargud($rut, $id_empresa){
        global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);

        $sql="
        select h.*
        , (
        SELECT
            premio
        FROM
            tbl_premios
        WHERE
            id_premio = h.id_premio
    ) AS premio, (select nombre_completo from tbl_usuario where rut=h.rut) as nombre_completo


 from tbl_premios_canje  h where h.id_empresa='$id_empresa'
 and h.estadovalidacion='2'

and
        (
(select jefe from tbl_usuario where rut=h.rut)='$rut'  OR
(select lider from tbl_usuario where rut=h.rut)='$rut'  OR
(select responsable from tbl_usuario where rut=h.rut)='$rut'


        )

        ";
/*
(select lider from tbl_usuario where rut=h.rut)='$rut'
OR
(select responsable from tbl_usuario where rut=h.rut)='$rut'
    */
        $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();


        return $cod;


}
function Becas_busca_MisPostulacionesaMisgud($rut, $id_empresa){
        global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);

        $sql="
        select h.*
        , (
        SELECT
            premio
        FROM
            tbl_premios
        WHERE
            id_premio = h.id_premio
    ) AS premio, (select nombre_completo from tbl_usuario where rut=h.rut) as nombre_completo


 from tbl_premios_canje  h where h.id_empresa='$id_empresa'


and h.rut='$rut'

        ";
/*
(select lider from tbl_usuario where rut=h.rut)='$rut'
OR
(select responsable from tbl_usuario where rut=h.rut)='$rut'
    */
        $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();


        return $cod;


}
function Postulaciones_busca_CanjePuntos($rut, $segmento, $id_empresa){



    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);

    $sql="
    select h.*,
    (select premio from tbl_premios where id_premio=h.id_premio and segmento='$segmento') as premio

    from tbl_premios_canje h
    where h.id_empresa='$id_empresa' and h.rut='$rut' and h.estadovalidacion<>'3'  and h.estadovalidacion<>'1'

    order by id DESC

    ";

    //  echo $sql;

    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();


    return $cod;


}

function Postulaciones_busca_MisPostulaciones($rut, $id_empresa){



    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);

    $sql="
    select h.*,

(select dimension from tbl_postulables where id_postulable=h.id_postulable) as dimension,
(select nombre from tbl_postulables where id_postulable=h.id_postulable) as nombre,
(select descripcion from tbl_postulables where id_postulable=h.id_postulable) as descripcion_postulable,
(select fecha from tbl_postulables where id_postulable=h.id_postulable) as fecha_postulable

 from tbl_postulaciones h where h.id_empresa='$id_empresa' and h.rut='$rut'

    ";

    //  echo $sql;

    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();


    return $cod;


}



function EMAIL_TodosTablaEmailRut(){

    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);

    $sql="select * from rut_email";

    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}

function VerificoCursoModalidad4EnOtraMalla($id_curso, $id_empresa){

    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);

    $sql="select * from rel_lms_malla_curso where id_curso='$id_curso' and id_empresa='$id_empresa' and id_malla<>'e_p_f'";

    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}

function EMAIL_BancoChileREG_Contrato(){

    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);

    $sql="select * from rut_email where region<>'13' and tipo='CDCON00001'";

    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}

function EMAIL_BancoChileREG_PlazoFijo(){

    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);

    $sql="select * from rut_email where region<>'13' and tipo='CDCON00002'";

    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}



function EMAIL_BancoChileRM(){

    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);

    $sql="select * from rut_email where region='13'";

    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}



function RankingGerencialGlobal_data(){

}
function BancoChilePlazoFijo(){

    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);

    $sql="select * from rut_email where tipo='CDCON00002'";

    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}



function BancoChileIndefinidos(){

    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);

    $sql="select * from rut_email where tipo='CDCON00001'";

    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}


function SEGUIMIENTO_DatosRegistroSoloId($id_empresa, $id){

    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);

    $sql="select * from tbl_sis_seguimiento where id='$id' and id_empresa='$id_empresa'    ";

    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}


function SEGUIMIENTO_CodigoActualiza($id, $codigo)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "update tbl_sis_seguimiento
    set  codigo='$codigo'

    where id='$id' ";
    $database->setquery($sql);
    $database->query();
}



function SEGUIMIENTO_CierraSolicitud($id, $rut_supervisor)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "update tbl_sis_seguimiento
    set  estado_registro='Cerrado'

    where id='$id' ";
    $database->setquery($sql);
    $database->query();
}


function SEGUIMIENTO_InsertaSupervisor($id, $rut_supervisor)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "update tbl_sis_seguimiento
    set  supervisor='$rut_supervisor'

    where id='$id' ";
    $database->setquery($sql);
    $database->query();
}

function SEGUIMIENTO_EsSupervisor($rut, $id_empresa){

    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);

    $sql="select * from tbl_sis_seguimiento_supervisor where rut='$rut' and id_empresa='$id_empresa'    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}


function BacBusGraf_inicio($region, $sucursal, $tipo, $id_empresa){

    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);

    $sql="

    select h.*,
(select count(id) from tbl_sis_seguimiento where tipo_registro='BUS' and estado_registro='Sin Iniciar' and id_empresa='$id_empresa')  as SinInicio,
(select count(id) from tbl_sis_seguimiento where tipo_registro='BUS' and estado_registro<>'Sin Iniciar' and id_empresa='$id_empresa')  as Iniciado

 from tbl_sis_seguimiento h where h.tipo_registro='BUS' and h.id_empresa='$id_empresa'

    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}

function BacBusGraf_Solicitudes($region, $sucursal, $tipo, $id_empresa){

    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);

    $sql="

select h.solicitud, count(h.id) as cuenta from tbl_sis_seguimiento_situaciones h where h.id_empresa='$id_empresa'
group by h.solicitud

order by count(h.id) desc

    ";


    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}

function BacBusGraf_Registros($region, $sucursal, $tipo, $id_empresa){

    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);

    $sql="
        select h.estado_registro as tipo, count(h.id) as cuenta from tbl_sis_seguimiento h where h.tipo_registro='BUS' and h.id_empresa='$id_empresa' group by h.estado_registro
    ";


    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}


function RankingIndividualGlobal_data($id_programa, $id_empresa){
$id_empresa='62';

    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);

    $sql="

        select  h.*,
        (select sum(puntos) from tbl_lms_reportes where rut=h.rut) as puntostotal

        from tbl_lms_reportes h

        where id_empresa='$id_empresa'
        group by h.rut order BY
                (select sum(puntos) from tbl_lms_reportes where rut=h.rut)
        DESC limit 10

    ";
    //echo "<br>".$sql;
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}

function RankingIndividualGlobalTop1_data($id_programa, $id_empresa){
$id_empresa='62';

    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);

    $sql="

        select  h.*,
        (select sum(puntos) from tbl_lms_reportes where rut=h.rut) as puntostotal,
        (select biografia from tbl_usuario_biografia where rut=h.rut limit 1) as biografia

        from tbl_lms_reportes h

        where id_empresa='$id_empresa'
        group by h.rut order BY
                (select sum(puntos) from tbl_lms_reportes where rut=h.rut)
        DESC limit 1

    ";
    //echo "<br>".$sql;
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}



function BacBus_UpdateEstado($id, $id_empresa, $estado_reg_txt){

      global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);

    $sql="update tbl_sis_seguimiento set estado_registro='$estado_reg_txt' where id='$id' and id_empresa='$id_empresa'";
    //echo "<br>".$sql;
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;


}

function MedBuscaIdEncuestraMed($idm, $id_empresa){

    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);

    $sql="select * from tbl_enc_elearning_medicion where id='$idm' and id_empresa='$id_empresa'";
    //echo "<br>MedBuscaIdEncuestraMed sql ".$sql;
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    //print_r($cod);
    return $cod;
}

function SIS_manualesErvicioPorModelo($id_empresa, $id_modelo){


      global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);

$sql="select * from tbl_sis_seguimiento_manuales_servicio where id_modelo='$id_modelo' and id_empresa='$id_empresa'";

    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;

}



function SIS_seg_modelosPorId($id_empresa, $id_modelo){


      global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    if($id_modelo){
        $filtro_modelo=" and id_modelo='$id_modelo'";
    }
$sql="select tbl_sis_seguimiento_modelo.*, tbl_sis_seguimiento_marca.descripcion as nombre_marca
    from tbl_sis_seguimiento_modelo

    left join tbl_sis_seguimiento_marca
    on tbl_sis_seguimiento_marca.id_marca=tbl_sis_seguimiento_modelo.id_marca

        where tbl_sis_seguimiento_modelo.id_empresa='$id_empresa' $filtro_modelo



";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;

}


function BuscaAvanceIdCursoActualizaReportes($rut, $id_curso, $id_empresa){

    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);

    $sql="select avance, nota from tbl_inscripcion_cierre where id_curso='$id_curso' and rut='$rut' and id_empresa='$id_empresa'";


    //echo $sql; echo "<br>";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();


    if($cod[0]->avance>0){

            $sql_repo="select count(id) as cuenta from tbl_lms_reportes where id_curso='$id_curso' and rut='$rut' and id_empresa='$id_empresa'";
            $database->setquery($sql_repo);
            $database->query();
            $cod_repo = $database->listObjects();


            //echo "<br> $rut, $id_curso, $id_empresa , avance: ".$cod[0]->avance. " nota ".$cod[0]->nota."<br>";
            //print_r($cod_repo);

            if($cod_repo[0]->cuenta==0){
             $sql_repo_insupdate="
                INSERT INTO tbl_lms_reportes (rut, id_curso, id_empresa, avance, resultado)
            " . "VALUES ('$rut', '$id_curso', '$id_empresa', '".$cod[0]->avance. "', '".$cod[0]->nota."') ";
                $database->setquery($sql_repo_insupdate);
                $database->query();

            // echo "<br>INSERT $sql_repo_insupdate";

            } else {
            $sql_repo_insupdate="
                UPDATE tbl_lms_reportes SET avance='".$cod[0]->avance."', resultado='".$cod[0]->nota."' where rut='$rut' and id_curso='$id_curso' and id_empresa='$id_empresa'";
                $database->setquery($sql_repo_insupdate);
                $database->query();

             //echo "<br>UPDATE $sql_repo_insupdate";

            }

    }





    return $cod;
}


function BuscaEstadisticasUsuario($rut_perfil, $id_empresa){


         global $c_host, $c_user, $c_pass, $c_db;
   $database = new database($c_host, $c_user, $c_pass);

$sql="
select h.rut,

(select fecha from tbl_log_sistema where rut='$rut_perfil' and id_empresa='$id_empresa' order by id ASC limit 1) as fecha_inicio,
(select fecha from tbl_log_sistema where rut='$rut_perfil' and id_empresa='$id_empresa' order by id DESC limit 1) as fecha_ultima,

(select COUNT(h.id) as aprobados from tbl_inscripcion_usuarios h where h.rut='$rut_perfil' and h.id_empresa='$id_empresa'
    and (select estado_descripcion from tbl_inscripcion_cierre where id_inscripcion= h.id_inscripcion and rut=h.rut)='APROBADO') as cursos_aprobados


 from tbl_usuario h where h.rut='$rut_perfil' and h.id_empresa='$id_empresa';";


   $database->setquery($sql);
   $database->query();
   $cod = $database->listObjects();
   return $cod;

}


function TieneRespuestaPorObjetiAlternativaPreguntaRut($rut, $id_objeto, $id_pregunta, $alternativa, $intento){


     global $c_host, $c_user, $c_pass, $c_db;
   $database = new database($c_host, $c_user, $c_pass);

$sql="select * from tbl_evaluaciones_respuestas where rut='$rut' and id_pregunta='$id_pregunta' and id_alternativa='$alternativa' and id_objeto='$id_objeto' and numero_intento='$intento'";
   //echo $sql;

   $database->setquery($sql);
   $database->query();
   $cod = $database->listObjects();
   return $cod;

}


function Seguimiento_ComentariosPorRegistro($id_registro){
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);

$sql = "

   select tbl_sis_seguimiento_comentarios.*, tbl_usuario.nombre_completo
   from tbl_sis_seguimiento_comentarios inner join tbl_usuario
   on tbl_usuario.rut=tbl_sis_seguimiento_comentarios.rut
   where tbl_sis_seguimiento_comentarios.id_registro='$id_registro'
   order by tbl_sis_seguimiento_comentarios.id desc


     ";



    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;


}


function SEGUIMIENTO_IngresaComentario($id_registro, $rut, $comentario, $id_empresa, $nombre_archivo)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $fecha = date("Y-m-d");
    $hora  = date("H:i:s");
    $tag   = utf8_decode($tag);
    $sql   = "INSERT INTO tbl_sis_seguimiento_comentarios(id_registro, rut, comentario, fecha, hora, id_empresa, archivo)
    " . "VALUES ('$id_registro', '$rut', '$comentario', '$fecha', '$hora', '$id_empresa', '$nombre_archivo')";
    $database->setquery($sql);
    $database->query();
}


function BuscaPuntosEmblemas($rut, $id_empresa){
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);

$sql = "

   select count(h.id) as emblemas,
   (select sum(puntos)    from tbl_gamificado_puntos  where rut='$rut' and id_empresa='$id_empresa') as puntos,
   (select sum(medallas)  from tbl_gamificado_puntos  where rut='$rut' and id_empresa='$id_empresa') as medallas

   from tbl_badges_ganados h
   where h.rut='$rut' and h.id_empresa='$id_empresa'

     ";

    //echo "$c_host, $c_user, $c_pass, $c_db<br>";
    //echo $sql;

    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();

   return $cod;


}



function TraeNoticiasSecundariasCategoria($id_empresa, $limit, $id_categoria)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    if ($id_empresa == 22) {
        $datos_usuario_session = UsuarioEnBasePersonas($_SESSION["user_"], $rutcontodo);
        if ($datos_usuario_session[0]->unidad_negocio == "Sucursales") {
            $filtro_mundo = "and (tbl_noticias.id_mundo='0' or tbl_noticias.id_mundo='2')";
        } else if ($datos_usuario_session[0]->unidad_negocio == "Santiago") {
            $filtro_mundo = "and (tbl_noticias.id_mundo='0' or tbl_noticias.id_mundo='1')";
        }
    }
    $sql = "


     SELECT
     tbl_noticias.*, tbl_noticias_categorias.categoria AS nombre_categoria
    FROM
     tbl_noticias
INNER JOIN tbl_noticias_categorias ON tbl_noticias_categorias.id = tbl_noticias.categoria




WHERE
     estado = '1'
AND tbl_noticias.id_empresa = '$id_empresa' and
tbl_noticias.principal=0 and
slider_activo=0 and tbl_noticias.categoria='$id_categoria'


$filtro_mundo
order by orden is  null, orden asc, fecha_creacion desc


$limit


     ";

    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}

function SIS_seg_istemasmarcas($id_empresa){


      global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);

$sql="select * from tbl_sis_seguimiento_sistema where id_empresa='$id_empresa'
";
    //echo $sql;

    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;

}

function SIS_seg_marcas($id_empresa){


      global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);

$sql="select * from tbl_sis_seguimiento_marca where id_empresa='$id_empresa'
";
    //echo $sql;

    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;

}

function SIS_seg_modelos($id_empresa, $id_marca){


      global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    if($id_marca){
        $filtro_marca=" and id_marca='$id_marca'";
    }
$sql="select * from tbl_sis_seguimiento_modelo where id_empresa='$id_empresa' $filtro_marca
";
    //echo $sql;

    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;

}


function BuscaRelIdInscripcionCursoObjeto($id_curso, $id_inscripcion, $id_objeto){


      global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);

$sql="select h.* from rel_objeto_imparticiones h

where h.id_inscripcion='$id_inscripcion'  and h.id_curso='$id_curso' and h.id_objeto='$id_objeto'
";
    //echo $sql;

    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;

}


function ActualizaSituacionPorIdBAC($antecedentes, $solicitud, $observaciones, $clasificacion, $motiva_atencion, $fecha_compromiso, $rut_den, $id_registro_situacion)
{
    $hoy = date("Y-m-d");
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "update tbl_sis_seguimiento_situaciones

        set  antecedentes='$antecedentes',
        solicitud='$solicitud',
        observaciones='$observaciones',
        clasificacion='$clasificacion',
        motiva_atencion='$motiva_atencion',
        fecha_compromiso='$fecha_compromiso',
        rut_den='$rut_den'




        where id='$id_registro_situacion' ";
    $database->setquery($sql);
    $database->query();
}
function ActualizaSituacionPorIdBUS($antecedentes, $solicitud, $observaciones, $rut_responsable, $id_departamento_res, $fecha_compromiso, $id_registro_situacion)
{
    $hoy = date("Y-m-d");
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "update tbl_sis_seguimiento_situaciones

        set  antecedentes='$antecedentes',
        solicitud='$solicitud',
        observaciones='$observaciones',
        rut_res='$rut_responsable',
        id_departamento_res='$id_departamento_res',
        fecha_compromiso='$fecha_compromiso'




        where id='$id_registro_situacion' ";
    $database->setquery($sql);
    $database->query();
}
function Sis_seguimiento_Update($id, $fecha_registro, $fecha_visita, $fecha_actualizacion, $rut, $nombre, $cargo, $id_cui, $id_division, $id_area, $id_departamento, $rut_col, $nombre_col, $cargo_col, $id_cui_col, $id_division_col, $id_area_col, $id_departamento_col, $telefono_contacto, $estado_colaborador, $programa_orienta, $motiva_atencion, $rut_den, $nombre_den, $cargo_den, $id_cui_den, $id_division_den, $id_area_den, $id_departamento_den, $antecedentes, $solicitud, $observaciones, $rut_res, $nombre_res, $cargo_res, $id_cui_res, $id_division_res, $id_area_res, $id_departamento_res, $clasificacion, $estado_registro, $tipo_registro, $id_empresa, $fecha_compromiso, $id_registro_edit)
{
  /* echo "
    $id,$fecha_registro,$fecha_visita,$fecha_actualizacion,
    rut $rut,$nombre,$cargo,$id_cui,$id_division,$id_area,$id_departamento,
    $rut_col,$nombre_col,$cargo_col,$id_cui_col,$id_division_col,$id_area_col,$id_departamento_col,
    $telefono_contacto,$estado_colaborador,$programa_orienta,motiva_atencion $motiva_atencion,
    $rut_den,$nombre_den,$cargo_den,$id_cui_den,$id_division_den,$id_area_den,$id_departamento_den,
    $antecedentes,$solicitud,$observaciones,
    $rut_res,$nombre_res,$cargo_res,$id_cui_res,$id_division_res,$id_area_res,$id_departamento_res,
    $clasificacion,$estado_registro,$tipo_registro, $id_empresa";   sleep(4);       */

    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $motiva_atencion = utf8_decode($motiva_atencion);
    $antecedentes    = utf8_decode($antecedentes);
    $solicitud       = utf8_decode($solicitud);
    $observaciones   = utf8_decode($observaciones);
    $sql             = "update tbl_sis_seguimiento
        set
        fecha_registro='$fecha_registro',
        fecha_visita='$fecha_visita',
        fecha_actualizacion='$fecha_actualizacion',
        rut='$rut',
        nombre='$nombre',
        cargo='$cargo',
        id_cui='$id_cui',
        id_division='$id_division',
        id_area='$id_area',
        id_departamento='$id_departamento',
        rut_col='$rut_col',
        nombre_col='$nombre_col',
        cargo_col='$cargo_col',
        id_cui_col='$id_cui_col',
        id_division_col='$id_division_col',
        id_area_col='$id_area_col',
        id_departamento_col='$id_departamento_col',
        telefono_contacto='$telefono_contacto',
        estado_colaborador='$estado_colaborador',
        programa_orienta='$programa_orienta',
        motiva_atencion='$motiva_atencion',
        rut_den='$rut_den',
        nombre_den='$nombre_den',
        cargo_den='$cargo_den',
        id_cui_den='$id_cui_den',
        id_division_den='$id_division_den',
        id_area_den='$id_area_den',
        id_departamento_den='$id_departamento_den',

        id_empresa='$id_empresa',
        estado_registro='estado_registro' where id='$id_registro_edit'

        ";

    $database->setquery($sql);
    $database->query();
    $datos       = $database->listObjects();
    // return $datos;
    $sql_last_id = "select max(id) as ultimo_id_evaluacion from tbl_sis_seguimiento ";
    $database->setquery($sql_last_id);
    $database->query();
    $datos = $database->listObjects();
    return $datos;
}
function busca_c1_c2_c3_c4_jefe($rut, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $sql      = "select * from tbl_lms_reportes where rut='$rut' and id_empresa='$id_empresa' group by rut";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    $c1  = $cod[0]->c1;
    $c2  = $cod[0]->c2;
    $c3  = $cod[0]->c3;
    $c4  = $cod[0]->c4;
    //echo "<br>$sql <br>c1 $c1 c2 $c2 c3 $c3 c4 $c4";
    $sql = "select count(id) as cuenta from tbl_usuario where (jefe='$rut' or lider='$rut' or responsable='$rut') and id_empresa='$id_empresa'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    //echo "<br>$sql";
    //print_r($cod);
    if ($cod[0]->cuenta > 0) {
        $jefe = $rut;
    } else {
        $sql = "select jefe from tbl_usuario where rut='$rut' and id_empresa='$id_empresa'";
        $database->setquery($sql);
        $database->query();
        $cod  = $database->listObjects();
        $jefe = $cod[0]->jefe;
    }
    $array[0]->c1   = $c1;
    $array[0]->c2   = $c2;
    $array[0]->c3   = $c3;
    $array[0]->c4   = $c4;
    $array[0]->jefe = $jefe;
    // print_r($array);
    return $array;
}
function lms_avance_promedio_c1_c2_c3_c4_jefe($rut, $c1, $c2, $c3, $c4, $jefe, $programa, $curso, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    if ($programa <> '') {
        $qr_pr = " and h.id_programa='$programa' ";
    }
    if ($curso <> '') {
        $qr_cr = " and h.id_curso='$curso' ";
    }
    $sqlT = "select avg(h.avance) as avanceTOT from tbl_lms_reportes h where h.curso_opcional='0'
    and ((select opcional from tbl_lms_programas_bbdd where id_programa=h.id_programa) is null or (select opcional from tbl_lms_programas_bbdd where id_programa=h.id_programa)='')
    and h.id_empresa='$id_empresa' and (select modalidad from tbl_lms_curso where id=h.id_curso)='1' $qr_pr $qr_cr";
    $database->setquery($sqlT);
    $database->query();
    $codT  = $database->listObjects();
    $sqlC1 = "select avg(h.avance) as avanceC1 from tbl_lms_reportes h where h.curso_opcional='0'
    and ((select opcional from tbl_lms_programas_bbdd where id_programa=h.id_programa) is null or (select opcional from tbl_lms_programas_bbdd where id_programa=h.id_programa)='')
    and h.c1='$c1' and h.id_empresa='$id_empresa' and (select modalidad from tbl_lms_curso where id=h.id_curso)='1' $qr_pr $qr_cr";
    $database->setquery($sqlC1);
    $database->query();
    $codC1 = $database->listObjects();
    $sqlC2 = "select avg(h.avance) as avanceC2 from tbl_lms_reportes h where h.curso_opcional='0'
    and ((select opcional from tbl_lms_programas_bbdd where id_programa=h.id_programa) is null or (select opcional from tbl_lms_programas_bbdd where id_programa=h.id_programa)='')
    and h.c2='$c2' and h.id_empresa='$id_empresa' and (select modalidad from tbl_lms_curso where id=h.id_curso)='1' $qr_pr $qr_cr";
    $database->setquery($sqlC2);
    $database->query();
    $codC2 = $database->listObjects();
    $sqlC3 = "select avg(h.avance) as avanceC3 from tbl_lms_reportes h where h.curso_opcional='0'
    and ((select opcional from tbl_lms_programas_bbdd where id_programa=h.id_programa) is null or (select opcional from tbl_lms_programas_bbdd where id_programa=h.id_programa)='')
    and h.c3='$c3' and h.id_empresa='$id_empresa' and (select modalidad from tbl_lms_curso where id=h.id_curso)='1' $qr_pr $qr_cr";
    $database->setquery($sqlC3);
    $database->query();
    $codC3 = $database->listObjects();
    $sqlC4 = "select avg(h.avance) as avanceC4 from tbl_lms_reportes h where h.curso_opcional='0'
    and ((select opcional from tbl_lms_programas_bbdd where id_programa=h.id_programa) is null or (select opcional from tbl_lms_programas_bbdd where id_programa=h.id_programa)='')
    and h.c4='$c4' and h.id_empresa='$id_empresa' and (select modalidad from tbl_lms_curso where id=h.id_curso)='1' $qr_pr $qr_cr";
    $database->setquery($sqlC4);
    $database->query();
    $codC4 = $database->listObjects();
    $sqlJF = "select avg(h.avance) as AVANCEjefe from tbl_lms_reportes h where h.curso_opcional='0' and (select jefe from tbl_usuario where rut=h.rut)='$jefe' and h.id_empresa='$id_empresa'
    and ((select opcional from tbl_lms_programas_bbdd where id_programa=h.id_programa) is null or (select opcional from tbl_lms_programas_bbdd where id_programa=h.id_programa)='')
    and (select modalidad from tbl_lms_curso where id=h.id_curso)='1' $qr_pr $qr_cr";
    $database->setquery($sqlJF);
    $database->query();
    $codJF = $database->listObjects();
    $sqlMF = "select avg(h.avance) as AVANCEmi from tbl_lms_reportes h where h.curso_opcional='0'
    and ((select opcional from tbl_lms_programas_bbdd where id_programa=h.id_programa) is null or (select opcional from tbl_lms_programas_bbdd where id_programa=h.id_programa)='')
    and h.rut='$jefe' and h.id_empresa='$id_empresa' and (select modalidad from tbl_lms_curso where id=h.id_curso)='1' $qr_pr $qr_cr";
    $database->setquery($sqlMF);
    $database->query();
    $codMF    = $database->listObjects();
    $array[0] = round($codC1[0]->avanceC1);
    $array[1] = round($codC2[0]->avanceC2);
    $array[2] = round($codC3[0]->avanceC3);
    $array[3] = round($codC4[0]->avanceC4);
    $array[4] = round($codJF[0]->AVANCEjefe);
    $array[5] = round($codT[0]->avanceTOT);
    $array[6] = round($codMF[0]->AVANCEmi);
    //print_r($array);
    return $array;
}

function Sis_bacBus_busca_Seguimiento($rut, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database  = new database($c_host, $c_user, $c_pass);
    //h.rut_col='$rut' and
    $sql="SELECT h.* from tbl_sis_seguimiento h where   h.id_empresa='$id_empresa'  and h.rut_col='$rut'";
    //echo "<br>Sis_bacBus_busca_Seguimiento<br>$sql";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}


function Sis_bacBus_busca_Situaciones($rut, $id_empresa)
{

    global $c_host, $c_user, $c_pass, $c_db;
    $database  = new database($c_host, $c_user, $c_pass);
    //h.rut_col='$rut' and
    $sql="select h.*,
    (select tipo_registro from tbl_sis_seguimiento where id=h.id_seguimiento) as tipo_registro

    from tbl_sis_seguimiento_situaciones h

    where h.id_empresa='$id_empresa'  and h.rut_den='$rut'";


    //echo "<br>Sis_bacBus_busca_Situaciones<br>$sql";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;

}





function EVENTOS_TraeEventos($id_empresa, $tipo, $filtro_cui, $filtro_rut, $filtro_tipo)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database  = new database($c_host, $c_user, $c_pass);
    $queryTipo = "";  $queryRUT = "";   $queryRegistro="";
    if ($tipo <> '') {
        $queryTipo = " and id_categoria='$tipo' ";
    }

    if($nombrelikecui<>''){
     $queryCui = " and nombre like '%$filtro_cui%' ";
    }

    if($filtro_rut<>''){
     $queryRUT = " and descripcion like '%$filtro_rut%' ";
    }


    if($filtro_tipo<>''){
     $queryRegistro = " and icono = '$filtro_tipo' ";
    }

    $sql = "select * from tbl_eventos where id_empresa='$id_empresa' $queryTipo  $queryCui $queryRUT $queryRegistro";
    //echo "sql $sql;"; sleep(2);
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}

 function TraeDatosSigDataPersona($rut, $id_empresa, $tipo){

     global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $sql      = "select * from tbl_sis_data_persona where rut='$rut' and tipo='$tipo' and id_empresa='$id_empresa'";
       //echo $sql;
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;

 }


function BuscaSucursalCui($rut, $id_empresa) {

    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $sql      = "select local as cui, seccion as nombresucursal, nombre_completo as nombre_completo from tbl_usuario where rut='$rut' and id_empresa='$id_empresa'";

    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;

}

function Emb_Vista_Tareas($id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $sql      = "select h.*, (select nombre from tbl_emb_tareas where codigo=h.id_tarea) as nombre_tarea,
        (select nombre_completo from tbl_usuario where rut=h.rut) as nombreEmbajador
        from tbl_emb_respuestas_embajadores_tareas h where h.id_empresa='$id_empresa' and h.id_tarea='emb_01 ' ORDER by h.id_tarea";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}

function BuscaAutorBACBUS($id_registro, $id_empresa){

    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $sql      = "select rut, nombre
     from tbl_sis_seguimiento
      where id='$id_registro' and id_empresa='$id_empresa'";

    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;



}


function Insert_Update_calendarioBacBus($id_evento, $nombre_evento, $descripcion, $icono, $fecha_inicio, $fecha_termino, $hora_inicio, $hora_termino, $id_empresa, $id_categoria, $tiposql)
{

    //echo "<br>Insert_Update_calendarioBacBus($id_evento, $nombre_evento, $fecha_inicio, $fecha_termino, $hora_inicio, $hora_termino, $id_empresa, $id_categoria, $tiposql";
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    if ($tiposql == "INSERT") {
        $fecha = date("Y-m-d");
        $hora  = date("H:i:s");
        $sql   = "insert into tbl_eventos
            (id_evento,nombre,descripcion,imagen,icono,
            fecha_inicio,fecha_termino,hora_inicio,hora_termino,
            id_empresa,id_categoria,id_dimension,link_acceso,target)


            VALUES
            (
            '$id_evento', '$nombre_evento', '$descripcion','','$icono',
            '$fecha_inicio', '$fecha_termino', '', '',
            '$id_empresa','$id_categoria', '','?sw=sis_seguimiento_registro&idr={IDEVENTO}','1'

            );";
    }
    if ($tiposql == "UPDATE") {
        $sql = "update tbl_eventos
            set id_evento='$id_evento', nombre='$nombre_evento', descripcion='$descripcion', icono='$icono',
            fecha_inicio='$fecha_inicio',fecha_termino='$fecha_inicio',    id_categoria='$id_categoria'

            where id_evento='" . $id_evento . "'";
    }

       // echo "<br>Insert_Update_calendarioBacBus<br><br>$sql"; sleep(3);

    $database->setquery($sql);
    $database->query();
}
function SaveBadge($rut, $id_empresa, $id_orden)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    //verifica si esta en base
    $sql = "select h.*,
        (select count(id) from tbl_badges_ganados where rut='$rut' and id_empresa=h.id_empresa and id_badge=h.id_badge) as cuentaganados


        from tbl_badges h where h.id_orden='$id_orden' and h.id_empresa='$id_empresa'

        ";
    //echo $sql; sleep(5);
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    //    echo count($cod);
    if ($cod[0]->cuentaganados == 0) {
        $hoy   = date('Y-m-d');
        $fecha = date("Y-m-d");
        $hora  = date("H:i:s");
        $sql   = "insert into tbl_badges_ganados
            (rut, id_empresa, fecha, hora, id_badge, badge )
            VALUES
            ( '$rut', '$id_empresa', '$fecha', '$hora', '" . $cod[0]->id_badge . "', '" . $cod[0]->nombre . "');";
        $database->setquery($sql);
        $database->query();
        $BadgeGanado = 1;
    } else {
        $BadgeGanado = 0;
    }
    //echo $sql; sleep(5);
    //echo $BadgeGanado; sleep(5);
    return $BadgeGanado;
}
function lista_badges_por_rut($rut, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = " select h.*,
        (select fecha from tbl_badges_ganados where id_badge=h.id_badge and rut='$rut' and id_empresa=h.id_empresa) as fecha
        from tbl_badges h
        where h.id_empresa='$id_empresa' ";
    //echo $sql;
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}

function lista_kpis_por_rut($rut, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = " select * from tbl_kpi where rut='$rut' and id_empresa='$id_empresa' ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}

 function lista_reconocimientos_badges_por_rut($rut, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = " select h.*,
    (select nombre_completo from tbl_usuario where rut=h.rut_destinatario) as destinatario,
    (select nombre_completo from tbl_usuario where rut=h.rut_remitente) as remitente


            from tbl_reconoce_gracias h

        where h.id_empresa='$id_empresa'  and h.rut_destinatario='$rut' order by id DESC";
   // echo $sql;
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function lista_reconocimientos_viaId($id, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = " select h.*



            from tbl_reconoce_gracias h

        where h.id_empresa='$id_empresa'  and h.id='$id'";
   //

    //echo $sql;  exit();
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function lista_PersonasEquipo($rut, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = " select h.*,

        (select nombre_completo from tbl_usuario where rut=h.rut) as nombre_destinatario,
        (select cargo from tbl_usuario where rut=h.rut) as cargo_destinatario,
        (select avatar from tbl_usuario_biografia  where rut=h.rut) as avatar_destinatario,
        (select departamento from tbl_usuario where rut=h.rut) as departamento_destinatario,

        (select count(id) from tbl_reconoce_gracias where rut_destinatario=h.rut and id_empresa='$id_empresa' and tipo='RECONOCIMIENTO' and estado='OK') AS num_reconocimientos_destinatario,
        (select count(id) from tbl_reconoce_gracias where rut_destinatario=h.rut and id_empresa='$id_empresa' and tipo='GRACIAS' and estado='OK') AS num_gracias_destinatario,
        (select count(id) from tbl_badges_ganados where rut=h.rut  and id_empresa='$id_empresa') as numbadges

        from tbl_usuario h

        where (jefe='$rut' or lider='$rut' or responsable='$rut') and id_empresa='$id_empresa'  order by (select nombre_completo from tbl_usuario where rut=h.rut)  Asc";
    //echo $sql;
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}

function lista_PersonasReconocidasEquipo($rut, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = " select h.*,

        (select nombre_completo from tbl_usuario where rut=h.rut) as nombre_destinatario,
        (select cargo from tbl_usuario where rut=h.rut) as cargo_destinatario,
        (select avatar from tbl_usuario_biografia  where rut=h.rut) as avatar_destinatario,
        (select departamento from tbl_usuario where rut=h.rut) as departamento_destinatario,

        (select count(id) from tbl_reconoce_gracias where rut_destinatario=h.rut and id_empresa='$id_empresa' and tipo='RECONOCIMIENTO' and estado='OK') AS num_reconocimientos_destinatario,
        (select count(id) from tbl_reconoce_gracias where rut_destinatario=h.rut and id_empresa='$id_empresa' and tipo='GRACIAS' and estado='OK') AS num_gracias_destinatario,
        (select count(id) from tbl_badges_ganados where rut=h.rut  and id_empresa='$id_empresa') as numbadges

        from tbl_usuario h

        where (jefe='$rut' or lider='$rut' or responsable='$rut') and id_empresa='$id_empresa'  order by (select nombre_completo from tbl_usuario where rut=h.rut)  Asc";


    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}


function lista_badges_por_equipo($rut, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = " select h.*,
        (select fecha from tbl_badges_ganados where id_badge=h.id_badge and rut='$rut' and id_empresa=h.id_empresa) as fecha
        from tbl_badges h
        where h.id_empresa='$id_empresa' ";
    //echo $sql;
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function BAC_buscaCuiAgrupado($id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select id_cui_col from tbl_sis_seguimiento where id_empresa='78' and id_cui_col<>'' group by id_cui_col order by id_cui_col ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TraePerfilBacBus($rut, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select perfil from tbl_sis_seguimiento_gestores where rut='$rut' and id_empresa='$id_empresa' limit 1 ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod[0]->perfil;
}
function BuscaPerfilResponsable($rut, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select count(id) as cuenta from tbl_sis_seguimiento_situaciones where rut_res='$rut' and id_empresa='$id_empresa' ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod[0]->cuenta;
}
function TraigoInscripcionUsuarioPorCursoEmpresaUsuario($id_empresa, $rut, $id_curso)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_inscripcion_usuarios where rut='$rut' and id_empresa='$id_empresa' and id_curso='$id_curso' ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TraigoInscripcionUsuarioPorCursoEmpresaUsuarioImparticiones($id_empresa, $rut, $id_curso, $id_inscripcion)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_inscripcion_usuarios where rut='$rut' and id_empresa='$id_empresa' and id_curso='$id_curso' and id_inscripcion='$id_inscripcion' ";

    //echo $sql;
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}

function BuscaAvanceCursoPrograma($rut, $id_empresa, $id_curso, $id_programa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    if ($id_curso <> '') {
        $sql_id_curso = "select avance as avance from tbl_lms_reportes where id_curso='$id_curso' and rut='$rut' and id_empresa='$id_empresa' ";
    }
    if ($id_programa <> '') {
        $sql_id_curso = "select round(avg(avance)) as avance from tbl_lms_reportes where id_programa='$id_programa' and rut='$rut' and id_empresa='$id_empresa' ";
    }
    //echo "<br><br>$sql_id_curso";
    $database->setquery($sql_id_curso);
    $database->query();
    $cod = $database->listObjects();
    return $cod[0]->avance;
}


function Lista_mediciones_jefe_data($rut, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);

    $sql = "

    select h.*, (select nombre from tbl_enc_elearning_medicion where id=h.id_medicion) as medicion, (select fecha1 from tbl_enc_elearning_medicion where id=h.id_medicion) as fecha1, (select fecha2 from tbl_enc_elearning_medicion where id=h.id_medicion) as fecha2, (select fecha3 from tbl_enc_elearning_medicion where id=h.id_medicion) as fecha3,
    (select id_encuesta from tbl_enc_elearning_medicion where id=h.id_medicion) as id_enc,
    (select nombre_completo from tbl_usuario where rut=h.rut) as nombre, (select cargo from tbl_usuario where rut=h.rut) as cargo,
    (select gerencia from tbl_usuario where rut=h.rut) as gerencia,
    (select count(id) from tbl_enc_elearning_preg where id_encuesta=(select id_encuesta from tbl_enc_elearning_medicion where id=h.id_medicion)) as NumPreg,
    (select count(id) from tbl_enc_elearning_respuestas where id_medicion=h.id_medicion and rut_colaborador=h.rut) as NumResp,
    round((select count(id) from tbl_enc_elearning_respuestas where id_medicion=h.id_medicion and rut_colaborador=h.rut)/(select count(id) from tbl_enc_elearning_preg where id_encuesta=(select id_encuesta from tbl_enc_elearning_medicion where id=h.id_medicion))) as Porcentaje

    from tbl_enc_elearning_usuarios h

    where h.jefe='$rut' and h.id_empresa='$id_empresa'

    order by ((select count(id) from tbl_enc_elearning_respuestas where id_medicion=h.id_medicion and rut_colaborador=h.rut)/(select count(id)
    from tbl_enc_elearning_preg where id_encuesta=(select id_encuesta from tbl_enc_elearning_medicion where id=h.id_medicion))) ASC,
    (select fecha1 from tbl_enc_elearning_medicion where id=h.id_medicion) ASC

        ";

        //echo $sql;
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}



function Lista_mediciones_encuestas_data($rut, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);

    $sql = "

    select h.*, (select nombre from tbl_enc_elearning_medicion where id=h.id_medicion) as medicion, (select fecha1 from tbl_enc_elearning_medicion where id=h.id_medicion) as fecha1, (select fecha2 from tbl_enc_elearning_medicion where id=h.id_medicion) as fecha2, (select fecha3 from tbl_enc_elearning_medicion where id=h.id_medicion) as fecha3,
    (select id_encuesta from tbl_enc_elearning_medicion where id=h.id_medicion) as id_enc,
    (select nombre_completo from tbl_usuario where rut=h.rut) as nombre, (select cargo from tbl_usuario where rut=h.rut) as cargo,
    (select gerencia from tbl_usuario where rut=h.rut) as gerencia,
    (select count(id) from tbl_enc_elearning_preg where id_encuesta=(select id_encuesta from tbl_enc_elearning_medicion where id=h.id_medicion)) as NumPreg,
    (select count(id) from tbl_enc_elearning_respuestas where id_medicion=h.id_medicion and rut_colaborador=h.rut) as NumResp,
    round((select count(id) from tbl_enc_elearning_respuestas where id_medicion=h.id_medicion and rut_colaborador=h.rut)/(select count(id) from tbl_enc_elearning_preg where id_encuesta=(select id_encuesta from tbl_enc_elearning_medicion where id=h.id_medicion))) as Porcentaje

    from tbl_enc_elearning_usuarios h

    where (h.jefe='' or h.jefe is null) and rut='$rut' and h.id_empresa='$id_empresa'

    ";

    //echo "<br><br>$sql";


    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function Lista_mediciones_encuestas_lb_data($rut, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);

    $sql = "

    select h.*, (select nombre from tbl_enc_elearning_medicion where id=h.id) as medicion,
    (select fecha1 from tbl_enc_elearning_medicion where id=h.id) as fecha1,
    (select fecha2 from tbl_enc_elearning_medicion where id=h.id) as fecha2,
    (select fecha3 from tbl_enc_elearning_medicion where id=h.id) as fecha3,
    (select id_encuesta from tbl_enc_elearning_medicion where id=h.id) as id_enc,
    (select nombre_completo from tbl_usuario where rut='$rut') as nombre,
    (select cargo from tbl_usuario where rut='$rut') as cargo,
    (select gerencia from tbl_usuario where rut='$rut') as gerencia,
    (select count(id) from tbl_enc_elearning_preg where id_encuesta=(select id_encuesta from tbl_enc_elearning_medicion where id=h.id)) as NumPreg,
    (select count(id) from tbl_enc_elearning_respuestas where id_medicion=h.id and rut_colaborador='$rut') as NumResp,
    round((select count(id) from tbl_enc_elearning_respuestas where id_medicion=h.id and rut_colaborador='$rut')/(select count(id) from tbl_enc_elearning_preg where id_encuesta=(select id_encuesta from tbl_enc_elearning_medicion where id=h.id))) as Porcentaje

    from tbl_enc_elearning_medicion h

    where

    h.tipo_medicion='LIBRE' and h.id_empresa='$id_empresa'";

    echo "<br><br>$sql";


    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}


function RespuestasPreguntasFinNivel($id_empresa, $rut, $id_curso, $id_malla)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "SELECT
        * from tbl_enc_elearning_respuestas

        WHERE
        tbl_enc_elearning_respuestas.rut = '$rut'
        AND tbl_enc_elearning_respuestas.id_empresa = '$id_empresa'
        and tbl_enc_elearning_respuestas.id_malla = '$id_malla'
        and tbl_enc_elearning_respuestas.id_curso = '$id_curso' ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function InsertaRespuestaFinNivel($rut, $id_pregunta, $respuesta, $id_empresa, $id_curso, $id_malla, $comentario, $id_encuesta)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $hoy   = date('Y-m-d');
    $fecha = date("Y-m-d");
    $hora  = date("H:i:s");
    $sql   = "insert into tbl_enc_elearning_respuestas (rut, id_empresa, fecha, hora, respuesta, id_pregunta, id_curso, id_malla, comentario, id_encuesta )
        VALUES
        ( '$rut', '$id_empresa', '$fecha', '$hora', '$respuesta', '$id_pregunta', '$id_curso', '$id_malla', '$comentario', '$id_encuesta');";
    $database->setquery($sql);
    $database->query();
}
function SaveMedicionData($id_empresa, $id_medicion, $id_encuesta, $id_pregunta, $respuesta, $rut, $rut_colaborador, $comentario)
{


    $comentario=utf8_decode($comentario);

    //echo "$id_empresa, $id_medicion, $id_encuesta, $id_pregunta, $respuesta, $rut, $rut_colaborador, $comentario";sleep(5);
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    //verifica si esta en base
    $sql = "select id,respuesta from tbl_enc_elearning_respuestas
        where id_empresa='$id_empresa' and id_medicion='$id_medicion'  and id_encuesta='$id_encuesta'
        and rut='$rut' and rut_colaborador='$rut_colaborador' and id_pregunta='$id_pregunta'

        ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    //    echo count($cod);
    if (count($cod) == 0) {
        $hoy   = date('Y-m-d');
        $fecha = date("Y-m-d");
        $hora  = date("H:i:s");
        $sql   = "insert into tbl_enc_elearning_respuestas (rut, rut_colaborador, id_empresa, fecha, hora, respuesta, id_pregunta, id_medicion, id_encuesta, comentario )
            VALUES
            ( '$rut','$rut_colaborador', '$id_empresa', '$fecha', '$hora', '$respuesta', '$id_pregunta', '$id_medicion', '$id_encuesta', '$comentario');";
        $database->setquery($sql);
        $database->query();
    } else {
        $sql = "update tbl_enc_elearning_respuestas set fecha='$fecha', hora='$hora', respuesta='$respuesta', comentario='$comentario' where id='" . $cod[0]->id . "'";
        $database->setquery($sql);
        $database->query();
    }
}

function Becas_Datos_Tipo($rut,$id_empresa,$tipo){


  global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $q  = utf8_decode($q);
    $sql = "

    SELECT *
    FROM tbl_becas
    WHERE tipo_beca='$tipo' and rut='$rut' and id_empresa='$id_empresa'

    ";
    //echo "<br>$c_host, $c_user, $c_pass, $c_db";
   // echo "<br>Becas_Datos_Tipo $sql";
                    //sleep(3);
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();

    //print_r($cod);

    return $cod;



}

function BuscaUsuarioDadoidgr($idgr){

    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $q  = utf8_decode($q);
    $sql = "

    SELECT *
    FROM tbl_reconoce_gracias
    WHERE id='$idgr'

    ";
    //echo "<br>$c_host, $c_user, $c_pass, $c_db";
    //echo "<br>BuscaUsuarioDadoidgr $sql";
    // sleep(3);
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();

    //print_r($cod);

    return $cod;


}

function BuscaUsuarioDadoFullTexto($q, $id_empresa) {

    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $q  = utf8_decode($q);
    if($id_empresa=="78") {
        $queryFiltro=" and tbl_usuario.division='Division Personas y Organizacion' ";
         $queryFiltro=" ";
    } else {
       $queryFiltro=" ";
    }
    $sql = "

    SELECT tbl_usuario.*,
       MATCH (nombre_completo) AGAINST ('$q') AS relevance
    FROM tbl_usuario
    WHERE MATCH (nombre_completo) AGAINST ('$q') and MATCH (nombre_completo) AGAINST ('$q') >0

    $queryFiltro
    ORDER BY relevance DESC limit 12;

    ";

    //echo $sql;

    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();

    //print_r($cod);

    return $cod;

}

function BuscaUsuarioDadoFullTextoNoEquipo($q, $id_empresa) {

    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $q  = utf8_decode($q);
    $rut = $_SESSION["user_"];
    if($id_empresa=="78") {
        $queryFiltro=" and tbl_usuario.division='Division Personas y Organizacion' ";
         $queryFiltro=" ";
    } else {
       $queryFiltro=" ";
    }
    $sql = "

    SELECT tbl_usuario.*,
       MATCH (nombre_completo) AGAINST ('$q') AS relevance
    FROM tbl_usuario
    WHERE MATCH (nombre_completo) AGAINST ('$q') and MATCH (nombre_completo) AGAINST ('$q') >0

    $queryFiltro
    AND tbl_usuario.jefe  <> '$rut'

    ORDER BY relevance DESC limit 12;

    ";

    //echo $sql;

    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();

    //print_r($cod);

    return $cod;

}

function SaveMedicionDataFechaClima($id_empresa, $id_medicion, $id_encuesta, $id_pregunta, $respuesta, $rut, $rut_colaborador ,$fecha, $comentario, $edad, $genero)
{

    //echo "id empresa $id_empresa, id medicion $id_medicion, id encuesta $id_encuesta,
    //id pregunta $id_pregunta, respuesta $respuesta, rut $rut, rut colaborador $rut_colaborador , fecha $fecha";
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    //verifica si esta en base
    $sql = "select id,respuesta from tbl_enc_elearning_respuestas
        where id_empresa='$id_empresa' and id_medicion='$id_medicion' and id_tipo='$fecha'  and id_encuesta='$id_encuesta'
        and rut='$rut' and rut_colaborador='$rut_colaborador' and id_pregunta='$id_pregunta'

        ";
    $comentario=utf8_decode($comentario);

    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
        //echo count($cod);
    if (count($cod) == 0) {
        $hoy   = date('Y-m-d');
        $hora  = date("H:i:s");
        $sql   = "insert into tbl_enc_elearning_respuestas (rut, rut_colaborador, id_empresa, fecha, hora, respuesta, id_pregunta, id_medicion, id_encuesta, id_tipo, comentario, id_curso, id_clasificacion )
            VALUES
            ( '$rut','$rut_colaborador', '$id_empresa', '$hoy', '$hora', '$respuesta', '$id_pregunta', '$id_medicion',
            '$id_encuesta', '$fecha','$comentario', '$edad', '$genero');";
        $database->setquery($sql);
        $database->query();
    } else {
        $sql = "update tbl_enc_elearning_respuestas set fecha='$fecha', hora='$hora', respuesta='$respuesta' where id='" . $cod[0]->id . "'";
        $database->setquery($sql);
        $database->query();
    }
    //echo "<br><br>";    echo "<br>$sql"; sleep(2);

}
function SaveMedicionDataFecha($id_empresa, $id_medicion, $id_encuesta, $id_pregunta, $respuesta, $rut, $rut_colaborador ,$fecha)
{


    //echo "id empresa $id_empresa, id medicion $id_medicion, id encuesta $id_encuesta,
    //id pregunta $id_pregunta, respuesta $respuesta, rut $rut, rut colaborador $rut_colaborador , fecha $fecha";
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    //verifica si esta en base
    $sql = "select id,respuesta from tbl_enc_elearning_respuestas
        where id_empresa='$id_empresa' and id_medicion='$id_medicion' and id_tipo='$fecha'  and id_encuesta='$id_encuesta'
        and rut='$rut' and rut_colaborador='$rut_colaborador' and id_pregunta='$id_pregunta'

        ";


    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
        //echo count($cod);
    if (count($cod) == 0) {
        $hoy   = date('Y-m-d');
        $hora  = date("H:i:s");
        $sql   = "insert into tbl_enc_elearning_respuestas (rut, rut_colaborador, id_empresa, fecha, hora, respuesta, id_pregunta, id_medicion, id_encuesta, id_tipo )
            VALUES
            ( '$rut','$rut_colaborador', '$id_empresa', '$hoy', '$hora', '$respuesta', '$id_pregunta', '$id_medicion',
            '$id_encuesta', '$fecha');";
        $database->setquery($sql);
        $database->query();
    } else {
        $sql = "update tbl_enc_elearning_respuestas set fecha='$fecha', hora='$hora', respuesta='$respuesta' where id='" . $cod[0]->id . "'";
        $database->setquery($sql);
        $database->query();
    }
    //echo "<br><br>";    echo "<br>$sql"; sleep(2);

}
function Resultado_encuestas_evaluacion_avg($rut, $id_empresa,$idm ){
     global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);

        $sql = "
        SELECT
    avg(h.puntaje),
    avg(abs(h.puntaje)),
    avg(IF(h.puntaje<=0, 0, h.puntaje))   as promedio

FROM
        tbl_enc_elearning_respuestas h
WHERE
        h.id_empresa = '$id_empresa'
        AND h.id_encuesta = '$idm'
        AND h.rut = '$rut'
        ";
        //echo "BuscaComentarioMedicionLB sql $sql";
        $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();
        //echo "eco  ".$cod[0]->comentario;
        return $cod[0]->promedio;
}
function BuscaComentarioMedicionLB($id_empresa, $rut, $idm){

    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);

        $sql = "select comentario from tbl_enc_elearning_respuestas
        where id_medicion='$idm' and id_empresa='$id_empresa' and rut='$rut'  and comentario<>'' group by comentario";
        //echo "BuscaComentarioMedicionLB sql $sql";
        $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();
        //echo "eco  ".$cod[0]->comentario;
        return $cod[0]->comentario;
}
function BuscaPuntajeEncEvalu($id_encuesta, $id_empresa, $id_pregunta, $op){
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);

        $sql = "select $op from tbl_enc_elearning_preg
        where id_encuesta='$id_encuesta' and id_empresa='$id_empresa' and id_pregunta='$id_pregunta' ";
        //echo "<br>BuscaPuntajeEncEvalu sql $sql";
        $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();
        //echo "eco  ".$cod[0]->comentario;
        return $cod[0]->$op;
}
function SaveMedicionDataLB($id_empresa, $id_medicion, $id_encuesta, $id_pregunta, $rut, $respuesta, $comentario)
{


    //echo "id empresa $id_empresa, id medicion $id_medicion, id encuesta $id_encuesta,
    //id pregunta $id_pregunta, respuesta $respuesta, rut $rut, rut colaborador $rut_colaborador , fecha $fecha";
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    //verifica si esta en base
    $sql = "select id,respuesta from tbl_enc_elearning_respuestas
        where id_empresa='$id_empresa' and id_medicion='$id_medicion' and  id_encuesta='$id_encuesta'
        and rut='$rut'  and id_pregunta='$id_pregunta'

        ";
        $hoy   = date('Y-m-d');
        $hora  = date("H:i:s");
        $comentario=utf8_decode($comentario);
    //echo "<br>$sql<br>";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
        //echo count($cod);
    if (count($cod) == 0) {

        $sql   = "insert into tbl_enc_elearning_respuestas (rut, id_empresa, fecha, hora, respuesta, id_pregunta, id_medicion, id_encuesta, comentario )
            VALUES
            ( '$rut', '$id_empresa', '$hoy', '$hora', '$respuesta', '$id_pregunta', '$id_medicion',
            '$id_encuesta','$comentario');";
        $database->setquery($sql);
        $database->query();
    } else {
        $sql = "update tbl_enc_elearning_respuestas set fecha='$fecha', hora='$hora', respuesta='$respuesta', comentario='$comentario'
        where id='" . $cod[0]->id . "'";
        $database->setquery($sql);
        $database->query();
    }
   //echo "<br><br>";    echo "<br>$sql"; sleep(2);

}
function SaveMedicionEncuestaEvaluacionDataLB($id_empresa, $id_medicion, $id_encuesta, $id_pregunta,$rut, $respuesta,$comentario, $puntaje)
{


    //echo "id empresa $id_empresa, id medicion $id_medicion, id encuesta $id_encuesta,
    //id pregunta $id_pregunta, respuesta $respuesta, rut $rut, rut colaborador $rut_colaborador , fecha $fecha";
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    //verifica si esta en base
    $sql = "select id,respuesta from tbl_enc_elearning_respuestas
        where id_empresa='$id_empresa' and id_medicion='$id_medicion' and  id_encuesta='$id_encuesta'
        and rut='$rut'  and id_pregunta='$id_pregunta'

        ";
        $hoy   = date('Y-m-d');
        $hora  = date("H:i:s");
        $comentario=utf8_decode($comentario);
    //echo "<br>$sql<br>";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
        //echo count($cod);
    if (count($cod) == 0) {

        $sql   = "insert into tbl_enc_elearning_respuestas (rut, id_empresa, fecha, hora, respuesta, id_pregunta, id_medicion, id_encuesta, comentario, puntaje )
            VALUES
            ( '$rut', '$id_empresa', '$hoy', '$hora', '$respuesta', '$id_pregunta', '$id_medicion',
            '$id_encuesta','$comentario', '$puntaje');";
        $database->setquery($sql);
        $database->query();
    } else {
        $sql = "update tbl_enc_elearning_respuestas set fecha='$fecha', hora='$hora', respuesta='$respuesta', comentario='$comentario', puntaje='$puntaje'
        where id='" . $cod[0]->id . "'";
        $database->setquery($sql);
        $database->query();
    }
   //echo "<br><br>";    echo "<br>$sql";

}
function ValidaEstadoMedicionIndividual($rut, $id_empresa, $id_encuesta, $id_medicion)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "

        select count(h.id)  as num_preguntas,
        (select count(id) from tbl_enc_elearning_respuestas where id_encuesta='$id_encuesta' and id_medicion='$id_medicion' and rut='$rut'
        and id_empresa='$id_empresa') as num_respuestas
        from tbl_enc_elearning_preg h

        where h.id_encuesta='$id_encuesta'   and h.id_empresa='$id_empresa'

        ";

        //echo "sql<br> $sql";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    if ($cod[0]->num_respuestas >= $cod[0]->num_preguntas and $cod[0]->num_preguntas > 0) {
        $estado = "FINALIZADO";
    } else {
        $estado = "PENDIENTE";
    }
    return $estado;
}

function ValidaEstadoMedicion($rut, $id_empresa, $id_encuesta, $id_medicion, $rut_colaborador)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "

        select count(h.id)  as num_preguntas,
        (select count(id) from tbl_enc_elearning_respuestas where id_encuesta='$id_encuesta' and id_medicion='$id_medicion' and rut='$rut'
        and rut_colaborador='$rut_colaborador' and id_empresa='$id_empresa') as num_respuestas
        from tbl_enc_elearning_preg h

        where h.id_encuesta='$id_encuesta'   and h.id_empresa='$id_empresa'

        ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    if ($cod[0]->num_respuestas >= $cod[0]->num_preguntas and $cod[0]->num_preguntas > 0) {
        $estado = "<span class='badge badge-info'><span class='blanco'>FINALIZADO</span></span>";
    } else {
        $estado = "<span class='badge badge-danger'><span class='blanco'>PENDIENTE</span></span>";
    }
    return $estado;
}

function ValidaEstadoMedicionFecha($rut, $id_empresa, $id_encuesta, $id_medicion, $fecha, $rut_colaborador)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "

        select count(h.id)  as num_preguntas,
        (select count(id) from tbl_enc_elearning_respuestas where id_encuesta='$id_encuesta' and id_medicion='$id_medicion' and rut='$rut'
        and rut_colaborador='$rut_colaborador' and id_empresa='$id_empresa' and id_tipo='$fecha') as num_respuestas
        from tbl_enc_elearning_preg h

        where h.id_encuesta='$id_encuesta'   and h.id_empresa='$id_empresa'

        ";

    //echo "<br>$sql";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();

if ($cod[0]->num_respuestas >= $cod[0]->num_preguntas and $cod[0]->num_preguntas > 0) {
        $estado = "FINALIZADO";
    } else {
        $estado = "PENDIENTE";
    }

    return $estado;
}

function DatosMedicion($idm, $id_empresa){
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);

    $sql="select * from tbl_enc_elearning_medicion where id='$idm' and id_empresa='$id_empresa'";
    //echo "<br>$sql";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;

}


function ValidaEstadoMedicionEncuesta($rut, $id_empresa, $id_encuesta, $id_medicion)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "

        select count(h.id)  as num_preguntas,
        (select count(id) from tbl_enc_elearning_respuestas where id_encuesta='$id_encuesta' and id_medicion='$id_medicion' and rut='$rut'
        and rut_colaborador='$rut_colaborador' and id_empresa='$id_empresa' and id_tipo='$fecha') as num_respuestas
        from tbl_enc_elearning_preg h

        where h.id_encuesta='$id_encuesta'   and h.id_empresa='$id_empresa'

        ";

    //echo "<br>$sql";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();

if ($cod[0]->num_respuestas >= $cod[0]->num_preguntas and $cod[0]->num_preguntas > 0) {
        $estado = "FINALIZADO";
    } else {
        $estado = "PENDIENTE";
    }

    return $estado;
}



function VerficicaPreguntaMedFinalizada($id_empresa, $id_encuesta, $id_medicion, $rut, $rut_colaborador)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "SELECT
        count(tbl_enc_elearning_preg.id) as numpreg, count(tbl_enc_elearning_respuestas.respuesta)  as numres
        FROM
        tbl_enc_elearning_preg

        left join
        tbl_enc_elearning_respuestas
        on tbl_enc_elearning_respuestas.rut='$rut'

        and tbl_enc_elearning_respuestas.id_medicion='$id_medicion'
        and tbl_enc_elearning_respuestas.id_encuesta='$id_encuesta'

        and tbl_enc_elearning_respuestas.id_pregunta=tbl_enc_elearning_preg.id_pregunta
        WHERE
        tbl_enc_elearning_preg.id_encuesta = '$id_encuesta'
        AND tbl_enc_elearning_preg.id_empresa = '$id_empresa'
        ";
    //echo "<br>$sql";
    $database->setquery($sql);
    $database->query();
    $cod        = $database->listObjects();
    $finalizado = 0;
    if ($cod[0]->numpreg <= $cod[0]->numres and $cod[0]->numpreg > 0) {
        $finalizado = 1;
    }
    return $finalizado;
}
function PreguntasMedicion($id_empresa, $id_encuesta, $id_medicion, $rut, $rut_colaborador)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "SELECT
        tbl_enc_elearning_preg.*, tbl_enc_elearning_respuestas.respuesta
        FROM
        tbl_enc_elearning_preg

        left join
        tbl_enc_elearning_respuestas
        on tbl_enc_elearning_respuestas.rut='$rut'

        and tbl_enc_elearning_respuestas.id_medicion='$id_medicion'
        and tbl_enc_elearning_respuestas.id_encuesta='$id_encuesta'

        and tbl_enc_elearning_respuestas.id_pregunta=tbl_enc_elearning_preg.id_pregunta
        WHERE
        tbl_enc_elearning_preg.id_encuesta = '$id_encuesta'
        AND tbl_enc_elearning_preg.id_empresa = '$id_empresa'
        ";
    //echo "<br>$sql";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}

function PreguntasMedicionColaboradoresFecha($id_empresa, $id_encuesta, $id_medicion, $rut, $rut_colaborador, $fecha)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql =
    "
    select h.*,
        (select respuesta from tbl_enc_elearning_respuestas where id_encuesta='$id_encuesta' and id_medicion='$id_medicion'
        and id_tipo='$fecha' and rut_colaborador='$rut_colaborador' and id_pregunta=h.id_pregunta) as respuesta

    from tbl_enc_elearning_preg h
        where h.id_encuesta='$id_encuesta'

    ";
        //echo "<br>$sql";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}

function PreguntasMedicionColaboradoresLibreFull($id_empresa, $id_encuesta, $id_medicion, $rut)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql =
    "
    select h.*,
        (select respuesta from tbl_enc_elearning_respuestas where id_encuesta='$id_encuesta' and id_medicion='$id_medicion'
        and id_pregunta=h.id_pregunta and rut='$rut')  as respuesta

    from tbl_enc_elearning_preg h
        where h.id_encuesta='$id_encuesta'


    ";
    //echo "<br>$sql";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function PreguntasMedicionColaboradoresLibre($id_empresa, $id_encuesta, $id_medicion, $rut)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql =
    "
    select h.*,
        (select respuesta from tbl_enc_elearning_respuestas where id_encuesta='$id_encuesta' and id_medicion='$id_medicion'
        and id_pregunta=h.id_pregunta and rut='$rut')  as respuesta

    from tbl_enc_elearning_preg h
        where h.id_encuesta='$id_encuesta'
        AND (h.linkpregunta is null       or  h.linkpregunta='')

    ";
    //echo "<br>sql<br>$sql";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
 function PreguntasMedicionColaboradoresLibreOpcion($id_empresa, $id_encuesta, $id_medicion, $rut, $opcion)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql =
    "
    select h.*,
        (select respuesta from tbl_enc_elearning_respuestas where id_encuesta='$id_encuesta' and id_medicion='$id_medicion'
        and id_pregunta=h.id_pregunta and rut='$rut')  as respuesta

    from tbl_enc_elearning_preg h
        where h.id_encuesta='$id_encuesta'
        AND h.linkopcion='$opcion'

    ";
    //echo "<br>$sql";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}

function PreguntasMedicionColaboradoresLibreLInkeada($id_pregunta, $id_empresa, $id_encuesta, $id_medicion, $rut)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql =
    "
    select h.*,
        (select respuesta from tbl_enc_elearning_respuestas where id_encuesta='$id_encuesta' and id_medicion='$id_medicion'
        and id_pregunta=h.id_pregunta and rut='$rut')  as respuesta

    from tbl_enc_elearning_preg h
        where h.id_encuesta='$id_encuesta'
        AND h.linkpregunta ='$id_pregunta'

        order by linkopcion asc

    ";
    //echo "<br>$sql";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}


function PreguntasFinNivel($id_empresa, $id_encuesta, $rut, $id_curso, $id_malla)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "SELECT
        tbl_enc_elearning_preg.*, tbl_enc_elearning_respuestas.respuesta, tbl_enc_elearning_respuestas.comentario
        FROM
        tbl_enc_elearning_preg

        left join
        tbl_enc_elearning_respuestas
        on tbl_enc_elearning_respuestas.rut='$rut'

        and tbl_enc_elearning_respuestas.id_curso='$id_curso'
        and tbl_enc_elearning_respuestas.id_malla='$id_malla'

        and tbl_enc_elearning_respuestas.id_pregunta=tbl_enc_elearning_preg.id_pregunta
        WHERE
        tbl_enc_elearning_preg.id_encuesta = '$id_encuesta'
        AND tbl_enc_elearning_preg.id_empresa = '$id_empresa'
        ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function BuscaTarea($id_tarea, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_emb_tareas where codigo='$id_tarea' and id_empresa='$id_empresa' limit 1";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function BuscaTutor_Embajador($rut, $id_empresa, $id_grupo)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select rut_tutor from tbl_emb_embajadores where rut='$rut' and id_empresa='$id_empresa' and rut_tutor<>'' and id_ola='$id_grupo' limit 1";
        //echo "<br>$sql";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function DatosVideoLMS($id_video)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_lms_video where id='$id_video'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function VideosPorCategoria($categoria)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_lms_video where categoria='$categoria'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TotalWonLidsTodos()
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select tbl_womlid.*, nombre_completo from tbl_womlid inner join tbl_usuario on tbl_usuario.rut=tbl_womlid.rut";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function UsuarioEsFacilitadorWomLid($rut)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_womlid_facilitador where rut='$rut'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TotalWonLids($rut)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select tbl_womlid.*, nombre_completo from tbl_womlid  inner join tbl_usuario on tbl_usuario.rut=tbl_womlid.rut where tbl_womlid.rut='$rut' or tbl_womlid.rut in (select rut from tbl_womlid_facilitador)";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function InsertaWomLid($rut, $archivo, $descripcion)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $hoy   = date('Y-m-d');
    $fecha = date("Y-m-d");
    $hora  = date("H:i:s");
    $sql   = "insert into tbl_womlid (rut, nombre_archivo, descripcion, fecha, hora )
        VALUES
        ( '$rut', '$archivo', '$descripcion', '$fecha', '$hora');";
    $database->setquery($sql);
    $database->query();
}
function BuscaIdmallaDadoProgramaRut_Prd($rut, $id_empresa, $id_programa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "


        select h.*, (select id_programa from rel_lms_malla_curso where id_malla=h.id_malla limit 1) as id_programa

        from rel_lms_malla_persona h where h.rut='$rut' and h.id_empresa='$id_empresa'

        and (select id_programa from rel_lms_malla_curso where id_malla=h.id_malla limit 1)='$id_programa'

        ";
    $database->setquery($sql);
    $database->query();
    $datos = $database->listObjects();
    return $datos;
}
function BuscaCursosPorIdmallaDadoProgramaRut_Prd($rut, $id_empresa, $id_malla)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "


        select h.*,
        (select nombre from tbl_lms_curso where id=h.id_curso) as nombre_curso,
        (select descripcion from tbl_lms_curso where id=h.id_curso) as descripcion_curso,
        (select imagen from tbl_lms_curso where id=h.id_curso) as imagen_curso,
        (select avance from tbl_lms_reportes where id_curso=h.id_curso and rut='$rut') as avance
        from rel_lms_malla_curso h where h.id_malla='$id_malla'
        and h.id_empresa='$id_empresa'
        ";
    $database->setquery($sql);
    $database->query();
    $datos = $database->listObjects();
    return $datos;
}
function ActualizaREsultadoFinalSeguimientoSolicitudes($id_seguimiento, $resultado_final, $comentario_final)
{
    $hoy = date("Y-m-d");
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "update tbl_sis_seguimiento_situaciones

        set  resultado_final='$resultado_final', comentario_final='$comentario_final', fecha_cierre='$hoy'


        where id='$id_seguimiento' ";
    $database->setquery($sql);
    $database->query();
}
function ComboboxMotivoSolicitud($solicitud)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_sis_seguimiento_combobox where criterio='$solicitud' order by valor ASC";
    //echo $sql;
    $database->setquery($sql);
    $database->query();
    $datos = $database->listObjects();
    return $datos;
}
function BuscaDataSolicitud($id_solicitud)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select h.*,
        (select rut from tbl_sis_seguimiento where id=h.id_seguimiento limit 1) as rut_autor,
        (select rut_col from tbl_sis_seguimiento where id=h.id_seguimiento limit 1) as rut_col

        from tbl_sis_seguimiento_situaciones h where h.id='$id_solicitud'";
    $database->setquery($sql);
    $database->query();
    $datos = $database->listObjects();
    return $datos;
}
function aceptaRechazaSolicitudSeguimiento($id_seguimiento, $estado, $motivo, $comentario_motivo)
{
    $hoy = date("Y-m-d");
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "update tbl_sis_seguimiento_situaciones      set
    estado_registro='$estado', fecha_actualizacion='$hoy', motivo_rechazo='$motivo', comentario_motivo_rechazo='$comentario_motivo'


     where id='$id_seguimiento' ";
    $database->setquery($sql);
    $database->query();
}
function ConsultasituacionesSeguimientoPorEstado($id_empresa, $rut, $estado)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_sis_seguimiento_situaciones where id_empresa='$id_empresa' and rut_res='$rut' and estado_registro='Sin Iniciar'";
    $database->setquery($sql);
    $database->query();
    $datos = $database->listObjects();
    return $datos;
}
function ActualizaEstadoDeEsguimiento($id_seguimiento, $estado)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "update tbl_sis_seguimiento      set  estado_registro='$estado' where id='$id_seguimiento' ";
    $database->setquery($sql);
    $database->query();
}
function DAtosSituacionPorRegistro($id_registro, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_sis_seguimiento_situaciones where id_seguimiento='$id_registro' and id_empresa='$id_empresa'";
    $database->setquery($sql);
    $database->query();
    $datos = $database->listObjects();
    return $datos;
}
function BacBuscActualizaEstadoRegistro($estado_reg_txt, $id, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "update  tbl_sis_seguimiento set estado_registro='$estado_reg_txt' where id='$id' and id_empresa='$id_empresa'";
    //echo $sql;
    $database->setquery($sql);
    $database->query();
    $datos = $database->listObjects();
    return $datos;
}

function BacBusBorraRegistrador($rut_del, $id_empresa){


        global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "delete from tbl_sis_seguimiento_gestores where rut='$rut_del' and id_empresa='$id_empresa'
    and perfil='Registrador'";
 // echo $sql;

   $database->setquery($sql);
    $database->query();
    $datos = $database->listObjects();
    return $datos;

}

function Sis_BuscaRegistrador($id_empresa){


        global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select h.*,
    (select rut_completo from tbl_usuario where rut=h.rut) as rut,
    (select nombre_completo from tbl_usuario where rut=h.rut) as nombre,
    (select cargo from tbl_usuario where rut=h.rut) as cargo


    from tbl_sis_seguimiento_gestores h where h.perfil='Registrador' and h.id_empresa='$id_empresa'
    and (select rut_completo from tbl_usuario where rut=h.rut)<>''

    ";
  // echo $sql;

   $database->setquery($sql);
    $database->query();
    $datos = $database->listObjects();
    return $datos;


}

function Sis_busLista($rut, $id_empresa, $perfil, $filtro_tipo, $filtro_estado, $filtro_cui, $arreglo_post, $tipo_listado_minvest)
{

$filtro_estado="";

    //echo "$rut, $id_empresa, $perfil";
    if ($responsable <> '') {
        $query_res = " and (select count(id) from tbl_sis_seguimiento_situaciones where id_seguimiento= h.id and rut_res='$responsable')>0 ";
    } else {
        $query_res = " ";
    }
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $query_filtro_tipo   = "";
    $query_filtro_estado = "";
    $query_filtro_cui    = "";
    if ($filtro_tipo <> '') {
        $query_filtro_tipo = " and h.tipo_registro='$filtro_tipo' ";
    }
    if ($filtro_estado <> '') {
        $query_filtro_estado = " and h.estado_registro='$filtro_estado' ";
    }
    if ($filtro_cui <> '') {
        $query_filtro_cui = " and h.id_cui_col='$filtro_cui' ";
    }
    if ($perfil == "") {
        $sql = "";
    }
    if ($perfil == "Super Registrador") {
        $sql = "select h.*,
            (select count(id) from tbl_sis_seguimiento_situaciones where id_seguimiento= h.id) as CuentaSituacion
            from tbl_sis_seguimiento h where h.id_empresa='$id_empresa'
            $query_filtro_tipo $query_filtro_estado $query_filtro_cui
            AND h.tipo_registro<>''
            order by h.fecha_registro DESC, h.id DESC";
    }
    if ($perfil == "Registrador") {
        $sql = "select h.*,
            (select count(id) from tbl_sis_seguimiento_situaciones where id_seguimiento= h.id) as CuentaSituacion
            from tbl_sis_seguimiento h where h.id_empresa='$id_empresa'
            and (rut='$rut' or (tipo_registro='BAC' and (select clasificacion from tbl_sis_seguimiento_situaciones where id_seguimiento=h.id)<>'Confidencial'))

            $query_filtro_tipo $query_filtro_estado $query_filtro_cui
            AND h.tipo_registro<>''
            order by h.fecha_registro DESC, h.id DESC";
    }
    if ($perfil == "Responsable") {
        $sql = "
            select h.*,
            (select count(id) from tbl_sis_seguimiento_situaciones where id_seguimiento= h.id) as CuentaSituacion
            from tbl_sis_seguimiento h
            where h.id_empresa='$id_empresa'
            $query_filtro_tipo $query_filtro_estado $query_filtro_cui
            AND (h.rut = '$rut' or
            '$rut' in (select tbl_sis_seguimiento_situaciones.rut_res from tbl_sis_seguimiento_situaciones where tbl_sis_seguimiento_situaciones.id_seguimiento=h.id)
            )
            $query_res
            AND h.tipo_registro<>''
            order by h.fecha_registro DESC, h.id DESC
        ";
    }

    if ($id_empresa == 41) {

        if($arreglo_post["buscarRut_dealer"]){
            $filtro_dealer_1=" and base_rut.tipo_servicio='".$arreglo_post["buscarRut_dealer"]."'";
        }
        if($tipo_listado_minvest=="mc"){
            $filtro_mis_consultas=" and h.rut='".$_SESSION["user_"]."'";
        }

        if($tipo_listado_minvest=="mt"){
            //PAra mis Tecnicos

            $datos_encargado_dealer=SEGUIMIENTO_EsDealerEncargado($rut, $id_empresa);

            $filtro_dealer_2=" and base_rut.tipo_servicio='".$datos_encargado_dealer[0]->id_dealer."'";
        }

        if($arreglo_post["marca"]<>''){
                $filtro_marca=" and h.marca='".$arreglo_post["marca"]."'";
        }

        if($arreglo_post["modelo"]<>''){
                $filtro_modelo=" and h.modelo='".$arreglo_post["modelo"]."'";
        }

        if($arreglo_post["sistema"]<>''){
                $filtro_sistema=" and h.sistema='".$arreglo_post["sistema"]."'";
        }

        if($arreglo_post["filtro_fecha_inicio"]<>'' and $arreglo_post["filtro_fecha_termino"]==''){
                $filtro_fecha=" and h.fecha_registro='".$arreglo_post["filtro_fecha_inicio"]."'";
        }

        if($arreglo_post["filtro_fecha_termino"]<>'' and $arreglo_post["filtro_fecha_inicio"]==''){
                $filtro_fecha=" and h.fecha_registro='".$arreglo_post["filtro_fecha_termino"]."'";
        }
        if($arreglo_post["filtro_fecha_termino"]<>'' and $arreglo_post["filtro_fecha_inicio"]<>''){
                $filtro_fecha=" and (h.fecha_registro>='".$arreglo_post["filtro_fecha_inicio"]."' and h.fecha_registro<='".$arreglo_post["filtro_fecha_termino"]."') ";
        }

        if($arreglo_post["filtro_vin"]<>''){
                $filtro_vin=" and h.vin='".$arreglo_post["filtro_vin"]."'";
        }

        if($arreglo_post["buscarRut_colaborador_dealer"]<>''){

                $filtro_dealer=" and h.rut='".$arreglo_post["buscarRut_colaborador_dealer"]."'";
        }

        if($arreglo_post["buscarRut_colaborador"]<>''){

                $filtro_supervisor=" and h.supervisor='".$arreglo_post["buscarRut_colaborador"]."'";
        }





        $es_supervisor=SEGUIMIENTO_EsSupervisor($rut, $id_empresa);
        if($es_supervisor){
            $filtro_para_supervisor=" or h.supervisor is null or h.supervisor is not null";
        }else{
            $filtro_para_supervisor=" or h.supervisor is not null";
        }


        $sql = "
            select
            base_supervisor.nombre_completo as nombre_supervisor,
            base_rut.tipo_servicio,
            tbl_sis_seguimiento_dealer.descripcion as nombre_dealer,
            tbl_sis_seguimiento_marca.descripcion as nombre_marca,
            tbl_sis_seguimiento_modelo.descripcion as nombre_modelo,
            tbl_sis_seguimiento_sistema.descripcion as nombre_sistema,
    (select count(*) as total from tbl_sis_seguimiento_comentarios where tbl_sis_seguimiento_comentarios.id_registro=h.id) as total_comentarios,


            h.*,
            (select count(id) from tbl_sis_seguimiento_situaciones where id_seguimiento= h.id) as CuentaSituacion
            from tbl_sis_seguimiento h

            inner join tbl_sis_seguimiento_marca
            on tbl_sis_seguimiento_marca.id_marca=h.marca

            inner join tbl_sis_seguimiento_modelo
            on tbl_sis_seguimiento_modelo.id_modelo=h.modelo

            inner join tbl_sis_seguimiento_sistema
            on tbl_sis_seguimiento_sistema.id_sistema=h.sistema


            left join tbl_usuario as base_supervisor
            on base_supervisor.rut=h.supervisor

            left join tbl_usuario as base_rut
            on base_rut.rut=h.rut

            left join tbl_sis_seguimiento_dealer
            on tbl_sis_seguimiento_dealer.id_dealer=base_rut.tipo_servicio


            where h.id_empresa='$id_empresa'
            $query_filtro_tipo $query_filtro_estado $query_filtro_cui
            $filtro_marca
             $filtro_modelo
              $filtro_sistema $filtro_fecha $filtro_vin $filtro_dealer $filtro_supervisor $filtro_mis_consultas  $filtro_dealer_1 $filtro_dealer_2

            AND (h.rut = '$rut' or
            '$rut' in (select tbl_sis_seguimiento_situaciones.rut_res from tbl_sis_seguimiento_situaciones where tbl_sis_seguimiento_situaciones.id_seguimiento=h.id)

            $filtro_para_supervisor


            )
            $query_res


            order by h.fecha_registro DESC, h.id DESC
        ";
    }

    if($id_empresa==61){
         $sql = "
            select

           *


            from tbl_sis_seguimiento h order by id desc



        ";
    }

   // echo $sql;

    $database->setquery($sql);
    $database->query();
    $datos = $database->listObjects();
    return $datos;
}
function Sis_SituacionesLista($idr, $id_empresa, $rut, $perfil)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    //echo "    $idr, $id_empresa, $rut, $perfil";
    if ($perfil == "") {
        $sql = "";
    }
    if ($perfil == "Super Registrador") {
        $sql = "

            select h.*,

            (select nombre_completo from tbl_usuario where rut=h.rut_res) as Nombre_responsable,
            (select cargo from tbl_usuario where rut=h.rut_res) as Cargo_responsable,
            (select nombre_completo from tbl_usuario where rut=h.rut) as Nombre_autor,
            (select cargo from tbl_usuario where rut=h.rut) as Cargo_autor,
            (select nombre_completo from tbl_usuario where rut=h.rut_den) as Nombre_denunciado,
            (select cargo from tbl_usuario where rut=h.rut_den) as Cargo_denunciado

            from tbl_sis_seguimiento_situaciones h

            where h.id_empresa='$id_empresa'

            and h.id_seguimiento='$idr'


            order by h.id ASC


            ";
    }
    if ($perfil == "Registrador") {
        $sql = "select h.*,

            (select nombre_completo from tbl_usuario where rut=h.rut_res) as Nombre_responsable,
            (select cargo from tbl_usuario where rut=h.rut_res) as Cargo_responsable,
            (select nombre_completo from tbl_usuario where rut=h.rut) as Nombre_autor,
            (select cargo from tbl_usuario where rut=h.rut) as Cargo_autor,
            (select nombre_completo from tbl_usuario where rut=h.rut_den) as Nombre_denunciado,
            (select cargo from tbl_usuario where rut=h.rut_den) as Cargo_denunciado

            from tbl_sis_seguimiento_situaciones h

            where h.id_empresa='$id_empresa'

            and rut='$rut'

            and h.id_seguimiento='$idr'



            order by h.id ASC


            ";
    }
    if ($perfil == "Responsable") {
        $sql = "

            select h.*,

            (select nombre_completo from tbl_usuario where rut=h.rut_res) as Nombre_responsable,
            (select cargo from tbl_usuario where rut=h.rut_res) as Cargo_responsable,
            (select nombre_completo from tbl_usuario where rut=h.rut) as Nombre_autor,
            (select cargo from tbl_usuario where rut=h.rut) as Cargo_autor,
            (select nombre_completo from tbl_usuario where rut=h.rut_den) as Nombre_denunciado,
            (select cargo from tbl_usuario where rut=h.rut_den) as Cargo_denunciado

            from tbl_sis_seguimiento_situaciones h

            where h.id_empresa='$id_empresa'

            and h.id_seguimiento='$idr'

            and (h.rut='$rut' or h.rut_res='$rut')

            order by h.id ASC



        ";
    }
    //    echo "<br>$sql";
    $database->setquery($sql);
    $database->query();
    $datos = $database->listObjects();
    return $datos;
}
function BACBUS_leeSujetoBus($id_registro, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select h.* from tbl_sis_seguimiento h where h.id_empresa='$id_empresa' and h.id='$id_registro'";
    //echo $sql;
    $database->setquery($sql);
    $database->query();
    $datos = $database->listObjects();
    return $datos;
}
function Sis_busLista_id($id, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "SELECT
    tbl_sis_seguimiento_marca.descripcion AS nombre_marca,
    tbl_sis_seguimiento_modelo.descripcion as nombre_modelo,
    tbl_sis_seguimiento_sistema.descripcion as nombre_sistema,
    h.*
FROM
    tbl_sis_seguimiento h
LEFT JOIN tbl_sis_seguimiento_marca ON tbl_sis_seguimiento_marca.id_marca = h.marca
LEFT JOIN tbl_sis_seguimiento_modelo ON tbl_sis_seguimiento_modelo.id_modelo= h.modelo
LEFT JOIN tbl_sis_seguimiento_sistema ON tbl_sis_seguimiento_sistema.id_sistema= h.sistema
WHERE
    h.id_empresa = '$id_empresa'
AND h.id = '$id'
ORDER BY
    h.fecha_registro DESC,
    h.id DESC
    ";

    //echo $sql;

    $database->setquery($sql);
    $database->query();
    $datos = $database->listObjects();
    return $datos;
}
function Sis_seguimiento_Save($id, $fecha_registro, $fecha_visita, $fecha_actualizacion,
$rut, $nombre, $cargo, $id_cui, $id_division, $id_area, $id_departamento,
$rut_col, $nombre_col, $cargo_col, $id_cui_col, $id_division_col,
$id_area_col, $id_departamento_col, $telefono_contacto, $estado_colaborador,
$programa_orienta, $motiva_atencion, $rut_den, $nombre_den, $cargo_den,
$id_cui_den, $id_division_den, $id_area_den, $id_departamento_den,
$antecedentes, $solicitud, $observaciones, $rut_res, $nombre_res,
$cargo_res, $id_cui_res, $id_division_res, $id_area_res, $id_departamento_res,
$clasificacion, $estado_registro, $tipo_registro, $id_empresa, $fecha_compromiso,
$vin, $marca, $modelo, $sistema, $sintoma, $condicion, $historial, $comentario,
$nombre_archivo1, $nombre_archivo2, $nombre_archivo3, $nombre_archivo4, $nombre_archivo5)
{
    //echo " $id,$fecha_registro,$fecha_visita,$fecha_actualizacion,
    //rut $rut,$nombre,$cargo,$id_cui,$id_division,$id_area,$id_departamento,
    //$rut_col,$nombre_col,$cargo_col,$id_cui_col,$id_division_col,$id_area_col,$id_departamento_col,
   // $telefono_contacto,$estado_colaborador,$programa_orienta,$motiva_atencion,
    //$rut_den,$nombre_den,$cargo_den,$id_cui_den,$id_division_den,$id_area_den,$id_departamento_den,
   // $antecedentes,$solicitud,$observaciones,
    //$rut_res,$nombre_res,$cargo_res,$id_cui_res,$id_division_res,$id_area_res,$id_departamento_res,
    //$clasificacion,$estado_registro,$tipo_registro, $id_empresa";
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $motiva_atencion = utf8_decode($motiva_atencion);
    $antecedentes    = utf8_decode($antecedentes);
    $solicitud       = utf8_decode($solicitud);
    $observaciones   = utf8_decode($observaciones);
    $sql             = "INSERT INTO tbl_sis_seguimiento
        (fecha_registro,fecha_visita,fecha_actualizacion,rut,nombre,cargo,id_cui,id_division,id_area,id_departamento,
        rut_col,nombre_col,cargo_col,id_cui_col,id_division_col,id_area_col,id_departamento_col,
        telefono_contacto,estado_colaborador,programa_orienta,motiva_atencion,
        rut_den,nombre_den,cargo_den,id_cui_den,id_division_den,id_area_den,id_departamento_den,
        tipo_registro, id_empresa,  estado_registro,
        vin, marca, modelo, sistema, detalle_sintoma, condicion, historial, comentario,
        archivo1, archivo2, archivo3, archivo4, archivo5) values
        ('$fecha_registro','$fecha_visita','$fecha_actualizacion','$rut','$nombre','$cargo',
        '$id_cui','$id_division','$id_area','$id_departamento',
        '$rut_col','$nombre_col','$cargo_col','$id_cui_col','$id_division_col','$id_area_col','$id_departamento_col',
        '$telefono_contacto','$estado_colaborador','$programa_orienta','$motiva_atencion',
        '$rut_den','$nombre_den','$cargo_den','$id_cui_den','$id_division_den',
        '$id_area_den','$id_departamento_den','$tipo_registro','$id_empresa',  '$estado_registro',
        '$vin', '$marca', '$modelo', '$sistema', '$sintoma', '$condicion', '$historial', '$comentario',
        '$nombre_archivo1', '$nombre_archivo2', '$nombre_archivo3', '$nombre_archivo4', '$nombre_archivo5')";

        if($tipo_registro=="BAC" and $rut_col==""){

        }   else {
    $database->setquery($sql);
    $database->query();

        }
    //sleep(10);

    $datos       = $database->listObjects();
    // return $datos;
    $sql_last_id = "select max(id) as id from tbl_sis_seguimiento ";
    $database->setquery($sql_last_id);
    $database->query();
    $datos = $database->listObjects();
    //echo "<br>dato<br>";
    //echo $datos[0]->id;
    return $datos[0]->id;
}
function Sis_seguimiento_Save_Situaciones($id_registro, $fecha_registro, $fecha_visita, $fecha_compromiso, $fecha_actualizacion, $rut, $nombre, $cargo, $id_cui, $id_division, $id_area, $id_departamento, $rut_col, $nombre_col, $cargo_col, $id_cui_col, $id_division_col, $id_area_col, $id_departamento_col, $telefono_contacto, $estado_colaborador, $programa_orienta, $motiva_atencion, $rut_den, $nombre_den, $cargo_den, $id_cui_den, $id_division_den, $id_area_den, $id_departamento_den, $antecedentes, $solicitud, $observaciones, $rut_res, $nombre_res, $cargo_res, $id_cui_res, $id_division_res, $id_area_res, $id_departamento_res, $clasificacion, $estado_registro, $tipo_registro, $id_empresa, $id_seguimiento)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $motiva_atencion = utf8_decode($motiva_atencion);
    $antecedentes    = utf8_decode($antecedentes);
    $solicitud       = utf8_decode($solicitud);
    $observaciones   = utf8_decode($observaciones);
    $sql             = "INSERT INTO tbl_sis_seguimiento_situaciones
        (id_seguimiento,fecha_registro,fecha_actualizacion,rut,nombre,cargo,id_cui,id_division,id_area,id_departamento,
        antecedentes,solicitud,observaciones,
        rut_res,nombre_res,cargo_res,id_cui_res,id_division_res,id_area_res,id_departamento_res,
        clasificacion,estado_registro,tipo_registro, id_empresa, fecha_compromiso, motiva_atencion, rut_den) values ('$id_seguimiento','$fecha_registro','$fecha_actualizacion','$rut','$nombre','$cargo',
        '$id_cui','$id_division','$id_area','$id_departamento',
        '$antecedentes','$solicitud','$observaciones',
        '$rut_res','$nombre_res','$cargo_res','$id_cui_res','$id_division_res','$id_area_res','$id_departamento_res',
        '$clasificacion','$estado_registro','$tipo_registro','$id_empresa', '$fecha_compromiso', '$motiva_atencion', '$rut_den')";

        //echo "<br>";
        //echo $sql;
        //echo "<br>";
        //sleep(5);

    $database->setquery($sql);
    $database->query();
    $datos = $database->listObjects();
    return $datos;
}

function Lista_id_malla_dado_Rut_Programa($rut, $id_programa, $id_empresa){
//asumimos que hay solo una malla por persona
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
$sql ="select h.*, (select id_malla from rel_lms_malla_persona where id_malla=h.id_malla and rut='$rut' limit 1) as id_malla_usuario
 from rel_lms_malla_curso h

where h.id_programa='$id_programa' and h.id_empresa='$id_empresa'
and (select id_malla from rel_lms_malla_persona where id_malla=h.id_malla and rut='$rut' limit 1) is not null

group by (select id_malla from rel_lms_malla_persona where id_malla=h.id_malla and rut='$rut' limit 1)
";

//echo "<br>$sql;";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}

function List_cursos_programa($rut, $id_empresa, $id_programa, $id_malla)
{                   // echo "<br>List_cursos_programa<br>$rut, $id_empresa, $id_programa, id malla $id_malla";
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);

    if($id_malla){
        $filtro_malla=" and id_malla='$id_malla' ";
    }

    $sql = "select h.*,
        (select id_programa from rel_lms_malla_curso where id_curso=h.id limit 1) as Programa,

        (select id_malla from rel_lms_malla_curso where id_curso=h.id $filtro_malla limit 1 ) as id_malla,
        (select avance from tbl_inscripcion_cierre where rut='$rut' and id_curso=h.id limit 1) as avance

        from tbl_lms_curso h
        where h.id_empresa='$id_empresa'



        and (select id_programa from rel_lms_malla_curso where id_curso=h.id $filtro_malla  limit 1)='$id_programa'


        order by (select avance from tbl_inscripcion_cierre where rut='$rut' and id_curso=h.id limit 1) ASC, h.nombre

        ";
   //echo "<br>".$sql;
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function VerificoSiTieneRespuestasObjPorIntento($rut, $id_pregunta, $id_objeto, $intento)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_evaluaciones_respuestas

        where rut='$rut' and id_pregunta='$id_pregunta' and id_objeto='$id_objeto' and numero_intento='$intento'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function Emb_Lista_EmbajadoresTutor($rut, $id_empresa, $id_grupo_interes)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "


        select h.*,(select email from tbl_emb_embajadores where rut=h.rut limit 1) as email,
        (select grupo  from tbl_emb_embajadores where rut=h.rut limit 1) as grupo,

        (select count(id) from tbl_emb_rel_embajadores_tareas where rut=h.rut and codigo='$id_grupo_interes'  and id_empresa=h.id_empresa) as CuentaTareas,

        (select count(id) from tbl_emb_respuestas_embajadores_tareas where rut=h.rut and id_grupo_interes='$id_grupo_interes' and id_empresa=h.id_empresa and estado='INICIADA') as CuentaTareasIniciada,
        (select count(id) from tbl_emb_respuestas_embajadores_tareas where rut=h.rut and id_grupo_interes='$id_grupo_interes' and id_empresa=h.id_empresa and estado='EN_REVISION') as CuentaTareasvRevision,
        (select count(id) from tbl_emb_respuestas_embajadores_tareas where rut=h.rut and id_grupo_interes='$id_grupo_interes' and id_empresa=h.id_empresa and estado='VALIDADA') as CuentaTareasvValidada,

        ( (select count(id) from tbl_emb_respuestas_embajadores_tareas where rut=h.rut and id_grupo_interes='$id_grupo_interes'  and id_empresa=h.id_empresa and estado='VALIDADA')/ (select count(id) from tbl_emb_rel_embajadores_tareas where rut=h.rut  and codigo='$id_grupo_interes' and id_empresa=h.id_empresa)) as porc_validada,
        ( (select count(id) from tbl_emb_respuestas_embajadores_tareas where rut=h.rut and id_grupo_interes='$id_grupo_interes'  and id_empresa=h.id_empresa and estado='EN_REVISION') / (select count(id) from tbl_emb_rel_embajadores_tareas where rut=h.rut and codigo='$id_grupo_interes'  and id_empresa=h.id_empresa)) as porc_revision,
        ( (select count(id) from tbl_emb_respuestas_embajadores_tareas where rut=h.rut and id_grupo_interes='$id_grupo_interes'  and id_empresa=h.id_empresa and estado='INICIADA') / (select count(id) from tbl_emb_rel_embajadores_tareas where rut=h.rut and codigo='$id_grupo_interes'  and id_empresa=h.id_empresa)) as porc_iniciada,

        (100*( (select count(id) from tbl_emb_respuestas_embajadores_tareas where rut=h.rut and id_empresa=h.id_empresa and id_grupo_interes='$id_grupo_interes'  and estado='VALIDADA')/ (select count(id) from tbl_emb_rel_embajadores_tareas where rut=h.rut and codigo='$id_grupo_interes'  and id_empresa=h.id_empresa))
        +50*( (select count(id) from tbl_emb_respuestas_embajadores_tareas where rut=h.rut and id_empresa=h.id_empresa and id_grupo_interes='$id_grupo_interes'  and estado='EN_REVISION') / (select count(id) from tbl_emb_rel_embajadores_tareas where rut=h.rut and codigo='$id_grupo_interes'  and id_empresa=h.id_empresa))
        ) as avance


        from tbl_emb_rel_embajadores_tareas h

        where h.id_empresa='$id_empresa'

        and (select rut_tutor from tbl_emb_embajadores where rut=h.rut and  codigo='$id_grupo_interes' and rut_tutor<>'' limit 1) ='$rut'
        and h.codigo='$id_grupo_interes'
        and (select vigencia  from tbl_usuario where rut=h.rut) ='0'
        group by h.rut

        order by (100*( (select count(id) from tbl_emb_respuestas_embajadores_tareas where rut=h.rut and id_grupo_interes='$id_grupo_interes'  and id_empresa=h.id_empresa and estado='VALIDADA')/ (select count(id) from tbl_emb_rel_embajadores_tareas where rut=h.rut and codigo='$id_grupo_interes'  and id_empresa=h.id_empresa))
        +50*( (select count(id) from tbl_emb_respuestas_embajadores_tareas where rut=h.rut and id_grupo_interes='$id_grupo_interes'  and id_empresa=h.id_empresa and estado='EN_REVISION') / (select count(id) from tbl_emb_rel_embajadores_tareas where rut=h.rut and codigo='$id_grupo_interes'  and id_empresa=h.id_empresa))
        )  DESC



        ";
    //echo $sql;
    $database->setquery($sql);
    $database->query();
    $datos = $database->listObjects();
    return $datos;
}

function Emb_Lista_Embajadores($id_empresa, $id_grupo_interes)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "


        select h.*,(select email from tbl_emb_embajadores where rut=h.rut limit 1) as email,
        (select grupo  from tbl_emb_embajadores where rut=h.rut limit 1) as grupo,



        (select count(id) from tbl_emb_rel_embajadores_tareas where rut=h.rut and codigo='$id_grupo_interes'  and id_empresa=h.id_empresa) as CuentaTareas,

        (select count(id) from tbl_emb_respuestas_embajadores_tareas where rut=h.rut and id_grupo_interes='$id_grupo_interes' and id_empresa=h.id_empresa and estado='INICIADA') as CuentaTareasIniciada,
        (select count(id) from tbl_emb_respuestas_embajadores_tareas where rut=h.rut and id_grupo_interes='$id_grupo_interes' and id_empresa=h.id_empresa and estado='EN_REVISION') as CuentaTareasvRevision,
        (select count(id) from tbl_emb_respuestas_embajadores_tareas where rut=h.rut and id_grupo_interes='$id_grupo_interes' and id_empresa=h.id_empresa and estado='VALIDADA') as CuentaTareasvValidada,

        ( (select count(id) from tbl_emb_respuestas_embajadores_tareas where rut=h.rut and id_grupo_interes='$id_grupo_interes'  and id_empresa=h.id_empresa and estado='VALIDADA')/ (select count(id) from tbl_emb_rel_embajadores_tareas where rut=h.rut  and codigo='$id_grupo_interes' and id_empresa=h.id_empresa)) as porc_validada,
        ( (select count(id) from tbl_emb_respuestas_embajadores_tareas where rut=h.rut and id_grupo_interes='$id_grupo_interes'  and id_empresa=h.id_empresa and estado='EN_REVISION') / (select count(id) from tbl_emb_rel_embajadores_tareas where rut=h.rut and codigo='$id_grupo_interes'  and id_empresa=h.id_empresa)) as porc_revision,
        ( (select count(id) from tbl_emb_respuestas_embajadores_tareas where rut=h.rut and id_grupo_interes='$id_grupo_interes'  and id_empresa=h.id_empresa and estado='INICIADA') / (select count(id) from tbl_emb_rel_embajadores_tareas where rut=h.rut and codigo='$id_grupo_interes'  and id_empresa=h.id_empresa)) as porc_iniciada,

        (100*( (select count(id) from tbl_emb_respuestas_embajadores_tareas where rut=h.rut and id_empresa=h.id_empresa and id_grupo_interes='$id_grupo_interes'  and estado='VALIDADA')/ (select count(id) from tbl_emb_rel_embajadores_tareas where rut=h.rut and codigo='$id_grupo_interes'  and id_empresa=h.id_empresa))
        +50*( (select count(id) from tbl_emb_respuestas_embajadores_tareas where rut=h.rut and id_empresa=h.id_empresa and id_grupo_interes='$id_grupo_interes'  and estado='EN_REVISION') / (select count(id) from tbl_emb_rel_embajadores_tareas where rut=h.rut and codigo='$id_grupo_interes'  and id_empresa=h.id_empresa))
        ) as avance


        from tbl_emb_rel_embajadores_tareas h

        where h.id_empresa='$id_empresa' and codigo='$id_grupo_interes'
        group by h.rut

        order by (100*( (select count(id) from tbl_emb_respuestas_embajadores_tareas where rut=h.rut and id_grupo_interes='$id_grupo_interes'  and id_empresa=h.id_empresa and estado='VALIDADA')/ (select count(id) from tbl_emb_rel_embajadores_tareas where rut=h.rut and codigo='$id_grupo_interes'  and id_empresa=h.id_empresa))
        +50*( (select count(id) from tbl_emb_respuestas_embajadores_tareas where rut=h.rut and id_grupo_interes='$id_grupo_interes'  and id_empresa=h.id_empresa and estado='EN_REVISION') / (select count(id) from tbl_emb_rel_embajadores_tareas where rut=h.rut and codigo='$id_grupo_interes'  and id_empresa=h.id_empresa))
        )  DESC



        ";

    //echo "<br><br><br><br>$sql";
    $database->setquery($sql);
    $database->query();
    $datos = $database->listObjects();
    return $datos;
}

function Emb_Lista_EmbajadoresGrupaldata($id_empresa, $id_grupo_interes, $idgrupo)
{




    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "


       select h.*,
       (select grupo from tbl_emb_embajadores where rut=h.rut and id_ola='$id_grupo_interes' limit 1) as grupo,
        (select rut_tutor from tbl_emb_embajadores where grupo= (select grupo from tbl_emb_embajadores where rut=h.rut and id_ola='$id_grupo_interes' limit 1) AND     rut_sponsor<>'' AND     rut_tutor<>'' limit 1) as asesor,
        (select rut_sponsor from tbl_emb_embajadores where grupo= (select grupo from tbl_emb_embajadores where rut=h.rut and id_ola='$id_grupo_interes' limit 1) AND     rut_sponsor<>'' AND     rut_tutor<>'' limit 1) as sponsor,
        (select idgrupo  from tbl_emb_embajadores where   id_ola='$id_grupo_interes' and rut=h.rut limit 1) as idgrupo,



        (select count(id) from tbl_emb_rel_embajadores_tareas where rut=h.rut and codigo='$id_grupo_interes'  and id_empresa=h.id_empresa) as CuentaTareas,

        (select count(id) from tbl_emb_respuestas_embajadores_tareas where rut=h.rut and id_grupo_interes='$id_grupo_interes' and id_empresa=h.id_empresa and estado='INICIADA') as CuentaTareasIniciada,
        (select count(id) from tbl_emb_respuestas_embajadores_tareas where rut=h.rut and id_grupo_interes='$id_grupo_interes' and id_empresa=h.id_empresa and estado='EN_REVISION') as CuentaTareasvRevision,
        (select count(id) from tbl_emb_respuestas_embajadores_tareas where rut=h.rut and id_grupo_interes='$id_grupo_interes' and id_empresa=h.id_empresa and estado='VALIDADA') as CuentaTareasvValidada,

        ( (select count(id) from tbl_emb_respuestas_embajadores_tareas where rut=h.rut and id_grupo_interes='$id_grupo_interes'  and id_empresa=h.id_empresa and estado='VALIDADA')/ (select count(id) from tbl_emb_rel_embajadores_tareas where rut=h.rut  and codigo='$id_grupo_interes' and id_empresa=h.id_empresa)) as porc_validada,
        ( (select count(id) from tbl_emb_respuestas_embajadores_tareas where rut=h.rut and id_grupo_interes='$id_grupo_interes'  and id_empresa=h.id_empresa and estado='EN_REVISION') / (select count(id) from tbl_emb_rel_embajadores_tareas where rut=h.rut and codigo='$id_grupo_interes'  and id_empresa=h.id_empresa)) as porc_revision,
        ( (select count(id) from tbl_emb_respuestas_embajadores_tareas where rut=h.rut and id_grupo_interes='$id_grupo_interes'  and id_empresa=h.id_empresa and estado='INICIADA') / (select count(id) from tbl_emb_rel_embajadores_tareas where rut=h.rut and codigo='$id_grupo_interes'  and id_empresa=h.id_empresa)) as porc_iniciada,

        AVG(100*( (select count(id) from tbl_emb_respuestas_embajadores_tareas where rut=h.rut and id_empresa=h.id_empresa and id_grupo_interes='$id_grupo_interes'  and estado='VALIDADA')/ (select count(id) from tbl_emb_rel_embajadores_tareas where rut=h.rut and codigo='$id_grupo_interes'  and id_empresa=h.id_empresa))
        +50*( (select count(id) from tbl_emb_respuestas_embajadores_tareas where rut=h.rut and id_empresa=h.id_empresa and id_grupo_interes='$id_grupo_interes'  and estado='EN_REVISION') / (select count(id) from tbl_emb_rel_embajadores_tareas where rut=h.rut and codigo='$id_grupo_interes'  and id_empresa=h.id_empresa))
        ) as avance


        from tbl_emb_rel_embajadores_tareas h

        where h.id_empresa='$id_empresa' and codigo='$id_grupo_interes'
        and (select grupo from tbl_emb_embajadores where rut=h.rut and id_ola='$id_grupo_interes' limit 1)<>''

        group by (select grupo from tbl_emb_embajadores where rut=h.rut and id_ola='$id_grupo_interes' limit 1)


        order by AVG(100*( (select count(id) from tbl_emb_respuestas_embajadores_tareas where rut=h.rut and id_empresa=h.id_empresa and id_grupo_interes='$id_grupo_interes'  and estado='VALIDADA')/ (select count(id) from tbl_emb_rel_embajadores_tareas where rut=h.rut and codigo='$id_grupo_interes'  and id_empresa=h.id_empresa))
        +50*( (select count(id) from tbl_emb_respuestas_embajadores_tareas where rut=h.rut and id_empresa=h.id_empresa and id_grupo_interes='$id_grupo_interes'  and estado='EN_REVISION') / (select count(id) from tbl_emb_rel_embajadores_tareas where rut=h.rut and codigo='$id_grupo_interes'  and id_empresa=h.id_empresa))
        ) DESC, (select grupo  from tbl_emb_embajadores where rut=h.rut limit 1)



        ";

    //echo "<br><br><br>$sql";


    $database->setquery($sql);
    $database->query();
    $datos = $database->listObjects();
    return $datos;
}




function Emb_Lista_EmbajadoresSponsorGrupaldata($id_empresa, $id_grupo_interes, $idgrupo)
{




    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "


       select h.*,
       (select rut_tutor from tbl_emb_embajadores where rut=h.rut and id_ola='$id_grupo_interes' limit 1) as rut_tutor,
        (select rut_tutor from tbl_emb_embajadores where grupo= (select grupo from tbl_emb_embajadores where rut=h.rut and id_ola='$id_grupo_interes' limit 1) AND     rut_sponsor<>'' AND     rut_tutor<>'' limit 1) as asesor,
        (select rut_sponsor from tbl_emb_embajadores where grupo= (select grupo from tbl_emb_embajadores where rut=h.rut and id_ola='$id_grupo_interes' limit 1) AND     rut_sponsor<>'' AND     rut_tutor<>'' limit 1) as sponsor,
        (select idgrupo  from tbl_emb_embajadores where   id_ola='$id_grupo_interes' and rut=h.rut limit 1) as idgrupo,



        (select count(id) from tbl_emb_rel_embajadores_tareas where rut=h.rut and codigo='$id_grupo_interes'  and id_empresa=h.id_empresa) as CuentaTareas,

        (select count(id) from tbl_emb_respuestas_embajadores_tareas where rut=h.rut and id_grupo_interes='$id_grupo_interes' and id_empresa=h.id_empresa and estado='INICIADA') as CuentaTareasIniciada,
        (select count(id) from tbl_emb_respuestas_embajadores_tareas where rut=h.rut and id_grupo_interes='$id_grupo_interes' and id_empresa=h.id_empresa and estado='EN_REVISION') as CuentaTareasvRevision,
        (select count(id) from tbl_emb_respuestas_embajadores_tareas where rut=h.rut and id_grupo_interes='$id_grupo_interes' and id_empresa=h.id_empresa and estado='VALIDADA') as CuentaTareasvValidada,

        ( (select count(id) from tbl_emb_respuestas_embajadores_tareas where rut=h.rut and id_grupo_interes='$id_grupo_interes'  and id_empresa=h.id_empresa and estado='VALIDADA')/ (select count(id) from tbl_emb_rel_embajadores_tareas where rut=h.rut  and codigo='$id_grupo_interes' and id_empresa=h.id_empresa)) as porc_validada,
        ( (select count(id) from tbl_emb_respuestas_embajadores_tareas where rut=h.rut and id_grupo_interes='$id_grupo_interes'  and id_empresa=h.id_empresa and estado='EN_REVISION') / (select count(id) from tbl_emb_rel_embajadores_tareas where rut=h.rut and codigo='$id_grupo_interes'  and id_empresa=h.id_empresa)) as porc_revision,
        ( (select count(id) from tbl_emb_respuestas_embajadores_tareas where rut=h.rut and id_grupo_interes='$id_grupo_interes'  and id_empresa=h.id_empresa and estado='INICIADA') / (select count(id) from tbl_emb_rel_embajadores_tareas where rut=h.rut and codigo='$id_grupo_interes'  and id_empresa=h.id_empresa)) as porc_iniciada,

        AVG(100*( (select count(id) from tbl_emb_respuestas_embajadores_tareas where rut=h.rut and id_empresa=h.id_empresa and id_grupo_interes='$id_grupo_interes'  and estado='VALIDADA')/ (select count(id) from tbl_emb_rel_embajadores_tareas where rut=h.rut and codigo='$id_grupo_interes'  and id_empresa=h.id_empresa))
        +50*( (select count(id) from tbl_emb_respuestas_embajadores_tareas where rut=h.rut and id_empresa=h.id_empresa and id_grupo_interes='$id_grupo_interes'  and estado='EN_REVISION') / (select count(id) from tbl_emb_rel_embajadores_tareas where rut=h.rut and codigo='$id_grupo_interes'  and id_empresa=h.id_empresa))
        ) as avance


        from tbl_emb_rel_embajadores_tareas h

        where h.id_empresa='$id_empresa' and codigo='$id_grupo_interes'
        and (select rut_tutor from tbl_emb_embajadores where rut=h.rut and id_ola='$id_grupo_interes' limit 1)<>''
        and         (select rut_sponsor from tbl_emb_embajadores where grupo= (select grupo from tbl_emb_embajadores where rut=h.rut and id_ola='$id_grupo_interes' limit 1) AND     rut_sponsor<>'' AND     rut_tutor<>'' limit 1)<>''

        group by (select rut_tutor from tbl_emb_embajadores where rut=h.rut and id_ola='$id_grupo_interes' limit 1)


        order by AVG(100*( (select count(id) from tbl_emb_respuestas_embajadores_tareas where rut=h.rut and id_empresa=h.id_empresa and id_grupo_interes='$id_grupo_interes'  and estado='VALIDADA')/ (select count(id) from tbl_emb_rel_embajadores_tareas where rut=h.rut and codigo='$id_grupo_interes'  and id_empresa=h.id_empresa))
        +50*( (select count(id) from tbl_emb_respuestas_embajadores_tareas where rut=h.rut and id_empresa=h.id_empresa and id_grupo_interes='$id_grupo_interes'  and estado='EN_REVISION') / (select count(id) from tbl_emb_rel_embajadores_tareas where rut=h.rut and codigo='$id_grupo_interes'  and id_empresa=h.id_empresa))
        ) DESC, (select grupo  from tbl_emb_embajadores where rut=h.rut limit 1)



        ";

    //echo "GRUPAL <br><br><br>$sql";


    $database->setquery($sql);
    $database->query();
    $datos = $database->listObjects();
    return $datos;
}

function Emb_Lista_EmbajadoresGrupal_xRUTData($id_empresa, $id_grupo_interes, $idgrupo)

{
//    echo "<br>$id_empresa, $id_grupo_interes, $grupo";

    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "


        select h.*,
        (select grupo  from tbl_emb_embajadores where rut=h.rut and id_ola='$id_grupo_interes' limit 1) as grupo,
        (select email  from tbl_emb_embajadores where rut=h.rut and id_ola='$id_grupo_interes' limit 1) as email,



        (select count(id) from tbl_emb_rel_embajadores_tareas where rut=h.rut and codigo='$id_grupo_interes'  and id_empresa=h.id_empresa) as CuentaTareas,

        (select count(id) from tbl_emb_respuestas_embajadores_tareas where rut=h.rut and id_grupo_interes='$id_grupo_interes' and id_empresa=h.id_empresa and estado='INICIADA') as CuentaTareasIniciada,
        (select count(id) from tbl_emb_respuestas_embajadores_tareas where rut=h.rut and id_grupo_interes='$id_grupo_interes' and id_empresa=h.id_empresa and estado='EN_REVISION') as CuentaTareasvRevision,
        (select count(id) from tbl_emb_respuestas_embajadores_tareas where rut=h.rut and id_grupo_interes='$id_grupo_interes' and id_empresa=h.id_empresa and estado='VALIDADA') as CuentaTareasvValidada,

        ( (select count(id) from tbl_emb_respuestas_embajadores_tareas where rut=h.rut and id_grupo_interes='$id_grupo_interes'  and id_empresa=h.id_empresa and estado='VALIDADA')/ (select count(id) from tbl_emb_rel_embajadores_tareas where rut=h.rut  and codigo='$id_grupo_interes' and id_empresa=h.id_empresa)) as porc_validada,
        ( (select count(id) from tbl_emb_respuestas_embajadores_tareas where rut=h.rut and id_grupo_interes='$id_grupo_interes'  and id_empresa=h.id_empresa and estado='EN_REVISION') / (select count(id) from tbl_emb_rel_embajadores_tareas where rut=h.rut and codigo='$id_grupo_interes'  and id_empresa=h.id_empresa)) as porc_revision,
        ( (select count(id) from tbl_emb_respuestas_embajadores_tareas where rut=h.rut and id_grupo_interes='$id_grupo_interes'  and id_empresa=h.id_empresa and estado='INICIADA') / (select count(id) from tbl_emb_rel_embajadores_tareas where rut=h.rut and codigo='$id_grupo_interes'  and id_empresa=h.id_empresa)) as porc_iniciada,

        (100*( (select count(id) from tbl_emb_respuestas_embajadores_tareas where rut=h.rut and id_empresa=h.id_empresa and id_grupo_interes='$id_grupo_interes'  and estado='VALIDADA')/ (select count(id) from tbl_emb_rel_embajadores_tareas where rut=h.rut and codigo='$id_grupo_interes'  and id_empresa=h.id_empresa))
        +50*( (select count(id) from tbl_emb_respuestas_embajadores_tareas where rut=h.rut and id_empresa=h.id_empresa and id_grupo_interes='$id_grupo_interes'  and estado='EN_REVISION') / (select count(id) from tbl_emb_rel_embajadores_tareas where rut=h.rut and codigo='$id_grupo_interes'  and id_empresa=h.id_empresa))
        ) as avance

        from tbl_emb_rel_embajadores_tareas h

        where h.id_empresa='$id_empresa' and codigo='$id_grupo_interes'
        and (select idgrupo from tbl_emb_embajadores where rut=h.rut and id_ola='$id_grupo_interes' limit 1)='$idgrupo'

        group by h.rut

        order by (100*( (select count(id) from tbl_emb_respuestas_embajadores_tareas where rut=h.rut and id_grupo_interes='$id_grupo_interes'  and id_empresa=h.id_empresa and estado='VALIDADA')/ (select count(id) from tbl_emb_rel_embajadores_tareas where rut=h.rut and codigo='$id_grupo_interes'  and id_empresa=h.id_empresa))
        +50*( (select count(id) from tbl_emb_respuestas_embajadores_tareas where rut=h.rut and id_grupo_interes='$id_grupo_interes'  and id_empresa=h.id_empresa and estado='EN_REVISION') / (select count(id) from tbl_emb_rel_embajadores_tareas where rut=h.rut and codigo='$id_grupo_interes'  and id_empresa=h.id_empresa))
        )  DESC, (select nombre_completo from tbl_usuario where rut=h.rut)



        ";

    //echo "<br><br><br><br>$sql"; exit();
    $database->setquery($sql);
    $database->query();
    $datos = $database->listObjects();
    return $datos;
}



function Emb_Lista_EmbajadoresGrupalTutor_xRUTData($id_empresa, $id_grupo_interes, $rut_tutor)

{
//    echo "<br>$id_empresa, $id_grupo_interes, $grupo";

    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "


        select h.*,
        (select grupo  from tbl_emb_embajadores where rut=h.rut and id_ola='$id_grupo_interes' limit 1) as grupo,
        (select email  from tbl_emb_embajadores where rut=h.rut and id_ola='$id_grupo_interes' limit 1) as email,



        (select count(id) from tbl_emb_rel_embajadores_tareas where rut=h.rut and codigo='$id_grupo_interes'  and id_empresa=h.id_empresa) as CuentaTareas,

        (select count(id) from tbl_emb_respuestas_embajadores_tareas where rut=h.rut and id_grupo_interes='$id_grupo_interes' and id_empresa=h.id_empresa and estado='INICIADA') as CuentaTareasIniciada,
        (select count(id) from tbl_emb_respuestas_embajadores_tareas where rut=h.rut and id_grupo_interes='$id_grupo_interes' and id_empresa=h.id_empresa and estado='EN_REVISION') as CuentaTareasvRevision,
        (select count(id) from tbl_emb_respuestas_embajadores_tareas where rut=h.rut and id_grupo_interes='$id_grupo_interes' and id_empresa=h.id_empresa and estado='VALIDADA') as CuentaTareasvValidada,

        ( (select count(id) from tbl_emb_respuestas_embajadores_tareas where rut=h.rut and id_grupo_interes='$id_grupo_interes'  and id_empresa=h.id_empresa and estado='VALIDADA')/ (select count(id) from tbl_emb_rel_embajadores_tareas where rut=h.rut  and codigo='$id_grupo_interes' and id_empresa=h.id_empresa)) as porc_validada,
        ( (select count(id) from tbl_emb_respuestas_embajadores_tareas where rut=h.rut and id_grupo_interes='$id_grupo_interes'  and id_empresa=h.id_empresa and estado='EN_REVISION') / (select count(id) from tbl_emb_rel_embajadores_tareas where rut=h.rut and codigo='$id_grupo_interes'  and id_empresa=h.id_empresa)) as porc_revision,
        ( (select count(id) from tbl_emb_respuestas_embajadores_tareas where rut=h.rut and id_grupo_interes='$id_grupo_interes'  and id_empresa=h.id_empresa and estado='INICIADA') / (select count(id) from tbl_emb_rel_embajadores_tareas where rut=h.rut and codigo='$id_grupo_interes'  and id_empresa=h.id_empresa)) as porc_iniciada,

        (100*( (select count(id) from tbl_emb_respuestas_embajadores_tareas where rut=h.rut and id_empresa=h.id_empresa and id_grupo_interes='$id_grupo_interes'  and estado='VALIDADA')/ (select count(id) from tbl_emb_rel_embajadores_tareas where rut=h.rut and codigo='$id_grupo_interes'  and id_empresa=h.id_empresa))
        +50*( (select count(id) from tbl_emb_respuestas_embajadores_tareas where rut=h.rut and id_empresa=h.id_empresa and id_grupo_interes='$id_grupo_interes'  and estado='EN_REVISION') / (select count(id) from tbl_emb_rel_embajadores_tareas where rut=h.rut and codigo='$id_grupo_interes'  and id_empresa=h.id_empresa))
        ) as avance

        from tbl_emb_rel_embajadores_tareas h

        where h.id_empresa='$id_empresa' and codigo='$id_grupo_interes'
        and (select rut_tutor from tbl_emb_embajadores where rut=h.rut and id_ola='$id_grupo_interes' limit 1)='$rut_tutor'

        group by h.rut

        order by (100*( (select count(id) from tbl_emb_respuestas_embajadores_tareas where rut=h.rut and id_grupo_interes='$id_grupo_interes'  and id_empresa=h.id_empresa and estado='VALIDADA')/ (select count(id) from tbl_emb_rel_embajadores_tareas where rut=h.rut and codigo='$id_grupo_interes'  and id_empresa=h.id_empresa))
        +50*( (select count(id) from tbl_emb_respuestas_embajadores_tareas where rut=h.rut and id_grupo_interes='$id_grupo_interes'  and id_empresa=h.id_empresa and estado='EN_REVISION') / (select count(id) from tbl_emb_rel_embajadores_tareas where rut=h.rut and codigo='$id_grupo_interes'  and id_empresa=h.id_empresa))
        )  DESC, (select nombre_completo from tbl_usuario where rut=h.rut)



        ";

    //echo "<br><br><br><br>$sql";
    $database->setquery($sql);
    $database->query();
    $datos = $database->listObjects();
    return $datos;
}

function InsertaRespuestaPorTarea($rut, $id_empresa, $id_tarea, $estado, $fecha_inicio, $fecha_registro, $link, $comentarios, $conquientrabajaste, $conquientrabajaras, $dias, $rut_tutor, $comentario_tutor, $id_grupo_interes)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $fecha = date("Y-m-d");
    $hora  = date("H:i:s");
    $tag   = utf8_decode($tag);
    if ($estado == "INICIADA") {
        $sql = "INSERT INTO tbl_emb_respuestas_embajadores_tareas(rut, id_tarea, id_empresa, fecha_inicio, fecha_registro, link, comentarios, estado, conquientrabajaste, conquientrabajaras, dias, id_grupo_interes) " . "VALUES ('$rut', '$id_tarea', '$id_empresa', '$fecha', '', '$link', '$comentarios', '$estado', '$conquientrabajaste', '$conquientrabajaras', '$dias', '$id_grupo_interes')";
    }
    if ($estado == "EN_REVISION") {
        $sql = "
            update tbl_emb_respuestas_embajadores_tareas set fecha_registro='$fecha', link='$link', estado='EN_REVISION',
            comentarios='$comentarios', conquientrabajaste='$conquientrabajaste', dias='$dias'
            where id_tarea='$id_tarea' and rut='$rut'";
    }
    if ($estado == "VALIDADA") {
        $sql = "
            update tbl_emb_respuestas_embajadores_tareas set fecha_validacion='$fecha', estado='VALIDADA',
            lider4='$rut_tutor', lider5='$comentario_tutor'
            where id='$id_tarea' ";
    }
    if ($estado == "DEVUELTA") {
        $sql = "
            update tbl_emb_respuestas_embajadores_tareas set fecha_validacion='$fecha', estado='DEVUELTA',
            lider4='$rut_tutor', lider5='$comentario_tutor'
            where id='$id_tarea'";
    }
    $database->setquery($sql);
    $database->query();
}

function Emb_BuscaGrupo($rut, $id_empresa, $grupointeres){

    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "

    select grupo from tbl_emb_embajadores where rut='$rut' and id_ola='$grupointeres' and id_empresa='$id_empresa' and grupo<>'' limit 1

    ";
    $database->setquery($sql);
    $database->query();
    $datos = $database->listObjects();
    return $datos;


}

function Emb_Lista_Embajadores_grupo($id_empresa, $id_grupo_interes){

    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select count(id) as embajador from tbl_emb_rel_embajadores_tareas h where rut='$rut' and id_empresa='$id_empresa' and codigo='$grupointeres'";
    $database->setquery($sql);
    $database->query();
    $datos = $database->listObjects();
    return $datos;


}

function EMB_BuscaSoyEmbajador($rut, $id_empresa, $grupointeres)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select count(id) as embajador from tbl_emb_embajadores h where rut='$rut' and id_empresa='$id_empresa' and id_ola='$grupointeres'";
    //echo $sql;

    $database->setquery($sql);
    $database->query();
    $datos = $database->listObjects();
    return $datos;
}

function EMB_BuscaSoySponsor($rut, $id_empresa, $grupointeres)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select count(id) as sponsor from tbl_emb_embajadores h where rut_sponsor='$rut' and id_empresa='$id_empresa' and id_ola='$grupointeres'";
    //echo $sql;

    $database->setquery($sql);
    $database->query();
    $datos = $database->listObjects();
    return $datos;
}

function EMB_BuscaCuentaTareasEmbajador($rut, $id_empresa, $grupointeres)
{
        global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);
        $sql = "select count(id) as tareas from tbl_emb_rel_embajadores_tareas h where rut='$rut' and id_empresa='$id_empresa' and codigo='$grupointeres'";

         //echo $sql;
        $database->setquery($sql);
        $database->query();
        $datos = $database->listObjects();
        return $datos[0]->tareas;
}
function EMB_BuscaSoyTutor($rut, $id_empresa, $grupointeres)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select count(id) as tutor from tbl_emb_embajadores h where rut_tutor='$rut' and id_empresa='$id_empresa' and id_ola='$grupointeres'";
    $database->setquery($sql);
    $database->query();
    $datos = $database->listObjects();
    return $datos;
}
function EMB_buscalista_tareas($rut, $estado, $id_empresa, $id_grupo_interes)
{
    if ($estado == "") {
        $query = " ";
    }
    if ($estado == "no_iniciado") {
        $query = " and (select estado from tbl_emb_respuestas_embajadores_tareas where rut=h.rut and id_tarea=h.id_tarea) IS NULL ";
    }
    if ($estado == "en_proceso") {
        $query = " and (select estado from tbl_emb_respuestas_embajadores_tareas where rut=h.rut and id_tarea=h.id_tarea)='INICIADA' ";
    }
    if ($estado == "en_revision") {
        $query = " and
        (
         (select estado from tbl_emb_respuestas_embajadores_tareas where rut=h.rut and id_tarea=h.id_tarea)='EN_REVISION'
           or
           (select estado from tbl_emb_respuestas_embajadores_tareas where rut=h.rut and id_tarea=h.id_tarea)='DEVUELTA'
         )
         ";
    }
    if ($estado == "finalizado") {
        $query = " and (select estado from tbl_emb_respuestas_embajadores_tareas where rut=h.rut and id_tarea=h.id_tarea)='VALIDADA' ";
    }


    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select h.*,


        (select nombre from tbl_emb_tareas where codigo=h.id_tarea  limit 1) as tarea_nombre,
        (select descripcion from tbl_emb_tareas where codigo=h.id_tarea limit 1) as tarea_descripcion,
        (select link_material from tbl_emb_tareas where codigo=h.id_tarea limit 1) as tarea_link_material,
        (select link_material2 from tbl_emb_tareas where codigo=h.id_tarea  limit 1) as tarea_link_material2,
        (select link_material3 from tbl_emb_tareas where codigo=h.id_tarea  limit 1) as tarea_link_material3,

        (select pregunta1 from tbl_emb_tareas where codigo=h.id_tarea limit 1) as pregunta1,
        (select pregunta2 from tbl_emb_tareas where codigo=h.id_tarea  limit 1) as pregunta2,
        (select pregunta3 from tbl_emb_tareas where codigo=h.id_tarea  limit 1) as pregunta3,

        (select link_archivo_trabajo from tbl_emb_tareas where codigo=h.id_tarea  limit 1) as link_archivo_trabajo,

        (select link_tutor from tbl_emb_tareas where codigo=h.id_tarea  limit 1) as link_tutor,
        (select instruccion_tutor from tbl_emb_tareas where codigo=h.id_tarea  limit 1) as instruccion_tutor,

        (select accion from tbl_emb_tareas where codigo=h.id_tarea  limit 1) as accion,

        (select accion from tbl_emb_tareas where codigo=h.id_tarea  limit 1) as tarea_accion,
        (select descripcion_accion from tbl_emb_tareas where codigo=h.id_tarea  limit 1) as tarea_descripcion_accion,
        (select duracion from tbl_emb_tareas where codigo=h.id_tarea  limit 1) as tarea_duracion,
        (select fecha_termino from tbl_emb_tareas where codigo=h.id_tarea  limit 1) as fecha_termino,
        (select estado from tbl_emb_respuestas_embajadores_tareas where rut=h.rut and id_tarea=h.id_tarea  limit 1) as respuesta_estado,
        (select id from tbl_emb_respuestas_embajadores_tareas where rut=h.rut and id_tarea=h.id_tarea  limit 1) as idt,

        (select fecha_inicio from tbl_emb_respuestas_embajadores_tareas where rut=h.rut and id_tarea=h.id_tarea  limit 1) as respuesta_fecha_inicio,
        (select fecha_registro from tbl_emb_respuestas_embajadores_tareas where rut=h.rut and id_tarea=h.id_tarea  limit 1) as respuesta_fecha_registro,

        (select link from tbl_emb_respuestas_embajadores_tareas where rut=h.rut and id_tarea=h.id_tarea  limit 1) as respuesta_link,
        (select comentarios from tbl_emb_respuestas_embajadores_tareas where rut=h.rut and id_tarea=h.id_tarea  limit 1) as respuesta_comentarios,

        (select conquientrabajaste from tbl_emb_respuestas_embajadores_tareas where rut=h.rut and id_tarea=h.id_tarea  limit 1) as conquientrabajaste,
        (select conquientrabajaras from tbl_emb_respuestas_embajadores_tareas where rut=h.rut and id_tarea=h.id_tarea  limit 1) as conquientrabajaras,
        (select dias from tbl_emb_respuestas_embajadores_tareas where rut=h.rut and id_tarea=h.id_tarea  limit 1) as dias,
        (select lider4 from tbl_emb_respuestas_embajadores_tareas where rut=h.rut and id_tarea=h.id_tarea  limit 1) as respuesta_lider4,
        (select lider5 from tbl_emb_respuestas_embajadores_tareas where rut=h.rut and id_tarea=h.id_tarea  limit 1) as respuesta_lider5

        from tbl_emb_rel_embajadores_tareas h where h.rut='$rut'
        and codigo='$id_grupo_interes'

        and h.id_empresa='$id_empresa'

        $query

        order by
        (select id from tbl_emb_tareas where codigo=h.id_tarea limit 1)
        ";

        // echo "<br>EMB_buscalista_tareas<br>$sql";

    $database->setquery($sql);
    $database->query();
    $datos = $database->listObjects();
    return $datos;
}
function BuscaDatosReconocimientoAgradecimientos($rut, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "

        select h.*,

        (select count(id) from tbl_reconoce_gracias where tipo='GRACIAS' and estado='OK' and id_empresa='$id_empresa' and rut_destinatario='$rut') as num_gracias,
        (select count(id) from tbl_reconoce_gracias where tipo='RECONOCIMIENTO' and estado='OK' and id_empresa='$id_empresa' and rut_destinatario='$rut') as num_reconocimientos

        from tbl_reconoce_gracias h where h.estado='OK' and id_empresa='$id_empresa' and h.rut_destinatario='$rut' order by h.fecha DESC


        ";
    //echo "<br>$sql;";
    $database->setquery($sql);
    $database->query();
    $datos = $database->listObjects();
    return $datos;
}
function BuscaDatosReconocimientoAgradecimientosEquipo($rut, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "



        select h.*,
        (select count(h.id) as cuenta from tbl_reconoce_gracias h where h.tipo='GRACIAS' and h.estado='OK' and h.id_empresa='$id_empresa' and (select jefe from tbl_usuario where rut=h.rut_destinatario)='$rut') as num_gracias,
        (select count(h.id) as cuenta from tbl_reconoce_gracias h where h.tipo='RECONOCIMIENTO' and h.estado='OK' and h.id_empresa='$id_empresa' and (select jefe from tbl_usuario where rut=h.rut_destinatario)='$rut') as num_reconocimientos

        from tbl_reconoce_gracias h

        where h.estado='OK' and id_empresa='$id_empresa' and (select jefe from tbl_usuario where rut=h.rut_destinatario)='$rut'

        group by (select jefe from tbl_usuario where rut=h.rut_destinatario)='$rut'


        ";
    //echo "<br>sql<br>$sql;";
    $database->setquery($sql);
    $database->query();
    $datos = $database->listObjects();
    return $datos;
}
function BuscaUltimosIngresosBiografiasoloClick($id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "

        select h.*,

        (select nombre_completo from tbl_usuario where rut=h.rut) as nombre,
        (select cargo from tbl_usuario where rut=h.rut) as cargo,
        (select division from tbl_usuario where rut=h.rut) as division

        from tbl_usuario_biografia h where id_empresa='$id_empresa'
        and (select nombre_completo from tbl_usuario where rut=h.rut)<>''

        order by h.id DESC limit 12
        ";// echo "$sql";
    $database->setquery($sql);
    $database->query();
    $datos = $database->listObjects();
    return $datos;
}
function CuentaReconocimientosGraciasJefe($rut, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "

        select count(h.id) as cuenta

        from tbl_reconoce_gracias h

        where h.tipo='RECONOCIMIENTO'  and h.estado='OK' and id_empresa='$id_empresa'

        and h.rut_destinatario='$rut'

        order by h.fecha DESC

        ";
    $database->setquery($sql);
    $database->query();
    $datos = $database->listObjects();
    return $datos;
}
function TotalReconocimientosGraciasVistaPerfil($rut, $id_empresa, $tipo)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    if ($tipo == "") {
        $query = " and (h.rut_remitente='$rut' or h.rut_destinatario='$rut') ";
    }
    if ($tipo == "recibidos") {
        $query = " and h.rut_destinatario='$rut' ";
    }
    if ($tipo == "enviados") {
        $query = " and h.rut_remitente='$rut' ";
    }
    $sql = "

        select h.*,

        (select nombre_completo from tbl_usuario where rut=h.rut_destinatario) as nombre_destinatario,
        (select nombre_completo from tbl_usuario where rut=h.rut_remitente) as nombre_remitente,
        (select nombre_completo from tbl_usuario where rut=h.rut_jefatura) as nombre_jefatura,

        (select cargo from tbl_usuario where rut=h.rut_destinatario) as cargo_destinatario,
        (select cargo from tbl_usuario where rut=h.rut_remitente) as cargo_remitente,
        (select cargo from tbl_usuario where rut=h.rut_jefatura) as cargo_jefatura,

        (select avatar from tbl_usuario_biografia  where rut=h.rut_destinatario) as avatar_destinatario,
        (select avatar from tbl_usuario_biografia  where rut=h.rut_remitente) as avatar_remitente,

        (select departamento from tbl_usuario where rut=h.rut_destinatario) as departamento_destinatario,
        (select departamento from tbl_usuario where rut=h.rut_remitente) as departamento_remitente,
        (select departamento from tbl_usuario where rut=h.rut_jefatura) as departamento_jefatura,

        (select count(id) from tbl_reconoce_gracias where rut_destinatario=h.rut_destinatario and id_empresa='$id_empresa' and tipo='RECONOCIMIENTO' and estado='OK') AS num_reconocimientos_destinatario,
        (select count(id) from tbl_reconoce_gracias where rut_destinatario=h.rut_destinatario and id_empresa='$id_empresa' and tipo='GRACIAS' and estado='OK') AS num_gracias_destinatario,

        (select count(id) from tbl_reconoce_gracias where rut_destinatario=h.rut_remitente and id_empresa='$id_empresa' and tipo='RECONOCIMIENTO' and estado='OK') AS num_reconocimientos_rut_remitente,
        (select count(id) from tbl_reconoce_gracias where rut_destinatario=h.rut_remitente and id_empresa='$id_empresa' and tipo='GRACIAS' and estado='OK') AS num_gracias_rut_remitente

        from tbl_reconoce_gracias h

        where h.estado='OK' and id_empresa='$id_empresa'

        $query

        order by h.fecha DESC

        ";
    //echo $sql;
    $database->setquery($sql);
    $database->query();
    $datos = $database->listObjects();
    return $datos;
}
function TotalReconocimientosGraciasVistaPerfilEquipo($rut, $id_empresa, $tipo)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    if ($tipo == "") {
        $query = "

            and ( (select jefe from tbl_usuario where rut=h.rut_destinatario)='$rut'  or (select jefe from tbl_usuario where rut=h.rut_remitenteo)='$rut')

        ";
    }
    if ($tipo == "recibidos") {
        $query = " and  (select jefe from tbl_usuario where rut=h.rut_destinatario)='$rut' ";
    }
    if ($tipo == "enviados") {
        $query = " and (select jefe from tbl_usuario where rut=h.rut_remitente)='$rut' ";
    }
    $sql = "

        select h.*,

        (select nombre_completo from tbl_usuario where rut=h.rut_destinatario) as nombre_destinatario,
        (select nombre_completo from tbl_usuario where rut=h.rut_remitente) as nombre_remitente,
        (select nombre_completo from tbl_usuario where rut=h.rut_jefatura) as nombre_jefatura,

        (select cargo from tbl_usuario where rut=h.rut_destinatario) as cargo_destinatario,
        (select cargo from tbl_usuario where rut=h.rut_remitente) as cargo_remitente,
        (select cargo from tbl_usuario where rut=h.rut_jefatura) as cargo_jefatura,

        (select avatar from tbl_usuario_biografia  where rut=h.rut_destinatario) as avatar_destinatario,
        (select avatar from tbl_usuario_biografia  where rut=h.rut_remitente) as avatar_remitente,

        (select departamento from tbl_usuario where rut=h.rut_destinatario) as departamento_destinatario,
        (select departamento from tbl_usuario where rut=h.rut_remitente) as departamento_remitente,
        (select departamento from tbl_usuario where rut=h.rut_jefatura) as departamento_jefatura,

        (select count(id) from tbl_reconoce_gracias where rut_destinatario=h.rut_destinatario and id_empresa='$id_empresa' and tipo='RECONOCIMIENTO' and estado='OK') AS num_reconocimientos_destinatario,
        (select count(id) from tbl_reconoce_gracias where rut_destinatario=h.rut_destinatario and id_empresa='$id_empresa' and tipo='GRACIAS' and estado='OK') AS num_gracias_destinatario,

        (select count(id) from tbl_reconoce_gracias where rut_destinatario=h.rut_remitente and id_empresa='$id_empresa' and tipo='RECONOCIMIENTO' and estado='OK') AS num_reconocimientos_rut_remitente,
        (select count(id) from tbl_reconoce_gracias where rut_destinatario=h.rut_remitente and id_empresa='$id_empresa' and tipo='GRACIAS' and estado='OK') AS num_gracias_rut_remitente

        from tbl_reconoce_gracias h

        where h.estado='OK' and id_empresa='$id_empresa'

        $query

        order by h.fecha DESC

        ";
    //echo $sql;
    $database->setquery($sql);
    $database->query();
    $datos = $database->listObjects();
    return $datos;
}
function TotalReconocimientosGraciasJefe($rut, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "

        select h.*,

        (select nombre_completo from tbl_usuario where rut=h.rut_destinatario) as nombre_destinatario,
        (select nombre_completo from tbl_usuario where rut=h.rut_remitente) as nombre_remitente,
        (select nombre_completo from tbl_usuario where rut=h.rut_jefatura) as nombre_jefatura,

        (select cargo from tbl_usuario where rut=h.rut_destinatario) as cargo_destinatario,
        (select cargo from tbl_usuario where rut=h.rut_remitente) as cargo_remitente,
        (select cargo from tbl_usuario where rut=h.rut_jefatura) as cargo_jefatura,

        (select avatar from tbl_usuario_biografia  where rut=h.rut_destinatario) as avatar_destinatario,
        (select avatar from tbl_usuario_biografia  where rut=h.rut_remitente) as avatar_remitente,

        (select departamento from tbl_usuario where rut=h.rut_destinatario) as departamento_destinatario,
        (select departamento from tbl_usuario where rut=h.rut_remitente) as departamento_remitente,
        (select departamento from tbl_usuario where rut=h.rut_jefatura) as departamento_jefatura,
        (select count(id) from  tbl_reconoce_gracias where rut_destinatario=h.rut_destinatario and id_empresa='$id_empresa' and tipo='RECONOCIMIENTO' and estado='OK') AS num_reconocimientos,
        (select count(id) from  tbl_reconoce_gracias where rut_destinatario=h.rut_destinatario and id_empresa='$id_empresa' and tipo='GRACIAS'  and estado='OK') AS num_gracias

        from tbl_reconoce_gracias h

        where h.tipo='RECONOCIMIENTO'  and h.estado='OK' and id_empresa='$id_empresa'

        and (h.rut_remitente='$rut' or h.rut_destinatario='$rut')

        order by h.fecha DESC

        ";
    $database->setquery($sql);
    $database->query();
    $datos = $database->listObjects();
    return $datos;
}
function TotalReconocimientosGraciasJeferut($idr, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "

        select h.*,

        (select nombre_completo from tbl_usuario where rut=h.rut_destinatario) as nombre_destinatario,
        (select nombre_completo from tbl_usuario where rut=h.rut_remitente) as nombre_remitente,
        (select nombre_completo from tbl_usuario where rut=h.rut_jefatura) as nombre_jefatura,

        (select cargo from tbl_usuario where rut=h.rut_destinatario) as cargo_destinatario,
        (select cargo from tbl_usuario where rut=h.rut_remitente) as cargo_remitente,
        (select cargo from tbl_usuario where rut=h.rut_jefatura) as cargo_jefatura,

        (select avatar from tbl_usuario_biografia  where rut=h.rut_destinatario) as avatar_destinatario,
        (select avatar from tbl_usuario_biografia  where rut=h.rut_remitente) as avatar_remitente,

        (select departamento from tbl_usuario where rut=h.rut_destinatario) as departamento_destinatario,
        (select departamento from tbl_usuario where rut=h.rut_remitente) as departamento_remitente,
        (select departamento from tbl_usuario where rut=h.rut_jefatura) as departamento_jefatura,
        (select count(id) from  tbl_reconoce_gracias where rut_destinatario=h.rut_destinatario and id_empresa='$id_empresa' and tipo='RECONOCIMIENTO' and estado='OK') AS num_reconocimientos,
        (select count(id) from  tbl_reconoce_gracias where rut_destinatario=h.rut_destinatario and id_empresa='$id_empresa' and tipo='GRACIAS'  and estado='OK') AS num_gracias

        from tbl_reconoce_gracias h

        where h.id='$idr'  and h.estado='OK' and id_empresa='$id_empresa'


        order by h.fecha DESC

        ";
    $database->setquery($sql);
    $database->query();
    $datos = $database->listObjects();
    return $datos;
}
function ComunidadInsertaVideo($rut, $url)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $fecha = date("Y-m-d");
    $hora  = date("H:i:s");
    $tag   = utf8_decode($tag);
    $sql   = "INSERT INTO tbl_log_video(rut, id_mp, fecha, hora) " . "VALUES ('$rut', '$url', '$fecha', '$hora')";
    $database->setquery($sql);
    $database->query();
}
function BuscaDatosReconocimiento($idrg, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_reconoce_gracias where id_empresa='$id_empresa' and id='$idrg' ";
    //echo "BuscaDatosReconocimiento $sql";
    $database->setquery($sql);
    $database->query();
    $datos = $database->listObjects();
    return $datos;
}
 function DataChartAgradecimientos($id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select h.*,
        (select count(id) from tbl_reconoce_gracias where id_empresa='$id_empresa' and tipo='GRACIAS') as cuenta,
        (select count(id) from tbl_reconoce_gracias where id_empresa='$id_empresa' and tipo='GRACIAS' AND id_categoria=h.id_categoria) as cuentaCat,
        round(100* (select count(id) from tbl_reconoce_gracias where id_empresa='$id_empresa' and tipo='GRACIAS' AND id_categoria=h.id_categoria)
        / (select count(id) from tbl_reconoce_gracias where id_empresa='$id_empresa' and tipo='GRACIAS')) as PromCat

        from tbl_reconoce_categorias h where h.id_empresa='$id_empresa'

        order by
        round(100* (select count(id) from tbl_reconoce_gracias where id_empresa='$id_empresa' and tipo='GRACIAS' AND id_categoria=h.id_categoria)
        / (select count(id) from tbl_reconoce_gracias where id_empresa='78' and tipo='GRACIAS'))  DESC

        ";
    $database->setquery($sql);
    $database->query();
    $datos = $database->listObjects();
    return $datos;
}
function DataChartDonutAgradecimientos($id_empresa, $div)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    if($div==""){$qdiv="";}
    if($div<>""){$qdiv=" and h.agrupacion='$div' ";}

    $sql = "

    select h.categorita, count(h.id) as Cuenta

    from tbl_reconoce_gracias h where h.id_empresa='$id_empresa' and  h.tipo='GRACIAS' and estado='OK'   $qdiv

    group by h.categorita order by count(h.id) DESC

        ";  //echo $sql;
    $database->setquery($sql);
    $database->query();
    $datos = $database->listObjects();
    return $datos;
}
function DataChartDonutReco($id_empresa, $div)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    if($div==""){$qdiv="";}
    if($div<>""){$qdiv=" and h.agrupacion='$div' ";}

    $sql = "

    select h.categorita, count(h.id) as Cuenta

    from tbl_reconoce_gracias h where h.id_empresa='$id_empresa' and  h.tipo='RECONOCIMIENTO' and estado='OK'   $qdiv

    group by h.categorita order by count(h.id) DESC

        ";  //echo $sql;
    $database->setquery($sql);
    $database->query();
    $datos = $database->listObjects();
    return $datos;
}
function REC_busca_reconocidos($id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "

        select h.*,


        (select count(id) from  tbl_reconoce_gracias where rut_destinatario=h.rut_destinatario and id_empresa='$id_empresa' and tipo='RECONOCIMIENTO' and estado='OK') AS num_reconocimientos,
        (select count(id) from  tbl_reconoce_gracias where rut_destinatario=h.rut_destinatario and id_empresa='$id_empresa' and tipo='GRACIAS'  and estado='OK') AS num_gracias

        from tbl_reconoce_gracias h

        where h.tipo='RECONOCIMIENTO'  and h.estado='OK' and id_empresa='$id_empresa'

        order by h.fecha DESC

        limit 20

        ";
    $database->setquery($sql);
    $database->query();
    $datos = $database->listObjects();
    return $datos;
}



function REC_busca_reconocidos_ver($id,$id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "

        select h.*,

        (select nombre_completo from tbl_usuario where rut=h.rut_destinatario) as nombre_destinatario,
        (select nombre_completo from tbl_usuario where rut=h.rut_remitente) as nombre_remitente,
        (select nombre_completo from tbl_usuario where rut=h.rut_jefatura) as nombre_jefatura,

        (select cargo from tbl_usuario where rut=h.rut_destinatario) as cargo_destinatario,
        (select cargo from tbl_usuario where rut=h.rut_remitente) as cargo_remitente,
        (select cargo from tbl_usuario where rut=h.rut_jefatura) as cargo_jefatura,

        (select departamento from tbl_usuario where rut=h.rut_destinatario) as departamento_destinatario,
        (select departamento from tbl_usuario where rut=h.rut_remitente) as departamento_remitente,
        (select departamento from tbl_usuario where rut=h.rut_jefatura) as departamento_jefatura,
        (select count(id) from  tbl_reconoce_gracias where rut_destinatario=h.rut_destinatario and id_empresa='$id_empresa' and tipo='RECONOCIMIENTO' and estado='OK') AS num_reconocimientos,
        (select count(id) from  tbl_reconoce_gracias where rut_destinatario=h.rut_destinatario and id_empresa='$id_empresa' and tipo='GRACIAS'  and estado='OK') AS num_gracias

        from tbl_reconoce_gracias h

        where h.tipo='RECONOCIMIENTO'  and h.estado='OK' and id_empresa='$id_empresa'

        and id='$id'

        order by h.fecha DESC

        ";
    $database->setquery($sql);
    $database->query();
    $datos = $database->listObjects();
    return $datos;
}

function REC_CheckagrupacionGracias($id_empresa) {
     global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);


$sql="select * from tbl_reconoce_gracias where tipo='GRACIAS' and agrupacion is null";


    $database->setquery($sql);
    $database->query();
    $datos = $database->listObjects();
   if(count($datos)>0){
       foreach ($datos as $unico){
          //print_r($unico);
         $array_destinatario=DatosUsuario_($unico->rut_destinatario, $id_empresa);
         $division= $array_destinatario[0]->division;
         Rec_ActualizaAgrupacionGracias($unico->id, $division);
       }
   }
    //echo   count($datos); exit();
   // return $datos;


}
function Rec_ActualizaAgrupacionGracias($id, $division){

    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "

       update tbl_reconoce_gracias set agrupacion='$division' where id='$id'

        ";


    $database->setquery($sql);
    $database->query();
    $datos = $database->listObjects();
}
function REC_menu_agrupacion_division($id_empresa, $tipo_cargo)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "

       select h.division, h.nombre_division from tbl_division h where h.id_empresa='$id_empresa'

        ";

       //echo "<br>REC_menu_agrupacion<br><br>sql $sql";

    $database->setquery($sql);
    $database->query();
    $datos = $database->listObjects();
    return $datos;
}

function REC_busca_gracias_division($id_empresa, $division, $limite)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);

    if($limite>0){$limit=" limit $limite";}
    if($limite==0){$limit=" ";}
    if($division<>"")  {$div=" and h.agrupacion='$division'";}
     if($division=="")  {$div="";}

    $sql = "

        select h.*,


        (select count(id) from  tbl_reconoce_gracias where rut_destinatario=h.rut_destinatario and id_empresa='$id_empresa' and tipo='RECONOCIMIENTO' and estado='OK') AS num_reconocimientos,
        (select count(id) from  tbl_reconoce_gracias where rut_destinatario=h.rut_destinatario and id_empresa='$id_empresa' and tipo='GRACIAS'  and estado='OK') AS num_gracias

        from tbl_reconoce_gracias h

        where h.tipo='GRACIAS'  and h.estado='OK' and id_empresa='$id_empresa'

        $div
        order by h.fecha DESC, h.id DESC

        $limit

        ";

       // echo "<br><br>REC_busca_gracias_division<br><br> $sql";

    $database->setquery($sql);
    $database->query();
    $datos = $database->listObjects();
    return $datos;
}

function REC_busca_reco_division($id_empresa, $division, $limite)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);

    if($limite>0){$limit=" limit $limite";}
    if($limite==0){$limit=" ";}
    if($division<>"")  {$div=" and h.agrupacion='$division'";}
     if($division=="")  {$div="";}

    $sql = "

        select h.*,


        (select count(id) from  tbl_reconoce_gracias where rut_destinatario=h.rut_destinatario and id_empresa='$id_empresa' and tipo='RECONOCIMIENTO' and estado='OK') AS num_reconocimientos,
        (select count(id) from  tbl_reconoce_gracias where rut_destinatario=h.rut_destinatario and id_empresa='$id_empresa' and tipo='GRACIAS'  and estado='OK') AS num_gracias

        from tbl_reconoce_gracias h

        where h.tipo='RECONOCIMIENTO'  and h.estado='OK' and id_empresa='$id_empresa'

        $div
        order by h.fecha DESC, h.id DESC

        $limit

        ";

      //echo "<br><br>REC_busca_gracias_division<br><br> $sql";

    $database->setquery($sql);
    $database->query();
    $datos = $database->listObjects();
    return $datos;
}

function REC_busca_gracias_division_global($id_empresa, $division, $limite)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);

    if($limite>0){$limit=" limit $limite";}
    if($limite==0){$limit=" ";}
    if($division<>"")  {$div=" and h.agrupacion='$division'";}
     if($division=="")  {$div="";}

    $sql = "

        select h.*



        from tbl_reconoce_gracias h

        where h.tipo='GRACIAS'  and h.estado='OK' and id_empresa='$id_empresa'

        $div
        order by h.fecha DESC, h.id DESC

        $limit

        ";

       // echo "<br><br>REC_busca_gracias_division<br><br> $sql";

    $database->setquery($sql);
    $database->query();
    $datos = $database->listObjects();
    return $datos;
}
function REC_busca_reco_division_global($id_empresa, $division, $limite)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);

    if($limite>0){$limit=" limit $limite";}
    if($limite==0){$limit=" ";}
    if($division<>"")  {$div=" and h.agrupacion='$division'";}
     if($division=="")  {$div="";}

    $sql = "

        select h.*



        from tbl_reconoce_gracias h

        where h.tipo='RECONOCIMIENTO'  and h.estado='OK' and id_empresa='$id_empresa'

        $div
        order by h.fecha DESC, h.id DESC

        $limit

        ";

        //echo "<br><br>REC_busca_gracias_division<br><br> $sql";

    $database->setquery($sql);
    $database->query();
    $datos = $database->listObjects();
    return $datos;
}
function REC_busca_gracias($id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "

        select h.*,



        (select count(id) from  tbl_reconoce_gracias where rut_destinatario=h.rut_destinatario and id_empresa='$id_empresa' and tipo='RECONOCIMIENTO' and estado='OK') AS num_reconocimientos,
        (select count(id) from  tbl_reconoce_gracias where rut_destinatario=h.rut_destinatario and id_empresa='$id_empresa' and tipo='GRACIAS'  and estado='OK') AS num_gracias

        from tbl_reconoce_gracias h

        where h.tipo='GRACIAS'  and h.estado='OK' and id_empresa='$id_empresa'

        order by h.fecha DESC, h.id DESC

        ";   //echo "REC_busca_gracias ".$sql;
    $database->setquery($sql);
    $database->query();
    $datos = $database->listObjects();
    return $datos;
}
function REC_busca_reconocimientos_reco_cola($id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "

        select h.*,



        (select count(id) from  tbl_reconoce_gracias where rut_destinatario=h.rut_destinatario and id_empresa='$id_empresa' and tipo='RECONOCIMIENTO' and estado='OK') AS num_reconocimientos,
        (select count(id) from  tbl_reconoce_gracias where rut_destinatario=h.rut_destinatario and id_empresa='$id_empresa' and tipo='GRACIAS'  and estado='OK') AS num_gracias

        from tbl_reconoce_gracias h

        where h.tipo='RECONOCIMIENTO'  and h.estado='OK' and id_empresa='$id_empresa'

        order by h.fecha DESC, h.id DESC

        ";   //echo "REC_busca_reconocimientos_reco_cola ".$sql;
    $database->setquery($sql);
    $database->query();
    $datos = $database->listObjects();
    return $datos;
}
function REC_busca_gracias_carrusel($id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "

        select h.*,

        (select count(id) from  tbl_reconoce_gracias where rut_destinatario=h.rut_destinatario and id_empresa='$id_empresa' and tipo='RECONOCIMIENTO' and estado='OK') AS num_reconocimientos,
        (select count(id) from  tbl_reconoce_gracias where rut_destinatario=h.rut_destinatario and id_empresa='$id_empresa' and tipo='GRACIAS'  and estado='OK') AS num_gracias

        from tbl_reconoce_gracias h

        where h.tipo='GRACIAS'  and h.estado='OK' and id_empresa='$id_empresa'

        order by h.fecha DESC

        limit 10

        ";
        //echo $sql;
    $database->setquery($sql);
    $database->query();
    $datos = $database->listObjects();
    return $datos;
}

function REC_busca_reco_cola_carrusel($id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "

        select h.*,

        (select count(id) from  tbl_reconoce_gracias where rut_destinatario=h.rut_destinatario and id_empresa='$id_empresa' and tipo='RECONOCIMIENTO' and estado='OK') AS num_reconocimientos,
        (select count(id) from  tbl_reconoce_gracias where rut_destinatario=h.rut_destinatario and id_empresa='$id_empresa' and tipo='GRACIAS'  and estado='OK') AS num_gracias

        from tbl_reconoce_gracias h

        where h.tipo='RECONOCIMIENTO'  and h.estado='OK' and id_empresa='$id_empresa'

        order by h.fecha DESC

        limit 10

        ";
        //echo $sql;
    $database->setquery($sql);
    $database->query();
    $datos = $database->listObjects();
    return $datos;
}

function Rec_cambia_estado($rut, $val, $idrg, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select count(id)as cuenta from tbl_reconoce_gracias h where h.rut_jefatura='$rut' and h.id_empresa='$id_empresa' and h.id='$idrg'";
    $database->setquery($sql);
    $database->query();
    $datos = $database->listObjects();
    if ($datos[0]->cuenta >= 1) {
        $hoy = date("Y-m-d");
        if ($val == 1) {
            $sql = "update tbl_reconoce_gracias set estado='OK', fecha_validacion='$hoy' where id='$idrg'    ";
        } elseif ($val == 2) {
            $sql = "update tbl_reconoce_gracias set estado='RECHAZADO', fecha_validacion='$hoy' where id='$idrg'    ";
        }
        $database->setquery($sql);
        $database->query();
    }
   // echo "$sql"; sleep(5);
    return $datos;
}
function Rec_cambia_estado_Reco($rut, $val, $idrg, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select count(id)as cuenta from tbl_reconoce_gracias h where h.rut_jefatura='$rut' and h.id_empresa='$id_empresa' and h.id='$idrg'";
    $database->setquery($sql);
    $database->query();
    $datos = $database->listObjects();
    if ($datos[0]->cuenta >= 1) {
        $hoy = date("Y-m-d");
        if ($val == 1) {
            $sql = "update tbl_reconoce_gracias set estado='APROBADO', fecha_validacion='$hoy' where id='$idrg'    ";
        } elseif ($val == 2) {
            $sql = "update tbl_reconoce_gracias set estado='RECHAZADO', fecha_validacion='$hoy' where id='$idrg'    ";
        }
        $database->setquery($sql);
        $database->query();
    }
   // echo "$sql"; sleep(5);
    return $datos;
}
function Rec_busca_reconocimientos($rut, $tipo, $avalidar, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    if ($avalidar == "POR_VALIDAR") {
        $query = " h.rut_jefatura='$rut' ";
    } else {
        $query = " h.rut_remitente='$rut' ";
    }
    $sql = "

        select h.*,

    (select nombre_completo from tbl_usuario where rut=h.rut_destinatario) as nombre_destinatario,
    (select nombre_completo from tbl_usuario where rut=h.rut_remitente) as nombre_remitente,
    (select nombre_completo from tbl_usuario where rut=h.rut_jefatura) as nombre_jefatura,

    (select cargo from tbl_usuario where rut=h.rut_destinatario) as cargo_destinatario,
    (select cargo from tbl_usuario where rut=h.rut_remitente) as cargo_remitente,
    (select cargo from tbl_usuario where rut=h.rut_jefatura) as cargo_jefatura,

    (select departamento from tbl_usuario where rut=h.rut_destinatario) as departamento_destinatario,
    (select departamento from tbl_usuario where rut=h.rut_remitente) as departamento_remitente,
    (select departamento from tbl_usuario where rut=h.rut_jefatura) as departamento_jefatura



    from tbl_reconoce_gracias h

    where h.tipo='RECONOCIMIENTO' AND $query and h.estado='$tipo' and id_empresa='$id_empresa'

    order by fecha DESC, id DESC

    ";
    //echo $sql;
    $database->setquery($sql);
    $database->query();
    $datos = $database->listObjects();
    return $datos;
}
function BuscaValidacionRecoAprobadaJefe($rut,$colsend, $id_empresa){
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);

    $sql = "

        select h.*



    from tbl_reconoce_gracias h

    where h.tipo='RECONOCIMIENTO'
    AND h.rut_remitente='$rut'
    and h.rut_destinatario='$colsend'
    and h.estado='APROBADO' and id_empresa='$id_empresa'
    limit 1

    ";
    //echo $sql;
    $database->setquery($sql);
    $database->query();
    $datos = $database->listObjects();
    return $datos;
}
function Rec_busca_reconocimientos_landing($rut, $tipo, $avalidar, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    if ($avalidar == "POR_VALIDAR") {
        $query = " h.rut_jefatura='$rut' ";
    } else {
        $query = " h.rut_remitente='$rut' ";
    }
    $sql = "

        select h.*,

    (select nombre_completo from tbl_usuario where rut=h.rut_destinatario) as nombre_destinatario,
    (select nombre_completo from tbl_usuario where rut=h.rut_remitente) as nombre_remitente,
    (select nombre_completo from tbl_usuario where rut=h.rut_jefatura) as nombre_jefatura,

    (select cargo from tbl_usuario where rut=h.rut_destinatario) as cargo_destinatario,
    (select cargo from tbl_usuario where rut=h.rut_remitente) as cargo_remitente,
    (select cargo from tbl_usuario where rut=h.rut_jefatura) as cargo_jefatura,

    (select departamento from tbl_usuario where rut=h.rut_destinatario) as departamento_destinatario,
    (select departamento from tbl_usuario where rut=h.rut_remitente) as departamento_remitente,
    (select departamento from tbl_usuario where rut=h.rut_jefatura) as departamento_jefatura



    from tbl_reconoce_gracias h

    where h.tipo='RECONOCIMIENTO' AND $query and h.estado='$tipo' and id_empresa='$id_empresa'

    order by fecha DESC, id DESC

    ";
    //echo $sql;
    $database->setquery($sql);
    $database->query();
    $datos = $database->listObjects();
    return $datos;
}
function BuscaJefeDadoRut($rut, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select h.jefe from tbl_usuario h where h.rut='$rut' and h.id_empresa='$id_empresa'";
    $database->setquery($sql);
    $database->query();
    $datos = $database->listObjects();
    return $datos;
}
function Rec_Busca_reconocimientos_Disponibles($rut, $id_empresa)
{
    //echo "id_subcat $id_subcat, $rut, $id_empresa";
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "

    select sum(h.rec_disponibles)  as otorgados,
    (select count(id) from tbl_reconoce_gracias where tipo='RECONOCIMIENTO' AND rut_remitente='$rut' and estado='OK') as cuenta_gastados,
    (select count(id) from tbl_reconoce_gracias where tipo='RECONOCIMIENTO' AND rut_remitente='$rut' and estado='POR_VALIDAR') as cuenta_pendientes,
    (select count(id) from tbl_reconoce_gracias where tipo='RECONOCIMIENTO' AND rut_jefatura='$rut' and estado='POR_VALIDAR') as porvalidar,
    (sum(h.rec_disponibles)-(select count(id) from tbl_reconoce_gracias where tipo='RECONOCIMIENTO' AND rut_remitente='$rut' and estado<>'RECHAZADO')) as saldo
    from tbl_reconoce_rec_disponibles h where h.rut='$rut' and h.id_empresa='$id_empresa'

    ";
    //echo $sql;
    $database->setquery($sql);
    $database->query();
    $datos = $database->listObjects();
    return $datos;
}

function Rec_Busca_Puntos_Disponibles($rut, $id_empresa)
{
    //echo "id_subcat $id_subcat, $rut, $id_empresa";
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "

         SELECT
         sum(h.puntos) AS Puntos_Recibidos,
        (select sum(puntos) from tbl_premios_puntos_usuarios_jefe_entregados where rut=h.rut and id_empresa=h.id_empresa) as Puntos_Repartidos

        FROM
            tbl_premios_puntos_usuarios_jefe h
        WHERE
             h.rut = '$rut'
            AND h.id_empresa = '$id_empresa'

    ";
    //echo $sql;
    $database->setquery($sql);
    $database->query();
    $datos = $database->listObjects();
    return $datos;
}

function ValidarSesionMP($id_subcat, $rut, $id_empresa)
{
    //echo "id_subcat $id_subcat, $rut, $id_empresa";
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select h.*,
    (select count(id) from tbl_mp_rel_rut_grupo where rut='$rut' and id_grupointeres=h.id_subcategoria) as activo
    from tbl_mp_gruposinteres h where h.id_empresa='$id_empresa' and h.id_subcategoria='$id_subcat'";
    $database->setquery($sql);
    $database->query();
    $datos = $database->listObjects();
    return $datos;
}
function com_mp_grupos_interes_subcategorias($rut, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select h.*,
    (select count(id) from tbl_mp_rel_rut_grupo where rut='$rut' and id_grupointeres=h.id_subcategoria) as activo
    from tbl_mp_gruposinteres h where h.id_empresa='$id_empresa'
    and (select count(id) from tbl_mp_rel_rut_grupo where rut='$rut' and id_grupointeres=h.id_subcategoria)>=1
    ";
    //echo "<br><br><br>$sql";
    $database->setquery($sql);
    $database->query();
    $datos = $database->listObjects();
    return $datos;
}
function Datos_grupos_interes($id_grupo_interes, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select h.*

    from tbl_mp_gruposinteres h where h.id_empresa='$id_empresa'    and h.id_subcategoria='$id_grupo_interes'
    ";
    //echo "<br><br><br>$sql";
    $database->setquery($sql);
    $database->query();
    $datos = $database->listObjects();
    return $datos;
}
function Emb_registro_Tareas($rut, $id_tarea, $link, $lider1, $lider2, $lider3, $lider4, $lider5, $id_empresa, $comentarios)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $tag = utf8_decode($tag);
    $hoy = date("Y-m-d");
    $sql = "INSERT INTO tbl_emb_respuestas_embajadores_tareas
    (rut, id_tarea, id_empresa, fecha_inicio, fecha_registro, link, comentarios, estado, fecha_validacion, lider1, lider2, lider3, lider4, lider5) " . "values ('$rut', '$id_tarea', '$id_empresa', '$fecha_inicio', '$hoy',
    '$link', '$comentarios', '$estado', '$fecha_validacion', '$lider1', '$lider2', '$lider3', '$lider4', '$lider5')";
    $database->setquery($sql);
    $database->query();
}


function operaciones2020_saveComent($rut,$id_empresa,$save_comment,$dimension,$comentario)
 {
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $tag = utf8_decode($tag);
    $fecha = date("Y-m-d");
    $hora = date("H:m:s");
    $sql = "INSERT INTO tbl_comentarios_interacciones
    (comentario,tipo,rut,dimension,fecha,hora)
    " . "values ('$comentario', 'COMENTARIO', '$rut', '$dimension', '$fecha','$hora')";
    $database->setquery($sql);
    $database->query();
}

function operaciones2020_Coment($rut, $tipo, $dimension, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select h.*, (select nombre_completo from tbl_usuario where rut=h.rut) as nombre_completo
    from tbl_comentarios_interacciones h
    where tipo='$tipo' and    dimension='$dimension' order by id DESC
    ";
    //echo "<br><br><br>$sql";
    $database->setquery($sql);
    $database->query();
    $datos = $database->listObjects();
    return $datos;
}

function emb_busca_tareas_embajador($rut, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "

    select h.*,
    (select nombre from tbl_emb_tareas where codigo=h.id_tarea limit 1) as tarea,
    (select descripcion from tbl_emb_tareas where codigo=h.id_tarea limit 1) as tareadescripcion,
    (select link_material from tbl_emb_tareas where codigo=h.id_tarea limit 1) as link,
    (select accion from tbl_emb_tareas where codigo=h.id_tarea limit 1) as accion,
    (select descripcion_accion from tbl_emb_tareas where codigo=h.id_tarea limit 1) as descripcion_accion,
    (select duracion from tbl_emb_tareas where codigo=h.id_tarea limit 1) as duracion,

    (select fecha_registro from tbl_emb_respuestas_embajadores_tareas where rut=h.rut and id_tarea=h.id_tarea  limit 1) as fecha_registro,
    (select link from tbl_emb_respuestas_embajadores_tareas where rut=h.rut and id_tarea=h.id_tarea limit 1) as link_registro,
    (select comentarios from tbl_emb_respuestas_embajadores_tareas where rut=h.rut and id_tarea=h.id_tarea limit 1) as comentarios_registro,
    (select fecha_validacion from tbl_emb_respuestas_embajadores_tareas where rut=h.rut and id_tarea=h.id_tarea limit 1) as fecha_validacion_registro,

    (select lider1 from tbl_emb_respuestas_embajadores_tareas where rut=h.rut and id_tarea=h.id_tarea limit 1) as lider1,
    (select lider2 from tbl_emb_respuestas_embajadores_tareas where rut=h.rut and id_tarea=h.id_tarea limit 1) as lider2,
    (select lider3 from tbl_emb_respuestas_embajadores_tareas where rut=h.rut and id_tarea=h.id_tarea limit 1) as lider3,
    (select lider4 from tbl_emb_respuestas_embajadores_tareas where rut=h.rut and id_tarea=h.id_tarea limit 1) as lider4,
    (select lider5 from tbl_emb_respuestas_embajadores_tareas where rut=h.rut and id_tarea=h.id_tarea limit 1) as lider5,

    (select nombre_completo from tbl_usuario where rut=(select lider1 from tbl_emb_respuestas_embajadores_tareas where rut=h.rut and id_tarea=h.id_tarea limit 1)) as nombrelider1,
    (select nombre_completo from tbl_usuario where rut=(select lider2 from tbl_emb_respuestas_embajadores_tareas where rut=h.rut and id_tarea=h.id_tarea limit 1)) as nombrelider2,
    (select nombre_completo from tbl_usuario where rut=(select lider3 from tbl_emb_respuestas_embajadores_tareas where rut=h.rut and id_tarea=h.id_tarea limit 1)) as nombrelider3,
    (select nombre_completo from tbl_usuario where rut=(select lider4 from tbl_emb_respuestas_embajadores_tareas where rut=h.rut and id_tarea=h.id_tarea limit 1)) as nombrelider4,
    (select nombre_completo from tbl_usuario where rut=(select lider5 from tbl_emb_respuestas_embajadores_tareas where rut=h.rut and id_tarea=h.id_tarea limit 1)) as nombrelider5


    from tbl_emb_rel_embajadores_tareas h where h.rut='$rut' and h.id_empresa='$id_empresa'

    ";
    $database->setquery($sql);
    $database->query();
    $datos = $database->listObjects();
    return $datos;
}
function buscar_email_clave($email)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select h.rut, h.nombre_completo, h.email, h.id_empresa, (select clave from tbl_clave where rut=h.rut limit 1) as clave from tbl_usuario h where h.email='$email' limit 1";
    //echo $sql;
    $database->setquery($sql);
    $database->query();
    $datos = $database->listObjects();
    return $datos;
}
function contarObjetosCurso($id_curso, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select count(id) as cuenta from tbl_objeto where id_curso='$id_curso' and id_empresa='$id_empresa'";
    //echo $sql;
    $database->setquery($sql);
    $database->query();
    $datos = $database->listObjects();
    return $datos;
}
function contarObjetosCursoCMdirector($id_curso, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select count(id) as cuenta from tbl_objeto where id_curso='$id_curso' and cm='directoaobjeto' and id_empresa='$id_empresa'";
    //echo $sql;
    $database->setquery($sql);
    $database->query();
    $datos = $database->listObjects();
    return $datos;
}
function busca_expertos_ambito($id_ambito, $id_empresa, $id_subcategoria)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    if ($id_subcategoria <> '') {
        $quer_idsub = " and id_subcategoria='$id_subcategoria' ";
    } else {
        $quer_idsub = " and id_subcategoria is null ";
    }
    $sql = "select h.*, (select email from tbl_usuario where rut=h.rut) as email, (select nombre_completo from tbl_usuario where rut=h.rut) as nombre

    from tbl_mp_expertos h
    where h.id_empresa='$id_empresa' and h.id_ambito='$id_ambito' $quer_idsub

    ";
    //echo $sql;
    $database->setquery($sql);
    $database->query();
    $datos = $database->listObjects();
    return $datos;
}
function nombre_ambitoMP($idamb, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select ambito from tbl_mp_ambitos where id_ambito='$idamb' and id_empresa='$id_empresa' limit 1";
    //echo $sql;
    $database->setquery($sql);
    $database->query();
    $datos = $database->listObjects();
    return $datos;
}
function UsuarioPorDepartamento($id_empresa, $codigo_departamento)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select rut, nombre_completo from tbl_usuario where departamento='$codigo_departamento' and id_empresa='$id_empresa' order by nombre_completo ASC";

    //echo $sql; exit();
    $database->setquery($sql);
    $database->query();
    $datos = $database->listObjects();
    return $datos;
}
function allCuiData($buscar, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "SELECT distinct(area) FROM tbl_usuario
    WHERE id_empresa='$id_empresa'
    and id_gerencia='$buscar'
    and vigencia='0'
    ORDER BY area";
    $database->setquery($sql);
    $database->query();
    $datos = $database->listObjects();
    return $datos;
}

function allCuiOficData($buscar, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "SELECT sucursal, id_gerencia FROM tbl_usuario
    WHERE id_empresa='$id_empresa'
    and id_gerencia='$buscar'
    and vigencia='0'   group by  id_gerencia          limit 1
   ";

    // echo "sql $sql";
    $database->setquery($sql);
    $database->query();
    $datos = $database->listObjects();    //print_r($datos);
    return $datos;
}

function TraigoDato9DadoDato13($dato_13)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select distinct(dato9) as valor, dato7 as nombre from tbl_dash_full_personas  where dato13='$dato_13'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return ($cod);
}
function TraigoDato138DadoDato13($dato_13)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select distinct(dato138) as valor, dato10 as nombre from tbl_dash_full_personas  where dato13='$dato_13'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return ($cod);
}
function TraigoDato13DadoDato9($dato_9, $dato_138)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    if ($dato_138 <> "") {
        $filtro_138 = " and dato138='$dato_138'";
    }
    $sql = "select distinct(dato13) as valor, dato12 as nombre  from tbl_dash_full_personas  where dato9='$dato_9' $filtro_138 ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return ($cod);
}
function TraigoDato138DadoDato9($dato_9)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select distinct(dato138) as valor, dato10 as nombre from tbl_dash_full_personas  where dato9='$dato_9'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return ($cod);
}
function TraigoDato9DadoDato138($dato_138)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select distinct(dato9) as valor, dato7 as nombre from tbl_dash_full_personas  where dato138='$dato_138'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return ($cod);
}
function TraigoDato13DadoDato138($dato_138)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select distinct(dato13) as valor, dato12 as nombre  from tbl_dash_full_personas  where dato138='$dato_138'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return ($cod);
}
function VerificoPerfilamentoDeBibliotecaUsuario($id_categoria, $id_empresa, $rut)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_biblio_perfilamiento where id_categoria='$id_categoria' and id_empresa='$id_empresa' and rut='$rut'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return ($cod);
}
function VerificoPerfilamentoDeBiblioteca($id_categoria, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_biblio_perfilamiento where id_categoria='$id_categoria' and id_empresa='$id_empresa'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return ($cod);
}

function BuscaIdCursoIdInscripcionHistoricos($id_inscripcion){
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);

    $sql="select
(select nombre from tbl_lms_curso where id=h.id_curso) as curso,
(select numero_horas from tbl_lms_curso where id=h.id_curso) as numero_horas,
h.fecha_inicio, h.fecha_termino from tbl_inscripcion_curso h where h.codigo_inscripcion='$id_inscripcion'";

    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return ($cod);


}


function VistaCursosHistoricosData($rut, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select h.id_inscripcion, h.id_curso,

    (select fecha_inicio from tbl_inscripcion_curso where codigo_inscripcion= h.id_inscripcion limit 1) as fecha_inicio,
    (select fecha_termino from tbl_inscripcion_curso where codigo_inscripcion= h.id_inscripcion limit 1) as fecha_termino,
    (select ejecutivo from tbl_inscripcion_curso where codigo_inscripcion= h.id_inscripcion limit 1) as ejecutivo,
    (select modalidad from tbl_lms_curso where id= h.id_curso limit 1) as modalidad,
    (select estado_descripcion from tbl_inscripcion_cierre where id_inscripcion= h.id_inscripcion and rut=h.rut limit 1) as estado,
    (select nota from tbl_inscripcion_cierre where id_inscripcion= h.id_inscripcion and rut=h.rut limit 1) as nota,
    (select avance from tbl_inscripcion_cierre where id_inscripcion= h.id_inscripcion and rut=h.rut limit 1) as avance,

(select estado_descripcion from tbl_inscripcion_cierre where id_curso= h.id_curso and rut=h.rut limit 1) as estado2,
(select nota from tbl_inscripcion_cierre where id_curso= h.id_curso and rut=h.rut limit 1) as nota2,
(select avance from tbl_inscripcion_cierre where id_curso= h.id_curso and rut=h.rut limit 1) as avance2,



    (select nombre from tbl_lms_curso where id= h.id_curso limit 1) as curso

    from tbl_inscripcion_usuarios h where h.rut='$rut' and h.id_empresa='$id_empresa'

    order by (select fecha_termino from tbl_inscripcion_curso where codigo_inscripcion= h.id_inscripcion) DESC";
    // echo $sql;
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return ($cod);
}


function VistaCursosLmsReporte_Certificado_Data($rut, $id_empresa, $id_modalidad)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);

    if($id_modalidad<>''){$sqlMod=" and (select modalidad from tbl_lms_curso where id=h.id_curso) ='$id_modalidad' ";} else {
      $sqlMod=" ";
    }

    if($id_empresa=="61"){
        $query_sacar=" and h.id_curso  NOT LIKE '%rf_cert%' ";
    } else if($id_empresa=="75"){
        $query_sacar=" and h.id_curso  NOT LIKE '%cla_csc%' ";
    }   else {
        $query_sacar=" ";
    }

    $sql = "select h.*,

(
        SELECT
            estado
        FROM
            tbl_lms_reportes
        WHERE
            id_curso = h.id_curso
and rut=h.rut and h.estado<>'' limit 1
    ) AS estado_reportes,
(SELECT id_programa FROM tbl_lms_reportes WHERE id_curso = h.id_curso and rut=h.rut  limit 1) AS id_programa,
(SELECT nombre_programa FROM tbl_lms_programas_bbdd WHERE id_programa = (SELECT id_programa FROM tbl_lms_reportes WHERE id_curso = h.id_curso and rut=h.rut  limit 1) limit 1) AS programa,

    (select modalidad from tbl_lms_curso where id=h.id_curso) as modalidad,
    (select nombre from tbl_lms_curso where id=h.id_curso) as curso,
    (select fecha from tbl_objetos_finalizados where rut=h.rut and id_curso=h.id_curso order by fecha DESC limit 1) as fecha_Curso,
    (select fecha from tbl_objetos_finalizados where rut=h.rut and id_curso=h.id_curso and id_inscripcion=h.id_inscripcion order by fecha DESC limit 1) as fecha_Curso_Id_Inscripcion,
    (select fecha from tbl_evaluaciones_respuestas_intentos where rut=h.rut and id_inscripcion=h.id_inscripcion order by fecha DESC limit 1) as fecha_Curso_Id_Inscripcion_respuestas

    from tbl_inscripcion_cierre h

    where h.id_empresa='$id_empresa' and h.rut='$rut'
    $sqlMod
    $query_sacar";

    //echo $sql;
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return ($cod);
}

function VistaCursosHistoricosResumenData($rut, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select h.id_inscripcion, h.id_curso,

    (select fecha_inicio from tbl_inscripcion_curso where codigo_inscripcion= h.id_inscripcion limit 1) as fecha_inicio,
    (select fecha_termino from tbl_inscripcion_curso where codigo_inscripcion= h.id_inscripcion limit 1) as fecha_termino,
    (select ejecutivo from tbl_inscripcion_curso where codigo_inscripcion= h.id_inscripcion limit 1) as ejecutivo,
    (select modalidad from tbl_lms_curso where id= h.id_curso limit 1) as modalidad,
    (select estado_descripcion from tbl_inscripcion_cierre where id_inscripcion= h.id_inscripcion and rut=h.rut limit 1) as estado,
    (select nota from tbl_inscripcion_cierre where id_inscripcion= h.id_inscripcion and rut=h.rut limit 1) as nota,
    (select avance from tbl_inscripcion_cierre where id_inscripcion= h.id_inscripcion and rut=h.rut limit 1) as avance,

(select estado_descripcion from tbl_inscripcion_cierre where id_curso= h.id_curso and rut=h.rut limit 1) as estado2,
(select nota from tbl_inscripcion_cierre where id_curso= h.id_curso and rut=h.rut limit 1) as nota2,
(select avance from tbl_inscripcion_cierre where id_curso= h.id_curso and rut=h.rut limit 1) as avance2,



    (select nombre from tbl_lms_curso where id= h.id_curso limit 1) as curso

    from tbl_inscripcion_usuarios h where h.rut='$rut' and h.id_empresa='$id_empresa'

    order by (select fecha_termino from tbl_inscripcion_curso where codigo_inscripcion= h.id_inscripcion) DESC";
    //echo $sql;
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return ($cod);
}


function VistaCursosHistoricosDataIdCurso($rut, $id_curso, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select h.id_inscripcion, h.id_curso,

    (select fecha_inicio from tbl_inscripcion_curso where codigo_inscripcion= h.id_inscripcion) as fecha_inicio,
    (select fecha_termino from tbl_inscripcion_curso where codigo_inscripcion= h.id_inscripcion) as fecha_termino,
    (select ejecutivo from tbl_inscripcion_curso where codigo_inscripcion= h.id_inscripcion) as ejecutivo,
    (select modalidad from tbl_lms_curso where id= h.id_curso) as modalidad,
    (select fecha_termino from tbl_lms_reportes where id_curso= h.id_curso and rut=h.rut) as fecha_termino_reportes,
    (select estado_descripcion from tbl_inscripcion_cierre where id_inscripcion= h.id_inscripcion and rut=h.rut) as estado,
    (select nota from tbl_inscripcion_cierre where id_inscripcion= h.id_inscripcion and rut=h.rut) as nota,
    (select avance from tbl_inscripcion_cierre where id_inscripcion= h.id_inscripcion and rut=h.rut) as avance,
    (select nombre from tbl_lms_curso where id= h.id_curso) as curso

    from tbl_inscripcion_usuarios h where h.rut='$rut' and h.id_empresa='$id_empresa' and h.id_curso='$id_curso'

    order by (select fecha_termino from tbl_inscripcion_curso where codigo_inscripcion= h.id_inscripcion) DESC";
    //echo $sql;
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return ($cod);
}

function Ro_escuela_busca_cursosmalla($id_malla, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select id_curso from rel_lms_malla_curso where id_malla='$id_malla' and id_empresa='$id_empresa' ";
    //echo $sql;
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return ($cod);
}
function DatosInscripcioncierreRutCursoEmpresaPorInscripcion($rut, $id_curso, $id_empresa, $id_inscripcion)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_inscripcion_cierre where rut='$rut' and id_curso='$id_curso' and id_empresa='$id_empresa' and id_inscripcion='$id_inscripcion'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return ($cod);
}
function ActualizaPorcentajeAsistenciaDesdeSesiones($rut, $id_empresa, $id_curso, $porcentaje_asistencia, $id_inscripcion)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "update tbl_inscripcion_cierre
    set  porcentaje_asistencia='$porcentaje_asistencia'

    where rut='$rut' and id_curso='$id_curso' and id_empresa='$id_empresa' and id_inscripcion='$id_inscripcion'     ";
    $database->setquery($sql);
    $database->query();
}
function InsertaRegistroCierreDesdeSesiones($id_empresa, $rut, $id_curso, $porcentaje_asistencia, $id_inscripcion)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $tag = utf8_decode($tag);
    $sql = "INSERT INTO tbl_inscripcion_cierre(rut, id_curso, id_empresa, porcentaje_asistencia, id_inscripcion) " . "VALUES ('$rut', '$id_curso', '$id_empresa', '$porcentaje_asistencia', '$id_inscripcion')";
    $database->setquery($sql);
    $database->query();
}
function TotalDeSesionesCheckeadasPorInscripcionCursoEmpresaRut($id_empresa, $id_inscripcion, $rut)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "   select * from rel_lms_inscripcion_usuario_checkin where id_empresa='$id_empresa' and codigo_imparticion='$id_inscripcion'  and rut='$rut'   ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TotalDeSesionesPorInscripcionCursoEmpresa($id_empresa, $id_inscripcion)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "   select * from rel_lms_inscripcion_sesion where id_empresa='$id_empresa' and codigo_inscripcion='$id_inscripcion'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function VerificaDesafioEnAccionesPendientes($rut_colaborador, $id_empresa, $id_curso, $id_objeto)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "

    select * from tbl_lms_acciones_pendientes
    where rut_colaborador='$rut_colaborador' and id_curso='$id_curso' and id_objeto='$id_objeto' and id_empresa='$id_empresa'

    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ACtualizaAccionesPendientesEstado($id_curso, $id_objeto, $id_empresa, $estado, $rut_colaborador)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "update tbl_lms_acciones_pendientes
    set  estado='$estado'

    where rut_colaborador='$rut_colaborador' and id_curso='$id_curso' and id_empresa='$id_empresa' and id_objeto='$id_objeto'    ";
    $database->setquery($sql);
    $database->query();
}
function BuscaBioCarrouselUsuario($rut, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "

    select rut_destinatario as rut, mensaje as texto from tbl_reconoce_gracias  where rut_destinatario='$rut'
    UNION
    select rut as rut, biografia as texto from tbl_usuario_biografia where rut='$rut'
    UNION
    select rut as rut, sueno as texto from tbl_usuario_biografia where rut='$rut'
    UNION
    select rut as rut, logros as texto from tbl_usuario_biografia where rut='$rut'

    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}

function ValidaJefeDirecto($rut_destinatario,$rut_remitente,$id_empresa){

    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql="select jefe from tbl_usuario where rut='$rut_destinatario' and id_empresa='$id_empresa'";
     $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();


    if($cod[0]->jefe==$rut_remitente){
    return 1;}
    else {
    return 0;
    }

}

function Rec_Inserta_Reconocimiento($rut_remitente, $rut_destinatario, $id_categoria, $categoria, $fecha, $hora, $id_empresa, $tipo, $puntos, $mensaje, $rut_jefatura, $estado)
{
    //echo "$rut_remitente,$rut_destinatario,$categoria,$fecha,$hora,$id_empresa,$tipo,$puntos,$mensaje, $rut_jefatura, $estado";
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $mensaje = utf8_decode($mensaje);
    $categoria=                      utf8_decode($categoria);
    $sql     = "INSERT INTO tbl_reconoce_gracias (rut_remitente,rut_destinatario,id_categoria,categorita,fecha,hora,id_empresa,tipo,puntos,mensaje,estado,rut_jefatura)

    VALUES ('$rut_remitente', '$rut_destinatario', '$id_categoria','$categoria', '$fecha','$hora', '$id_empresa','$tipo', '$puntos','$mensaje','$estado','$rut_jefatura')";
//    echo $sql; sleep(5);
    $database->setquery($sql);
    $database->query();




$sql ="Select id from tbl_reconoce_gracias where rut_remitente='$rut_remitente' and rut_destinatario='$rut_destinatario' and id_empresa='$id_empresa' order by id DESC limit 1";


      $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();

    return $cod[0]->id;

}
function Rec_Inserta_Reconocimiento_pendiente($rut_remitente, $rut_destinatario, $id_categoria, $categoria, $fecha, $hora, $id_empresa, $tipo, $puntos, $mensaje, $rut_jefatura, $estado)
{
        //echo "$rut_remitente,$rut_destinatario,$categoria,$fecha,$hora,$id_empresa,$tipo,$puntos,$mensaje, $rut_jefatura, $estado";
        global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);
        $mensaje = utf8_decode($mensaje);
        $categoria=                      utf8_decode($categoria);

$sql ="Select id from tbl_reconoce_gracias where rut_remitente='$rut_remitente' and rut_destinatario='$rut_destinatario' and id_empresa='$id_empresa' order by id DESC limit 1";
        $database->setquery($sql);
        $database->query();
        $cod2 = $database->listObjects();

print_r($cod2);

if($cod2[0]->id>0){
        $sql     = "update tbl_reconoce_gracias set estado='PENDIENTE' where  rut_remitente='$rut_remitente' and rut_destinatario='$rut_destinatario' and id_empresa='$id_empresa' and estado<>'OK'";

}   else {
        $sql     = "INSERT INTO tbl_reconoce_gracias (rut_remitente,rut_destinatario,id_categoria,categorita,fecha,hora,id_empresa,tipo,puntos,mensaje,estado,rut_jefatura)

        VALUES ('$rut_remitente', '$rut_destinatario', '$id_categoria','$categoria', '$fecha','$hora', '$id_empresa','$tipo', 'PENDIENTE','$mensaje','$estado','$rut_jefatura')";

}

  echo $sql;// exit();
        $database->setquery($sql);
        $database->query();






            $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();

        return $cod[0]->id;

}
function Rec_borra_jefe_entregado($idrg, $id_empresa) {

        global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);


        $sql     = "delete  from  tbl_premios_puntos_usuarios_jefe_entregados

        where id_reconoce_gracias='$idrg' and id_empresa='$id_empresa'";
    // echo $sql; sleep(3);
        $database->setquery($sql);
        $database->query();

}

function Rec_Inserta_Puntos($rut_remitente, $rut_destinatario, $fecha, $puntos, $tipo, $descripcion,  $id_reco, $id_empresa )
{
   // echo "<br>Rec_Inserta_Puntos $rut_remitente, $rut_destinatario, $fecha, $puntos, $tipo, $descripcion,  $id_reco, $id_empresa";
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $mensaje = utf8_decode($mensaje);

    $tipo=utf8_decode($tipo);
    $descripcion=utf8_decode($descripcion);

    $sql     = "INSERT INTO tbl_premios_puntos_usuarios_jefe_entregados (rut, rut_col, fecha, puntos, tipo, descripcion, id_empresa,id_reconoce_gracias)
                VALUES ('$rut_remitente', '$rut_destinatario', '$fecha','$puntos', '$tipo', '$descripcion','$id_empresa','$id_reco')";
   //echo "<br>Rec_Inserta_Puntos ".$sql;
    $database->setquery($sql);
    $database->query();



}

function Rec_Inserta_Puntos_bancopuntos($rut_remitente, $rut_destinatario, $fecha, $puntos, $tipo, $descripcion,$id_reco,  $id_empresa)
{
    //echo "$rut_remitente,$rut_destinatario,$categoria,$fecha,$hora,$id_empresa,$tipo,$puntos,$mensaje, $rut_jefatura, $estado";
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $mensaje = utf8_decode($mensaje);

    $tipo=utf8_decode($tipo);
    $descripcion=utf8_decode($descripcion);


    $sql     = "INSERT INTO tbl_premios_puntos_usuarios (rut, fecha, puntos, tipo, descripcion, id_empresa, id_reconoce_gracias)
                VALUES ('$rut_destinatario', '$fecha','$puntos', '$tipo', '$descripcion','$id_empresa', '$id_reco')";
    //echo "<br>Rec_Inserta_Puntos_bancopuntos".$sql;
    $database->setquery($sql);
    $database->query();


}


function TraePalabraSqlInjection()
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_sql_injection";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function buscaPalabraSqlInjection($palabra)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_sql_injection where palabra='$palabra' or palabra like '%$palabra%'";
    //echo "buscaPalabraSqlInjection<br>";

    //echo $sql;
    //echo "<br>";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function MP_BuscaTemplate($rut, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    //echo $_SESSION["template"];
    $sql = "select * from tbl_mp_template where rut='$rut' and id_empresa='$id_empresa'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    if ($_SESSION["template"] <> '') {
        $cod[0]->template = $_SESSION["template"];
    }
    return $cod;
}
function TraigoObjetoCertificacionDadoCurso($id_curso, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "   select * from tbl_objeto where id_curso='$id_curso' and id_empresa='$id_empresa' and tipo_objeto='5' and opcional='0' and (cm is null or cm='')";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ComentariosPorObjetoPorColaborador($id_objeto, $rut_colaborador)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
    select tbl_objeto_comentarios.*, tbl_usuario.nombre_completo as nombre_persona
    from tbl_objeto_comentarios
    inner join tbl_usuario
    on tbl_usuario.rut=tbl_objeto_comentarios.rut
    where
    id_objeto='$id_objeto' and rut_colaborador='$rut_colaborador'
    order by tbl_objeto_comentarios.id desc
    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function EVALUACION_PreguntasDadoIdObjeto($id_objeto)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "SELECT

    tbl_evaluaciones_preguntas.*

    FROM

    tbl_evaluaciones_preguntas
    INNER JOIN tbl_objeto on tbl_evaluaciones_preguntas.evaluacion = tbl_objeto.id_evaluacion
    WHERE    tbl_objeto.id ='$id_objeto'    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function EVALUACION_PreguntasDadoIdObjetoaleatorio($id_objeto, $rut)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "SELECT

    tbl_evaluaciones_preguntas.*

    FROM

    tbl_evaluaciones_asociacion_preguntas_usuario

    inner join tbl_evaluaciones_preguntas

    on tbl_evaluaciones_preguntas.id=tbl_evaluaciones_asociacion_preguntas_usuario.id_pregunta



    INNER JOIN tbl_objeto
    on tbl_evaluaciones_preguntas.evaluacion = tbl_objeto.id_evaluacion
    and tbl_objeto.id_empresa='" . $_SESSION["id_empresa"] . "'
    and tbl_objeto.id='$id_objeto'
    and tbl_evaluaciones_preguntas.tipo<>'7'

    WHERE

    tbl_evaluaciones_asociacion_preguntas_usuario.id_objeto ='$id_objeto' and tbl_evaluaciones_asociacion_preguntas_usuario.rut ='$rut'



    ";
    //echo $sql;Exit;
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function LMSMallaEcuelaBP($rut, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select id_malla from rel_lms_malla_persona where rut='$rut' and id_malla like '%bci_escbp_o%' and id_empresa='$id_empresa'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return ($cod);
}
function mp_verificaquesoy_experto($rut, $id_empresa, $subcategoria)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    if ($subcategoria <> '') {
        $queryidsub = " and template='" . $subcategoria . "' ";
    } else {
        $queryidsub = " ";
    }
    $sql = "SELECT count(id) as cuenta FROM tbl_mp_expertos WHERE `rut` = '$rut' and id_empresa='$id_empresa' $queryidsub";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return ($cod);
}
function mp_num_preguntas_sincontestar($rut, $id_empresa, $subcategoria)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    if ($subcategoria <> '') {
        $queryidsub = " and h.id_subcategoria='" . $subcategoria . "' ";
    } else {
        $queryidsub = " and h.id_subcategoria='' ";
    }
    $sql = "SELECT count(h.id) as cuenta FROM tbl_mp h WHERE h.tipo='Pregunta' and h.id_empresa='$id_empresa'
    and (select count(id) from tbl_mp_expertos where rut='$rut' and id_ambito=h.id_ambito)>0
    $queryidsub  and h.id_estado>=5";
    //echo $sql;
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return ($cod);
}
function SaveLogEmails($id_empresa, $tipo, $subject, $to, $nombreto, $fecha, $statusCode, $headers, $response, $tipomensaje, $rut, $key)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $nuevo_id  = $ultimo_id[0]->id;
    $nuevo_id  = $nuevo_id + 1;
    $codigo    = $id_empresa . "_mp" . $nuevo_id;
    //".json_encode($statusCode)."
    //".json_encode($headers)."
    //".json_encode($response)."
    //".json_encode($to)."
    //".json_encode($subject)."
    $sql       = "INSERT INTO tbl_log_emails (
    tipo, asunto,
    rut,  id_empresa,
    fecha, statusCode,
    headers, body,dato, email) " . "VALUES  (
    '$tipomensaje', '',
    '$rut','$id_empresa',
    '$fecha','',
    '','',
    '$key', '')";



    $database->setquery($sql);
    $database->query();
}

function FiltroCuiAgenda($id_empresa) {
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);

    $sql="select * from tbl_eventos where id_empresa='$id_empresa' and nombre<>''  group by nombre order by nombre ASC";

    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return ($cod);
}

function FiltroRutAgenda($id_empresa) {
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);

    $sql="select * from tbl_eventos where id_empresa='$id_empresa' and descripcion<>'' group by descripcion order by descripcion ASC";

    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return ($cod);
}

 function DatosUsuario_($rut, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select h.*


    from tbl_usuario h

    where rut='$rut' and id_empresa='$id_empresa'
    ";
    //echo "<br><br><br>$sql";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return ($cod);
}

function MP_BuscaMedallas_Academia($rut, $id_empresa)  {
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select h.*
    from tbl_academia_lider h
    where h.rut='$rut' and h.id_empresa='$id_empresa'
    ";
   // echo "<br><br><br>$sql";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return ($cod);
}

function TraeDatosBiografiayUsuario($rut, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select h.*,
    (select biografia from tbl_usuario_biografia where rut=h.rut and id_empresa=h.id_empresa) as biografia,
    (select sueno from tbl_usuario_biografia where rut=h.rut and id_empresa=h.id_empresa) as sueno,
    (select logros from tbl_usuario_biografia where rut=h.rut and id_empresa=h.id_empresa) as logros,
    (select celular from tbl_usuario_biografia where rut=h.rut and id_empresa=h.id_empresa) as micelular,
    (select avatar from tbl_usuario_biografia where rut=h.rut and id_empresa=h.id_empresa) as miavatar,
    (select estudios from tbl_usuario_biografia where rut=h.rut and id_empresa=h.id_empresa) as estudios,
    (select profesion from tbl_usuario_biografia where rut=h.rut and id_empresa=h.id_empresa) as profesion,
    (select fecha_cumpleanos from tbl_usuario_biografia where rut=h.rut and id_empresa=h.id_empresa) as fecha_cumpleanos,
    (select fecha_ingreso from tbl_usuario_biografia where rut=h.rut and id_empresa=h.id_empresa) as fecha_ingreso,
    (select recuerdos from tbl_usuario_biografia where rut=h.rut and id_empresa=h.id_empresa) as recuerdos,
    (select titulo from tbl_usuario_biografia where rut=h.rut and id_empresa=h.id_empresa) as titulo,
    (select capacitacion from tbl_usuario_biografia where rut=h.rut and id_empresa=h.id_empresa) as capacitacion

    from tbl_usuario h

    where rut='$rut' and id_empresa='$id_empresa'
    ";
    //echo "<br><br><br>$sql";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return ($cod);
}
function Profile_check_data_biografia($rut, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "SELECT id FROM `tbl_usuario_biografia` WHERE `rut` = '$rut' and id_empresa='$id_empresa'";
    //echo $sql; sleep(10);
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return ($cod);
}
function profile_tarjeta_save($rut, $id_empresa, $biografia, $sueno, $logros, $celular, $imagen, $capacitacion, $fecha_cumpleanos,
$fecha_ingreso, $recuerdos, $titulo, $estudios, $institucion){
  /*echo "<br>$rut, $id_empresa, $biografia, $sueno, $logros, $celular, $imagen, $capacitacion, $fecha_cumpleanos,
$fecha_ingreso, $recuerdos, $titulo, estud $estudios, insti $institucion";sleep(3);*/
    global $c_host, $c_user, $c_pass, $c_db;    $database = new database($c_host, $c_user, $c_pass);    $database->setDb($c_db);

    $sql = "select id  from tbl_usuario_biografia where id_empresa='$id_empresa' and rut='$rut'";
    //echo $sql;
    $database->setquery($sql);
    $database->query();    $cod = $database->listObjects();
    //print_r($cod);    //sleep(5);
    if ($cod[0]->id > 0) {        if ($imagen <> '') {            $and_imagen = ", avatar='$imagen'";        }


    $sql = " UPDATE tbl_usuario_biografia set biografia='$biografia', sueno='$sueno', logros='$logros',    estudios='$estudios', profesion='$institucion',    celular='$celular' , capacitacion='$capacitacion', fecha_cumpleanos='$fecha_cumpleanos', fecha_ingreso='$fecha_ingreso', recuerdos='$recuerdos', titulo='$titulo'        $and_imagen         where id='" . $cod[0]->id . "' ";
    } else {
        $sql = "INSERT INTO tbl_usuario_biografia (rut, id_empresa, fecha, biografia, sueno, logros, celular, avatar, estudios, profesion,    capacitacion, fecha_cumpleanos, fecha_ingreso, recuerdos, titulo) " . "VALUES        ('$rut', '$id_empresa', '" . date("Y-m-d") . "', '$biografia','$sueno', '$logros', '$celular', '$imagen',    '$estudios', '$institucion',        '$capacitacion', '$fecha_cumpleanos', '$fecha_ingreso', '$recuerdos', '$titulo');";

    }

    //echo $sql; sleep(2);
    $database->setquery($sql);    $database->query();    return $codigo;
}
function BuscaestadoCapsula($rut, $id_objeto)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "SELECT id FROM `tbl_objetos_finalizados` WHERE `id_objeto` = '$id_objeto' and rut='$rut'";
    //echo $sql;
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return ($cod);
}
function calculaavancev2($id_curso, $rut)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select round(100*(count(id)/4)) as avance from tbl_objetos_finalizados where id_curso='$id_curso' and rut='$rut'";
    //echo $sql;
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return ($cod);
}
function BuscaPerfilDashBci($rut)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select perfil from tbl_dashboard_bci where rut='$rut'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return ($cod);
}
function dash_busca_id_gerencia($id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select dato10, dato138 from tbl_dash_full_personas where id_empresa='$id_empresa'  group by dato138 order by dato10";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return ($cod);
}


function dash_busca_zona_depto($id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select departamento as campo from tbl_usuario where id_empresa='$id_empresa'


    group by departamento order by departamento


";
    //echo $sql;
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return ($cod);
}


function dash_busca_zona_depto_conRegistroBac($id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select h.*, (select departamento from tbl_usuario where rut=h.rut_col) as campo from tbl_sis_seguimiento h

where  (select departamento from tbl_usuario where rut=h.rut_col) is not null
group by (select departamento from tbl_usuario where rut=h.rut_col)
order by (select departamento from tbl_usuario where rut=h.rut_col)


";
    //echo $sql;
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return ($cod);
}


function dash_busca_id_departamento($id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select dato7, dato9 from tbl_dash_full_personas where id_empresa='$id_empresa'   group by dato9 order by dato7";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return ($cod);
}
function dash_busca_id_zona($id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select dato12, dato13 from tbl_dash_full_personas where id_empresa='$id_empresa'  group by dato13 order by dato12";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return ($cod);
}
function dash_buscadatocampo($campo, $campo2, $dato, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select $campo2 as campo2,$campo as campo from tbl_dash_full_personas where id_empresa='$id_empresa' and $campo2='$dato' limit 1";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return ($cod);
}
function dash_busca_dotacion($id_gerencia, $id_departamento, $id_zona, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $query_gerencia     = "";
    $query_departamento = "";
    $query_zona         = "";
    if ($id_gerencia <> '') {
        $query_gerencia = " and dato138='" . $id_gerencia . "' ";
    }
    if ($id_departamento <> '') {
        $query_departamento = " and dato9='" . $id_departamento . "' ";
    }
    if ($id_zona <> '') {
        $query_zona = " and dato13='" . $id_zona . "' ";
    }
    $sql = "
    select h.dato10,count(h.id) as dotacion,
    (select count(id) from  tbl_dash_full_personas h where id_empresa='$id_empresa' $query_gerencia $query_departamento $query_zona and dato18='Planta') as planta,
    (count(h.id)-(select count(id) from  tbl_dash_full_personas h where id_empresa='$id_empresa' $query_gerencia $query_departamento $query_zona and dato18='Planta')) as temporal
    from tbl_dash_full_personas h
    where id_empresa='$id_empresa'
    $query_gerencia $query_departamento $query_zona";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return ($cod);
}
function dash_busca_chartdiv_genero($id_gerencia, $id_departamento, $id_zona, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $query_gerencia     = "";
    $query_departamento = "";
    $query_zona         = "";
    if ($id_gerencia <> '') {
        $query_gerencia = " and dato138='" . $id_gerencia . "' ";
    }
    if ($id_departamento <> '') {
        $query_departamento = " and dato9='" . $id_departamento . "' ";
    }
    if ($id_zona <> '') {
        $query_zona = " and dato13='" . $id_zona . "' ";
    }
    $sql = "
    select h.dato31,count(h.id) as total,
    (select count(id) from  tbl_dash_full_personas h where  id_empresa='$id_empresa' and dato31='F' $query_gerencia $query_departamento $query_zona) as GENF,
    (select count(id) from  tbl_dash_full_personas h where  id_empresa='$id_empresa' and dato31='M' $query_gerencia $query_departamento $query_zona) as GENM
    from tbl_dash_full_personas h
    where id_empresa='$id_empresa'
    $query_gerencia $query_departamento $query_zona";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return ($cod);
}
function dash_busca_chartdiv_generacion($id_gerencia, $id_departamento, $id_zona, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $query_gerencia     = "";
    $query_departamento = "";
    $query_zona         = "";
    if ($id_gerencia <> '') {
        $query_gerencia = " and dato138='" . $id_gerencia . "' ";
    }
    if ($id_departamento <> '') {
        $query_departamento = " and dato9='" . $id_departamento . "' ";
    }
    if ($id_zona <> '') {
        $query_zona = " and dato13='" . $id_zona . "' ";
    }
    $sql = "
    select h.dato34,count(h.id) as total,
    (select count(id) from  tbl_dash_full_personas h where  id_empresa='$id_empresa' $query_gerencia $query_departamento $query_zona and dato34='BB') as GENBB,
    (select count(id) from  tbl_dash_full_personas h where  id_empresa='$id_empresa' $query_gerencia $query_departamento $query_zona  and dato34='X') as GENX,
    (select count(id) from  tbl_dash_full_personas h where  id_empresa='$id_empresa'  $query_gerencia $query_departamento $query_zona and dato34='Y') as GENY
    from tbl_dash_full_personas h
    where id_empresa='$id_empresa'
    $query_gerencia $query_departamento $query_zona";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return ($cod);
}
function dash_busca_chartdiv_antiguedad($id_gerencia, $id_departamento, $id_zona, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $query_gerencia     = "";
    $query_departamento = "";
    $query_zona         = "";
    if ($id_gerencia <> '') {
        $query_gerencia = " and dato138='" . $id_gerencia . "' ";
    }
    if ($id_departamento <> '') {
        $query_departamento = " and dato9='" . $id_departamento . "' ";
    }
    if ($id_zona <> '') {
        $query_zona = " and dato13='" . $id_zona . "' ";
    }
    $sql = "
    select h.dato38,count(h.id) as total,
    (select count(id) from  tbl_dash_full_personas h where id_empresa='$id_empresa' and dato137='1'     $query_gerencia $query_departamento $query_zona ) as ANT1,
    (select count(id) from  tbl_dash_full_personas h where id_empresa='$id_empresa' and dato137='25'     $query_gerencia $query_departamento $query_zona ) as ANT2,
    (select count(id) from  tbl_dash_full_personas h where id_empresa='$id_empresa' and dato137='610'     $query_gerencia $query_departamento $query_zona ) as ANT3,
    (select count(id) from  tbl_dash_full_personas h where id_empresa='$id_empresa' and dato137='1115'     $query_gerencia $query_departamento $query_zona ) as ANT4,
    (select count(id) from  tbl_dash_full_personas h where id_empresa='$id_empresa' and dato137='15'     $query_gerencia $query_departamento $query_zona ) as ANT5
    from tbl_dash_full_personas h
    where id_empresa='$id_empresa'
    $query_gerencia $query_departamento $query_zona";
    //echo $sql;
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return ($cod);
}
function dash_busca_chartdiv_niv_educ($id_gerencia, $id_departamento, $id_zona, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $query_gerencia     = "";
    $query_departamento = "";
    $query_zona         = "";
    if ($id_gerencia <> '') {
        $query_gerencia = " and dato138='" . $id_gerencia . "' ";
    }
    if ($id_departamento <> '') {
        $query_departamento = " and dato9='" . $id_departamento . "' ";
    }
    if ($id_zona <> '') {
        $query_zona = " and dato13='" . $id_zona . "' ";
    }
    $sql = "
    select h.dato42,count(h.id) as total,
    (select count(id) from  tbl_dash_full_personas h where  id_empresa='$id_empresa' and dato42='B'    $query_gerencia $query_departamento $query_zona) as NIVED_B,
    (select count(id) from  tbl_dash_full_personas h where  id_empresa='$id_empresa' and dato42='C'    $query_gerencia $query_departamento $query_zona) as NIVED_C,
    (select count(id) from  tbl_dash_full_personas h where  id_empresa='$id_empresa' and dato42='D'    $query_gerencia $query_departamento $query_zona) as NIVED_D,
    (select count(id) from  tbl_dash_full_personas h where  id_empresa='$id_empresa' and dato42='E'    $query_gerencia $query_departamento $query_zona) as NIVED_E,
    (select count(id) from  tbl_dash_full_personas h where  id_empresa='$id_empresa' and dato42='F'    $query_gerencia $query_departamento $query_zona) as NIVED_F,
    (select count(id) from  tbl_dash_full_personas h where  id_empresa='$id_empresa' and dato42='G'    $query_gerencia $query_departamento $query_zona) as NIVED_G,
    (select count(id) from  tbl_dash_full_personas h where  id_empresa='$id_empresa' and dato42='H'    $query_gerencia $query_departamento $query_zona) as NIVED_H,
    (select count(id) from  tbl_dash_full_personas h where  id_empresa='$id_empresa' and dato42='I'    $query_gerencia $query_departamento $query_zona) as NIVED_I,
    (select count(id) from  tbl_dash_full_personas h where  id_empresa='$id_empresa' and dato42='J'    $query_gerencia $query_departamento $query_zona) as NIVED_J,
    (select count(id) from  tbl_dash_full_personas h where  id_empresa='$id_empresa' and dato42='K'    $query_gerencia $query_departamento $query_zona) as NIVED_K
    from tbl_dash_full_personas h
    where id_empresa='$id_empresa'
    $query_gerencia $query_departamento $query_zona";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return ($cod);
}
function dash_busca_chartdiv_nivellider($id_gerencia, $id_departamento, $id_zona, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $query_gerencia     = "";
    $query_departamento = "";
    $query_zona         = "";
    if ($id_gerencia <> '') {
        $query_gerencia = " and dato138='" . $id_gerencia . "' ";
    }
    if ($id_departamento <> '') {
        $query_departamento = " and dato9='" . $id_departamento . "' ";
    }
    if ($id_zona <> '') {
        $query_zona = " and dato13='" . $id_zona . "' ";
    }
    $sql = "
    select h.dato50,count(h.id) as total,
    (select count(id) from  tbl_dash_full_personas h where  id_empresa='$id_empresa' and dato51='9'    $query_gerencia $query_departamento $query_zona) as NIVLID_ADMIN,
    (select count(id) from  tbl_dash_full_personas h where  id_empresa='$id_empresa' and dato51='4'    $query_gerencia $query_departamento $query_zona) as NIVLID_AG,
    (select count(id) from  tbl_dash_full_personas h where  id_empresa='$id_empresa' and dato51='10'    $query_gerencia $query_departamento $query_zona) as NIVLID_COM,
    (select count(id) from  tbl_dash_full_personas h where  id_empresa='$id_empresa' and dato51='8'    $query_gerencia $query_departamento $query_zona) as NIVLID_EA,
    (select count(id) from  tbl_dash_full_personas h where  id_empresa='$id_empresa' and dato51='1' $query_gerencia $query_departamento $query_zona) as NIVLID_G1,
    (select count(id) from  tbl_dash_full_personas h where  id_empresa='$id_empresa' and dato51='2'    $query_gerencia $query_departamento $query_zona) as NIVLID_G2,
    (select count(id) from  tbl_dash_full_personas h where  id_empresa='$id_empresa' and dato51='0'$query_gerencia $query_departamento $query_zona) as NIVLID_GG,
    (select count(id) from  tbl_dash_full_personas h where  id_empresa='$id_empresa' and dato51='5'    $query_gerencia $query_departamento $query_zona) as NIVLID_JEF,
    (select count(id) from  tbl_dash_full_personas h where  id_empresa='$id_empresa' and dato51='6'    $query_gerencia $query_departamento $query_zona) as NIVLID_PROF,
    (select count(id) from  tbl_dash_full_personas h where  id_empresa='$id_empresa' and dato51='3'    $query_gerencia $query_departamento $query_zona) as NIVLID_SG,
    (select count(id) from  tbl_dash_full_personas h where  id_empresa='$id_empresa' and dato51='7'    $query_gerencia $query_departamento $query_zona) as NIVLID_SP
    from tbl_dash_full_personas h
    where id_empresa='$id_empresa'
    $query_gerencia $query_departamento $query_zona";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return ($cod);
}
function dash_busca_chartdiv_sindicato($id_gerencia, $id_departamento, $id_zona, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $query_gerencia     = "";
    $query_departamento = "";
    $query_zona         = "";
    if ($id_gerencia <> '') {
        $query_gerencia = " and dato138='" . $id_gerencia . "' ";
    }
    if ($id_departamento <> '') {
        $query_departamento = " and dato9='" . $id_departamento . "' ";
    }
    if ($id_zona <> '') {
        $query_zona = " and dato13='" . $id_zona . "' ";
    }
    $sql = "
    select h.dato53,count(h.id) as total,
    (select count(id) from  tbl_dash_full_personas h where  id_empresa='$id_empresa' and dato53='Adherido Nacional'    $query_gerencia $query_departamento $query_zona) as ADHERIDO_NACIONAL,
    (select count(id) from  tbl_dash_full_personas h where  id_empresa='$id_empresa' and dato53='Adherido Uno'    $query_gerencia $query_departamento $query_zona) as ADHERIDO_UNO,
    (select count(id) from  tbl_dash_full_personas h where  id_empresa='$id_empresa' and dato53='Sin Sindicato'    $query_gerencia $query_departamento $query_zona) as SIN_SIND,
    (select count(id) from  tbl_dash_full_personas h where  id_empresa='$id_empresa' and dato53='Socio Nacional')    $query_gerencia $query_departamento $query_zona as SOCIO_NACIONAL,
    (select count(id) from  tbl_dash_full_personas h where  id_empresa='$id_empresa' and dato53='Socio Uno'    $query_gerencia $query_departamento $query_zona) as SOCIO_UNO

    from tbl_dash_full_personas h
    where id_empresa='$id_empresa'
    $query_gerencia $query_departamento $query_zona";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return ($cod);
}
function dash_busca_chartdiv_diversidad($id_gerencia, $id_departamento, $id_zona, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $query_gerencia     = "";
    $query_departamento = "";
    $query_zona         = "";
    if ($id_gerencia <> '') {
        $query_gerencia = " and dato138='" . $id_gerencia . "' ";
    }
    if ($id_departamento <> '') {
        $query_departamento = " and dato9='" . $id_departamento . "' ";
    }
    if ($id_zona <> '') {
        $query_zona = " and dato13='" . $id_zona . "' ";
    }
    $sql = "
    select h.dato47,count(h.id) as total,
    (select count(id) from  tbl_dash_full_personas h where  id_empresa='$id_empresa' and dato47='SI'    $query_gerencia $query_departamento $query_zona) as DIV_SI,
    (select count(id) from  tbl_dash_full_personas h where  id_empresa='$id_empresa' and dato47='No'    $query_gerencia $query_departamento $query_zona) as DIV_NO
    from tbl_dash_full_personas h
    where id_empresa='$id_empresa'
    $query_gerencia $query_departamento $query_zona";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return ($cod);
}
function dash_busca_chartdiv_estadocivil($id_gerencia, $id_departamento, $id_zona, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $query_gerencia     = "";
    $query_departamento = "";
    $query_zona         = "";
    if ($id_gerencia <> '') {
        $query_gerencia = " and dato138='" . $id_gerencia . "' ";
    }
    if ($id_departamento <> '') {
        $query_departamento = " and dato9='" . $id_departamento . "' ";
    }
    if ($id_zona <> '') {
        $query_zona = " and dato13='" . $id_zona . "' ";
    }
    $sql = "
    select h.dato99,count(h.id) as total,
    (select count(id) from  tbl_dash_full_personas h where  id_empresa='$id_empresa' and dato99='Anulado(a)'    $query_gerencia $query_departamento $query_zona) as ESTCIV_ANULADO,
    (select count(id) from  tbl_dash_full_personas h where  id_empresa='$id_empresa' and dato99='Casado(a)'    $query_gerencia $query_departamento $query_zona) as ESTCIV_CASADO,
    (select count(id) from  tbl_dash_full_personas h where  id_empresa='$id_empresa' and dato99='Conviviente Civil'    $query_gerencia $query_departamento $query_zona) as ESTCIV_CONVI,
    (select count(id) from  tbl_dash_full_personas h where  id_empresa='$id_empresa' and dato99='Divorciado(a)'    $query_gerencia $query_departamento $query_zona) as ESTCIV_DIV,
    (select count(id) from  tbl_dash_full_personas h where  id_empresa='$id_empresa' and dato99='No Consta'    $query_gerencia $query_departamento $query_zona) as ESTCIV_NOCONS,
    (select count(id) from  tbl_dash_full_personas h where  id_empresa='$id_empresa' and dato99='Separado(a)'    $query_gerencia $query_departamento $query_zona) as ESTCIV_SEPARADO,
    (select count(id) from  tbl_dash_full_personas h where  id_empresa='$id_empresa' and dato99='Soltero(a)'    $query_gerencia $query_departamento $query_zona) as ESTCIV_SOLTERO,
    (select count(id) from  tbl_dash_full_personas h where  id_empresa='$id_empresa' and dato99='Viudo(a)'    $query_gerencia $query_departamento $query_zona) as ESTCIV_VIUDO

    from tbl_dash_full_personas h
    where id_empresa='$id_empresa'
    $query_gerencia $query_departamento $query_zona";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return ($cod);
}
function dash_busca_chartdiv_riesgofuga($id_gerencia, $id_departamento, $id_zona, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    //echo "<br>$c_host,$c_user,$c_pass,$c_db";
    $database->setDb($c_db);
    $query_gerencia     = "";
    $query_departamento = "";
    $query_zona         = "";
    if ($id_gerencia <> '') {
        $query_gerencia = " and dato138='" . $id_gerencia . "' ";
    }
    if ($id_departamento <> '') {
        $query_departamento = " and dato9='" . $id_departamento . "' ";
    }
    if ($id_zona <> '') {
        $query_zona = " and dato13='" . $id_zona . "' ";
    }
    $sql = "

    select h.dato99,count(h.id) as total,

    (select count(id) from  tbl_dash_full_personas h where  id_empresa='$id_empresa' and h.dato80='1' and h.dato109='1' and h.dato11='Y' $query_gerencia $query_departamento $query_zona) as FUGA11,

    (select count(id) from  tbl_dash_full_personas h where  id_empresa='$id_empresa' and h.dato80='2' and h.dato109='1' and h.dato11='Y' $query_gerencia $query_departamento $query_zona) as FUGA12,

    (select count(id) from  tbl_dash_full_personas h where  id_empresa='$id_empresa' and h.dato80='3' and h.dato109='1' and h.dato11='Y' $query_gerencia $query_departamento $query_zona) as FUGA13,

    (select count(id) from  tbl_dash_full_personas h where  id_empresa='$id_empresa' and h.dato80='4' and h.dato109='1' and h.dato11='Y' $query_gerencia $query_departamento $query_zona) as FUGA14,

    (select count(id) from  tbl_dash_full_personas h where  id_empresa='$id_empresa' and h.dato80='5' and h.dato109='1' and h.dato11='Y' $query_gerencia $query_departamento $query_zona) as FUGA15,

    (select count(id) from  tbl_dash_full_personas h where  id_empresa='$id_empresa' and h.dato80='6' and h.dato109='1' and h.dato11='Y' $query_gerencia $query_departamento $query_zona) as FUGA16,



    (select count(id) from  tbl_dash_full_personas h where  id_empresa='$id_empresa' and h.dato80='1' and h.dato109='2' and h.dato11='Y' $query_gerencia $query_departamento $query_zona) as FUGA21,

    (select count(id) from  tbl_dash_full_personas h where  id_empresa='$id_empresa' and h.dato80='2' and h.dato109='2' and h.dato11='Y' $query_gerencia $query_departamento $query_zona) as FUGA22,

    (select count(id) from  tbl_dash_full_personas h where  id_empresa='$id_empresa' and h.dato80='3' and h.dato109='2' and h.dato11='Y' $query_gerencia $query_departamento $query_zona) as FUGA23,

    (select count(id) from  tbl_dash_full_personas h where  id_empresa='$id_empresa' and h.dato80='4' and h.dato109='2' and h.dato11='Y' $query_gerencia $query_departamento $query_zona) as FUGA24,

    (select count(id) from  tbl_dash_full_personas h where  id_empresa='$id_empresa' and h.dato80='5' and h.dato109='2' and h.dato11='Y' $query_gerencia $query_departamento $query_zona) as FUGA25,

    (select count(id) from  tbl_dash_full_personas h where  id_empresa='$id_empresa' and h.dato80='6' and h.dato109='2' and h.dato11='Y' $query_gerencia $query_departamento $query_zona) as FUGA26,



    (select count(id) from  tbl_dash_full_personas h where  id_empresa='$id_empresa' and h.dato80='1' and h.dato109='3' and h.dato11='Y' $query_gerencia $query_departamento $query_zona) as FUGA31,

    (select count(id) from  tbl_dash_full_personas h where  id_empresa='$id_empresa' and h.dato80='2' and h.dato109='3' and h.dato11='Y' $query_gerencia $query_departamento $query_zona) as FUGA32,

    (select count(id) from  tbl_dash_full_personas h where  id_empresa='$id_empresa' and h.dato80='3' and h.dato109='3' and h.dato11='Y' $query_gerencia $query_departamento $query_zona) as FUGA33,

    (select count(id) from  tbl_dash_full_personas h where  id_empresa='$id_empresa' and h.dato80='4' and h.dato109='3' and h.dato11='Y' $query_gerencia $query_departamento $query_zona) as FUGA34,

    (select count(id) from  tbl_dash_full_personas h where  id_empresa='$id_empresa' and h.dato80='5' and h.dato109='3' and h.dato11='Y' $query_gerencia $query_departamento $query_zona) as FUGA35,

    (select count(id) from  tbl_dash_full_personas h where  id_empresa='$id_empresa' and h.dato80='6' and h.dato109='3' and h.dato11='Y' $query_gerencia $query_departamento $query_zona) as FUGA36,



    (select count(id) from  tbl_dash_full_personas h where  id_empresa='$id_empresa' and h.dato80='1' and h.dato109='4' and h.dato11='Y' $query_gerencia $query_departamento $query_zona) as FUGA41,

    (select count(id) from  tbl_dash_full_personas h where  id_empresa='$id_empresa' and h.dato80='2' and h.dato109='4' and h.dato11='Y' $query_gerencia $query_departamento $query_zona) as FUGA42,

    (select count(id) from  tbl_dash_full_personas h where  id_empresa='$id_empresa' and h.dato80='3' and h.dato109='4' and h.dato11='Y' $query_gerencia $query_departamento $query_zona) as FUGA43,

    (select count(id) from  tbl_dash_full_personas h where  id_empresa='$id_empresa' and h.dato80='4' and h.dato109='4' and h.dato11='Y' $query_gerencia $query_departamento $query_zona) as FUGA44,

    (select count(id) from  tbl_dash_full_personas h where  id_empresa='$id_empresa' and h.dato80='5' and h.dato109='4' and h.dato11='Y' $query_gerencia $query_departamento $query_zona) as FUGA45,

    (select count(id) from  tbl_dash_full_personas h where  id_empresa='$id_empresa' and h.dato80='6' and h.dato109='4' and h.dato11='Y' $query_gerencia $query_departamento $query_zona) as FUGA46,



    (select count(id) from  tbl_dash_full_personas h where  id_empresa='$id_empresa' and h.dato80='1' and h.dato109='5' and h.dato11='Y' $query_gerencia $query_departamento $query_zona) as FUGA51,

    (select count(id) from  tbl_dash_full_personas h where  id_empresa='$id_empresa' and h.dato80='2' and h.dato109='5' and h.dato11='Y' $query_gerencia $query_departamento $query_zona) as FUGA52,

    (select count(id) from  tbl_dash_full_personas h where  id_empresa='$id_empresa' and h.dato80='3' and h.dato109='5' and h.dato11='Y' $query_gerencia $query_departamento $query_zona) as FUGA53,

    (select count(id) from  tbl_dash_full_personas h where  id_empresa='$id_empresa' and h.dato80='4' and h.dato109='5' and h.dato11='Y' $query_gerencia $query_departamento $query_zona) as FUGA54,

    (select count(id) from  tbl_dash_full_personas h where  id_empresa='$id_empresa' and h.dato80='5' and h.dato109='5' and h.dato11='Y' $query_gerencia $query_departamento $query_zona) as FUGA55,

    (select count(id) from  tbl_dash_full_personas h where  id_empresa='$id_empresa' and h.dato80='6' and h.dato109='5' and h.dato11='Y' $query_gerencia $query_departamento $query_zona) as FUGA56


    from tbl_dash_full_personas h
    where id_empresa='$id_empresa'
    $query_gerencia $query_departamento $query_zona";
    //echo $sql;
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    //echo "<pre>";/print_r($cod);
    return ($cod);
}
function DatosInscripcionEncuestaObjeto($id_inscripcion, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select h.codigo_inscripcion,
    (select id from tbl_objeto where id_curso='$id_inscripcion' and tipo_objeto='6') as id_objeto,
    (select id_encuesta from tbl_objeto where id_curso='$id_inscripcion' and tipo_objeto='6' and id=(select id from tbl_objeto where id_curso='$id_inscripcion' and tipo_objeto='6') ) as id_encuesta
    from tbl_inscripcion_curso h where h.codigo_inscripcion='$id_inscripcion' and h.id_empresa='$id_empresa'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return ($cod);
}
function DatosInscripcioncierreRutCursoEmpresa($rut, $id_curso, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_inscripcion_cierre where rut='$rut' and id_curso='$id_curso' and id_empresa='$id_empresa'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return ($cod);
}
function CursosPorClasificacionesMalla($id_empresa, $id_malla, $clasificacion)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "SELECT id_curso from rel_lms_malla_curso where id_empresa='$id_empresa' and rel_lms_malla_curso.id_malla='$id_malla' and rel_lms_malla_curso.id_clasificacion='$clasificacion'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return ($cod);
}
function ClasificacionesPorMalla($id_empresa, $id_malla)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "SELECT distinct(id_clasificacion) from rel_lms_malla_curso where id_empresa='$id_empresa' and rel_lms_malla_curso.id_malla='$id_malla'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return ($cod);
}
function VerificaMallaDadoPrograma($rut, $id_empresa, $id_programa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "

    SELECT
    rel_lms_malla_persona.rut,
    rel_lms_malla_persona.id_malla, id_programa

    FROM
    rel_lms_malla_persona


    inner join rel_lms_malla_curso
    on rel_lms_malla_curso.id_malla=rel_lms_malla_persona.id_malla
    WHERE
    rel_lms_malla_persona.rut = '$rut' and rel_lms_malla_curso.id_programa='$id_programa' and rel_lms_malla_curso.id_empresa='$id_empresa'
    limit 1
    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return ($cod);
}
function VerificoObjetoAnteriorFinalizado($rut, $id_curso, $orden)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "

    select tbl_objetos_finalizados.id_objeto, tbl_objetos_finalizados.fecha as fecha_finalizacion
    from tbl_objetos_finalizados

    left join tbl_objeto
    on tbl_objeto.id_curso=tbl_objetos_finalizados.id_curso and tbl_objetos_finalizados.id_objeto=tbl_objeto.id

    where tbl_objetos_finalizados.rut='$rut' and tbl_objeto.id_curso='$id_curso' and tbl_objeto.orden='$orden'
    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return ($cod);
}
function MPListaUsuariosQueSigo($rut, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "

    select h.*,
    (select nombre_completo from  tbl_usuario where rut=h.rut) as nombre_completo,
    (select email from  tbl_usuario where rut=h.rut) as email

    from tbl_mp_interacciones h

    where h.tipo='SEGUIDO' and h.rut_remitente='$rut' and h.id_empresa='$id_empresa'
    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return ($cod);
}
function com_mp_post_recents_mini4($rut, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    if ($id_empresa == "53") {
        $sql = "
    select h.*

    from tbl_mp h where id_empresa='$id_empresa' and id_estado>=5   and rut='121212'


    order by id DESC LIMIT 4
    ";
    } else {
        $sql = "
    select h.*

    from tbl_mp h where id_empresa='$id_empresa' and id_estado>=5 and (select tipo from tbl_mp_interacciones where rut_remitente='$rut' and rut=h.rut limit 1)='SEGUIDO'

    order by id DESC LIMIT 10
    ";
    }
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function NoticiaBig2()
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $porciones = explode("@", $texto);
    //buscar email
    $sql       = "SELECT
    tbl_mp.*, (
    SELECT
    count(id)
    FROM
    tbl_mp_comentarios
    WHERE
    id_mp = tbl_mp.id_mp
    ) AS numcomentarios,
    (
    SELECT
    count(id)
    FROM
    tbl_mp_interacciones
    WHERE
    id_mp = tbl_mp.id_mp
    AND tipo = 'MEGUSTA'
    ) AS nummegusta,
    (
    SELECT
    count(id)
    FROM
    tbl_mp_interacciones
    WHERE
    id_mp = tbl_mp.id_mp
    AND tipo = 'NOMEGUSTA'
    ) AS numnomegusta,
    (
    SELECT
    count(id)
    FROM
    tbl_mp_interacciones
    WHERE
    id_mp = tbl_mp.id_mp
    AND tipo = 'COMPARTIDOCONMIGO'
    ) AS numcompartido,
    (
    SELECT
    count(id)
    FROM
    tbl_mp_interacciones
    WHERE
    id_mp = tbl_mp.id_mp
    AND tipo = 'FAVORITA'
    ) AS numfavorita,
    (
    SELECT
    count(id)
    FROM
    tbl_mp_interacciones
    WHERE
    id_mp = tbl_mp.id_mp
    AND tipo = 'VISITA'
    ) AS numvisitas,
    tbl_mp_categorias.categoria,
    tbl_mp_categorias.style,
    tbl_mp_categorias.icono,
    tbl_mp_categorias.descripcion AS descripcion_categoria,
    tbl_mp_estados.estado,
    tbl_mp_estados.estilo,
    tbl_mp_estados.descripcion AS descripcion_estado,
    tbl_mp_estados.icono AS icono_estado,
    tbl_usuario.nombre_completo AS nombre_autor
    FROM
    tbl_mp
    INNER JOIN tbl_mp_categorias ON tbl_mp_categorias.id_categoria = tbl_mp.id_categoria
    INNER JOIN tbl_mp_estados ON tbl_mp_estados.id_estado = tbl_mp.id_estado
    INNER JOIN tbl_usuario ON tbl_usuario.rut = tbl_mp.rut
    WHERE

    tbl_mp.nombre <>'' and tbl_mp.contenido<>''
    and tbl_mp.id_empresa='53'


    ORDER BY
    id DESC

    limit 1, 2
    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return ($cod);
}
function NoticiaBig()
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    //buscar email
    $sql = "SELECT
    tbl_mp.*, (
    SELECT
    count(id)
    FROM
    tbl_mp_comentarios
    WHERE
    id_mp = tbl_mp.id_mp
    ) AS numcomentarios,
    (
    SELECT
    count(id)
    FROM
    tbl_mp_interacciones
    WHERE
    id_mp = tbl_mp.id_mp
    AND tipo = 'MEGUSTA'
    ) AS nummegusta,
    (
    SELECT
    count(id)
    FROM
    tbl_mp_interacciones
    WHERE
    id_mp = tbl_mp.id_mp
    AND tipo = 'NOMEGUSTA'
    ) AS numnomegusta,
    (
    SELECT
    count(id)
    FROM
    tbl_mp_interacciones
    WHERE
    id_mp = tbl_mp.id_mp
    AND tipo = 'COMPARTIDOCONMIGO'
    ) AS numcompartido,
    (
    SELECT
    count(id)
    FROM
    tbl_mp_interacciones
    WHERE
    id_mp = tbl_mp.id_mp
    AND tipo = 'FAVORITA'
    ) AS numfavorita,
    (
    SELECT
    count(id)
    FROM
    tbl_mp_interacciones
    WHERE
    id_mp = tbl_mp.id_mp
    AND tipo = 'VISITA'
    ) AS numvisitas,
    tbl_mp_categorias.categoria,
    tbl_mp_categorias.style,
    tbl_mp_categorias.icono,
    tbl_mp_categorias.descripcion AS descripcion_categoria,
    tbl_mp_estados.estado,
    tbl_mp_estados.estilo,
    tbl_mp_estados.descripcion AS descripcion_estado,
    tbl_mp_estados.icono AS icono_estado,
    tbl_usuario.nombre_completo AS nombre_autor
    FROM
    tbl_mp
    INNER JOIN tbl_mp_categorias ON tbl_mp_categorias.id_categoria = tbl_mp.id_categoria
    INNER JOIN tbl_mp_estados ON tbl_mp_estados.id_estado = tbl_mp.id_estado
    INNER JOIN tbl_usuario ON tbl_usuario.rut = tbl_mp.rut
    WHERE

    tbl_mp.nombre <>'' and tbl_mp.contenido<>''

    and tbl_mp.id_empresa='53'

    ORDER BY
    id DESC

    limit 1";
    //echo $sql;
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return ($cod);
}
function SaveMpTagPeople($texto, $id_mp, $rut_remitente, $id_empresa)
{
     global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);

    $texto = trim($texto);
    $texto = str_replace("&nbsp;", "", $texto);
    $texto = str_replace("&nbsp;", '', $texto);
    $texto = preg_replace("/\s+/", "", $texto);
    $texto = str_replace(" ", '', $texto);
    $texto = trim(html_entity_decode($texto), "\t\n\r\0\x0B\xC2\xA0");
          //echo "<br>texto ->.$texto.";
    $porciones = explode("@", $texto);
    $porciones[1] =trim($porciones[1]);
        //echo "<br>porciones->.".$porciones[1].".";

    //buscar email
    $sql       = "SELECT * FROM tbl_usuario where email like '".$porciones[1]."@%'";
    //echo "$sql <br>";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();

    //print_r($cod);
    if ($cod[0]->rut <> '') {
        $fecha = date("Y-m-d");
        $sql   = "INSERT INTO tbl_mp_interacciones(id_mp, rut, rut_remitente, id_empresa, tipo, fecha) " . "VALUES ('$id_mp', '" . $cod[0]->rut . "', '$rut_remitente', '$id_empresa','TAGUEADO', '$fecha')";
    }
    //echo "<br>$sql<br>";
    // exit();
    $database->setquery($sql);
    $database->query();
    return $cod[0]->rut;
}
function lms_busca_resultados_bci_sgd($rut, $id_empresa, $ano, $proceso)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_dashboard_bci where
    rut='$rut' and anno='$ano' and proceso='$proceso' and id_empresa='$id_empresa'    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return ($cod);
}
function HTML_ActualizarDatosCierre($id_curso, $rut, $id_empresa, $estado, $promedio_por_curso, $estado_descripcion)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "update tbl_inscripcion_cierre
    set  estado='$estado', nota='$promedio_por_curso', observaciones='', estado_descripcion='$estado_descripcion'

    where rut='$rut' and id_curso='$id_curso' and id_empresa='$id_empresa'    ";
    $database->setquery($sql);
    $database->query();
}
function SaveMpMiniEncuesta($rut, $id_empresa, $idme, $idmeid)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $fecha = date("Y-m-d");
    $hora  = date("H:i:s");
    $sql   = "INSERT INTO tbl_miniencuestas_respuestas (id_empresa, id_encuesta, fecha, hora, rut, respuesta) " . "VALUES ('$id_empresa', '$idmeid', '$fecha','$hora', '$rut','$idme')";
    //echo $sql;
    $database->setquery($sql);
    $database->query();
}
function com_mp_mini_encuesta($id_empresa, $rut)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "

    select h.*,

    (select count(id) from tbl_miniencuestas_respuestas where id_empresa=h.id_empresa and id_encuesta=h.id and rut='$rut') as respuesta,

    (select count(id) from tbl_miniencuestas_respuestas where id_empresa=h.id_empresa and id_encuesta=h.id and respuesta='opcion1') as respop1,
    (select count(id) from tbl_miniencuestas_respuestas where id_empresa=h.id_empresa and id_encuesta=h.id and respuesta='opcion2') as respop2,
    (select count(id) from tbl_miniencuestas_respuestas where id_empresa=h.id_empresa and id_encuesta=h.id and respuesta='opcion3') as respop3,
    (select count(id) from tbl_miniencuestas_respuestas where id_empresa=h.id_empresa and id_encuesta=h.id and respuesta='opcion4') as respop4,
    (select count(id) from tbl_miniencuestas_respuestas where id_empresa=h.id_empresa and id_encuesta=h.id ) as respop,
    ROUND(100*(select count(id) from tbl_miniencuestas_respuestas where id_empresa=h.id_empresa and id_encuesta=h.id and respuesta='opcion1')/(select count(id) from tbl_miniencuestas_respuestas where id_empresa=h.id_empresa and id_encuesta=h.id )) as porcop1,
    ROUND(100*(select count(id) from tbl_miniencuestas_respuestas where id_empresa=h.id_empresa and id_encuesta=h.id and respuesta='opcion2')/(select count(id) from tbl_miniencuestas_respuestas where id_empresa=h.id_empresa and id_encuesta=h.id )) as porcop2,
    ROUND(100*(select count(id) from tbl_miniencuestas_respuestas where id_empresa=h.id_empresa and id_encuesta=h.id and respuesta='opcion3')/(select count(id) from tbl_miniencuestas_respuestas where id_empresa=h.id_empresa and id_encuesta=h.id )) as porcop3,
    ROUND(100*(select count(id) from tbl_miniencuestas_respuestas where id_empresa=h.id_empresa and id_encuesta=h.id and respuesta='opcion4')/(select count(id) from tbl_miniencuestas_respuestas where id_empresa=h.id_empresa and id_encuesta=h.id )) as porcop4







    from tbl_miniencuestas h where h.id_empresa='$id_empresa' and activa='1'

    ";
    //echo "<br><br><br><br><br>$sql";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return ($cod);
}
function com_mp_frases($id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "

    select * from tbl_mp_frases where id_empresa='$id_empresa'

    ";
    //echo "<br>$sql";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return ($cod);
}
function BuscaEmail($rut)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "

    select email from tbl_usuario where rut='$rut'

    ";
    //echo "<br>$sql";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return ($cod);
}
function estacotalker($rut)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "

    select count(id) as cuenta from tbl_cotalker where rut='$rut'

    ";
    //echo "<br>$sql";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return ($cod);
}
function MP_DespublicarAlert($rut, $id_mp, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "update tbl_mp h  set h.id_estado=2
    where  h.id_empresa='$id_empresa' and h.id_mp='$id_mp'";
    //echo $sql;
    //echo "<br>";
    $database->setquery($sql);
    $database->query();
    $fecha = date("Y-m-d");
    $sql   = "INSERT INTO tbl_mp_interacciones(id_mp, rut, id_empresa, tipo, fecha) " . "VALUES ('$id_mp', '$rut', '$id_empresa','DESPUBLICACION_ALERTA', '$fecha')";
    //echo $sql;
    $database->setquery($sql);
    $database->query();
}
function MP_InteraccionesBorradaPost($rut, $id_mp, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $fecha = date("Y-m-d");
    $sql   = "INSERT INTO tbl_mp_interacciones(id_mp, rut, id_empresa, tipo, fecha) " . "VALUES ('$id_mp', '$rut', '$id_empresa','PUBLICACION_BORRADA', '$fecha')";
    //echo $sql;
    // sleep(2);
    $database->setquery($sql);
    $database->query();
}
function MP_InteraccionesEdicionPost($rut, $id_mp, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $fecha = date("Y-m-d");
    $sql   = "INSERT INTO tbl_mp_interacciones(id_mp, rut, id_empresa, tipo, fecha) " . "VALUES ('$id_mp', '$rut', '$id_empresa','PUBLICACION_EDITADA', '$fecha')";
    //echo $sql;
    // sleep(2);
    $database->setquery($sql);
    $database->query();
}
function buscaAvanceObjetoDadoRutCursoIDObjeto($rut, $id_objeto, $id_curso)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "   SELECT count(id) as cuenta FROM tbl_objetos_finalizados WHERE id_curso = '$id_curso' AND id_objeto = '$id_objeto' AND rut = '$rut'";
    //echo "<br>$sql";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return ($cod);
}
function Comunidad_EliminaInteraccionReply($tipo, $id_mp, $rut, $id_empresa, $id_reply)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = sprintf("DELETE from tbl_mp_interacciones WHERE id_mp = '$id_mp' and rut='$rut' and id_empresa='$id_empresa' and tipo='$tipo' and id_post='$id_reply'");
    $database->setquery($sql);
    $database->query();
}
function COMUNIDAD_ReplyTieneMegustaGlobal($id_reply, $id_mp)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "   select * from tbl_mp_interacciones where id_mp='$id_mp' and id_post='$id_reply' and tipo='MEGUSTA_POST_REPLY'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return ($cod);
}
function COMUNIDAD_ReplyTieneMegusta($id_reply, $rut, $id_mp)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "   select * from tbl_mp_interacciones where id_mp='$id_mp' and rut='$rut' and id_post='$id_reply' and tipo='MEGUSTA_POST_REPLY'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return ($cod);
}
function COMUNIDAD_ReplyPorReply_inserta($rut, $comentario, $id_reply, $id_mp)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $fecha = date("Y-m-d");
    $hora  = date("H:i:s");
    $tag   = utf8_decode($tag);
    $sql   = "INSERT INTO tbl_mp_comentarios_reply_reply(comentario, rut, id_mp, fecha, hora, id_reply) " . "VALUES ('$comentario', '$rut', '$id_mp', '$fecha', '$hora', '$id_reply')";
    $database->setquery($sql);
    $database->query();
}
function COMUNIDAD_ReplyPorReply($id_mp, $id_reply)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "   SELECT
    tbl_mp_comentarios_reply_reply.*,
    tbl_usuario.nombre_completo
    FROM
    tbl_mp_comentarios_reply_reply
    inner join tbl_usuario on tbl_usuario.rut=tbl_mp_comentarios_reply_reply.rut
    WHERE
    id_mp = '$id_mp'
    AND id_reply = '$id_reply'

    order by id desc";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return ($cod);
}
function CHECK_LIST_tieneComentariosFinales($rut_colaborador, $dia)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "    SELECT * from tbl_escuela_bp_comentarios_finales where rut_colaborador='$rut_colaborador' and dia='$dia'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return ($cod);
}
function CHECK_LIST_InsertaComentariosFinales($rut_jefe, $rut_colaborador, $comentario, $asistencia, $dia)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $fecha = date("Y-m-d");
    $hora  = date("H:i:s");
    $tag   = utf8_decode($tag);
    $sql   = "INSERT INTO tbl_escuela_bp_comentarios_finales    (rut_colaborador, rut_jefatura, comentario_final, asistencia, fecha, hora, dia) " . "VALUES
    ('$rut_colaborador', '$rut_jefe', '$comentario', '$asistencia', '$fecha', '$hora', '$dia')";
    $database->setquery($sql);
    $database->query();
}
function CHECK_LIST_InsertaRespuestas($rut_jefe, $rut_colaborador, $pregunta, $respuesta, $dia)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $fecha = date("Y-m-d");
    $hora  = date("H:i:s");
    $tag   = utf8_decode($tag);
    $sql   = "INSERT INTO tbl_escuela_bp_check_list_respuesta
    (rut_colaborador, rut_jefatura, id_actividad, respuesta, fecha, hora, dia) " . "VALUES
    ('$rut_colaborador', '$rut_jefe', '$pregunta', '$respuesta', '$fecha', '$hora', '$dia')";
    $database->setquery($sql);
    $database->query();
}
function CHECK_LIST_PreguntasPorDia($dia)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "    SELECT * from tbl_escuela_bp_dia_actividad where dia='$dia'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return ($cod);
}
function LIDER_Colaboradores($lider, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "    SELECT * from tbl_usuario where lider='$lider' and id_empresa='$id_empresa'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return ($cod);
}
function RF_buscasegmento($rut, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "    SELECT
    h.mundo FROM tbl_usuario h
    WHERE    h.id_empresa = '$id_empresa' and h.rut='$rut'
    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return ($cod);
}
function EliminaEstadoValidacionPorEtapa($rut_embajador, $rut_tutor, $r2, $etapa, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $sql      = "delete  from tbl_planes_embajadores_validaciones
    where
    rut='$rut_embajador' and
    tutor='$rut_tutor' and
    etapa='$etapa' and
    id_empresa='$id_empresa' and
    r2='$r2'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function EMBAJADORES_VerificaValidacionTareaSubida($id_empresa, $rut, $rut_r2, $rut_tutor, $tarea)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $sql      = "SELECT * from tbl_planes_embajadores_tareas_validadas where rut='$rut'   and tutor='$rut_tutor' and r2='$rut_r2' and id_tarea='$tarea' ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function InsertaValidacionDetAreaLinkDirve($embajador, $r2, $tutor, $tarea, $estado)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $fecha = date("Y-m-d");
    $hora  = date("H:i:s");
    $sql   = "INSERT INTO tbl_planes_embajadores_tareas_validadas(rut, r2, tutor, id_tarea, fecha, hora, estado_validacion) " . "VALUES ('$embajador', '$r2', '$tutor', '$tarea', '$fecha', '$hora', '$estado')";
    $database->setquery($sql);
    $database->query();
}
function EMBAJADORES_VerificaValidacion3($id_empresa, $rut, $rut_r2, $rut_tutor)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    if ($rut_r2) {
        $filtro_r2 = "and tbl_planes_embajadores_validaciones.r2='$rut_r2'";
    }
    $sql = "SELECT * from tbl_planes_embajadores_validaciones where rut='$rut' and id_empresa='$id_empresa'  and tutor='$rut_tutor' $filtro_r2 ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function EMBAJADORES_ActualizaLevantamiento($rut_embajador, $rut_r2, $levantamiento, $comentario)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $fecha = date("Y-m-d");
    $hora  = date("H:i:s");
    $sql   = "update tbl_planes_embajadores_levantamientos set levantamiento='$levantamiento', comentario='$comentario' where rut='$rut_embajador' and r2='$rut_r2' ";
    $database->setquery($sql);
    $database->query();
    return $cod;
}
function EMBAJADORES_InsertaLEvantamiento($rut_embajador, $rut_r2, $levantamiento, $comentario)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $fecha = date("Y-m-d");
    $hora  = date("H:i:s");
    $sql   = "INSERT INTO tbl_planes_embajadores_levantamientos(rut, r2, levantamiento, comentario, fecha, hora) " . "VALUES ('$rut_embajador', '$rut_r2', '$levantamiento', '$comentario', '$fecha', '$hora')";
    $database->setquery($sql);
    $database->query();
}
function EMBAJADORES_VerificaLEvantamiento($rut_embajador, $rut_r2)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from  tbl_planes_embajadores_levantamientos where rut='$rut_embajador' and r2='$rut_r2'    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return ($cod);
}
function MP_numero_expertos_categoria($id_categoria, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "

    select count(DISTINCT(h.codigo))  as cuenta

    from tbl_mp_vista h

    where
    tipo='vistaexperto'
    and contenido='$id_categoria'
    and id_empresa='$id_empresa'

    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return ($cod[0]->cuenta);
}
function mp_actualiza_interacciones_visto($rut)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "update tbl_mp_interacciones h  set h.visto_autor=1
    where (h.visto_autor is null or h.visto_autor<>1)
    and     (SELECT    rut FROM tbl_mp WHERE id_mp = h.id_mp LIMIT 1)='$rut'";
    $database->setquery($sql);
    $database->query();
    $sql = "update tbl_mp_interacciones h  set h.visto_remitente=1
    where (h.visto_remitente is null or h.visto_remitente<>1)
    and     h.rut_remitente='$rut'";
    $database->setquery($sql);
    $database->query();
    $sql = "update tbl_mp_interacciones h  set h.visto=1
    where (h.visto is null or h.visto<>1)
    and     h.rut='$rut'";
    $database->setquery($sql);
    $database->query();
}
function mp_interacciones_notificaciones_home($rut, $id_empresa, $limit)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    if ($limit > 0) {
        $limit = " limit $limit";
    } else {
        $limit = "";
    }
    $sql = "

    select h.*,
    (select nombre from tbl_mp where id_mp=h.id_mp) as Publicacion,
    (select rut from tbl_mp where id_mp=h.id_mp limit 1) as rutAutor,
    (select nombre_completo from tbl_usuario where rut=h.rut) as NombreDestinatario,
    (select nombre_completo from tbl_usuario where rut=h.rut_remitente) as NombreRemitente,
    (select nombre_completo from tbl_usuario where rut=(select rut from tbl_mp where id_mp=h.id_mp limit 1)) as NombreAutor,
    (select categoria from tbl_mp_categorias where id_categoria=h.contenido) as NombreCategoria

    from tbl_mp_interacciones h

    where (h.rut='$rut' or h.rut_remitente='$rut' or (select rut from tbl_mp where id_mp=h.id_mp limit 1)='$rut')

    and (tipo='MEGUSTA' or tipo='COMENTARIO' or tipo='COMPARTIDOCONMIGO' or tipo='GRUPOSEGUIDO' or tipo='SEGUIDO' or tipo='PUBLICACION_SEGUIDO')

    and h.id_empresa='$id_empresa'



    order by h.id DESC

    $limit


    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return ($cod);
}
function mp_interacciones_notificaciones($rut, $id_empresa, $limit)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    if ($limit > 0) {
        $limit = " limit $limit";
    } else {
        $limit = "";
    }
    $sql = "

    select h.*,
    (select nombre from tbl_mp where id_mp=h.id_mp) as Publicacion,
    (select rut from tbl_mp where id_mp=h.id_mp limit 1) as rutAutor,
    (select nombre_completo from tbl_usuario where rut=h.rut) as NombreDestinatario,
    (select nombre_completo from tbl_usuario where rut=h.rut_remitente) as NombreRemitente,
    (select nombre_completo from tbl_usuario where rut=(select rut from tbl_mp where id_mp=h.id_mp limit 1)) as NombreAutor,
    (select categoria from tbl_mp_categorias where id_categoria=h.contenido) as NombreCategoria

    from tbl_mp_interacciones h

    where (h.rut='$rut' or h.rut_remitente='$rut' or (select rut from tbl_mp where id_mp=h.id_mp limit 1)='$rut')

    and (tipo='MEGUSTA' or tipo='COMENTARIO' or tipo='COMPARTIDOCONMIGO' or tipo='GRUPOSEGUIDO' or tipo='SEGUIDO')

    and h.id_empresa='$id_empresa'



    order by h.id DESC

    $limit


    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return ($cod);
}
function MP_SearchBannedWords($id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "    SELECT
    h.* FROM tbl_mp_palabras_prohibidas h
    WHERE    h.id_empresa = '$id_empresa'
    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return ($cod);
}
function BuscaSubCategoriasEmpresa_data($id_empresa, $comunidad, $id_categoria)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "SELECT
    (select count(*) as total from tbl_biblio_archivos where id_categoria=h.id) as total_archivos,
    h.*
    FROM
    tbl_biblio_categorias h
    WHERE
    h.id_empresa = '$id_empresa'
    AND h.id_categoria = '$id_categoria'
    and
    (select count(*) as total from tbl_biblio_archivos where id_categoria=h.id)>0
    ORDER BY
    h.categoria";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return ($cod);
}


function buscarArchivoSubCatFull($id_categoria)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "SELECT h.* from

    tbl_biblio_archivos h

    where h.id_categoria='$id_categoria'     order by titulo


    ";
//
//echo $sql;
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return ($cod);
}

function buscarArchivoTituloSubCat($titulo, $subcat)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "SELECT h.* from

    tbl_biblio_archivos h

    where h.titulo='$titulo'

    and (select categoria from tbl_biblio_categorias where id=h.id_categoria)='$subcat'
    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return ($cod);
}
function BuscaCategoriasEmpresa_data($id_empresa, $comunidad)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "SELECT
    (
    SELECT
    count(*) AS total
    FROM
    tbl_biblio_archivos
    WHERE
    tbl_biblio_archivos.id_categoria IN (
    SELECT
    id
    FROM
    tbl_biblio_categorias AS tbl_cat_aux
    WHERE
    tbl_cat_aux.id_categoria = h.id
    )
    ) AS total_archivos,
    h.*
    FROM
    tbl_biblio_categorias h
    WHERE
    h.id_empresa = '$id_empresa'
    AND h.id_categoria = '0'

    and

    (
    SELECT
    count(*) AS total
    FROM
    tbl_biblio_archivos
    WHERE
    tbl_biblio_archivos.id_categoria IN (
    SELECT
    id
    FROM
    tbl_biblio_categorias AS tbl_cat_aux
    WHERE
    tbl_cat_aux.id_categoria = h.id
    )
    )>0
    ORDER BY
    h.categoria";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return ($cod);
}
function Verificasiesempresa($ide)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select id from tbl_empresa where id='$ide'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return count($cod);
}
function CalcularAvanceDatosTablaReporte2017RutPrograma($rut, $id_programa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select avg(avance) as avance from tbl_lms_reportes  where rut='$rut' and id_programa='$id_programa' and curso_opcional='0'

    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function busca_Estrellas_Aptitud($id_categoria, $rut_autor, $rut_receptor, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select h.mensaje

    from tbl_mp_interacciones h

    where h.rut='$rut_receptor' and h.rut_remitente='$rut_autor' and h.id_empresa='$id_empresa' and tipo='APTITUD_VALIDADA' and h.contenido='$id_categoria'
    group by h.contenido";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function PREGUNTADOS_TraeRespuestasTriviasPreguntadosPorIntento($id_empresa, $numero_intento, $rut)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_evaluaciones_respuestas_intentos where rut='$rut' and id_empresa='$id_empresa' and numero_intento='$numero_intento'

    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function PREGUNTADOS_RegistrosGanadosPorRut($rut)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select  * from tbl_preguntados_ganadores where rut='$rut'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TotalUsuariosSalonFamaPreguntadosOrdenGanadosPuntosTiempo($id_empresa, $id_objeto)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "SELECT
    tbl_evaluaciones_respuestas_intentos.rut,
    sum(
    tbl_evaluaciones_respuestas_intentos.correcta
    ) AS suma_correctas,
    nombre_completo,
    (
    SELECT            count(*) AS total        FROM            tbl_preguntados_ganadores        WHERE            tbl_preguntados_ganadores.rut = tbl_evaluaciones_respuestas_intentos.rut    ) AS total_veces_ganado,
    (select sum(tiempo) as total_tiempo from tbl_preguntados_ganadores WHERE            tbl_preguntados_ganadores.rut = tbl_evaluaciones_respuestas_intentos.rut    ) as total_segundos
    FROM
    tbl_evaluaciones_respuestas_intentos
    INNER JOIN tbl_usuario ON tbl_usuario.rut = tbl_evaluaciones_respuestas_intentos.rut
    WHERE
    tbl_evaluaciones_respuestas_intentos.id_objeto = '$id_objeto'
    AND tbl_evaluaciones_respuestas_intentos.id_empresa = '$id_empresa'
    GROUP BY
    tbl_evaluaciones_respuestas_intentos.rut
    ORDER BY
    (
    SELECT
    count(*) AS total
    FROM
    tbl_preguntados_ganadores
    WHERE
    tbl_preguntados_ganadores.rut = tbl_evaluaciones_respuestas_intentos.rut
    ) DESC,
    suma_correctas DESC, (select sum(tiempo) as total_tiempo from tbl_preguntados_ganadores WHERE
    tbl_preguntados_ganadores.rut = tbl_evaluaciones_respuestas_intentos.rut    ) asc";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function PREGUNTADOS_insertaRegistroGanador($rut, $numero_intento, $id_desafio_preguntados, $cantidad_segundos)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $fecha = date("Y-m-d");
    $hora  = date("H:i:s");
    $tag   = utf8_decode($tag);
    $sql   = "INSERT INTO tbl_preguntados_ganadores(rut, numero_intento, id_desafio_preguntados, fecha, hora, tiempo) " . "VALUES ('$rut', '$numero_intento', '$id_desafio_preguntados', '$fecha', '$hora', '$cantidad_segundos')";
    $database->setquery($sql);
    $database->query();
}
function PREGUNTADOS_TieneAvanceDesafios($rut, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select  * from tbl_evaluaciones_desafios where (rut_desafiante='$rut' or rut_desafiado='$rut') and id_empresa='$id_empresa'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function PREGUNTADOS_PreguntaDeEvaluacionAleatorias($id_evaluacion, $numero, $rut, $id_desafio_preguntados)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    if ($id_desafio_preguntados) {
        $filtro_desafio_preguntados = " and tbl_evaluaciones_asociacion_preguntas_usuario.id_desafio_preguntados='$id_desafio_preguntados' ";
    }
    $sql = "

    select tbl_evaluaciones_preguntas.*, tbl_evaluaciones_tipo_preguntas.tipo as tipo_pregunta,

    tbl_evaluaciones_tipo_preguntas.template as template_pregunta, tbl_evaluaciones_asociacion_preguntas_usuario.id_desafio_preguntados

    from

    tbl_evaluaciones_asociacion_preguntas_usuario



    inner join tbl_evaluaciones_preguntas

    on tbl_evaluaciones_preguntas.id=tbl_evaluaciones_asociacion_preguntas_usuario.id_pregunta



    INNER JOIN tbl_evaluaciones_tipo_preguntas

    ON tbl_evaluaciones_tipo_preguntas.id = tbl_evaluaciones_preguntas.tipo



    where tbl_evaluaciones_asociacion_preguntas_usuario.id_evaluacion='$id_evaluacion'
    and tbl_evaluaciones_asociacion_preguntas_usuario.orden='$numero'
    and tbl_evaluaciones_asociacion_preguntas_usuario.rut='$rut'
    $filtro_desafio_preguntados



    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function PreguntadosDesafiosGanadosTablaDesafios($rut)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select  * from tbl_evaluaciones_desafios where rut_ganador='$rut'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function PREGUNTADOS_ActualizaRutGanadorDesafio($rut_ganador, $id_desafio_preguntados)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "update tbl_evaluaciones_desafios set rut_ganador='$rut_ganador' where id='$id_desafio_preguntados' ";
    $database->setquery($sql);
    $database->query();
    return $cod;
}
function PreguntadosEstadoNivel0($rut)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select  * from tbl_preguntados_vio_nivel0 where rut='$rut'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function PREGUNTADOS_InsertoCursosVistosNivel0($rut)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $fecha    = date("Y-m-d");
    $hora     = date("H:i:s");
    $sql      = "insert into tbl_preguntados_vio_nivel0 (rut, fecha, hora)
    values ('$rut', '$fecha', '$hora')";
    $database->setquery($sql);
    $database->query();
}
function LMS_Actualiza_VerificaFechasObjetoFinalizadoDadoObjetoPrimero($id_curso, $rut)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select

    (select fecha from tbl_objetos_finalizados where rut='$rut' and id_curso='$id_curso' order by fecha ASC limit 1) as fecha_inicio,
    (select fecha from tbl_objetos_finalizados where rut='$rut' and id_curso='$id_curso' order by fecha DESC limit 1) as fecha_termino

    from tbl_objetos_finalizados

    where rut='$rut' and id_curso='$id_curso' group by id_curso
    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function BuscaAvgCierre($id_malla, $id_empresa, $rut)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
    select round(avg(h.avance)) as avancePrograma from tbl_inscripcion_cierre h
    where h.rut='$rut' and h.id_empresa='$id_empresa' and
    (select id_curso from rel_lms_malla_curso where id_malla='$id_malla')=h.id_curso

    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function BuscaAvgCierreCurso($id_malla, $id_empresa, $rut)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "

    select h.*,
    (select certificacion from rel_lms_malla_curso where id_malla=h.id_malla and id_curso=h.id_curso) as certificacion,
    (select nota from tbl_inscripcion_cierre where rut=h.rut and id_curso=h.id_curso order by nota DESC limit 1) as nota,
    (select estado_descripcion from tbl_inscripcion_cierre where rut=h.rut and id_curso=h.id_curso order by estado_descripcion DESC  limit 1) as estadodescripcion,
    (select avance from tbl_inscripcion_cierre where rut=h.rut and id_curso=h.id_curso order by avance DESC limit 1) as avance,
    (select inactivo from rel_lms_malla_curso where id_malla=h.id_malla and id_curso=h.id_curso)

    from tbl_inscripcion_usuarios h where h.id_malla='$id_malla' and h.rut='$rut'
    and h.id_empresa='$id_empresa'


    and (  (select inactivo from rel_lms_malla_curso where id_malla=h.id_malla and id_curso=h.id_curso)<>'1'  or (select inactivo from rel_lms_malla_curso where id_malla=h.id_malla and id_curso=h.id_curso) is null)
    and ( (select opcional from rel_lms_malla_curso where id_malla=h.id_malla and id_curso=h.id_curso)<>'1'  or(select opcional from rel_lms_malla_curso where id_malla=h.id_malla and id_curso=h.id_curso) is null)

    ";
    //echo "<br><br>data BuscaAvgCierreCurso <br>$sql";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    //echo $cod[0]->avance;    exit();
    return $cod;
}


function BuscaAvgCierreCursoArrayMalla($Array_id_malla, $id_empresa, $rut)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);

    //print_r($Array_id_malla);

    $query.=" ( ";
    foreach ($Array_id_malla as $unico){

    $query.= " h.id_malla= '".$unico->id_malla."' or ";

    }
    $query.="  h.rut=h.id_malla ) ";
    $sql = "
    select h.*,
    (select certificacion from rel_lms_malla_curso where id_malla=h.id_malla and id_curso=h.id_curso) as certificacion,
    (select nota from tbl_inscripcion_cierre where rut=h.rut and id_curso=h.id_curso limit 1) as nota,
    (select estado_descripcion from tbl_inscripcion_cierre where rut=h.rut and id_curso=h.id_curso limit 1) as estadodescripcion,
    (select avance from tbl_inscripcion_cierre where rut=h.rut and id_curso=h.id_curso limit 1) as avance,
    (select inactivo from rel_lms_malla_curso where id_malla=h.id_malla and id_curso=h.id_curso)

    from tbl_inscripcion_usuarios h where $query and h.rut='$rut'
    and h.id_empresa='$id_empresa'


    and (    (select inactivo from rel_lms_malla_curso where id_malla=h.id_malla and id_curso=h.id_curso)<>'1'  or (select inactivo from rel_lms_malla_curso where id_malla=h.id_malla and id_curso=h.id_curso) is null)
    and ( (select opcional from rel_lms_malla_curso where id_malla=h.id_malla and id_curso=h.id_curso)<>'1'  or(select opcional from rel_lms_malla_curso where id_malla=h.id_malla and id_curso=h.id_curso) is null)
    ";


    //echo "<br>BuscaAvgCierreCursoArrayMalla<br>$sql";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    //echo $cod[0]->avance;    exit();
    //echo "<pre>";    print_r($cod); exit();

    return $cod;
}


function Embajadores_traigoSeguimientoPorPlan($rut, $id_empresa, $id_plan)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "        select * from tbl_planes_embajadores_seguimiento_por_plan where id_empresa='$id_empresa' and id_plan='$id_plan' and rut='$rut' and resultado<>''  order by fecha desc       ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function InsertaPlanSeguimientoEmbajadores($rut, $id_plan, $id_empresa, $fecha, $resultado)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "INSERT INTO tbl_planes_embajadores_seguimiento_por_plan(id_plan, rut, id_empresa, fecha, resultado) " . "VALUES ('$id_plan', '$rut', '$id_empresa', '$fecha', '$resultado');";
    $database->setquery($sql);
    $database->query();
}
function EMBAJADORES_ActualizaFactorExitoYDemas($rut, $id_empresa, $id_plan, $factor_exito, $ambito, $periodicidad, $nombre_kpi, $kpi_inicial, $rut_r2, $kpi_esperado)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    if ($rut_r2) {
        $filtro_r2 = " and r2='$rut_r2' ";
    }
    $sql = "UPDATE tbl_planes_embajadores_reunion_inicial
    SET  factor_exito='$factor_exito', ambito='$ambito', periodicidad='$periodicidad', nombre_kpi='$nombre_kpi', kpi_inicial='$kpi_inicial', kpi_esperado='$kpi_esperado'
    where id_empresa='$id_empresa' and rut='$rut' $filtro_r2 ";
    $database->setquery($sql);
    $database->query();
}
function lms_busca_puntos_reportes_data($rut, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
    select h.*, sum(h.puntos)  as sumapuntos,
    (select nombre from tbl_lms_curso where id=h.id_curso limit 1),
    (select nombre_programa from tbl_lms_programas_bbdd where id_programa=h.id_programa limit 1) as programa

    from tbl_lms_reportes h

    where h.id_empresa='$id_empresa' and h.rut='$rut' and h.avance='100' and h.puntos>0

    group by h.id_programa
    order by h.fecha_termino DESC
    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function lms_busca_cursos_realizados_data($rut, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
    select h.programa, h.curso, h.anno_termino, h.mes_termino, h.status, h.horas, h.nombre, h.asistencia

    from tbl_lms_reportes_full h

    where h.rut='$rut'
    and  h.curso<>''
    order by h.fecha_termino DESC
    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ObtengoCantidadDeIntentosPorColaboradorPorIntentos($rut, $id_objeto, $id_empresa, $numero_intento)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "    select * from tbl_evaluaciones_respuestas_intentos where rut='$rut' and id_objeto='$id_objeto' and id_empresa='$id_empresa' and numero_intento='$numero_intento'    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ObtengoCantidadDeRespuestasPorColaboradorPorIntentos($rut, $id_objeto, $id_empresa, $numero_intento)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "    select count(id) as puntos from tbl_evaluaciones_respuestas_intentos
    where rut='$rut' and id_objeto='$id_objeto' and id_empresa='$id_empresa' and numero_intento='$numero_intento'
    and correcta='1'    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ObtenerRespuestaDeUsuarioDesdeIntentos($id_pregunta, $rut, $numero_intentos)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select tbl_evaluaciones_respuestas.*,
    tbl_evaluaciones_alternativas.correcta,
    tbl_evaluaciones_alternativas.alternativa,
    tbl_evaluaciones_alternativas.id_grupo_alternativas,
    (select alternativa from tbl_evaluaciones_alternativas as alt1 where alt1.id_grupo_alternativas=tbl_evaluaciones_alternativas.id_grupo_alternativas and alt1.correcta='1') as alternativa_correcta


    FROM

    tbl_evaluaciones_respuestas

    INNER JOIN tbl_evaluaciones_alternativas ON tbl_evaluaciones_respuestas.id_alternativa = tbl_evaluaciones_alternativas.id

    WHERE

    tbl_evaluaciones_respuestas.rut = '$rut'

    AND tbl_evaluaciones_respuestas.id_pregunta = '$id_pregunta'

    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function EliminaPreguntasAsociadas($rut, $id_objeto, $id_evaluacion)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $sql      = "delete  from tbl_evaluaciones_asociacion_preguntas_usuario  where rut='$rut' and id_objeto='$id_objeto' and id_evaluacion='$id_evaluacion' and id_desafio_preguntados is null ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function InsertoRegistroPreguntasAleatoriasPreguntados($rut, $id_evaluacion, $id_objeto, $orden, $id_pregunta, $id_curso, $id_desafio_preguntados)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "INSERT INTO tbl_evaluaciones_asociacion_preguntas_usuario(rut, id_evaluacion, id_objeto, id_curso, id_pregunta, orden, id_desafio_preguntados) " . "VALUES ('$rut', '$id_evaluacion', '$id_objeto', '$id_curso', '$id_pregunta', '$orden', '$id_desafio_preguntados');";
    $database->setquery($sql);
    $database->query();
}
function RespuestasDadoRutObjetoPorDesafioPreguntados($rut, $id_objeto, $id_desafio_preguntados, $numero_intento)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    if ($id_desafio_preguntados) {
        $filtro_desafio = " and id_desafio_preguntados='$id_desafio_preguntados'";
    }
    if ($numero_intento) {
        $filtro_intento = " and numero_intento='$numero_intento'";
    }
    $sql = "SELECT
    tbl_evaluaciones_respuestas_intentos.*, tbl_evaluaciones_alternativas.correcta, tbl_evaluaciones_alternativas.puntaje
    FROM tbl_evaluaciones_respuestas_intentos
    inner join tbl_evaluaciones_alternativas
    on tbl_evaluaciones_alternativas.id=tbl_evaluaciones_respuestas_intentos.id_alternativa
    where rut='$rut' and id_objeto='$id_objeto'  $filtro_desafio $filtro_intento ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function VerificaSiTienePReguntasAsociadasRandomicasNivel2($rut, $id_evaluacion, $id_objeto, $id_desafio_preguntados)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_evaluaciones_asociacion_preguntas_usuario where rut='$rut' and id_evaluacion='$id_evaluacion' and id_objeto='$id_objeto' and id_desafio_preguntados='$id_desafio_preguntados' ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function VerificaSiTienePReguntasAsociadasRandomicasNivel1($rut, $id_evaluacion, $id_objeto)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_evaluaciones_asociacion_preguntas_usuario
    where rut='$rut' and id_evaluacion='$id_evaluacion' and id_objeto='$id_objeto' ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TraeRespuestasTriviasPreguntadosPorDesafioCorrectas($id_empresa, $id_desafio_preguntados, $rut)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_evaluaciones_respuestas_intentos
    where rut='$rut' and id_empresa='$id_empresa' and id_desafio_preguntados='$id_desafio_preguntados' and correcta='1'

    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TotalTiempoPorTriviaPreguntados($rut, $id_desafio)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select SEC_TO_TIME( SUM( TIME_TO_SEC( hora ) ) ) as total_tiempo  from tbl_evaluaciones_respuestas_intentos
    where rut='$rut' and id_desafio_preguntados='$id_desafio'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TraeRespuestasTriviasPreguntadosPorDesafio($id_empresa, $id_desafio_preguntados, $rut)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_evaluaciones_respuestas_intentos where rut='$rut' and id_empresa='$id_empresa' and id_desafio_preguntados='$id_desafio_preguntados'

    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TraeR2PorEmbajador($rut, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "SELECT
    r2, nombre_completo, fecha, tbl_planes_embajadores_reunion_inicial.rut, tutor
    FROM
    tbl_planes_embajadores_reunion_inicial

    inner join tbl_usuario
    on tbl_usuario.rut=tbl_planes_embajadores_reunion_inicial.r2
    WHERE
    tbl_planes_embajadores_reunion_inicial.rut = '$rut'
    AND tbl_planes_embajadores_reunion_inicial.id_empresa = '$id_empresa'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TraeDatosDEsafioPreguntados($id)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select rut_desafiante,
    rut_desafiado,
    fecha,
    hora,
    basedesafiante.nombre_completo as nombre_desafiante,
    basedesafiado.nombre_completo as nombre_desafiado,
    rut_ganador


    from tbl_evaluaciones_desafios
    inner join tbl_usuario as basedesafiante on basedesafiante.rut=rut_desafiante
    inner join tbl_usuario as basedesafiado on basedesafiado.rut=rut_desafiado

    where tbl_evaluaciones_desafios.id='$id'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function datos_Encuesta_front_lb($id_encuesta)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "SELECT
    *
    FROM
    tbl_enc_elearning_medicion

    where id='$id_encuesta'";  //echo $sql;
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function InsertaDesafioUsuario($rut_desafiante, $rut_desafiado, $id_objeto, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $fecha = date("Y-m-d");
    $hora  = date("H:i:s");
    $sql   = "INSERT INTO tbl_evaluaciones_desafios(rut_desafiante, rut_desafiado, id_objeto, id_empresa, fecha, hora) " . "VALUES ('$rut_desafiante', '$rut_desafiado', '$id_objeto', '$id_empresa','$fecha', '$hora');";
    $database->setquery($sql);
    $database->query();
    $sql_last_id = "SELECT LAST_INSERT_ID() as valor; ";
    $database->setquery($sql_last_id);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TraeNotificacionesInteraccionSinLeerPersonalData($rut, $tipo, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select h.*, count(h.id) as cuenta
    from tbl_mp_interacciones h
    where h.visto is NULL
    AND (h.tipo='MEGUSTA' or h.tipo='NOMEGUSTA' or h.tipo='COMENTARIO')
    AND (select rut from tbl_mp where id_mp=h.id_mp limit 1)='$rut'
    and h.id_empresa='$id_empresa'
    group by h.tipo";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function SetvistonotificacionesMeGusta($rut, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "update tbl_mp_interacciones h set h.visto='1' where (h.tipo='MEGUSTA' or h.tipo='NOMEGUSTA' or h.tipo='COMENTARIO')
    AND (select rut from tbl_mp where id_mp=h.id_mp limit 1)='$rut'
    and h.id_empresa='$id_empresa' and h.visto is NULL ";
    $database->setquery($sql);
    $database->query();
    return $cod;
}
function SetvistonotificacionesCompartido($rut, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "update tbl_mp_interacciones h set h.visto='1' where h.rut='$rut' and h.tipo='COMPARTIDOCONMIGO'
    AND h.id_empresa='$id_empresa' and h.visto is NULL ";
    $database->setquery($sql);
    $database->query();
    return $cod;
}
function SetvistonotificacionesSeguidor($rut, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "update tbl_mp_interacciones h set h.visto='1' where h.rut='$rut' and h.tipo='SEGUIDO'
    AND h.id_empresa='$id_empresa' and h.visto is NULL ";
    $database->setquery($sql);
    $database->query();
    return $cod;
}
function TraeNotificacionesInteraccionesNuevoSeguidorData($rut, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "SELECT
    h.*,
    (select nombre_completo from tbl_usuario where rut=h.rut_remitente) as nombre_completo
    FROM
    tbl_mp_interacciones h
    WHERE
    h.tipo = 'SEGUIDO'
    AND h.rut = '$rut' and h.rut_remitente<>'$rut'
    AND h.visto IS NULL
    AND h.id_empresa = '$id_empresa'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TraeNotificacionesInteraccionesNuevoCompartidoData($rut, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "SELECT
    h.*,
    (select nombre_completo from tbl_usuario where rut=h.rut_remitente) as nombre_completo,
    (select nombre from tbl_mp where id_mp=h.id_mp) as titulo_post
    FROM
    tbl_mp_interacciones h
    WHERE
    h.tipo = 'COMPARTIDOCONMIGO'
    AND h.rut = '$rut' AND h.rut_remitente<>'$rut'
    AND h.visto IS NULL
    AND h.id_empresa = '$id_empresa'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function vio_vide_intro($rut, $ambiente, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $sql      = "select count(h.id) as cuenta from tbl_banner_visto h where h.rut='$rut' and h.id_empresa='$id_empresa' and h.ambiente='$ambiente'";
    //echo $sql;
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function inserta_vio_video($rut, $ambiente, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $fecha    = date("Y-m-d");
    $sql      = "insert into tbl_banner_visto (rut, id_empresa, ambiente, fecha)
    values ('$rut', '$id_empresa', '$ambiente', '$fecha')";
    $database->setquery($sql);
    $database->query();
}
function premio_solicitud_jefe_validacion($id, $id_empresa, $rut, $tipo)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    if ($tipo == 1) {
        $sql = "update tbl_premios_canje set estadovalidacion='1' where id='$id' ";
    } elseif ($tipo == 3) {
        $sql = "delete  from tbl_premios_canje  where id='$id' ";
    }

    //echo $sql;sleep(3);

    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function rutesvigente($rut, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $sql      = "select vigencia from tbl_usuario h where h.rut='$rut' and h.id_empresa='$id_empresa' ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();



    return $cod[0]->vigencia;
}
function jefesaldopuntos_reco($rut, $id_empresa){
     global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $sql      = "
    select h.rut, sum(puntos) as Recibidos,
    (select sum(puntos) from tbl_premios_puntos_usuarios_jefe_entregados where rut=h.rut) as CuentaEntregados


    from tbl_premios_puntos_usuarios_jefe h

    where h.rut='$rut' and h.id_empresa='$id_empresa'
     ";
     //echo $sql;
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();

    $cod[0]->Recibidos;
    $cod[0]->CuentaEntregados;

    $saldo= $cod[0]->Recibidos  -   $cod[0]->CuentaEntregados;
   // echo "<br>".$cod[0]->Recibidos;
    //echo "<br>".$cod[0]->CuentaEntregados;
   // echo "<br>".$saldo;
    //print_r($cod);
    return $saldo;
}

function Reco_espartedeEquipo($colsend, $rut) {
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $sql      = "select count(id) as cuenta from tbl_usuario where rut='$colsend' and jefe='$rut' ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod[0]->cuenta;
}

function rutesjefe($rut, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $sql      = "select count(h.id) as cuenta from tbl_usuario h where h.jefe='$rut' and h.id_empresa='$id_empresa' ";
    //echo $sql;
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function premios_solicitudes_pendientes($rut, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $sql      = "

    SELECT h.*,
        (select nombre_completo from tbl_usuario where rut=h.rut) as nombre_persona,
        (select premio from tbl_premios where id_premio=h.id_premio and id_empresa='$id_empresa') as nombre_premio

    from tbl_premios_canje h

    where

(
    h.rut = '$rut' or h.rut_jefe='$rut'
        or (select responsable from tbl_usuario where rut=h.rut and id_empresa=h.id_empresa limit 1)='$rut'
        or (select lider from tbl_usuario where rut=h.rut and id_empresa=h.id_empresa limit 1)='$rut'
)

and h.id_empresa='$id_empresa' and h.estadovalidacion='2' order by h.id DESC;

    ";

    //echo $sql;
    sleep(1);

    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function premios_guarda_solicitud($rut, $id_premio, $rut_jefe, $id_empresa, $fecha_texto, $fecha_solicitud, $hora_inicio, $hora_termino)
{

    //echo "$rut, $id_premio, $rut_jefe"; sleep(10);
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $fecha    = date("Y-m-d");
    $hora     = date("H:i:s");
    $sql2     = "select h.* from tbl_premios h where h.id_premio='$id_premio' and h.id_empresa='$id_empresa' ";
    $database->setquery($sql2);
    $database->query();
    $cod2 = $database->listObjects();
    $sql3 = "select h.* from tbl_premios_canje h where h.id_premio='$id_premio' and h.id_empresa='$id_empresa' and h.rut='$rut'
    and h.fecha='$fecha'  and h.hora_inicio='$hora_inicio'  and h.hora_termino='$hora_termino'";
    $database->setquery($sql3);
    $database->query();
    $cod3                = $database->listObjects();
    $data_usuario_puntos = premios_buscadatos($rut, $id_empresa);
    $validacionpuntos    = 0;
    if ($data_usuario_puntos[0]->puntossaldo >= $cod2[0]->puntos) {
        $validacionpuntos = 1;
    }
    if (count($cod3) == 0 and $validacionpuntos == 1) {
        $sql = "INSERT INTO tbl_premios_canje (rut, id_premio, fecha, hora, puntos, rut_jefe, id_empresa, estadovalidacion,
    fecha_texto, fecha_solicitud,hora_inicio,hora_termino) " . "VALUES ('$rut', '$id_premio', '$fecha', '$hora', " . $cod2[0]->puntos . ", '$rut_jefe', '$id_empresa', '2',
    '$fecha_texto', '$fecha_solicitud','$hora_inicio','$hora_termino');";
        $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();
        $swa = "solicitud";
    } elseif ($validacionpuntos == 0) {
        $swa = "sinpuntos";
    } elseif (count($cod3) > 0) {
        $swa = "solicitudyarealizada";
    }

    //echo "sql $sql";

    return $swa;
}


function premios_guarda_solicitud_estado($rut, $id_premio, $rut_jefe, $id_empresa, $fecha_texto, $fecha_solicitud, $hora_inicio, $hora_termino, $estado)
{

    //echo "$rut, $id_premio, $rut_jefe"; sleep(1);
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $fecha    = date("Y-m-d");
    $hora     = date("H:i:s");
    $sql2     = "select h.* from tbl_premios h where h.id_premio='$id_premio' and h.id_empresa='$id_empresa' ";
    $database->setquery($sql2);
    $database->query();
    $cod2 = $database->listObjects();
    $sql3 = "select h.* from tbl_premios_canje h where h.id_premio='$id_premio' and h.id_empresa='$id_empresa' and h.rut='$rut'
    and h.fecha='$fecha'  and h.hora_inicio='$hora_inicio'  and h.hora_termino='$hora_termino'";
    $database->setquery($sql3);
    $database->query();
    $cod3                = $database->listObjects();
    $cod3=array();


    //print_r($cod3);
    $data_usuario_puntos = premios_buscadatos($rut, $id_empresa);
    $validacionpuntos    = 0;
    if ($data_usuario_puntos[0]->puntossaldo >= $cod2[0]->puntos) {
        $validacionpuntos = 1;
    }
    if (count($cod3) == 0 and $validacionpuntos == 1) {
        $sql = "INSERT INTO tbl_premios_canje (rut, id_premio, fecha, hora, puntos, rut_jefe, id_empresa, estadovalidacion,
    fecha_texto, fecha_solicitud,hora_inicio,hora_termino) " . "VALUES ('$rut', '$id_premio', '$fecha', '$hora', " . $cod2[0]->puntos . ", '$rut_jefe', '$id_empresa', '$estado',
    '$fecha_texto', '$fecha_solicitud','$hora_inicio','$hora_termino');";
        $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();
        $swa = "solicitud";
    } elseif ($validacionpuntos == 0) {
        $swa = "sinpuntos";
    } elseif (count($cod3) > 0) {
        $swa = "solicitudyarealizada";
    }

    //echo "sql $sql";

    return $swa;
}


function premios_buscadatos($rut, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $sql      = "

    select sum(h.puntos) as puntosrecibidos,
    (IFNULL((select sum(puntos) from tbl_premios_canje where rut='$rut' and id_empresa='$id_empresa'), 0)) as puntoscanjeados,
    (sum(h.puntos) - (IFNULL((select sum(puntos) from tbl_premios_canje where rut='$rut' and id_empresa='$id_empresa'), 0))) as puntossaldo
    from tbl_premios_puntos_usuarios h where h.rut='$rut' and h.id_empresa='$id_empresa'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function premios_ultimos_canjes($id_empresa, $rut, $limit)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $sql      = "

    select h.*,(select premio from tbl_premios where id_premio=h.id_premio  and id_empresa='$id_empresa') as nombre_premio


    from tbl_premios_canje h
    where h.rut='$rut' and h.id_empresa='$id_empresa' order by fecha DESC limit $limit

    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function premios_ranking_canjes($id_empresa, $limit)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $sql      = "

    select h.*,count(h.id) as cuenta, (select premio from tbl_premios where id_premio=h.id_premio and id_empresa='$id_empresa') as nombre_premio


    from tbl_premios_canje h

    where   h.id_empresa='$id_empresa' and h.estadovalidacion='1'

    group by h.id_premio

    order by count(h.id) DESC limit $limit
    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function premios_ultimos_canjes_globales($id_empresa, $limit)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $sql      = "

    select h.*,(select premio from tbl_premios where id_premio=h.id_premio  and id_empresa='$id_empresa') as nombre_premio


    from tbl_premios_canje h
    where  h.id_empresa='$id_empresa' and h.estadovalidacion='1' order by fecha DESC limit $limit

    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function premios_ultimos_puntos_recibidos($id_empresa, $rut, $limit)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $sql      = "



    select h.*
    from tbl_premios_puntos_usuarios h
    where h.rut='$rut' and h.id_empresa='$id_empresa' order by fecha DESC limit $limit


    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function EMBAJADORES_DetallePlanVistaTutor($id_empresa, $rut, $rut_r2)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    if ($rut_r2) {
        $filtro_r2 = "and tbl_planes_embajadores_reunion_inicial.r2='$rut_r2'";
    }
    $sql = "SELECT
    distinct(tbl_planes_embajadores.nombre_emb) as nombre_plan, plan, resumen, linkresumen, factor_exito, ambito, periodicidad, nombre_kpi, kpi_inicial, kpi_esperado
    FROM
    tbl_planes_embajadores_reunion_inicial

    left join tbl_planes_embajadores
    on tbl_planes_embajadores.id_plan_emb=tbl_planes_embajadores_reunion_inicial.plan

    WHERE
    tbl_planes_embajadores_reunion_inicial.id_empresa = '$id_empresa'
    AND tbl_planes_embajadores_reunion_inicial.rut = '$rut' $filtro_r2



    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function INTERACCIONES_TotalComentariosPorId($id_comentario)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
    select tbl_interacciones_reply.*, nombre_completo

    from tbl_interacciones_reply
    inner join tbl_usuario
    on tbl_usuario.rut=tbl_interacciones_reply.rut_autor


    where tbl_interacciones_reply.id_interaccion='$id_comentario'


    order by tbl_interacciones_reply.id desc

    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function EMBAJADORES_InsertaComentariosRply($comentario, $rut, $id_empresa, $id_comentario)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $fecha = date("Y-m-d");
    $hora  = date("H:i:s");
    $sql   = "INSERT INTO tbl_interacciones_reply(rut_autor, comentario, fecha, hora, id_empresa, id_interaccion) " . "VALUES ('$rut', '$comentario', '$fecha', '$hora', '$id_empresa', '$id_comentario');";
    $database->setquery($sql);
    $database->query();
}
function TotalUsuariosMiRut($rut)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
    select     h.*,
    (select count(id) from tbl_lms_acciones_pendientes where rut_colaborador=h.rut)  as cuenta
    from tbl_usuario h
    where h.rut='$rut'
    and h.vigencia='0'
    order by (select count(id) from tbl_lms_acciones_pendientes where rut_colaborador=h.rut) desc, h.nombre asc
    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function com_mp_resultados_inteligentes($id_empresa, $tipo_query, $limit, $ambiente, $subcategoria)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $tipo_query          = utf8_decode($tipo_query);
    $tipo_query_busqueda = preg_replace(array(
        '/\Como\b/',
        '/\bCmo\b/',
        '/\como\b/',
        '/\el\b/'
    ), array(
        '',
        '',
        '',
        ''
    ), $tipo_query);
//$querySub=" and (select id_subcategoria from tbl_mp where id_mp=h.codigo limit 1 ) ='' ";
if($subcategoria<>''){$querySub=" and  (select id_subcategoria from tbl_mp where id_mp=h.codigo limit 1 ) ='$subcategoria' ";}
    //echo "<br>"; echo $tipo_query;
    //if($subcategoria<>'') {
    //$query_subcategoria=" and h.tipo<>'expertos' and (select id_subcategoria from tbl_mp where id_mp=h.codigo)='".$subcategoria."' ";}
    //else {$query_subcategoria=" and (select id_subcategoria from tbl_mp where id_mp=h.codigo)=''";}
    //$query_subcategoria
    $sql                 = "
    SELECT h.*,h.tipo as tipoVista,
    (select rut from tbl_mp where id_mp=h.codigo limit 1 ) as rut,
    (select id_estado from tbl_mp where id_mp=h.codigo limit 1) as id_estado,
    (select nombre_completo from tbl_usuario where rut=(select rut from tbl_mp where id_mp=h.codigo  limit 1 ) limit 1 ) as nombre_autor,
    (select nombre_completo from tbl_usuario where rut=h.codigo limit 1) as nombre_experto,
    (select count(id) from tbl_mp_interacciones where id_mp=h.codigo and tipo='COMENTARIO' limit 1 ) AS numcomentarios,
    (select count(id) from tbl_mp_interacciones where id_mp=h.codigo and tipo='MEGUSTA' limit 1 ) AS nummegusta,
    (select count(id) from tbl_mp_interacciones where id_mp=h.codigo and tipo='COMPARTIDOCONMIGO' limit 1 ) AS numcompartido,
    (select count(id) from tbl_mp_interacciones where id_mp=h.codigo and tipo='VISITA' limit 1 ) AS numvisitas,
    (select fecha from tbl_mp where id_mp=h.codigo limit 1 ) as fecha,
    (select id_categoria from tbl_mp where id_mp=h.codigo limit 1 ) as id_categoria,
    (select categoria from tbl_mp_categorias where id_categoria=(select id_categoria from tbl_mp where id_mp=h.codigo  limit 1 ) limit 1 ) as categoria_mp,
    (select nombre from tbl_mp where id_mp=h.codigo  limit 1 ) as nombre,
    (select video from tbl_mp where id_mp=h.codigo  limit 1 ) as video,
    (select adjunto from tbl_mp where id_mp=h.codigo  limit 1 ) as adjunto,
    (select archivo from tbl_mp where id_mp=h.codigo  limit 1 ) as archivo,

    (select tipo from tbl_mp where id_mp=h.codigo limit 1 ) as tipo,
    (select imagenfondo from tbl_mp where id_mp=h.codigo limit 1 ) as imagenfondo,
    (select url_documento from tbl_mp where id_mp=h.codigo limit 1 ) as url_documento,
    (select tipo_post from tbl_mp where id_mp=h.codigo limit 1 ) as tipo_post,
    (select resumen from tbl_mp where id_mp=h.codigo limit 1 ) as resumen,
    (select fuente from tbl_mp where id_mp=h.codigo limit 1 ) as fuente,
    (select id_subcategoria from tbl_mp where id_mp=h.codigo limit 1 ) as id_subcategoria,

    MATCH(h.contenido,h.icono) AGAINST ('$tipo_query_busqueda' IN NATURAL LANGUAGE MODE) as score

    FROM tbl_mp_vista h

    WHERE MATCH(h.contenido,h.icono)

    AGAINST ('$tipo_query_busqueda' IN NATURAL LANGUAGE MODE)

    and h.id_empresa='$id_empresa'
    $querySub
    order by h.tipo ASC, score DESC, fecha DESC
    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
   // echo "<br><br><br><br>$sql<br><br>";
    //print_r($cod);
    //exit();
    return $cod;
}
function com_mp_resultados_inteligentesBK($id_empresa, $tipo_query, $limit, $ambiente)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database   = new database($c_host, $c_user, $c_pass);
    $table_name = "tbl_mp_vista";
    if ($ambiente == "expertos") {
        $first_field = "icono";
    } else {
        $first_field = "contenido";
    }
    $second_field   = "icono";
    $limitchar      = 2;
    $records_number = 6;
    $page_number    = 1;
    $nospaces       = substr($tipo_query, 0, 4);
    if ($tipo_query == "") {
    } else if (strlen($tipo_query) < $limitchar) {
        echo '<div id="counter">' . $limitchar . ' caracteres mnimos</div>';
        // } else if (preg_replace('/[a-zA-Z0-9]/', '', $nospaces)) {
        //   echo '<div id="counter">Por favor usa letras o nmeros</div>';
    } else {
        $arraySearch = explode(" ", $tipo_query);
        $arrayFields = array(
            0 => $first_field,
            1 => $second_field
        );
        $countSearch = count($arraySearch);
        $a           = 0;
        $b           = 0;
        $query       = "SELECT h.*,


    (select rut from tbl_mp where id_mp=h.codigo) as rut,
    (select id_estado from tbl_mp where id_mp=h.codigo limit 1) as id_estado,

    (select nombre_completo from tbl_usuario  where rut=(select rut from tbl_mp where id_mp=h.codigo)) as nombre_autor,
    (select nombre_completo from tbl_usuario where rut=h.codigo limit 1) as nombre_experto,
    (select count(id) from tbl_mp_interacciones where id_mp=h.codigo and tipo='COMENTARIO') AS numcomentarios,
    (select count(id) from tbl_mp_interacciones where id_mp=h.codigo and tipo='MEGUSTA') AS nummegusta,
    (select count(id) from tbl_mp_interacciones where id_mp=h.codigo and tipo='NOMEGUSTA') AS numnomegusta,

    (select count(id) from tbl_mp_interacciones where id_mp=h.codigo and tipo='COMPARTIDOCONMIGO') AS numcompartido,
    (select count(id) from tbl_mp_interacciones where id_mp=h.codigo and tipo='FAVORITA') AS numfavorita,
    (select count(id) from tbl_mp_interacciones where id_mp=h.codigo and tipo='VISITA') AS numvisitas,

    (select fecha from tbl_mp where id_mp=h.codigo) as fecha,
    (select id_categoria from tbl_mp where id_mp=h.codigo) as id_categoria,
    (select categoria from tbl_mp_categorias where id_categoria=h.contenido limit 1) as categoria_mp,

    (select nombre from tbl_mp where id_mp=h.codigo) as nombre,
    (select video from tbl_mp where id_mp=h.codigo) as video,
    (select adjunto from tbl_mp where id_mp=h.codigo) as adjunto,
    (select archivo from tbl_mp where id_mp=h.codigo) as archivo,
    (select tipo from tbl_mp where id_mp=h.codigo) as tipo,
    (select imagenfondo from tbl_mp where id_mp=h.codigo) as imagenfondo,
    (select url_documento from tbl_mp where id_mp=h.codigo) as url_documento,
    (select tipo_post from tbl_mp where id_mp=h.codigo) as tipo_post,
    (select resumen from tbl_mp where id_mp=h.codigo) as resumen,
    (select fuente from tbl_mp where id_mp=h.codigo) as fuente


    FROM $table_name h WHERE (";
        $countFields = count($arrayFields);
        while ($a < $countFields) {
            $campo = $arrayFields[$a];
            while ($b < $countSearch) {
                $query = $query . "h.$arrayFields[$a] LIKE '%$arraySearch[$b]%'";
                $b++;
                if ($b < $countSearch) {
                    $query = $query . " AND ";
                }
            }
            $b = 0;
            $a++;
            if ($a < $countFields) {
                $query = $query . ") OR (";
            }
        }
        $query       = $query . ")

    Group by h.codigo
    order by h.tipo asc

    ";
        $search      = mysql_query($query);
        $arrayFields = array(
            0 => $first_field,
            1 => $second_field
        );
        $countSearch = count($arraySearch);
        $a           = 0;
        $b           = 0;
        $query       = "SELECT

    h.contenido, h.tipo as tipopost, h.ambiente, h.codigo, h.id_empresa,


    (select rut from tbl_mp where id_mp=h.codigo limit 1) as rut,
    (select id_estado from tbl_mp where id_mp=h.codigo limit 1) as id_estado,

    (select nombre_completo from tbl_usuario  where rut=(select rut from tbl_mp where id_mp=h.codigo limit 1) limit 1) as nombre_autor,
    (select fecha from tbl_mp where id_mp=h.codigo limit 1) as fecha,
    (select nombre_completo from tbl_usuario where rut=h.codigo limit 1) as nombre_experto,
    (select count(id) from tbl_mp_interacciones where id_mp=h.codigo and tipo='COMENTARIO') AS numcomentarios,
    (select count(id) from tbl_mp_interacciones where id_mp=h.codigo and tipo='MEGUSTA') AS nummegusta,
    (select count(id) from tbl_mp_interacciones where id_mp=h.codigo and tipo='NOMEGUSTA') AS numnomegusta,
    (select count(id) from tbl_mp_interacciones where id_mp=h.codigo and tipo='COMPARTIDOCONMIGO') AS numcompartido,
    (select count(id) from tbl_mp_interacciones where id_mp=h.codigo and tipo='FAVORITA') AS numfavorita,
    (select count(id) from tbl_mp_interacciones where id_mp=h.codigo and tipo='VISITA') AS numvisitas,
    (select id_estado from tbl_mp where id_mp=h.codigo limit 1)  as id_estado,
    (select categoria from tbl_mp_categorias where id_categoria=h.contenido limit 1) as categoria_mp,

    (select id_categoria from tbl_mp where id_mp=h.codigo limit 1) as id_categoria,
    (select nombre from tbl_mp where id_mp=h.codigo limit 1) as nombre,
    (select video from tbl_mp where id_mp=h.codigo limit 1) as video,
    (select adjunto from tbl_mp where id_mp=h.codigo limit 1) as adjunto,
    (select archivo from tbl_mp where id_mp=h.codigo limit 1) as archivo,
    (select tipo from tbl_mp where id_mp=h.codigo limit 1) as tipo,
    (select imagenfondo from tbl_mp where id_mp=h.codigo limit 1) as imagenfondo,
    (select url_documento from tbl_mp where id_mp=h.codigo limit 1) as url_documento,
    (select tipo_post from tbl_mp where id_mp=h.codigo limit 1) as tipo_post,
    (select resumen from tbl_mp where id_mp=h.codigo limit 1) as resumen,
    (select fuente from tbl_mp where id_mp=h.codigo limit 1) as fuente,
    (select id from tbl_mp where id_mp=h.codigo limit 1) as idid_mp,
    (select categoria from tbl_mp_categorias where id_categoria=(select id_categoria from tbl_mp where id_mp=h.codigo limit 1) limit 1) as categoria

    FROM $table_name  h WHERE (tipo<>'tag')  and ( (";
        $countFields = count($arrayFields);
        while ($a < $countFields) {
            $campo = $arrayFields[$a];
            while ($b < $countSearch) {
                $query = $query . "h.$arrayFields[$a] LIKE '%$arraySearch[$b]%'";
                $b++;
                if ($b < $countSearch) {
                    $query = $query . " AND ";
                }
            }
            $b = 0;
            $a++;
            if ($a < $countFields) {
                $query = $query . ") OR (";
            }
        }
        $query = $query . ") )

    Group by h.codigo

    order by  (select tipo_post from tbl_mp where id_mp=h.codigo limit 1) DESC, (select id from tbl_mp where id_mp=h.codigo limit 1) DESC


    ";
    }
    //   echo "<br><br>$query";
    $query = utf8_decode($query);
    $database->setquery($query);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function EMBAJADORES_TraigoInterraccionesEmbajadores($id_empresa, $etapa, $usuario_embajadores, $r2)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    if ($etapa == "99") {
        $sql = "SELECT
    tbl_interacciones.*, nombre_completo
    FROM
    tbl_interacciones

    inner join tbl_usuario
    on tbl_usuario.rut=tbl_interacciones.rut_autor
    WHERE
    tbl_interacciones.id_empresa = '$id_empresa'
    AND etapa_embajadores = '$etapa'

    order by tbl_interacciones.id desc
    ";
    } else if ($etapa == "100") {
        $sql = "SELECT
    tbl_interacciones.*, nombre_completo
    FROM
    tbl_interacciones

    inner join tbl_usuario
    on tbl_usuario.rut=tbl_interacciones.rut_autor
    WHERE
    tbl_interacciones.id_empresa = '$id_empresa'
    AND etapa_embajadores = '$etapa'
    AND usuario_embajadores = '$usuario_embajadores'

    order by tbl_interacciones.id desc
    ";
    } else {
        $sql = "SELECT
    tbl_interacciones.*, nombre_completo
    FROM
    tbl_interacciones

    inner join tbl_usuario
    on tbl_usuario.rut=tbl_interacciones.rut_autor

    where
    (
    tbl_interacciones.id_empresa = '$id_empresa'
    AND etapa_embajadores = '$etapa'
    AND usuario_embajadores = '$usuario_embajadores'
    AND r2 = '$r2') or (tbl_interacciones.id_empresa = '$id_empresa'
    AND etapa_embajadores = '$etapa'
    AND usuario_embajadores = '$usuario_embajadores'
    AND r2 is null)


    order by tbl_interacciones.id desc
    ";
    }
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ColocaComentariosInterraccionesGenericoObjetosDATA($id_empresa, $etapa, $usuario_embajadores)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $sql      = "SELECT
    tbl_interacciones.*, nombre_completo
    FROM
    tbl_interacciones

    inner join tbl_usuario
    on tbl_usuario.rut=tbl_interacciones.rut_autor
    WHERE
    tbl_interacciones.id_empresa = '$id_empresa'
    AND etapa_embajadores = '$etapa'
    and tbl_interacciones.comentario<>''
    order by tbl_interacciones.id desc
    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function EMBAJADORES_InsertaComentarios($comentario, $rut, $id_empresa, $etapa_embajadores, $usuario_embajadores, $r2)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $fecha = date("Y-m-d");
    $hora  = date("H:i:s");
    $sql   = "INSERT INTO tbl_interacciones(rut_autor, comentario, fecha, hora, id_empresa, etapa_embajadores, usuario_embajadores, r2) " . "VALUES ('$rut', '$comentario', '$fecha', '$hora', '$id_empresa', '$etapa_embajadores', '$usuario_embajadores', '$r2');";
    $database->setquery($sql);
    $database->query();
}
function EMBAJADORES_VerificaValidacion2($id_empresa, $rut, $etapa, $rut_r2)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    if ($rut_r2) {
        $filtro_r2 = "and tbl_planes_embajadores_validaciones.r2='$rut_r2'";
    }
    $sql = "SELECT * from tbl_planes_embajadores_validaciones where rut='$rut' and id_empresa='$id_empresa' and etapa='$etapa' $filtro_r2 ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function EMBAJADORES_InsertaEstadoValidacion($embajador, $tutor, $etapa, $id_empresa, $estado_validacion, $comentario, $rut_r2)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $fecha = date("Y-m-d");
    $hora  = date("H:i:s");
    $sql   = "INSERT INTO tbl_planes_embajadores_validaciones(rut, tutor, fecha, hora, etapa, id_empresa, estado_validacion, comentario, r2    ) " . "VALUES ('$embajador', '$tutor', '$fecha', '$hora', '$etapa', '$id_empresa', '$estado_validacion', '$comentario', '$rut_r2');";
    $database->setquery($sql);
    $database->query();
}
function EMBAJADORES_UsuarioEsTutor($id_empresa, $rut)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $sql      = "SELECT
    tbl_planes_embajadores_reunion_inicial.*, baseembajador.nombre_completo, base_r2.nombre_completo as nombre_r2
    FROM
    tbl_planes_embajadores_reunion_inicial
    inner join tbl_usuario as baseembajador
    on baseembajador.rut=tbl_planes_embajadores_reunion_inicial.rut

    inner join tbl_usuario as base_r2
    on base_r2.rut=tbl_planes_embajadores_reunion_inicial.r2

    WHERE
    tbl_planes_embajadores_reunion_inicial.id_empresa = '$id_empresa'
    AND tbl_planes_embajadores_reunion_inicial.tutor = '$rut' ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function com_mp_mis_interacciones_perfil($rut, $id_empresa, $limit)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select h.*,
    (select nombre from tbl_mp where id_mp=h.id_mp) as post,
    (select rut from tbl_mp where id_mp=h.id_mp) as rutautor,
    (select nombre_completo from tbl_usuario where rut=h.rut_remitente) as remitente,
    (select categoria from tbl_mp_categorias where id_categoria=h.contenido) as categoria,
    (select nombre_completo from tbl_usuario where rut=(select rut from tbl_mp where id_mp=h.id_mp)) as autor

    from tbl_mp_interacciones h

    where
    id_empresa='$id_empresa' and tipo<>'VISITA' and tipo<>'APTITUD'

    and    ((select rut from tbl_mp where id_mp=h.id_mp limit 1)='$rut' or h.rut='$rut' )

    order by fecha DESC limit $limit";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function com_mp_busca_validacion_aptitudesPorCategoria($rut, $rut_remitente, $tipo, $id_empresa, $id_categoria)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $query_rut           = "";
    $query_rut_remitente = "";
    if ($rut <> '') {
        $query_rut = " and rut='$rut' ";
    }
    if ($rut_remitente <> '') {
        $query_rut_remitente = " and rut_remitente='$rut_remitente' ";
    }
    $sql = "select h.contenido, h.contenido as idcategoria, h.rut as rut_receptor, (select categoria from tbl_mp_categorias where id_categoria=h.contenido) as categoria,

    (select count(id) from tbl_mp_interacciones where tipo='APTITUD_VALIDADA' $query_rut_remitente  $query_rut and contenido=h.contenido) as yavalidada,
    (select count(id) from tbl_mp_interacciones where tipo='APTITUD_VALIDADA' $query_rut and contenido=h.contenido) as vecesvalidada

    from tbl_mp_interacciones h

    where h.rut='$rut' and h.id_empresa='$id_empresa' and tipo='APTITUD' and h.contenido='$id_categoria'  group by h.contenido";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function UsuarioHizoMegustaEnAptitud($rut_autor, $rut_remitente, $id_categoria, $tipo, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_mp_interacciones where rut='$rut_autor' and id_empresa='$id_empresa' and tipo='$tipo' and contenido='$id_categoria' and rut_remitente='$rut_remitente'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function InsertaAptitudValidadaPorUsuario($rutautor, $tipo, $id_empresa, $id_categoria, $rut_receptor, $valor_validacion)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $fecha = date("Y-m-d");
    $hora  = date("H:i:s");
    $sql   = "INSERT INTO tbl_mp_interacciones(rut, id_empresa, tipo, fecha, contenido, rut_remitente, mensaje) " . "VALUES ('$rut_receptor', '$id_empresa', '$tipo', '$fecha', '$id_categoria', '$rutautor', '$valor_validacion');";
    $database->setquery($sql);
    $database->query();
}
function EliminaAptitudPorUsuario($rut, $id_empresa, $tipo, $id_categoria)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = sprintf("DELETE from tbl_mp_interacciones WHERE rut= '$rut' and id_empresa='$id_empresa' and tipo='$tipo' and contenido='$id_categoria'");
    $database->setquery($sql);
    $database->query();
}
function InsertaAptitudPorUsuario($rut, $tipo, $id_empresa, $id_categoria)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $fecha = date("Y-m-d");
    $hora  = date("H:i:s");
    $sql   = "INSERT INTO tbl_mp_interacciones(rut, id_empresa, tipo, fecha, contenido) " . "VALUES ('$rut', '$id_empresa', '$tipo', '$fecha', '$id_categoria');";
    $database->setquery($sql);
    $database->query();
}
function com_tiene_aptitud($rut, $tipo, $id_empresa, $id_categoria)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_mp_interacciones where rut='$rut' and id_empresa='$id_empresa' and tipo='APTITUD' and contenido='$id_categoria'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TraeMailsDesdeTablaMails()
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $sql      = "select * from mails";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function MP_EliminaTagsPorMP($id_mp)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = sprintf("DELETE from tbl_mp_tag WHERE id_mp = '$id_mp'");
    $database->setquery($sql);
    $database->query();
}
function MP_EliminaVistaPorMP($id_mp)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = sprintf("DELETE from tbl_mp_vista WHERE codigo = '$id_mp'");
    $database->setquery($sql);
    $database->query();
}
function ActualizaDatosMPBCI($id_mp, $id_categoria, $nombre, $contenido, $video, $archivo, $tipo, $imagenfondo, $url_documento, $resumen, $fuente)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);

    if($nombre<>'')         {$qnombre=",  nombre='$nombre'";}
    if($imagenfondo<>'')    {$qimagenfondo=",  imagenfondo='$imagenfondo'";}
    if($contenido<>'')      {$qcontenido=",  contenido='$contenido'";}
    if($video<>'')          {$qvideo=",  video='$video'";}
    if($archivo<>'')        {$qarchivo=",  archivo='$archivo'";}
    if($tipo<>'')           {$qtipo=",  tipo='$tipo'";}
    if($url_documento<>'')  {$qurl_documento=",  url_documento='$url_documento'";}
    if($resumen<>'')        {$qresumen=", resumen='$resumen'";}
    if($fuente<>'')         {$qfuente=" fuente='$fuente";}





    $sql = "UPDATE tbl_mp
    SET id_categoria= '$id_categoria' $qnombre $qimagenfondo $qcontenido $qvideo $qarchivo  $qtipo  $qurl_documento  $qresumen  $qfuente

    where id_mp='$id_mp'";
    //echo $sql;
    $database->setquery($sql);
    $database->query();
}
function ActualizaRespondeDatosMPBCI($id_mp, $id_categoria, $nombre, $contenido, $video, $archivo, $tipo, $imagenfondo, $url_documento, $resumen, $fuente, $rutmentor)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "UPDATE tbl_mp
    SET id_categoria= '$id_categoria',  nombre='$nombre', imagenfondo='$imagenfondo', contenido='$contenido',
    video='$video', archivo='$archivo',
    tipo='$tipo', url_documento='$url_documento', resumen='$resumen', fuente='$fuente', rut_mentor='$rutmentor'
    where id_mp='$id_mp'";
    $database->setquery($sql);
    $database->query();
}
function EMBAJADORES_EntregablesPorTarea($id_empresa, $id_tarea)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $sql      = "select * from tbl_planes_tareas_entregables where id_empresa='$id_empresa'  and id_Tarea='$id_tarea' ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function EMBAJADORES_ActualizaDatosReunionInicial($rut, $id_empresa, $tutor, $r2, $fecha)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "UPDATE tbl_planes_embajadores_reunion_inicial
    SET r2= '$r2', tutor='$tutor', fecha='$fecha'
    where id_empresa='$id_empresa' and rut='$rut'";
    $database->setquery($sql);
    $database->query();
}
function EMBAJADORES_ActualizaDesarrolloTarea($rut, $id_empresa, $id_tarea, $link_drive)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "UPDATE tbl_planes_embajadores_desarrollo_tarea
    SET link_drive= '$link_drive'
    where id_empresa='$id_empresa' and rut='$rut' and id_tarea='$id_tarea' ";
    $database->setquery($sql);
    $database->query();
}
function EMBAJADORES_InsertaDesarrolloTarea($rut, $id_empresa, $id_tarea, $link_drive)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $fecha = date("Y-m-d");
    $hora  = date("H:i:s");
    $sql   = "INSERT INTO tbl_planes_embajadores_desarrollo_tarea(id_empresa, rut, id_tarea, link_drive) " . "VALUES ('$id_empresa', '$rut', '$id_tarea', '$link_drive');";
    $database->setquery($sql);
    $database->query();
}
function EMBAJADORES_TieneDesarrolloTareaSoloRut($id_empresa, $rut)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $sql      = "select * from tbl_planes_embajadores_desarrollo_tarea where rut='$rut'  and id_empresa='$id_empresa' ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function EMBAJADORES_TieneDesarrolloTarea($id_empresa, $rut, $id_tarea)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $sql      = "select * from tbl_planes_embajadores_desarrollo_tarea where rut='$rut'  and id_empresa='$id_empresa' and id_tarea='$id_tarea'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function EMBAJADORES_TraigoTareasPorActividadYRutSoloRutYEmpresa($id_empresa, $rut, $rut_r2)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    if ($rut_r2) {
        $filtro1_r2 = "inner join tbl_planes_embajadores_reunion_inicial
    on tbl_planes_embajadores_reunion_inicial.rut=tbl_plan_embajadores_tareas_por_actividad.rut and
    tbl_planes_embajadores_reunion_inicial.plan=tbl_plan_embajadores_tareas_por_actividad.id_plan
    and tbl_planes_embajadores_reunion_inicial.r2='$rut_r2'";
    }
    $sql = "
    select
    tbl_plan_embajadores_tareas_por_actividad.*, link_drive,  tbl_planes_embajadores_tareas_validadas.fecha as fecha_tarea_validada

    from tbl_plan_embajadores_tareas_por_actividad

    $filtro1_r2

    left join tbl_planes_embajadores_desarrollo_tarea
    on tbl_planes_embajadores_desarrollo_tarea.rut=tbl_plan_embajadores_tareas_por_actividad.rut and tbl_planes_embajadores_desarrollo_tarea.id_tarea=tbl_plan_embajadores_tareas_por_actividad.id_tarea

    left join tbl_planes_embajadores_tareas_validadas
    on tbl_planes_embajadores_tareas_validadas.rut=tbl_plan_embajadores_tareas_por_actividad.rut
    and tbl_planes_embajadores_tareas_validadas.id_tarea=tbl_plan_embajadores_tareas_por_actividad.id_tarea


    where tbl_plan_embajadores_tareas_por_actividad.rut='$rut'  and
    tbl_plan_embajadores_tareas_por_actividad.id_empresa='$id_empresa' ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function EMBAJADORES_CalendarizacionTareaPorUsuario($id_empresa, $rut, $rut_r2)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    if ($rut_r2) {
        $filtro1_r2 = "INNER JOIN tbl_plan_embajadores_tareas_por_actividad ON tbl_plan_embajadores_tareas_por_actividad.id_tarea = tbl_planes_embajadores_calendarizacion_tareas.id_tarea

    inner join tbl_planes_embajadores_reunion_inicial
    on tbl_planes_embajadores_reunion_inicial.plan=tbl_plan_embajadores_tareas_por_actividad.id_plan
    and tbl_planes_embajadores_reunion_inicial.r2='$rut_r2'
    ";
    }
    $sql = "select tbl_planes_embajadores_calendarizacion_tareas.*
    from tbl_planes_embajadores_calendarizacion_tareas

    $filtro1_r2

    where

    tbl_planes_embajadores_calendarizacion_tareas.rut='$rut'  and
    tbl_planes_embajadores_calendarizacion_tareas.id_empresa='$id_empresa'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function EMBAJADORES_VerificaValidacion($id_empresa, $rut, $tipo)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $sql      = "select * from tbl_planes_embajadores_estados where rut='$rut' and  id_empresa='$id_empresa' and etapa='$tipo' ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function EMBAJADORES_CalendarizacionTareaPorSemanaTexto($id_empresa, $tarea, $rut)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $sql      = "select * from tbl_planes_embajadores_calendarizacion_tareas_observaciones where rut='$rut' and id_tarea='$tarea'
    and id_empresa='$id_empresa' order by id DESC limit 1";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function EMBAJADORES_CalendarizacionTareaPorSemana($id_empresa, $tarea, $rut, $semana)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $sql      = "select * from tbl_planes_embajadores_calendarizacion_tareas where rut='$rut' and id_tarea='$tarea' and id_empresa='$id_empresa' and semana='$semana' ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function EMBAJADORES_InsertaCalendarizacionTexto($rut, $id_empresa, $id_tarea, $semana, $texto)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $fecha = date("Y-m-d");
    $hora  = date("H:i:s");
    $sql   = "INSERT INTO tbl_planes_embajadores_calendarizacion_tareas_observaciones(id_empresa, rut, id_tarea, texto) " . "VALUES ('$id_empresa', '$rut', '$id_tarea', '$texto');";
    $database->setquery($sql);
    $database->query();
}
function EMBAJADORES_InsertaCalendarizacion($rut, $id_empresa, $id_tarea, $semana)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $fecha = date("Y-m-d");
    $hora  = date("H:i:s");
    $sql   = "INSERT INTO tbl_planes_embajadores_calendarizacion_tareas(id_empresa, rut, id_tarea, semana) " . "VALUES ('$id_empresa', '$rut', '$id_tarea', '$semana');";
    $database->setquery($sql);
    $database->query();
}
function EMBAJADORES_TraigoTareasPorActividadYRutSoloRut($id_empresa, $id_plan, $rut)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $sql      = "SELECT
    tbl_plan_embajadores_tareas_por_actividad.*, tbl_planes_embajadores_desarrollo_tarea.link_drive
    FROM
    tbl_plan_embajadores_tareas_por_actividad
    LEFT JOIN tbl_planes_embajadores_desarrollo_tarea ON tbl_planes_embajadores_desarrollo_tarea.rut = tbl_plan_embajadores_tareas_por_actividad.rut
    AND tbl_planes_embajadores_desarrollo_tarea.id_tarea = tbl_plan_embajadores_tareas_por_actividad.id_tarea
    AND tbl_planes_embajadores_desarrollo_tarea.id_empresa = tbl_plan_embajadores_tareas_por_actividad.id_empresa
    WHERE
    tbl_plan_embajadores_tareas_por_actividad.rut = '$rut'
    AND tbl_plan_embajadores_tareas_por_actividad.id_plan = '$id_plan'
    AND tbl_plan_embajadores_tareas_por_actividad.id_empresa = '$id_empresa'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function EMBAJADORES_TraigoTareasPorActividadYRut($id_empresa, $actividad, $id_plan, $rut, $tarea)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $sql      = "select * from tbl_plan_embajadores_tareas_por_actividad where rut='$rut' and id_plan='$id_plan' and actividad='$actividad' and id_empresa='$id_empresa' and tarea='$tarea'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function EMBAJADORES_ActividadDadaTareaEmpresaYPlan($id_tarea, $id_empresa, $id_plan)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $sql      = "select actividad, tarea from tbl_planes_embajadores where id_plan_emb='$id_plan' and id_empresa='$id_empresa' and id_tarea='$id_tarea'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function InsertaTareasPorActividad($rut, $id_plan, $actividad, $tarea, $id_empresa, $id_tarea)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $fecha = date("Y-m-d");
    $hora  = date("H:i:s");
    $sql   = "INSERT INTO tbl_plan_embajadores_tareas_por_actividad(rut, id_plan, actividad, tarea, id_empresa, id_tarea) " . "VALUES ('$rut', '$id_plan', '$actividad', '$tarea', '$id_empresa', '$id_tarea' );";
    $database->setquery($sql);
    $database->query();
}
function EMBAJADORES_TraigoTareasPorActividad($id_empresa, $actividad, $id_plan)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $sql      = "SELECT * from tbl_planes_embajadores where id_plan_emb='$id_plan' and id_empresa='$id_empresa' and actividad='$actividad'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function EMBAJADORES_DistinctActividadesDadoPlan($id_empresa, $id_plan)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $sql      = "SELECT distinct(actividad) as valor from tbl_planes_embajadores where id_plan_emb='$id_plan' and id_empresa='$id_empresa'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function EMBAJADORES_DatosPlanReunionInicial($id_empresa, $rut, $rut_r2)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    if ($rut_r2) {
        $filtro_r2 = "and tbl_planes_embajadores_reunion_inicial.r2='$rut_r2'";
    }
    $sql = "SELECT
    tbl_planes_embajadores_reunion_inicial.*,
    (select nombre_emb from tbl_planes_embajadores where tbl_planes_embajadores.id_plan_emb=tbl_planes_embajadores_reunion_inicial.plan limit 1) as nombre_plan,
    base_r2.nombre_completo as nombre_r2

    from  tbl_planes_embajadores_reunion_inicial

    left join tbl_usuario as base_r2
    on base_r2.rut=tbl_planes_embajadores_reunion_inicial.r2


    WHERE     tbl_planes_embajadores_reunion_inicial.id_empresa = '$id_empresa' and tbl_planes_embajadores_reunion_inicial.rut='$rut' $filtro_r2";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function EMBAJADORES_ActualizaPlan($rut, $id_empresa, $id_plan, $factor_exito, $rut_r2)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    if ($rut_r2) {
        $filtro_r2 = "and r2='$rut_r2'";
    }
    $sql = "UPDATE tbl_planes_embajadores_reunion_inicial
    SET plan= '$id_plan', factor_exito='$factor_exito'
    where id_empresa='$id_empresa' and rut='$rut' $filtro_r2 ";
    $database->setquery($sql);
    $database->query();
}
function EMBAJADORES_ActualizaPlanSoloPlan($rut, $id_empresa, $id_plan, $rut_r2)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    if ($rut_r2) {
        $filtro_r2 = "and r2='$rut_r2'";
    }
    $sql = "UPDATE tbl_planes_embajadores_reunion_inicial
    SET plan= '$id_plan'
    where id_empresa='$id_empresa' and rut='$rut' $filtro_r2 ";
    $database->setquery($sql);
    $database->query();
}
function EMBAJADORES_ListadoTutores($id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $sql      = "SELECT
    tbl_planes_embajadores_tutor.*, nombre_completo
    FROM
    tbl_planes_embajadores_tutor

    inner join tbl_usuario
    on tbl_usuario.rut=tbl_planes_embajadores_tutor.rut
    WHERE
    tbl_planes_embajadores_tutor.id_empresa = '$id_empresa' order by nombre_completo asc";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function EMBAJADORES_ListadoR2($id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $sql      = "SELECT
    tbl_planes_embajadores_r2.*, nombre_completo
    FROM
    tbl_planes_embajadores_r2

    inner join tbl_usuario
    on tbl_usuario.rut=tbl_planes_embajadores_r2.rut
    WHERE
    tbl_planes_embajadores_r2.id_empresa = '$id_empresa' order by nombre_completo asc";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TraeEmbajadoresDistinct($id_empresa, $rut, $rut_r2, $id_plan_seleccionado)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    if ($rut_r2) {
        $filtro_r2 = "and tbl_planes_embajadores_reunion_inicial.r2='$rut_r2'";
    }
    if ($id_plan_seleccionado) {
        $filtro_plan_seleccionado = " and id_plan_emb='$id_plan_seleccionado' ";
    }
    $sql = "select distinct(nombre_emb) as valor, resumen, id_plan_emb, linkresumen from tbl_planes_embajadores where  id_empresa='$id_empresa'  ";
    $sql = "SELECT DISTINCT
    (tbl_planes_embajadores.nombre_emb) AS valor,
    tbl_planes_embajadores.resumen,
    tbl_planes_embajadores.id_plan_emb,
    tbl_planes_embajadores.linkresumen,
    tbl_planes_embajadores_reunion_inicial.plan,
    tbl_planes_embajadores_reunion_inicial.factor_exito
    FROM
    tbl_planes_embajadores
    left join tbl_planes_embajadores_reunion_inicial
    on tbl_planes_embajadores_reunion_inicial.plan=tbl_planes_embajadores.id_plan_emb and tbl_planes_embajadores_reunion_inicial.rut='$rut' $filtro_r2
    WHERE
    tbl_planes_embajadores.id_empresa = '$id_empresa' $filtro_plan_seleccionado
    order by tbl_planes_embajadores_reunion_inicial.plan desc ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function InsertaReunionInicial($rut, $id_empresa, $r2, $tutor, $fecha)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $fecha = date("Y-m-d");
    $hora  = date("H:i:s");
    $sql   = "INSERT INTO tbl_planes_embajadores_reunion_inicial(rut, id_empresa, r2, tutor, fecha) " . "VALUES ('$rut', '$id_empresa', '$r2', '$tutor', '$fecha' );";
    $database->setquery($sql);
    $database->query();
}
function EliminaInteraccion($tipo, $id_mp, $rut, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = sprintf("DELETE from tbl_mp_interacciones WHERE id_mp = '$id_mp' and rut='$rut' and id_empresa='$id_empresa' and tipo='$tipo'");

    $database->setquery($sql);
    $database->query();
}
function TraeCerficicacionesPorRutEmpresa($id_empresa, $rut)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $sql      = "
    select rut, certificacion, fecha, nota from tbl_certificaciones_data where rut='$rut' and id_empresa='$id_empresa' GROUP BY rut, certificacion
    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function EliminaPostComunidad($id_mp)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = sprintf("update tbl_mp set id_estado='4' WHERE id_mp = '$id_mp'");
    $database->setquery($sql);
    $database->query();
}
function TraeClasificacionesPorEmpresaPrograma($id_empresa, $id_programa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $sql      = "
    SELECT DISTINCT
    (
    rel_lms_malla_curso.id_clasificacion
    ),
    tbl_lms_clasificacion.clasificacion AS nombre_clasificacion,
    tbl_lms_clasificacion.descripcion AS descripcion_clasificacion,
    tbl_lms_clasificacion.imagen AS imagen_clasificacion
    FROM
    rel_lms_malla_curso
    INNER JOIN tbl_lms_clasificacion ON tbl_lms_clasificacion.id_clasificacion = rel_lms_malla_curso.id_clasificacion
    WHERE
    rel_lms_malla_curso.id_programa = '$id_programa'
    AND rel_lms_malla_curso.id_empresa = '$id_empresa'


    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TraeTotalDESesionesPorImparticion($id_empresa, $id_inscripcion)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $sql      = "SELECT
    rel_lms_inscripcion_sesion.*
    FROM
    rel_lms_inscripcion_sesion



    WHERE
    codigo_inscripcion = '$id_inscripcion'
    AND rel_lms_inscripcion_sesion.id_empresa = '$id_empresa'

    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ActualizaComentariosEncGeneral($rut, $id_empresa, $id_objeto, $id_encuesta, $comentario_final, $comentario_final2)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "UPDATE tbl_enc_satis_comentarios_finales
    SET comentario= '$comentario_final', comentario2= '$comentario_final2'
    where id_empresa='$id_empresa' and rut='$rut' and id_objeto='$id_objeto' and id_encuesta='$id_encuesta'  AND (rut_relator = '' or rut_relator is null) ";
    $database->setquery($sql);
    $database->query();
}
function TieneComentarioFinalEncSatisGeneral($rut, $id_empresa, $id_objeto, $id_encuesta)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "SELECT
    *
    FROM
    tbl_enc_satis_comentarios_finales
    WHERE
    rut = '$rut'
    AND id_empresa = '$id_empresa'
    AND id_objeto = '$id_objeto'
    AND (rut_relator = '' or rut_relator is null)    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ActualizaRespuestasPorPReguntaEncuesta($rut, $id_empresa, $id_objeto, $id_encuesta, $id_pregunta, $respuesta)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "UPDATE tbl_enc_satis_respuestas
    SET respuesta= '$respuesta'
    where id_empresa='$id_empresa' and rut='$rut' and id_objeto='$id_objeto' and id_encuesta='$id_encuesta'  and id_pregunta='$id_pregunta' ";
    $database->setquery($sql);
    $database->query();
}
function TieneRespuestasPorPReguntaEncuesta($rut, $id_empresa, $id_objeto, $id_encuesta, $id_pregunta)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_enc_satis_respuestas where rut='$rut' and id_empresa='$id_empresa' and id_objeto='$id_objeto'  and id_pregunta='$id_pregunta'    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ActualizaPostulablesValidacionOk($rut, $id_empresa, $validacionok)
 {
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "UPDATE tbl_postulaciones
    SET validacionok= '$validacionok'
    where id_empresa='$id_empresa' and rut='$rut'  ";    // echo $sql; exit();
    $database->setquery($sql);
    $database->query();
}
function BuscaPostulableFullValidacionOk($rut, $id_empresa)
 {
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select h.*,
            (select nombre from  tbl_postulables where id_postulable=h.id_postulable) as nombre_curso

            from tbl_postulaciones h

            where h.rut='$rut' and h.id_empresa='$id_empresa'  ";
            //echo $sql;
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ActualizaRespuestasPorPReguntaRelatorEncuesta($rut, $id_empresa, $id_objeto, $id_encuesta, $rut_relator, $id_pregunta, $respuesta)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "UPDATE tbl_enc_satis_respuestas
    SET respuesta= '$respuesta'
    where id_empresa='$id_empresa' and rut='$rut' and id_objeto='$id_objeto' and id_encuesta='$id_encuesta' and rut_relator='$rut_relator' and id_pregunta='$id_pregunta' ";
    $database->setquery($sql);
    $database->query();
}
function TieneRespuestasPorPReguntaRelatorEncuesta($rut, $id_empresa, $id_objeto, $id_encuesta, $rut_relator, $id_pregunta)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_enc_satis_respuestas where rut='$rut' and id_empresa='$id_empresa' and id_objeto='$id_objeto' and rut_relator='$rut_relator' and id_pregunta='$id_pregunta'    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ActualizaComentariosEncPorRelator($rut, $id_empresa, $id_objeto, $id_encuesta, $rut_relator, $comentario_final, $comentario2)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "UPDATE tbl_enc_satis_comentarios_finales
    SET comentario= '$comentario_final',
    comentario2='$comentario2'
    where id_empresa='$id_empresa' and rut='$rut' and id_objeto='$id_objeto' and id_encuesta='$id_encuesta' and rut_relator='$rut_relator' ";
    $database->setquery($sql);
    $database->query();
}
function TieneComentarioFinalEncSatisEncuestaGeneral($rut, $id_empresa, $id_objeto, $id_encuesta)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_enc_satis_comentarios_finales where rut='$rut' and id_empresa='$id_empresa' and id_objeto='$id_objeto'     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TieneComentarioFinalEncSatisPorRelator($rut, $id_empresa, $id_objeto, $id_encuesta, $rut_relator)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_enc_satis_comentarios_finales where rut='$rut' and id_empresa='$id_empresa' and id_objeto='$id_objeto' and rut_relator='$rut_relator'    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ENC_TraigoDimensionesPorEncuestaEnc13Relatores($id_empresa, $id_encuesta)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_enc_satis_dim where iddimension='56'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ENC_TraigoDimensionesPorEncuestaEnc6Relatores($id_empresa, $id_encuesta)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_enc_satis_dim where iddimension='23' or   iddimension='24'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function traigoDimensionPremios_data($segmento, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "SELECT h.*, (select count(id) from tbl_premios where id_dimension=h.id_dimension and segmento=h.segmento) as cuenta from tbl_premios_dimension h WHERE h.segmento='$segmento' and h.id_empresa='$id_empresa'";
    //echo $sql;

    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}

function OfertaAbiertaDimensionData($id_empresa)
{

    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);

    $sql="
    select h.id_dimension as id, dimension as text from tbl_lms_dimension_curso h where h.id_empresa='$id_empresa' group by h.id_dimension

union select h.id_competencia1 as id, competencia1 as text from tbl_lms_dimension_curso h where h.id_empresa='$id_empresa' and competencia1<>'' group by h.competencia1

    ";

    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;


}

function OfertaAbiertaCursosDimensionData($id_empresa)
{

    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);

$sql=" select h.* from tbl_lms_dimension_curso h where h.id_empresa='$id_empresa' order by h.curso ";
//echo "<br>".$sql;
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;


}

function BuscarChecklistTipo($tipo,$id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);

    $sql=" select h.* from tbl_checklist_item h where h.id_empresa='$id_empresa' and h.tipo='$tipo' order by h.nombre_item ASC";
    // echo $sql;
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function BuscarChecklistTipoId($tipo,$id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);

    $sql=" select h.* from tbl_checklist_item h where h.id_empresa='$id_empresa' and h.tipo='$tipo' order by h.id ASC";
    //echo $sql;
    //echo $sql;
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function OfertaAbiertaCursosEventosDimensionData($id_dimension, $id_empresa)
{

    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);

    $sql=" select h.*,
    (select count(id) from tbl_eventos_inscritos where codigo=h.codigo and id_empresa=h.id_empresa) as inscritos
     from tbl_eventos h where h.id_empresa='$id_empresa' and h.id_dimension='$id_dimension' order by h.fecha_inicio DESC ";
    //echo "<br>OfertaAbiertaCursosEventosDimensionData $sql";

    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;


}

function OfertaAbierta_miinscripcion($rut, $id_evento, $id_empresa){

    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);

    $sql=" select count(h.id) as cuenta

     from tbl_eventos_inscritos h where h.id_empresa='$id_empresa' and h.codigo='$id_evento' and h.rut='$rut' ";
    //echo "<br>OfertaAbiertaCursosEventosDimensionData $sql";

    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod[0]->cuenta;

}

function FormacionContinua_AgrupacionData($id_empresa)
{

    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);

    $sql="
    select h.agrupacion1 as agrupacion, h.id_agrupacion1 as id_agrupacion  from tbl_postulables h where h.id_empresa='$id_empresa' and id_tipo='formacioncontinua' and h.agrupacion1<>'' UNION
    select h.agrupacion2 as agrupacion, h.id_agrupacion2 as id_agrupacion from tbl_postulables h where h.id_empresa='$id_empresa' and id_tipo='formacioncontinua' and h.agrupacion2<>'' UNION
    select h.agrupacion3 as agrupacion, h.id_agrupacion3 as id_agrupacion from tbl_postulables h where h.id_empresa='$id_empresa' and id_tipo='formacioncontinua' and h.agrupacion3<>''

    ";

    //echo $sql;
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;


}

function FormacionContinua_ModalidadData($id_empresa)
{

    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);

    $sql="
    select h.modalidad as agrupacion, h.id_modalidad as id_agrupacion  from tbl_postulables h where h.id_empresa='$id_empresa' and id_tipo='formacioncontinua' and h.modalidad<>'' group by h.modalidad
    ";

    //echo $sql;
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;


}

function FormacionContinua_CompetenciasData($id_empresa)
{

    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);

    $sql="
    select h.competencia1 as competencia, h.id_competencia1 as id_competencia from tbl_postulables h
    where h.id_empresa='$id_empresa' and id_tipo='formacioncontinua' and h.competencia1<>'' UNION
    select h.competencia2 as competencia, h.id_competencia2 as id_competencia   from tbl_postulables h
    where h.id_empresa='$id_empresa' and id_tipo='formacioncontinua' and h.competencia2<>'' UNION
    select h.competencia3 as competencia, h.id_competencia3 as id_competencia  from tbl_postulables h
    where h.id_empresa='$id_empresa' and id_tipo='formacioncontinua' and h.competencia3<>''
    ";

    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;


}

function FormacionContinua_CursosData($id_empresa, $region, $jefe)
{


    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);


    if($region<>''){ $query_region=" region='".$region."' ";} else {$query_region=" region is null  ";}
    if($jefe>0){ $query_jefe=" jefatura='solojefe' ";} else {$query_jefe=" jefatura is null ";}


$sql="

select h.*,

(select count(id) from tbl_postulables where id_dimension=h.id_dimension

    and ( $query_region or region is null )
    and ($query_jefe or jefatura is null )

) as cuenta
from tbl_postulables h where h.id_empresa='$id_empresa' and id_tipo='formacioncontinua' and h.id_dimension<>''

group by h.id_dimension

";
    //and (invisible='' or invisible is null)
    //echo "$sql"; exit();
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;


}

function Skill_Info_id_Curso($id_curso, $id_empresa){

    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);


    if($region<>''){ $query_region=" region='".$region."' ";} else {$query_region=" region is null  ";}
    if($jefe>0){ $query_jefe=" jefatura='solojefe' ";} else {$query_jefe=" jefatura is null ";}


$sql="

select h.* from

tbl_checklist_matriz_cursos h

where h.id_curso='$id_curso' and h.id_empresa='$id_empresa'
limit 1

";
    //and (invisible='' or invisible is null)
    //echo "$sql"; exit();
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;

}

function SkillBuscaMensaje($plataforma, $url, $id_empresa){

    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);




$sql="

select h.* from tbl_checklist_curso_mensajes h where plataforma='$plataforma' and id_empresa='$id_empresa'
limit 1

";
    //and (invisible='' or invisible is null)
    //echo "$sql"; exit();
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;


}

function FormacionContinua_Cursos_SkillsData($id_empresa, $rut, $parametro, $id_cargo)
{

    //echo  "$id_empresa, $rut, $id_cargo";
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);

$sql="

select h.*,

(select skill from tbl_checklist_matriz_cursos where id_skill=h.id_skill  limit 1) as Skill,
(select id_skill from tbl_checklist_matriz_cursos where id_skill=h.id_skill  limit 1) as Id_Skill,
(select url from tbl_checklist_matriz_cursos where id_skill=h.id_skill  limit 1) as Id_Skill_url

from tbl_checklist_skill_usuarios h

where id_cargo='$id_cargo' and rut='$rut' and id_empresa='$id_empresa'

";
    //and (invisible='' or invisible is null)
  //  echo "$sql., parametro $parametro"; exit();
    if($parametro=="full"){
        //echo "sql "; exit();

        $sql="select h.*

from tbl_checklist_matriz_cursos h

where id_cargo NOT LIKE '%INGLES%'


group by h.curso


order by h.curso


";

    //limit 10
    //echo "sql $sql";exit();

    }
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;


}
function FormacionContinua_Cursos_Por_SkillsData($id_empresa, $rut, $id_cargo, $id_skill, $nivel)
{

        //echo  "<br>$id_empresa, $rut, $id_cargo, $id_skill, $nivel";
        global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);

        $sql="

        select h.*,
        (select opcion_por_desarrollar from tbl_checklist_skill_usuarios where rut='$rut' and nivel=h.nom_nivel_skill and  id_cargo=h.id_cargo and id_skill=h.id_skill) as TipoCurso,
        (select id from tbl_checklist_inscripcion_cursos_usuarios where rut='$rut' and id_curso=h.id_curso) as idinscripcion
        from tbl_checklist_matriz_cursos h

        where

        h.id_cargo='$id_cargo'
        and h.id_empresa='$id_empresa'
        and h.id_skill='$id_skill'
        and h.nivel_cargo='$nivel'
        group by h.curso
        ";
        //echo "<BR> id_skill ".$id_skill." nivel ".$nivel;
        $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();

       //echo count($cod); //exit();

       if(count($cod)==0) {

               $sql="

        select h.*,
        (select opcion_por_desarrollar from tbl_checklist_skill_usuarios where rut='$rut' and nivel=h.nom_nivel_skill and  id_cargo=h.id_cargo and id_skill=h.id_skill) as TipoCurso,
        (select inscripcion from tbl_checklist_skill_usuarios where rut='$rut' and nivel=h.nom_nivel_skill and id_cargo=h.id_cargo and id_skill=h.id_skill) as inscripcion,
         (select id from tbl_checklist_skill_usuarios where rut='$rut' and nivel=h.nom_nivel_skill and id_cargo=h.id_cargo and id_skill=h.id_skill) as idinscripcion
        from tbl_checklist_matriz_cursos h

        where

        h.id_cargo='$id_cargo'
        and h.id_empresa='$id_empresa'
        and h.id_skill='$id_skill'

        group by h.curso
        ";

        $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();

       }
        return $cod;


}
function CuentaPreguntasMedEnc($id_medicion, $id_empresa){
        global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);

$sql="select

    h.*,(select count(id) from tbl_enc_elearning_preg where id_encuesta=h.id_encuesta) as num_preguntas

    from

    tbl_enc_elearning_medicion h

where id='$id_medicion' and id_empresa='$id_empresa'";

            $database->setquery($sql);
                $database->query();
                $cod = $database->listObjects();
                 return $cod[0]->num_preguntas;

}
function CuentaPreguntasRespMedEnc($id_medicion, $id_empresa){
        global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);

$sql="select

    h.*,(select count(id) from tbl_enc_elearning_respuestas where id_encuesta=h.id_encuesta and respuesta<>'') as num_respuesetas

    from

    tbl_enc_elearning_medicion h

where id='$id_medicion' and id_empresa='$id_empresa'";
 //echo  $sql;
            $database->setquery($sql);
                $database->query();
                $cod = $database->listObjects();
                 return $cod[0]->num_respuesetas;

}

function VioBannerMalla($rut, $id_empresa, $id_malla)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select count(id) as cuenta from tbl_banner_visto where rut='$rut' and id_empresa='$id_empresa' and ambiente='$id_malla'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod[0]->cuenta;
}
function PlanPorMetrica($id_empresa, $id_metrica)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_objetivos_planes_por_metrica where id_empresa='$id_empresa' and id_metrica='$id_metrica'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function totalMetricasObjetivosPorEmpresaDimension($id_empresa, $dimension)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_objetivos_metricas where id_empresa='$id_empresa' and id_dimension='$dimension'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TrarObjetivosPorGerencia($id_empresa, $gerencia)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "    select * from tbl_objetivos_area where id_empresa='$id_empresa'  and gerencia='$gerencia'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TrarObjetivosEmpresa($id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "    select * from tbl_objetivos_empresa where id_empresa='$id_empresa' ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ColaboradorTieneObjetivoDadodimensionDescripcionRutIdempresa($id_empresa, $rut, $descripcion_objetivo, $dimension)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "    select * from tbl_objetivos_individuales where rut='$rut' and id_empresa='$id_empresa' and descripcion_objetivo='$descripcion_objetivo' and dimension='$dimension'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function DistinctCampoDescripcionObjetivosPorDimensionEmpresa($id_empresa, $id_dimension)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "    select distinct(descripcion_objetivo) from tbl_objetivos_individuales where id_empresa='$id_empresa' and dimension='$id_dimension'    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function COMUNIDAD_InsertaIntecaccionConContenido($id_mp, $id_empresa, $rut, $tipo, $contenido)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $fecha = date("Y-m-d");
    $rut=$_SESSION["user_"];
    $hora  = date("H:i:s");
    $Usua=DatosUsuario_($rut, $id_empresa);
    if($Usua[0]->id>0) {

        $sql   = "INSERT INTO tbl_mp_interacciones(id_mp, rut, id_empresa, fecha, tipo, contenido) " . "VALUES ('$id_mp', '$rut', '$id_empresa', '$fecha', '$tipo', '$contenido');";
        $database->setquery($sql);
        $database->query();
    }
}
function COMUNIDAD_InsertaInteraccionConContenidoRemitente($id_mp, $id_empresa, $rut, $rut_remitente, $tipo, $contenido)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);

    $rut=$_SESSION["user_"];
    $database->setDb($c_db);
    $fecha = date("Y-m-d");
    $hora  = date("H:i:s");


    $sql   = "INSERT INTO tbl_mp_interacciones(id_mp, rut, id_empresa, fecha, tipo, contenido, rut_remitente) " . "
    VALUES ('$id_mp', '$rut', '$id_empresa', '$fecha', '$tipo', '$contenido', '$rut_remitente')";

   // echo $sql; sleep(4);
    $database->setquery($sql);
    $database->query();
}
function COMUNIDAD_TieneInteraccionPorRut($id_empresa, $id_mp, $tipo, $rut)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_mp_interacciones where id_empresa='$id_empresa' and id_mp='$id_mp' and tipo='$tipo' and rut='$rut' ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}

function Reco_BuscaRecoDadosPersona($rut, $id_empresa){

     global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select count(id) as cuenta from tbl_reconoce_gracias where id_empresa='$id_empresa' and rut_remitente='$rut'  ";
     //echo $sql;

    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod[0]->cuenta;

}
function Reco_BuscaRecoDadosPersonaMes($rut,$mes, $id_empresa){

     global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select count(id) as cuenta from tbl_reconoce_gracias where id_empresa='$id_empresa' and rut_remitente='$rut'  and MONTH(fecha) = '$mes'  ";
     //echo $sql;

    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod[0]->cuenta;

}
function COMUNIDAD_TieneInteraccion($id_empresa, $id_mp, $tipo)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_mp_interacciones where id_empresa='$id_empresa' and id_mp='$id_mp' and tipo='$tipo' ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function BorraInteraccionesMalas(){

    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);

    $sql=" delete h.* from tbl_mp_interacciones h  where h.tipo='MEGUSTA'
    and (select nombre from tbl_usuario where rut=h.rut) is null;
    ";

    $database->setquery($sql);
    $database->query();

}
function COMUNIDAD_InsertaIntecaccion($id_mp, $id_empresa, $rut, $tipo, $id_post)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $fecha = date("Y-m-d");
    $hora  = date("H:i:s");



    $Usua=DatosUsuario_($rut, $id_empresa);
    if($Usua[0]->id>0) {

    $sql   = "INSERT INTO tbl_mp_interacciones(id_mp, rut, id_empresa, fecha, tipo, id_post) " . "VALUES ('$id_mp', '$rut', '$id_empresa', '$fecha', '$tipo', '$id_post');";
        $database->setquery($sql);
        $database->query();
    }


    $sql_last_id = "SELECT LAST_INSERT_ID() as valor; ";
    $database->setquery($sql_last_id);
    $database->query();
    $cod = $database->listObjects();
    return ($cod);
}
function ComentariosPorPostTotal($id_mp)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_mp_comentarios where id_mp='$id_mp' order by id desc ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ComentariosPorPost($id_mp, $limit, $numero)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    if ($limit > 0) {
        if ($numero == 1) {
            $filtro_limit = " limit $limit";
        } else {
            $limite_inferior = $numero - 1;
            $limite_inferior = $limite_inferior * $limit;
            $filtro_limit    = " limit " . $limite_inferior . ", $limit";
        }
    }
    $sql = "select * from tbl_mp_comentarios where id_mp='$id_mp' order by id ASC $filtro_limit ";
    //echo "<br><br> ComentariosPorPost $sql";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function InsertaComentarioPorPost($rut, $id_mp, $comentario)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $fecha = date("Y-m-d");
    $hora  = date("H:i:s");
    $sql   = "INSERT INTO tbl_mp_comentarios(rut, id_mp, comentario, fecha, hora) " . "VALUES ('$rut', '$id_mp', '$comentario', '$fecha', '$hora');";
    $database->setquery($sql);
    $database->query();
}
function PromedioPorCompetencias($evaluado, $evaluador, $id_proceso)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
    select avg(nota) as nota_promedio from tbl_sgd_resultados_calculados_competencia where id_proceso='$id_proceso' and evaluado='$evaluado' and evaluador='$evaluador'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TraeRelacionesConDatosConAe($evaluador, $id_proceso)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
    SELECT
    tbl_sgd_relaciones.*, baseevaluado.nombre_completo, baseevaluado.sucursal,baseevaluado.fecha_ingreso,
    baseevaluado.perfil_competencia,
    baseevaluado.fecha_ingreso as fecha_ingreso_evaluado,
    baseevaluado.cargo as cargo_evaluado,
    baseevaluador.nombre_completo AS nombre_evaluador,
    basevalidador.nombre_completo AS nombre_validador,
    base_jefe_desde_tabla_usuario.nombre_completo as nombre_jefe_desde_tabla_usuario
    FROM
    tbl_sgd_relaciones
    INNER JOIN tbl_usuario AS baseevaluado ON baseevaluado.rut = tbl_sgd_relaciones.evaluado
    INNER JOIN tbl_usuario AS baseevaluador ON baseevaluador.rut = tbl_sgd_relaciones.evaluador
    left JOIN tbl_usuario AS basevalidador ON basevalidador.rut = tbl_sgd_relaciones.validador

    left join tbl_usuario as base_jefe_desde_tabla_usuario
    on base_jefe_desde_tabla_usuario.rut=baseevaluado.jefe
    WHERE
    tbl_sgd_relaciones.id_proceso = '$id_proceso'
    AND tbl_sgd_relaciones.evaluador = '$evaluador'

    order by baseevaluado.sucursal desc, baseevaluado.nombre_completo asc ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function lms_busca_posibles_postulaciones($rut, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
    select h.* from tbl_inscripcion_postulantes h where h.rut='$rut' and h.id_empresa='$id_empresa' group by h.id_curso
    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function com_mp_lista_comunidad($id_empresa, $rut, $ord_by, $filt_by, $filt_cat, $vp, $arreglo_tags, $tag, $rut_enviado)
{
    $filt_full  = explode("-", $filt_cat);
    $filt_field = $filt_full[0];
    $filt_data  = $filt_full[1];
    $cuenta_tag = count($arreglo_tags);
    if ($cuenta_tag > 0) {
        $query_arreglo_TagInteres .= " AND (";
        foreach ($arreglo_tags as $arreglo_tag) {
            $or_query = "";
            $mp++;
            if ($mp < $cuenta_tag) {
                $or_query = " OR ";
            }
            $query_arreglo_TagInteres .= " (select tag from tbl_mp_tag where id_mp=tbl_mp.id_mp and tag='" . $arreglo_tag->contenido . "' limit 1)='" . $arreglo_tag->contenido . "' $or_query ";
        }
        $query_arreglo_TagInteres .= ")";
    }
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    if ($tag <> '') {
        $query_arreglo_TagInteres = " and (select tag from tbl_mp_tag where id_mp=tbl_mp.id_mp and tag='$tag' limit 1)='$tag' ";
    }
    if ($rut_enviado <> '') {
        $query_arreglo_TagInteres = "";
        $query_rut_enviado        = " and tbl_mp.rut = '$rut_enviado' ";
    }
    $tipoOrden = rand(1, 3);
    if ($tipoOrden == 1) {
        $ordenQuery = " order by popular DESC ";
    }
    if ($tipoOrden == 2) {
        $ordenQuery = " order by id DESC ";
    }
    if ($tipoOrden == 3) {
        $ordenQuery = " order by nombre DESC ";
    }
    $sql = "SELECT
    tbl_mp.*,
    (select count(id) from tbl_mp_interacciones where id_mp=tbl_mp.id_mp  and tipo='COMENTARIO') AS numcomentarios,
    (select count(id) from tbl_mp_comentarios where id_mp=tbl_mp.id_mp) as numcomentariosreales,
    (select count(id) from tbl_mp_interacciones where id_mp=tbl_mp.id_mp  and tipo='MEGUSTA') AS nummegusta,
    (select count(id) from tbl_mp_interacciones where id_mp=tbl_mp.id_mp  and tipo='COMPARTIDO') AS numcompartido,
    (select count(id) from tbl_mp_interacciones where id_mp=tbl_mp.id_mp  and tipo='VISITA') AS numvisitas,
    tbl_mp_categorias.categoria,
    tbl_mp_categorias.style,
    tbl_mp_categorias.icono,
    tbl_mp_categorias.descripcion AS descripcion_categoria,

    tbl_usuario.nombre_completo AS nombre_autor,
    (
    (1+3*(
    SELECT
    count(id)
    FROM
    tbl_mp_interacciones
    WHERE
    id_mp = tbl_mp.id_mp
    AND tipo = 'COMENTARIO'
    )) * (1+(
    SELECT
    count(id)
    FROM
    tbl_mp_interacciones
    WHERE
    id_mp = tbl_mp.id_mp
    AND tipo = 'MEGUSTA'
    )) * (1+(
    SELECT
    count(id)
    FROM
    tbl_mp_interacciones
    WHERE
    id_mp = tbl_mp.id_mp
    AND tipo = 'DESCARGA'
    ) )*(1+(
    SELECT
    count(id)
    FROM
    tbl_mp_interacciones
    WHERE
    id_mp = tbl_mp.id_mp
    AND tipo = 'FAVORITA'
    ))
    ) as popular

    FROM tbl_mp

    INNER JOIN tbl_mp_categorias ON tbl_mp_categorias.id_categoria = tbl_mp.id_categoria

    inner join tbl_usuario
    on tbl_usuario.rut=tbl_mp.rut
    $inner

    WHERE
    tbl_mp.id_empresa = '$id_empresa'


    order by tbl_mp.id desc


    LIMIT 12
    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function com_mp_tag_comunidad($rut, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_mp_interacciones where id_empresa='$id_empresa' ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function com_mp_busca_categorias_comunidad_e_interaccion($rut, $tipo, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $query_apt        = "";
    $query_aptvalidad = "";
    if ($tipo == "APTITUD") {
        $query_apt = " and tipo='APTITUD' ";
    }
    if ($tipo == "APTITUD_VALIDADA") {
        $query_aptvalidad = " and tipo='APTITUD_VALIDADA' ";
    }
    $sql = "select h.*, (select count(id) from tbl_mp_interacciones where rut='$rut' and id_empresa='$id_empresa' $query_apt $query_aptvalidad and contenido=h.id_categoria) as cuenta
    from tbl_mp_aptitudes h
    where h.id_empresa='$id_empresa' ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function com_mp_busca_validacion_aptitudes($rut, $rut_remitente, $tipo, $id_empresa, $id_aptitud)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $query_rut           = "";
    $query_rut_remitente = "";
    if ($rut <> '') {
        $query_rut = " and rut='$rut' ";
    }
    if ($rut_remitente <> '') {
        $query_rut_remitente = " and rut_remitente='$rut_remitente' ";
    }
    if ($id_aptitud) {
        $filtro_aptitud = " and contenido='$id_aptitud' ";
    }
    $sql = "select h.contenido, h.contenido as idcategoria, h.rut as rut_receptor, (select categoria from tbl_mp_aptitudes where id_categoria=h.contenido) as categoria,

    (select count(id) from tbl_mp_interacciones where tipo='APTITUD_VALIDADA' $query_rut_remitente  $query_rut and contenido=h.contenido) as yavalidada,
    (select avg(mensaje)  from tbl_mp_interacciones where tipo='APTITUD_VALIDADA' $query_rut and contenido=h.contenido) as vecesvalidada

    from tbl_mp_interacciones h

    where h.rut='$rut' and h.id_empresa='$id_empresa' and tipo='APTITUD' $filtro_aptitud  group by h.contenido";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TraeBuscaInteraccionPersonal($Rut_Perfil, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "

    select h.rut,
    (select count(id) from tbl_mp_interacciones where rut='$Rut_Perfil' and tipo='SEGUIDO' and id_empresa='$id_empresa'                 and (        SELECT            vigencia        FROM            tbl_usuario        WHERE            rut = tbl_mp_interacciones.rut_remitente    )<>1
    and (        SELECT            vigencia        FROM            tbl_usuario        WHERE            rut = tbl_mp_interacciones.rut    )<>1
    and tbl_mp_interacciones.rut_remitente<>tbl_mp_interacciones.rut) as  numseguidores,
    (select count(id) from tbl_mp_interacciones where rut_remitente='$Rut_Perfil' and tipo='SEGUIDO' and id_empresa='$id_empresa'                 and (        SELECT            vigencia        FROM            tbl_usuario        WHERE            rut = tbl_mp_interacciones.rut_remitente    )<>1
    and (        SELECT            vigencia        FROM            tbl_usuario        WHERE            rut = tbl_mp_interacciones.rut    )<>1
    and tbl_mp_interacciones.rut_remitente<>tbl_mp_interacciones.rut) as  numseguidos,
    (select  count(DISTINCT(contenido)) from tbl_mp_interacciones where rut='$Rut_Perfil' and tipo='APTITUD_VALIDADA' and id_empresa='$id_empresa') as  numaptitudesvalidadas,
    (select sum(puntos) from tbl_gamificado_puntos where rut='$Rut_Perfil' and id_malla='comunidadmpa' and id_empresa='$id_empresa') as  numbcicoins,
    (select count(id) from tbl_mp where rut='$Rut_Perfil' and id_empresa='$id_empresa' and id_estado='5') as  numpublicaciones
    from tbl_usuario h where h.vigencia='0'

    and h.rut='$Rut_Perfil' and h.id_empresa='$id_empresa'



    ";
    // echo "<br><br><br>".$sql;
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}

function TraeEmailUsuario($rut, $id_empresa){

    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "

    select email from tbl_usuario where rut='$rut' and id_empresa='$id_empresa'

    ";

    //echo $sql;
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod[0]->email;

    }

function MP_Storie360_SaveNewUser($rut,  $id_mp, $id_empresa) {


          global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $id_empresa=$_SESSION["id_empresa"];
    $sql = "

    select video, imagen from tbl_mp_stories where id_st='$id_mp' and id_empresa='$id_empresa'

    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();

    $multimedia=$cod[0]->video;
    $imagen_fondo=$cod[0]->imagen;

    $id_categoria="stories_360";

    com_mp_save_Stories($rut, $id_empresa, $id_categoria, $id_ambito, $nombre, $contenido, $tag, $archivo, $objetivo, $aplicacion, $metrica, $impacto, $id_subcategoria, $problema, $kpi_afectado, $cuantificacion, $coach, $nombre_archivo2, $multimedia, $url_documento, $tipo_multimedia, $imagen_fondo, $tipodepublicacion, $resumen, $fuente);






    }


function  mp_busca_sisvideo360($id_mp,$id_empresa){

      global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "

    select count(id) as cuenta from tbl_mp_stories where id_st='$id_mp' and id_empresa='$id_empresa'

    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod[0]->cuenta;


    }


function TraeDatosInteraccionComRut($rut, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "

    select h.*,
    (select count(id) from tbl_mp_interacciones where id_mp=h.id_mp  and tipo='VISITA') as  visitasporpost
    from tbl_mp h
    where h.rut='$rut' and h.id_estado>=5 and h.id_empresa='$id_empresa'

    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function VerificandompaSeguidores($rut, $rutseguido, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "

    select h.* from tbl_mp_interacciones h


    where h.id_empresa='$id_empresa' AND h.rut='$rutseguido' AND h.rut_remitente='$rut' and tipo='SEGUIDO'  order by id DESC
    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TraeUltimaspublicaciones($rut, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
    select h.*     from tbl_mp h
    where h.id_empresa='$id_empresa' AND h.rut='$rut' order by id DESC
    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TraeComMisTagsPostRut($rut, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
    select h.*     from tbl_mp_tag h  where
    (select rut from tbl_mp where id_mp=h.id_mp) ='$rut'
    and h.id_empresa='$id_empresa' AND tag<>'' group by tag limit 6
    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TraeComMisInteresestagsPostRut($rut, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
    select h.*     from tbl_mp_interacciones h  where

    h.tipo='INTERES' and h.rut='$rut'

    and h.id_empresa='$id_empresa'  AND tag<>''  group by contenido limit 10

    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function IndicadoresCriteriosPorDimensionDetallePorCriterio($id_empresa, $id_dimension, $id_criterio)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
    select
    *
    from tbl_indicadores_criterios
    where id_dimension='$id_dimension' and id_empresa='$id_empresa' and id_criterio='$id_criterio'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function IndicadoresCriteriosPorDimension($id_empresa, $id_dimension)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
    select
    distinct(id_criterio) as id_criterio, nombre  as nombre_criterio
    from tbl_indicadores_criterios
    where id_dimension='$id_dimension' and id_empresa='$id_empresa'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function IndicadoresPromedioPordimension($id_empresa, $indicador_global)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select avg(dato) as valor, nombre from tbl_indicadores_dimension
    where id_empresa='" . $id_empresa . "' and id_indicador='$indicador_global'
    GROUP BY id_dimension";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function IndicadoresDetalleDimensionPorIndicadorGlobalYDimension($id_empresa, $indicador_global, $id_dimension)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_indicadores_dimension where id_empresa='" . $id_empresa . "' and id_indicador='$indicador_global' and id_dimension='$id_dimension' ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function IndicadoresDimensionesDadoIndicadorGlobal($id_empresa, $indicador_global)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select distinct(id_dimension) as codigo_dimension, nombre as nombre_dimension from tbl_indicadores_dimension where id_empresa='" . $id_empresa . "' and id_indicador='$indicador_global' ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function IndicadorglobalPorFechaDescendente($id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_indicadores_global where id_empresa='" . $id_empresa . "' order by fecha desc";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function InsertarUsuarioNuevoCargoTblUsuario21($rut, $dv, $nombre, $apateno, $amaterno, $cargo, $id_empresa, $jefe, $gerencia, $email, $empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $rut_completo = $rut . "-" . $dv;
    $sql          = "INSERT INTO tbl_usuario(rut, dv, rut_completo, nombre, nombre_completo, apaterno, amaterno, cargo, id_empresa, jefe, gerencia, email, nombre_empresa_holding) " . "VALUES ('$rut','$dv', '$rut_completo', '$nombre', '$nombre', '$apateno', '$amaterno', '$cargo', '$id_empresa', '$jefe', '$gerencia', '$email', '$empresa');";
    $database->setquery($sql);
    $database->query();
}
function buscaclaverut($rut, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_clave where rut='" . $rut . "'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function UsuarioEnBasePersonaPorEmpresaCodigoSAP($codigo)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_usuario  where codigo_sap='$codigo'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function LMS_InsertaRelacionEvaluadoEvaluador($evaluado, $evaluador, $id_empresa, $perfil)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $nuevo_id  = $ultimo_id[0]->id;
    $nuevo_id  = $nuevo_id + 1;
    $codigo    = $id_empresa . "_mp" . $nuevo_id;
    $sql       = "INSERT INTO tbl_sgd_relaciones (evaluado, evaluador, id_proceso, perfil_evaluacion_competencias, subperfil, id_empresa) " . "VALUES ('$evaluado', '$evaluador', '120', '$perfil', '17','$id_empresa');";
    $database->setquery($sql);
    $database->query();
    return $codigo;
}
function LMS_TraeRelacionAE($evaluado, $evaluador, $id_empresa, $perfil)
{
    $datos_empresa = DatosEmpresa($id_empresa);
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_sgd_relaciones where id_empresa='$id_empresa' and evaluado='$evaluado' and evaluador='$evaluador' and perfil_evaluacioncompetencias='$perfil'
    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function LS_TraeMallaConPerfilSGD($rut, $id_empresa)
{
    $datos_empresa = DatosEmpresa($id_empresa);
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "SELECT
    rel_lms_malla_persona.*
    FROM
    rel_lms_malla_persona

    inner join tbl_sgd_perfiles_ponderaciones
    on tbl_sgd_perfiles_ponderaciones.perfil=rel_lms_malla_persona.id_malla
    WHERE
    rel_lms_malla_persona.rut = '$rut'
    AND rel_lms_malla_persona.id_empresa = '$id_empresa'
    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function com_mp_vota_reconoce($id_empresa, $rut, $ord_by, $filt_by, $filt_cat, $vp, $arreglo_tag, $tag, $rut_enviado, $id_categoria)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    
    $nuevo_id  = $ultimo_id[0]->id;
    $nuevo_id  = $nuevo_id + 1;
    $codigo    = $id_empresa . "_mp" . $nuevo_id;
    $sql       = "INSERT INTO tbl_vota_rec (rut_reconocido, rut, id_empresa, fecha, id_estado, id_categoria, contenido,  imagen, texto2, texto3, puntos, id_subcategoria, tipo) " . "VALUES ('$rut_enviado', '$rut', '$id_empresa', '" . date("Y-m-d") . "', '1','$id_categoria','$contenido', '$imagen', '$texto2', '$texto3', '$puntos','$id_subcategoria', '$tipo');";
    $database->setquery($sql);
    $database->query();
    return $codigo;
}
function com_mp_vota_yaboto_limite_data($id_empresa, $rut)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
    select h.* from tbl_vota_rec h where h.rut='$rut' and h.id_empresa='$id_empresa'
    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function METAS_CumplimientoNotaFinal($rut)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "SELECT *
    FROM tbl_sgd_finalizados_evaluado_evaluador
    WHERE evaluado= '$rut'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function METAS_AUDITORIA($rut, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "SELECT *
    FROM tbl_objetivos_individuales
    WHERE rut= '$rut'  AND id_empresa= '$id_empresa'
    and auditoria2016 is not null and auditoria2016<>''";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function METAS_DESEMPENO($rut, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "SELECT *
    FROM tbl_objetivos_individuales
    WHERE rut= '$rut'  AND id_empresa= '$id_empresa'
    and puntaje_final is not null and puntaje_final<>''";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function METAS_CLIMA($rut, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "SELECT *
    FROM tbl_objetivos_individuales
    WHERE rut= '$rut'  AND id_empresa= '$id_empresa'
    and va is not null and va<>''";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function METAS_Indicadores($rut, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "SELECT *
    FROM tbl_objetivos_individuales
    WHERE rut= '$rut'  AND id_empresa= '$id_empresa' and variable_negocio is not null and variable_negocio<>''";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function REL_MALLA_CURSO_TraeCursosDadoPrograma2($id_empresa, $arreglo_post)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    if ($arreglo_post["foco"] <> '' and $arreglo_post["foco"] <> '0') {
        $filtro_foco = " and  rel_lms_malla_curso.id_foco = '" . $arreglo_post["foco"] . "'";
    }
    if ($arreglo_post["programabbdd"] <> '' and $arreglo_post["programabbdd"] <> '0') {
        $filtro_programabbdd = " and  rel_lms_malla_curso.id_programa = '" . $arreglo_post["programabbdd"] . "'";
    }
    if ($arreglo_post["malla"] <> '' and $arreglo_post["malla"] <> '0') {
        $filtro_malla = "  and rel_lms_malla_curso.id_malla= '" . $arreglo_post["malla"] . "'";
    }
    if ($arreglo_post["clasificacion"] <> '' and $arreglo_post["clasificacion"] <> '0') {
        $filtro_clasificacion = " and  rel_lms_malla_curso.id_clasificacion= '" . $arreglo_post["clasificacion"] . "'";
    }
    if ($arreglo_post["cursos"] <> '' and $arreglo_post["cursos"] <> '0') {
        $filtro_curso = " and  rel_lms_malla_curso.id_curso= '" . $arreglo_post["cursos"] . "'";
    }
    $sql = "select distinct(rel_lms_malla_curso.id_curso), tbl_lms_curso.nombre as nombre
    from rel_lms_malla_curso
    inner join tbl_lms_curso
    on tbl_lms_curso.id=rel_lms_malla_curso.id_curso

    where rel_lms_malla_curso.id_empresa='$id_empresa'  and rel_lms_malla_curso.inactivo<>'1'
    $filtro_foco $filtro_programabbdd $filtro_malla $filtro_clasificacion $filtro_curso order by nombre asc
    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TraigoDesafiosFinalizados($rut_colaborador, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "

    SELECT * FROM tbl_lms_desafios_finalizados WHERE rut_colaborador = '$rut_colaborador'  AND id_empresa= '$id_empresa'

    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function lms_integracion_lista_programasSinRut($id_empresa, $rut_jefe)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    if ($rut_jefe) {
        $listado_colaboradores  = TotalUsuariosPorRutJefe($rut_jefe);
        $contador_colaboradores = 0;
        foreach ($listado_colaboradores as $col) {
            $filtro_colaboradores .= " rel_lms_malla_persona.rut = '" . $col->rut . "' ";
            $contador_colaboradores++;
            if ($contador_colaboradores < count($listado_colaboradores)) {
                $filtro_colaboradores .= " or ";
            }
        }
    }
    $sql = "SELECT

    tbl_lms_programas_bbdd.*

    FROM
    rel_lms_malla_persona
    INNER JOIN rel_lms_malla_curso ON rel_lms_malla_curso.id_malla = rel_lms_malla_persona.id_malla
    INNER JOIN tbl_lms_malla ON tbl_lms_malla.id = rel_lms_malla_persona.id_malla
    INNER JOIN tbl_lms_programas_bbdd ON tbl_lms_programas_bbdd.id_programa = rel_lms_malla_curso.id_programa
    AND tbl_lms_programas_bbdd.id_empresa = '$id_empresa'
    LEFT JOIN tbl_lms_foco ON tbl_lms_foco.codigo_foco = rel_lms_malla_curso.id_foco
    AND tbl_lms_foco.id_empresa = '$id_empresa'
    WHERE
    rel_lms_malla_persona.id_empresa = '$id_empresa'
    AND ($filtro_colaboradores)
    GROUP BY
    tbl_lms_programas_bbdd.id_programa
    ORDER BY
    tbl_lms_programas_bbdd.orden ASC";

//)echo $sql;   exit();

    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function buscacursosaprobadospornivel_data($id_orden_nivel, $rut, $id_empresa, $id_malla)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "

    select h.*,
    (select estado from tbl_inscripcion_cierre where rut='$rut' and id_curso=h.idcurso and id_empresa='$id_empresa' and estado='1') as aprobado
    from tbl_gamificado_nivel h
    where h.idorden='$id_orden_nivel' and h.idmalla='$id_malla' and h.idempresa='$id_empresa'

    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function com_mp_post_recents($rut, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    if ($id_empresa == "53") {
        $sql = "
    SELECT
    h.*
    FROM
    tbl_mp h
    WHERE
    id_empresa = '$id_empresa'
    AND id_estado >= 5
    AND (
    h.nombre IS NULL
    OR h.nombre  = ''
    )
    AND h.contenido <> ''
    ORDER BY
    id DESC
    LIMIT 4
    ";
    } else {
        $sql = "
    select h.*

    from tbl_mp h where id_empresa='$id_empresa' and id_estado>=5 and (select tipo from tbl_mp_interacciones where rut_remitente='$rut' and rut=h.rut limit 1)='SEGUIDO'

    order by id DESC LIMIT 10
    ";
    }
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function com_mp_post_rank_categorias($id_empresa, $orden)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $ord = $orden - 1;
    $sql = "select h.*,
    (select count(id) from tbl_mp where id_estado>=5 and id_categoria=h.id_categoria and id_empresa='$id_empresa') as cuenta
    from tbl_mp_categorias h where id_empresa='$id_empresa' and h.id_categoria<>'0'  AND h.categoria<>''  and h.id_categoria<>'bcimp_1'

    order by (select count(id) from tbl_mp where id_estado>=5 and id_categoria=h.id_categoria and id_empresa='$id_empresa') DESC

    LIMIT $ord,1
    ";

    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function com_mp_post_rank_mas_publicador_categoria($id_cat, $id_empresa, $subcategoria)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    if ($subcategoria <> '') {
        $querPersonTemp = "     and (select template from tbl_mp_template where rut=h.rut and template='$subcategoria')='$subcategoria' ";
    } else {
        $querPersonTemp = "    and (select template from tbl_mp_template where rut=h.rut) is null  ";
    }
    $querPersonTemp = "";
    $sql = "
    select h.*,
    (select count(id) from tbl_mp where id_estado>=5 and rut=h.rut and id_empresa='$id_empresa' and id_categoria='$id_cat') as cuenta

    from tbl_mp h

    where h.id_estado='5' and h.id_empresa='$id_empresa'  and h.id_categoria='$id_cat'

    $querPersonTemp
    group by h.rut
    order by (select count(id) from tbl_mp where id_estado>=5 and rut=h.rut and id_empresa='$id_empresa' and id_categoria='$id_cat')  DESC limit 1
    ";

    //echo "<br><br><br><br>$sql";

    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function com_mp_post_rank_rut_mas_publicador_categoria($rut, $id_cat, $id_empresa, $subcategoria)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    if ($subcategoria <> '') {
        $querPersonTemp = "     and (select template from tbl_mp_template where rut=h.rut and template='$subcategoria')='$subcategoria' ";
    } else {
        $querPersonTemp = "    and (select template from tbl_mp_template where rut=h.rut) is null  ";
    }
    $sql = "
    select h.*,
    (select nombre_completo from tbl_usuario where rut=h.rut) as nombre_autor,
    (select count(id)  from tbl_mp_interacciones where tipo='SEGUIDO' and id_empresa='$id_empresa' and rut='$rut'


    and (        SELECT            vigencia        FROM            tbl_usuario        WHERE            rut = tbl_mp_interacciones.rut_remitente    )<>1
    and (        SELECT            vigencia        FROM            tbl_usuario        WHERE            rut = tbl_mp_interacciones.rut    )<>1
    and tbl_mp_interacciones.rut_remitente<>h.rut

    ) as seguidores

    from tbl_mp h

    where h.id_estado='5' and h.id_empresa='$id_empresa'

    and h.id_categoria='$id_cat' and h.rut='$rut' order by fecha DESC, id DESC LIMIT 1
    ";


    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function com_mp_post_ultimos_recientes($rut, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
    select h.id_mp,h.id,  h.nombre, h.rut,h.id_subcategoria,h.id_ambito,
    (select nombre_completo from tbl_usuario where rut=h.rut) as nombre_autor,
    (select ambito from tbl_mp_ambitos where id_ambito=h.id_ambito and id_empresa='$id_empresa') as ambito,

    (select count(id) from tbl_mp_interacciones where id_mp=h.id_mp and (tipo='MEGUSTA' or tipo='FAVORITA' or tipo='COMENTARIO'))
    from tbl_mp h
    WHERE h.id_empresa='$id_empresa'
    and h.id_estado>=5 ORDER BY h.id  desc limit 5
    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function com_mp_preguntas_ultimos_recientes($rut, $id_empresa, $subcategoria)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    if ($subcategoria <> '') {
        $queryidsub = " and h.id_subcategoria='" . $subcategoria . "' ";
    } else {
        $queryidsub = " and h.id_subcategoria='' ";
    }
    $sql = "
    select h.id_mp,h.id,  h.nombre, h.rut, h.fecha, h.id_categoria, h.resumen, h.id_subcategoria, h.id_ambito,
    (select categoria from tbl_mp_categorias where id_categoria=h.id_categoria and id_empresa='$id_empresa') as categoria,
    (select ambito from tbl_mp_ambitos where id_ambito=h.id_ambito and id_empresa='$id_empresa') as ambito,

    (select nombre_completo from tbl_usuario where rut=h.rut) as nombre_autor,
    (select count(id) from tbl_mp_interacciones where id_mp=h.id_mp and (tipo='MEGUSTA' or tipo='FAVORITA' or tipo='COMENTARIO'))
    from tbl_mp h
    WHERE h.id_empresa='$id_empresa'
    and h.id_estado>=5 and h.tipo='Pregunta'

    and (select count(id) from tbl_mp_expertos where rut='$rut' and id_ambito=h.id_ambito)>0

    $queryidsub
    ORDER BY h.id  desc limit 5
    ";
    //echo $sql;
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function com_mp_post_mas_valorados($rut, $id_empresa, $subcategoria)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    if ($subcategoria <> '') {
        $queryidsub = " and h.id_subcategoria='" . $subcategoria . "' ";
    } else {
        $queryidsub = " and h.id_subcategoria='' ";
    }
    $sql = "
    select h.id_mp, h.nombre, h.rut, h.contenido,h.id_subcategoria,h.id_ambito

    from tbl_mp h
    WHERE h.id_empresa='$id_empresa'
    $queryidsub
    and h.id_estado>=5 ORDER BY (select count(id) from tbl_mp_interacciones where id_mp=h.id_mp and (
    tipo='MEGUSTA' or tipo='MEGUSTA_POST' or tipo='MEGUSTA_POST_REPLY' or tipo='COMENTARIO_REPLY' or tipo='COMENTARIO')) desc limit 5
    ";
    //(select ambito from tbl_mp_ambitos where id_ambito=h.id_ambito and id_empresa='$id_empresa') as ambito,
    //   (select count(id) from tbl_mp_interacciones where id_mp=h.id_mp and (tipo='MEGUSTA' or tipo='FAVORITA' or tipo='COMENTARIO'))/*-->


    //echo $sql;
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function com_mp_post_portipo($tipo, $id_empresa, $subcategoria)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    if ($subcategoria <> '') {
        $queryidsub = " and h.id_subcategoria='" . $subcategoria . "' ";
    } else {
        $queryidsub = " and h.id_subcategoria=''";
    }
    $sql = "
    select h.id_mp, h.nombre, h.rut, h.contenido, h.imagenfondo, h.fecha,h.id_subcategoria,
    (select nombre_completo from tbl_usuario where rut=h.rut) as nombre_autor ,
    (select count(id) from tbl_mp_interacciones where id_mp=h.id_mp and (tipo='MEGUSTA' or tipo='FAVORITA' or tipo='COMENTARIO'))

    from tbl_mp h

    WHERE h.id_empresa='$id_empresa'
    $queryidsub
    and h.id_estado>=5 and h.tipo='$tipo'
    order by id DESC
    ";
    //echo "<br><br>$sql";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function com_mp_people_mas_seguida($rut, $id_empresa, $subcategoria)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    if ($subcategoria <> '') {
        $querPersonTemp = "     and (select template from tbl_mp_template where rut=h.rut and template='$subcategoria')='$subcategoria' ";
    } else {
        $querPersonTemp = "     and (select template from tbl_mp_template where rut=h.rut and template='')='' ";
    }
    $sql = "
    select count(h.id) as seguidores, h.rut, (select nombre_completo from tbl_usuario where rut=h.rut) as nombre
    from tbl_mp_interacciones h where h.tipo='SEGUIDO' and h.id_empresa='$id_empresa'

    and (        SELECT            vigencia        FROM            tbl_usuario        WHERE            rut = h.rut_remitente    )<>1
    and (        SELECT            vigencia        FROM            tbl_usuario        WHERE            rut = h.rut    )<>1
    and h.rut_remitente<>h.rut


    GROUP BY h.rut  order by count(h.id) DESC limit 5
    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function com_mp_people_mas_puntos($rut, $id_empresa, $subcategoria)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    if ($subcategoria <> '') {
        $querPersonTemp = "     and (select template from tbl_mp_template where rut=h.rut and template='$subcategoria')='$subcategoria' ";
    } else {
        $querPersonTemp = "    and (select template from tbl_mp_template where rut=h.rut) is null  ";
    }
    $sql = "


    select sum(h.puntos) as puntos, rut,
    (select nombre_completo from tbl_usuario where rut=h.rut) as nombre
    from tbl_gamificado_puntos h where id_empresa='$id_empresa' and h.id_malla='comunidadmpa'

    and (        SELECT            vigencia        FROM            tbl_usuario        WHERE            rut = h.rut    )<>1
    $querPersonTemp

    group by h.rut order by sum(h.puntos) DESC LIMIT 5

    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function com_mp_people_mas_interacciones($rut, $id_empresa, $subcategoria)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    if ($subcategoria <> '') {
        $querPersonTemp = "     and (select template from tbl_mp_template where rut=h.rut and template='$subcategoria')='$subcategoria' ";
    } else {
        $querPersonTemp = "    and (select template from tbl_mp_template where rut=h.rut) is null  ";
    }
    $sql = "

    select count(h.id), h.rut, (select nombre_completo from tbl_usuario where rut=h.rut and id_empresa='$id_empresa') as nombre,
    (select count(id) from tbl_mp_interacciones where rut=h.rut and tipo='SEGUIDO'


    and (        SELECT            vigencia        FROM            tbl_usuario        WHERE            rut = tbl_mp_interacciones.rut_remitente    )<>1
    and (        SELECT            vigencia        FROM            tbl_usuario        WHERE            rut = tbl_mp_interacciones.rut    )<>1
    and tbl_mp_interacciones.rut_remitente<>h.rut


    ) AS seguidores


    from tbl_mp_interacciones h

    where (h.tipo='MEGUSTA' or h.tipo='COMENTARIO' or h.tipo='COMENTARIO' or h.tipo='COMPARTIDOCONMIGO')
    and  (select nombre_completo from tbl_usuario where rut=h.rut and id_empresa='$id_empresa') is not null
    and  (select nombre_completo from tbl_usuario where rut=h.rut and id_empresa='$id_empresa')<>''
    $querPersonTemp
    and h.id_empresa='$id_empresa'



    group by h.rut order by count(h.id) DESC limit 5

    ";
    //echo $sql;
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function com_mp_people_interesting($rut, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "

    select h.rut,
    (select nombre_completo from tbl_usuario where rut=h.rut) as nombrecompleto,
    (select count(id) from tbl_mp_interacciones where rut=h.rut and tipo='SEGUIDO') AS seguidores,

    (select count(id) as cuenta  FROM `tbl_mp_interacciones` WHERE `rut`=h.rut AND tipo='SEGUIDO') as cuenta

    from tbl_mp_interacciones h

    where id_empresa='$id_empresa' and h.rut<>'$rut' group by h.rut order by (select count(id) as cuenta  FROM `tbl_mp_interacciones` WHERE `rut`=h.rut AND tipo='SEGUIDO') DESC
    LIMIT 5

    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function com_mp_people_actives($rut, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "

    SELECT h.rut,
    (select nombre_completo from tbl_usuario where rut=h.rut) as nombrecompleto,
    (select count(id) from tbl_mp_interacciones where rut=h.rut and tipo='SEGUIDO') AS seguidores,

    count(h.id) as cuenta from tbl_mp h where h.rut<>$rut and id_empresa='$id_empresa' group by h.rut order by count(h.id) DESC limit 5



    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function com_mp_people_quesigo($rut, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "



    SELECT h.rut,h.fecha,
    (select nombre_completo from tbl_usuario where rut=h.rut) as nombrecompleto,
    (select count(id) from tbl_mp_interacciones where rut=h.rut and tipo='SEGUIDO') AS seguidores,
    count(h.id) as cuenta

    from tbl_mp_interacciones h

    where h.rut<>'$rut' and h.rut_remitente='$rut'

    and (        SELECT            vigencia        FROM            tbl_usuario        WHERE            rut = h.rut_remitente    )<>1
    and (        SELECT            vigencia        FROM            tbl_usuario        WHERE            rut = h.rut    )<>1
    and h.rut_remitente<>h.rut


    and id_empresa='$id_empresa' and tipo='SEGUIDO' group by h.rut order by (select count(id) from tbl_mp_interacciones where rut=h.rut and tipo='SEGUIDO')  DESC


    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function com_mp_save_post($rut, $id_empresa, $id_categoria, $id_ambito, $nombre, $contenido, $tag, $archivo, $objetivo, $aplicacion, $metrica, $impacto, $id_subcategoria, $problema, $kpi_afectado, $cuantificacion, $coach, $nombre_archivo2, $multimedia, $url_documento, $tipo_multimedia, $imagen_fondo, $tipodepublicacion, $resumen, $fuente)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $ultimo_id = ObtengoUltimoRegistroMP($id_empresa);
    $nuevo_id  = $ultimo_id[0]->id;
    $nuevo_id  = $nuevo_id + 1;
    $codigo    = $id_empresa . "_mp" . $nuevo_id;
    $sql       = "INSERT INTO tbl_mp(id_mp, rut, id_empresa, fecha, id_estado, id_categoria, id_ambito, nombre, contenido,  archivo, objetivo, aplicacion,
    metrica, impacto, id_subcategoria, tipo, video, url_documento, tipo_post, imagenfondo, resumen, fuente, hora) " . "VALUES ('$codigo', '$rut', '$id_empresa', '" . date("Y-m-d") . "', '5','$id_categoria','$id_ambito', '$nombre', '$contenido', '$archivo', '$objetivo', '$aplicacion' , '$metrica' , '$impacto', '$id_subcategoria',
    '$tipodepublicacion', '$multimedia', '$url_documento', '$tipo_multimedia', '$imagen_fondo', '$resumen', '$fuente', '".date("H:i:s")."');";
    $database->setquery($sql);



    $database->query();
    return $codigo;
}

function com_mp_save_post_foto_mensaje($rut, $id_empresa, $id_categoria, $id_ambito, $nombre, $contenido, $tag, $archivo, $objetivo, $aplicacion, $metrica, $impacto, $id_subcategoria, $problema, $kpi_afectado, $cuantificacion, $coach, $nombre_archivo2, $multimedia, $url_documento, $tipo_multimedia, $imagen_fondo, $tipodepublicacion, $resumen, $fuente)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    
    $nuevo_id  = $ultimo_id[0]->id;
    $nuevo_id  = $nuevo_id + 1;
    $codigo    = $id_empresa . "_mp" . $nuevo_id;

    $Usua=DatosUsuario_($rut, $id_empresa);
/*   echo "<br>
   rut $rut, id empresa $id_empresa, id categoria $id_categoria, $id_ambito, nombre $nombre, contenido $contenido, $tag, $archivo, $objetivo,
    $aplicacion, $metrica, $impacto, $id_subcategoria, $problema, $kpi_afectado, $cuantificacion, $coach, $nombre_archivo2, multimedia $multimedia, $url_documento, $tipo_multimedia,
    imagen $imagen_fondo, $tipodepublicacion, $resumen, $fuente";  */


    $nombre_completo=$Usua[0]->nombre_completo;
    $email=$Usua[0]->email;
    $nombre=($nombre);

    $sql       = "INSERT INTO tbl_mp_fotomensaje (rut, foto, mensaje, id_empresa, grupo, fecha, nombre_completo, email) " . "
    VALUES ('$rut', '$imagen_fondo', '$nombre', '$id_empresa','$id_categoria', '" . date("Y-m-d") . "', '$nombre_completo','$email');";
    $database->setquery($sql);

    $database->query();
    return $codigo;
}


function com_mp_save_Stories($rut, $id_empresa, $id_categoria, $id_ambito, $nombre, $contenido, $tag, $archivo, $objetivo, $aplicacion, $metrica, $impacto, $id_subcategoria, $problema, $kpi_afectado, $cuantificacion, $coach, $nombre_archivo2, $multimedia, $url_documento, $tipo_multimedia, $imagen_fondo, $tipodepublicacion, $resumen, $fuente)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $ultimo_id = ObtengoUltimoRegistroST($id_empresa);
    $nuevo_id  = $ultimo_id[0]->id;
    $nuevo_id  = $nuevo_id + 1;
    $codigo    = $id_empresa . "_st" . $nuevo_id;
    $sql       = "INSERT INTO tbl_mp_stories(id_st, rut, id_empresa,id_categoria, fecha, hora, stories, video,  imagen) " . "VALUES
    ('$codigo', '$rut', '$id_empresa', '$id_categoria', '" . date("Y-m-d") . "','" . date("H:m:s") . "','$contenido', '$multimedia',
    '$imagen_fondo');";

    //echo $sql; sleep(5);
    $database->setquery($sql);



    $database->query();
    return $codigo;
}

function com_mp_save_post_question($rut, $id_empresa, $id_categoria, $id_ambito, $nombre, $contenido, $tag, $archivo, $objetivo, $aplicacion, $metrica, $impacto, $id_subcategoria, $problema, $kpi_afectado, $cuantificacion, $coach, $nombre_archivo2, $multimedia, $url_documento, $tipo_multimedia, $imagen_fondo, $tipodepublicacion, $resumen, $fuente)
{
    //echo "$rut, $id_empresa, $id_categoria, $id_ambito, $nombre, $contenido, $tag, $archivo, $objetivo, $aplicacion, $metrica, $impacto, $id_subcategoria, $problema, $kpi_afectado, $cuantificacion, $coach, $nombre_archivo2, $multimedia, $url_documento, $tipo_multimedia, $imagen_fondo, $tipodepublicacion, $resumen, $fuente";
    //exit();
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $ultimo_id = ObtengoUltimoRegistroMP($id_empresa);
    $nuevo_id  = $ultimo_id[0]->id;
    $nuevo_id  = $nuevo_id + 1;
    $codigo    = $id_empresa . "_mp" . $nuevo_id;
    $sql       = "INSERT INTO tbl_mp(id_mp, rut, id_empresa, fecha, id_estado, id_categoria, id_ambito, nombre, contenido,  archivo, objetivo, aplicacion,
    metrica, impacto, id_subcategoria, tipo, video, url_documento, tipo_post, imagenfondo, resumen, fuente) " . "VALUES ('$codigo', '$rut', '$id_empresa', '" . date("Y-m-d") . "', '5','$id_categoria','$id_ambito', '$nombre', '$contenido', '$archivo', '$objetivo', '$aplicacion' , '$metrica' , '$impacto', '$id_subcategoria',
    '$tipodepublicacion', '$multimedia', '$url_documento', '$tipo_multimedia', '$imagen_fondo', '$resumen', '$fuente');";
    $database->setquery($sql);
    //echo $sql;
    //exit();
    $database->query();
    return $codigo;
}
function com_mp_save_tags($id_mp, $id_empresa, $tag)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $ArregloTags = explode("#", $tag);
    for ($i = 0; $i <= count($ArregloTags); $i++) {
        if ($ArregloTags[$i]) {
            $sql = "INSERT INTO tbl_mp_tag (id_mp, tag, id_empresa)
    VALUES ('$id_mp', '" . $ArregloTags[$i] . "', '$id_empresa');";
            $database->setquery($sql);
            $database->query();
        }
    }
}
function com_mp_save_interacciones($id_mp, $id_empresa, $rut)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "

    SELECT rut_remitente
    from
    tbl_mp_interacciones where  rut_remitente<>'$rut' and rut='$rut'
    and tipo='SEGUIDO'

    and id_empresa='$id_empresa'



    ";
    $database->setquery($sql);
    $database->query();
    $cod        = $database->listObjects();
    $seguidores = $cod[0]->rut_remitente;
    $hoy        = date("Y-m-d");
    for ($i = 0; $i <= count($cod); $i++) {
        if ($cod[$i]->rut_remitente <> '') {
            $sql = "INSERT INTO tbl_mp_interacciones
    (id_mp, id_empresa, tipo, fecha, rut_remitente)
    VALUES ('" . $id_mp . "','" . $id_mp . "','PUBLICACION_SEGUIDO','$hoy', '" . $cod[$i]->rut_remitente . "');";
            $database->setquery($sql);
            $database->query();
        }
    }
}
function com_mp_save_vista($id_mp, $id_empresa, $tag, $id_categoria, $nombre, $resumen, $rut)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "

    SELECT categoria
    from
    tbl_mp_categorias where

    id_categoria='$id_categoria'



    ";
    $database->setquery($sql);
    $database->query();
    $cod         = $database->listObjects();
    $categoria   = $cod[0]->categoria;
    $ArregloTags = explode("#", $tag);
    for ($i = 0; $i <= count($ArregloTags); $i++) {
        if ($ArregloTags[$i]) {
            $sql = "INSERT INTO tbl_mp_vista (contenido, tipo, ambiente,codigo, id_empresa)
    VALUES ('" . $ArregloTags[$i] . "','post','?sw=com_mp_full&id_mp=','$id_mp', '$id_empresa');";
            $database->setquery($sql);
            $database->query();
        }
    }
    $sql = "INSERT INTO tbl_mp_vista (contenido, tipo, ambiente,codigo, id_empresa)
    VALUES ('$nombre','post','?sw=com_mp_full&id_mp=','$id_mp', '$id_empresa');";
    $database->setquery($sql);
    $database->query();
    $sql = "INSERT INTO tbl_mp_vista (contenido, tipo, ambiente,codigo, id_empresa)
    VALUES ('$resumen','post','?sw=com_mp_full&id_mp=','$id_mp', '$id_empresa');";
    $database->setquery($sql);
    $database->query();
    $sql = "INSERT INTO tbl_mp_vista (contenido, tipo, ambiente,codigo, id_empresa)
    VALUES ('$categoria','post','?sw=com_mp_full&id_mp=','$id_mp', '$id_empresa');";
    $database->setquery($sql);
    $database->query();
    $sql2 = "select count(id) from tbl_mp_vista where codigo='" . $rut . "'";
    $database->setquery($sql2);
    $database->query();
    $cod2 = $database->listObjects();
    if (count($cod2) == 0) {
        $sql3 = "select nombre_completo from tbl_usuario where rut='" . $rut . "'";
        $database->setquery($sql3);
        $database->query();
        $cod3 = $database->listObjects();
        $sql  = "INSERT INTO tbl_mp_vista (contenido, tipo, ambiente,codigo, id_empresa)
    VALUES ('" . $cod3[0]->nombre_completo . "','expertos','?sw=com_mp_personal&vp=1&rut_enviado==','$rut', '$id_empresa');";
        $database->setquery($sql);
    }
}
function com_mp_tag_data($id_empresa, $rut, $limit)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "SELECT
    h.*, count(id)
    FROM
    tbl_mp_tag h
    WHERE
    h.tag <> ''
    AND h.id_empresa = '$id_empresa'
    AND (
    SELECT
    id_estado
    FROM
    tbl_mp
    WHERE
    id_mp = h.id_mp AND h.id_empresa = '$id_empresa' limit 1
    ) >= 5
    GROUP BY
    h.tag
    ORDER BY
    count(id) DESC

    limit $limit
    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function com_mp_insert_tag_data($rut, $id_empresa, $tag)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $tag = utf8_decode($tag);
    $sql = "INSERT INTO tbl_mp_interacciones(rut, id_empresa, contenido, tipo, fecha) " . "VALUES ('$rut', '$id_empresa','$tag','INTERES', '" . date("Y-m-d") . "')";
    $database->setquery($sql);
    $database->query();
    return ("bci_mp_" . $nuevo_id);
}
function TraeDatosPostFijo($tipo, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
    select *
    from tbl_mp
    where id_empresa='$id_empresa'
    and id_ambito='$tipo' LIMIT 1
    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TraeDatosPostFijoFija($id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
    select *
    from tbl_mp
    where id_empresa='$id_empresa'
    and (id_ambito='FIJO' or id_ambito='FIJA')

    order by id DESC LIMIT 1
    ";
    // echo "<br><br><br><br>$sql";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function com_mp_guardabusquedas($rut, $id_empresa, $query)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $hoy = date("Y-m-d");
    $sql = "insert into tbl_mp_interacciones (rut,tipo, fecha,contenido,id_empresa)
    VALUES ('$rut', 'BUSQUEDA','$hoy','$query', '$id_empresa')    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
}
function com_mp_seguir($rut, $rut_enviado, $id_empresa, $seguir)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_mp_interacciones  where id_empresa='$id_empresa'
    and rut='$rut_enviado' and rut_remitente='$rut' and tipo='SEGUIDO'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    if (count($cod) == 0 and $seguir == "seguir") {
        $hoy = date("Y-m-d");
        $sql = "insert into tbl_mp_interacciones (rut,rut_remitente,tipo, fecha,id_empresa) VALUES ('$rut_enviado', '$rut', 'SEGUIDO','$hoy', '$id_empresa')    ";
        $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();
    }
    if ($seguir == "dejardeseguir") {
        $sql = "delete from tbl_mp_interacciones where rut='$rut_enviado' and rut_remitente='$rut' and tipo='SEGUIDO' and id_empresa='$id_empresa'";
        $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();
    }
    return $cod;
}
function com_mp_similares_data($id_empresa, $id_mp, $id_categoria)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "SELECT h.*, (select nombre_completo from tbl_usuario where rut=h.rut) as nombre_autor
    FROM tbl_mp h WHERE h.id_empresa = '$id_empresa'

    and h.id_mp <> '$id_mp'  and h.id_categoria ='$id_categoria'

    order by

    ((select count(id) from tbl_mp_interacciones where id_mp=h.id_mp and tipo='VISITA')+(select count(id) from tbl_mp_interacciones where id_mp=h.id_mp and tipo='FAVORITA')+(select count(id) from tbl_mp_interacciones where id_mp=h.id_mp and tipo='COMPARTIDOCONMIGO')+(select count(id) from tbl_mp_interacciones where id_mp=h.id_mp and tipo='MEGUSTA')) DESC

    limit 5
    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function com_mp_full_data($id_empresa, $id_mp)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "SELECT
    tbl_mp.*,

    ((  SELECT  count(id)   FROM    tbl_mp_comentarios  WHERE   id_mp = tbl_mp.id_mp    ) + (   SELECT  count(id)   FROM    tbl_mp_comentarios_reply    WHERE   id_mp = tbl_mp.id_mp    )) AS numcomentarios,
    (select count(id) from tbl_mp_interacciones where id_mp=tbl_mp.id_mp and tipo='MEGUSTA') AS nummegusta,
    (select count(id) from tbl_mp_interacciones where id_mp=tbl_mp.id_mp and tipo='COMPARTIDOCONMIGO') AS numcompartido,
    (select count(id) from tbl_mp_interacciones where id_mp=tbl_mp.id_mp and tipo='FAVORITA') AS numfavorita,
    (select count(id) from tbl_mp_interacciones where id_mp=tbl_mp.id_mp and tipo='VISITA') AS numvisitas,

    tbl_mp_categorias.categoria,
    tbl_mp_categorias.style,
    tbl_mp_categorias.icono,
    tbl_mp_categorias.descripcion AS descripcion_categoria,
    tbl_mp_estados.estado,
    tbl_mp_estados.estilo,
    tbl_mp_estados.descripcion AS descripcion_estado,
    tbl_mp_estados.icono AS icono_estado,
    tbl_usuario.nombre_completo AS nombre_autor

    FROM tbl_mp

    INNER JOIN tbl_mp_categorias ON tbl_mp_categorias.id_categoria = tbl_mp.id_categoria
    inner join tbl_mp_estados
    on tbl_mp_estados.id_estado=tbl_mp.id_estado
    inner join tbl_usuario
    on tbl_usuario.rut=tbl_mp.rut

    WHERE

    tbl_mp.id_empresa = '$id_empresa'

    and tbl_mp.id_mp = '$id_mp'
    and tbl_mp.id_estado>=5

    ";   // sleep(5);
    //echo $sql;
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}

function com_mp_full_Stories_data($id_empresa, $id_mp)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "SELECT
    tbl_mp_stories.*


    FROM tbl_mp_stories



    WHERE

    tbl_mp_stories.id_empresa = '$id_empresa'

    and tbl_mp_stories.id_st = '$id_mp'

    ";
    //echo $sql;
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}


function com_mp_full_GPTW_data($id_empresa, $id_mp)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "SELECT
    tbl_mp_fotomensaje.*


    FROM tbl_mp_fotomensaje



    WHERE

    tbl_mp_fotomensaje.id_empresa = '$id_empresa'

    and tbl_mp_fotomensaje.id = '$id_mp'

    ";
    //echo $sql;
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}

function com_mp_busca_interaccion($id_empresa, $rut, $rut_remitente, $interaccion, $limit)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    if ($rut_remitente <> '') {
        $querys_rut_remitente = " and h.rut_remitente ='" . $rut_remitente . "'";
    } else {
        $querys_rut_remitente = "";
    }
    if ($rut <> '') {
        $querys_rut = " and h.rut ='" . $rut . "'";
    } else {
        $querys_rut = "";
    }
    $sql = "

    select h.*,
    (select nombre_completo from tbl_usuario where rut=h.rut) as nombre,
    (select cargo from tbl_usuario where rut=h.rut) as cargo,
    (select gerencia from tbl_usuario where rut=h.rut) as gerencia,

    (select nombre_completo from tbl_usuario where rut=h.rut_remitente) as nombreR,
    (select cargo from tbl_usuario where rut=h.rut_remitente) as cargoR,
    (select gerencia from tbl_usuario where rut=h.rut_remitente) as gerenciaR

    from tbl_mp_interacciones h

    where
    h.id_empresa='$id_empresa'
    and h.tipo='$interaccion'

    $querys_rut_remitente
    $querys_rut

    and (    SELECT            vigencia        FROM            tbl_usuario        WHERE            rut = h.rut_remitente    )<>1
    and (    SELECT            vigencia        FROM            tbl_usuario        WHERE            rut = h.rut    )<>1
    and h.rut_remitente<>h.rut

    ";
    //echo "<br><br>$sql";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function com_mp_mis_publicaciones($id_empresa, $rut, $tipo, $limit)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    if ($tipo == "mis_publicaciones") {
        $query_mispub = " and tbl_mp.rut='$rut' and tbl_mp.id_empresa='$id_empresa' ";
    }
    if ($tipo == "mis_publicaciones_seguidas") {
        $query_mispubseg = "

    and (select rut from tbl_mp_interacciones where (tipo ='MEGUSTA' OR  tipo ='FAVORITA')
    AND id_mp=tbl_mp.id_mp and rut='$rut' limit 1)='$rut'

    ";
    }
    $sql = "SELECT
    tbl_mp.*,

    (select count(id) from tbl_mp_interacciones where id_mp=tbl_mp.id_mp and tipo='COMENTARIO') AS numcomentarios,
    (select count(id) from tbl_mp_interacciones where id_mp=tbl_mp.id_mp and tipo='MEGUSTA') AS nummegusta,
    (select count(id) from tbl_mp_interacciones where id_mp=tbl_mp.id_mp and tipo='NOMEGUSTA') AS numnomegusta,
    (select count(id) from tbl_mp_interacciones where id_mp=tbl_mp.id_mp and tipo='COMPARTIDOCONMIGO') AS numcompartido,
    (select count(id) from tbl_mp_interacciones where id_mp=tbl_mp.id_mp and tipo='FAVORITA') AS numfavorita,
    (select count(id) from tbl_mp_interacciones where id_mp=tbl_mp.id_mp and tipo='VISITA') AS numvisitas,

    tbl_mp_categorias.categoria,
    tbl_mp_categorias.style,
    tbl_mp_categorias.icono,
    tbl_mp_categorias.descripcion AS descripcion_categoria,
    tbl_mp_estados.estado,
    tbl_mp_estados.estilo,
    tbl_mp_estados.descripcion AS descripcion_estado,
    tbl_mp_estados.icono AS icono_estado,
    tbl_usuario.nombre_completo AS nombre_autor


    FROM tbl_mp

    INNER JOIN tbl_mp_categorias ON tbl_mp_categorias.id_categoria = tbl_mp.id_categoria
    inner join tbl_mp_estados
    on tbl_mp_estados.id_estado=tbl_mp.id_estado
    inner join tbl_usuario
    on tbl_usuario.rut=tbl_mp.rut

    WHERE
    tbl_mp.id_empresa = '$id_empresa'
    and (tbl_mp.id_ambito<>'FIJO' or tbl_mp.id_ambito<>'FIJA')
    and tbl_mp.id_estado>=5

    $query_mispub
    $query_mispubseg

    ORDER BY tbl_mp.fecha DESC
    LIMIT $limit";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}


function com_mp_lista_personal($id_empresa, $rut, $ord_by, $filt_by, $filt_cat, $vp, $arreglo_tags, $tag, $rut_enviado, $ambiente, $com_limit, $com_start, $start_limit, $subcategoria, $id_amb)
{
     //echo "ho com_mp_lista_personal";
    //echo $start_limit;
   /* echo "$id_empresa, $rut, $ord_by, $filt_by, $filt_cat, $vp, $arreglo_tags, $tag, $rut_enviado, $ambiente,
    //$com_limit, $com_start, $start_limit, subcategoria $subcategoria, $id_amb";  */
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    if ($subcategoria <> '') {
        $query_subcategoria_mundo = "  and tbl_mp.id_subcategoria='" . $subcategoria . "'  ";
    } else {
        $query_subcategoria_mundo = "  and (tbl_mp.id_subcategoria='')  ";
    }
    if ($id_amb <> '') {
        $query_ambito = "  and tbl_mp.id_ambito='" . $id_amb . "'  ";
    } else {
        $query_ambito = "    ";
    }
    if ($start_limit > 0) {
        $start_limit = $start_limit * 10;
        $limite      = " LIMIT $start_limit, $com_limit ";
    } else {
        if ($com_limit >= 0 and $com_start >= 0) {
            $limite = " LIMIT $com_start, $com_limit ";
        } else {
            $limite = "";
        }
    }
    $sql_grupos_seguidos = "SELECT contenido as grupos_seguidos    FROM tbl_mp_interacciones    where tipo='GRUPOSEGUIDO' and rut='$rut' and id_empresa='$id_empresa'";
    $database->setquery($sql_grupos_seguidos);
    $database->query();
    $grupos_seguidos       = $database->listObjects();
    $sql_personas_seguidos = "SELECT rut as personas_seguidas    FROM tbl_mp_interacciones    where tipo='SEGUIDO' and rut_remitente='$rut' and id_empresa='$id_empresa'";
    $database->setquery($sql_personas_seguidos);
    $database->query();
    $personas_seguidos        = $database->listObjects();
    $cuenta_grupos_seguidos   = count($grupos_seguidos);
    $cuenta_personas_seguidos = count($personas_seguidos);
    if ($cuenta_grupos_seguidos > 0) {
        $query_arreglo_GRUPOINTERESSEGUIDO .= " AND (";
        foreach ($grupos_seguidos as $grupo_seguido) {
            $or_query = "";
            $mpGI++;
            if ($mpGI < $cuenta_grupos_seguidos) {
                $or_query = " OR ";
            }
            $query_arreglo_GRUPOINTERESSEGUIDO .= " tbl_mp.id_categoria='" . $grupo_seguido->grupos_seguidos . "'  $or_query ";
        }
        $query_arreglo_GRUPOINTERESSEGUIDO .= ")";
    }
    if ($cuenta_personas_seguidos > 0) {
        $query_arreglo_PERSONASEGUIDA .= " OR (";
        foreach ($personas_seguidos as $persona_seguida) {
            $or_query = "";
            $mpPS++;
            if ($mpPS < $cuenta_personas_seguidos) {
                $or_query = " OR ";
            }
            $query_arreglo_PERSONASEGUIDA .= " tbl_mp.rut='" . $persona_seguida->personas_seguidas . "'  $or_query ";
        }
        $query_arreglo_PERSONASEGUIDA .= ")";
    }
    $filt_full  = explode("-", $filt_cat);
    $filt_field = $filt_full[0];
    $filt_data  = $filt_full[1];
    $cuenta_tag = count($arreglo_tags);
    if ($cuenta_tag > 0) {
        $query_arreglo_TagInteres .= " AND (";
        foreach ($arreglo_tags as $arreglo_tag) {
            $or_query = "";
            $mp++;
            if ($mp < $cuenta_tag) {
                $or_query = " OR ";
            }
            $query_arreglo_TagInteres .= "  (select tag from tbl_mp_tag where id_mp=tbl_mp.id_mp and tag='" . $arreglo_tag->contenido . "' limit 1)='" . $arreglo_tag->contenido . "' $or_query ";
        }
        $query_arreglo_TagInteres .= ")";
    }
    if ($tag <> '' and ambiente <> 'mp_cat') {
        $query_arreglo_TagInteres     = "  and (select tag from tbl_mp_tag where id_mp=tbl_mp.id_mp and tag like '%$tag%' limit 1) like '%$tag%'  ";
        $query_arreglo_TagInteresCatQ = "   (select tag from tbl_mp_tag where id_mp=tbl_mp.id_mp and tag like '%$tag%' limit 1) like '%$tag%' ";
    }
    $query_arreglo_TipoPub = "";
    if ($tag <> '' and $ambiente == 'mp_tipo') {
        $query_arreglo_TipoPub = " and tbl_mp.tipo='$tag' ";
    }
    if ($ambiente <> '' and $ambiente <> 'timeline') {
        $query_arreglo_GrupoInteres   = "";
        $query_arreglo_PersonaSeguida = "";
        $query_filt                   = "";
        $query_filt_cat               = "";
        $query_rut_enviado            = "";
        $query_ord                    = "";
    }
    if ($rut_enviado <> '') {
        $query_arreglo_TagInteres = "";
        $query_rut_enviado        = " and tbl_mp.rut = '$rut_enviado' ";
    }
    if ($ambiente == 'mp_tipo') {
        $query_arreglo_GrupoInteres   = "";
        $query_arreglo_PersonaSeguida = "";
        $query_arreglo_TagInteres     = "";
        $query_filt                   = "";
        $query_filt_cat               = "";
        $query_rut_enviado            = "";
        $query_ord                    = " ";
        $ordenQuery                   = " order by id DESC";
        $queryamb                     = "  ";
    }
    if ($ambiente == 'mp_mp') {
        $query_arreglo_GrupoInteres   = "";
        $query_arreglo_PersonaSeguida = "";
        $query_arreglo_TagInteres     = "";
        $query_filt                   = "";
        $query_filt_cat               = "";
        $query_rut_enviado            = "";
        $query_ord                    = " ";
        $ordenQuery                   = " order by  id DESC";
        $queryamb                     = " and tbl_mp.rut='$rut' ";
    }
    if ($ambiente == 'mp_mf') {
        $query_arreglo_GrupoInteres   = "";
        $query_arreglo_PersonaSeguida = "";
        $query_arreglo_TagInteres     = "";
        $query_filt                   = "";
        $query_filt_cat               = "";
        $query_rut_enviado            = "";
        $query_ord                    = " ";
        $ordenQuery                   = " order by  id DESC";
        $queryamb                     = " and ((select tipo FROM tbl_mp_interacciones where rut='$rut' and id_mp=tbl_mp.id_mp  and tipo='FAVORITA' LIMIT 1)='FAVORITA'
    or (select tipo FROM tbl_mp_interacciones where rut='$rut' and id_mp=tbl_mp.id_mp  and tipo='MEGUSTA' LIMIT 1)='MEGUSTA')";
    }
    if ($ambiente == 'mp_cc') {
        $query_arreglo_GrupoInteres   = "";
        $query_arreglo_PersonaSeguida = "";
        $query_arreglo_TagInteres     = "";
        $query_filt                   = "";
        $query_filt_cat               = "";
        $query_rut_enviado            = "";
        $query_ord                    = " ";
        $ordenQuery                   = " order by  id DESC";
        $queryamb                     = "  and (select tipo FROM tbl_mp_interacciones where rut='$rut' and id_mp=tbl_mp.id_mp and tipo='COMPARTIDOCONMIGO' LIMIT 1)='COMPARTIDOCONMIGO'
    ";
    }
    if ($ambiente == 'mp_cat') {
        $query_arreglo_GrupoInteres   = "";
        $query_arreglo_PersonaSeguida = "";
        $query_filt                   = "";
        $query_rut_enviado            = "";
        $query_ord                    = " ";
        $query_filt_cat               = " AND  (  tbl_mp_categorias.id_categoria='$filt_cat')";
        $query_arreglo_TagInteres     = "";
    }
    $ordenQuery = "";
    $tipoOrden  = rand(1, 3);
    if ($tipoOrden == 1) {
        $ordenQuery = " order by fecha DESC ";
    }
    if ($tipoOrden == 2) {
        $ordenQuery = " order by fecha DESC ";
    }
    if ($tipoOrden == 3) {
        $ordenQuery = " order by fecha DESC";
    }
    if ($ambiente == 'recientes') {
        $query_arreglo_TagInteres     = "";
        $query_arreglo_GrupoInteres   = "";
        $query_arreglo_PersonaSeguida = "";
        $query_filt                   = "";
        $query_filt_cat               = "";
        $query_rut_enviado            = "";
        $query_ord                    = "  order by id_ambito DESC,  id DESC";
        $ordenQuery                   = "";
    }
    if ($ambiente == 'populares') {
        $query_arreglo_TagInteres = "";
        $query_filt               = "";
        $query_filt_cat           = "";
        $query_rut_enviado        = "";
        $query_ord                = " order by popular DESC";
        $ordenQuery               = "";
    }
    if ($ambiente == 'mp_rec') {
        $query_arreglo_TagInteres = "";
        $query_filt               = "";
        $query_filt_cat           = "";
        $query_rut_enviado        = "";
        $query_ord                = "  order by id_ambito DESC,  id DESC";
        $ordenQuery               = "";
    }
    if ($ambiente == 'mp_interes') {
        $query_arreglo_GrupoInteres   = "";
        $query_arreglo_PersonaSeguida = "";
        $query_filt                   = "";
        $query_filt_cat               = "";
        $query_rut_enviado            = "";
        $query_ord                    = " order by popular DESC";
        $ordenQuery                   = "";
    }
    if ($ambiente == "mp_populares") {
        $query_arreglo_GrupoInteres   = "";
        $query_arreglo_PersonaSeguida = "";
        $query_arreglo_TagInteres     = "";
        $query_filt                   = "";
        $query_filt_cat               = "";
        $query_rut_enviado            = "";
        $query_ord                    = " order by popular DESC";
        $ordenQuery                   = "";
    }
    if ($ambiente == "" and $subcategoria <> '') {
        $query_arreglo_GrupoInteres   = "$query_arreglo_GRUPOINTERESSEGUIDO";
        $query_arreglo_PersonaSeguida = "$query_arreglo_PERSONASEGUIDA";
        $query_arreglo_TagInteres     = "";
        $query_filt                   = "";
        $query_filt_cat               = "";
        $query_rut_enviado            = "";
        $query_ord                    = "  order by id_ambito DESC,  id DESC";
        $ordenQuery                   = "";
    }
    if ($ambiente == "" and $subcategoria == '') {
        $query_arreglo_GrupoInteres   = "$query_arreglo_GRUPOINTERESSEGUIDO";
        $query_arreglo_PersonaSeguida = "$query_arreglo_PERSONASEGUIDA";
        $query_arreglo_TagInteres     = "";
        $query_filt                   = "";
        $query_filt_cat               = "";
        $query_rut_enviado            = "";
        $query_ord                    = " order by id_ambito DESC,  id DESC";
        $ordenQuery                   = "";
    }
    //no muestra pregunta
    $and_tipo_publicacion_no_pregunta = " and tbl_mp.tipo<>'Pregunta' ";
    //$and_tipo_publicacion_no_pregunta="  ";
    $and_tipo_publicacion_no_home     = " and tbl_mp.tipo<>'Novedades'

    and tbl_mp.tipo<>'Foto'
    and tbl_mp.tipo<>'Capacitaciones'
    ";

    // (select count(id) from tbl_mp_interacciones where id_mp=tbl_mp.id_mp and tipo='NOMEGUSTA') AS numnomegusta,
    // (select count(id) from tbl_mp_interacciones where id_mp=tbl_mp.id_mp and tipo='COMPARTIDOCONMIGO') AS numcompartido,
    // (select count(id) from tbl_mp_interacciones where id_mp=tbl_mp.id_mp and tipo='FAVORITA') AS numfavorita,

    $sql                              = "
    SELECT    tbl_mp.*,
    ((  SELECT  count(id)   FROM    tbl_mp_comentarios  WHERE   id_mp = tbl_mp.id_mp    ) + (   SELECT  count(id)   FROM    tbl_mp_comentarios_reply    WHERE   id_mp = tbl_mp.id_mp    )) AS numcomentarios,
    (select count(id) from tbl_mp_interacciones where id_mp=tbl_mp.id_mp and tipo='MEGUSTA') AS nummegusta,
    (select count(id) from tbl_mp_interacciones where id_mp=tbl_mp.id_mp and tipo='VISITA') AS numvisitas,
    (select ambito from tbl_mp_ambitos where id_ambito=tbl_mp.id_ambito and id_empresa=tbl_mp.id_empresa) AS ambito,

    tbl_mp_categorias.categoria,
    tbl_mp_categorias.style,
    tbl_mp_categorias.icono,
    tbl_mp_categorias.descripcion AS descripcion_categoria

    FROM tbl_mp

    INNER JOIN tbl_mp_categorias ON tbl_mp_categorias.id_categoria = tbl_mp.id_categoria

    $inner

    WHERE
    tbl_mp.id_empresa = '$id_empresa'
    and (tbl_mp.id_ambito<>'FIJO'  or tbl_mp.id_ambito<>'FIJA')
    and tbl_mp.id_estado>='5'

    $and_tipo_publicacion_no_pregunta
    $and_tipo_publicacion_no_home

    $query_arreglo_TagInteres
    $query_filt
    $query_filt_cat
    $query_arreglo_TipoPub
    $query_rut_enviado
    $query_subcategoria_mundo

    $query_ord
    $queryamb
    $query_ambito

    $ordenQuery
    $limite

    ";


    // echo "<br>$sql";sleep(3);

    //and tbl_mp.id_mp='62_mp935'
    //$query_arreglo_GrupoInteres
    //$query_arreglo_PersonaSeguida

    //echo $sql;
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ComMp_BuscaNumTipo($rut, $id_empresa, $tipo)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    if ($tipo == "MISFAVORITAS") {
        $sql = "select h.*, (select id_mp from tbl_mp where id_mp=h.id_mp),
    (select nombre from tbl_mp where id_mp=h.id_mp),
    (select rut from tbl_mp where id_mp=h.id_mp)
    from tbl_mp_interacciones h

    INNER JOIN tbl_mp_categorias ON tbl_mp_categorias.id_categoria = (select id_categoria from tbl_mp where id_mp=h.id_mp)
    inner join tbl_mp_estados
    on tbl_mp_estados.id_estado=(select id_estado from tbl_mp where id_mp=h.id_mp)
    inner join tbl_usuario
    on tbl_usuario.rut=(select rut from tbl_mp where id_mp=h.id_mp)

    where

    (h.tipo='MEGUSTA' OR h.tipo='FAVORITA') AND h.rut='$rut' and h.id_empresa='$id_empresa'
    and  (select id_mp from tbl_mp where id_mp=h.id_mp) is not NULL

    group by h.id_mp";
    }
    if ($tipo == "COMPARTIDASCONMIGO") {
        $sql = "select h.*, (select id_mp from tbl_mp where id_mp=h.id_mp),
    (select nombre from tbl_mp where id_mp=h.id_mp),
    (select rut from tbl_mp where id_mp=h.id_mp)
    from tbl_mp_interacciones h

    INNER JOIN tbl_mp_categorias ON tbl_mp_categorias.id_categoria = (select id_categoria from tbl_mp where id_mp=h.id_mp)
    inner join tbl_mp_estados
    on tbl_mp_estados.id_estado=(select id_estado from tbl_mp where id_mp=h.id_mp)
    inner join tbl_usuario
    on tbl_usuario.rut=(select rut from tbl_mp where id_mp=h.id_mp)

    where

    (h.tipo='COMPARTIDOCONMIGO' ) AND h.rut='$rut' and h.id_empresa='$id_empresa'
    and  (select id_mp from tbl_mp where id_mp=h.id_mp) is not NULL

    group by h.id_mp";
    }
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function com_mp_lista_personal_expertos($tag, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select h.*, (select nombre_completo from tbl_usuario where rut=h.rut) as nombre_experto  from tbl_mp_expertos h where h. id_empresa='$id_empresa' and tag like '%$tag%'  group by h.rut";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function com_mp_tag_interes($rut, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_mp_interacciones where id_empresa='$id_empresa' and rut='$rut' and tipo='INTERES'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TraeDatosEvaluadoEvaluadorPorEmpresaProceso($evaluado, $evaluador, $id_empresa, $id_proceso)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
    SELECT
    tbl_sgd_relaciones.perfil_evaluacion_competencias,
    rel_sgd_perfil_competencias.*,
    tbl_sgd_componente.nombre as nombre_competencia,
    tbl_sgd_componente.descripcion as descripcion_competencia
    FROM
    tbl_sgd_relaciones
    inner join rel_sgd_perfil_competencias
    on rel_sgd_perfil_competencias.perfil_evaluacion=tbl_sgd_relaciones.perfil_evaluacion_competencias
    inner join tbl_sgd_componente
    on tbl_sgd_componente.id=rel_sgd_perfil_competencias.id_componente
    WHERE
    tbl_sgd_relaciones.evaluado = '$evaluado'
    AND tbl_sgd_relaciones.evaluador = '$evaluador'
    AND tbl_sgd_relaciones.id_empresa = '$id_empresa'
    AND tbl_sgd_relaciones.id_proceso = '$id_proceso'
    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function totalMetricasObjetivosPorEmpresa($id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_objetivos_metricas where id_empresa='$id_empresa'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TotalUsuariosPorRutJefeResponsable($rut)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
    select     h.*,
    (select count(id) from tbl_lms_acciones_pendientes where rut_colaborador=h.rut)  as cuenta
    from tbl_usuario h
    where h.responsable='$rut'
    and h.vigencia='0'
    order by (select count(id) from tbl_lms_acciones_pendientes where rut_colaborador=h.rut) desc, h.nombre asc
    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}

 function NotificacionesTalentPendiente($rut, $fecha, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "

select count(id) as cuenta

from tbl_skills_usuarios h where id_empresa='$id_empresa' and h.rut='$rut'


";
//echo $sql;
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}

function NotificacionesEncuestasPendientes($rut, $fecha, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "

select h.*,
(select count(id) from tbl_enc_elearning_preg where id_encuesta=h.id_encuesta) as preguntas,
(select count(id) from tbl_enc_elearning_respuestas where id_encuesta=h.id_encuesta and rut='$rut') as respuestas

from tbl_enc_elearning_usuarios h where id_empresa='$id_empresa' and h.rut='$rut' and h.jefe is null

union

select h.*,
(select count(id) from tbl_enc_elearning_preg where id_encuesta=h.id_encuesta) as preguntas,
(select count(id) from tbl_enc_elearning_respuestas where id_encuesta=h.id_encuesta and jefe='$rut' and rut=h.rut) as respuestas

from tbl_enc_elearning_usuarios h where id_empresa='$id_empresa' and h.jefe='$rut' and h.rut<>h.jefe

";
//echo $sql;
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}


function NotificacionesFormacionContinuaPendientes($rut, $fecha, $id_empresa)
{


     $id_empresa=$_SESSION["id_empresa"];
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "

select h.*  from tbl_postulaciones h where h.id_empresa='$id_empresa'
h.jefe='$rut' and h.jefeok=''

";
//echo $sql;
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}


function NotificacionesEncuestasMedicionPorDiaPendientes($rut, $fecha, $id_empresa, $id_encuesta, $id_medicion)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "

        select count(id) as cuenta from tbl_enc_elearning_respuestas where id_encuesta='$id_encuesta' and rut='$rut' and fecha='$fecha'
            ";

        //echo $sql;

    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}


function MedidorEstadoAnimo($rut, $fecha, $id_empresa, $id_encuesta, $id_medicion)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "

select h.*,
(select count(id) from tbl_enc_elearning_preg where id_encuesta=h.id_encuesta) as preguntas,
(select count(id) from tbl_enc_elearning_respuestas where id_encuesta=h.id_encuesta and h.rut='$rut') as respuestas

from tbl_enc_elearning_usuarios h where id_empresa='$id_empresa' and h.rut='$rut' and h.jefe is null

union

select h.*,
(select count(id) from tbl_enc_elearning_preg where id_encuesta=h.id_encuesta) as preguntas,
(select count(id) from tbl_enc_elearning_respuestas where id_encuesta=h.id_encuesta and h.jefe='$rut' and rut=h.rut) as respuestas

from tbl_enc_elearning_usuarios h where id_empresa='$id_empresa' and h.jefe='$rut' and h.rut<>h.jefe

";

    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}



function EsJefeResponsabletblUsuario($rut, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
    select count(id) as cuenta from tbl_usuario where responsable='$rut' and id_empresa='$id_empresa'
    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod[0]->cuenta;
}
function EsLiderEjecutivotblUsuario($rut, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
    select count(id) as cuenta from tbl_usuario where lider='$rut' and id_empresa='$id_empresa'
    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod[0]->cuenta;
}
function TraigoMalladadoRutCursoEmpresa($rut, $id_curso, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "

    SELECT * FROM tbl_inscripcion_usuarios WHERE rut = '$rut' AND id_curso= '$id_curso'    AND id_empresa= '$id_empresa'

    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TraigoObjetosDadoRutYMalla($rut, $malla, $id_objeto)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    if ($id_objeto) {
        $filtro_objeto = " and tbl_objeto.id='$id_objeto'";
    }
    if ($_GET["sw"] == "MuestraBloqueColaboradoresPorJefe" && $_SESSION["id_objeto_para_vistaequipo"]) {
        $filtro_objeto = " and tbl_objeto.id='" . $_SESSION["id_objeto_para_vistaequipo"] . "'";
    }
    $sql = "select tbl_objeto.id as id_objeto, tbl_objeto.titulo as nombre_objeto, tbl_objetos_finalizados.nota, rel_lms_malla_curso.id_curso,
    tbl_objeto.extension_objeto



    from rel_lms_malla_curso
    inner join tbl_objeto
    on tbl_objeto.id_curso=rel_lms_malla_curso.id_curso
    left join tbl_objetos_finalizados
    on tbl_objetos_finalizados.id_objeto=tbl_objeto.id and tbl_objetos_finalizados.rut='$rut'
    where

    ( rel_lms_malla_curso.id_malla = '$malla' AND tbl_objeto.tipo_objeto = '5' )
    or ( rel_lms_malla_curso.id_malla = '$malla'  and tbl_objeto.extension_objeto='23')



    $filtro_objeto
    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function LMS_ConsultaRutSegunEmail_data($email, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select h.* from tbl_usuario h where h.email='$email' and h.id_empresa='$id_empresa' and h.vigencia='0' and h.rut<>''";
    //echo "<br>$c_host, $c_user, $c_pass, $c_db";
    //echo "<br>$sql";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function NotasPonderacionPorObjetoRut($rut, $id_curso, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "    select tbl_objeto.id , tbl_objetos_finalizados.nota, tbl_objeto.ponderacion
    from tbl_objeto
    left join tbl_objetos_finalizados
    on tbl_objetos_finalizados.rut='$rut' and tbl_objeto.id=tbl_objetos_finalizados.id_objeto and tbl_objetos_finalizados.id_curso='$id_curso'
    where tbl_objeto.id_curso='$id_curso' and tbl_objeto.tipo_objeto='5' and tbl_objeto.id_empresa='$id_empresa'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TienePonderacionDimensionPorUsuarioDimension($evaluado, $id_empresa, $id_dimension)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_objetivos_dimension_ponderaciones where evaluado='$evaluado' and id_empresa='$id_empresa' and id_dimension='$id_dimension'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ActualizaPonderacionDimension2PorEvaluado($id_dimension, $ponderacion, $id_empresa, $rut_evaluado)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "UPDATE tbl_objetivos_dimension_ponderaciones
    SET ponderacion= '$ponderacion'
    where id_empresa='$id_empresa' and evaluado='$rut_evaluado' and id_dimension='$id_dimension'";
    $database->setquery($sql);
    $database->query();
}
function InsertaPonderacionPorDimensionUsuario($evaluado, $id_empresa, $id_dimension, $ponderacion)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $fecha = date("Y-m-d");
    $hora  = date("H:i:s");
    $sql   = "INSERT INTO tbl_objetivos_dimension_ponderaciones(id_dimension, evaluado, ponderacion, id_empresa) " . "VALUES ('$id_dimension', '$evaluado', '$ponderacion', '$id_empresa');";
    $database->setquery($sql);
    $database->query();
}
function TienePonderacionDimensionPorUsuario2($evaluado, $id_empresa, $id_dimension)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_objetivos_dimension_ponderaciones where evaluado='$evaluado' and id_empresa='$id_empresa' and id_dimension='$id_dimension'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TienePonderacionDimensionPorUsuario($evaluado, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_objetivos_dimension_ponderaciones where evaluado='$evaluado' and id_empresa='$id_empresa'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ActualizaPonderacionDimension2($id_dimension, $ponderacion)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "UPDATE tbl_objetivos_dimension  SET ponderacion= '$ponderacion' where id='$id_dimension'";
    $database->setquery($sql);
    $database->query();
}
function TraeObjetivosDAdoRutDimensionYMetrica($rut, $id_empresa, $id_dimension, $metrica)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
    SELECT
    tbl_objetivos_individuales.*
    FROM     tbl_objetivos_individuales
    WHERE tbl_objetivos_individuales.rut = '$rut' and tbl_objetivos_individuales.dimension='$id_dimension'  and descripcion_objetivo ='$metrica'

    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TraigoBloqueTextoPorDesafio($id_desafio, $rut, $id_objeto, $id_curso, $id_desafio, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
    SELECT
    tbl_lms_desafios_bloque_textos.*
    FROM
    tbl_lms_desafiosfon
    INNER JOIN rel_lms_desafios_bloque_textos ON rel_lms_desafios_bloque_textos.id_desafio = tbl_lms_desafios.id
    INNER JOIN tbl_lms_desafios_bloque_textos ON tbl_lms_desafios_bloque_textos.id = rel_lms_desafios_bloque_textos.id_bloque_texto
    WHERE
    tbl_lms_desafios.id = '$id_desafio'

    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ObtenerAccionesPendientesPorJefeYEmpresaPorObjeto($rut, $id_empresa, $rut_colaborador, $id_objeto)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    if ($rut_colaborador) {
        $filtro_rut_colaborador = " and  tbl_lms_acciones_pendientes.rut_colaborador = '$rut_colaborador'";
    }
    if ($id_objeto) {
        $filtro_id_objeto = " and  tbl_lms_acciones_pendientes.id_objeto = '$id_objeto'";
    }
    $sql = "SELECT
    tbl_lms_acciones_pendientes.*, tbl_lms_desafios_finalizados.fecha AS fecha_desafio_validado, tbl_objeto.id_desafio
    FROM
    tbl_lms_acciones_pendientes
    LEFT JOIN tbl_lms_desafios_finalizados ON tbl_lms_desafios_finalizados.rut_colaborador = tbl_lms_acciones_pendientes.rut_colaborador
    AND tbl_lms_acciones_pendientes.id_objeto = tbl_lms_desafios_finalizados.id_objeto

    inner join tbl_objeto on tbl_objeto.id=tbl_lms_acciones_pendientes.id_objeto

    WHERE
    tbl_lms_acciones_pendientes.rut_jefe = '$rut'
    AND tbl_lms_desafios_finalizados.fecha IS NULL
    AND tbl_lms_acciones_pendientes.id_empresa = '$id_empresa'
    and  tbl_lms_acciones_pendientes.rut_colaborador = '$rut_colaborador'
    and  tbl_lms_acciones_pendientes.id_objeto = '$id_objeto'


    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TraeUltimaRespuestaLogDesafios($rut, $id_desafio, $id_objeto, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "    select * from tbl_lms_desafios_respuestas_log where rut='$rut' and id_objeto='$id_objeto' and id_desafio='$id_desafio' and id_empresa='$id_empresa' order by id desc limit 1";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TraeUltimoComentarioObjeto($rut, $id_objeto)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "    select * from tbl_objeto_comentarios where rut='$rut' and id_objeto='$id_objeto' order by id desc limit 1";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function VerificarRespuestasLogDesafioPorVersion($rut, $id_desafio)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "    select count(*) from tbl_lms_desafios_respuestas_log where id_desafio='$id_desafio' and rut='$rut' GROUP BY version";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function InsertaRespuestaDesafioLog($rut, $id_pregunta, $respuesta, $id_objeto, $id_curso, $id_empresa, $id_desafio, $version)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $fecha = date("Y-m-d");
    $hora  = date("H:i:s");
    $sql   = "INSERT INTO tbl_lms_desafios_respuestas_log(rut, id_pregunta, respuesta, id_objeto, id_curso, id_empresa, id_desafio, fecha, hora, version) " . "VALUES ('$rut', '$id_pregunta', '$respuesta', '$id_objeto', '$id_curso', '$id_empresa', '$id_desafio', '$fecha', '$hora', '" . $version . "');";
    $database->setquery($sql);
    $database->query();
}
function ObtenerAccionesPendientesPorJefeYEmpresa($rut, $id_empresa, $rut_colaborador, $id_objeto)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    if ($id_curso) {
        $filtro_curso = " and tbl_lms_acciones_pendientes.id_curso='$id_curso' ";
    }
    $sql = "
    SELECT
    tbl_lms_acciones_pendientes.*,(
    SELECT
    comentario
    FROM
    tbl_objeto_comentarios
    WHERE
    tbl_objeto_comentarios.rut_lider = tbl_lms_acciones_pendientes.rut_colaborador
    AND tbl_objeto_comentarios.rut = tbl_lms_acciones_pendientes.rut_jefe
    AND tbl_objeto_comentarios.id_objeto = tbl_lms_acciones_pendientes.id_objeto
    LIMIT 1
    )AS ultimo_comentarios_jefe,
    (
    SELECT
    fecha
    FROM
    tbl_objeto_comentarios
    WHERE
    tbl_objeto_comentarios.rut_lider = tbl_lms_acciones_pendientes.rut_colaborador
    AND tbl_objeto_comentarios.rut = tbl_lms_acciones_pendientes.rut_jefe
    AND tbl_objeto_comentarios.id_objeto = tbl_lms_acciones_pendientes.id_objeto
    LIMIT 1
    )AS fecha_ultimo_comentarios_jefe,
    tbl_lms_curso.nombre AS nombre_curso,
    tbl_objeto.id_desafio,
    tbl_objeto.titulo AS nombre_objeto,
    tbl_lms_desafios.desafio AS nombre_desafio, tbl_lms_desafios_finalizados.fecha as fecha_validacion_desafio
    FROM
    tbl_lms_acciones_pendientes
    INNER JOIN tbl_lms_curso ON tbl_lms_curso.id = tbl_lms_acciones_pendientes.id_curso
    INNER JOIN tbl_objeto ON tbl_objeto.id = tbl_lms_acciones_pendientes.id_objeto
    INNER JOIN tbl_lms_desafios ON tbl_lms_desafios.id = tbl_objeto.id_desafio
    left join tbl_lms_desafios_finalizados
    on tbl_lms_desafios_finalizados.rut_colaborador=tbl_lms_acciones_pendientes.rut_colaborador and tbl_lms_desafios_finalizados.id_objeto=tbl_lms_acciones_pendientes.id_objeto and tbl_lms_desafios_finalizados.id_empresa=tbl_lms_acciones_pendientes.id_empresa
    WHERE
    tbl_lms_acciones_pendientes.rut_jefe= '$rut'
    AND tbl_lms_acciones_pendientes.id_empresa = '$id_empresa'
    AND tbl_lms_acciones_pendientes.estado = '1'
    and tbl_lms_desafios_finalizados.fecha is NULL
    $filtro_curso
    ";
    if ($rut_colaborador) {
        $filtro_rut_colaborador = " and  tbl_lms_acciones_pendientes.rut_colaborador = '$rut_colaborador'";
    }
    if ($id_objeto) {
        $filtro_id_objeto = " and  tbl_lms_acciones_pendientes.id_objeto = '$id_objeto'";
    }
    $sql = "SELECT
    tbl_lms_acciones_pendientes.*, tbl_lms_desafios_finalizados.fecha AS fecha_desafio_validado, tbl_objeto.id_desafio
    FROM
    tbl_lms_acciones_pendientes
    LEFT JOIN tbl_lms_desafios_finalizados ON tbl_lms_desafios_finalizados.rut_colaborador = tbl_lms_acciones_pendientes.rut_colaborador
    AND tbl_lms_acciones_pendientes.id_objeto = tbl_lms_desafios_finalizados.id_objeto

    inner join tbl_objeto on tbl_objeto.id=tbl_lms_acciones_pendientes.id_objeto

    WHERE
    tbl_lms_acciones_pendientes.rut_jefe = '$rut'
    AND tbl_lms_desafios_finalizados.fecha IS NULL
    AND tbl_lms_acciones_pendientes.id_empresa = '$id_empresa'
    $filtro_rut_colaborador
    $filtro_id_objeto


    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TraeDesafiosValidados($rut, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
    SELECT
    tbl_lms_desafios_finalizados.*, tbl_lms_curso.nombre as nombre_curso, tbl_lms_desafios.desafio as nombre_desafio
    FROM
    tbl_lms_desafios_finalizados

    inner join tbl_lms_curso
    on tbl_lms_curso.id=tbl_lms_desafios_finalizados.id_curso
    inner join tbl_objeto
    on tbl_objeto.id=tbl_lms_desafios_finalizados.id_objeto
    inner join tbl_lms_desafios
    on tbl_lms_desafios.id=tbl_objeto.id_desafio
    WHERE
    tbl_lms_desafios_finalizados.rut_colaborador = '$rut'
    AND tbl_lms_desafios_finalizados.id_empresa = '$id_empresa'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ObtenerAccionesPendientesPorColaboradorYEmpresa($rut, $id_empresa, $id_curso)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    if ($id_curso) {
        $filtro_curso = " and tbl_lms_acciones_pendientes.id_curso='$id_curso' ";
    }
    $sql = "
    SELECT
    tbl_lms_acciones_pendientes.*,(
    SELECT
    comentario
    FROM
    tbl_objeto_comentarios
    WHERE
    tbl_objeto_comentarios.rut_lider = tbl_lms_acciones_pendientes.rut_colaborador
    AND tbl_objeto_comentarios.rut = tbl_lms_acciones_pendientes.rut_jefe
    AND tbl_objeto_comentarios.id_objeto = tbl_lms_acciones_pendientes.id_objeto
    LIMIT 1
    )AS ultimo_comentarios_jefe,
    (
    SELECT
    fecha
    FROM
    tbl_objeto_comentarios
    WHERE
    tbl_objeto_comentarios.rut_lider = tbl_lms_acciones_pendientes.rut_colaborador
    AND tbl_objeto_comentarios.rut = tbl_lms_acciones_pendientes.rut_jefe
    AND tbl_objeto_comentarios.id_objeto = tbl_lms_acciones_pendientes.id_objeto
    LIMIT 1
    )AS fecha_ultimo_comentarios_jefe,
    tbl_lms_curso.nombre AS nombre_curso,
    tbl_objeto.id_desafio,
    tbl_objeto.titulo AS nombre_objeto,
    tbl_lms_desafios.desafio AS nombre_desafio, tbl_lms_desafios_finalizados.fecha as fecha_validacion_desafio
    FROM
    tbl_lms_acciones_pendientes
    INNER JOIN tbl_lms_curso ON tbl_lms_curso.id = tbl_lms_acciones_pendientes.id_curso
    INNER JOIN tbl_objeto ON tbl_objeto.id = tbl_lms_acciones_pendientes.id_objeto
    INNER JOIN tbl_lms_desafios ON tbl_lms_desafios.id = tbl_objeto.id_desafio
    left join tbl_lms_desafios_finalizados
    on tbl_lms_desafios_finalizados.rut_colaborador=tbl_lms_acciones_pendientes.rut_colaborador and tbl_lms_desafios_finalizados.id_objeto=tbl_lms_acciones_pendientes.id_objeto and tbl_lms_desafios_finalizados.id_empresa=tbl_lms_acciones_pendientes.id_empresa
    WHERE
    tbl_lms_acciones_pendientes.rut_colaborador = '$rut'
    AND tbl_lms_acciones_pendientes.id_empresa = '$id_empresa'
    AND tbl_lms_acciones_pendientes.estado = '1'
    and tbl_lms_desafios_finalizados.fecha is NULL
    $filtro_curso
    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function EstaFinalizadoDesafio($rut, $id_objeto, $id_curso, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
    select * from  tbl_lms_desafios_finalizados

    where
    rut_colaborador='$rut' and
    id_objeto='$id_objeto' and
    id_curso='$id_curso' and
    id_empresa='$id_empresa'
    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function InsertaDesafiofinalizadoPorAgente($rut, $id_objeto, $id_curso, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "INSERT INTO tbl_lms_desafios_finalizados(rut_colaborador, id_objeto, id_curso, id_empresa, fecha, hora) " . "VALUES ('$rut', '$id_objeto', '$id_curso', '$id_empresa', '" . date("Y-m-d") . "', '" . date("H:i:s") . "');";
    $database->setquery($sql);
    $database->query();
}
function ComentariosPorObjetoPorLider($id_objeto, $rut_lider)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
    select tbl_objeto_comentarios.*, tbl_usuario.nombre_completo as nombre_persona
    from tbl_objeto_comentarios
    inner join tbl_usuario
    on tbl_usuario.rut=tbl_objeto_comentarios.rut
    where
    id_objeto='$id_objeto' and tbl_objeto_comentarios.rut_lider='$rut_lider'
    order by tbl_objeto_comentarios.id desc
    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function DesafioPorCurso2($id_curso, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_objeto where id_curso='$id_curso' and id_empresa='$id_empresa' and id_desafio>0";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function Lms_Busca_Acciones_Pendientes_dataVistaAgente($rut, $rut_colaborador, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "SELECT
    h.*,
    (select nombre from tbl_lms_curso where id=h.id_curso and id_empresa=h.id_empresa) as nombre_curso,
    (select titulo from tbl_objeto where id=h.id_objeto and id_curso=h.id_curso) as nombre_objeto,
    (select descripcion from tbl_objeto where id=h.id_objeto and id_curso=h.id_curso) as descripcion_objeto

    FROM
    tbl_lms_acciones_pendientes h
    WHERE
    h.rut_jefe = '$rut'
    AND h.rut_colaborador = '$rut_colaborador'
    AND h.id_empresa = '$id_empresa'
    and h.estado='1'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TraeMensajesPorAgente($rut_agente, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
    SELECT
    tbl_mensajes_principal.*, base_creador.jefe,
    (select count(*) from tbl_mensajes_respuestas where tbl_mensajes_respuestas.id_mensaje=tbl_mensajes_principal.id and tipo_creador='2') as total_respuestas_agente
    FROM
    tbl_mensajes_principal

    inner join tbl_usuario as base_creador
    on base_creador.rut=tbl_mensajes_principal.rut_creador
    WHERE
    tbl_mensajes_principal.id_empresa = '$id_empresa'
    and base_creador.jefe='$rut_agente'

    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ListadoParticipantesDadoInscripcionEmpresaSinRelatorCheckin($id_inscripcion, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
    SELECT
    rel_lms_inscripcion_usuario_checkin.rut,
    tbl_inscripcion_curso.*,
    tbl_usuario.nombre_completo,
    tbl_usuario.cargo
    FROM
    tbl_inscripcion_curso
    INNER JOIN rel_lms_inscripcion_usuario_checkin ON tbl_inscripcion_curso.codigo_inscripcion = rel_lms_inscripcion_usuario_checkin.codigo_imparticion
    INNER JOIN tbl_usuario ON tbl_usuario.rut = rel_lms_inscripcion_usuario_checkin.rut
    WHERE
    tbl_inscripcion_curso.id_empresa = '$id_empresa'
    AND tbl_inscripcion_curso.codigo_inscripcion = '$id_inscripcion'
    AND rel_lms_inscripcion_usuario_checkin.relator <> '1'

    group by rel_lms_inscripcion_usuario_checkin.rut
    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ObtenerFocosPorRut($rut, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "SELECT
    rel_lms_malla_persona.*,rel_lms_malla_curso.id_curso, rel_lms_malla_curso.id_foco, tbl_lms_foco.descripcion as nombre_foco
    FROM
    rel_lms_malla_persona

    inner join rel_lms_malla_curso
    on rel_lms_malla_curso.id_malla=rel_lms_malla_persona.id_malla

    inner join tbl_lms_foco
    on tbl_lms_foco.codigo_foco=rel_lms_malla_curso.id_foco




    WHERE
    rel_lms_malla_persona.rut = '$rut'
    AND rel_lms_malla_persona.id_empresa = '$id_empresa'
    GROUP BY nombre_foco";
    $database->setquery($sql);
    $database->query();
    $datos = $database->listObjects();
    return $datos;
}
function ReparaInconsistenciasObjetoCursoMallaAvanceData($rut)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "Select h.* from tbl_objetos_finalizados h where   (h.id_curso='' OR  h.id_curso is null)  and rut='$rut'";

    //echo $sql;
    $database->setquery($sql);
    $database->query();
    $datos = $database->listObjects();
    return $datos;
}
function ReparaInconsistenciasObjetoCursoIncorrectoData($rut)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "Select h.*,
    (select id_curso from tbl_objeto where id=h.id_objeto) from tbl_objetos_finalizados h where
    rut='$rut' and (select id_curso from tbl_objeto where id=h.id_objeto)<>h.id_curso";
    $database->setquery($sql);
    $database->query();
    $datos = $database->listObjects();
    return $datos;
}
function ReparaInconsistenciasBuscaCursoDadoObjetos($id_objeto, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "Select id_curso from tbl_objeto where  id='$id_objeto' and id_empresa='$id_empresa'";
    $database->setquery($sql);
    $database->query();
    $datos = $database->listObjects();
    return $datos;
}
function ReparaInconsistenciasActualizaObjetoFinalizadoDadoObjetos($rut, $id_objeto, $id_curso, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
    update tbl_objetos_finalizados set id_curso='$id_curso'

    where rut='$rut' and
    id_objeto='$id_objeto'

    ";
    $database->setquery($sql);
    $database->query();
    $datosInscripcionCierre = $database->listObjects();
}
function InsertaObjetoFinalizadoCierreTBL($rut, $id_objeto, $id_curso, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select id from tbl_inscripcion_cierre where rut='$rut' and id_curso='$id_curso' and id_empresa='$id_empresa'";
    $database->setquery($sql);
    $database->query();
    $datos_inscripcincierre = $database->listObjects();
    $sql                    = "select id from tbl_objetos_finalizados where rut='$rut' and id_objeto='$id_objeto' and id_curso='$id_curso'";
    $database->setquery($sql);
    $database->query();
    $datosobjetofinalizado = $database->listObjects();
    if (count($datosobjetofinalizado) == 0) {
        $fecha = date("Y-m-d");
        $hora  = date("H:i:s");
        $sql   = "INSERT INTO tbl_objetos_finalizados
    (rut, id_objeto, fecha, hora, id_curso)
    VALUES ('$rut', '$id_objeto', '$fecha', '$hora', '$id_curso');";
        $database->setquery($sql);
        $database->query();
    }
    if (count($datos_inscripcincierre) == 0) {
        $fecha              = date("Y-m-d");
        $hora               = date("H:i:s");
        $avance             = "100";
        $estado_descripcion = "APROBADO";
        $sql                = "INSERT INTO tbl_inscripcion_cierre
    (rut, estado, id_curso, id_empresa, avance, estado_descripcion)
    VALUES ('$rut', '1', '$id_curso', '$id_empresa', '$avance', '$estado_descripcion');";
        $database->setquery($sql);
        $database->query();
    }
}
function InsertaObjetoFinalizadoFull($rut, $id_objeto, $id_curso, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select id from tbl_inscripcion_cierre where rut='$rut' and id_curso='$id_curso' and id_empresa='$id_empresa'";
    $database->setquery($sql);
    $database->query();
    $datos_inscripcincierre = $database->listObjects();
    $sql                    = "select id from tbl_objetos_finalizados where rut='$rut' and id_objeto='$id_objeto' and id_curso='$id_curso'";
    $database->setquery($sql);
    $database->query();
    $datosobjetofinalizado = $database->listObjects();
    if (count($datosobjetofinalizado) == 0) {
        $fecha = date("Y-m-d");
        $hora  = date("H:i:s");
        $sql   = "INSERT INTO tbl_objetos_finalizados
    (rut, id_objeto, fecha, hora, id_curso)
    VALUES ('$rut', '$id_objeto', '$fecha', '$hora', '$id_curso');";
        $database->setquery($sql);
        $database->query();
    }

}
function ReparaInconsistenciasBuscaObjetoFinalizadosCurso($id_curso, $id_empresa, $rut)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
    select count(id) as ObjetosCurso,
    (select count(id) from tbl_objetos_finalizados where id_curso='$id_curso' and rut='$rut'  and (select opcional from tbl_objeto where id=id_objeto)<>'1') as ObjetosFinalizados,
    round(100*(select count(id) from tbl_objetos_finalizados where id_curso='$id_curso' and rut='$rut'  and (select opcional from tbl_objeto where id=id_objeto)<>'1')/count(id)) as AvancePropuesto,
    (Select avance from tbl_inscripcion_cierre where rut='$rut' and id_curso='$id_curso'  order by avance DESC limit 1) as AvanceEscrito

    from tbl_objeto h

    where h.id_curso='$id_curso' and h.id_empresa='$id_empresa'  and h.opcional<>1";
    $database->setquery($sql);
    $database->query();
    $datos = $database->listObjects();
    return $datos;
}
function ReparaInconsistenciasActualizaIncripcionCierre($avance, $estado, $rut, $id_curso, $id_empresa, $nota, $estado_descripcion)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);

     $sql = "select count(id) as cuenta_mod4 from tbl_inscripcion_curso where id_curso='$id_curso' and id_empresa='$id_empresa' and id_curso=codigo_inscripcion;";




    //exit();
    $database->setquery($sql);
    $database->query();
    $cod2 = $database->listObjects();

    //print_r($cod2);

    if($cod2[0]->cuenta_mod4>0){

            if ($avance == '100') {
                $estado = 1;
            }
            $sql = "
            update tbl_inscripcion_cierre set avance='$avance', estado='$estado', estado_descripcion='$estado_descripcion'

            where rut='$rut' and     id_curso='$id_curso'     and         id_empresa='$id_empresa'
            ";
            $database->setquery($sql);
            $database->query();

    }

}
function ComentariosPorObjetoPaginado($id_objeto, $pagina, $cantidad_pagina)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    if ($pagina == "no" or $pagina == "") {
        $limit = " limit 0, 20";
    } else if (!$pagina) {
        $pagina = 1;
        $limit  = " limit 0, $cantidad_pagina";
    } else {
        $pagina = $pagina;
        $inicio = ($pagina - 1) * $cantidad_pagina;
        $limit  = " limit $inicio, $cantidad_pagina";
    }
    $sql = "
    select tbl_objeto_comentarios.*, tbl_usuario.nombre_completo as nombre_persona
    from tbl_objeto_comentarios
    inner join tbl_usuario
    on tbl_usuario.rut=tbl_objeto_comentarios.rut
    where
    id_objeto='$id_objeto'
    order by tbl_objeto_comentarios.id desc
    $limit
    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TwwetsPorUsuario($rut)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_mp_tweet where rut='$rut'
    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function InsertoTweetIVPH($rut, $texto)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $fecha = date("Y-m-d");
    $hora  = date("H:i:s");
    $sql   = "INSERT INTO tbl_mp_tweet(tweet, rut,  fecha, hora) " . "VALUES ('$texto', '$rut', '$fecha', '$hora');";
    $database->setquery($sql);
    $database->query();
}
function ListadoPlanesPorCoachAbiertos($rut, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "SELECT
    tbl_usuario.nombre_completo as nombre_autor,

    tbl_mp.*,
    (select avg(seguimiento_grado_cumplimiento) from tbl_planes_ingresados where id_mp=tbl_mp.id_mp)as promedio_avances_plan,
    (select count(*) from tbl_mp_equipo where tbl_mp.id_mp=tbl_mp_equipo.id_mp) as total_equipo,
    (select count(*) from tbl_planes_ingresados where tbl_planes_ingresados.id_mp=tbl_mp.id_mp) as total_planes,
    basecoach.nombre_completo as nombre_coach
    FROM
    tbl_mp
    INNER JOIN tbl_mp_categorias on tbl_mp_categorias.id_categoria = tbl_mp.id_categoria

    inner join tbl_usuario
    on tbl_usuario.rut=tbl_mp.rut

    inner join tbl_usuario as basecoach
    on basecoach.rut=tbl_mp.coach


    WHERE
    tbl_mp.coach= '$rut'
    AND tbl_mp.id_empresa = '$id_empresa'
    and tbl_mp.id_estado = '2'




    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ListadoIvphPorRutEmpresaInteraccionesAbiertos($rut, $id_empresa, $id_mp)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    if ($id_mp) {
        $sql_filtro = " and tbl_mp.id='$id_mp'";
    }
    $sql = "SELECT
    tbl_mp.*,
    tbl_usuario.nombre_completo as nombre_autor,
    basecoach.nombre_completo as nombre_coach

    FROM
    tbl_mp
    inner join tbl_mp_equipo
    on tbl_mp_equipo.id_mp=tbl_mp.id_mp
    and tbl_mp_equipo.rut='$rut'

    inner join tbl_usuario
    on tbl_usuario.rut=tbl_mp.rut

    inner join tbl_usuario as basecoach
    on basecoach.rut=tbl_mp.coach
    WHERE
    tbl_mp.id_empresa = '$id_empresa'

    and tbl_mp.id_estado='1'

    and tbl_mp.nombre<>''
    $sql_filtro

    order by tbl_mp.id desc

    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TotalPlanesAbiertos($rut, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_planes_ingresados where responsable='$rut' and (seguimiento_grado_cumplimiento='' or seguimiento_grado_cumplimiento='Abierto')
    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ListadoIvphPorRutEmpresaAbiertos($rut, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "SELECT
    tbl_usuario.nombre_completo as nombre_autor,
    tbl_mp.*,
    (select avg(seguimiento_grado_cumplimiento) from tbl_planes_ingresados where id_mp=tbl_mp.id_mp)as promedio_avances_plan,
    (select count(*) from tbl_mp_equipo where tbl_mp.id_mp=tbl_mp_equipo.id_mp) as total_equipo,
    (select count(*) from tbl_planes_ingresados where tbl_planes_ingresados.id_mp=tbl_mp.id_mp) as total_planes,
    basecoach.nombre_completo as nombre_coach
    FROM
    tbl_mp
    INNER JOIN tbl_mp_categorias on tbl_mp_categorias.id_categoria = tbl_mp.id_categoria
    inner join tbl_usuario
    on tbl_usuario.rut=tbl_mp.rut
    inner join tbl_usuario as basecoach
    on basecoach.rut=tbl_mp.coach
    WHERE
    tbl_mp.rut = '$rut'
    AND tbl_mp.id_empresa = '$id_empresa' and
    tbl_mp.id_estado='1'
    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ComentariosCoahPorIVPH($id_mp)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
    select tbl_mp_comentarios_coach.*, tbl_mp.rut as rut_autor
    from tbl_mp_comentarios_coach
    inner join tbl_mp
    on tbl_mp.id_mp=tbl_mp_comentarios_coach.id_ivph
    where tbl_mp_comentarios_coach.id_ivph='$id_mp'
    '
    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function InsertoComentarioCOACH($id_mp, $comentario, $tipo, $rut_coach)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $fecha = date("Y-m-d");
    $hora  = date("H:i:s");
    $sql   = "INSERT INTO tbl_mp_comentarios_coach(comentario, tipo, rut_coach, id_ivph, fecha, hora) " . "VALUES ('$comentario', '$tipo', '$rut_coach', '$id_mp',  '$fecha', '$hora');";
    $database->setquery($sql);
    $database->query();
}
function ActualizaPlanesDeIVPH($id_mp)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "update tbl_planes_ingresados set seguimiento_grado_cumplimiento='' where id_mp='$id_mp'";
    $database->setquery($sql);
    $database->query();
}
function TotalPlanesPorMpSinEstadosCancelados($id_mp, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select
    tbl_planes_ingresados.*,
    tbl_usuario.nombre_completo
    from tbl_planes_ingresados
    inner join tbl_usuario
    on tbl_usuario.rut=tbl_planes_ingresados.responsable
    where tbl_planes_ingresados.id_mp='$id_mp'
    and tbl_planes_ingresados.id_empresa='$id_empresa'
    and tbl_planes_ingresados.seguimiento_grado_cumplimiento<>'Cancelado'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TraeDatosMP2($id_mp, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_mp where id_mp='$id_mp' and id_empresa='$id_empresa'    ";
    //echo $sql;
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function EliminaPlanIVPH($id)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = sprintf("DELETE from tbl_planes_ingresados WHERE id = '$id'");
    $database->setquery($sql);
    $database->query();
}
function EliminoEquipoColaboradorIVPH($id)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = sprintf("DELETE from tbl_mp_equipo WHERE id = '$id'");
    $database->setquery($sql);
    $database->query();
}
function ListadoIvphPorID($id, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "SELECT
    tbl_usuario.nombre_completo as nombre_autor,

    tbl_mp.*,
    (select avg(seguimiento_grado_cumplimiento) from tbl_planes_ingresados where id_mp=tbl_mp.id_mp)as promedio_avances_plan,
    (select count(*) from tbl_mp_equipo where tbl_mp.id_mp=tbl_mp_equipo.id_mp) as total_equipo,
    (select count(*) from tbl_planes_ingresados where tbl_planes_ingresados.id_mp=tbl_mp.id_mp) as total_planes,
    basecoach.nombre_completo as nombre_coach
    FROM
    tbl_mp
    INNER JOIN tbl_mp_categorias on tbl_mp_categorias.id_categoria = tbl_mp.id_categoria

    inner join tbl_usuario
    on tbl_usuario.rut=tbl_mp.rut

    inner join tbl_usuario as basecoach
    on basecoach.rut=tbl_mp.coach


    WHERE
    tbl_mp.id_mp= '$id'
    AND tbl_mp.id_empresa = '$id_empresa'




    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TotalPlanesPorMpCerrados($id_mp, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select
    tbl_planes_ingresados.*,
    tbl_usuario.nombre_completo
    from tbl_planes_ingresados
    inner join tbl_usuario
    on tbl_usuario.rut=tbl_planes_ingresados.responsable
    where tbl_planes_ingresados.id_mp='$id_mp'
    and tbl_planes_ingresados.id_empresa='$id_empresa'
    and tbl_planes_ingresados.seguimiento_grado_cumplimiento='Cerrado'

    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ListadoPlanesPorCoach($rut, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "SELECT
    tbl_usuario.nombre_completo as nombre_autor,

    tbl_mp.*,
    (select avg(seguimiento_grado_cumplimiento) from tbl_planes_ingresados where id_mp=tbl_mp.id_mp)as promedio_avances_plan,
    (select count(*) from tbl_mp_equipo where tbl_mp.id_mp=tbl_mp_equipo.id_mp) as total_equipo,
    (select count(*) from tbl_planes_ingresados where tbl_planes_ingresados.id_mp=tbl_mp.id_mp) as total_planes,
    basecoach.nombre_completo as nombre_coach
    FROM
    tbl_mp
    INNER JOIN tbl_mp_categorias on tbl_mp_categorias.id_categoria = tbl_mp.id_categoria

    inner join tbl_usuario
    on tbl_usuario.rut=tbl_mp.rut

    inner join tbl_usuario as basecoach
    on basecoach.rut=tbl_mp.coach


    WHERE
    tbl_mp.coach= '$rut'
    AND tbl_mp.id_empresa = '$id_empresa'




    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ActualizaValidaPlanJefeIVPH($id_plan)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "update tbl_planes_ingresados set validado='1' where id='$id_plan'";
    $database->setquery($sql);
    $database->query();
}
function TraeRelacionesSinAeTODOS($evaluador, $id_proceso)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
    select tbl_sgd_relaciones.*
    from tbl_sgd_relaciones
    inner join tbl_usuario
    on tbl_sgd_relaciones.evaluado=tbl_usuario.rut
    where tbl_sgd_relaciones.id_proceso='$id_proceso'
    and tbl_sgd_relaciones.evaluador='$evaluador'
    and tbl_sgd_relaciones.evaluado<>tbl_sgd_relaciones.evaluador


    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TotalMensajesPorRutEmpresaAgenteFiltroAgente($rut, $id_empresa, $rut_agente)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "

    select tbl_mensajes_principal.*,
    tbl_usuario.nombre as nombre_creador, tbl_usuario.apaterno, tbl_usuario.amaterno,
    tbl_mensaje_tipo.nombre as nombre_titulo,
    (select count(*) as total_respuestas from tbl_mensajes_respuestas where id_mensaje=tbl_mensajes_principal.id) as total_comen
    from tbl_mensajes_principal

    inner join tbl_usuario
    on tbl_usuario.rut=tbl_mensajes_principal.rut_creador


    inner join tbl_mensaje_tipo
    on tbl_mensaje_tipo.id=tbl_mensajes_principal.tipo_mensaje

    where

    tbl_mensajes_principal.id_empresa='$id_empresa' and
    tbl_usuario.jefe='$rut_agente'


    order by id desc";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function DatosMiAgente($rut, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "SELECT
    tbl_usuario.jefe,
    datos_agente.nombre_completo,
    datos_agente.telefono,
    datos_agente.cargo,
    datos_agente.email
    FROM
    tbl_usuario
    INNER JOIN tbl_usuario AS datos_agente ON datos_agente.rut = tbl_usuario.jefe
    WHERE
    tbl_usuario.rut = '$rut' and tbl_usuario.id_empresa='$id_empresa'
    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TagsPorMPEmpresa($id_mp, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_mp_tag where id_mp='$id_mp' and id_empresa='$id_empresa'    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function com_mp_save_groupseguido($rut, $id_empresa, $tipo, $idcat)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "SELECT count(id) as cuenta FROM tbl_mp_interacciones WHERE tipo = '$tipo'
    AND rut = '$rut' AND id_empresa = '$id_empresa' AND contenido = '$idcat'    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    if ($cod[0]->cuenta == 0) {
        $hoy = date("Y-m-d");
        $sql = "INSERT INTO tbl_mp_interacciones (rut, fecha, id_empresa, contenido, tipo) values
    ('$rut','$hoy','$id_empresa','$idcat', '$tipo') ";
        $database->setquery($sql);
        $database->query();
    }
    return $cod;
}
function com_mp_del_groupseguido($rut, $id_empresa, $tipo, $idcat)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "delete FROM tbl_mp_interacciones WHERE tipo = '$tipo'
    AND rut = '$rut' AND id_empresa = '$id_empresa' AND contenido = '$idcat'    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function com_mp_revisa_grupo_seguido($id_categoria, $tipo, $id_empresa, $rut)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "SELECT count(id) as cuenta FROM tbl_mp_interacciones WHERE tipo = '$tipo'
    AND rut = '$rut' AND id_empresa = '$id_empresa' AND contenido = '$id_categoria'    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function MPO_Compestadistica($id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "

    select h.id_empresa,
    (select count(id) from tbl_mp where id_empresa='$id_empresa' and id_estado>=5) as CuentaPublicaciones,
    (select count(id) from tbl_mp_interacciones where id_empresa='$id_empresa' and tipo='VISITA' group by tipo) as CuentaVisitas,
    (select count(id) from tbl_mp_interacciones where id_empresa='$id_empresa' and tipo='MEGUSTA' group by tipo) as CuentaMeGusta,
    (select count(id) from tbl_mp_interacciones where id_empresa='$id_empresa' and tipo='COMENTARIO' group by tipo) as CuentaComentarios

    from tbl_mp_interacciones h where h.id_empresa='$id_empresa' group by h.id_empresa


    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function InsertaTagsIVPH($tag, $id_empresa, $id_mp)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $ultimo_id = ObtengoUltimoRegistroMP($id_empresa);
    $nuevo_id  = $ultimo_id[0]->id;
    $nuevo_id  = $nuevo_id + 1;
    $sql       = "INSERT INTO tbl_mp_tag(id_mp, tag, id_empresa) " . "VALUES ('$id_mp', '$tag', '$id_empresa');";
    $database->setquery($sql);
    $database->query();
}
function ListadoIvphPorRutEmpresaPlanes($rut, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "SELECT
    tbl_mp.*,
    tbl_usuario.nombre_completo as nombre_autor,
    basecoach.nombre_completo as nombre_coach

    FROM
    tbl_mp
    inner join tbl_planes_ingresados
    on tbl_planes_ingresados.id_mp=tbl_mp.id_mp
    and tbl_planes_ingresados.responsable='$rut'

    inner join tbl_usuario
    on tbl_usuario.rut=tbl_mp.rut


    inner join tbl_usuario as basecoach
    on basecoach.rut=tbl_mp.coach
    WHERE
    tbl_mp.id_empresa = '$id_empresa'
    and tbl_mp.nombre<>''
    GROUP BY tbl_mp.id
    order by tbl_mp.id desc

    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ListadoIvphPorRutEmpresaInteracciones($rut, $id_empresa, $id_mp)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    if ($id_mp) {
        $sql_filtro = " and tbl_mp.id='$id_mp'";
    }
    $sql = "SELECT
    tbl_mp.*,
    tbl_usuario.nombre_completo as nombre_autor,
    basecoach.nombre_completo as nombre_coach

    FROM
    tbl_mp
    inner join tbl_mp_equipo
    on tbl_mp_equipo.id_mp=tbl_mp.id_mp
    and tbl_mp_equipo.rut='$rut'

    inner join tbl_usuario
    on tbl_usuario.rut=tbl_mp.rut

    inner join tbl_usuario as basecoach
    on basecoach.rut=tbl_mp.coach
    WHERE
    tbl_mp.id_empresa = '$id_empresa'
    and tbl_mp.nombre<>''
    $sql_filtro

    order by tbl_mp.id desc

    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function SGD_ExisteAe($evaluado, $id_proceso, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "

    select * from tbl_sgd_relaciones where evaluado='$evaluado' and evaluador='$evaluado' and id_proceso='$id_proceso' and id_empresa='$id_empresa'
    ";
    $database->setquery($sql);
    $database->query();
    $datos = $database->listObjects();
    return $datos;
}
function COMPASS_VerificoParaInformeFinal($evaluado, $id_proceso, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
    SELECT
    tbl_sgd_relaciones.evaluado,
    tbl_sgd_relaciones.evaluador,
    tbl_sgd_finalizados_evaluado_evaluador.fecha,
    (
    SELECT
    count(DISTINCT(objetivo))
    FROM
    tbl_sgd_fijacion
    WHERE
    tbl_sgd_fijacion.evaluado = tbl_sgd_relaciones.evaluado
    AND tbl_sgd_fijacion.evaluador = tbl_sgd_relaciones.evaluador
    AND tbl_sgd_fijacion.id_proceso = tbl_sgd_relaciones.id_proceso
    AND tbl_sgd_fijacion.tipo = 'objetivo'

    )AS total_fijacion_objetivos,

    (
    SELECT
    count(DISTINCT(areas_desarrollo))
    FROM
    tbl_sgd_fijacion
    WHERE
    tbl_sgd_fijacion.evaluado = tbl_sgd_relaciones.evaluado
    AND tbl_sgd_fijacion.evaluador = tbl_sgd_relaciones.evaluador
    AND tbl_sgd_fijacion.id_proceso = tbl_sgd_relaciones.id_proceso
    AND tbl_sgd_fijacion.tipo = 'plan'

    )AS total_fijacion_planes


    FROM
    tbl_sgd_relaciones
    LEFT JOIN tbl_sgd_finalizados_evaluado_evaluador ON tbl_sgd_finalizados_evaluado_evaluador.evaluado = tbl_sgd_relaciones.evaluado
    AND tbl_sgd_finalizados_evaluado_evaluador.evaluador = tbl_sgd_relaciones.evaluador
    WHERE
    tbl_sgd_relaciones.evaluado = '$evaluado'
    and tbl_sgd_relaciones.id_proceso = '$id_proceso'
    AND tbl_sgd_relaciones.evaluado <> tbl_sgd_relaciones.evaluador

    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function InteresesDesarrolloEvaluadoEvaluador($evaluado, $evaluador, $id_proceso, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "

    SELECT
    tbl_sgd_respuestas_desarrollo_carrera.*,tbl_sgd_desarrollo_carrera.interes as nombre_interes
    FROM
    tbl_sgd_respuestas_desarrollo_carrera
    inner join tbl_sgd_desarrollo_carrera
    on tbl_sgd_desarrollo_carrera.id=tbl_sgd_respuestas_desarrollo_carrera.id_desarrollo_carrera
    WHERE
    tbl_sgd_respuestas_desarrollo_carrera.evaluado= '$evaluado'
    and tbl_sgd_respuestas_desarrollo_carrera.evaluador= '$evaluador'
    and tbl_sgd_respuestas_desarrollo_carrera.id_proceso= '$id_proceso'
    and tbl_sgd_respuestas_desarrollo_carrera.id_empresa= '$id_empresa'

    group by tbl_sgd_respuestas_desarrollo_carrera.id_desarrollo_carrera


    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function UltimoMensajeMensajeria($rut, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "

    SELECT
    tbl_mensajes_principal.*
    FROM
    tbl_mensajes_principal
    WHERE
    tbl_mensajes_principal.rut_creador = '$rut'
    AND tbl_mensajes_principal.id_empresa = '$id_empresa'
    ORDER BY
    tbl_mensajes_principal.id DESC
    LIMIT 1
    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function DatosAvanceEvaluadoEvaluador($evaluado, $evaluador, $id_proceso, $perfil)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
    SELECT
    (
    SELECT
    count(*)
    FROM
    tbl_objetivos_individuales
    WHERE
    tbl_objetivos_individuales.rut = '$evaluado'
    AND tbl_objetivos_individuales.id_proceso = '$id_proceso'
    )AS total_objetivos,
    (
    SELECT
    count(*)
    FROM
    tbl_sgd_respuestas
    WHERE
    tbl_sgd_respuestas.evaluado = '$evaluado'
    AND tbl_sgd_respuestas.evaluador = '$evaluador'
    AND tbl_sgd_respuestas.id_proceso = '$id_proceso'
    AND id_objetivo IS NOT NULL
    )AS total_respuestas_objetivos,
    (
    SELECT
    count(*)
    FROM
    tbl_sgd_respuestas
    WHERE
    tbl_sgd_respuestas.evaluado = '$evaluado'
    AND tbl_sgd_respuestas.evaluador = '$evaluador'
    AND tbl_sgd_respuestas.id_proceso = '$id_proceso'
    AND id_objetivo IS NULL
    )AS total_respuestas_competencias,
    (
    SELECT
    count(*)
    FROM
    tbl_sgd_preguntas
    INNER JOIN tbl_sgd_componente ON tbl_sgd_componente.id = tbl_sgd_preguntas.id_competencia
    INNER JOIN rel_sgd_perfil_competencias ON rel_sgd_perfil_competencias.id_componente = tbl_sgd_componente.id
    AND rel_sgd_perfil_competencias.perfil_evaluacion = '$perfil'
    )AS total_preguntas
    FROM
    tbl_sgd_relaciones
    WHERE
    tbl_sgd_relaciones.evaluado = '$evaluado'
    AND tbl_sgd_relaciones.evaluador = '$evaluador'
    AND tbl_sgd_relaciones.id_proceso = '$id_proceso'


    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function EliminaDesarrolloDeCarrera($evaluado, $evaluador, $id_proceso, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = sprintf("DELETE from tbl_sgd_respuestas_desarrollo_carrera
    WHERE evaluado= '$evaluado' and
    evaluador='$evaluador' and
    id_proceso='$id_proceso' and
    id_empresa='$id_empresa' ");
    $database->setquery($sql);
    $database->query();
}
function TienedesarrolloCarrera($evaluado, $evaluador, $id_proceso, $id_empresa, $id_desarrollo)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
    select * from tbl_sgd_respuestas_desarrollo_carrera
    where evaluado='$evaluado' and
    evaluador='$evaluador' and
    id_empresa='$id_empresa' and
    id_proceso='$id_proceso'
    and id_desarrollo_carrera='$id_desarrollo'


    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function EliminaFijacionPlanasasasas($evaluado, $evaluador, $id_proceso, $id_empresa, $numero, $tipo)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = sprintf("DELETE from tbl_sgd_fijacion
    WHERE evaluado= '$evaluado' and
    evaluador='$evaluador' and
    id_proceso='$id_proceso' and
    id_empresa='$id_empresa' and
    numero='$numero' and
    tipo='$tipo'");
    $database->setquery($sql);
    $database->query();
}
function VerificoFijacionObjetivosPlanes($evaluado, $evaluador, $id_proceso, $id_empresa, $tipo, $numero)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
    select * from tbl_sgd_fijacion
    where evaluado='$evaluado' and
    evaluador='$evaluador' and
    id_empresa='$id_empresa' and
    id_proceso='$id_proceso'
    and numero='$numero' and
    tipo='$tipo'

    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ActualizaPlanFijacion($evaluado, $evaluador, $id_proceso, $id_empresa, $area_desarrollo, $acciones_requeridas, $numero)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "update tbl_sgd_fijacion
    set
    areas_desarrollo='$area_desarrollo',
    acciones_requeridas='$acciones_requeridas'
    where evaluado='$evaluado'
    and evaluador='$evaluador'
    and id_empresa='$id_empresa'
    and id_proceso='$id_proceso'
    and tipo='plan'
    and numero='$numero'    ";
    $database->setquery($sql);
    $database->query();
}
function ActualizaFijacion($evaluado, $evaluador, $id_proceso, $id_empresa, $objetivo, $medicion, $numero)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "update tbl_sgd_fijacion
    set
    objetivo='$objetivo',
    medicion_cumplimiento='$medicion'
    where evaluado='$evaluado'
    and evaluador='$evaluador'
    and id_empresa='$id_empresa'
    and id_proceso='$id_proceso'
    and tipo='objetivo'
    and numero='$numero'    ";
    $database->setquery($sql);
    $database->query();
}
function TraeRelacionesSinAeDO($evaluador, $id_proceso)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
    select tbl_sgd_relaciones.*
    from tbl_sgd_relaciones
    inner join tbl_usuario
    on tbl_sgd_relaciones.evaluado=tbl_usuario.rut
    where tbl_sgd_relaciones.id_proceso='$id_proceso'
    and tbl_sgd_relaciones.evaluador='$evaluador'
    and tbl_sgd_relaciones.evaluado<>tbl_sgd_relaciones.evaluador
    and (tbl_usuario.perfil_evaluacion='DO')

    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function AbreEvaluacionSGD($evaluado, $evaluador, $id_proceso)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = sprintf("DELETE from tbl_sgd_sesion_evaluacion WHERE evaluado= '$evaluado' and evaluador='$evaluador' and id_proceso='$id_proceso'");
    $database->setquery($sql);
    $database->query();
}
function BorroSesionEvaluacion2($evaluador, $id_proceso)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "DELETE FROM tbl_sgd_sesion_evaluacion WHERE evaluador='" . $evaluador . "'  and id_proceso='$id_proceso'";
    $database->setquery($sql);
    $database->query();
}
function ListadoIvphPorRutEmpresa($rut, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "SELECT
    tbl_usuario.nombre_completo as nombre_autor,

    tbl_mp.*,
    (select avg(seguimiento_grado_cumplimiento) from tbl_planes_ingresados where id_mp=tbl_mp.id_mp)as promedio_avances_plan,
    (select count(*) from tbl_mp_equipo where tbl_mp.id_mp=tbl_mp_equipo.id_mp) as total_equipo,
    (select count(*) from tbl_planes_ingresados where tbl_planes_ingresados.id_mp=tbl_mp.id_mp) as total_planes,
    basecoach.nombre_completo as nombre_coach
    FROM
    tbl_mp
    INNER JOIN tbl_mp_categorias on tbl_mp_categorias.id_categoria = tbl_mp.id_categoria

    inner join tbl_usuario
    on tbl_usuario.rut=tbl_mp.rut

    inner join tbl_usuario as basecoach
    on basecoach.rut=tbl_mp.coach


    WHERE
    tbl_mp.rut = '$rut'
    AND tbl_mp.id_empresa = '$id_empresa'




    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ComentariosFinalesEncSatis($id_objeto, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_enc_satis_comentarios_finales where id_objeto='$id_objeto' and id_empresa='$id_empresa' ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function AlternativasDadoId2($id)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_evaluaciones_alternativas

    where id='$id'";

    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TotalcursosPorUsuaroEmpresa($rut, $id_empresa, $id_malla)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "SELECT
    rel_lms_malla_persona.rut,
    rel_lms_malla_persona.id_malla,
    rel_lms_malla_curso.id_curso,
    tbl_lms_curso.nombre, tbl_inscripcion_cierre.estado
    FROM
    rel_lms_malla_persona
    INNER JOIN rel_lms_malla_curso ON rel_lms_malla_curso.id_malla = rel_lms_malla_persona.id_malla
    inner join tbl_lms_curso
    on tbl_lms_curso.id=rel_lms_malla_curso.id_curso
    left join tbl_inscripcion_cierre
    on tbl_inscripcion_cierre.rut=rel_lms_malla_persona.rut and tbl_inscripcion_cierre.id_curso=rel_lms_malla_curso.id_curso and tbl_inscripcion_cierre.id_empresa=rel_lms_malla_curso.id_empresa

    WHERE
    rel_lms_malla_persona.rut = '$rut'
    and rel_lms_malla_persona.id_empresa='$id_empresa'
    and rel_lms_malla_curso.id_malla='$id_malla'
    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function BuscaMallaapartirRutCursoObjeto($rut, $id_curso, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
    select h.*,
    (select id_malla from rel_lms_malla_persona where rut='$rut' and id_malla=h.id_malla)
    from rel_lms_malla_curso h where h.id_curso='$id_curso' and h.id_empresa='$id_empresa'
    and (select id_malla from rel_lms_malla_persona where rut='$rut' and id_malla=h.id_malla)=h.id_malla
    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function BuscaMallaapartirRutObjeto($rut, $id_objeto, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "    select h.*,
    (select id_malla from rel_lms_malla_persona where rut='$rut' and id_malla=h.id_malla)
    from rel_lms_malla_curso h where h.id_curso=(select id_curso from tbl_objeto where id='$id_objeto') and h.id_empresa='$id_empresa'
    and (select id_malla from rel_lms_malla_persona where rut='$rut' and id_malla=h.id_malla)=h.id_malla";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TotalNivelPorUsuaroEmpresa($rut, $id_empresa, $id_malla)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "SELECT    h.*,
    (select idorden from tbl_gamificado_nivel where idnivel=h.id_nivel) as idorden
    FROM
    tbl_nivel_finalizado h
    WHERE
    h.rut = '$rut'   and h.id_malla='$id_malla' order by id DESC limit 1";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function buscapuntosydesafiospormallarut($rut, $id_empresa, $id_malla)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select sum(h.puntos) as puntosganados FROM tbl_gamificado_puntos h where h.rut='$rut' and h.id_malla='$id_malla' and h.id_empresa='$id_empresa'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TotalNivelesMalla($id_empresa, $id_malla)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
    select count(id) as cuenta

    from tbl_gamificado_nivel

    where idmalla='$id_malla' and idempresa='$id_empresa'
    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function BuscaTotalOBjetosCursosIdMalla($id_empresa, $id_malla, $rut)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
    SELECT count(tbl_objeto.id) as cuentaobjetostotales,
    (select count(id) from tbl_objetos_finalizados where rut='$rut' and id_objeto=tbl_objeto.id) as cuentafinalizados
    FROM tbl_objeto
    INNER JOIN rel_lms_malla_curso ON tbl_objeto.id_curso = rel_lms_malla_curso.id_curso
    where rel_lms_malla_curso.id_malla = '$id_malla'
    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function buscaCursosFinalizados_Totales($rut, $id_empresa, $id_malla)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
    select h.*,
    (select estado from tbl_inscripcion_cierre where rut='$rut' and id_curso=h.id_curso) as estado

    from rel_lms_malla_curso h

    where h.id_malla='$id_malla' and h.opcional<>1
    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function NivelesFinalizadosSinMalla($rut, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
    select h.*, count(id) as cuenta

    from tbl_nivel_finalizado h

    where h.rut='$rut'

    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function NivelesFinalizados($rut, $id_empresa, $id_malla)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
    select h.*, count(id) as cuenta

    from tbl_nivel_finalizado h

    where h.rut='$rut' and h.id_malla='$id_malla'

    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function BuscoMallaDadoProgramaRut($rut, $id_empresa, $id_programa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "


    select h.*,
    (select id_programa from rel_lms_malla_curso where id_malla=h.id_malla limit 1)
    from rel_lms_malla_persona h
    where h.rut='$rut' and h.id_empresa='$id_empresa'
    AND (select id_programa from rel_lms_malla_curso where id_malla=h.id_malla limit 1)='$id_programa'

    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}

function BuscaAvanceMallaPrograma($rut, $id_empresa, $id_malla){

    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "

   select avg(h.avance) as avance from tbl_lms_reportes h where rut='$rut' and id_malla='$id_malla' and id_empresa='$id_empresa'

    ";

    //echo "<br><br>$sql";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod[0]->avance;


}


function BuscoMallaDadoClasProgramaRut($rut, $id_empresa, $id_programa, $id_clasificacion)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "

    select h.*,
    (select id_programa from rel_lms_malla_curso where id_malla=h.id_malla limit 1),
    (SELECT    id_clasificacion    FROM    rel_lms_malla_curso    WHERE    id_malla = h.id_malla    LIMIT 1    ) as id_clasificacion

    from rel_lms_malla_persona h

    where h.rut='$rut' and h.id_empresa='$id_empresa'
    and (SELECT    id_clasificacion    FROM    rel_lms_malla_curso    WHERE    id_malla = h.id_malla and id_clasificacion='$id_clasificacion'    limit 1)='$id_clasificacion'
    AND (select id_programa from rel_lms_malla_curso where id_malla=h.id_malla limit 1)='$id_programa'

    ";

    //echo "<br><br>$sql";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function BuscaNivelAccionBoton($id_empresa, $codigo, $tipo)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
    select * from tbl_gamificado_nivel_botones where id_empresa='$id_empresa' and tipo='$tipo' and codigo='$codigo'
    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function BuscaCursodesdeGamificadoNivel($id_malla, $id_empresa, $id_orden)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
    select * from tbl_gamificado_nivel where idempresa='$id_empresa' and idmalla='$id_malla' and idorden='$id_orden'
    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function buscaNivelRol($rut, $id_empresa, $id_malla, $nivel_actual)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "

    select h.id, h.descripcion,
    (select idnivel from tbl_gamificado_nivel where idmalla='$id_malla' and idorden='$nivel_actual') as idnivel,
    (select idcurso from tbl_gamificado_nivel where idmalla='$id_malla' and idorden='$nivel_actual') as idcurso_actual,
    (select textodescripcion from tbl_gamificado_nivel where idmalla='$id_malla' and idorden='$nivel_actual') as template_detalle_cursoCap,

    (select nombre from tbl_gamificado_niveles_descripcion where idnivel= (select idnivel from tbl_gamificado_nivel where idmalla='$id_malla' and idorden='$nivel_actual')) as nivelnombre,
    (select imagenbackhome from tbl_gamificado_niveles_descripcion where idnivel= (select idnivel from tbl_gamificado_nivel where idmalla='$id_malla' and idorden='$nivel_actual')) as imagenbackhome,
    (select imagenbackhometemplate from tbl_gamificado_niveles_descripcion where idnivel= (select idnivel from tbl_gamificado_nivel where idmalla='$id_malla' and idorden='$nivel_actual')) as imagenbackhometemplate,

    (select menuactivo from tbl_gamificado_niveles_descripcion where idnivel= (select idnivel from tbl_gamificado_nivel where idmalla='$id_malla' and idorden='$nivel_actual')) as menuactivo,
    (select nivelactivo from tbl_gamificado_niveles_descripcion where idnivel= (select idnivel from tbl_gamificado_nivel where idmalla='$id_malla' and idorden='$nivel_actual')) as nivelactivo,
    (select cursoactivo from tbl_gamificado_niveles_descripcion where idnivel= (select idnivel from tbl_gamificado_nivel where idmalla='$id_malla' and idorden='$nivel_actual')) as cursoactivo,

    (select descripcion from tbl_lms_malla where id='$id_malla') as descripcionRol

    from tbl_lms_malla h

    where h.id='$id_malla' and h.id_empresa='$id_empresa'

    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TotalPlanesPorMp($id_mp, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select
    tbl_planes_ingresados.*,
    tbl_usuario.nombre_completo
    from tbl_planes_ingresados
    inner join tbl_usuario
    on tbl_usuario.rut=tbl_planes_ingresados.responsable
    where tbl_planes_ingresados.id_mp='$id_mp'
    and tbl_planes_ingresados.id_empresa='$id_empresa'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function InsertoPlanMP($id_mp, $id_empresa, $rut, $causa_raiz, $plan, $responsable, $fecha)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $ultimo_id = ObtengoUltimoRegistroMP($id_empresa);
    $nuevo_id  = $ultimo_id[0]->id;
    $nuevo_id  = $nuevo_id + 1;
    $sql       = "INSERT INTO tbl_planes_ingresados(id_mp, id_empresa, evaluado, causa_raiz, plan, responsable, fecha) " . "VALUES ('$id_mp', '$id_empresa', '$rut', '$causa_raiz', '$plan', '$responsable', '$fecha');";
    $database->setquery($sql);
    $database->query();
}
function Obtenerpracticascompartidos($rut, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select h.*
    from tbl_objeto_comentarios h where rut='$rut' and id_empresa='$id_empresa'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TotalEquipoPorMp($id_mp, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "SELECT
    tbl_mp_equipo.*, tbl_usuario.nombre_completo
    FROM
    tbl_mp_equipo

    inner join tbl_usuario
    on tbl_usuario.rut=tbl_mp_equipo.rut
    WHERE
    tbl_mp_equipo.id_mp = '$id_mp'
    AND tbl_mp_equipo.id_empresa = '$id_empresa'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function InsertoColaboadoresEquipoMP($rut, $id_empresa, $id_mp)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $ultimo_id = ObtengoUltimoRegistroMP($id_empresa);
    $nuevo_id  = $ultimo_id[0]->id;
    $nuevo_id  = $nuevo_id + 1;
    $sql       = "INSERT INTO tbl_mp_equipo(id_mp, rut, id_empresa) " . "VALUES ('$id_mp', '$rut', '$id_empresa' );";
    $database->setquery($sql);
    $database->query();
}
function cuposdiponibles($codigo_inscripcion, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select count(h.id) as cuenta,
    (select cupos from tbl_inscripcion_curso where codigo_inscripcion='$codigo_inscripcion' and id_empresa='$id_empresa') as cupos
    from tbl_inscripcion_usuarios h
    where h.id_inscripcion='$codigo_inscripcion'
    and (h.estadoinscripcion='PREINSCRITO' or h.estadoinscripcion='INSCRITO')  and h.id_empresa='$id_empresa'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ActualizaComentariosfinalesSGD($evaluado, $evaluador, $id_empresa, $id_proceso, $comentario, $sucesor)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "update tbl_sgd_comentarios_finales
    set
    comentario='$comentario',
    sucesor='$sucesor'
    where evaluado='$evaluado'
    and evaluador='$evaluador'
    and id_empresa='$id_empresa'
    and id_proceso='$id_proceso'";
    $database->setquery($sql);
    $database->query();
}
function InsertaPoder($rut, $id_empresa, $malla, $clasificacion)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $ultimo_id = ObtengoUltimoRegistroMP($id_empresa);
    $nuevo_id  = $ultimo_id[0]->id;
    $nuevo_id  = $nuevo_id + 1;
    $sql       = "INSERT INTO tbl_poderes(rut, id_empresa, id_malla, id_clasificacion) " . "VALUES ('$rut', '$id_empresa', '$malla', '$clasificacion');";
    $database->setquery($sql);
    $database->query();
}
function ListaCursosDisponibleYDatosPorCurso($rut, $id_empresa, $id_curso)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "

    select h.*,
    (select nombre from tbl_lms_curso where id=h.id_curso) as nombre_curso,
    (select descripcion from tbl_lms_curso where id=h.id_curso) as descripcion_curso,
    (select imagen from tbl_lms_curso where id=h.id_curso) as imagen_curso,

    (select descriptor from tbl_lms_curso where id=h.id_curso) as descriptor,
    (select descripcion from tbl_lms_curso where id=h.id_curso) as descripcion,
    (select acercade from tbl_lms_curso where id=h.id_curso) as acercade,
    (select objetivo_curso from tbl_lms_curso where id=h.id_curso) as objetivo_curso,

    (select count(id) from tbl_inscripcion_usuarios where id_inscripcion=h.codigo_inscripcion and estadoinscripcion='INSCRITO' ) as Inscritos,
    (select count(id) from tbl_inscripcion_usuarios where id_inscripcion=h.codigo_inscripcion and estadoinscripcion='PREINSCRITO') as Preinscritos,
    (select count(id) from tbl_inscripcion_usuarios where id_inscripcion=h.codigo_inscripcion and estadoinscripcion='LISTAESPERA') as ListaEspera

    from tbl_inscripcion_curso h
    where h.id_empresa='$id_empresa'
    and h.id_curso='$id_curso'
    and
    (select modalidad from tbl_lms_curso where id=h.id_curso)='5'
    ORDER BY UNIX_TIMESTAMP(fecha_inicio) ASC
    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ListaCursosDisponibleYDatosPorCursoInscripcion($rut, $id_empresa, $id_curso, $id_inscripcion)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "

    select h.*,
    (select nombre from tbl_lms_curso where id=h.id_curso) as nombre_curso,
    (select descripcion from tbl_lms_curso where id=h.id_curso) as descripcion_curso,
    (select imagen from tbl_lms_curso where id=h.id_curso) as imagen_curso,

    (select descriptor from tbl_lms_curso where id=h.id_curso) as descriptor,
    (select descripcion from tbl_lms_curso where id=h.id_curso) as descripcion,
    (select acercade from tbl_lms_curso where id=h.id_curso) as acercade,
    (select objetivo_curso from tbl_lms_curso where id=h.id_curso) as objetivo_curso,

    (select count(id) from tbl_inscripcion_usuarios where id_inscripcion=h.codigo_inscripcion and estadoinscripcion='INSCRITO' ) as Inscritos,
    (select count(id) from tbl_inscripcion_usuarios where id_inscripcion=h.codigo_inscripcion and estadoinscripcion='PREINSCRITO') as Preinscritos,
    (select count(id) from tbl_inscripcion_usuarios where id_inscripcion=h.codigo_inscripcion and estadoinscripcion='LISTAESPERA') as ListaEspera

    from tbl_inscripcion_curso h
    where h.id_empresa='$id_empresa'
    and h.codigo_inscripcion='$id_inscripcion'
    and
    (select modalidad from tbl_lms_curso where id=h.id_curso)='5'
    ORDER BY UNIX_TIMESTAMP(fecha_inicio) ASC
    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ActualizaEstadoAccionPendiente($rut, $id_empresa, $codigo_inscripcion, $id_curso, $rut_jefe, $estado)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "update tbl_lms_acciones_pendientes
    set   estado='$estado'


    where rut_jefe='$rut_jefe' and rut_colaborador='$rut' and id_empresa='$id_empresa' and id_curso='$id_curso' and codigo_inscripcion='$codigo_inscripcion'";
    $database->setquery($sql);
    $database->query();
}
function ActualizaInscripcipnCurso($rut, $id_curso, $id_empresa, $id_inscripcion, $estadoinscripcion)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    if ($estadoinscripcion == "1") {
        $sql_inscrito = "estadoinscripcion='INSCRITO', inscrito='1'";
    } else {
        $sql_inscrito = "estadoinscripcion='RECHAZADO', inscrito = null ";
    }
    $sql = "update tbl_inscripcion_usuarios
    set $sql_inscrito



    where rut='$rut' and id_inscripcion='$id_inscripcion' and id_empresa='$id_empresa' and id_curso='$id_curso'";
    $database->setquery($sql);
    $database->query();
}
function InsertaInscripcionCursos($rut, $id_empresa, $codigo_inscripcion, $id_curso, $tipo, $rut_jefatura, $cupos_disponibles)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select count(id) as cuenta from tbl_inscripcion_postulantes  where id_inscripcion='$codigo_inscripcion' and id_empresa='$id_empresa'
    and id_curso='$id_curso' and rut='rut'";
    $database->setquery($sql);
    $database->query();
    $cod    = $database->listObjects();
    $cuenta = $cod->cuenta;
    if ($cuenta == 0) {
        $sql = "INSERT INTO tbl_inscripcion_postulantes (
    rut,
    id_curso,
    id_empresa,
    id_inscripcion,
    estadoinscripcion,
    inscrito,
    fecha,
    hora) " . "VALUES ('$rut', '$id_curso', '$id_empresa', '$codigo_inscripcion','$tipo', '1','" . date("Y-m-d") . "', '" . date("H:i:s") . "');";
        $database->setquery($sql);
        $database->query();
        InsertaAccionPendiente($rut, $rut_jefatura, "", $id_curso, $id_empresa, "0", "", "", "1", $codigo_inscripcion);
    }
}
function ActualizaInscripcionPostulacionCursos($rut, $id_empresa, $codigo_inscripcion, $id_curso, $tipo)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "UPDATE  tbl_inscripcion_postulantes

    set preinscrito='$tipo',

    fecha='" . date("Y-m-d") . "', hora='" . date("H:i:s") . "'

    where id_inscripcion='$codigo_inscripcion' and id_empresa='$id_empresa'
    and id_curso='$id_curso' and rut='$rut'";
    $database->setquery($sql);
    $database->query();
    $cod    = $database->listObjects();
    $cuenta = $cod->cuenta;
}
function buscaidinscripcioncurso($idc, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select h.* from tbl_inscripcion_curso h where h.codigo_inscripcion='$idc' and h.id_empresa='$id_empresa'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ListaCuentaInscripciones($rut, $tipo, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select count(id) as cuenta from tbl_inscripcion_postulantes where preinscrito='$tipo' and id_empresa='$id_empresa' and rut='$rut'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod[0]->cuenta;
}
function ListaCursosInscripcionesRut($rut, $tipo, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "

    select h.*,
    (select fecha_inicio from tbl_inscripcion_curso where codigo_inscripcion=h.id_inscripcion) as fecha_inicio,
    (select fecha_termino from tbl_inscripcion_curso where codigo_inscripcion=h.id_inscripcion) as fecha_termino,
    (select direccion from tbl_inscripcion_curso where codigo_inscripcion=h.id_inscripcion) as direccion,
    (select comentarios from tbl_inscripcion_curso where codigo_inscripcion=h.id_inscripcion) as comentarios,
    (select id_curso from tbl_inscripcion_curso where codigo_inscripcion=h.id_inscripcion) as id_curso,

    (select nombre from tbl_lms_curso where id=(select id_curso from tbl_inscripcion_curso where codigo_inscripcion=h.id_inscripcion)) as curso,
    (select imagen from tbl_lms_curso where id=(select id_curso from tbl_inscripcion_curso where codigo_inscripcion=h.id_inscripcion)) as imagen

    from tbl_inscripcion_postulantes h where h.preinscrito='$tipo' and h.id_empresa='$id_empresa' and h.rut='$rut'


    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ListaCursosDisponibleYDatos($rut, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "

    select h.*,
    (select nombre from tbl_lms_curso where id=h.id_curso) as nombre_curso,
    (select descripcion from tbl_lms_curso where id=h.id_curso) as descripcion_curso,
    (select imagen from tbl_lms_curso where id=h.id_curso) as imagen_curso,

    (select descriptor from tbl_lms_curso where id=h.id_curso) as descriptor,
    (select descripcion from tbl_lms_curso where id=h.id_curso) as descripcion,
    (select acercade from tbl_lms_curso where id=h.id_curso) as acercade,
    (select objetivo_curso from tbl_lms_curso where id=h.id_curso) as objetivo_curso,

    (select count(id) from tbl_inscripcion_usuarios where id_inscripcion=h.codigo_inscripcion and estadoinscripcion='INSCRITO' ) as Inscritos,
    (select count(id) from tbl_inscripcion_usuarios where id_inscripcion=h.codigo_inscripcion and estadoinscripcion='PREINSCRITO') as Preinscritos,
    (select count(id) from tbl_inscripcion_usuarios where id_inscripcion=h.codigo_inscripcion and estadoinscripcion='LISTAESPERA') as ListaEspera

    from tbl_inscripcion_curso h where h.id_empresa='$id_empresa'
    and
    (select modalidad from tbl_lms_curso where id=h.id_curso)='5'
    ORDER BY UNIX_TIMESTAMP(fecha_inicio) ASC
    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ListaCursosDisponibleAgrupados($id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
    select h.* from tbl_lms_curso h where h.modalidad='5' and h.id_empresa='$id_empresa'
    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ListaCursosDisponibleAgrupadosMalla($id_malla, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
    select h.* from tbl_lms_curso h where h.modalidad='5' and h.id_empresa='$id_empresa'    and (select id_malla from rel_lms_malla_curso where id_curso=h.id)='$id_malla'
    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ListaCursosDisponiblePostulante($rut, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
    select h.*,

    ( SELECT fecha_inicio FROM tbl_inscripcion_curso WHERE id_curso = h.id_curso order by fecha_inicio asc limit 1) AS fecha_inicio,
    ( SELECT fecha_termino FROM tbl_inscripcion_curso WHERE id_curso = h.id_curso order by fecha_termino desc limit 1) AS fecha_termino,

    (select nombre from tbl_lms_curso where id=h.id_curso) as nombre,
    (select imagen from tbl_lms_curso where id=h.id_curso) as imagen,
    (select descripcion from tbl_lms_curso where id=h.id_curso) as descripcion,
    (select descriptor from tbl_lms_curso where id=h.id_curso) as descriptor,
    (select acercade from tbl_lms_curso where id=h.id_curso) as acercade,
    (select objetivo_curso from tbl_lms_curso where id=h.id_curso) as objetivo_curso

    from tbl_inscripcion_postulantes h
    inner JOIN tbl_lms_curso

    on tbl_lms_curso.id=h.id_curso
    where h.rut='$rut' and h.id_empresa='$id_empresa'
    and
    (( SELECT abierto_cerrado FROM tbl_inscripcion_curso WHERE id_curso = h.id_curso order by fecha_termino desc limit 1) is null or ( SELECT abierto_cerrado FROM tbl_inscripcion_curso WHERE id_curso = h.id_curso order by fecha_termino desc limit 1)='')
    group by h.id_curso

    order by ( SELECT fecha_inicio FROM tbl_inscripcion_curso WHERE id_curso = h.id_curso order by fecha_inicio asc limit 1)
    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ListaInscripcionesDisponibleYDatos($id_curso, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "

    select h.*,


    (select count(id) from tbl_inscripcion_postulantes where id_inscripcion=h.codigo_inscripcion and preinscrito='INSCRITO' ) as Inscritos,
    (select count(id) from tbl_inscripcion_postulantes where id_inscripcion=h.codigo_inscripcion and preinscrito='PREINSCRITO') as Preinscritos,
    (select count(id) from tbl_inscripcion_postulantes where id_inscripcion=h.codigo_inscripcion and preinscrito='LISTAESPERA') as ListaEspera

    from tbl_inscripcion_curso h where h.id_empresa='$id_empresa' and h.id_curso='$id_curso'

    ORDER BY UNIX_TIMESTAMP(fecha_inicio) ASC
    ";
    //echo $sql;
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function InscripcionRutCursoLms($rut, $id_inscripcion, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_inscripcion_postulantes where id_inscripcion='$id_inscripcion' and id_empresa='$id_empresa' and rut='$rut' and preinscrito='PREINSCRITO'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ListaCursosDisponibleYDatosRut($rut, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "

    select h.*,
    (select nombre from tbl_lms_curso where id=h.id_curso) as nombre_curso,
    (select descripcion from tbl_lms_curso where id=h.id_curso) as descripcion_curso,
    (select imagen from tbl_lms_curso where id=h.id_curso) as imagen_curso,

    (select descriptor from tbl_lms_curso where id=h.id_curso) as descriptor,
    (select descripcion from tbl_lms_curso where id=h.id_curso) as descripcion,
    (select acercade from tbl_lms_curso where id=h.id_curso) as acercade,
    (select objetivo_curso from tbl_lms_curso where id=h.id_curso) as objetivo_curso,

    (select count(id) from tbl_inscripcion_usuarios where id_inscripcion=h.codigo_inscripcion and estadoinscripcion='INSCRITO' ) as Inscritos,
    (select count(id) from tbl_inscripcion_usuarios where id_inscripcion=h.codigo_inscripcion and estadoinscripcion='PREINSCRITO') as Preinscritos,
    (select count(id) from tbl_inscripcion_usuarios where id_inscripcion=h.codigo_inscripcion and estadoinscripcion='LISTAESPERA') as ListaEspera

    from tbl_inscripcion_curso h where h.id_empresa='$id_empresa'
    and
    (select modalidad from tbl_lms_curso where id=h.id_curso)='5'
    ORDER BY UNIX_TIMESTAMP(fecha_inicio) ASC
    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ObjetivosEspecificosConRespuestaEvaluadoEvaluadorProceso2Objeto($evaluado, $evaluador, $id_proceso, $id_objeto)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = sprintf("

    SELECT
    tbl_objetivos_dimension.nombre AS nombre_dimension,
    tbl_sgd_respuestas.*, tbl_objetivos_individuales.descripcion_objetivo,
    tbl_objetivos_individuales.dimension,
    tbl_objetivos_individuales.ponderacion,
    tbl_objetivos_individuales.id as id_objetivo_original,
    tbl_objetivos_individuales.nota_descripcion,
    tbl_objetivos_individuales.nota_ev,
    tbl_objetivos_individuales.metrica
    FROM
    tbl_objetivos_individuales
    left JOIN tbl_sgd_respuestas ON tbl_objetivos_individuales.id = tbl_sgd_respuestas.id_objetivo
    and tbl_sgd_respuestas.evaluado='$evaluado' and tbl_sgd_respuestas.evaluador='$evaluador' and tbl_sgd_respuestas.id_proceso='$id_proceso'
    INNER JOIN tbl_objetivos_dimension ON tbl_objetivos_dimension.id = tbl_objetivos_individuales.dimension
    WHERE
    tbl_objetivos_individuales.rut='$evaluado'
    and tbl_objetivos_individuales.id='$id_objeto'
    ORDER BY
    nombre_dimension ASC


    ");
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function FinalizadoFijacionEvaluador($evaluador, $id_proceso)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "SELECT * from tbl_sgd_fijacion_finalizado where evaluador='$evaluador' and id_proceso='$id_proceso'
    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function FinalizadoFijacionEvaluadoEvaluador($evaluado, $evaluador, $id_proceso)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "SELECT * from tbl_sgd_fijacion_finalizado where evaluado='$evaluado' and evaluador='$evaluador' and id_proceso='$id_proceso'
    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TraigoObjetivoFijacionTodos($evaluado, $evaluador, $id_proceso, $tipo, $group_by)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "SELECT * from tbl_sgd_fijacion where evaluado='$evaluado' and evaluador='$evaluador' and id_proceso='$id_proceso'  and tipo='$tipo'
    GROUP BY $group_by
    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TraigoObjetivoFijacion($evaluado, $evaluador, $id_proceso, $numero, $tipo)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "SELECT * from tbl_sgd_fijacion where evaluado='$evaluado' and evaluador='$evaluador' and id_proceso='$id_proceso' and numero='$numero' and tipo='$tipo'
    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function EvaluadosDadoEvaluadorPorProcesoSinAeParaFijacion($evaluador, $id_proceso)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "SELECT
    tbl_sgd_relaciones.*, tbl_sgd_subperfiles.perfil AS nombre_subperfil,
    tbl_sgd_relaciones.perfil_evaluacion_competencias AS perfil_evaluacion,
    tbl_usuario.nombre_completo,
    (select count(*) as total from tbl_sgd_fijacion
    where tbl_sgd_fijacion.evaluado=tbl_sgd_relaciones.evaluado
    and tbl_sgd_fijacion.evaluador=tbl_sgd_relaciones.evaluador
    and tbl_sgd_fijacion.id_proceso=tbl_sgd_relaciones.id_proceso
    and tbl_sgd_fijacion.objetivo <>''
    and tbl_sgd_fijacion.medicion_cumplimiento <>'') as total_objetivos,

    (select count(*) as total from tbl_sgd_fijacion
    where tbl_sgd_fijacion.evaluado=tbl_sgd_relaciones.evaluado
    and tbl_sgd_fijacion.evaluador=tbl_sgd_relaciones.evaluador
    and tbl_sgd_fijacion.id_proceso=tbl_sgd_relaciones.id_proceso
    and tbl_sgd_fijacion.areas_desarrollo<>''
    and tbl_sgd_fijacion.acciones_requeridas<>'') as total_planes,
    tbl_sgd_fijacion_finalizado.evaluado as finalizado_proceso


    FROM
    tbl_sgd_relaciones
    INNER JOIN tbl_sgd_subperfiles ON tbl_sgd_subperfiles.id = tbl_sgd_relaciones.subperfil
    INNER JOIN tbl_usuario ON tbl_usuario.rut = tbl_sgd_relaciones.evaluado
    left join tbl_sgd_fijacion_finalizado
    on tbl_sgd_fijacion_finalizado.evaluado=tbl_sgd_relaciones.evaluado
    and tbl_sgd_fijacion_finalizado.evaluador=tbl_sgd_relaciones.evaluador and
    tbl_sgd_fijacion_finalizado.id_proceso=tbl_sgd_relaciones.id_proceso
    WHERE
    tbl_sgd_relaciones.evaluador = '$evaluador'
    AND tbl_sgd_relaciones.id_proceso = '$id_proceso'
    AND tbl_sgd_relaciones.evaluador <> tbl_sgd_relaciones.evaluado
    ORDER BY
    nombre_completo ASC
    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function InsertaFijacionFinalizado($evaluado, $evaluador, $id_proceso, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "INSERT INTO tbl_sgd_fijacion_finalizado(evaluado, evaluador, id_proceso, id_empresa) " . "VALUES ('$evaluado', '$evaluador', '$id_proceso', '$id_empresa');";
    $database->setquery($sql);
    $database->query();
}
function InsertaPlanObjetivo($evaluado, $evaluador, $id_proceso, $id_empresa, $area_desarrollo, $acciones_requeridas, $numero)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "INSERT INTO tbl_sgd_fijacion(evaluado, evaluador, id_empresa, id_proceso, numero, areas_desarrollo, acciones_requeridas, tipo) " . "VALUES ('$evaluado', '$evaluador', '$id_empresa', '$id_proceso', '$numero', '$area_desarrollo','$acciones_requeridas', 'plan');";
    $database->setquery($sql);
    $database->query();
}
function InsertaFijacionObjetivo($evaluado, $evaluador, $id_proceso, $id_empresa, $objetivo, $medicion, $numero)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "INSERT INTO tbl_sgd_fijacion(evaluado, evaluador, id_empresa, id_proceso, numero, objetivo, medicion_cumplimiento, tipo) " . "VALUES ('$evaluado', '$evaluador', '$id_empresa', '$id_proceso', '$numero', '$objetivo','$medicion', 'objetivo');";
    $database->setquery($sql);
    $database->query();
}
function EvaluadosDadoEvaluadorPorProcesoSinAe($evaluador, $id_proceso)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "SELECT
    tbl_sgd_relaciones.*, tbl_sgd_subperfiles.perfil AS nombre_subperfil,
    tbl_sgd_relaciones.perfil_evaluacion_competencias as perfil_evaluacion,
    tbl_usuario.nombre_completo
    FROM
    tbl_sgd_relaciones
    INNER JOIN tbl_sgd_subperfiles ON tbl_sgd_subperfiles.id = tbl_sgd_relaciones.subperfil
    INNER JOIN tbl_usuario ON tbl_usuario.rut = tbl_sgd_relaciones.evaluado
    WHERE
    tbl_sgd_relaciones.evaluador = '$evaluador'
    AND tbl_sgd_relaciones.id_proceso = '$id_proceso'
    AND tbl_sgd_relaciones.evaluador<>tbl_sgd_relaciones.evaluado
    and (
    tbl_usuario.perfil_evaluacion='' or
    tbl_usuario.perfil_evaluacion is null or

    tbl_usuario.perfil_evaluacion='SI')
    ORDER BY
    nombre_completo ASC
    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function InsertaDesarrolloCarrera($evaluado, $evaluador, $id_empresa, $id_proceso, $id_desarrollo_carrera)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "INSERT INTO tbl_sgd_respuestas_desarrollo_carrera(evaluado, evaluador, id_empresa, id_proceso, id_desarrollo_carrera, fecha, hora) " . "VALUES ('$evaluado', '$evaluador', '$id_empresa', '$id_proceso', '$id_desarrollo_carrera', '" . date("Y-m-d") . "', '" . date("H:i:s") . "');";
    $database->setquery($sql);
    $database->query();
}
function totalInteresesDesarrollo($id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
    select * from tbl_sgd_desarrollo_carrera where id_empresa='$id_empresa' order by orden asc

    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function PromedioTrivias($rut, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "    SELECT
    avg(tbl_objetos_finalizados.nota) as promedio_trivias
    FROM
    tbl_objetos_finalizados
    inner join tbl_lms_curso
    on tbl_lms_curso.id=tbl_objetos_finalizados.id_curso
    WHERE
    tbl_objetos_finalizados.rut = '$rut'
    AND tbl_objetos_finalizados.nota <> ''
    and tbl_lms_curso.id_empresa='$id_empresa'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function SelectAsterisco($tabla)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "    select * from $tabla ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function DatosTema($tema)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "    select * from tbl_tema where id_tema='$tema'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ObtengoCantidadDeIntentosPorColaborador($rut, $id_objeto, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "    select * from tbl_evaluaciones_intentos where rut='$rut' and id_objeto='$id_objeto' and id_empresa='$id_empresa'    ";


    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function InsertaIntentoEvaluacionLMS($rut, $id_evaluacion, $id_objeto, $id_curso, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "INSERT INTO tbl_evaluaciones_intentos(rut, id_evaluacion, id_objeto, id_curso, id_empresa, fecha, hora) " . "VALUES ('$rut', '$id_evaluacion', '$id_objeto', '$id_curso', '$id_empresa', '" . date("Y-m-d") . "', '" . date("H:i:s") . "');";
    $database->setquery($sql);
    $database->query();
}
function ResultadosPromedioPorDeterminantes($evaluador, $id_proceso, $evaluado)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    if ($evaluado) {
        $filtro_evaluado = " and tbl_sgd_respuestas.evaluado='$evaluado'";
        $subquery        = " ,
    (
    SELECT
    avg(respuestas_ae.respuesta)
    FROM
    tbl_sgd_respuestas AS respuestas_ae
    inner join tbl_sgd_preguntas as preguntas_ae
    on preguntas_ae.id=respuestas_ae.id_pregunta
    WHERE
    respuestas_ae.evaluado = '$evaluado'
    AND respuestas_ae.evaluador = '$evaluado'
    AND respuestas_ae.id_proceso = '$id_proceso'
    and preguntas_ae.id_determinante=tbl_sgd_determinante.id


    ) as nota_ae";
    }
    $sql = "

    SELECT
    avg(
    tbl_sgd_respuestas.respuesta
    )AS promedio_por_determinante,
    tbl_sgd_determinante.sigla,
    tbl_sgd_determinante.id AS id_determinante
    $subquery

    FROM
    tbl_sgd_respuestas
    INNER JOIN tbl_sgd_preguntas ON tbl_sgd_preguntas.id = tbl_sgd_respuestas.id_pregunta
    INNER JOIN tbl_sgd_determinante ON tbl_sgd_determinante.id = tbl_sgd_preguntas.id_determinante
    WHERE
    tbl_sgd_respuestas.evaluador = '$evaluador'
    $filtro_evaluado

    AND tbl_sgd_respuestas.id_proceso = '$id_proceso'
    AND tbl_sgd_respuestas.evaluado <> tbl_sgd_respuestas.evaluador
    GROUP BY
    tbl_sgd_preguntas.id_determinante


    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ResultadosPromedioCompetenciasSGD($evaluador, $id_proceso)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
    SELECT
    tbl_sgd_resultados_calculados_competencia.id_competencia,
    avg(tbl_sgd_resultados_calculados_competencia.nota) as promedio_competencia, tbl_sgd_componente.sigla
    FROM
    tbl_sgd_resultados_calculados_competencia

    inner join tbl_sgd_componente
    on tbl_sgd_componente.id=tbl_sgd_resultados_calculados_competencia.id_competencia
    WHERE
    tbl_sgd_resultados_calculados_competencia.evaluador = '$evaluador'
    AND tbl_sgd_resultados_calculados_competencia.evaluado <> tbl_sgd_resultados_calculados_competencia.evaluador
    and tbl_sgd_resultados_calculados_competencia.id_proceso='$id_proceso'
    GROUP BY
    tbl_sgd_resultados_calculados_competencia.id_competencia;

    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ActualizaNotaFinalTablaFinalizados($evaluado, $evaluador, $id_proceso, $nota, $criterio)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "

    update tbl_sgd_finalizados_evaluado_evaluador set nota='$nota', criterio='$criterio' where evaluado='$evaluado' and evaluador='$evaluador' and id_proceso='$id_proceso'

    ";
    $database->setquery($sql);
    $database->query();
}
function CALCULA_ActualizaResultadosCalculados($evaluado, $evaluador, $calibrador, $id_proceso, $id_competencia, $nota, $criterio, $perfil, $subperfil)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "UPDATE tbl_sgd_resultados_calculados_competencia SET nota= '" . $nota . "', criterio='$criterio' WHERE evaluado = '" . $evaluado . "' and evaluador='$evaluador' and id_proceso='$id_proceso' and id_competencia='$id_competencia' and perfil='$perfil' and subperfil='$subperfil'";
    $database->setquery($sql);
    $database->query();
}
function CALCULA_InsertaResultadosCalculados($evaluado, $evaluador, $calibrador, $id_proceso, $id_competencia, $nota, $criterio, $perfil, $subperfil)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "INSERT INTO tbl_sgd_resultados_calculados_competencia(evaluado, evaluador, calibrador, id_proceso, id_competencia, nota, criterio, perfil, subperfil) " . "VALUES ('$evaluado', '$evaluador', '$calibrador', '$id_proceso', '$id_competencia', '$nota', '$criterio', '$perfil', '$subperfil');";
    $database->setquery($sql);
    $database->query();
}
function CALCULA_TieneResultadosPorCometencciaCalculados($evaluado, $evaluador, $id_proceso, $id_competencia)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
    select * from tbl_sgd_resultados_calculados_competencia where evaluado='$evaluado' and evaluador='$evaluador' and id_proceso='$id_proceso' and id_competencia='$id_competencia'
    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ObtenerClasificacionDadoCursoMallaEmpresa($id_curso, $id_malla, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "

    select id_clasificacion from rel_lms_malla_curso where id_empresa='$id_empresa' and id_malla='$id_malla' and id_curso='$id_curso'
    ";
    $database->setquery($sql);
    $database->query();
    $datos = $database->listObjects();
    return $datos;
}
function Datos_tbl_lms_ranking($id_empresa, $tipo_campo)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_lms_ranking_criterios
    where id_empresa='$id_empresa'
    and tipo='$tipo_campo'

    order by avance  desc limit 10";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TraeDatosDesafioDadoId($id_desafio)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_lms_desafios where id='$id_desafio'


    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function VerificoDesafioPorObjeto($rut, $id_objeto, $id_curso, $id_empresa, $id_desafio)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select tbl_lms_desafios_respuestas.* from tbl_lms_desafios_respuestas
    where tbl_lms_desafios_respuestas.rut='$rut' and tbl_lms_desafios_respuestas.id_objeto='$id_objeto'
    and tbl_lms_desafios_respuestas.id_curso='$id_curso'
    and tbl_lms_desafios_respuestas.id_empresa='$id_empresa'
    and tbl_lms_desafios_respuestas.id_desafio='$id_desafio'


    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ActualizaRespuestasDesafios($rut, $id_pregunta, $respuesta, $id_objeto, $id_curso, $id_empresa, $id_desafio)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "

    update tbl_lms_desafios_respuestas set respuesta='$respuesta'

    where rut='$rut' and
    id_objeto='$id_objeto' and
    id_curso='$id_curso' and
    id_pregunta='$id_pregunta' and
    id_empresa='$id_empresa' and
    id_desafio='$id_desafio'

    ";
    $database->setquery($sql);
    $database->query();
}
function InsertaRespuestaDesafio($rut, $id_pregunta, $respuesta, $id_objeto, $id_curso, $id_empresa, $id_desafio)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "INSERT INTO tbl_lms_desafios_respuestas(rut, id_pregunta, respuesta, id_objeto, id_curso, id_empresa, id_desafio) " . "VALUES ('$rut', '$id_pregunta', '$respuesta', '$id_objeto', '$id_curso', '$id_empresa', '$id_desafio');";
    $database->setquery($sql);
    $database->query();
}
function VerificoPReguntaDesafio($rut, $id_pregunta, $id_objeto, $id_curso, $id_empresa, $id_desafio)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select tbl_lms_desafios_respuestas.* from tbl_lms_desafios_respuestas
    where tbl_lms_desafios_respuestas.rut='$rut' and tbl_lms_desafios_respuestas.id_objeto='$id_objeto'
    and tbl_lms_desafios_respuestas.id_pregunta='$id_pregunta'
    and tbl_lms_desafios_respuestas.id_curso='$id_curso'
    and tbl_lms_desafios_respuestas.id_empresa='$id_empresa'
    and tbl_lms_desafios_respuestas.id_desafio='$id_desafio'


    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TraigoPreguntasPorDesafio($id_desafio, $rut, $id_objeto, $id_curso, $id_desafio, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
    SELECT
    tbl_lms_desafios_preguntas.*, tbl_lms_desafios_respuestas.respuesta,
    tbl_lms_desafios_pregunta_tipo.template, tbl_lms_desafios_dimensiones.dimension
    FROM
    tbl_lms_desafios
    INNER JOIN rel_lms_desafios_preguntas ON rel_lms_desafios_preguntas.id_desafio = tbl_lms_desafios.id
    INNER JOIN tbl_lms_desafios_preguntas ON tbl_lms_desafios_preguntas.id = rel_lms_desafios_preguntas.id_preguntas
    INNER JOIN tbl_lms_desafios_pregunta_tipo ON tbl_lms_desafios_pregunta_tipo.id = tbl_lms_desafios_preguntas.tipo_pregunta


    left join tbl_lms_desafios_dimensiones
    on tbl_lms_desafios_dimensiones.id=tbl_lms_desafios_preguntas.id_dimension


    left join tbl_lms_desafios_respuestas
    on tbl_lms_desafios_respuestas.rut='$rut' and tbl_lms_desafios_respuestas.id_pregunta=tbl_lms_desafios_preguntas.id
    and tbl_lms_desafios_respuestas.id_objeto='$id_objeto'
    and tbl_lms_desafios_respuestas.id_curso='$id_curso'
    and tbl_lms_desafios_respuestas.id_desafio='$id_desafio'
    and tbl_lms_desafios_respuestas.id_empresa='$id_empresa'
    WHERE
    tbl_lms_desafios.id = '$id_desafio' order by
    rel_lms_desafios_preguntas.orden ASC


    ";
    //echo $sql;
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ActualizaBiografaProfesional($rut, $pareja, $emfermedades_importantes, $nombre_contacto_emergencia, $telefono_contacto_emergencia, $estudios, $profesion, $cantidad_hijos, $edad_hijos, $sexo_hijos, $ultima_empresa, $cargo_ultima_empresa, $tiempo_ultima_empresa, $motivacion, $que_esperas_jefatura, $que_esperas_cargo, $metas, $capacitacion, $talla_camisa, $talla_pantalon, $talla_chaqueta, $talla_falda, $rut_jefatura, $id_objeto, $id_curso, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "

    update tbl_usuario_biografia set pareja='$pareja',
    emfermedades_importantes='$emfermedades_importantes',
    nombre_contacto_emergencia='$nombre_contacto_emergencia',
    telefono_contacto_emergencia='$telefono_contacto_emergencia',
    estudios='$estudios',
    profesion='$profesion',
    cantidad_hijos='$cantidad_hijos',
    edad_hijos='$edad_hijos',
    sexo_hijos='$sexo_hijos',
    ultima_empresa='$ultima_empresa',
    cargo_ultima_empresa='$cargo_ultima_empresa',
    tiempo_ultima_empresa='$tiempo_ultima_empresa',
    motivacion='$motivacion',
    que_esperas_jefatura='$que_esperas_jefatura',
    que_esperas_cargo='$que_esperas_cargo',
    metas='$metas',
    capacitacion='$capacitacion',
    talla_camisa='$talla_camisa',
    talla_pantalon='$talla_pantalon',
    talla_chaqueta='$talla_chaqueta',
    talla_falda='$talla_falda'
    where rut='$rut' and id_empresa='$id_empresa'

    ";
    $database->setquery($sql);
    $database->query();
}
function VerificaObjetoNoFinalizadoPendiente($rut, $id_empresa, $id_curso, $id_objeto)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "SELECT * from tbl_objetos_no_finalizados where id_empresa='$id_empresa' and rut='$rut' and id_objeto='$id_objeto' and id_curso='$id_curso'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function InsertaRegistroTblRegistrosNofinalizados($rut, $id_empresa, $id_malla, $id_curso, $id_objeto, $fecha, $hora)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "INSERT INTO tbl_objetos_no_finalizados(rut, id_empresa, id_objeto, id_curso, id_malla, fecha, hora) " . "VALUES ('$rut', '$id_empresa', '$id_objeto', '$id_curso', '4id_malla', '" . date("Y-m-d") . "', '" . date("H:i:s") . "');";
    $database->setquery($sql);
    $database->query();
}
function TraigoPreguntasPorDeterminantesEmpresa($id_determinante, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "SELECT id from tbl_sgd_preguntas where id_empresa='$id_empresa' and id_determinante='$id_determinante'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TotalDeterminantes($id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "SELECT * from tbl_sgd_determinante where id_empresa='$id_empresa'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function EliminoAccionesPendientes($rut, $id_objeto, $id_curso, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = sprintf("DELETE from tbl_lms_acciones_pendientes WHERE rut_colaborador= '$rut' and id_objeto='$id_objeto' and id_curso='$id_curso' and id_empresa='$id_empresa'");
    $database->setquery($sql);
    $database->query();
}
function Lms_Busca_Tareas_Pendientes_data($rut_colaborador, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "SELECT
    h.*,
    (select nombre from tbl_lms_curso where id=h.id_curso and id_empresa=h.id_empresa) as nombre_curso,
    (select titulo from tbl_objeto where id=h.id_objeto and id_curso=h.id_curso) as nombre_objeto,
    (select descripcion from tbl_objeto where id=h.id_objeto and id_curso=h.id_curso) as descripcion_objeto

    FROM
    tbl_lms_tareas h
    WHERE
    AND h.rut= '$rut_colaborador'
    AND h.id_empresa = '$id_empresa'
    and h.estado='0'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TieneTareasPorObjeroCursoempresaRut($rut, $id_empresa, $id_curso, $id_objeto)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select  * from tbl_lms_tareas where rut='$rut' and id_empresa='$id_empresa' and id_curso='$id_curso' and id_objeto='$id_objeto'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function InsertaTareaColaborador($rut, $id_empresa, $id_curso, $id_objeto, $nombre_archivo, $comentario)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "INSERT INTO tbl_lms_tareas(rut, comentario, nombre_documento, fecha, hora, id_empresa, id_curso, id_objeto) " . "VALUES ('$rut', '$comentario', '$nombre_archivo', '" . date("Y-m-d") . "', '" . date("H:i:s") . "', '$id_empresa', '$id_curso', '$id_objeto');";
    $database->setquery($sql);
    $database->query();
}
function ActualizaNotaAeMedioCiclo($id_objetivo, $nota_ae)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "update tbl_objetivos_individuales
    set   nota_medio_ciclo_ae='$nota_ae'


    where id='$id_objetivo'";
    $database->setquery($sql);
    $database->query();
}
function WS_existeusuariodata($rut, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $arreglo_rut = $arreglo_archivo = explode("-", $rut);
    $key         = $arreglo_rut[0];
    $sql         = "select * from tbl_usuario where rut='$key' and id_empresa='$id_empresa'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function WS_actualizadatos($rut, $nombre, $apellido, $imagenUrl, $cargo, $gerenciaR2, $gerenciaR3, $gerencia, $ola, $jefe, $email, $id_empresa, $tipo)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $arreglo_rut     = $arreglo_archivo = explode("-", $rut);
    $key             = $arreglo_rut[0];
    $nombre_completo = $nombre . " " . $apellido;
    if ($tipo == "actualiza") {
        $sql = "UPDATE tbl_usuario
    SET rut_completo='$rut', nombre='$nombre', apaterno='$apellido', nombre_completo='$nombre_completo',
    avatar='$imagenUrl', seccion='$ola', cargo='$cargo', gerencia='$gerencia', gerenciaR2='$gerenciaR2',
    gerencia='$gerenciaR3', jefe='$jefe', email='$email', id_empresa='$id_empresa'

    WHERE rut= '$key' AND id_empresa='$id_empresa'";
        $database->setquery($sql);
        $database->query();
    }
    if ($tipo == "inserta") {
        $sql = "INSERT INTO tbl_usuario (
    rut, rut_completo, nombre, apaterno, nombre_completo, avatar, seccion, cargo, gerencia, gerenciaR2, gerenciaR3, jefe, email, id_empresa
    ) VALUES (
    '$key', '$rut', '$nombre', '$apellido', '$nombre_completo', '$imagenUrl', '$ola', '$cargo',
    '$gerencia', '$gerenciaR2', '$gerenciaR3', '$jefe', '$email', '$id_empresa' );";
        $database->setquery($sql);
        $database->query();
    }
}
function WS_actualizamalla($rut, $id_malla_actualizada, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $arreglo_rut = $arreglo_archivo = explode("-", $rut);
    $key         = $arreglo_rut[0];
    $sql         = "select count(id) as cuenta from rel_lms_malla_persona
    where rut='$key' and id_empresa='$id_empresa'";
    $database->setquery($sql);
    $database->query();
    $cod        = $database->listObjects();
    $tienemalla = $cod[0]->cuenta;
    echo $tienemalla;
    if ($tienemalla >= 1) {
        $sql = "UPDATE rel_lms_malla_persona
    SET id_malla='$id_malla_actualizada'
    WHERE rut= '$key' AND id_empresa='$id_empresa'";
        $database->setquery($sql);
        $database->query();
    } else {
        $sql = "INSERT INTO rel_lms_malla_persona (
    rut, id_malla, id_empresa
    ) VALUES (
    '$key', '$id_malla_actualizada', '$id_empresa' );";
        $database->setquery($sql);
        $database->query();
    }
}
function TotalObjetivosPorRutEmpresaDimension($rut, $id_dimension, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
    select * from tbl_objetivos_individuales
    where rut='$rut' and dimension='$id_dimension' and id_empresa='$id_empresa'
    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ActualizaComentariosNotaMedioCicloObjetivos($id_objetivo, $comentario, $nota_jefe, $nota_ae)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "update tbl_objetivos_individuales
    set comentario_medio_ciclo='$comentario', nota_medio_ciclo_jefe='$nota_jefe'


    where id='$id_objetivo'";
    $database->setquery($sql);
    $database->query();
}
function InsertaComentariosFinalesMEdioCiclo($evaluado, $id_proceso, $id_empresa, $comentario, $campo)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "update tbl_objetivos_medio_ciclo_etapa1
    set $campo='$comentario'


    where evaluado='$evaluado' and id_empresa='$id_empresa' and id_proceso='$id_proceso'";
    $database->setquery($sql);
    $database->query();
}
function TraeRelacionesSoloAeConDatos($evaluado, $id_proceso)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
    SELECT
    tbl_sgd_relaciones.*, baseevaluado.nombre_completo,
    baseevaluado.perfil_competencia,
    baseevaluado.fecha_ingreso as fecha_ingreso_evaluado,
    baseevaluado.cargo as cargo_evaluado,
    baseevaluador.nombre_completo AS nombre_evaluador,
    basevalidador.nombre_completo AS nombre_validador
    FROM
    tbl_sgd_relaciones
    INNER JOIN tbl_usuario AS baseevaluado ON baseevaluado.rut = tbl_sgd_relaciones.evaluado
    INNER JOIN tbl_usuario AS baseevaluador ON baseevaluador.rut = tbl_sgd_relaciones.evaluador
    left JOIN tbl_usuario AS basevalidador ON basevalidador.rut = tbl_sgd_relaciones.validador
    WHERE
    tbl_sgd_relaciones.id_proceso = '$id_proceso'
    AND tbl_sgd_relaciones.evaluado = '$evaluado'

    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function EstaFinalizadoEpata1($rut, $id_proceso, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_objetivos_medio_ciclo_etapa1 where evaluado='$rut' and id_empresa='$id_empresa' and id_proceso='$id_proceso'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function InsertaFinalizadoEtap1MedioCiclo($rut, $id_proceso, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "INSERT INTO tbl_objetivos_medio_ciclo_etapa1(evaluado, id_proceso, id_empresa, fecha) " . "VALUES ('$rut', '$id_proceso', '$id_empresa', '" . date("Y-m-d") . "');";
    $database->setquery($sql);
    $database->query();
}
function ActualizaComentarioObjetivoPorDimension($id_dimension, $comentario, $rut)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "update tbl_objetivos_comentarios_dimension
    set comentario='$comentario'


    where rut='$rut' and id_dimension='$id_dimension'";
    $database->setquery($sql);
    $database->query();
}
function InsertaComentarioPorObjetivoDimension($id_dimension, $comentario, $rut)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "INSERT INTO tbl_objetivos_comentarios_dimension(
    rut, id_dimension, comentario, fecha, hora
    ) VALUES (
    '$rut', '$id_dimension', '$comentario', '" . date("Y-m-d") . "', '$cv');";
    $database->setquery($sql);
    $database->query();
}
function TieneComentariosObjetivosPorDimension($id_dimension, $rut)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_objetivos_comentarios_dimension where rut='$rut' and id_dimension='$id_dimension'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function InsertaPostulacionMovInterno($rut, $id, $motivacion, $conocimientos_tecnicos, $competencias_habilidades, $pretensiones_renta, $cv)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "INSERT INTO tbl_movimiento_interno_postulacion(
    rut, id_cargo_postulacion, motivacion, conocimientos_tecnicos, competencias_habilidades, pretensiones_renta, fecha_postulacion, cv
    ) VALUES (
    '$rut', '$id', '$motivacion', '$conocimientos_tecnicos', '$competencias_habilidades', '$pretensiones_renta', '" . date("Y-m-d") . "', '$cv');";
    $database->setquery($sql);
    $database->query();
}
function DetalleMovimientoInterno($id)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_movimiento_interno_publicaciones where id='$id'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ListadoMovimientosInternos($id_empresa, $rut)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select tbl_movimiento_interno_publicaciones.*, fecha_postulacion from tbl_movimiento_interno_publicaciones

    left join tbl_movimiento_interno_postulacion
    on tbl_movimiento_interno_postulacion.id_cargo_postulacion=tbl_movimiento_interno_publicaciones.id and
    tbl_movimiento_interno_postulacion.rut='$rut'

    where  id_empresa='$id_empresa'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}

function lms_busca_carrusel_ultimos_diez_data($campo, $dato, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "SELECT DISTINCT(h.rut)

            FROM tbl_lms_reportes h

            WHERE h.$campo = '$dato' AND h.estado = 'APROBADO' and h.id_empresa='$id_empresa'
            and (select vigencia from tbl_usuario where rut=h.rut)='0'
            ORDER BY h.fecha_termino DESC, h.hora_termino DESC

            LIMIT 10";

          //echo "sql $sql";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;



}

function lms_busca_carrusel_top_diez_perfil_puntos_medallas_data($perfil, $id_empresa)
{
        global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);
        $sql = "SELECT h.rut, (select nombre_completo from tbl_usuario where rut=h.rut) as nombre_completo,
    sum(h.puntos) AS puntos,
    sum(h.medallas) AS medallas,
(select tipo_cargo from tbl_usuario where rut=h.rut) as perfil
FROM
    tbl_gamificado_puntos h
WHERE
    h.id_empresa = '$id_empresa'
and
(select tipo_cargo from tbl_usuario where rut=h.rut)='$perfil'

GROUP BY
    h.rut

ORDER by sum(h.puntos),sum(h.medallas) DESC limit 10";

        //echo "sql $sql";
        $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();
        return $cod;



}

function lms_busca_carrusel_programa_ultimos_diez_data($id_programa, $id_empresa)
{
        global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);
        $sql = "SELECT DISTINCT(h.rut)  as rut

                        FROM tbl_lms_reportes h

                        WHERE h.id_programa = '$id_programa' AND h.avance >=50 and h.id_empresa='$id_empresa'
                        and (select vigencia from tbl_usuario where rut=h.rut)='0'
                        ORDER BY h.avance DESC, h.fecha_termino DESC, h.hora_termino DESC

                        LIMIT 10";

                   // echo "sql $sql";
        $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();
        //print_r($cod);
        return $cod;



}

function lms_busca_carrusel_sliders_ultimos_diez_data($campo, $dato, $id_empresa)
{
        global $c_host, $c_user, $c_pass, $c_db;
        $database = new database($c_host, $c_user, $c_pass);
        $database->setDb($c_db);
        $sql = "SELECT h.* from tbl_lms_slider h

                        WHERE  h.id_empresa='$id_empresa'

                        ORDER BY h.id DESC

                        LIMIT 10";

                   // echo "sql $sql";
        $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();
        return $cod;



}

function lms_busca_ultimo_curso_aprobado_data($rut, $id_empresa){

     global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "SELECT rut, id_curso, id_programa, fecha_termino, hora_termino, resultado

            FROM tbl_lms_reportes

            WHERE rut = '$rut'  and id_empresa='$id_empresa'
            ORDER BY fecha_termino DESC, hora_termino DESC

            LIMIT 1";

           // echo "sql $sql";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;



}


function UsuarioEnBasePersonaPorEmpresa($rut, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_usuario  where rut='$rut' and id_empresa='$id_empresa'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TraeDatosBiografiaProfesionalPorEmpresa($rut, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_usuario_biografia where rut='$rut' and id_empresa='$id_empresa'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TraeDatosBiografiaProfesional($rut, $id_objeto)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_usuario_biografia where rut='$rut' and id_objeto='$id_objeto'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TraeDatosBiografiaProfesionalUnico($rut)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_usuario_biografia where rut='$rut' limit 1";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function InsertaBiografaProfesional($rut, $pareja, $emfermedades_importantes, $nombre_contacto_emergencia, $telefono_contacto_emergencia, $estudios, $profesion, $cantidad_hijos, $edad_hijos, $sexo_hijos, $ultima_empresa, $cargo_ultima_empresa, $tiempo_ultima_empresa, $motivacion, $que_esperas_jefatura, $que_esperas_cargo, $metas, $capacitacion, $talla_camisa, $talla_pantalon, $talla_chaqueta, $talla_falda, $rut_jefatura, $id_objeto, $id_curso, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "INSERT INTO tbl_usuario_biografia(
    rut, pareja, emfermedades_importantes, nombre_contacto_emergencia, telefono_contacto_emergencia, estudios, profesion, cantidad_hijos, edad_hijos, sexo_hijos,
    ultima_empresa, cargo_ultima_empresa, tiempo_ultima_empresa, motivacion, que_esperas_jefatura, que_esperas_cargo, metas, capacitacion, talla_camisa,
    talla_pantalon, talla_chaqueta, talla_falda, rut_jefatura, id_objeto, id_curso, id_empresa
    ) VALUES (

    '$rut', '$pareja', '$emfermedades_importantes', '$nombre_contacto_emergencia', '$telefono_contacto_emergencia', '$estudios',
    '$profesion', '$cantidad_hijos', '$edad_hijos', '$sexo_hijos', '$ultima_empresa', '$cargo_ultima_empresa', '$tiempo_ultima_empresa', '$motivacion',
    '$que_esperas_jefatura', '$que_esperas_cargo', '$metas', '$capacitacion', '$talla_camisa', '$talla_pantalon', '$talla_chaqueta', '$talla_falda',
    '$rut_jefatura', '$id_objeto', '$id_curso', '$id_empresa'

    );";
    $database->setquery($sql);
    $database->query();
}
function ActualizaEstadosAccionesPendientes($rut_jefe, $rut_colaborador, $id_empresa, $id_curso, $id_objeto, $estado, $comentario_rechazo)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    if ($comentario_rechazo) {
        $update_comentario = " , comentario_rechazo='$comentario_rechazo' ";
    }
    $sql = "update tbl_lms_acciones_pendientes
    set estado='$estado' $update_comentario


    where rut_jefe='$rut_jefe' and rut_colaborador='$rut_colaborador' and id_empresa='$id_empresa' and id_curso='$id_curso' and id_objeto='$id_objeto'";
    $database->setquery($sql);
    $database->query();
}
function buscaUserBciData($email, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_usuario where email='$email' and id_empresa='$id_empresa'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function UsuarioSeEncuentraEnProcesoEvaluacion($rut, $id_proceso)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_sgd_relaciones where (evaluado='$rut' or evaluador='$rut') and id_proceso='$id_proceso'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TieneAccionesPEndientesSinObjetos($rut, $id_empresa, $id_curso)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select  * from tbl_lms_acciones_pendientes where rut_colaborador='$rut' and id_empresa='$id_empresa' and id_curso='$id_curso'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TieneAccionesPEndientes($rut, $id_empresa, $id_curso, $id_objeto)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select  * from tbl_lms_acciones_pendientes where rut_colaborador='$rut' and id_empresa='$id_empresa' and id_curso='$id_curso' and id_objeto='$id_objeto'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function InsertaAccionPendiente($rut_colaborador, $rut_jefatura, $id_objeto, $id_curso, $id_empresa, $estado, $comentario, $nombre_archivo, $inscripcion_curso, $codigo_inscripcion)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    if ($inscripcion_curso == "1") {
        $sql = "INSERT INTO tbl_lms_acciones_pendientes(
    rut_jefe, rut_colaborador, id_empresa, id_curso, id_objeto, estado, fecha, hora, comentario, nombre_documento, inscripcion_curso, codigo_inscripcion
    ) VALUES (
    '$rut_jefatura',
    '$rut_colaborador',
    '$id_empresa',
    '$id_curso',
    '$id_objeto',
    '$estado',
    '" . date("Y-m-d") . "',
    '" . date("H:i:s") . "',
    '" . $comentario . "',
    '" . $nombre_archivo . "',
    '1',
    '$codigo_inscripcion');";
    } else {
        $sql = "INSERT INTO tbl_lms_acciones_pendientes(
    rut_jefe, rut_colaborador, id_empresa, id_curso, id_objeto, estado, fecha, hora, comentario, nombre_documento
    ) VALUES (
    '$rut_jefatura',
    '$rut_colaborador',
    '$id_empresa',
    '$id_curso',
    '$id_objeto',
    '$estado',
    '" . date("Y-m-d") . "',
    '" . date("H:i:s") . "',
    '" . $comentario . "',
    '" . $nombre_archivo . "');";
    }
    $database->setquery($sql);
    $database->query();
}
function EsJefetblUsuario($rut, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
    select count(id) as cuenta from tbl_usuario where jefe='$rut' and id_empresa='$id_empresa'
    ";
    //echo $sql;
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod[0]->cuenta;
}

function EsJefeLidertblUsuario($rut, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
    select count(id) as cuenta from tbl_usuario where (jefe='$rut' or lider='$rut') and id_empresa='$id_empresa'
    ";
    //echo $sql;
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod[0]->cuenta;
}

function EliminoRespuestasTrivias($rut, $id_objeto)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = sprintf("DELETE from tbl_evaluaciones_sesion WHERE rut= '$rut' and id_objeto='$id_objeto'");
    $database->setquery($sql);
    $database->query();
    $sql = sprintf("DELETE from tbl_evaluaciones_respuestas WHERE rut= '$rut' and id_objeto='$id_objeto'");
    $database->setquery($sql);
    $database->query();
}
function PreguntasEvalDadoIdObjeto($id_objeto)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select tbl_evaluaciones.nombre_evaluacion, tbl_evaluaciones_preguntas.pregunta, tbl_evaluaciones_preguntas.id_grupo_alternativas, tbl_evaluaciones_preguntas.orden as orden_preguntas from tbl_evaluaciones
    inner join tbl_evaluaciones_preguntas
    on tbl_evaluaciones_preguntas.evaluacion=tbl_evaluaciones.id
    where id_objeto='$id_objeto'
    order by orden_preguntas asc
    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function InsertaAlternativaPAraEvalPreguntas($id_grupo_alternativas, $alternativa, $correcta, $orden)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "INSERT INTO tbl_evaluaciones_alternativas(
    id_grupo_alternativas, alternativa, correcta, orden
    ) " . "VALUES (
    '$id_grupo_alternativas', '$alternativa', '$correcta', '$orden'


    );";
    $database->setquery($sql);
    $database->query();
}
function ObtenerUltimoGrupoAlternativa()
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select max(id_grupo_alternativas)as numero_mayor from tbl_evaluaciones_alternativas    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function InsertaPreguntasPorEvaluacion($pregunta, $id_evaluacion, $orden, $id_grupo_alternativas)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "INSERT INTO tbl_evaluaciones_preguntas(
    pregunta, tipo, evaluacion, orden, id_grupo_alternativas
    ) " . "VALUES ('$pregunta', '1', '$id_evaluacion', '$orden', '$id_grupo_alternativas'


    );";
    $database->setquery($sql);
    $database->query();
}
function EvaluacionDadoIdObjeto($id_empresa, $id_curso, $id_objeto)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "

    select * from tbl_evaluaciones where id_empresa='$id_empresa' and id_curso='$id_curso' and id_objeto='$id_objeto'

    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function CreoEvaluacionPorObjeto($id_empresa, $id_curso, $id_objeto)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "INSERT INTO tbl_evaluaciones(
    nombre_evaluacion, id_empresa, id_curso, id_objeto
    ) " . "VALUES ('$id_objeto', '$id_empresa', '$id_curso', '$id_objeto'



    );";
    $database->setquery($sql);
    $database->query();
    $sql = "select max(id) as ultimo_id_evaluacion from tbl_evaluaciones ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    $sql = "update tbl_objeto set id_evaluacion='" . $cod[0]->ultimo_id_evaluacion . "' where id='$id_objeto'";
    $database->setquery($sql);
    $database->query();
    return $cod;
}
function TraigoIdEncuestaDadoIdCurso($id_empresa, $id_curso)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = " select tbl_lms_programas_bbdd.id_enc_sat from rel_lms_malla_curso
left join tbl_lms_programas_bbdd
on tbl_lms_programas_bbdd.id_programa=rel_lms_malla_curso.id_programa


where id_curso='$id_curso' and rel_lms_malla_curso.id_empresa='$id_empresa' ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function InsertoObjetoCheckin($arreglo, $id_empresa, $id_curso, $orden, $id_curso_real)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    if ($id_curso_real) {
        $datos_encuesta = TraigoIdEncuestaDadoIdCurso($id_empresa, $id_curso_real);
        if ($datos_encuesta[0]->id_enc_sat) {
            $id_encuesta = $datos_encuesta[0]->id_enc_sat;
        } else {
            $id_encuesta = $arreglo->id_encuesta;
        }
    } else {
        $id_encuesta = $arreglo->id_encuesta;
    }
    if ($arreglo->tipo_objeto <> "6") {
        $id_encuesta = 0;
    }
    $sql = "INSERT INTO tbl_objeto(
     id,
     tipo_objeto,
     titulo,
     titulo_relator,
     descripcion,
     id_curso,
     extension_objeto,
     id_encuesta,
     orden,
     imagen,
     id_empresa,
     titulo_principal,
     pregunta_principal,
     bajada_principal,
     titulo_secundario,
     bajada_secundario,
     subtitulo_principal,
     bajada_subtitulo_principal,
     opcional,
     checkin,
     url_volver_checkin
     ) " . "VALUES (
     '" . $id_curso . "_" . $arreglo->id . "',
     '" . $arreglo->tipo_objeto . "',
     '" . $arreglo->titulo . "',
     '" . $arreglo->titulo_relator . "',
     '" . $arreglo->descripcion . "',
     '" . $id_curso . "',
     '" . $arreglo->extension_objeto . "',
     '" . $id_encuesta . "',
     '" . $orden . "',
     '" . $arreglo->imagen . "',
     '" . $id_empresa . "',
     '" . $arreglo->titulo_principal . "',
     '" . $arreglo->pregunta_principal . "',
     '" . $arreglo->bajada_principal . "',
     '" . $arreglo->titulo_secundario . "',
     '" . $arreglo->bajada_secundario . "',
     '" . $arreglo->subtitulo_principal . "',
     '" . $arreglo->bajada_subtitulo_principal . "',
     '" . $arreglo->opcional . "',
     '" . $arreglo->checkin . "',
     '" . $arreglo->url_volver_checkin . "'






)    ;";
    $database->setquery($sql);
    $database->query();
}
function CHECK_TraeObjetosPAraIngresar()
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "


     select * from tbl_checkin_objeto


";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function CHECK_ObjetosPorCurso($id_curso)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "


     select * from tbl_objeto where id_curso='$id_curso'


";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function MP_TraigoSubCategoriasDadoCategoria($id_categoria, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "


     select * from tbl_mp_subcategorias where id_empresa='$id_empresa' and id_categoria='$id_categoria'


";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ComentariosPorMallaEmpresaLimit($id_malla, $id_empresa, $limit)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    if ($limit) {
        $lmite = "limit $limit";
    }
    $sql = "
     select
     tbl_objeto_comentarios.*, nombre_completo, tbl_lms_curso.nombre as valor_categoria




     from tbl_objeto_comentarios
     inner join tbl_usuario
     on tbl_usuario.rut=tbl_objeto_comentarios.rut


     inner join tbl_lms_curso
     on tbl_lms_curso.id=tbl_objeto_comentarios.id_curso


     where tbl_objeto_comentarios.id_empresa='$id_empresa' and id_malla='$id_malla'
     order by id desc
     $lmite


     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ComentariosPorMallaEmpresa($id_malla, $id_empresa, $limit)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    if ($limit) {
        $limite = "limit $limit";
    }
    $sql = "
     select
     tbl_objeto_comentarios.*, nombre_completo, tbl_lms_curso.nombre as valor_categoria,
     (select count(*) as total from tbl_objeto_comentarios_megusta where tbl_objeto_comentarios_megusta.id_comentario=tbl_objeto_comentarios.id ) as total_megusta


     from tbl_objeto_comentarios
     inner join tbl_usuario
     on tbl_usuario.rut=tbl_objeto_comentarios.rut


     inner join tbl_lms_curso
     on tbl_lms_curso.id=tbl_objeto_comentarios.id_curso


     where tbl_objeto_comentarios.id_empresa='$id_empresa' and id_malla='$id_malla'
     order by total_megusta desc
     $limite";
    $sql = "
     select
     tbl_objeto_comentarios.*, nombre_completo, tbl_lms_curso.nombre as valor_categoria,
     (select count(*) as total from tbl_objeto_comentarios_megusta where tbl_objeto_comentarios_megusta.id_comentario=tbl_objeto_comentarios.id ) as total_megusta


     from tbl_objeto_comentarios
     inner join tbl_usuario
     on tbl_usuario.rut=tbl_objeto_comentarios.rut


     inner join tbl_lms_curso
     on tbl_lms_curso.id=tbl_objeto_comentarios.id_curso


     where tbl_objeto_comentarios.id_empresa='$id_empresa' and id_malla='$id_malla'
     order by total_megusta desc
     $limite";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function InsertoComentarioPorMallaEmpresa($rut, $comentario, $id_curso, $id_malla, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $existe_comentario = ComentariosPorObjetoDuplicado($id_objeto, $comentario, $rut);
    if (!$existe_comentario) {
        $sql = "INSERT INTO tbl_objeto_comentarios(rut, comentario, fecha, hora, id_malla, id_empresa, id_curso) " . "VALUES ('$rut', '$comentario', '" . date("Y-m-d") . "', '" . date("H:i:s") . "', '$id_malla', '$id_empresa', '$id_curso');";
        $database->setquery($sql);
        $database->query();
    } else {
        echo "<script>
     alert('Comentario ya existe');
     </script>";
    }
}
function ObtenerCursosDadoMalla2($id_malla)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "


     select tbl_lms_curso.nombre, tbl_lms_curso.id from rel_lms_malla_curso
     inner join tbl_lms_curso
     on tbl_lms_curso.id=rel_lms_malla_curso.id_curso
     where rel_lms_malla_curso.id_malla='$id_malla'


";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ObtenerRankigPorAvanceMallaempresa($limit, $id_empresa, $id_malla)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    if ($id_empresa == 52) {
        $sql = "


select tbl_inscripcion_cierre.rut, nombre_completo, cargo, avg(tbl_inscripcion_cierre.avance) as promedio, rel_lms_malla_persona.rut,
     rel_lms_malla_persona.id_malla,
(    select count(id) from tbl_objeto_comentarios where rut=tbl_inscripcion_cierre.rut limit 1) as cuentacomentarios,
     (select sum(medallas) from tbl_gamificado_puntos where rut=tbl_inscripcion_cierre.rut limit 1) as cuentamedallas,
     (select sum(puntos) from tbl_gamificado_puntos where rut=tbl_inscripcion_cierre.rut limit 1) as cuentapuntos,
(
     round(


count(*)*
        (1+avg(tbl_inscripcion_cierre.avance)) * (1 + (select count(id) from tbl_objeto_comentarios where rut=tbl_inscripcion_cierre.rut limit 1)/5) * (1+(select medallas from tbl_gamificado_puntos_consolidado where rut=tbl_inscripcion_cierre.rut limit 1)/5)
        )


        ) as valor


     from tbl_inscripcion_cierre




inner join rel_lms_malla_persona
on rel_lms_malla_persona.rut=tbl_inscripcion_cierre.rut
inner join tbl_usuario
on tbl_usuario.rut=tbl_inscripcion_cierre.rut
where id_malla='$id_malla' and tbl_inscripcion_cierre.id_empresa='$id_empresa'
group BY tbl_inscripcion_cierre.rut
order by


(    select sum(medallas) from tbl_gamificado_puntos where rut=tbl_inscripcion_cierre.rut limit 1) desc,
(    select sum(puntos) from tbl_gamificado_puntos where rut=tbl_inscripcion_cierre.rut limit 1) desc


limit 3";
    } else {
        $sql = "


select tbl_inscripcion_cierre.rut, nombre_completo, cargo, avg(tbl_inscripcion_cierre.avance) as promedio, rel_lms_malla_persona.rut,
     rel_lms_malla_persona.id_malla,








(    select count(id) from tbl_objeto_comentarios where rut=tbl_inscripcion_cierre.rut) as cuentacomentarios,
(    select medallas from tbl_gamificado_puntos_consolidado where rut=tbl_inscripcion_cierre.rut) as cuentamedallas,


(
     round(


count(*)*
     (1+avg(tbl_inscripcion_cierre.avance)) * (1 + (select count(id) from tbl_objeto_comentarios where rut=tbl_inscripcion_cierre.rut)/5) * (1+(select medallas from tbl_gamificado_puntos_consolidado where rut=tbl_inscripcion_cierre.rut)/5)
     )


     ) as valor


     from tbl_inscripcion_cierre




inner join rel_lms_malla_persona
on rel_lms_malla_persona.rut=tbl_inscripcion_cierre.rut
inner join tbl_usuario
on tbl_usuario.rut=tbl_inscripcion_cierre.rut
where id_malla='$id_malla' and tbl_inscripcion_cierre.id_empresa='$id_empresa'
group BY tbl_inscripcion_cierre.rut
order by valor desc
limit $limit";
    }
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ObtenerRankigPorAvanceMallaempresaIndividual($limit, $id_empresa, $id_malla)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "


select h.rut, nombre_completo, cargo, avg(h.avance) as promedio,
rel_lms_malla_persona.rut, rel_lms_malla_persona.id_malla,
(    select sum(puntos) from tbl_gamificado_puntos where rut=h.rut and id_empresa=h.id_empresa and id_malla='$id_malla') as puntos




     from tbl_inscripcion_cierre h


     inner join rel_lms_malla_persona on rel_lms_malla_persona.rut=h.rut
     inner join tbl_usuario on tbl_usuario.rut=h.rut where id_malla='$id_malla'
     and h.id_empresa='$id_empresa'


     GROUP BY h.rut order by puntos desc limit $limit";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function PuntosPersonalesHomeBciRev_data($rut, $id_empresa, $id_malla)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "


select tbl_inscripcion_cierre.rut, nombre_completo, cargo, avg(tbl_inscripcion_cierre.avance) as promedio, rel_lms_malla_persona.rut,
rel_lms_malla_persona.id_malla,
(    select count(id) from tbl_objeto_comentarios where rut=tbl_inscripcion_cierre.rut) as cuentacomentarios,
(    select medallas from tbl_gamificado_puntos_consolidado where rut=tbl_inscripcion_cierre.rut) as cuentamedallas,


(
     round(
count(*)*
     (1+avg(tbl_inscripcion_cierre.avance)) * (1 + (select count(id) from tbl_objeto_comentarios where rut=tbl_inscripcion_cierre.rut)/5) * (1+(select medallas from tbl_gamificado_puntos_consolidado where rut=tbl_inscripcion_cierre.rut)/5)
     )
     ) as valor


from tbl_inscripcion_cierre


inner join rel_lms_malla_persona
on rel_lms_malla_persona.rut=tbl_inscripcion_cierre.rut
inner join tbl_usuario
on tbl_usuario.rut=tbl_inscripcion_cierre.rut
where id_malla='$id_malla' and tbl_inscripcion_cierre.id_empresa='$id_empresa' and tbl_inscripcion_cierre.rut='$rut'


group BY tbl_inscripcion_cierre.rut
order by valor desc";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function MegustaPorComentarioReply($id_comentario)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "


     select * from tbl_objeto_comentarios_reply_megusta
     where id_comentario='$id_comentario'




";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function InsertarMegustaPorComentarioDeObjetoReply($id_comentario, $rut, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "INSERT INTO tbl_objeto_comentarios_reply_megusta(id_comentario, rut, id_empresa, fecha, hora) " . "VALUES ('$id_comentario', '$rut', '$id_empresa', '" . date("Y-m-d") . "', '" . date("H:i:s") . "');";
    $database->setquery($sql);
    $database->query();
}
function MegustaPorComentarioRutReply($id_comentario, $rut)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "


     select * from tbl_objeto_comentarios_reply_megusta
     where id_comentario='$id_comentario' and rut='$rut'




";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ObtenerUltimocomentarioIngresadoPorObjRut($id_objeto, $rut)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select max(id) as ultimo from tbl_objeto_comentarios where id_objeto='$id_objeto' and rut='$rut'
     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function InsertarComentarioPorEnc2($id_empresa, $id_objeto, $rut, $id_encuesta, $comentario, $comentario2, $rut_relator)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "INSERT INTO tbl_enc_satis_comentarios_finales(id_encuesta, id_objeto, id_empresa, rut, comentario, fecha, hora, comentario2, rut_relator) " . "VALUES ('$id_encuesta', '$id_objeto','$id_empresa', '$rut', '$comentario', '" . date("Y-m-d") . "', '" . date("H:i:s") . "', '$comentario2', '$rut_relator');";
    $database->setquery($sql);
    $database->query();
}
function InsertarComentarioPorEnc($id_empresa, $id_objeto, $rut, $id_encuesta, $comentario, $comentario2)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "INSERT INTO tbl_enc_satis_comentarios_finales(id_encuesta, id_objeto, id_empresa, rut, comentario, fecha, hora, comentario2) " . "VALUES ('$id_encuesta', '$id_objeto','$id_empresa', '$rut', '$comentario', '" . date("Y-m-d") . "', '" . date("H:i:s") . "', '$comentario2');";
    $database->setquery($sql);
    $database->query();
}
function VerificoEncuestaFinalizadaConIDObjeto($id_encuesta, $id_empresa, $rut, $id_objeto)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
     select
     *
     from tbl_enc_satis_finalizados
     where rut='$rut'
     and id_encuesta='$id_encuesta'
     and id_empresa='$id_empresa'
     and id_objeto='$id_objeto'
     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ObtenerCompromisosDadoIdObjeto($id_objeto, $id_empresa, $limit)
{
    $datos_empresa = DatosEmpresa($id_empresa);
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    if ($limit == "") {
        $limit = " limit 10";
    } else {
        $limit = " limit $limit";
    }
    $sql = "
     SELECT
     tbl_objeto_compromisos.*, nombre_completo, tbl_usuario.rut,
     (select count(*) as total from tbl_objeto_compromisos_megusta where tbl_objeto_compromisos_megusta.id_compromiso=tbl_objeto_compromisos.id) as total_megusta
from
     tbl_objeto_compromisos
inner join tbl_usuario
on tbl_usuario.rut=tbl_objeto_compromisos.rut
where tbl_objeto_compromisos.id_objeto='$id_objeto'
order by total_megusta DESC, fecha, hora desc $limit
";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function MegustaPorCompromisoRut($id_compromiso, $rut)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "


     select * from tbl_objeto_compromisos_megusta
     where id_compromiso='$id_compromiso' and rut='$rut'




";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function MegustaPorCompromiso($id_compromiso)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "


     select * from tbl_objeto_compromisos_megusta
     where id_compromiso='$id_compromiso'




";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function InsertarMegustaPorCompromisoDeObjeto($id_compromiso, $rut, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "INSERT INTO tbl_objeto_compromisos_megusta(id_compromiso, rut, id_empresa, fecha, hora) " . "VALUES ('$id_compromiso', '$rut', '$id_empresa', '" . date("Y-m-d") . "', '" . date("H:i:s") . "');";
    $database->setquery($sql);
    $database->query();
}
function CompromisosPorObjetosDatos($id_objeto)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select tbl_objeto_compromisos.*, tbl_usuario.nombre_completo
     from tbl_objeto_compromisos
     inner join tbl_usuario
     on tbl_usuario.rut=tbl_objeto_compromisos.rut
     where tbl_objeto_compromisos.id_objeto='$id_objeto'


     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function InsertaCompromisoPorObjetoRut($rut, $id_objeto, $compromiso, $meta, $plan, $id_empresa, $pa1, $pc1, $pa2, $pc2, $pa3, $pc3)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $fecha = date("Y-m-d");
    $hora  = date("H:i:s");
    $sql   = "INSERT INTO tbl_objeto_compromisos(id_objeto, rut, compromiso, meta, plan, fecha, hora, pa1, pc1, pa2, pc2, pa3, pc3) " . "VALUES ('$id_objeto', '$rut', '$compromiso', '$meta', '$plan', '$fecha', '$hora', '$pa1', '$pc1', '$pa2', '$pc2', '$pa3', '$pc3');";
    $database->setquery($sql);
    $database->query();
}
function ReplysPorComentarios($id_comentario)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select tbl_objeto_comentarios_respuestas.*, tbl_usuario.nombre_completo
     from tbl_objeto_comentarios_respuestas
     inner join tbl_usuario
     on tbl_usuario.rut=tbl_objeto_comentarios_respuestas.rut
     where id_comentario='$id_comentario'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function InsertaReplyComentarioPorObjeto($id_empresa, $rut, $comentario, $id_comentario)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $fecha = date("Y-m-d");
    $hora  = date("H:i:s");
    $sql   = "INSERT INTO tbl_objeto_comentarios_respuestas(comentario, rut, id_comentario, id_empresa, fecha, hora) " . "VALUES ('$comentario', '$rut', '$id_comentario', '$id_empresa', '$fecha', '$hora');";
    $database->setquery($sql);
    $database->query();
}
function DatosCursoTodos($id_curso)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_lms_curso where id='$id_curso'";
//    echo $sql;
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function VerificaEstadoPlanesPorProcesoEmpresa($rut, $id_proceso_plan, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
     SELECT * FROM  tbl_planes_estados  WHERE evaluado= '$rut' and id_empresa='$id_empresa' and id_proceso_plan='$id_proceso_plan'
     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TotalMensajerPorObjetoMensajeria($id_objeto)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "    select  * from tbl_mensajes_principal where id_objeto='$id_objeto'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TotalPreguntasDadoIdObjetoEmpresa($id_objeto)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
     select h.*, (select count(id) from tbl_evaluaciones_preguntas where evaluacion=h.id) as cuenta from tbl_evaluaciones h where h.id_objeto='$id_objeto'


";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TotalComentariosDadoIdObjetoEmpresa($id_objeto)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "


     select * from tbl_objeto_comentarios
     where id_objeto='$id_objeto'




";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function VerificoEncuestaFinalizada2($id_encuesta, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "




     select  * from tbl_enc_satis_finalizados where  id_encuesta='$id_encuesta' and id_empresa='$id_empresa'


     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function VerificoEncuestaFinalizadaCheckin($id_encuesta, $id_objeto, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select  * from tbl_enc_satis_finalizados where  id_encuesta='$id_encuesta' and id_objeto='$id_objeto' and id_empresa='$id_empresa' group by rut";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TodasFotosPorObjetoEmpresa($id_objeto, $id_empresa)
{
    $datos_empresa = DatosEmpresa($id_empresa);
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $limit = "";
    $sql   = "select
     tbl_galeria_archivos.*,
     tbl_usuario.nombre_completo
     from tbl_galeria_archivos
     inner join tbl_usuario
     on tbl_usuario.rut=tbl_galeria_archivos.rut_autor
     where tbl_galeria_archivos.id_objeto='$id_objeto'
     and tbl_galeria_archivos.id_empresa='$id_empresa'
     and tbl_galeria_archivos.estado is null
     order by id desc
     $limit
     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ListadoParticipantesDadoCursiEmpresaSinRelator($id_i, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
     select tbl_CI_participantes.* , tbl_usuario.nombre_completo, tbl_usuario.cargo


     from tbl_CI_participantes


     inner join tbl_usuario
     on tbl_usuario.rut=tbl_CI_participantes.rut


     where tbl_CI_participantes.id_empresa='$id_empresa' and
     tbl_CI_participantes.id_curso='$id_curso' and
     tbl_CI_participantes.relator<>'1'
     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ListadoParticipantesDadoInscripcionEmpresaSinRelator($id_inscripcion, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
     select tbl_inscripcion_usuarios.rut, tbl_inscripcion_curso.* , tbl_usuario.nombre_completo, tbl_usuario.cargo from tbl_inscripcion_curso


inner join tbl_inscripcion_usuarios on tbl_inscripcion_curso.codigo_inscripcion=tbl_inscripcion_usuarios.id_inscripcion
inner join tbl_usuario on tbl_usuario.rut=tbl_inscripcion_usuarios.rut
inner join rel_lms_inscripcion_usuario_checkin
on rel_lms_inscripcion_usuario_checkin.rut=tbl_inscripcion_usuarios.rut and rel_lms_inscripcion_usuario_checkin.codigo_imparticion=tbl_inscripcion_usuarios.id_inscripcion and
r    el_lms_inscripcion_usuario_checkin.id_empresa=tbl_inscripcion_usuarios.id_empresa




where tbl_inscripcion_curso.id_empresa='$id_empresa' and tbl_inscripcion_curso.codigo_inscripcion='$id_inscripcion' and tbl_inscripcion_usuarios.relator<>'1'
     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function IdCursoDadoObjeto($id_objeto)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select id_curso  from tbl_objeto
     where id='$id_objeto'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod[0]->id_curso;
}
function ENC_PromedioDeRespuestasPorPregunta($id_empresa, $id_encuesta, $id_pregunta)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select avg(respuesta) as promedio_pregunta  from tbl_enc_satis_respuestas
     where id_empresa='$id_empresa' and id_encuesta='$id_encuesta' and id_pregunta='$id_pregunta'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ENC_CuentaDeRespuestasPorPregunta($id_empresa, $id_encuesta, $id_pregunta, $id_objeto)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select count(h.id) as cuenta,


     (select count(id) from tbl_enc_satis_respuestas where id_empresa='$id_empresa' and id_encuesta='$id_encuesta' and id_objeto='$id_objeto' and id_pregunta='$id_pregunta' and respuesta='1') as cuentarojo,
     (select count(id) from tbl_enc_satis_respuestas where id_empresa='$id_empresa' and id_encuesta='$id_encuesta' and id_objeto='$id_objeto' and id_pregunta='$id_pregunta' and respuesta='3') as cuentaamarillo,
     (select count(id) from tbl_enc_satis_respuestas where id_empresa='$id_empresa' and id_encuesta='$id_encuesta' and id_objeto='$id_objeto' and id_pregunta='$id_pregunta' and respuesta='5') as cuentaverde


     from tbl_enc_satis_respuestas h


     where h.id_empresa='$id_empresa' and h.id_encuesta='$id_encuesta' and h.id_objeto='$id_objeto' and h.id_pregunta='$id_pregunta'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ENC_CuentaDeRespuestasPorPregunta7op($id_empresa, $id_encuesta, $id_pregunta, $id_objeto)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select count(h.id) as cuenta,


     (select count(id) from tbl_enc_satis_respuestas where id_empresa='$id_empresa' and id_encuesta='$id_encuesta' and id_objeto='$id_objeto' and id_pregunta='$id_pregunta' and respuesta='1') as cuenta1,
     (select count(id) from tbl_enc_satis_respuestas where id_empresa='$id_empresa' and id_encuesta='$id_encuesta' and id_objeto='$id_objeto' and id_pregunta='$id_pregunta' and respuesta='2') as cuenta2,
     (select count(id) from tbl_enc_satis_respuestas where id_empresa='$id_empresa' and id_encuesta='$id_encuesta' and id_objeto='$id_objeto' and id_pregunta='$id_pregunta' and respuesta='3') as cuenta3,
     (select count(id) from tbl_enc_satis_respuestas where id_empresa='$id_empresa' and id_encuesta='$id_encuesta' and id_objeto='$id_objeto' and id_pregunta='$id_pregunta' and respuesta='4') as cuenta4,
     (select count(id) from tbl_enc_satis_respuestas where id_empresa='$id_empresa' and id_encuesta='$id_encuesta' and id_objeto='$id_objeto' and id_pregunta='$id_pregunta' and respuesta='5') as cuenta5,
     (select count(id) from tbl_enc_satis_respuestas where id_empresa='$id_empresa' and id_encuesta='$id_encuesta' and id_objeto='$id_objeto' and id_pregunta='$id_pregunta' and respuesta='6') as cuenta6,
     (select count(id) from tbl_enc_satis_respuestas where id_empresa='$id_empresa' and id_encuesta='$id_encuesta' and id_objeto='$id_objeto' and id_pregunta='$id_pregunta' and respuesta='7') as cuenta7,
     (select count(id) from tbl_enc_satis_respuestas where id_empresa='$id_empresa' and id_encuesta='$id_encuesta' and id_objeto='$id_objeto' and id_pregunta='$id_pregunta') as cuentatodas


     from tbl_enc_satis_respuestas h


     where h.id_empresa='$id_empresa' and h.id_encuesta='$id_encuesta' and h.id_objeto='$id_objeto' and h.id_pregunta='$id_pregunta'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ENC_TraigoPreguntaDadaDimenion($id_dimension)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_enc_satis_preg where iddimension='$id_dimension'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ENC_TraigoDimensionesPorEncuesta($id_empresa, $id_encuesta)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_enc_satis_dim where idencuesta='$id_encuesta' and id_empresa='$id_empresa'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ENC_EVI_TraigoDimensionesPorEncuestaPromedioDeRespuestasPorPregunta($id_empresa, $id_encuesta, $id_pregunta)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select avg(respuesta) as promedio_pregunta  from tbl_enc_evidencias_respuestas
     where id_empresa='$id_empresa' and id_encuesta='$id_encuesta' and id_pregunta='$id_pregunta'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ENC_EVI_CuentaDeRespuestasPorPregunta($id_empresa, $id_encuesta, $id_pregunta, $id_objeto)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select count(h.id) as cuenta,


     (select count(id) from tbl_enc_evidencias_respuestas where id_empresa='$id_empresa' and id_encuesta='$id_encuesta' and id_objeto='$id_objeto' and id_pregunta='$id_pregunta' and respuesta='1') as cuentarojo,
     (select count(id) from tbl_enc_evidencias_respuestas where id_empresa='$id_empresa' and id_encuesta='$id_encuesta' and id_objeto='$id_objeto' and id_pregunta='$id_pregunta' and respuesta='3') as cuentaamarillo,
     (select count(id) from tbl_enc_evidencias_respuestas where id_empresa='$id_empresa' and id_encuesta='$id_encuesta' and id_objeto='$id_objeto' and id_pregunta='$id_pregunta' and respuesta='5') as cuentaverde


     from tbl_enc_evidencias_respuestas h


     where h.id_empresa='$id_empresa' and h.id_encuesta='$id_encuesta' and h.id_objeto='$id_objeto' and h.id_pregunta='$id_pregunta'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ENC_EVI_CuentaDeRespuestasPorPregunta7op($id_empresa, $id_encuesta, $id_pregunta, $id_objeto)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select count(h.id) as cuenta,


     (select count(id) from tbl_enc_evidencias_respuestas where id_empresa='$id_empresa' and id_encuesta='$id_encuesta' and id_objeto='$id_objeto' and id_pregunta='$id_pregunta' and respuesta='1') as cuenta1,
     (select count(id) from tbl_enc_evidencias_respuestas where id_empresa='$id_empresa' and id_encuesta='$id_encuesta' and id_objeto='$id_objeto' and id_pregunta='$id_pregunta' and respuesta='2') as cuenta2,
     (select count(id) from tbl_enc_evidencias_respuestas where id_empresa='$id_empresa' and id_encuesta='$id_encuesta' and id_objeto='$id_objeto' and id_pregunta='$id_pregunta') as cuentatodas


     from tbl_enc_evidencias_respuestas h


     where h.id_empresa='$id_empresa' and h.id_encuesta='$id_encuesta' and h.id_objeto='$id_objeto' and h.id_pregunta='$id_pregunta'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ENC_EVI_TraigoPreguntaDadaDimenion($id_dimension)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_enc_evidencias_preg where iddimension='$id_dimension'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ENC_EVI_TraigoDimensionesPorEncuesta($id_empresa, $id_encuesta)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_enc_evidencias_dim where idencuesta='$id_encuesta' and id_empresa='$id_empresa'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ENC_CuentaDeRespuestasPorPregunta_7opciones_Criterio($id_empresa, $id_encuesta, $id_pregunta, $array_objetos, $criterio)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $cuenta_arreglo = count($array_objetos);
    if ($cuenta_arreglo == 1) {
        $id_objeto            = $array_objetos[0]->id;
        $query_arreglo_objeto = " and id_objeto='$id_objeto' ";
    }
    if ($cuenta_arreglo > 1) {
        $query_arreglo_objetoI = " and ( ";
        foreach ($array_objetos as $array_objeto) {
            $query_arreglo_objetoM .= " id_objeto='" . $array_objeto->id . "' OR ";
        }
        $query_arreglo_objetoF = " id<>id) ";
        $query_arreglo_objeto  = $query_arreglo_objetoI . $query_arreglo_objetoM . $query_arreglo_objetoF;
    }
    $sql = "            select count(h.id) as cuenta,


     (select count(id) from tbl_enc_satis_respuestas where id_empresa='$id_empresa' and id_encuesta='$id_encuesta'  $query_arreglo_objeto and id_pregunta='$id_pregunta' and respuesta='1') as cuenta1,
     (select count(id) from tbl_enc_satis_respuestas where id_empresa='$id_empresa' and id_encuesta='$id_encuesta'  $query_arreglo_objeto and id_pregunta='$id_pregunta' and respuesta='2') as cuenta2,
     (select count(id) from tbl_enc_satis_respuestas where id_empresa='$id_empresa' and id_encuesta='$id_encuesta'  $query_arreglo_objeto and id_pregunta='$id_pregunta' and respuesta='3') as cuenta3,
     (select count(id) from tbl_enc_satis_respuestas where id_empresa='$id_empresa' and id_encuesta='$id_encuesta'  $query_arreglo_objeto and id_pregunta='$id_pregunta' and respuesta='4') as cuenta4,
     (select count(id) from tbl_enc_satis_respuestas where id_empresa='$id_empresa' and id_encuesta='$id_encuesta'  $query_arreglo_objeto and id_pregunta='$id_pregunta' and respuesta='5') as cuenta5,
     (select count(id) from tbl_enc_satis_respuestas where id_empresa='$id_empresa' and id_encuesta='$id_encuesta'  $query_arreglo_objeto and id_pregunta='$id_pregunta' and respuesta='6') as cuenta6,
     (select count(id) from tbl_enc_satis_respuestas where id_empresa='$id_empresa' and id_encuesta='$id_encuesta'  $query_arreglo_objeto and id_pregunta='$id_pregunta' and respuesta='7') as cuenta7,
     (select count(id) from tbl_enc_satis_respuestas where id_empresa='$id_empresa' and id_encuesta='$id_encuesta'  $query_arreglo_objeto and id_pregunta='$id_pregunta' ) as cuentaPreg


     from tbl_enc_satis_respuestas h


     where h.id_empresa='$id_empresa'
     and h.id_encuesta='$id_encuesta'
     and h.id_objeto='$id_objeto'
     and h.id_pregunta='$id_pregunta'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ENC_CuentaDeRespuestasPorPregunta_7opciones_Promedio($id_empresa, $id_encuesta, $id_pregunta, $array_objetos, $criterio)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $cuenta_arreglo = count($array_objetos);
    if ($cuenta_arreglo == 1) {
        $id_objeto            = $array_objetos[0]->id;
        $query_arreglo_objeto = " and id_objeto='$id_objeto' ";
    }
    if ($cuenta_arreglo > 1) {
        $query_arreglo_objetoI = " and ( ";
        foreach ($array_objetos as $array_objeto) {
            $query_arreglo_objetoM .= " id_objeto='" . $array_objeto->id . "' OR ";
        }
        $query_arreglo_objetoF = " id<>id) ";
        $query_arreglo_objeto  = $query_arreglo_objetoI . $query_arreglo_objetoM . $query_arreglo_objetoF;
    }
    $sql = "            select count(h.id) as cuenta,


     (select avg(respuesta) as promedio from tbl_enc_satis_respuestas where id_empresa='$id_empresa' and id_encuesta='$id_encuesta'  $query_arreglo_objeto and id_pregunta='$id_pregunta') as promedio


     from tbl_enc_satis_respuestas h


     where h.id_empresa='$id_empresa'
     and h.id_encuesta='$id_encuesta'
     and h.id_objeto='$id_objeto'
     and h.id_pregunta='$id_pregunta'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}

function FotosPorObjetoPorMalla($id_objeto, $id_empresa, $pagina, $id_malla, $cantidad_imagenes_galeria)
{
    $datos_empresa = DatosEmpresa($id_empresa);
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    if ($pagina == "no") {
        $limit = "";
    } else if (!$pagina) {
        $pagina = 1;
        $limit  = " limit 0, $cantidad_imagenes_galeria";
    } else {
        $pagina = $pagina;
        $inicio = ($pagina - 1) * $cantidad_imagenes_galeria;
        $limit  = " limit $inicio, $cantidad_imagenes_galeria";
    }
    $sql = "select
     tbl_galeria_archivos.*,
     tbl_usuario.nombre_completo
     from tbl_galeria_archivos
     inner join tbl_usuario
     on tbl_usuario.rut=tbl_galeria_archivos.rut_autor
     where tbl_galeria_archivos.id_objeto='$id_objeto'
     and tbl_galeria_archivos.id_empresa='$id_empresa'
     and tbl_galeria_archivos.id_malla='$id_malla'
     and tbl_galeria_archivos.estado is null
     order by id desc
     $limit
     ";
    //    echo $sql;
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ObtenerDatosRelMallaUsuarioDadoRut($rut, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "


select
     rel_lms_malla_persona.*, tbl_lms_malla.template
from
     rel_lms_malla_persona
left join tbl_lms_malla
on tbl_lms_malla.id=rel_lms_malla_persona.id_malla
where
     rel_lms_malla_persona.rut = '$rut'
AND rel_lms_malla_persona.id_empresa = '$id_empresa'


";
    $database->setquery($sql);
    $database->query();
    $datos = $database->listObjects();
    return $datos;
}
function Lms_Trae_Comunidades_Objeto_Malla_empresa($id_malla, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
     select * from tbl_lms_comunidad where id_malla='$id_malla' and id_empresa='$id_empresa'";
    $database->setquery($sql);
    $database->query();
    $datos = $database->listObjects();
    return $datos;
}
function allPersonasPorEmpresaDNC($buscar, $id_empresa, $gerencia)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
     SELECT *
     FROM tbl_usuario
     WHERE id_empresa='$id_empresa'
     and (nombre_completo like '%" . $buscar . "%' OR rut like '%" . $buscar . "%')
     and gerencia='$gerencia'
     and  cargo not  like '%Gerente%'
     and  cargo not  like '%Subgerente%'
     and cargo not  like '%Subgrte%'




     ORDER BY nombre_completo";


    $database->setquery($sql);
    $database->query();
    $datos = $database->listObjects();
    return $datos;
}
function ObtenerCriticasPorEvaluado($rut_jefe)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_dnc_sugerencias_por_objetivo where rut_jefe='$rut_jefe'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function EvaluadosDadoEvaluadorConDatosDeEvaluadoSinAePorProceso($evaluador, $id_proceso)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select tbl_sgd_relaciones.evaluado, tbl_usuario.nombre, tbl_usuario.cargo
     from tbl_sgd_relaciones
     inner join tbl_usuario
     on tbl_usuario.rut=tbl_sgd_relaciones.evaluado
     where tbl_sgd_relaciones.evaluador='$evaluador' and tbl_sgd_relaciones.id_proceso='$id_proceso' and tbl_sgd_relaciones.evaluador<>tbl_sgd_relaciones.evaluado
     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function VerificaClaveAccesoSoloEmail($email, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $clave    = utf8_decode($clave);
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_usuario where email='" . mysql_real_escape_string($email) . "' and id_empresa='" . mysql_real_escape_string($id_empresa) . "'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ActualizaEstadoImagen($id_imagen)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "update tbl_galeria_archivos
     set estado=null


where id='$id_imagen'    ";
    $database->setquery($sql);
    $database->query();
}
function ActualizaComentarioCategoriaDiaMamaImagen($id_imagen, $categoria, $comentario)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "update tbl_galeria_archivos
     set comentarios='$comentario', modalidad='$categoria'


where id='$id_imagen'    ";
    $database->setquery($sql);
    $database->query();
}
function ObtenerImagenDadoID($id_imagen)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
     select * from tbl_galeria_archivos where id='$id_imagen'


     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ObtengoUltimoRegistroImagenSubidaPorEmpresa($rut_autor)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
     SELECT MAX(id) AS id FROM tbl_galeria_archivos where rut_autor='$rut_autor' and estado='1'
     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function DNCObtengoObjetivoPorEmpresa($rut, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
     select
     tbl_usuario.rut, tbl_dnc_objetivos_gerencia.objetivo
     from tbl_usuario
     inner join tbl_dnc_objetivos_gerencia
     on tbl_dnc_objetivos_gerencia.gerencia=tbl_usuario.gerencia
     where
     tbl_usuario.rut='$rut' and tbl_usuario.id_empresa='$id_empresa'
     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function GAMIFICACION_NotaPorCursoUsuarioEmpresa($rut, $id_curso, $id_empresa, $id_malla)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "SELECT
     avg(tbl_inscripcion_cierre.nota) as nota_por_curso
from
     tbl_inscripcion_cierre


inner join tbl_lms_curso
on tbl_lms_curso.id=tbl_inscripcion_cierre.id_curso


inner join rel_lms_malla_curso
on rel_lms_malla_curso.id_curso=tbl_lms_curso.id
where
     tbl_inscripcion_cierre.rut = '$rut' and tbl_inscripcion_cierre.id_empresa='$id_empresa' and rel_lms_malla_curso.id_malla='$id_malla' and tbl_inscripcion_cierre.id_curso='$id_curso'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function GAMIFICACION_NotaPorSoloCursoUsuarioEmpresa($rut, $id_curso, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "SELECT
     avg(tbl_inscripcion_cierre.nota) as nota_por_curso
from
     tbl_inscripcion_cierre


inner join tbl_lms_curso
on tbl_lms_curso.id=tbl_inscripcion_cierre.id_curso




where
     tbl_inscripcion_cierre.rut = '$rut' and tbl_inscripcion_cierre.id_empresa='$id_empresa' and tbl_inscripcion_cierre.id_curso='$id_curso'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function GAMIFICACION_NotaPorMallaUsuarioEmpresa($rut, $id_malla, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "SELECT
     avg(tbl_inscripcion_cierre.nota) as nota_por_malla
from
     tbl_inscripcion_cierre


inner join tbl_lms_curso
on tbl_lms_curso.id=tbl_inscripcion_cierre.id_curso


inner join rel_lms_malla_curso
on rel_lms_malla_curso.id_curso=tbl_lms_curso.id
where
     tbl_inscripcion_cierre.rut = '$rut' and tbl_inscripcion_cierre.id_empresa='$id_empresa' and rel_lms_malla_curso.id_malla='$id_malla'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function GAMIFICACION_ActualizaSoloNivel($nivel, $id_empresa, $rut, $id_malla)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "update tbl_gamificado_puntos_consolidado
     set nivel='$nivel'


where rut='$rut' and id_empresa='$id_empresa' and id_malla='$id_malla'    ";
    $database->setquery($sql);
    $database->query();
}
function GAMIFICACION_TraigoNivelDadoOrdenYMalla($id_malla, $orden)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_gamificado_nivel where idmalla='$id_malla' and idorden='$orden'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function GAMIFICACION_ObtengoCursoDadoNivel($id_nivel, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_gamificado_nivel where idnivel='$id_nivel' and idempresa='$id_empresa'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function EliminaImagen($id)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = sprintf("DELETE from tbl_galeria_archivos WHERE id = '$id'");
    $database->setquery($sql);
    $database->query();
}
function InsertaMallaPErsonas($rut, $malla, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "INSERT INTO rel_lms_malla_persona(id_malla, rut, id_empresa) " . "VALUES ('$malla', '$rut', '$id_empresa');";
    $database->setquery($sql);
    $database->query();
}
function ObtengoTipoCorreoPorTipoEmpresa($tipo, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_correos where id_empresa='$id_empresa' and auto_registro='1' ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TraePreguntasDadoObjetoYAleatorias($id_objeto, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select tbl_objeto.preguntas_aleatorias,
(    select count(*) as total from tbl_evaluaciones_preguntas where tbl_evaluaciones_preguntas.evaluacion=tbl_objeto.id_evaluacion) as total
from tbl_objeto


where tbl_objeto.id='$id_objeto' and tbl_objeto.id_empresa='$id_empresa'    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TraeEvaluadosDadoEvaluadorPorProcesoSinAePorProceso($rut, $id_proceso)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
     SELECT
     evaluado AS rut,
     tbl_sgd_relaciones.evaluador,
     tbl_sgd_relaciones.perfil_evaluacion_competencias as perfil_evaluacion,
     id_proceso
from
     tbl_sgd_relaciones
inner JOIN tbl_usuario ON tbl_usuario.rut = evaluado
where
     tbl_sgd_relaciones.evaluador = '$rut'
     and tbl_sgd_relaciones.id_proceso = '$id_proceso'
     and tbl_sgd_relaciones.evaluado<>tbl_sgd_relaciones.evaluador




     order by nombre_completo asc




     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function DistinctCampoUsuario($id_empresa, $campo)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
     select distinct($campo) as valor from tbl_usuario where id_empresa='$id_empresa'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function CompetenciasDadoPerfilPorCompetenciaPorProceso($perfil, $evaluado, $evaluador, $id_competencia, $id_proceso)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
     SELECT
     rel_sgd_perfil_competencias.*,
     tbl_sgd_componente.nombre AS nombre_componente,
     tbl_sgd_componente.descripcion AS descripcion_componente,
     tbl_sgd_componente.id AS id_competencia,
     tbl_sgd_componente.muestra_preguntas_informe,
     tbl_sgd_componente.id_dimension,
     (select avg(puntaje) as nota_competncia
     from tbl_sgd_respuestas
     where tbl_sgd_respuestas.id_competencia=tbl_sgd_componente.id
     and evaluado='$evaluado'
     and evaluador='$evaluador'
     and id_proceso='$id_proceso') as nota_promedio
from
     rel_sgd_perfil_competencias
inner JOIN tbl_sgd_componente ON rel_sgd_perfil_competencias.id_componente = tbl_sgd_componente.id
where
     perfil_evaluacion = '$perfil' and tbl_sgd_componente.id='$id_competencia'
order by tbl_sgd_componente.orden asc
     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function CompetenciasDadoPerfilPorProceso($perfil, $evaluado, $evaluador, $id_proceso)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
     SELECT
     rel_sgd_perfil_competencias.*,
     tbl_sgd_componente.nombre AS nombre_componente,
     tbl_sgd_componente.descripcion AS descripcion_componente,
     tbl_sgd_componente.id AS id_competencia,
     tbl_sgd_componente.muestra_preguntas_informe,
     tbl_sgd_componente.id_dimension,
     tbl_sgd_componente.sigla,




     (select avg(puntaje) as nota_competncia
     from tbl_sgd_respuestas
     where tbl_sgd_respuestas.id_competencia=tbl_sgd_componente.id
     and evaluado='$evaluado'
     and evaluador='$evaluador'
     and id_proceso='$id_proceso') as nota_promedio


from


     rel_sgd_perfil_competencias


inner JOIN tbl_sgd_componente ON rel_sgd_perfil_competencias.id_componente = tbl_sgd_componente.id


where


     perfil_evaluacion = '$perfil'
order by tbl_sgd_componente.orden asc
     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ObtengoCompetenciasDadoPerfilConNombreCompetencia($perfil)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
     select rel_sgd_perfil_competencias.*, tbl_sgd_componente.nombre as nombre_competencia,
     tbl_sgd_componente.id as id_competencia
     from rel_sgd_perfil_competencias
     inner join tbl_sgd_componente
     on tbl_sgd_componente.id=rel_sgd_perfil_competencias.id_componente
     where rel_sgd_perfil_competencias.perfil_evaluacion='$perfil'    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}

function Com_Premios_Detalle($segmento, $idi, $id_empresa){

    //echo "$segmento, $idi, $id_empresa";
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    //$segmento=utf8_encode($segmento);
    //$idi=Decodear3($idi);
    $sql = "select h.*,
    (select foto from tbl_premios_dimension where id_dimension=h.id_dimension limit 1) as foto

    from tbl_premios h where h.id_premio='$idi' and h.id_empresa='$id_empresa' and h.segmento='$segmento'";

    //echo $sql;
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;


}

function EvaluadosDadoEvaluadorParaBitacoraPorProceso($evaluador, $id_proceso)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "SELECT
     tbl_sgd_relaciones.*, tbl_sgd_subperfiles.perfil AS nombre_subperfil, tbl_usuario.perfil_evaluacion
from
     tbl_sgd_relaciones
left JOIN tbl_sgd_subperfiles ON tbl_sgd_subperfiles.id = tbl_sgd_relaciones.subperfil
inner join tbl_usuario
on tbl_usuario.rut=tbl_sgd_relaciones.evaluado
where
     tbl_sgd_relaciones.evaluador = '$evaluador' and tbl_sgd_relaciones.id_proceso='$id_proceso'
order BY
     subperfil,
     tbl_sgd_relaciones.evaluado ASC
     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ObtengoUltimoProcesoEvaluacionDadoEmpresa($id_empresa)
{
    $datos_empresa = DatosEmpresa($id_empresa);
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "SELECT
     tbl_sgd_proceso_evaluacion.*
from
     tbl_sgd_proceso_evaluacion


inner join tbl_sgd_proceso_anual
on tbl_sgd_proceso_evaluacion.id_proceso_anual=tbl_sgd_proceso_anual.id
where
     tbl_sgd_proceso_anual.id_empresa = '$id_empresa'
AND tbl_sgd_proceso_anual.activo = '1'
AND (tbl_sgd_proceso_evaluacion.tipo_proceso='1' or tbl_sgd_proceso_evaluacion.tipo_proceso='2') order by tbl_sgd_proceso_evaluacion.fecha_inicio desc limit 1";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ProcesosEvalPorEmpresaYTipoEvaluacion($id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select tbl_sgd_proceso_evaluacion.*, tbl_sgd_proceso_anual.ano
     from tbl_sgd_proceso_evaluacion
     inner join tbl_sgd_proceso_anual
     on tbl_sgd_proceso_anual.id=tbl_sgd_proceso_evaluacion.id_proceso_anual
     where
     tbl_sgd_proceso_evaluacion.tipo_proceso='1' and
     tbl_sgd_proceso_evaluacion.id_empresa='$id_empresa'
     order by tbl_sgd_proceso_anual.ano desc";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function GAMIFICACIONTotalPuntosPorObjetoDadoRutEmpresa($rut, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "SELECT
     tbl_gamificado_puntos.*, tbl_objeto.titulo, baseautormegusta.nombre_completo as nombre_autor_megusta
from
     tbl_gamificado_puntos


left join tbl_objeto
on tbl_objeto.id=tbl_gamificado_puntos.id_objeto


left join tbl_usuario as baseautormegusta
on baseautormegusta.rut=tbl_gamificado_puntos.rut_autor_megusta


where
     tbl_gamificado_puntos.rut = '$rut'
AND tbl_gamificado_puntos.id_empresa = '$id_empresa'    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function GAMIFICACION_ObtengoMallaNivelDAdoRut($rut, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = sprintf("
     SELECT
     rel_lms_malla_persona.*, tbl_gamificado_puntos_consolidado.nivel, tbl_gamificado_puntos_consolidado.puntos
     FROM
     rel_lms_malla_persona
     INNER JOIN tbl_gamificado_puntos_consolidado ON tbl_gamificado_puntos_consolidado.rut = '$rut'
     AND  tbl_gamificado_puntos_consolidado.id_malla= rel_lms_malla_persona.id_malla
     AND tbl_gamificado_puntos_consolidado.id_empresa = '$id_empresa'
     WHERE
     rel_lms_malla_persona.rut = '$rut'
     AND rel_lms_malla_persona.id_empresa = '$id_empresa'");
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function GAMIFICACIONActualizarSoloPuntosConsolidados($rut, $id_empresa, $puntos_sumar)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "update tbl_gamificado_puntos_consolidado
     set puntos=puntos+($puntos_sumar)


where rut='$rut' and id_empresa='$id_empresa'    ";
    $database->setquery($sql);
    $database->query();
}
function DatosArchivoImagenCruceObjeto($id_imagen)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = sprintf("
     select tbl_galeria_archivos.*, tbl_objeto.puntaje_otros, tbl_objeto.id_curso
     from tbl_galeria_archivos
     inner join tbl_objeto
     on tbl_objeto.id=tbl_galeria_archivos.id_objeto


     where tbl_galeria_archivos.id='$id_imagen'");
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function UsuarioEnBasePersonasConRelacionEvaluadoEvaluadorSoloEvaluador($evaluador, $id_proceso)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
     SELECT
     DISTINCT(
     tbl_sgd_relaciones.perfil_evaluacion_competencias
     )AS perfil_evaluacion,
     rut,
     nombre,
     apaterno,
     amaterno,
     nombre_completo,
     cargo,
     gerencia,
     tbl_usuario.id_empresa,
     id_area,
     tbl_sgd_relaciones.evaluador
from
     tbl_usuario
inner JOIN tbl_sgd_relaciones
on tbl_sgd_relaciones.evaluador = '$evaluador'
AND tbl_sgd_relaciones.id_proceso = '$id_proceso'
where
     rut = '$evaluador'
     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function NotasObjetivosPorDimension($evaluado, $evaluador, $id_proceso)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = sprintf("SELECT
     rut, avg(resultado_transformado) as nota_promediada, tbl_objetivos_individuales.dimension,tbl_objetivos_dimension.nombre, tbl_objetivos_dimension.ponderacion
from
     tbl_objetivos_individuales
inner join tbl_objetivos_dimension
on tbl_objetivos_dimension.id=tbl_objetivos_individuales.dimension
where
     rut = '$evaluado'
AND id_proceso='50'
group BY dimension    ");
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ObjetivosEspecificosConRespuestaEvaluadoEvaluadorProcesoPorDimensionSinTablaRespuesta($evaluado, $evaluador, $id_proceso, $id_dimension)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = sprintf("


select
     tbl_objetivos_dimension.nombre AS nombre_dimension,
     tbl_objetivos_dimension.ponderacion AS ponderacion_dimension,
     tbl_objetivos_individuales.descripcion_objetivo,
     tbl_objetivos_individuales.dimension,
     tbl_objetivos_individuales.ponderacion,
     tbl_objetivos_individuales.nota_descripcion,
     tbl_objetivos_individuales.metrica,
     tbl_objetivos_individuales.resultado_transformado as puntaje


from
     tbl_objetivos_individuales


inner JOIN tbl_objetivos_dimension ON tbl_objetivos_dimension.id = tbl_objetivos_individuales.dimension
where
     tbl_objetivos_individuales.rut= '$evaluado'


AND tbl_objetivos_individuales.id_proceso = '50'
AND tbl_objetivos_individuales.dimension = '$id_dimension'
order BY
     nombre_dimension ASC


     ");
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ObjetivosEspecificosConRespuestaEvaluadoEvaluadorProceso2SinTablaRespuesta($evaluado, $evaluador, $id_proceso)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = sprintf("


     SELECT
     tbl_objetivos_dimension.nombre AS nombre_dimension,
     tbl_objetivos_individuales.descripcion_objetivo,
     tbl_objetivos_individuales.dimension,
     tbl_objetivos_individuales.ponderacion,
     tbl_objetivos_individuales.id as id_objetivo_original,
     tbl_objetivos_individuales.nota_descripcion,
     tbl_objetivos_individuales.nota_ev,
     tbl_objetivos_individuales.metrica,
     tbl_objetivos_individuales.resultado_transformado as puntaje
from
     tbl_objetivos_individuales




inner JOIN tbl_objetivos_dimension
on tbl_objetivos_dimension.id = tbl_objetivos_individuales.dimension


where
t    bl_objetivos_individuales.rut='$evaluado'
AND tbl_objetivos_individuales.resultado_transformado is not null
order BY
     nombre_dimension ASC
     ");
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ObtenerFotosMasMegusta($id_objeto, $id_empresa)
{
    $datos_empresa = DatosEmpresa($id_empresa);
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "SELECT
     tbl_galeria_archivos.*, nombre_completo,
     (
     SELECT
     count(*)AS total
     FROM
     tbl_megusta_registro
     WHERE
     id_imagen_galeria = tbl_galeria_archivos.id
     )AS total_megusta
from
     tbl_galeria_archivos
inner JOIN tbl_usuario ON tbl_usuario.rut = tbl_galeria_archivos.rut_autor
where
     id_objeto = '$id_objeto'
AND tbl_galeria_archivos.id_empresa = '$id_empresa'
AND tbl_galeria_archivos.estado is null
order by total_megusta desc limit 10";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ObtengoDatosProcesoAnualActivo($id_empresa)
{
    $datos_empresa = DatosEmpresa($id_empresa);
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_sgd_proceso_anual where id_empresa='$id_empresa' and activo='1'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function GAMIFICACIONObtengoDatosMallaCursoDadoRutEmpresa($rut, $id_empresa)
{
    $datos_empresa = DatosEmpresa($id_empresa);
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select rel_lms_malla_persona.*, rel_lms_malla_curso.id_curso, tbl_gamificado_nivel.idnivel, tbl_gamificado_niveles_descripcion.nombre as nombre_nivel
from rel_lms_malla_persona


inner join rel_lms_malla_curso
on rel_lms_malla_curso.id_malla=rel_lms_malla_persona.id_malla
left join tbl_gamificado_nivel
on tbl_gamificado_nivel.idcurso=rel_lms_malla_curso.id_curso
inner join tbl_gamificado_niveles_descripcion
on tbl_gamificado_niveles_descripcion.idnivel=tbl_gamificado_nivel.idnivel




where rel_lms_malla_persona.rut='$rut' and rel_lms_malla_persona.id_empresa='$id_empresa'


order by rel_lms_malla_curso.orden_curso asc
";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TienePuntosConsolidadosPorCurso($rut, $id_empresa, $id_curso)
{
    $datos_empresa = DatosEmpresa($id_empresa);
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
select
     sum(
     tbl_gamificado_puntos.puntos
     )AS suma_puntos_por_curso,
     tbl_lms_curso.id as id_curso,
     tbl_lms_curso.nombre as nombre_curso,
     tbl_lms_curso.puntos_maximo
from
     tbl_lms_curso
left JOIN tbl_gamificado_puntos ON tbl_lms_curso.id = tbl_gamificado_puntos.id_curso
AND tbl_gamificado_puntos.rut = '$rut'
AND tbl_gamificado_puntos.id_empresa = '$id_empresa'
where
     tbl_lms_curso.id = '$id_curso'
";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TienePuntosConsolidadosPorMalla($rut, $id_empresa, $id_malla)
{
    $datos_empresa = DatosEmpresa($id_empresa);
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_gamificado_puntos_consolidado where rut='$rut' and id_empresa='$id_empresa' and id_malla='$id_malla'    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TienePuntosConsolidados($rut, $id_empresa)
{
    $datos_empresa = DatosEmpresa($id_empresa);
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_gamificado_puntos_consolidado where rut='$rut' and id_empresa='$id_empresa'    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function FotosPorObjeto($id_objeto, $id_empresa, $pagina, $id_malla)
{
    $datos_empresa = DatosEmpresa($id_empresa);
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    if ($pagina == "no") {
        $limit = "";
    } else if (!$pagina) {
        $pagina = 1;
        $limit  = " limit 0, 18";
    } else {
        $pagina = $pagina;
        $inicio = ($pagina - 1) * 18;
        $limit  = " limit $inicio, 18";
    }
    $sql = "select
     tbl_galeria_archivos.*,
     tbl_usuario.nombre_completo
     from tbl_galeria_archivos
     inner join tbl_usuario
     on tbl_usuario.rut=tbl_galeria_archivos.rut_autor
     where tbl_galeria_archivos.id_objeto='$id_objeto'
     and tbl_galeria_archivos.id_empresa='$id_empresa'
     and tbl_galeria_archivos.estado is null
     and id_malla='$id_malla'
     order by id desc
     $limit
     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function galeria_registra_archivoPorObjeto($nombre_archivo, $id_objeto, $id_empresa, $rut_autor, $estado, $id_malla)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "INSERT INTO tbl_galeria_archivos(archivo,id_objeto,fecha,tipo, id_empresa, rut_autor, id_malla) " . "VALUES ('" . $nombre_archivo . "','" . $id_objeto . "','" . date("Y-m-d") . "','" . $tipo . "', $id_empresa, '$rut_autor', '$id_malla');";
    $database->setquery($sql);
    $database->query();
}
function ObtenerComentariosDadoIdObjeto($id_objeto, $id_empresa, $limit)
{
    $datos_empresa = DatosEmpresa($id_empresa);
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    if ($limit == "") {
        $limit = " limit 10";
    } else {
        $limit = " limit $limit";
    }
    $sql = "
     SELECT
     tbl_objeto_comentarios.*, nombre_completo, tbl_usuario.rut,
     (select count(*) as total from tbl_objeto_comentarios_megusta where tbl_objeto_comentarios_megusta.id_comentario=tbl_objeto_comentarios.id) as total_megusta
from
     tbl_objeto_comentarios
inner join tbl_usuario
on tbl_usuario.rut=tbl_objeto_comentarios.rut
where tbl_objeto_comentarios.id_objeto='$id_objeto'
order by total_megusta DESC, fecha, hora desc $limit
";
    $sql = "
     SELECT
     tbl_objeto_comentarios.*, nombre_completo, tbl_usuario.rut,
     (select count(*) as total from tbl_objeto_comentarios_megusta where tbl_objeto_comentarios_megusta.id_comentario=tbl_objeto_comentarios.id) as total_megusta
from
     tbl_objeto_comentarios
inner join tbl_usuario
on tbl_usuario.rut=tbl_objeto_comentarios.rut
where tbl_objeto_comentarios.id_objeto='$id_objeto'
order by  fecha, hora desc $limit
";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function DatosClasificacionPorCurso($id_clasificacion, $id_empresa)
{
    $datos_empresa = DatosEmpresa($id_empresa);
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
     select tbl_lms_clasificacion.clasificacion as nombre_clasificacion from tbl_lms_clasificacion
     where tbl_lms_clasificacion.id_clasificacion='$id_clasificacion' and id_empresa='$id_empresa'
";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function DatosClasificacionFull($id_clasificacion, $id_empresa)
{
    $datos_empresa = DatosEmpresa($id_empresa);
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
     select *  from tbl_lms_clasificacion
     where id_clasificacion='$id_clasificacion' and id_empresa='$id_empresa'
";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}


function GAMIFICACIONActualizarDatosCierre($id_curso, $rut, $id_empresa, $avance, $estado, $promedio_por_curso, $estado_descripcion,$id_inscripcion)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);

    if($id_inscripcion<>''){

            $sql_busca = " select id from tbl_inscripcion_cierre where rut='$rut' and id_curso='$id_curso' and id_inscripcion='$id_inscripcion' and id_empresa='$id_empresa'";
            $database->setquery($sql_busca);
            $database->query();
            $cod_existe = $database->listObjects();
            if (count($cod_existe) == 0) {
                $sql = "insert into tbl_inscripcion_cierre (avance, estado, nota, rut, id_curso, id_empresa, estado_descripcion, id_inscripcion)
        values ('$avance', '$estado', '$promedio_por_curso','$rut','$id_curso','$id_empresa', '$estado_descripcion', '$id_inscripcion')    ";
            } else {
                $sql = "update tbl_inscripcion_cierre
             set avance='$avance', estado='$estado', nota='$promedio_por_curso', estado_descripcion='$estado_descripcion', id_inscripcion='$id_inscripcion'
             where rut='$rut' and id_curso='$id_curso' and id_empresa='$id_empresa'    ";
            }

            $database->setquery($sql);
            $database->query();

        //echo $sql;

    } else {

            $sql_busca = " select id from tbl_inscripcion_cierre where rut='$rut' and id_curso='$id_curso' and id_empresa='$id_empresa'";
            $database->setquery($sql_busca);
            $database->query();
            $cod_existe = $database->listObjects();
            if (count($cod_existe) == 0) {
                $sql = "insert into tbl_inscripcion_cierre (avance, estado, nota, rut, id_curso, id_empresa, estado_descripcion)
        values ('$avance', '$estado', '$promedio_por_curso','$rut','$id_curso','$id_empresa', '$estado_descripcion')    ";
            } else {
                $sql = "update tbl_inscripcion_cierre
             set avance='$avance', estado='$estado', nota='$promedio_por_curso', estado_descripcion='$estado_descripcion'
             where rut='$rut' and id_curso='$id_curso' and id_empresa='$id_empresa'    ";
            }

            $database->setquery($sql);
            $database->query();

    }




}


function GAMIFICACION_ActualizaNivelVersion3($id_malla, $id_nivel, $id_empresa, $rut)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_nivel_finalizado where id_malla='$id_malla' and id_nivel='$id_nivel' and rut='$rut'";
    $database->setquery($sql);
    $database->query();
    $cod    = $database->listObjects();
    $cuenta = count($cod);
    if ($cuenta > 0) {
    } else {
        $sql = "INSERT INTO tbl_nivel_finalizado (id_malla, id_nivel, rut, fecha, hora)
     VALUES ('$id_malla', '$id_nivel', '$rut', '" . date("Y-m-d") . "', '" . date("H:i:s") . "');";
        $database->setquery($sql);
        $database->query();
    }
    return $cod;
}
function GAMIFICACIONTraeDatosObjetosPorCurso($rut, $id_curso)
{
    $datos_empresa = DatosEmpresa($id_empresa);
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "




     SELECT
     tbl_usuario.nombre_completo,
     (select count(*) as total from tbl_objeto where id_curso='$id_curso') as total_objetos,
     (select count(*) as total from tbl_objetos_finalizados where id_curso='$id_curso' and rut='$rut') as total_objetos_finalizados,
     (select avg(nota) as nota_por_curso from tbl_objetos_finalizados where id_curso='$id_curso' and rut='$rut' and nota>='0') as promedio_por_curso
from
     tbl_usuario
where
     tbl_usuario.rut = '$rut'


";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TienePReguntasFinalesEvaluado($evaluado)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_objetivos_comentarios_evaluado where evaluado='$evaluado'


     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function InsertaComentariosFinalesEvaluado($evaluado, $evaluador, $id_empresa, $id_proceso, $conocimiento_corporativo, $conocimiento_area, $conocimiento_objetivos_individual, $conocimiento_competencias, $tuve_reunion, $comentarios)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "INSERT INTO tbl_objetivos_comentarios_evaluado(
     evaluado,
     evaluador,
     id_proceso,
     id_empresa,
     conocimiento_corporativo,
     conocimiento_area,
     conocimiento_objetivos_individual,
     conocimiento_competencias,
     tuve_reunion,
     comentarios) " . "VALUES
     ('$evaluado',
     '$evaluador',
     '$id_proceso',
     '$id_empresa',
     '$conocimiento_corporativo',
     '$conocimiento_area',
     '$conocimiento_objetivos_individual',
     '$conocimiento_competencias',
     '$tuve_reunion',
     '$comentarios'
     );";
    $database->setquery($sql);
    $database->query();
}
function ActualizoAvatar($rut, $avatar)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "update tbl_usuario
     set avatar='$avatar' where rut='$rut'    ";
    $database->setquery($sql);
    $database->query();
}
function ObtenerDatosAvatar($id_avatar)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_avatar where id='$id_avatar'


     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function GAMIFICACION_AvatarsPorEmpresa($id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_avatar where id_empresa='$id_empresa'


     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function GAMIFICACION_TodosLosConsolidadosPorCampoEmpresa($id_empresa, $nombre_campo)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
select
     sum(tbl_gamificado_puntos_consolidado.puntos) as suma_puntos,
     sum(tbl_gamificado_puntos_consolidado.medallas) as suma_medallas,
     sum(tbl_gamificado_puntos_consolidado.puntosconsolidados) as suma_puntosconsolidados,
     tbl_usuario.$nombre_campo as valor_campo


from
     tbl_gamificado_puntos_consolidado
inner JOIN tbl_usuario ON tbl_usuario.rut = tbl_gamificado_puntos_consolidado.rut
inner join tbl_empresa on tbl_empresa.id=tbl_usuario.id_empresa
where
     tbl_gamificado_puntos_consolidado.id_empresa = '$id_empresa'
     and tbl_usuario.$nombre_campo is not null
group BY tbl_usuario.$nombre_campo
order BY
     suma_puntosconsolidados DESC


     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function MenuNivel0PorEmpresa($id_empresa, $id_tema)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    if ($id_tema) {
        $sql = " select * from tbl_menu_nivel0 where id_empresa='$id_empresa' and id_tema='$id_tema'order by orden asc";
    } else {
        $sql = " select * from tbl_menu_nivel0 where id_empresa='$id_empresa' and (id_tema is null or id_tema='') order by orden asc";
    }
    //echo $sql;
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function OBJETIVOS_InformesDescargadosPorEvaluadorProcesoEmpresaEvaluado($evaluado, $evaluador, $id_proceso, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = " select * from tbl_sgd_descarga_informe where evaluador='$evaluador' and id_proceso='$id_proceso' and id_empresa='$id_empresa' and evaluado='$evaluado'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function OBJETIVOS_InformesDescargadosPorEvaluadorProcesoEmpresa($evaluador, $id_proceso, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = " select * from tbl_sgd_descarga_informe where evaluador='$evaluador' and id_proceso='$id_proceso' and id_empresa='$id_empresa'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function InsertaDescargaInforme($evaluado, $evaluador, $id_proceso, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "INSERT INTO tbl_sgd_descarga_informe(evaluado, evaluador, id_proceso, id_empresa, fecha, hora)
     VALUES ('$evaluado', '$evaluador', '$id_proceso', '$id_empresa',  '" . date("Y-m-d") . "', '" . date("H:i:s") . "');";
    $database->setquery($sql);
    $database->query();
}
function DatosCurso($id_curso)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_lms_curso where id='$id_curso'";
    $sql = "SELECT
     tbl_lms_curso.*, tbl_lms_clasificacion.clasificacion AS nombre_clasificacion, tbl_otec.nombre as nombre_otec, tbl_modalidad_curso.modalidad as nombre_modalidad, tbl_lms_curso_tipo.nombre as nombre_tipo
from
     tbl_lms_curso
left JOIN tbl_lms_clasificacion ON tbl_lms_clasificacion.id = rel_lms_malla_curso.id_clasificacion
left JOIN tbl_otec on tbl_otec.rut=tbl_lms_curso.rut_otec
left JOIN tbl_modalidad_curso on tbl_modalidad_curso.id=tbl_lms_curso.modalidad
left JOIN tbl_lms_curso_tipo on tbl_lms_curso_tipo.id=tbl_lms_curso.tipo
where tbl_lms_curso.id = '$id_curso'


";
    $sql = "SELECT
     tbl_lms_curso.*,


     tbl_otec.nombre as nombre_otec, tbl_modalidad_curso.modalidad as nombre_modalidad, tbl_lms_curso_tipo.nombre as nombre_tipo
from
     tbl_lms_curso


left JOIN tbl_otec on tbl_otec.rut=tbl_lms_curso.rut_otec
left JOIN tbl_modalidad_curso on tbl_modalidad_curso.id=tbl_lms_curso.modalidad
left JOIN tbl_lms_curso_tipo on tbl_lms_curso_tipo.id=tbl_lms_curso.tipo
where tbl_lms_curso.id = '$id_curso'


";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function GAMIFICACION_TodosLosConsolidados($id_empresa, $id_malla)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $datos_empresa = DatosEmpresa($id_empresa);
    if ($id_empresa == 57) {
        $sql = "
select
     tbl_gamificado_puntos_consolidado.*, nombre_completo, cargo,


t    bl_usuario." . $datos_empresa[0]->campo1 . " AS campo1,


     tbl_usuario." . $datos_empresa[0]->campo2 . " AS campo2,
     tbl_usuario." . $datos_empresa[0]->campo3 . " AS campo3




from
     tbl_gamificado_puntos_consolidado
inner JOIN tbl_usuario ON tbl_usuario.rut = tbl_gamificado_puntos_consolidado.rut
inner JOIN rel_lms_malla_persona ON tbl_usuario.rut = rel_lms_malla_persona.rut and rel_lms_malla_persona.id_malla='$id_malla'


where
     tbl_gamificado_puntos_consolidado.id_empresa = '$id_empresa' and area is null
order BY
     puntosconsolidados DESC
     ";
    } else {
        $sql = "
select
     tbl_gamificado_puntos_consolidado.*, nombre_completo, cargo,


t    bl_usuario." . $datos_empresa[0]->campo1 . " AS campo1,


     tbl_usuario." . $datos_empresa[0]->campo2 . " AS campo2,
     tbl_usuario." . $datos_empresa[0]->campo3 . " AS campo3




from
     tbl_gamificado_puntos_consolidado
inner JOIN tbl_usuario ON tbl_usuario.rut = tbl_gamificado_puntos_consolidado.rut
inner JOIN rel_lms_malla_persona ON tbl_usuario.rut = rel_lms_malla_persona.rut and rel_lms_malla_persona.id_malla='$id_malla'


where
     tbl_gamificado_puntos_consolidado.id_empresa = '$id_empresa'
order BY
     puntosconsolidados DESC
     ";
    }
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function GAMIFICACION_descripcionNivelDadoCurso($id_curso)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select tbl_gamificado_niveles_descripcion.*,tbl_gamificado_nivel.idmalla
from tbl_gamificado_niveles_descripcion
inner join tbl_gamificado_nivel
on tbl_gamificado_nivel.idnivel=tbl_gamificado_niveles_descripcion.idnivel
where tbl_gamificado_nivel.idcurso='$id_curso'";


//echo $sql;
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function GAMIFICACION_ObtenerDescripcionNivelesPorIdEmpresa($id_nivel, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "SELECT
     tbl_gamificado_niveles_descripcion.*, tbl_gamificado_nivel.idcurso
from
     tbl_gamificado_niveles_descripcion
left JOIN tbl_gamificado_nivel ON tbl_gamificado_nivel.idnivel = tbl_gamificado_niveles_descripcion.idnivel
where
     tbl_gamificado_niveles_descripcion.idempresa = '$id_empresa'
AND tbl_gamificado_niveles_descripcion.idnivel = '$id_nivel' ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function GAMIFICACION_ObtenerNivelesPorMallaEmpresa($id_malla, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_gamificado_nivel where idmalla='$id_malla' and idempresa='$id_empresa' order by idorden asc";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ConsolidadoActualizaGamificacionConsolidado($rut, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql_sum_puntos = "SELECT
     sum(
     tbl_gamificado_puntos.puntos
     ) AS suma_total,
     (select id_malla from rel_lms_malla_persona where id_empresa='$id_empresa' and rut='$rut') as id_malla,
     tbl_lms_curso.id AS id_curso,
     tbl_lms_curso.nombre AS nombre_curso,
     tbl_lms_curso.puntos_maximo
from
     tbl_lms_curso
left JOIN tbl_gamificado_puntos ON tbl_lms_curso.id = tbl_gamificado_puntos.id_curso
AND tbl_gamificado_puntos.rut = '$rut'
AND tbl_gamificado_puntos.id_empresa = '$id_empresa'";
    $database->setquery($sql_sum_puntos);
    $database->query();
    $cod      = $database->listObjects();
    $puntos   = $cod[0]->suma_total;
    $id_malla = $cod[0]->id_malla;
    $sql      = "update tbl_gamificado_puntos_consolidado set puntos='$puntos', puntosconsolidados='$puntos',
     id_malla='$id_malla' where rut='$rut'  and id_empresa='$id_empresa'";
    $database->setquery($sql);
    $database->query();
}
function GAMIFICACIONActualizarDatosConsolidados($rut, $id_empresa, $puntos, $idnivel, $medallas)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql_sum_puntos = "select sum(puntos) as total_suma_puntos from tbl_gamificado_puntos where rut='$rut'  and id_empresa='$id_empresa'";
    $database->setquery($sql_sum_puntos);
    $database->query();
    $total_suma_puntos = $database->listObjects();
    $sql_sum_medallas  = "select sum(medallas) as total_suma_medallas from tbl_gamificado_puntos where rut='$rut'  and id_empresa='$id_empresa'";
    $database->setquery($sql_sum_medallas);
    $database->query();
    $total_suma_medallas = $database->listObjects();
    $puntos              = $total_suma_puntos[0]->total_suma_puntos;
    $medallas            = $total_suma_medallas[0]->total_suma_medallas;
    if ($idnivel) {
        $datos_nivel       = GAMIFICACION_ObtenerDescripcionNivelesPorIdEmpresa($idnivel, $id_empresa);
        $puntos_ponderados = round($puntos + $medallas * $puntos * $datos_nivel[0]->factor_medalla / 100);
        $curso_finalizado  = $curso_finalizado = VErificaCursoFinalizado($datos_nivel->idcurso, $rut);
        $sql               = "update tbl_gamificado_puntos_consolidado set puntos='$puntos', nivel='$idnivel', medallas='$medallas', puntosconsolidados='$puntos_ponderados' where rut='$rut'  and id_empresa='$id_empresa'";
    } else {
        $datos_nivel       = GAMIFICACION_ObtenerDescripcionNivelesPorIdEmpresa($idnivel, $id_empresa);
        $puntos_ponderados = round($puntos + $medallas * $puntos * $datos_nivel[0]->factor_medalla / 100);
        $sql               = "update tbl_gamificado_puntos_consolidado set puntos='$puntos',  medallas='$medallas', puntosconsolidados='$puntos_ponderados' where rut='$rut'  and id_empresa='$id_empresa'";
    }
    $database->setquery($sql);
    $database->query();
}
function GAMIFICACIONInsertaPuntosAcumulados($rut, $id_empresa, $puntos, $idnivel, $medallas, $id_malla)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql_sum_puntos = "select sum(puntos) as total_suma_puntos from tbl_gamificado_puntos where rut='$rut'  and id_empresa='$id_empresa'";
    $database->setquery($sql_sum_puntos);
    $database->query();
    $total_suma_puntos = $database->listObjects();
    $sql_sum_medallas  = "select sum(medallas) as total_suma_medallas from tbl_gamificado_puntos where rut='$rut'  and id_empresa='$id_empresa'";
    $database->setquery($sql_sum_medallas);
    $database->query();
    $total_suma_medallas = $database->listObjects();
    $puntos              = $total_suma_puntos[0]->total_suma_puntos;
    $medallas            = $total_suma_medallas[0]->total_suma_medallas;
    $sql                 = "INSERT INTO tbl_gamificado_puntos_consolidado(rut, id_empresa, fecha, hora, puntos, nivel, medallas, id_malla)
     VALUES ('$rut', '$id_empresa', '" . date("Y-m-d") . "', '" . date("H:i:s") . "', '$puntos', '$idnivel', '$medallas', '$id_malla');";
    $database->setquery($sql);
    $database->query();
}
function GAMIFICACIONTienePuntosAcumuladosPorRutEmpresa($rut, $id_empresa, $filtro_desde_admin)
{
    $datos_empresa = DatosEmpresa($id_empresa);
    if ($datos_empresa[0]->campo1 == "") {
        $datos_empresa[0]->campo4 = "gerencia";
    }
    if ($datos_empresa[0]->campo2 == "") {
        $datos_empresa[0]->campo4 = "gerencia";
    }
    if ($datos_empresa[0]->campo3 == "") {
        $datos_empresa[0]->campo4 = "gerencia";
    }
    if ($datos_empresa[0]->campo4 == "") {
        $datos_empresa[0]->campo4 = "gerencia";
    }
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $vecurso = $filtro_desde_admin["curso"];
    $vemalla = $filtro_desde_admin["malla"];
    if ($filtro_desde_admin) {
        if ($vecurso <> '0' and $vemalla <> '0') {
            $sql = "
     SELECT
     tbl_gamificado_puntos_consolidado.rut,
     tbl_gamificado_puntos_consolidado.id_empresa,
     tbl_gamificado_puntos_consolidado.fecha,
     tbl_gamificado_puntos_consolidado.puntos,
     (select sum(medallas) as total_medallas from tbl_gamificado_puntos  where tbl_gamificado_puntos.rut='$rut' and id_empresa='$id_empresa' and id_curso='" . $filtro_desde_admin["curso"] . "') as medallas,


     tbl_gamificado_puntos_consolidado.nivel,
     tbl_gamificado_puntos_consolidado.hora,
     tbl_gamificado_puntos_consolidado.id_malla,
     (select sum(puntos) as total_puntos from tbl_gamificado_puntos where tbl_gamificado_puntos.rut='$rut' and id_empresa='$id_empresa' and id_curso='" . $filtro_desde_admin["curso"] . "') as puntosconsolidados,
     tbl_usuario.nombre_completo,
     tbl_usuario.cargo AS cargo_usuario,
     tbl_usuario.email AS email_usuario,


     tbl_usuario.rut_completo AS rut_completo_evaluado,
     tbl_usuario.avatar,
     tbl_usuario." . $datos_empresa[0]->campo1 . " AS campo1,
     tbl_usuario." . $datos_empresa[0]->campo2 . " AS campo2,
     tbl_usuario." . $datos_empresa[0]->campo3 . " AS campo3,
     tbl_usuario." . $datos_empresa[0]->campo4 . " AS campo4,
     tbl_gamificado_niveles_descripcion.nombre AS descripcion_nivel,
     tbl_gamificado_niveles_descripcion.imagensuperado AS nivel_image_superado,
     tbl_gamificado_niveles_descripcion.textosuperado AS nivel_texto_superado,
     tbl_gamificado_niveles_descripcion.textonivel AS nivel_texto_avanza,
     tbl_gamificado_niveles_descripcion.imagencomovoy,
     tbl_gamificado_niveles_descripcion.imagenmiperfil,
     tbl_gamificado_niveles_descripcion.imagenmedalla,
     tbl_gamificado_niveles_descripcion.textoaccion,
     tbl_gamificado_niveles_descripcion.porcentajebarranivel,
     numnivel,
     tbl_gamificado_niveles_descripcion.textodescripcion AS texto_descripcion_nivel,
     tbl_gamificado_nivel.idcurso AS id_curso_actual_dado_nivel,
     (
     SELECT
     count(*)
     FROM
     tbl_objeto
     WHERE
     id_curso = '" . $filtro_desde_admin["curso"] . "'
     )AS total_objetos_por_curso_actual,
     (
     SELECT
     count(*)
     FROM
     tbl_objetos_finalizados
     WHERE
     tbl_objetos_finalizados.rut = '$rut'
     AND tbl_objetos_finalizados.id_curso = '" . $filtro_desde_admin["curso"] . "'
     )AS totalobjetos_finalizados
     ,


     (
     round(100*(
     SELECT
     count(*)
     FROM
     tbl_objetos_finalizados
     WHERE
     tbl_objetos_finalizados.rut = '$rut'
     AND tbl_objetos_finalizados.id_curso = '" . $filtro_desde_admin["curso"] . "'
     )
     /
     (
     SELECT
     count(*)
     FROM
     tbl_objeto
     WHERE
     id_curso = '" . $filtro_desde_admin["curso"] . "'
     ))
     ) as avanceobjetos,






     (
     SELECT
     ((
     round(
     sum(avance) /  (select count(id) as cuentacurso from rel_lms_malla_curso  where rel_lms_malla_curso.id_curso='$vecurso' and opcional is null)
     )/100)
     ) AS promedioavance
     FROM
     tbl_inscripcion_cierre
     INNER JOIN rel_lms_malla_curso ON tbl_inscripcion_cierre.id_curso = rel_lms_malla_curso.id_curso and rel_lms_malla_curso.id_curso='$vecurso'
     and rel_lms_malla_curso.opcional is null


     AND tbl_inscripcion_cierre.rut =  '$rut'


     ) as avancecurso,








     (select count(id) from tbl_gamificado_puntos where rut = '$rut' and id_empresa = '$id_empresa' and id_curso='" . $filtro_desde_admin["curso"] . "') as ingresocurso






     FROM
     tbl_usuario


     LEFT JOIN tbl_gamificado_puntos_consolidado ON tbl_usuario.rut = tbl_gamificado_puntos_consolidado.rut
     and tbl_gamificado_puntos_consolidado.rut = '$rut' AND tbl_gamificado_puntos_consolidado.id_empresa = '$id_empresa'


     LEFT JOIN tbl_gamificado_niveles_descripcion ON tbl_gamificado_niveles_descripcion.idnivel = tbl_gamificado_puntos_consolidado.nivel
     LEFT JOIN tbl_gamificado_nivel ON tbl_gamificado_nivel.idnivel = tbl_gamificado_puntos_consolidado.nivel


     WHERE tbl_usuario.rut='$rut'






     ";
        } elseif ($vecurso == '0' and $vemalla <> '0') {
            $sql = "
     SELECT
     tbl_gamificado_puntos_consolidado.rut,
     tbl_gamificado_puntos_consolidado.id_empresa,
     tbl_gamificado_puntos_consolidado.fecha,
     tbl_gamificado_puntos_consolidado.puntos,
     (select sum(medallas) as total_medallas from tbl_gamificado_puntos_consolidado  where tbl_gamificado_puntos_consolidado.rut='$rut' and id_empresa='$id_empresa' and id_malla='$vemalla') as medallas,


     tbl_gamificado_puntos_consolidado.nivel,
     tbl_gamificado_puntos_consolidado.hora,
     tbl_gamificado_puntos_consolidado.id_malla,
     (select sum(puntos) as total_puntos from tbl_gamificado_puntos_consolidado where tbl_gamificado_puntos_consolidado.rut='$rut' and id_empresa='$id_empresa' and id_malla='$vemalla') as puntosconsolidados,
     tbl_usuario.nombre_completo,
     tbl_usuario.cargo AS cargo_usuario,
     tbl_usuario.email AS email_usuario,


     tbl_usuario.rut_completo AS rut_completo_evaluado,
     tbl_usuario.avatar,
     tbl_usuario." . $datos_empresa[0]->campo1 . " AS campo1,
     tbl_usuario." . $datos_empresa[0]->campo2 . " AS campo2,
     tbl_usuario." . $datos_empresa[0]->campo3 . " AS campo3,
     tbl_usuario." . $datos_empresa[0]->campo4 . " AS campo4,


     tbl_gamificado_niveles_descripcion.nombre AS descripcion_nivel,
     tbl_gamificado_niveles_descripcion.imagensuperado AS nivel_image_superado,
     tbl_gamificado_niveles_descripcion.textosuperado AS nivel_texto_superado,
     tbl_gamificado_niveles_descripcion.textonivel AS nivel_texto_avanza,
     tbl_gamificado_niveles_descripcion.imagencomovoy,
     tbl_gamificado_niveles_descripcion.imagenmiperfil,
     tbl_gamificado_niveles_descripcion.imagenmedalla,
     tbl_gamificado_niveles_descripcion.textoaccion,
     tbl_gamificado_niveles_descripcion.porcentajebarranivel,
     numnivel,
     tbl_gamificado_niveles_descripcion.textodescripcion AS texto_descripcion_nivel,
     tbl_gamificado_nivel.idcurso AS id_curso_actual_dado_nivel,




     (
     SELECT
     ((
     round(
     sum(avance) /  (select count(id) as cuentacurso from rel_lms_malla_curso  where rel_lms_malla_curso.id_malla='$vemalla' and opcional is null and inactivo='0')
     )/100)
     ) AS promedioavance
     FROM
     tbl_inscripcion_cierre
     INNER JOIN rel_lms_malla_curso ON tbl_inscripcion_cierre.id_curso = rel_lms_malla_curso.id_curso and rel_lms_malla_curso.id_malla='$vemalla'
     and rel_lms_malla_curso.opcional is null


     AND tbl_inscripcion_cierre.rut =  '$rut'


     ) as avancecurso,


     (select count(id) from tbl_gamificado_puntos_consolidado where rut = '$rut' and id_empresa = '$id_empresa' and id_malla='$vemalla') as ingresocurso








     FROM
     tbl_usuario
     LEFT JOIN tbl_gamificado_puntos_consolidado ON tbl_usuario.rut = tbl_gamificado_puntos_consolidado.rut
     and tbl_gamificado_puntos_consolidado.rut = '$rut' AND tbl_gamificado_puntos_consolidado.id_empresa = '$id_empresa'


     LEFT JOIN tbl_gamificado_niveles_descripcion ON tbl_gamificado_niveles_descripcion.idnivel = tbl_gamificado_puntos_consolidado.nivel
     LEFT JOIN tbl_gamificado_nivel ON tbl_gamificado_nivel.idnivel = tbl_gamificado_puntos_consolidado.nivel


     WHERE tbl_usuario.rut='$rut'


     ";
        } elseif ($vecurso == '0' and $vemalla == '0') {
            $sql = "
     SELECT
     tbl_gamificado_puntos_consolidado.rut,
     tbl_gamificado_puntos_consolidado.id_empresa,
     tbl_gamificado_puntos_consolidado.fecha,
     tbl_gamificado_puntos_consolidado.puntos,
     (select sum(medallas) as total_medallas from tbl_gamificado_puntos_consolidado  where tbl_gamificado_puntos_consolidado.rut='$rut' and id_empresa='$id_empresa' and id_malla=(select id_malla from rel_lms_malla_persona where rut='$rut' and id_empresa='$id_empresa') ) as medallas,


     tbl_gamificado_puntos_consolidado.nivel,
     tbl_gamificado_puntos_consolidado.hora,
     tbl_gamificado_puntos_consolidado.id_malla,
     (select id_malla from rel_lms_malla_persona where rut='$rut' and id_empresa='$id_empresa') as Usuarioid_malla,
     (select sum(puntos) as total_puntos from tbl_gamificado_puntos_consolidado where tbl_gamificado_puntos_consolidado.rut='$rut' and id_empresa='$id_empresa' and id_malla=(select id_malla from rel_lms_malla_persona where rut='$rut' and id_empresa='$id_empresa') ) as puntosconsolidados,
     tbl_usuario.nombre_completo,


     tbl_usuario.cargo AS cargo_usuario,
     tbl_usuario.email AS email_usuario,


     tbl_usuario.rut_completo AS rut_completo_evaluado,
     tbl_usuario.avatar,
     tbl_usuario." . $datos_empresa[0]->campo1 . " AS campo1,
     tbl_usuario." . $datos_empresa[0]->campo2 . " AS campo2,
     tbl_usuario." . $datos_empresa[0]->campo3 . " AS campo3,
     tbl_usuario." . $datos_empresa[0]->campo3 . " AS campo4,


     tbl_gamificado_niveles_descripcion.nombre AS descripcion_nivel,
     tbl_gamificado_niveles_descripcion.imagensuperado AS nivel_image_superado,
     tbl_gamificado_niveles_descripcion.textosuperado AS nivel_texto_superado,
     tbl_gamificado_niveles_descripcion.textonivel AS nivel_texto_avanza,
     tbl_gamificado_niveles_descripcion.imagencomovoy,
     tbl_gamificado_niveles_descripcion.imagenmiperfil,
     tbl_gamificado_niveles_descripcion.imagenmedalla,
     tbl_gamificado_niveles_descripcion.textoaccion,
     tbl_gamificado_niveles_descripcion.porcentajebarranivel,
     numnivel,
     tbl_gamificado_niveles_descripcion.textodescripcion AS texto_descripcion_nivel,
     tbl_gamificado_nivel.idcurso AS id_curso_actual_dado_nivel,




     (
     SELECT
     ((
     round(
     sum(avance) /  (select count(id) as cuentacurso from rel_lms_malla_curso  where rel_lms_malla_curso.id_malla=(select id_malla from rel_lms_malla_persona where rut='$rut' and id_empresa='$id_empresa')  and opcional is null  and inactivo='0')
     )/100)
     ) AS promedioavance
     FROM
     tbl_inscripcion_cierre
     INNER JOIN rel_lms_malla_curso ON tbl_inscripcion_cierre.id_curso = rel_lms_malla_curso.id_curso and rel_lms_malla_curso.id_malla=(select id_malla from rel_lms_malla_persona where rut='$rut' and id_empresa='$id_empresa')
     and rel_lms_malla_curso.opcional is null


     AND tbl_inscripcion_cierre.rut =  '$rut'


     ) as avancecurso,


     (select count(id) from tbl_gamificado_puntos_consolidado where rut = '$rut' and id_empresa = '$id_empresa' and id_malla=(select id_malla from rel_lms_malla_persona where rut='$rut' and id_empresa='$id_empresa') ) as ingresocurso








     FROM
     tbl_usuario
     LEFT JOIN tbl_gamificado_puntos_consolidado ON tbl_usuario.rut = tbl_gamificado_puntos_consolidado.rut
     and tbl_gamificado_puntos_consolidado.rut = '$rut' AND tbl_gamificado_puntos_consolidado.id_empresa = '$id_empresa'


     LEFT JOIN tbl_gamificado_niveles_descripcion ON tbl_gamificado_niveles_descripcion.idnivel = tbl_gamificado_puntos_consolidado.nivel
     LEFT JOIN tbl_gamificado_nivel ON tbl_gamificado_nivel.idnivel = tbl_gamificado_puntos_consolidado.nivel


     WHERE tbl_usuario.rut='$rut'


     ";
        } elseif ($vecurso <> '0' and $vemalla == '0') {
            $sql = "
     SELECT
     tbl_gamificado_puntos_consolidado.rut,
     tbl_gamificado_puntos_consolidado.id_empresa,
     tbl_gamificado_puntos_consolidado.fecha,
     tbl_gamificado_puntos_consolidado.puntos,
     (select sum(medallas) as total_medallas from tbl_gamificado_puntos  where tbl_gamificado_puntos.rut='$rut' and id_empresa='$id_empresa' and id_curso='" . $filtro_desde_admin["curso"] . "') as medallas,


     tbl_gamificado_puntos_consolidado.nivel,
     tbl_gamificado_puntos_consolidado.hora,
     tbl_gamificado_puntos_consolidado.id_malla,
     (select sum(puntos) as total_puntos from tbl_gamificado_puntos where tbl_gamificado_puntos.rut='$rut' and id_empresa='$id_empresa' and id_curso='" . $filtro_desde_admin["curso"] . "') as puntosconsolidados,
     tbl_usuario.nombre_completo,
     tbl_usuario.cargo AS cargo_usuario,
     tbl_usuario.email AS email_usuario,


     tbl_usuario.rut_completo AS rut_completo_evaluado,
     tbl_usuario.avatar,
     tbl_usuario." . $datos_empresa[0]->campo1 . " AS campo1,
     tbl_usuario." . $datos_empresa[0]->campo2 . " AS campo2,
     tbl_usuario." . $datos_empresa[0]->campo3 . " AS campo3,
     tbl_usuario." . $datos_empresa[0]->campo4 . " AS campo4,
     tbl_gamificado_niveles_descripcion.nombre AS descripcion_nivel,
     tbl_gamificado_niveles_descripcion.imagensuperado AS nivel_image_superado,
     tbl_gamificado_niveles_descripcion.textosuperado AS nivel_texto_superado,
     tbl_gamificado_niveles_descripcion.textonivel AS nivel_texto_avanza,
     tbl_gamificado_niveles_descripcion.imagencomovoy,
     tbl_gamificado_niveles_descripcion.imagenmiperfil,
     tbl_gamificado_niveles_descripcion.imagenmedalla,
     tbl_gamificado_niveles_descripcion.textoaccion,
     tbl_gamificado_niveles_descripcion.porcentajebarranivel,
     numnivel,
     tbl_gamificado_niveles_descripcion.textodescripcion AS texto_descripcion_nivel,
     tbl_gamificado_nivel.idcurso AS id_curso_actual_dado_nivel,
     (
     SELECT
     count(*)
     FROM
     tbl_objeto
     WHERE
     id_curso = '" . $filtro_desde_admin["curso"] . "'
     )AS total_objetos_por_curso_actual,
     (
     SELECT
     count(*)
     FROM
     tbl_objetos_finalizados
     WHERE
     tbl_objetos_finalizados.rut = '$rut'
     AND tbl_objetos_finalizados.id_curso = '" . $filtro_desde_admin["curso"] . "'
     )AS totalobjetos_finalizados
     ,


     (
     round(100*(
     SELECT
     count(*)
     FROM
     tbl_objetos_finalizados
     WHERE
     tbl_objetos_finalizados.rut = '$rut'
     AND tbl_objetos_finalizados.id_curso = '" . $filtro_desde_admin["curso"] . "'
     )
     /
     (
     SELECT
     count(*)
     FROM
     tbl_objeto
     WHERE
     id_curso = '" . $filtro_desde_admin["curso"] . "'
     ))
     ) as avanceobjetos,






     (
     SELECT
     ((
     round(
     sum(avance) /  (select count(id) as cuentacurso from rel_lms_malla_curso  where rel_lms_malla_curso.id_curso='$vecurso' and opcional is null)
     )/100)
     ) AS promedioavance
     FROM
     tbl_inscripcion_cierre
     INNER JOIN rel_lms_malla_curso ON tbl_inscripcion_cierre.id_curso = rel_lms_malla_curso.id_curso and rel_lms_malla_curso.id_curso='$vecurso'
     and rel_lms_malla_curso.opcional is null


     AND tbl_inscripcion_cierre.rut =  '$rut'


     ) as avancecurso,








     (select count(id) from tbl_gamificado_puntos where rut = '$rut' and id_empresa = '$id_empresa' and id_curso='" . $filtro_desde_admin["curso"] . "') as ingresocurso






     FROM
     tbl_usuario


     LEFT JOIN tbl_gamificado_puntos_consolidado ON tbl_usuario.rut = tbl_gamificado_puntos_consolidado.rut
     and tbl_gamificado_puntos_consolidado.rut = '$rut' AND tbl_gamificado_puntos_consolidado.id_empresa = '$id_empresa'


     LEFT JOIN tbl_gamificado_niveles_descripcion ON tbl_gamificado_niveles_descripcion.idnivel = tbl_gamificado_puntos_consolidado.nivel
     LEFT JOIN tbl_gamificado_nivel ON tbl_gamificado_nivel.idnivel = tbl_gamificado_puntos_consolidado.nivel


     WHERE tbl_usuario.rut='$rut'






     ";
        }
    } else {
        $sql = "
     SELECT
     tbl_gamificado_puntos_consolidado.*
     , tbl_usuario.nombre_completo,
     tbl_usuario.cargo AS cargo_usuario,
     tbl_usuario.rut_completo AS rut_completo_evaluado,
     tbl_usuario.avatar,
     tbl_usuario." . $datos_empresa[0]->campo1 . " AS campo1,
     tbl_usuario." . $datos_empresa[0]->campo2 . " AS campo2,
     tbl_usuario." . $datos_empresa[0]->campo3 . " AS campo3,
     tbl_usuario." . $datos_empresa[0]->campo4 . " AS campo4,
     tbl_usuario.email AS email_usuario,




     tbl_gamificado_niveles_descripcion.nombre AS descripcion_nivel,
     tbl_gamificado_niveles_descripcion.imagensuperado AS nivel_image_superado,
     tbl_gamificado_niveles_descripcion.textosuperado AS nivel_texto_superado,
     tbl_gamificado_niveles_descripcion.textonivel AS nivel_texto_avanza,
     tbl_gamificado_niveles_descripcion.imagencomovoy,
     tbl_gamificado_niveles_descripcion.imagenmiperfil,
     tbl_gamificado_niveles_descripcion.imagenmedalla,
     tbl_gamificado_niveles_descripcion.textoaccion,
     tbl_gamificado_niveles_descripcion.porcentajebarranivel,
     numnivel,
     tbl_gamificado_niveles_descripcion.textodescripcion AS texto_descripcion_nivel,
     tbl_gamificado_nivel.idcurso AS id_curso_actual_dado_nivel,
     (
     SELECT
     count(*)
     FROM
     tbl_objeto
     WHERE
     id_curso = tbl_gamificado_nivel.idcurso
     )AS total_objetos_por_curso_actual,
     (
     SELECT
     count(*)
     FROM
     tbl_objetos_finalizados
     WHERE
     tbl_objetos_finalizados.rut = '$rut'
     AND tbl_objetos_finalizados.id_curso = tbl_gamificado_nivel.idcurso
     )AS totalobjetos_finalizados


     ,


(
     round(100*(
     SELECT
     count(*)
     FROM
     tbl_objetos_finalizados
     WHERE
     tbl_objetos_finalizados.rut = '$rut'
     AND tbl_objetos_finalizados.id_curso = tbl_gamificado_nivel.idcurso
     )
/
     (
     SELECT
     count(*)
     FROM
     tbl_objeto
     WHERE
     id_curso = tbl_gamificado_nivel.idcurso
     ))
)    as avanceobjetos


from
     tbl_usuario
left JOIN tbl_gamificado_puntos_consolidado ON tbl_usuario.rut = tbl_gamificado_puntos_consolidado.rut
AND tbl_gamificado_puntos_consolidado.rut = '$rut' AND tbl_gamificado_puntos_consolidado.id_empresa = '$id_empresa'


left JOIN tbl_gamificado_niveles_descripcion ON tbl_gamificado_niveles_descripcion.idnivel = tbl_gamificado_puntos_consolidado.nivel
left JOIN tbl_gamificado_nivel ON tbl_gamificado_nivel.idnivel = tbl_gamificado_puntos_consolidado.nivel


     WHERE tbl_usuario.rut='$rut'


";
    }
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function GAMIFICACIONInsertaPuntosPorObjeto($rut, $id_objeto, $id_curso, $id_empresa, $puntos, $medallas, $rut_autor_megusta, $id_objeto_megusta, $tipo_objeto_megusta, $id_malla)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);

    $sql = "select count(id) as cuenta from tbl_gamificado_puntos where rut='$rut' and id_objeto='$id_objeto' and id_curso='$id_curso' and id_empresa='$id_empresa'    ";
   // echo "<br>GAMIFICACIONInsertaPuntosPorObjeto"; sleep(1);
  //  echo "<br>$sql";

    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();

    //print_r($cod);
         if($cod[0]->cuenta>0){
    $sql = "UPDATE tbl_gamificado_puntos SET puntos='$puntos', medallas='$medallas'   where rut='$rut' and id_objeto='$id_objeto' and id_curso='$id_curso' and id_empresa='$id_empresa'";
    $database->setquery($sql);
    $database->query();
         }   else {

    $sql = "INSERT INTO tbl_gamificado_puntos(rut, id_objeto, id_curso, id_malla, id_empresa, fecha, hora, puntos, medallas, rut_autor_megusta, id_objeto_megusta, tipo_objeto_megusta) " .
     "VALUES ('$rut', '$id_objeto', '$id_curso', '$id_malla', '$id_empresa', '" . date("Y-m-d") . "', '" . date("H:i:s") . "', '$puntos', '$medallas', '$rut_autor_megusta', '$id_objeto_megusta', '$tipo_objeto_megusta');";
    $database->setquery($sql);
    $database->query();
    }
//echo $sql; sleep(1);

}
function GAMIFICACIONTienePuntosPorCursoObjetoRutEmpresa($rut, $id_objeto, $id_curso, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_gamificado_puntos where rut='$rut' and id_objeto='$id_objeto' and id_curso='$id_curso' and id_empresa='$id_empresa'    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TraeConductasDadaIdCompetencia($id_competencia, $id_perfil_competencia)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_sgd_componente_conducta where id_componente='$id_competencia' and id_perfil='$id_perfil_competencia'    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function VerificaActualizaDatosCierre($id_curso, $rut, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select id from  tbl_inscripcion_cierre
     where
     rut='$rut' and id_curso='$id_curso' and id_empresa='$id_empresa'    ";
    $database->setquery($sql);
    $database->query();
}
function CAPACITACIONActualizarDatosCierre($id_curso, $rut, $id_empresa, $tiempo)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "update tbl_inscripcion_cierre
     set navegacionminutos='$tiempo'


where rut='$rut' and id_curso='$id_curso' and id_empresa='$id_empresa'    ";

//echo "CAPACITACIONActualizarDatosCierre<br>$sql";
    $database->setquery($sql);
    $database->query();
}
function InsertarInsripcionCierre($rut, $id_curso, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "INSERT INTO tbl_inscripcion_cierre(rut, id_curso, id_empresa, estado, avance, navegacionminutos) " . "VALUES ('$rut', '$id_curso', '$id_empresa', '3', '5', '0');";
    $database->setquery($sql);
    $database->query();
}
function TieneInscripcionCierreDadoRutYCursoEmpresa($rut, $id_curso, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
     select * from tbl_inscripcion_cierre where rut='$rut' and id_curso='$id_curso' and id_empresa='$id_empresa'
     ";
     //echo "<BR>rod TieneInscripcionCierreDadoRutYCursoEmpresa ".$sql;
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}


function TieneInscripcionCierreDadoRutYCursoEmpresaInscripcion($rut, $id_curso, $id_inscripcion, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
     select * from tbl_inscripcion_cierre where rut='$rut' and id_curso='$id_curso' and id_inscripcion='$id_inscripcion' and id_empresa='$id_empresa'
     ";
     //echo $sql;

    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}

function InsertaComentariosFinalesSGD($evaluado, $evaluador, $id_proceso, $comentario, $id_empresa, $sucesor)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "INSERT INTO tbl_sgd_comentarios_finales(evaluado, evaluador, id_proceso, comentario, fecha, hora, id_empresa, sucesor) " . "VALUES ('$evaluado','$evaluador', '$id_proceso', '$comentario', '" . date("Y-m-d") . "', '" . date("H:i:s") . "', '$id_empresa', '$sucesor');";
    $database->setquery($sql);
    $database->query();
}
function TieneComentariosFinalesSGD($evaluado, $evaluador, $id_proceso)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
     select * from tbl_sgd_comentarios_finales where evaluado='$evaluado' and evaluador='$evaluador' and id_proceso='$id_proceso'
     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TraeEvaluadosDadoEvaluadorPorProceso2SinAeSoloProceso($id_proceso, $arreglo_post)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sqlBK = "
     SELECT
     evaluado AS rut,
     tbl_sgd_relaciones.evaluador, perfil_evaluacion, id_proceso
from
     tbl_sgd_relaciones
inner JOIN tbl_usuario ON tbl_usuario.rut = evaluado
where
     tbl_sgd_relaciones.id_proceso='$id_proceso' and tbl_sgd_relaciones.evaluado<>tbl_sgd_relaciones.evaluador
     order by subperfil, nombre_completo asc
     ";
    if ($arreglo_post["filtro2"]) {
        if ($arreglo_post["filtro1"] == '-' or $arreglo_post["filtro2"] == '-') {
            $filtro1_2 = "";
        } else {
            $filtro1_2 = " and tbl_usuario." . $arreglo_post["filtro1"] . "='" . $arreglo_post["filtro2"] . "'";
        }
    }
    $sql = "
     SELECT
     evaluado AS rut,
     tbl_sgd_relaciones.evaluador, perfil_evaluacion, id_proceso
from
     tbl_sgd_relaciones
inner JOIN tbl_usuario ON tbl_usuario.rut = evaluado
where
     tbl_sgd_relaciones.id_proceso='$id_proceso' and tbl_sgd_relaciones.evaluado<>tbl_sgd_relaciones.evaluador
     $filtro1_2


     order by subperfil, nombre_completo asc
     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TraigoRespuestasCrucePreguntasPorRangosMenorYMayorSoloPorProcesoSinAe($id_proceso, $rango_menor, $rango_mayor, $arreglo_post)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sqlBK = "
     select tbl_sgd_respuestas.*
     from tbl_sgd_respuestas
     inner join tbl_sgd_preguntas
     on tbl_sgd_preguntas.id=tbl_sgd_respuestas.id_pregunta
     where
     tbl_sgd_respuestas.id_proceso='$id_proceso'
     and (tbl_sgd_respuestas.puntaje>=$rango_menor and tbl_sgd_respuestas.puntaje<=$rango_mayor)
     and tbl_sgd_respuestas.evaluado<>tbl_sgd_respuestas.evaluador
     ";
    if ($arreglo_post["filtro2"]) {
        if ($arreglo_post["filtro1"] == '-' or $arreglo_post["filtro2"] == '-') {
        } else {
            $filtro1_2 = " and tbl_usuario." . $arreglo_post["filtro1"] . "='" . $arreglo_post["filtro2"] . "'";
        }
    }
    if ($arreglo_post["tipo_reporte"] == "individuales") {
        $sql = "
     select tbl_sgd_respuestas.*
     from tbl_sgd_respuestas
     inner join tbl_objetivos_individuales
     on tbl_objetivos_individuales.id=tbl_sgd_respuestas.id_objetivo


     inner join tbl_usuario
     on tbl_usuario.rut=tbl_sgd_respuestas.evaluado


     where
     tbl_sgd_respuestas.id_proceso='$id_proceso'
     and (tbl_sgd_respuestas.puntaje>=$rango_menor and tbl_sgd_respuestas.puntaje<=$rango_mayor)
     and tbl_sgd_respuestas.evaluado<>tbl_sgd_respuestas.evaluador


     $filtro1_2
     ";
    } else {
        $sql = "
     select tbl_sgd_respuestas.*
     from tbl_sgd_respuestas
     inner join tbl_sgd_preguntas
     on tbl_sgd_preguntas.id=tbl_sgd_respuestas.id_pregunta


     inner join tbl_usuario
     on tbl_usuario.rut=tbl_sgd_respuestas.evaluado


     where
     tbl_sgd_respuestas.id_proceso='$id_proceso'
     and (tbl_sgd_respuestas.puntaje>=$rango_menor and tbl_sgd_respuestas.puntaje<=$rango_mayor)
     and tbl_sgd_respuestas.evaluado<>tbl_sgd_respuestas.evaluador


     $filtro1_2
     ";
    }
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TraigoRespuestasCrucePreguntasPorRangosMenorYMayorSoloPorProceso($id_proceso, $rango_menor, $rango_mayor)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
     select tbl_sgd_respuestas.*
     from tbl_sgd_respuestas
     inner join tbl_sgd_preguntas
     on tbl_sgd_preguntas.id=tbl_sgd_respuestas.id_pregunta
     where  id_proceso='$id_proceso' and (puntaje>=$rango_menor and puntaje<=$rango_mayor)
     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TraigoRespuestasCrucePreguntasSoloPorProcesoSinAe($id_proceso, $filtro1, $filtro2, $arreglo_post)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    if ($filtro2) {
        if ($filtro1 == '-' or $filtro2 == '-') {
            $filtro1_2 = "";
        } else {
            $filtro1_2 = " and tbl_usuario.$filtro1='$filtro2'";
        }
    }
    $sqlBK = "
     select tbl_sgd_respuestas.*
     from tbl_sgd_respuestas
     inner join tbl_sgd_preguntas
     on tbl_sgd_preguntas.id=tbl_sgd_respuestas.id_pregunta
     where id_proceso='$id_proceso' and tbl_sgd_respuestas.evaluado<>tbl_sgd_respuestas.evaluador
     ";
    if ($arreglo_post["tipo_reporte"] == "individuales") {
        $sql = "
     select tbl_sgd_respuestas.*
     from tbl_sgd_respuestas
     inner join tbl_objetivos_individuales
     on tbl_objetivos_individuales.id=tbl_sgd_respuestas.id_objetivo


     inner join tbl_usuario
     on tbl_usuario.rut=tbl_sgd_respuestas.evaluado


     where tbl_sgd_respuestas.id_proceso='$id_proceso'
     and tbl_sgd_respuestas.evaluado<>tbl_sgd_respuestas.evaluador
     $filtro1_2
     ";
    } else {
        $sql = "
     select tbl_sgd_respuestas.*
     from tbl_sgd_respuestas
     inner join tbl_sgd_preguntas
     on tbl_sgd_preguntas.id=tbl_sgd_respuestas.id_pregunta


     inner join tbl_usuario
     on tbl_usuario.rut=tbl_sgd_respuestas.evaluado


     where tbl_sgd_respuestas.id_proceso='$id_proceso'
     and tbl_sgd_respuestas.evaluado<>tbl_sgd_respuestas.evaluador
     $filtro1_2
     ";
    }
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TraigoRespuestasCrucePreguntasSoloPorProceso($id_proceso)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
     select tbl_sgd_respuestas.*
     from tbl_sgd_respuestas
     inner join tbl_sgd_preguntas
     on tbl_sgd_preguntas.id=tbl_sgd_respuestas.id_pregunta
     where id_proceso='$id_proceso'
     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TraeRelacionesSoloProcesoParaGrafico($id_proceso, $arreglo_post)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sqlBK = "
     select tbl_sgd_relaciones.*
     from tbl_sgd_relaciones where tbl_sgd_relaciones.id_proceso='$id_proceso' and tbl_sgd_relaciones.evaluado<>tbl_sgd_relaciones.evaluador    ";
    if ($arreglo_post["filtro2"]) {
        if ($arreglo_post["filtro1"] == '-' or $arreglo_post["filtro2"] == '-') {
            $filtro1_2 = "";
        } else {
            $filtro1_2 = " and tbl_usuario." . $arreglo_post["filtro1"] . "='" . $arreglo_post["filtro2"] . "'";
        }
    }
    $sql = "
     select tbl_sgd_relaciones.*
     from tbl_sgd_relaciones


     inner join tbl_usuario
     on tbl_usuario.rut=tbl_sgd_relaciones.evaluado


     where


     tbl_sgd_relaciones.id_proceso='$id_proceso'
     and tbl_sgd_relaciones.evaluado<>tbl_sgd_relaciones.evaluador


     $filtro1_2


     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TotalPerfilesDadoEvaluador1SoloProceso($id_proceso, $arreglo_post)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sqlBK = "select distinct(tbl_usuario.perfil_evaluacion) as id_perfil_ev
     from tbl_sgd_relaciones
     inner join tbl_usuario
     on tbl_usuario.rut=tbl_sgd_relaciones.evaluado
     where tbl_sgd_relaciones.id_proceso='$id_proceso'
     ";
    if ($arreglo_post["filtro2"]) {
        if ($arreglo_post["filtro1"] == '-' or $arreglo_post["filtro2"] == '-') {
            $filtro1_2 = "";
        } else {
            $filtro1_2 = " and tbl_usuario." . $arreglo_post["filtro1"] . "='" . $arreglo_post["filtro2"] . "'";
        }
    }
    $sqlBKSGD = "select distinct(tbl_usuario.perfil_evaluacion) as id_perfil_ev
     from tbl_sgd_relaciones
     inner join tbl_usuario
     on tbl_usuario.rut=tbl_sgd_relaciones.evaluado
     where tbl_sgd_relaciones.id_proceso='$id_proceso'
     $filtro1_2
     ";
    $sql      = "select distinct(tbl_sgd_relaciones.perfil_evaluacion_competencias) as id_perfil_ev
     from tbl_sgd_relaciones




     where tbl_sgd_relaciones.id_proceso='$id_proceso' and tbl_sgd_relaciones.perfil_evaluacion_competencias is not null
     $filtro1_2
     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TraeRelacionesSoloProceso($id_proceso)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "


select
     tbl_sgd_relaciones.*, tbl_sgd_subperfiles.muestra_graficos
from
     tbl_sgd_relaciones
inner join tbl_sgd_subperfiles
on tbl_sgd_subperfiles.id=tbl_sgd_relaciones.subperfil
where
     id_proceso = '$id_proceso'




     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TraeRelacionesSoloProcesosinAe($id_proceso, $arreglo_post)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sqlBK = "SELECT
     tbl_sgd_relaciones.*, tbl_sgd_subperfiles.muestra_graficos
from
     tbl_sgd_relaciones
inner join tbl_sgd_subperfiles
on tbl_sgd_subperfiles.id=tbl_sgd_relaciones.subperfil
where
     id_proceso = '$id_proceso' and tbl_sgd_relaciones.evaluado<>tbl_sgd_relaciones.evaluador    ";
    if ($arreglo_post["filtro2"]) {
        if ($arreglo_post["filtro1"] == '-' or $arreglo_post["filtro2"] == '-') {
            $filtro1_2 = "";
        } else {
            $filtro1_2 = " and tbl_usuario." . $arreglo_post["filtro1"] . "='" . $arreglo_post["filtro2"] . "'";
        }
    }
    $sql = "SELECT
     tbl_sgd_relaciones.*, tbl_sgd_subperfiles.muestra_graficos
     FROM
     tbl_sgd_relaciones
     inner join tbl_sgd_subperfiles
     on tbl_sgd_subperfiles.id=tbl_sgd_relaciones.subperfil


     inner join tbl_usuario
     on tbl_usuario.rut=tbl_sgd_relaciones.evaluado
     WHERE
     tbl_sgd_relaciones.id_proceso = '$id_proceso'
     and tbl_sgd_relaciones.evaluado<>tbl_sgd_relaciones.evaluador
     $filtro1_2
     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TraeDatosProcesoAnualDadoProcesoEval($id_proceso)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "SELECT
     tbl_sgd_proceso_evaluacion.*,
t    bl_sgd_proceso_anual.ano as agno_proceso
from
     tbl_sgd_proceso_evaluacion
inner JOIN tbl_sgd_proceso_anual ON tbl_sgd_proceso_anual.id = tbl_sgd_proceso_evaluacion.id_proceso_anual
where
     tbl_sgd_proceso_evaluacion.id_proceso = '$id_proceso'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TraeDatosRelacionEvaluadoEvaluadorProceso($evaluado, $evaluador, $id_proceso)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "


select
     tbl_sgd_relaciones.*, tbl_sgd_subperfiles.muestra_graficos
from
     tbl_sgd_relaciones
inner join tbl_sgd_subperfiles
on tbl_sgd_subperfiles.id=tbl_sgd_relaciones.subperfil
where
     id_proceso = '$id_proceso'
AND evaluado = '$evaluado'
AND evaluador = '$evaluador'


     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TraeDatosRelacionEvaluadoEvaluadorProcesoSinAe($evaluado, $evaluador, $id_proceso)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "


select
     tbl_sgd_relaciones.*, tbl_sgd_subperfiles.muestra_graficos
from
     tbl_sgd_relaciones
inner join tbl_sgd_subperfiles
on tbl_sgd_subperfiles.id=tbl_sgd_relaciones.subperfil
where
     id_proceso = '$id_proceso'
AND evaluado = '$evaluado'
AND evaluador = '$evaluador'


     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function CursosNoIniciados($rut, $id_malla)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
     SELECT DISTINCT
     (tbl_inscripcion_cierre.id_curso), rel_lms_malla_curso.id_malla, tbl_lms_curso.nombre as nombre_curso
from
     tbl_inscripcion_cierre
left join rel_lms_malla_curso
on tbl_inscripcion_cierre.id_curso=rel_lms_malla_curso.id_curso and rel_lms_malla_curso.id_malla='$id_malla'
inner join tbl_lms_curso
on tbl_lms_curso.id=tbl_inscripcion_cierre.id_curso
where
     rut = '$rut' and rel_lms_malla_curso.id_malla is null      AND rel_lms_malla_curso.id_malla IS NULL
AND tbl_inscripcion_cierre.estado<>1
AND tbl_inscripcion_cierre.estado<>2
AND tbl_inscripcion_cierre.estado<>3
limit 3
     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function CAPACITACION_VE_ESTADO_NO_INICIADOS($rut, $id_curso, $id_inscripcion, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "


select * from tbl_inscripcion_cierre where id_curso='$id_curso' AND
i    d_empresa='$id_empresa' and id_inscripcion='$id_inscripcion' and rut='$rut'


     ";
    $database->setquery($sql);
    $database->query();
    $cod                   = $database->listObjects();
    $estado                = $cod[0]->estado;
    $porcentaje_asistencia = $cod[0]->porcentaje_asistencia;
    $nota                  = $cod[0]->nota;
    if ($estado === NULL) {
        $sql = "


select * from tbl_inscripcion_cierre where id_curso='$id_curso' AND
i    d_empresa='$id_empresa' and rut='$rut'


     ";
        $database->setquery($sql);
        $database->query();
        $cod                   = $database->listObjects();
        $estado                = $cod[0]->estado;
        $porcentaje_asistencia = $cod[0]->porcentaje_asistencia;
        $nota                  = $cod[0]->nota;
        if ($estado === NULL) {
        } else {
        }
    } else {
    }
    return array(
        $estado,
        $porcentaje_asistencia,
        $nota
    );
}
function OtrosCursosNoMalla($rut, $id_malla)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
     SELECT DISTINCT
     (tbl_inscripcion_cierre.id_curso), rel_lms_malla_curso.id_malla, tbl_lms_curso.nombre as nombre_curso, tbl_inscripcion_cierre.estado as estado
from
     tbl_inscripcion_cierre
left join rel_lms_malla_curso
on tbl_inscripcion_cierre.id_curso=rel_lms_malla_curso.id_curso and rel_lms_malla_curso.id_malla='$id_malla'
inner join tbl_lms_curso
on tbl_lms_curso.id=tbl_inscripcion_cierre.id_curso
where
     rut = '$rut' and rel_lms_malla_curso.id_malla is null
AND tbl_inscripcion_cierre.estado>0




     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ObtengoTemplatePaginaDadoId($id)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
     select * from tbl_paginas_templates
     where id='$id'
     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function VerificaSiObjetivosEstanValidadosDadoIdProcesoSoloEvaluado($id_proceso, $evaluado)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
     select distinct(evaluado) from tbl_objetivos_validaciones
     where id_proceso='$id_proceso' and evaluado='$evaluado'
     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function VerificaSiObjetivosEstanValidadosDadoEvaluadorIdProcesoEvaluado($evaluador, $id_proceso, $evaluado)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
     select distinct(evaluado) from tbl_objetivos_validaciones
     where evaluador='$evaluador' and id_proceso='$id_proceso' and evaluado='$evaluado'
     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function VerificaSiObjetivosEstanValidadosDadoEvaluadorIdProceso($evaluador, $id_proceso)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
     select distinct(evaluado) from tbl_objetivos_validaciones
     where evaluador='$evaluador' and id_proceso='$id_proceso'
     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function EvaluadosDadoEvaluadorParaBitacora($evaluador)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "SELECT
     tbl_sgd_relaciones.*, tbl_sgd_subperfiles.perfil AS nombre_subperfil, tbl_usuario.perfil_evaluacion
from
     tbl_sgd_relaciones
left JOIN tbl_sgd_subperfiles ON tbl_sgd_subperfiles.id = tbl_sgd_relaciones.subperfil
inner join tbl_usuario
on tbl_usuario.rut=tbl_sgd_relaciones.evaluado
where
     tbl_sgd_relaciones.evaluador = '$evaluador'
order BY
     subperfil,
     tbl_sgd_relaciones.evaluado ASC
     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ObjetivosVerificaCompetenciaIngresada($rut, $id_dimension, $competencia)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
     select id from tbl_objetivos_individuales
     where rut='$rut' and dimension='$id_dimension' and competencia='$competencia'
     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ObjetivosVerificaConductaCritica($rut, $id_dimension, $conducta_critica)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
     select id from tbl_objetivos_individuales
     where rut='$rut' and dimension='$id_dimension' and conducta_critica='$conducta_critica'
     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function DatosDimensionDadoId($id_dimension)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_objetivos_dimension where id=$id_dimension";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function SumaPonderacionesPorRutYDimension($rut, $id_dimension)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
     select sum(ponderacion) as suma_ponderaciones from tbl_objetivos_individuales
     where rut='$rut' and dimension='$id_dimension'
     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function VerificoEvaluadoPRocesoEmpresaFinalizadoObjetivos($evaluado, $id_empresa, $id_proceso)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select distinct(evaluado) from tbl_objetivos_indviduales_finalizado where evaluado='$evaluado' and id_empresa='$id_empresa' and id_proceso='$id_proceso'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function VerificoEvaluadoEvaluadorPRocesoEmpresaFinalizadoObjetivos($evaluado, $evaluador, $id_empresa, $id_proceso)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select distinct(evaluado) from tbl_objetivos_indviduales_finalizado where evaluador='$evaluador' and evaluado='$evaluado' and id_empresa='$id_empresa' and id_proceso='$id_proceso'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function VerificoEvaluadosFinalizadosPorEvaluador($rut_fijador, $id_proceso, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select distinct(tbl_objetivos_indviduales_finalizado.evaluado), tbl_usuario.nombre_completo
     from tbl_objetivos_indviduales_finalizado


     inner join tbl_usuario
     on tbl_usuario.rut=tbl_objetivos_indviduales_finalizado.evaluado
     where tbl_objetivos_indviduales_finalizado.evaluador='$rut_fijador'
     and tbl_objetivos_indviduales_finalizado.id_empresa='$id_empresa'
     and tbl_objetivos_indviduales_finalizado.id_proceso='$id_proceso'
     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function InsertarobjetivoIndividualFinalizadoPorDimensionEmpresaConEvaluador($rut, $id_dimension, $id_empresa, $rut_fijador, $id_proceso)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "INSERT INTO tbl_objetivos_indviduales_finalizado(evaluado, fecha, hora, id_dimension, id_empresa, evaluador, id_proceso) " . "VALUES ('$rut', '" . date("Y-m-d") . "', '" . date("H:i:s") . "', '$id_dimension', '$id_empresa', '$rut_fijador', '$id_proceso');";
    $database->setquery($sql);
    $database->query();
}
function ActualizaObjetivoV2DadoId($id_objetivo, $objetivo, $accion_clave, $ponderacion, $conducta_critica, $comentarios, $acciones_desarrollo, $responsable, $fecha_limite, $acciones_realizadas, $impacto, $tipo_accion, $competencia, $metrica, $meta, $nocumple, $cumple, $sobresale)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "update tbl_objetivos_individuales
     set
     descripcion_objetivo='$objetivo',
     ponderacion='$ponderacion',
     accion_clave='$accion_clave',
     conducta_critica='$conducta_critica',
     comentarios='$comentarios',
     acciones_desarrollo='$acciones_desarrollo',
     responsable='$responsable',
     fecha_limite='$fecha_limite',
     acciones_realizadas='$acciones_realizadas',
     impacto='$impacto',
     tipo_accion='$tipo_accion',
     competencia='$competencia',
     metrica='$metrica',
     meta='$meta',
     nocumple='$nocumple',
     cumple='$cumple',
     sobresale='$sobresale'


where id='$id_objetivo'
";
    $database->setquery($sql);
    $database->query();
}
function CompetenciasDadoPerfilParaObjetivos($id_perfil)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_sgd_componente where id_perfil='$id_perfil'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function DAtosEvaluadoEvaluadorParaAvancePorEvaluadorPorCriteriosV2($id_proceso, $campo_criterio, $valor_criterio, $tipo_resumen)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    if ($tipo_resumen == "evaluadoEvaluador") {
        $tabla = "tbl_usuario";
    } else {
        $tabla = "base_evaluador";
    }
    $sqlBK_SGD = "




     SELECT
     tbl_sgd_relaciones.evaluado,
     tbl_sgd_relaciones.evaluador,
     tbl_usuario.perfil_evaluacion,
     (
     SELECT
     count(tbl_sgd_preguntas.id)AS total_preguntas
     FROM
     rel_sgd_perfil_competencias
     INNER JOIN tbl_sgd_componente ON tbl_sgd_componente.id = rel_sgd_perfil_competencias.id_componente
     INNER JOIN tbl_sgd_preguntas ON tbl_sgd_preguntas.id_competencia = tbl_sgd_componente.id
     WHERE
     perfil_evaluacion = tbl_usuario.perfil_evaluacion
     )AS total_preguntas,
(    SELECT
     count(tbl_sgd_respuestas.id) as total
     FROM
     tbl_sgd_respuestas
     INNER JOIN rel_sgd_perfil_competencias ON rel_sgd_perfil_competencias.id_componente = tbl_sgd_respuestas.id_competencia
     WHERE
     tbl_sgd_respuestas.evaluado = tbl_sgd_relaciones.evaluado
     AND tbl_sgd_respuestas.evaluador = tbl_sgd_relaciones.evaluador
     AND rel_sgd_perfil_competencias.perfil_evaluacion = tbl_usuario.perfil_evaluacion
     and tbl_sgd_respuestas.id_proceso='$id_proceso'
     ) as pagina
from
     tbl_sgd_relaciones
inner JOIN tbl_usuario ON tbl_usuario.rut = tbl_sgd_relaciones.evaluado
inner JOIN tbl_usuario AS base_evaluador ON base_evaluador.rut = tbl_sgd_relaciones.evaluador
where
     tbl_sgd_relaciones.id_proceso = '$id_proceso'
AND $tabla.$campo_criterio='$valor_criterio'
";
    $sql       = "
select
     tbl_sgd_relaciones.evaluado,
     tbl_sgd_relaciones.evaluador,
     tbl_sgd_relaciones.perfil_evaluacion_competencias as perfil_evaluacion,
     (
     SELECT
     count(tbl_sgd_preguntas.id)AS total_preguntas
     FROM
     rel_sgd_perfil_competencias
     INNER JOIN tbl_sgd_componente ON tbl_sgd_componente.id = rel_sgd_perfil_competencias.id_componente
     INNER JOIN tbl_sgd_preguntas ON tbl_sgd_preguntas.id_competencia = tbl_sgd_componente.id
     WHERE
     perfil_evaluacion = tbl_sgd_relaciones.perfil_evaluacion_competencias
     )AS total_preguntas,
(    SELECT
     count(tbl_sgd_respuestas.id) as total
     FROM
     tbl_sgd_respuestas
     INNER JOIN rel_sgd_perfil_competencias ON rel_sgd_perfil_competencias.id_componente = tbl_sgd_respuestas.id_competencia
     WHERE
     tbl_sgd_respuestas.evaluado = tbl_sgd_relaciones.evaluado
     AND tbl_sgd_respuestas.evaluador = tbl_sgd_relaciones.evaluador
     AND tbl_sgd_respuestas.id_proceso = '$id_proceso'
     AND rel_sgd_perfil_competencias.perfil_evaluacion = tbl_sgd_relaciones.perfil_evaluacion_competencias
     ) as pagina
from
     tbl_sgd_relaciones
inner JOIN tbl_usuario ON tbl_usuario.rut = tbl_sgd_relaciones.evaluado
inner JOIN tbl_usuario AS base_evaluador ON base_evaluador.rut = tbl_sgd_relaciones.evaluador
where
     tbl_sgd_relaciones.id_proceso = '$id_proceso'
AND $tabla.$campo_criterio='$valor_criterio'






";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function DAtosEvaluadoEvaluadorParaAvancePorEvaluadoEvaluadorEvalIndividualV2($evaluador, $id_proceso, $evaluado)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sqlBK_SGD = "SELECT
     tbl_sgd_relaciones.evaluado,
     tbl_sgd_relaciones.evaluador,
     pagina as paginaBk,
     tbl_usuario.perfil_evaluacion,
     (
     SELECT
     count(tbl_sgd_preguntas.id)AS total_preguntas
     FROM
     rel_sgd_perfil_competencias
     INNER JOIN tbl_sgd_componente ON tbl_sgd_componente.id = rel_sgd_perfil_competencias.id_componente
     INNER JOIN tbl_sgd_preguntas ON tbl_sgd_preguntas.id_competencia = tbl_sgd_componente.id
     WHERE
     perfil_evaluacion = tbl_usuario.perfil_evaluacion
     )AS total_preguntas,
(    SELECT
     count(tbl_sgd_respuestas.id) as total
     FROM
     tbl_sgd_respuestas
     INNER JOIN rel_sgd_perfil_competencias ON rel_sgd_perfil_competencias.id_componente = tbl_sgd_respuestas.id_competencia
     WHERE
     tbl_sgd_respuestas.evaluado = '$evaluado'
     AND tbl_sgd_respuestas.evaluador = '$evaluador'
     AND rel_sgd_perfil_competencias.perfil_evaluacion = tbl_usuario.perfil_evaluacion
     ) as pagina
from
     tbl_sgd_relaciones
left JOIN tbl_sgd_sesion_evaluacion ON tbl_sgd_sesion_evaluacion.evaluador = '$evaluador'
AND tbl_sgd_sesion_evaluacion.evaluado = '$evaluado'
AND tbl_sgd_sesion_evaluacion.id_proceso = '$id_proceso'
inner JOIN tbl_usuario ON tbl_usuario.rut = tbl_sgd_relaciones.evaluado
where
     tbl_sgd_relaciones.evaluador = '$evaluador'
AND tbl_sgd_relaciones.evaluado = '$evaluado'
AND tbl_sgd_relaciones.id_proceso = '$id_proceso'
";
    $sql       = "SELECT
     tbl_sgd_relaciones.evaluado,
     tbl_sgd_relaciones.evaluador,
     pagina as paginaBk,
     tbl_sgd_relaciones.perfil_evaluacion_competencias as perfil_evaluacion,
     (
     SELECT
     count(tbl_sgd_preguntas.id)AS total_preguntas
     FROM
     rel_sgd_perfil_competencias
     INNER JOIN tbl_sgd_componente ON tbl_sgd_componente.id = rel_sgd_perfil_competencias.id_componente
     INNER JOIN tbl_sgd_preguntas ON tbl_sgd_preguntas.id_competencia = tbl_sgd_componente.id
     WHERE
     perfil_evaluacion = tbl_sgd_relaciones.perfil_evaluacion_competencias
     )AS total_preguntas,
(    SELECT
     count(tbl_sgd_respuestas.id) as total
     FROM
     tbl_sgd_respuestas
     INNER JOIN rel_sgd_perfil_competencias ON rel_sgd_perfil_competencias.id_componente = tbl_sgd_respuestas.id_competencia
     WHERE
     tbl_sgd_respuestas.evaluado = '$evaluado'
     AND tbl_sgd_respuestas.evaluador = '$evaluador'
     AND tbl_sgd_respuestas.id_proceso = '$id_proceso'
     AND rel_sgd_perfil_competencias.perfil_evaluacion = tbl_sgd_relaciones.perfil_evaluacion_competencias
     ) as pagina
from
     tbl_sgd_relaciones
left JOIN tbl_sgd_sesion_evaluacion ON tbl_sgd_sesion_evaluacion.evaluador = '$evaluador'
AND tbl_sgd_sesion_evaluacion.evaluado = '$evaluado'
AND tbl_sgd_sesion_evaluacion.id_proceso = '$id_proceso'
inner JOIN tbl_usuario ON tbl_usuario.rut = tbl_sgd_relaciones.evaluado
where
     tbl_sgd_relaciones.evaluador = '$evaluador'
AND tbl_sgd_relaciones.evaluado = '$evaluado'
AND tbl_sgd_relaciones.id_proceso = '$id_proceso'
";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function VerificaSiObjetivosEstanValidadosPorDimension($evaluado, $id_dimension, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_objetivos_validaciones where evaluado='$evaluado' and id_dimension='$id_dimension' and id_empresa='$id_empresa'    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function InsertaValidacionJefeDelJefePorDimension($evaluado, $evaluador, $validador, $id_dimension, $id_empresa, $id_proceso)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "INSERT INTO tbl_objetivos_validaciones(evaluado, evaluador, validador, fecha, hora, id_dimension, id_empresa, id_proceso) " . "VALUES ('$evaluado', '$evaluador', '$validador',  '" . date("Y-m-d") . "', '" . date("H:i:s") . "', '$id_dimension', '$id_empresa', '$id_proceso');";
    $database->setquery($sql);
    $database->query();
}
function TraeEvaluadoresDadoValidadorFijObjetivos($validador, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
     select distinct(tbl_sgd_relaciones.evaluador), nombre_completo, cargo from tbl_sgd_relaciones
     inner join tbl_usuario
     on tbl_usuario.rut=tbl_sgd_relaciones.evaluador
     where validador='$validador' and tbl_sgd_relaciones.id_empresa='$id_empresa'
     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ActualizaComentariosPorDimension($fijador, $evaluado, $dimension, $id_empresa, $acciones_realizadas, $impacto)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "update tbl_objetivos_dimensiones_comentarios
     set
     acciones_realizadas='$acciones_realizadas',
     impacto='$impacto'


     where evaluado='$evaluado'
     and evaluador='$fijador'
     and id_dimension='$dimension'
     and id_empresa='$id_empresa'
     ";
    $database->setquery($sql);
    $database->query();
}
function VerificaComentariosPorDimension($fijador, $evaluado, $id_dimension, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_objetivos_dimensiones_comentarios where evaluado='$evaluado' and id_dimension='$id_dimension' and id_empresa='$id_empresa' and evaluador='$fijador'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function InsertaComentariosPorDimension($fijador, $evaluado, $dimension, $id_empresa, $acciones_realizadas, $impacto)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "INSERT INTO tbl_objetivos_dimensiones_comentarios(evaluado, evaluador, id_dimension, id_empresa, acciones_realizadas, impacto) " . "VALUES ('$evaluado', '$fijador', '$dimension', '$id_empresa', '$acciones_realizadas', '$impacto');";
    $database->setquery($sql);
    $database->query();
}
function VerificaDimensionFinalizadaObjetivosPorEvaluado($rut, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_objetivos_indviduales_finalizado where evaluado='$rut' and id_empresa='$id_empresa'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function VerificaDimensionFinalizadaObjetivos($rut, $id_dimension, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_objetivos_indviduales_finalizado where evaluado='$rut' and id_dimension='$id_dimension' and id_empresa='$id_empresa'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function InsertarobjetivoIndividualFinalizadoPorDimensionEmpresa($rut, $id_dimension, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "INSERT INTO tbl_objetivos_indviduales_finalizado(evaluado, fecha, hora, id_dimension, id_empresa) " . "VALUES ('$rut', '" . date("Y-m-d") . "', '" . date("H:i:s") . "', '$id_dimension', '$id_empresa');";
    $database->setquery($sql);
    $database->query();
}
function ObjetivosPodDimensionEmpresaUsuario($rut, $id_empresa, $dimension, $id_perfil_competencia)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
select
     tbl_sgd_componente.nombre as nombre_competencia,
     tbl_objetivos_dimension.nombre as nombre_dimension_pdf,
     tbl_objetivos_individuales.*,
     tbl_sgd_componente_conducta.conducta as nombre_conducta,
     tbl_objetivos_metricas.metrica as descripcion_metrica
from
     tbl_objetivos_individuales
left join tbl_sgd_componente
on tbl_sgd_componente.id_componente_reporte=tbl_objetivos_individuales.competencia and
t    bl_sgd_componente.id_perfil='$id_perfil_competencia' and tbl_sgd_componente.id_empresa='$id_empresa'


left join tbl_sgd_componente_conducta
on tbl_sgd_componente_conducta.id_conducta=.tbl_objetivos_individuales.conducta_critica
AND tbl_sgd_componente_conducta.id_empresa='$id_empresa'


inner join tbl_objetivos_dimension
on tbl_objetivos_dimension.id=tbl_objetivos_individuales.dimension


left join tbl_objetivos_metricas ON tbl_objetivos_metricas.id_metrica = tbl_objetivos_individuales.descripcion_objetivo




where
     tbl_objetivos_individuales.id_empresa = '$id_empresa'
AND tbl_objetivos_individuales.rut = '$rut'
AND tbl_objetivos_individuales.dimension = '$dimension'


";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ObjetivosPodDimensionEmpresaUsuarioBK($rut, $id_empresa, $dimension, $id_perfil_competencia)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
select
     tbl_sgd_componente.nombre as nombre_competencia,
     tbl_objetivos_individuales.*,
     tbl_sgd_componente_conducta.conducta as nombre_conducta
from
     tbl_objetivos_individuales
left join tbl_sgd_componente
on tbl_sgd_componente.id_componente_reporte=tbl_objetivos_individuales.competencia and
t    bl_sgd_componente.id_perfil='$id_perfil_competencia'


left join tbl_sgd_componente_conducta on tbl_sgd_componente_conducta.id_conducta=.tbl_objetivos_individuales.conducta_critica
where
     tbl_objetivos_individuales.id_empresa = '$id_empresa'
AND tbl_objetivos_individuales.rut = '$rut'
AND tbl_objetivos_individuales.dimension = '$dimension'


";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ObjetivosPodDimensionEmpresaUsuarioSumaPonderacion($rut, $id_empresa, $dimension)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
select


     sum(tbl_objetivos_individuales.ponderacion) as suma_ponderaciones
from
     tbl_objetivos_individuales
left join tbl_sgd_componente
on tbl_sgd_componente.id=tbl_objetivos_individuales.conducta_critica
where
     tbl_objetivos_individuales.id_empresa = '$id_empresa'
AND tbl_objetivos_individuales.rut = '$rut'
AND tbl_objetivos_individuales.dimension = '$dimension'
";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function InsertarObjetivoV2Log($evaluado, $id_empresa, $dimension, $descripcion_objetivo, $accion_clave, $conducta_critica, $comentarios, $acciones_desarrollo, $responsable, $fecha_limite, $ponderacion, $acciones_realizadas, $impacto, $tipo_accion, $competencia, $metrica, $meta, $nocumple, $cumple, $sobresale)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "INSERT INTO tbl_objetivos_individuales_log
     (
     rut,
     dimension,
     id_empresa,
     descripcion_objetivo,
     accion_clave,
     fecha,
     hora,
     conducta_critica,
     comentarios,
     acciones_desarrollo,
     responsable,
     fecha_limite,
     ponderacion,
     acciones_realizadas,
     impacto,
     tipo_accion,
     competencia,
     metrica,
     meta,
     nocumple,
     cumple,
     sobresale) " . "VALUES
     ('$evaluado', '$dimension', '$id_empresa', '$descripcion_objetivo', '$accion_clave',  '" . date("Y-m-d") . "', '" . date("H:i:s") . "', '$conducta_critica', '$comentarios',
     '$acciones_desarrollo',
     '$responsable',
     '$fecha_limite',
     '$ponderacion',
     '$acciones_realizadas',
     '$impacto',
     '$tipo_accion',
     '$competencia',
     '$metrica',
     '$meta',
     '$nocumple',
     '$cumple',
     '$sobresale'


     );";
    $database->setquery($sql);
    $database->query();
}
function InsertarObjetivoV2($evaluado, $id_empresa, $dimension, $descripcion_objetivo, $accion_clave, $conducta_critica, $comentarios, $acciones_desarrollo, $responsable, $fecha_limite, $ponderacion, $acciones_realizadas, $impacto, $tipo_accion, $competencia, $metrica, $meta, $nocumple, $cumple, $sobresale)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "INSERT INTO tbl_objetivos_individuales
     (
     rut,
     dimension,
     id_empresa,
     descripcion_objetivo,
     accion_clave,
     fecha,
     hora,
     conducta_critica,
     comentarios,
     acciones_desarrollo,
     responsable,
     fecha_limite,
     ponderacion,
     acciones_realizadas,
     impacto,
     tipo_accion,
     competencia,
     metrica,
     meta,
     nocumple,
     cumple,
     sobresale) " . "VALUES
     ('$evaluado', '$dimension', '$id_empresa', '$descripcion_objetivo', '$accion_clave',  '" . date("Y-m-d") . "', '" . date("H:i:s") . "', '$conducta_critica', '$comentarios',
     '$acciones_desarrollo',
     '$responsable',
     '$fecha_limite',
     '$ponderacion',
     '$acciones_realizadas',
     '$impacto',
     '$tipo_accion',
     '$competencia',
     '$metrica',
     '$meta',
     '$nocumple',
     '$cumple',
     '$sobresale'


     );";
    $database->setquery($sql);
    $database->query();
}
function TotalVisitasDadoRutCaseEmpresaFront($rut, $id_empresa, $case)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select count(id) as total_visitas from tbl_log_sistema where rut='$rut' and ambiente='$case' and id_empresa='$id_empresa'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TraeIndicadoresDelDia()
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_indicadores_deldia";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function InsertarMensajeLineaDirecta($rut, $mensaje, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "INSERT INTO tbl_mensaje_linea_directa(rut, id_empresa, mensaje, fecha, hora) " . "VALUES ('$rut', '$id_empresa', '$mensaje', '" . date("Y-m-d") . "', '" . date("H:i:s") . "');";
    $database->setquery($sql);
    $database->query();
}
function TotalReconocimientosPorCategoriaGenericoPorAno($id_categoria, $id_empresa, $ano)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
     SELECT
     tbl_salonfama_publicados.*, tbl_salonfama_categorias.nombre AS nombre_categoria,
     tbl_salonfama_categorias.titulo_listado AS titulo_pagina,
     tbl_salonfama_categorias.descripcion AS descripcion_categoria,
     imagen,
     tbl_usuario.nombre,
     tbl_usuario.apaterno,
     tbl_usuario.amaterno,
     tbl_usuario.nombre_completo,
     tbl_usuario.cargo,
     tbl_salonfama_categorias.template_row AS template_row,
     tbl_salonfama_categorias.imagen_form,
     tbl_salonfama_categorias.imagen_inicio_pagina


from
     tbl_salonfama_publicados
inner JOIN tbl_salonfama_categorias ON tbl_salonfama_categorias.id = tbl_salonfama_publicados.id_tipo_reconocimiento
inner JOIN tbl_usuario ON tbl_usuario.rut = tbl_salonfama_publicados.rut
where
     idempresa = '$id_empresa'  and tbl_salonfama_publicados.ano='$ano'
AND id_tipo_reconocimiento = '$id_categoria'
order BY


     tbl_salonfama_publicados.id DESC


";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ObtenerSalonPorCategoriaYEmpresaPorAno($id_empresa, $id_categoria, $limit, $ano)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    if ($limit) {
        $limit = "limit $limit";
    } else {
        $limit = "";
    }
    $sql = "


     SELECT
     tbl_salonfama_categorias.nombre,
     tbl_salonfama_categorias.imagen,
     tbl_salonfama_categorias.proceso_actual,
     tbl_salonfama_categorias.proceso_anterior,
     tbl_salonfama_publicados.*, tbl_usuario.nombre AS nombre_persona,
     tbl_usuario.apaterno,
     tbl_usuario.amaterno,
     tbl_usuario.ubicacion,
     tbl_usuario.cargo,
     tbl_salonfama_valores.nombre as nombre_valor
from
     tbl_salonfama_publicados
inner JOIN tbl_usuario ON tbl_usuario.rut = tbl_salonfama_publicados.rut
inner JOIN tbl_salonfama_categorias ON tbl_salonfama_categorias.id = tbl_salonfama_publicados.id_tipo_reconocimiento
left join tbl_salonfama_valores on tbl_salonfama_valores.id=tbl_salonfama_publicados.id_valor
where
     tbl_salonfama_publicados.idempresa = '$id_empresa' and tbl_salonfama_publicados.ano='$ano'
AND tbl_salonfama_publicados.id_tipo_reconocimiento = '$id_categoria'
order BY
     RAND()
$limit










     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function DimensionesObjetivosPorEmpresa($id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "


select * from tbl_objetivos_dimension where id_empresa=$id_empresa order by orden asc
     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function DAtosEvaluadoEvaluadorParaAvancePorEvaluadoEvaluadorEvalIndividual($evaluador, $id_proceso, $evaluado)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "SELECT
     tbl_sgd_relaciones.evaluado,
     tbl_sgd_relaciones.evaluador,
     pagina,
     tbl_usuario.perfil_evaluacion,
     (
     SELECT
     count(tbl_sgd_componente.id)AS total_preguntas
     FROM
     rel_sgd_perfil_competencias
     INNER JOIN tbl_sgd_componente ON tbl_sgd_componente.id = rel_sgd_perfil_competencias.id_componente


     WHERE
     perfil_evaluacion = tbl_usuario.perfil_evaluacion
     )AS total_preguntas
from
     tbl_sgd_relaciones
left JOIN tbl_sgd_sesion_evaluacion ON tbl_sgd_sesion_evaluacion.evaluador = '$evaluador' and tbl_sgd_sesion_evaluacion.evaluado='$evaluado'
AND tbl_sgd_sesion_evaluacion.id_proceso = '$id_proceso'
inner JOIN tbl_usuario ON tbl_usuario.rut = tbl_sgd_relaciones.evaluado
where
     tbl_sgd_relaciones.evaluador = '$evaluador'
AND tbl_sgd_relaciones.evaluado = '$evaluado'
AND tbl_sgd_relaciones.id_proceso = '$id_proceso'
";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TraePlanesValidados($evaluado)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select tbl_planes_ingresados.*, tbl_sgd_componente.nombre as nombre_competencia, tbl_planes_plazos.nombre as plazo_nombre
     from tbl_planes_ingresados
     inner join tbl_sgd_componente
     on tbl_sgd_componente.id=tbl_planes_ingresados.id_competencia
     inner join tbl_planes_plazos
     on tbl_planes_plazos.id=.tbl_planes_ingresados.plazo


     where evaluado='$evaluado' and jefe_sugiere is not null order by tbl_planes_ingresados.id desc";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function CAPACITACION_cursosPoriNSCRIPCIONUSUARIO($rut, $malla, $clasificacion)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "SELECT
     tbl_lms_curso.id AS codigo_curso,
     tbl_lms_curso.nombre nombre_curso,
     tbl_lms_curso.modalidad ,
     tbl_lms_clasificacion.clasificacion,
     tbl_lms_clasificacion.id_clasificacion AS codigo_clasificacion,
     tbl_inscripcion_cierre.nota,
     tbl_inscripcion_cierre.porcentaje_asistencia,
     tbl_inscripcion_cierre.estado,
     tbl_inscripcion_usuarios.id_inscripcion,
     tbl_inscripcion_curso.fecha_inicio as fecha_inicio_insc,
     tbl_inscripcion_curso.fecha_termino as fecha_termino_insc
from
     tbl_inscripcion_usuarios
inner JOIN tbl_lms_curso ON tbl_inscripcion_usuarios.id_curso = tbl_lms_curso.id
inner JOIN tbl_lms_clasificacion ON tbl_lms_clasificacion.id_clasificacion = rel_lms_malla_curso.id_clasificacion
inner join tbl_inscripcion_curso on tbl_inscripcion_curso.codigo_inscripcion=tbl_inscripcion_usuarios.id_inscripcion
inner JOIN rel_lms_malla_curso ON rel_lms_malla_curso.id_curso = tbl_lms_curso.id
AND rel_lms_malla_curso.id_malla = '$malla'
left JOIN tbl_inscripcion_cierre ON tbl_inscripcion_cierre.id_inscripcion = tbl_inscripcion_usuarios.id_inscripcion
AND tbl_inscripcion_cierre.rut = '$rut'
where
     tbl_inscripcion_usuarios.rut = '$rut'
AND rel_lms_malla_curso.id_clasificacion = '$clasificacion'
order BY
     tbl_inscripcion_curso.fecha_inicio desc


     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function CAPACITACION_cursosPorClasificacion($rut, $malla, $clasificacion)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "SELECT
     tbl_lms_curso.id AS codigo_curso,
     tbl_lms_curso.nombre nombre_curso,
     tbl_lms_curso.proveedor as proveedor_curso ,
     tbl_lms_curso.modalidad ,
     tbl_lms_curso.imagen ,
     tbl_lms_curso.descripcion as descripcion_curso ,
     tbl_lms_clasificacion.clasificacion,
     tbl_lms_clasificacion.id_clasificacion AS codigo_clasificacion,
     tbl_inscripcion_cierre.nota,
     tbl_inscripcion_cierre.porcentaje_asistencia,
     tbl_inscripcion_cierre.estado,
     tbl_inscripcion_usuarios.id_inscripcion,
     tbl_inscripcion_curso.fecha_inicio as fecha_inicio_insc,
     tbl_inscripcion_curso.fecha_termino as fecha_termino_insc,
     tbl_gamificado_nivel.idnivel
from
     tbl_inscripcion_usuarios
inner JOIN tbl_lms_curso ON tbl_inscripcion_usuarios.id_curso = tbl_lms_curso.id
inner JOIN rel_lms_malla_curso ON rel_lms_malla_curso.id_curso = tbl_lms_curso.id
AND rel_lms_malla_curso.id_malla = '$malla'






inner JOIN tbl_lms_clasificacion ON tbl_lms_clasificacion.id_clasificacion = rel_lms_malla_curso.id_clasificacion
inner join tbl_inscripcion_curso on tbl_inscripcion_curso.codigo_inscripcion=tbl_inscripcion_usuarios.id_inscripcion






left JOIN tbl_inscripcion_cierre ON tbl_inscripcion_cierre.id_inscripcion = tbl_inscripcion_usuarios.id_inscripcion
AND tbl_inscripcion_cierre.rut = '$rut'


left JOIN tbl_gamificado_nivel
on tbl_gamificado_nivel.idcurso=tbl_lms_curso.id
where
     tbl_inscripcion_usuarios.rut = '$rut'
AND rel_lms_malla_curso.id_clasificacion = '$clasificacion'
order BY
     tbl_inscripcion_curso.fecha_inicio desc


     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function CAPACITACION_cursosPorClasificacionMalla($malla, $clasificacion, $filtro_desde_admin)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    if ($clasificacion) {
        $filtro_clasificacion = " and h.id_clasificacion = '$clasificacion'";
    } else {
        $filtro_clasificacion = " ";
    }
    if ($filtro_desde_admin["curso"]) {
        $filtro_id_curso = " and h.id_curso='" . $filtro_desde_admin["curso"] . "'";
    } else {
        $filtro_id_curso = " ";
    }

$sql = "

     SELECT
h    .*,
(    select nombre from tbl_lms_curso where id=h.id_curso) as nombre_curso,
(    select imagen_back from tbl_lms_curso where id=h.id_curso) as imagen_back,
(    select imagen from tbl_lms_curso where id=h.id_curso) as imagen,
(    select fecha_inicio from tbl_lms_curso where id=h.id_curso) as fecha_inicio,
(    select valortotal from tbl_lms_curso where id=h.id_curso) as valortotal,
(    select idmoodle from tbl_lms_curso where id=h.id_curso) as idmoodle,
(    select currentorg from tbl_lms_curso where id=h.id_curso) as currentorg,
(    select id_scorm from tbl_lms_curso where id=h.id_curso) as id_scorm,
(    select scoid from tbl_lms_curso where id=h.id_curso) as scoid,
(    select cm from tbl_lms_curso where id=h.id_curso) as cm,
(    select urlmoodle from tbl_lms_curso where id=h.id_curso) as urlmoodle,
(    select puntos_maximo from tbl_lms_curso where id=h.id_curso) as puntos_maximo,
(    select modalidad from tbl_lms_curso where id=h.id_curso) as modalidad,
(    select descripcion from tbl_lms_curso where id=h.id_curso) as descripcion_curso,
(    select descriptor from tbl_lms_curso where id=h.id_curso) as descriptor_curso,
(    select inactivo from tbl_lms_curso where id=h.id_curso) as inactivo_curso,
(    select proveedor from tbl_lms_curso where id=h.id_curso) as proveedor_curso,
(    select numnivel
     from tbl_gamificado_nivel
     inner join tbl_gamificado_niveles_descripcion
     on tbl_gamificado_niveles_descripcion.idnivel=tbl_gamificado_nivel.idnivel
     where tbl_gamificado_nivel.idcurso=h.id_curso  and tbl_gamificado_nivel.idmalla='$malla') as numnivel,

     (select count(id) from tbl_inscripcion_curso where id_curso=h.id_curso) as cuentaCursos


from
     rel_lms_malla_curso h




where


     h.id_malla = '$malla' $filtro_clasificacion $filtro_id_curso


     order by h.orden_curso


     ";

    // echo "CAPACITACION_cursosPorClasificacionMalla ".$sql;
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function CAPACITACION_cursosPorClasificacionRut($rut, $clasificacion)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "


select
     tbl_lms_curso.id AS id_curso,
     tbl_lms_curso.nombre nombre_curso,
     tbl_lms_curso.modalidad,
     tbl_lms_curso.idmoodle,
     tbl_lms_curso.currentorg,
     tbl_lms_curso.id_scorm,
     tbl_lms_curso.scoid,
    tbl_lms_curso.cm,
     tbl_lms_curso.urlmoodle,
     tbl_lms_clasificacion.clasificacion,
     tbl_lms_clasificacion.id_clasificacion AS codigo_clasificacion,
     tbl_inscripcion_cierre.nota,
     tbl_inscripcion_cierre.porcentaje_asistencia,
     tbl_inscripcion_cierre.estado,
     tbl_inscripcion_cierre.fecha_inicio,
     tbl_inscripcion_cierre.fecha_termino,
     tbl_inscripcion_cierre.id_inscripcion
from
     tbl_inscripcion_cierre
inner JOIN tbl_lms_curso ON tbl_inscripcion_cierre.id_curso = tbl_lms_curso.id
inner JOIN tbl_lms_clasificacion ON tbl_lms_clasificacion.id_clasificacion = tbl_lms_curso.clasificacion


AND tbl_inscripcion_cierre.rut = '$rut'
where
     tbl_inscripcion_cierre.rut = '$rut'
AND tbl_lms_curso.clasificacion = '$clasificacion'
order BY
tbl_inscripcion_cierre.fecha_inicio DESC
     ";

    // echo $sql;

    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function CAPACITACION_VE_ESTADO($rut, $id_curso, $id_inscripcion, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "


select * from tbl_inscripcion_cierre where id_curso='$id_curso' AND
i    d_empresa='$id_empresa' and id_inscripcion='$id_inscripcion' and rut='$rut'


     ";
    $database->setquery($sql);
    $database->query();
    $cod                   = $database->listObjects();
    $estado                = $cod[0]->estado;
    $porcentaje_asistencia = $cod[0]->porcentaje_asistencia;
    $nota                  = $cod[0]->nota;
    if ($estado === NULL) {
        $sql = "


select * from tbl_inscripcion_cierre where id_curso='$id_curso' AND
i    d_empresa='$id_empresa' and rut='$rut'


     ";
        $database->setquery($sql);
        $database->query();
        $cod                   = $database->listObjects();
        $estado                = $cod[0]->estado;
        $porcentaje_asistencia = $cod[0]->porcentaje_asistencia;
        $nota                  = $cod[0]->nota;
        if ($estado === NULL) {
        } else {
        }
    } else {
    }
    return array(
        $estado,
        $porcentaje_asistencia,
        $nota
    );
}
function CAPACITACION_clasificacionesPorMallaRut($rut, $malla)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "SELECT
     distinct(rel_lms_malla_curso.id_clasificacion),
     tbl_lms_clasificacion.clasificacion AS nombre_clasificacion,
     tbl_lms_clasificacion.descripcion AS descripcion_clasificacion,
     tbl_lms_clasificacion.color,
     tbl_lms_clasificacion.imagen,
     tbl_lms_clasificacion.imagen_back,
     tbl_lms_clasificacion.color2


from
     tbl_inscripcion_usuarios


     inner join tbl_lms_curso
     on tbl_lms_curso.id=tbl_inscripcion_usuarios.id_curso
     inner join tbl_lms_clasificacion
     on tbl_lms_clasificacion.id_clasificacion=rel_lms_malla_curso.id_clasificacion
     inner join rel_lms_malla_curso
     on rel_lms_malla_curso.id_curso=tbl_lms_curso.id


where
     tbl_inscripcion_usuarios.rut = '$rut' and rel_lms_malla_curso.id_malla='$malla'
     order by orden_clasificacion asc
     ";

    // echo $sql; exit();
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function CAPACITACION_clasificacionesPorInscripcionUsuario($rut)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "


     SELECT
     distinct(tbl_lms_curso.clasificacion),
     tbl_lms_clasificacion.clasificacion AS nombre_clasificacion,
     tbl_lms_clasificacion.color,
     tbl_lms_clasificacion.imagen,
     tbl_lms_clasificacion.imagen_back,
     tbl_lms_clasificacion.color2


from
     tbl_inscripcion_usuarios
inner join tbl_lms_curso
on tbl_lms_curso.id=tbl_inscripcion_usuarios.id_curso
inner join tbl_lms_clasificacion
on tbl_lms_clasificacion.id_clasificacion=tbl_lms_curso.clasificacion


where
     tbl_inscripcion_usuarios.rut = '$rut'
     order by tbl_lms_clasificacion.orden asc


     ";
    $sql = "


     SELECT
     distinct(tbl_lms_curso.clasificacion) as id_clasificacion,
     tbl_lms_clasificacion.clasificacion AS nombre_clasificacion,
     tbl_lms_clasificacion.color,
     tbl_lms_clasificacion.imagen,
     tbl_lms_clasificacion.imagen_back,
     tbl_lms_clasificacion.color2


from
     tbl_inscripcion_usuarios
inner join tbl_lms_curso
on tbl_lms_curso.id=tbl_inscripcion_usuarios.id_curso
inner join tbl_lms_clasificacion
on tbl_lms_clasificacion.id_clasificacion=tbl_lms_curso.clasificacion


where
     tbl_inscripcion_usuarios.rut = '$rut'
     order by tbl_lms_clasificacion.orden asc


     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function CAPACITACION_clasificacionesPorMalla($malla, $id_empresa, $id_clasificacion)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $filtro_id_clasificacion = "";
    if ($id_clasificacion) {
        $filtro_id_clasificacion = " and rel_lms_malla_curso.id_clasificacion='$id_clasificacion'";
    }
    $sql = "


     SELECT DISTINCT
     (rel_lms_malla_curso.id_clasificacion),
     tbl_lms_clasificacion.clasificacion AS nombre_clasificacion,
     tbl_lms_clasificacion.descripcion AS descripcion_clasificacion,
     tbl_lms_clasificacion.color,
     tbl_lms_clasificacion.imagen,
     tbl_lms_clasificacion.imagen_back,
     tbl_lms_clasificacion.imagennivel,
     tbl_lms_clasificacion.textonivel,
     tbl_lms_clasificacion.descripcionnivel,
     tbl_lms_clasificacion.opcional,
     tbl_lms_clasificacion.inactivo,

     tbl_lms_clasificacion.color2
from
     rel_lms_malla_curso
inner JOIN tbl_lms_curso ON tbl_lms_curso.id = rel_lms_malla_curso.id_curso
inner JOIN tbl_lms_malla ON tbl_lms_malla.id = rel_lms_malla_curso.id_malla




inner JOIN tbl_lms_clasificacion ON tbl_lms_clasificacion.id_clasificacion = rel_lms_malla_curso.id_clasificacion
where
     rel_lms_malla_curso.id_malla = '$malla' and tbl_lms_curso.id_empresa='$id_empresa' and tbl_lms_clasificacion.id_empresa='$id_empresa'
     $filtro_id_clasificacion
AND
     rel_lms_malla_curso.id_curso = tbl_lms_curso.id
AND (tbl_lms_clasificacion.opcional is null or tbl_lms_clasificacion.opcional='')
order BY
     tbl_lms_clasificacion.orden ASC
     ";

     //echo $sql; exit();
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function CAPACITACION_malla_porUsuario($rut, $id_malla, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    if ($id_malla) {
        $filtro_malla = " and rel_lms_malla_persona.id_malla='$id_malla'";
    }
    $sql = "SELECT
     rel_lms_malla_persona.*,
     tbl_lms_malla.nombre as nombre_malla,
     tbl_lms_malla.descripcion as descripcion_malla,


     tbl_lms_malla.template as template_malla,






     tbl_lms_malla.columnas_clasificacion
from
     rel_lms_malla_persona
left join tbl_lms_malla on tbl_lms_malla.id=rel_lms_malla_persona.id_malla
where
     rut = '$rut' $filtro_malla
     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function CAPACITACION_clasificacionesPorMallaClasificacionOpcional($malla, $id_empresa, $id_clasificacion)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $filtro_id_clasificacion = "";
    if ($id_clasificacion) {
        $filtro_id_clasificacion = " and rel_lms_malla_curso.id_clasificacion='$id_clasificacion'";
    }
    $sql = "


     SELECT DISTINCT
     (rel_lms_malla_curso.id_clasificacion),
     tbl_lms_clasificacion.clasificacion AS nombre_clasificacion,
     tbl_lms_clasificacion.descripcion AS descripcion_clasificacion,
     tbl_lms_clasificacion.color,
     tbl_lms_clasificacion.imagen,
     tbl_lms_clasificacion.imagen_back,
     tbl_lms_clasificacion.color2
from
     rel_lms_malla_curso
inner JOIN tbl_lms_curso ON tbl_lms_curso.id = rel_lms_malla_curso.id_curso
inner JOIN tbl_lms_malla ON tbl_lms_malla.id = rel_lms_malla_curso.id_malla




inner JOIN tbl_lms_clasificacion ON tbl_lms_clasificacion.id_clasificacion = rel_lms_malla_curso.id_clasificacion
where
     rel_lms_malla_curso.id_malla = '$malla' and tbl_lms_curso.id_empresa='$id_empresa' and tbl_lms_clasificacion.id_empresa='$id_empresa'
     $filtro_id_clasificacion
AND
     rel_lms_malla_curso.id_curso = tbl_lms_curso.id
AND tbl_lms_clasificacion.opcional = 1
order BY
     tbl_lms_clasificacion.orden ASC
     ";  // echo $sql;
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function CAPACITACION_DatosGeneralesPorUsuario($rut, $filtros_desde_admin)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = " select h.* from rel_lms_malla_persona h where h.rut='$rut'     ";
    $database->setquery($sql);
    $database->query();
    $malla         = $database->listObjects();
    $id_malla      = $malla[0]->id_malla;
    $sumaTodos     = 0;
    $sumaAprobado  = 0;
    $sumaReprobado = 0;
    $sumaProceso   = 0;
    if ($filtros_desde_admin["curso"]) {
        $filtro_curso = " and h.id_curso='" . $filtros_desde_admin["curso"] . "'";
    } else {
        $filtro_curso = "";
    }
    $sql = " select
     h.*,
     (select estado from tbl_inscripcion_cierre where rut='$rut' and id_curso=h.id_curso limit 1) as estado


     from rel_lms_malla_curso h


     where h.id_malla='$id_malla' $filtro_curso  and h.opcional is null";

//      echo $sql;
    $database->setquery($sql);
    $database->query();
    $curso = $database->listObjects();
    foreach ($curso as $curso_unico) {
        if ($curso_unico->estado == 1) {
            $sumaAprobado++;
        }
        if ($insccierre_unico->estado === "0") {
            $sumaReprobado++;
        }
        if ($curso_unico->estado == 3) {
            $sumaProceso++;
        }
        $sumaTodos++;
    }
    if (count($curso) == 0) {
        $sql = "select estado from tbl_inscripcion_cierre where rut='$rut' ";
        $database->setquery($sql);
        $database->query();
        $insccierre = $database->listObjects();
        foreach ($insccierre as $insccierre_unico) {
            if ($insccierre_unico->estado == 1) {
                $sumaAprobado++;
            }
            if ($insccierre_unico->estado === "0") {
                $sumaReprobado++;
            }
            if ($insccierre_unicoSM->estado == 3) {
                $sumaProceso++;
            }
            $sumaTodos++;
        }
    }
    return array(
        $sumaTodos,
        $sumaAprobado,
        $sumaReprobado,
        $sumaProceso
    );
}
function TraeDatosPorFeedback($evaluado, $evaluador, $id_proceso)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_sgd_feedback_evaluado where evaluado='$evaluado' and evaluador='$evaluador' and id_proceso='$id_proceso'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function InsertaFeedbackEvaluadoFinalizado($evaluado, $evaluador, $id_proceso, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $fecha = date("Y-m-d");
    $hora  = date("H:i:s");
    $sql   = "insert into tbl_sgd_feedback_finalizado
     (evaluado, evaluador, id_proceso, id_empresa, fecha, hora) values
     ('$evaluado', '$evaluador', '$id_proceso', '$id_empresa', '$fecha', '$hora')";
    $database->setquery($sql);
    $database->query();
}
function InsertaFeedbackEvaluado($evaluado, $evaluador, $id_proceso, $id_empresa, $realizado, $pregunta1, $pregunta2, $pregunta3, $pregunta4)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $fecha = date("Y-m-d");
    $hora  = date("H:i:s");
    $sql   = "insert into tbl_sgd_feedback_evaluado
     (evaluado, evaluador, id_proceso, id_empresa, realizado, pregunta1, pregunta2, pregunta3, pregunta4, fecha, hora) values
     ('$evaluado', '$evaluador', '$id_proceso', '$id_empresa', '$realizado', '$pregunta1', '$pregunta2', '$pregunta3', '$pregunta4', '$fecha', '$hora')";
    $database->setquery($sql);
    $database->query();
}
function VErificaFeedbackFinalizado($evaluado, $evaluador, $id_proceso, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_sgd_feedback_finalizado where evaluado='$evaluado' and evaluador='$evaluador' and id_proceso='$id_proceso' and id_empresa='$id_empresa'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function PromedioPorCompetenciaDadoEvaluadoEvaluadoProcesoIdCOmpReporte($evaluado, $evaluador, $id_proceso, $id_componente_reporte)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
     select avg(puntaje) as promedio_comp from tbl_sgd_respuestas
inner join tbl_sgd_componente
on tbl_sgd_componente.id=tbl_sgd_respuestas.id_competencia
where evaluado='$evaluado' and evaluador='$evaluador' and id_proceso='$id_proceso' and tbl_sgd_componente.id_componente_reporte='$id_componente_reporte'


     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TotalIdCompetenciasSoloCompetencias($sql)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
     SELECT
     distinct(tbl_sgd_componente.id), nombre, descripcion, id_dimension, id_componente_reporte, sigla
from
     rel_sgd_perfil_competencias
inner JOIN tbl_sgd_componente ON tbl_sgd_componente.id = rel_sgd_perfil_competencias.id_componente
where
     $sql
order BY
     tbl_sgd_componente.nombre ASC
     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function DAtosEvaluadoEvaluadorParaAvancePorEvaluadoEvaluador($evaluador, $id_proceso, $evaluado)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "SELECT
     tbl_sgd_relaciones.evaluado,
     tbl_sgd_relaciones.evaluador,
     pagina,
     tbl_usuario.perfil_evaluacion,
     (
     SELECT
     count(tbl_sgd_preguntas.id)AS total_preguntas
     FROM
     rel_sgd_perfil_competencias
     INNER JOIN tbl_sgd_componente ON tbl_sgd_componente.id = rel_sgd_perfil_competencias.id_componente
     INNER JOIN tbl_sgd_preguntas ON tbl_sgd_preguntas.id_competencia = tbl_sgd_componente.id
     WHERE
     perfil_evaluacion = tbl_usuario.perfil_evaluacion
     )AS total_preguntas




FROM
     tbl_sgd_relaciones
left JOIN tbl_sgd_sesion_evaluacion ON tbl_sgd_sesion_evaluacion.evaluador = '$evaluador'
and tbl_sgd_sesion_evaluacion.id_proceso = '$id_proceso'
INNER JOIN tbl_usuario ON tbl_usuario.rut = tbl_sgd_relaciones.evaluado
WHERE
     tbl_sgd_relaciones.evaluador = '$evaluador' and tbl_sgd_relaciones.evaluado = '$evaluado'
and tbl_sgd_relaciones.id_proceso = '$id_proceso'
";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function DAtosEvaluadoEvaluadorParaAvancePorIdProcesoAnual($id_anual)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "SELECT
     tbl_sgd_relaciones.evaluado,
     tbl_sgd_relaciones.evaluador,
     pagina,
     tbl_sgd_relaciones.perfil_evaluacion_competencias as perfil_evaluacion,
     (
     SELECT
     count(tbl_sgd_preguntas.id)AS total_preguntas
     FROM
     rel_sgd_perfil_competencias
     INNER JOIN tbl_sgd_componente ON tbl_sgd_componente.id = rel_sgd_perfil_competencias.id_componente
     INNER JOIN tbl_sgd_preguntas ON tbl_sgd_preguntas.id_competencia = tbl_sgd_componente.id
     WHERE
     perfil_evaluacion = tbl_sgd_relaciones.perfil_evaluacion_competencias
     )AS total_preguntas,
tbl_sgd_proceso_evaluacion.id_proceso_anual
FROM
     tbl_sgd_relaciones
left JOIN tbl_sgd_sesion_evaluacion ON tbl_sgd_sesion_evaluacion.evaluador = tbl_sgd_relaciones.evaluador
and tbl_sgd_sesion_evaluacion.id_proceso = tbl_sgd_relaciones.id_proceso
INNER JOIN tbl_usuario ON tbl_usuario.rut = tbl_sgd_relaciones.evaluado
INNER JOIN tbl_usuario AS base_evaluador ON base_evaluador.rut = tbl_sgd_relaciones.evaluador
inner join tbl_sgd_proceso_evaluacion on tbl_sgd_proceso_evaluacion.id_proceso=tbl_sgd_relaciones.id_proceso
where tbl_sgd_proceso_evaluacion.id_proceso_anual='$id_anual'
";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function DAtosEvaluadoEvaluadorParaAvancePorSoloProceso($id_proceso)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "SELECT
     tbl_sgd_relaciones.evaluado,
     tbl_sgd_relaciones.evaluador,
     pagina,
     tbl_sgd_relaciones.perfil_evaluacion_competencias as perfil_evaluacion,
     (
     SELECT
     count(tbl_sgd_preguntas.id)AS total_preguntas
     FROM
     rel_sgd_perfil_competencias
     INNER JOIN tbl_sgd_componente ON tbl_sgd_componente.id = rel_sgd_perfil_competencias.id_componente
     INNER JOIN tbl_sgd_preguntas ON tbl_sgd_preguntas.id_competencia = tbl_sgd_componente.id
     WHERE
     perfil_evaluacion = tbl_sgd_relaciones.perfil_evaluacion_competencias
     )AS total_preguntas
FROM
     tbl_sgd_relaciones
left JOIN tbl_sgd_sesion_evaluacion ON tbl_sgd_sesion_evaluacion.evaluador = tbl_sgd_relaciones.evaluador
and tbl_sgd_sesion_evaluacion.id_proceso = '$id_proceso'
INNER JOIN tbl_usuario ON tbl_usuario.rut = tbl_sgd_relaciones.evaluado
INNER JOIN tbl_usuario AS base_evaluador ON base_evaluador.rut = tbl_sgd_relaciones.evaluador
WHERE
     tbl_sgd_relaciones.id_proceso = '$id_proceso'
";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function DAtosEvaluadoEvaluadorParaAvancePorEvaluador($evaluador, $id_proceso)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "SELECT
     tbl_sgd_relaciones.evaluado,
     tbl_sgd_relaciones.evaluador,
     pagina,
     tbl_usuario.perfil_evaluacion,
     (
     SELECT
     count(tbl_sgd_preguntas.id)AS total_preguntas
     FROM
     rel_sgd_perfil_competencias
     INNER JOIN tbl_sgd_componente ON tbl_sgd_componente.id = rel_sgd_perfil_competencias.id_componente
     INNER JOIN tbl_sgd_preguntas ON tbl_sgd_preguntas.id_competencia = tbl_sgd_componente.id
     WHERE
     perfil_evaluacion = tbl_usuario.perfil_evaluacion
     )AS total_preguntas




FROM
     tbl_sgd_relaciones
left JOIN tbl_sgd_sesion_evaluacion ON tbl_sgd_sesion_evaluacion.evaluador = '$evaluador'
and tbl_sgd_sesion_evaluacion.id_proceso = '$id_proceso'
INNER JOIN tbl_usuario ON tbl_usuario.rut = tbl_sgd_relaciones.evaluado
WHERE
     tbl_sgd_relaciones.evaluador = '$evaluador'
and tbl_sgd_relaciones.id_proceso = '$id_proceso'
";
    $sql = "SELECT
     tbl_sgd_relaciones.evaluado,
     tbl_sgd_relaciones.evaluador,
     pagina,
     tbl_usuario.perfil_evaluacion,
     (
     SELECT
     count(tbl_sgd_preguntas.id)AS total_preguntas
     FROM
     rel_sgd_perfil_competencias
     INNER JOIN tbl_sgd_componente ON tbl_sgd_componente.id = rel_sgd_perfil_competencias.id_componente
     INNER JOIN tbl_sgd_preguntas ON tbl_sgd_preguntas.id_competencia = tbl_sgd_componente.id
     WHERE
     perfil_evaluacion = tbl_usuario.perfil_evaluacion
     )AS total_preguntas




FROM
     tbl_sgd_relaciones
left JOIN tbl_sgd_sesion_evaluacion ON tbl_sgd_sesion_evaluacion.evaluador = '$evaluador'
and tbl_sgd_sesion_evaluacion.id_proceso = '$id_proceso' and tbl_sgd_sesion_evaluacion.evaluado=tbl_sgd_relaciones.evaluado
INNER JOIN tbl_usuario ON tbl_usuario.rut = tbl_sgd_relaciones.evaluado
WHERE
     tbl_sgd_relaciones.evaluador = '$evaluador'
and tbl_sgd_relaciones.id_proceso = '$id_proceso'
";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function DAtosEvaluadoEvaluadorParaAvancePorEvaluadorV2($evaluador, $id_proceso)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sqlBK_SGD = "SELECT
     tbl_usuario.nombre_completo,
     tbl_usuario.perfil_evaluacion,
     tbl_sgd_relaciones.evaluado,
     tbl_sgd_relaciones.evaluador,
     (
     SELECT
     count(tbl_sgd_preguntas.id)AS total_preguntas
     FROM
     rel_sgd_perfil_competencias
     INNER JOIN tbl_sgd_componente ON tbl_sgd_componente.id = rel_sgd_perfil_competencias.id_componente
     INNER JOIN tbl_sgd_preguntas ON tbl_sgd_preguntas.id_competencia = tbl_sgd_componente.id
     WHERE
     perfil_evaluacion = tbl_usuario.perfil_evaluacion
     )AS total_preguntas,
     (
     SELECT
     count(tbl_sgd_respuestas.id) as total
     FROM
     tbl_sgd_respuestas
     INNER JOIN rel_sgd_perfil_competencias ON rel_sgd_perfil_competencias.id_componente = tbl_sgd_respuestas.id_competencia
     WHERE
     tbl_sgd_respuestas.evaluado = tbl_usuario.rut
     AND tbl_sgd_respuestas.evaluador = '$evaluador'
     AND rel_sgd_perfil_competencias.perfil_evaluacion = tbl_usuario.perfil_evaluacion
     ) as pagina
FROM
     tbl_sgd_relaciones
INNER JOIN tbl_usuario ON tbl_usuario.rut = tbl_sgd_relaciones.evaluado
WHERE
     tbl_sgd_relaciones.evaluador = '$evaluador'
and tbl_sgd_relaciones.id_proceso = '$id_proceso'
";
    $sql       = "SELECT
     tbl_usuario.nombre_completo,
     tbl_sgd_relaciones.perfil_evaluacion_competencias as perfil_evaluacion,
     tbl_sgd_relaciones.evaluado,
     tbl_sgd_relaciones.evaluador,
     (
     SELECT
     count(tbl_sgd_preguntas.id)AS total_preguntas
     FROM
     rel_sgd_perfil_competencias
     INNER JOIN tbl_sgd_componente ON tbl_sgd_componente.id = rel_sgd_perfil_competencias.id_componente
     INNER JOIN tbl_sgd_preguntas ON tbl_sgd_preguntas.id_competencia = tbl_sgd_componente.id
     WHERE
     perfil_evaluacion = tbl_sgd_relaciones.perfil_evaluacion_competencias
     )AS total_preguntas,
     (
     SELECT
     count(tbl_sgd_respuestas.id) as total
     FROM
     tbl_sgd_respuestas
     INNER JOIN rel_sgd_perfil_competencias
     ON rel_sgd_perfil_competencias.id_componente = tbl_sgd_respuestas.id_competencia
     WHERE
     tbl_sgd_respuestas.evaluado = tbl_usuario.rut
     AND tbl_sgd_respuestas.evaluador = '$evaluador'
     and tbl_sgd_respuestas.id_proceso='$id_proceso'
     AND rel_sgd_perfil_competencias.perfil_evaluacion = tbl_sgd_relaciones.perfil_evaluacion_competencias
     ) as pagina
FROM
     tbl_sgd_relaciones
INNER JOIN tbl_usuario ON tbl_usuario.rut = tbl_sgd_relaciones.evaluado
WHERE
     tbl_sgd_relaciones.evaluador = '$evaluador'
and tbl_sgd_relaciones.id_proceso = '$id_proceso'
";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function DAtosEvaluadoEvaluadorParaAvancePorEvaluadorPorCriterios($id_proceso, $campo_criterio, $valor_criterio, $tipo_resumen)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    if ($tipo_resumen == "evaluadoEvaluador") {
        $tabla = "tbl_usuario";
    } else {
        $tabla = "base_evaluador";
    }
    $sql = "SELECT
     tbl_sgd_relaciones.evaluado, tbl_sgd_relaciones.evaluador, pagina, tbl_usuario.perfil_evaluacion,
     (SELECT count(tbl_sgd_preguntas.id)AS total_preguntas
     FROM rel_sgd_perfil_competencias
     INNER JOIN tbl_sgd_componente ON tbl_sgd_componente.id = rel_sgd_perfil_competencias.id_componente
     INNER JOIN tbl_sgd_preguntas ON tbl_sgd_preguntas.id_competencia = tbl_sgd_componente.id
     WHERE perfil_evaluacion = tbl_usuario.perfil_evaluacion )AS total_preguntas
FROM
     tbl_sgd_relaciones
left JOIN tbl_sgd_sesion_evaluacion ON tbl_sgd_sesion_evaluacion.evaluador = tbl_sgd_relaciones.evaluador
and tbl_sgd_sesion_evaluacion.id_proceso = '$id_proceso'
INNER JOIN tbl_usuario ON tbl_usuario.rut = tbl_sgd_relaciones.evaluado
inner join tbl_usuario as base_evaluador on base_evaluador.rut=tbl_sgd_relaciones.evaluador
WHERE


tbl_sgd_relaciones.id_proceso = '$id_proceso' and $tabla.$campo_criterio='$valor_criterio'
";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ActualizaComentarioPorCompetencia($evaluado, $evaluador, $id_competencia, $id_empresa, $id_proceso, $comentario)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "update tbl_sgd_comentario_competencia
     set
     comentario='$comentario'
     where evaluado='$evaluado'
     and evaluador='$evaluador'
     and id_competencia='$id_competencia'
     and id_empresa='$id_empresa'
     and id_proceso='$id_proceso'";
    $database->setquery($sql);
    $database->query();
}
function InsertaComentarioPorCompetencia($evaluado, $evaluador, $id_competencia, $id_empresa, $id_proceso, $comentario)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $fecha = date("Y-m-d");
    $hora  = date("H:i:s");
    $sql   = "insert into tbl_sgd_comentario_competencia
     (evaluado, evaluador, id_competencia, id_empresa, id_proceso, comentario, fecha, hora) values
     ('$evaluado', '$evaluador', '$id_competencia', '$id_empresa', '$id_proceso', '$comentario', '$fecha', '$hora')";
    $database->setquery($sql);
    $database->query();
}
function TieneComentarioPorCompetencia($evaluado, $evaluador, $id_competencia, $id_empresa, $id_proceso)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "


     select * from tbl_sgd_comentario_competencia where evaluado='$evaluado' and evaluador='$evaluador' and id_competencia='$id_competencia' and id_empresa='$id_empresa' and id_proceso='$id_proceso'


";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TieneComentarioPorCompetenciaEvaluadoEvaluador($evaluado, $evaluador, $id_empresa, $id_proceso)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "


     select * from tbl_sgd_comentario_competencia where evaluado='$evaluado' and evaluador='$evaluador'  and id_empresa='$id_empresa' and id_proceso='$id_proceso' order by id_competencia asc


";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TraeObjetivosIndividualesDadoRutConPondV2($rut)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
     SELECT
     tbl_objetivos_individuales.*
FROM
     tbl_objetivos_individuales
WHERE
     rut = '$rut' and tbl_objetivos_individuales.dimension<>70
order BY
     tbl_objetivos_individuales.id DESC";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TraeObjetivosIndividualesDadoRutConPond($rut)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
     select tbl_objetivos_individuales.*, tbl_objetivos_dimension.nombre as nombre_dimension
     from tbl_objetivos_individuales
     inner join tbl_objetivos_dimension
     on tbl_objetivos_dimension.id=tbl_objetivos_individuales.dimension
     where rut='$rut' and ponderacion is not null order by tbl_objetivos_individuales.id desc";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TraeObjetivosIndividualesDadoRutSinPond($rut)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
     select tbl_objetivos_individuales.*, tbl_objetivos_dimension.nombre as nombre_dimension
     from tbl_objetivos_individuales
     inner join tbl_objetivos_dimension
     on tbl_objetivos_dimension.id=tbl_objetivos_individuales.dimension
     where rut='$rut' and ponderacion is null order by tbl_objetivos_individuales.id desc";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TotalReconocimientosPorCategoriaGenerico($id_categoria, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
     SELECT
     tbl_salonfama_publicados.*, tbl_salonfama_categorias.nombre AS nombre_categoria,
     tbl_salonfama_categorias.titulo_listado AS titulo_pagina,
     tbl_salonfama_categorias.descripcion AS descripcion_categoria,
     imagen,
     tbl_usuario.nombre,
     tbl_usuario.apaterno,
     tbl_usuario.amaterno,
     tbl_usuario.nombre_completo,
     tbl_usuario.cargo,
     tbl_salonfama_categorias.template_row AS template_row,
     tbl_salonfama_categorias.imagen_form,
     tbl_salonfama_categorias.imagen_inicio_pagina


FROM
     tbl_salonfama_publicados
INNER JOIN tbl_salonfama_categorias ON tbl_salonfama_categorias.id = tbl_salonfama_publicados.id_tipo_reconocimiento
INNER JOIN tbl_usuario ON tbl_usuario.rut = tbl_salonfama_publicados.rut
WHERE
     idempresa = '$id_empresa'
and id_tipo_reconocimiento = '$id_categoria'
order BY


     tbl_salonfama_publicados.id DESC


";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TraeEvaluadosDadoEvaluadorPorProceso2PorCalibradorSinAe($rut_calibrador, $id_proceso)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
     SELECT
     evaluado AS rut,
     tbl_sgd_relaciones.evaluador, perfil_evaluacion, id_proceso
FROM
     tbl_sgd_relaciones
INNER JOIN tbl_usuario ON tbl_usuario.rut = evaluado
WHERE
     tbl_sgd_relaciones.calibrador = '$rut_calibrador' and tbl_sgd_relaciones.id_proceso='$id_proceso' and tbl_sgd_relaciones.evaluado<>tbl_sgd_relaciones.evaluador
     order by subperfil, nombre_completo asc
     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TraeEvaluadosDadoEvaluadorPorProceso2PorCalibrador($rut_calibrador, $id_proceso)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
     SELECT
     evaluado AS rut,
     tbl_sgd_relaciones.evaluador, perfil_evaluacion, id_proceso
FROM
     tbl_sgd_relaciones
INNER JOIN tbl_usuario ON tbl_usuario.rut = evaluado
WHERE
     tbl_sgd_relaciones.calibrador = '$rut_calibrador' and tbl_sgd_relaciones.id_proceso='$id_proceso'
     order by subperfil, nombre_completo asc
     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TraeLiberadoEvaluadoEvaluadorProceso($evaluado, $evaluador, $id_proceso)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_calibracion_liberados where evaluado='$evaluado' and evaluador='$evaluador' and id_proceso='$id_proceso'    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TraeLiberadoEvaluadoEvaluadorCalibrador($evaluado, $evaluador, $calibrador, $id_proceso)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_calibracion_liberados where evaluado='$evaluado' and evaluador='$evaluador' and calibrador='$calibrador' and id_proceso='$id_proceso'    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TraigoRespuestasCrucePreguntasPorRangosMenorYMayorPorCalibrador($calibrador, $id_proceso, $rango_menor, $rango_mayor)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
     select tbl_sgd_respuestas.*
     from tbl_sgd_respuestas
     inner join tbl_sgd_preguntas
     on tbl_sgd_preguntas.id=tbl_sgd_respuestas.id_pregunta
     inner join tbl_sgd_relaciones
     on tbl_sgd_relaciones.evaluado=tbl_sgd_respuestas.evaluado
     and tbl_sgd_relaciones.evaluador=tbl_sgd_respuestas.evaluador
     and tbl_sgd_relaciones.id_proceso=tbl_sgd_respuestas.id_proceso


     where tbl_sgd_relaciones.calibrador='$calibrador' and tbl_sgd_respuestas.id_proceso='$id_proceso' and (tbl_sgd_respuestas.puntaje>=$rango_menor and tbl_sgd_respuestas.puntaje<=$rango_mayor)
     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TraigoRespuestasCrucePreguntasPorCalibrador($calibrador, $id_proceso)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
     SELECT
     tbl_sgd_respuestas.*
FROM
     tbl_sgd_respuestas
INNER JOIN tbl_sgd_preguntas ON tbl_sgd_preguntas.id = tbl_sgd_respuestas.id_pregunta
inner join tbl_sgd_relaciones on tbl_sgd_respuestas.evaluado=tbl_sgd_relaciones.evaluado and tbl_sgd_respuestas.evaluador = tbl_sgd_relaciones.evaluador and tbl_sgd_respuestas.id_proceso=tbl_sgd_relaciones.id_proceso


WHERE
     calibrador = '$calibrador'
and tbl_sgd_respuestas.id_proceso = '$id_proceso'
     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TraigoRespuestasCrucePreguntasPorCalibradorSinAe($calibrador, $id_proceso)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
     SELECT
     tbl_sgd_respuestas.*
FROM
     tbl_sgd_respuestas
INNER JOIN tbl_sgd_preguntas ON tbl_sgd_preguntas.id = tbl_sgd_respuestas.id_pregunta
inner join tbl_sgd_relaciones on tbl_sgd_respuestas.evaluado=tbl_sgd_relaciones.evaluado and tbl_sgd_respuestas.evaluador = tbl_sgd_relaciones.evaluador and tbl_sgd_respuestas.id_proceso=tbl_sgd_relaciones.id_proceso


WHERE
     calibrador = '$calibrador'
and tbl_sgd_respuestas.id_proceso = '$id_proceso' and tbl_sgd_respuestas.evaluado<>tbl_sgd_respuestas.evaluador
     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ObtengoCompetenciasDadoPerfilInnerCompetencia($perfil)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
     SELECT
     tbl_sgd_componente.nombre
FROM
     rel_sgd_perfil_competencias


inner join tbl_sgd_componente on tbl_sgd_componente.id=rel_sgd_perfil_competencias.id_componente
WHERE
     perfil_evaluacion = $perfil";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ObtengoCompetenciasDadoPerfil($perfil)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
     select * from rel_sgd_perfil_competencias where perfil_evaluacion='$perfil'    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function InsertaLiberadosDesdeCalibracion($evaluado, $evaluador, $validador, $calibrador, $id_proceso)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $fecha = date("Y-m-d");
    $hora  = date("H:i:s");
    $sql   = "insert into tbl_calibracion_liberados (evaluado, evaluador, validador, calibrador, id_proceso, fecha, hora) values ('$evaluado', '$evaluador', '$validador', '$calibrador', '$id_proceso', '$fecha', '$hora')";
    $database->setquery($sql);
    $database->query();
}
function TraeCantidadLiberadosPorEvaluador($rut_evaluador, $id_proceso)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
     select * from tbl_calibracion_liberados where evaluador='$rut_evaluador' and id_proceso='$id_proceso'
     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TraeCantidadLiberadosPorCalibrador($rut_calibrador, $id_proceso)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
     select * from tbl_calibracion_liberados where calibrador='$rut_calibrador' and id_proceso='$id_proceso'
     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TraeRelacionesSinAeCalibrador($calibrador, $id_proceso)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
     select * from tbl_sgd_relaciones where id_proceso='$id_proceso' and calibrador='$calibrador' and evaluado<>evaluador
     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TraeRelacionesSinAeConDatos($evaluador, $id_proceso)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
     SELECT
     tbl_sgd_relaciones.*, baseevaluado.nombre_completo, baseevaluado.sucursal,
     baseevaluado.perfil_competencia,
     baseevaluado.fecha_ingreso as fecha_ingreso_evaluado,
     baseevaluado.cargo as cargo_evaluado,
     baseevaluador.nombre_completo AS nombre_evaluador_1,
     basevalidador.nombre_completo AS nombre_validador
FROM
     tbl_sgd_relaciones
INNER JOIN tbl_usuario AS baseevaluado ON baseevaluado.rut = tbl_sgd_relaciones.evaluado
INNER JOIN tbl_usuario AS baseevaluador ON baseevaluador.rut = tbl_sgd_relaciones.evaluador
left JOIN tbl_usuario AS basevalidador ON basevalidador.rut = tbl_sgd_relaciones.validador
WHERE
     tbl_sgd_relaciones.id_proceso = '$id_proceso'
and tbl_sgd_relaciones.evaluador = '$evaluador'
and tbl_sgd_relaciones.evaluado <> tbl_sgd_relaciones.evaluador


order by baseevaluado.sucursal desc, baseevaluado.nombre_completo asc
     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TraeRelacionesSinAe($evaluador, $id_proceso)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
     select tbl_sgd_relaciones.*
     from tbl_sgd_relaciones
     inner join tbl_usuario
     on tbl_sgd_relaciones.evaluado=tbl_usuario.rut
     where tbl_sgd_relaciones.id_proceso='$id_proceso'
     and tbl_sgd_relaciones.evaluador='$evaluador'
     and tbl_sgd_relaciones.evaluado<>tbl_sgd_relaciones.evaluador
     and (
     tbl_usuario.perfil_evaluacion='' or
     tbl_usuario.perfil_evaluacion is null or
     tbl_usuario.perfil_evaluacion='SI')


     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TraeRelacionesSinAeSinProceso($evaluador)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
     SELECT
     tbl_sgd_relaciones.evaluado,
     baseevaluado.nombre_completo,
     baseevaluado.cargo as cargo_evaluado,
     baseevaluado.fecha_ingreso as fecha_ingreso_evaluado
FROM
     tbl_sgd_relaciones
INNER JOIN tbl_usuario AS baseevaluado ON baseevaluado.rut = tbl_sgd_relaciones.evaluado
WHERE
     tbl_sgd_relaciones.evaluador = '$evaluador'
and tbl_sgd_relaciones.evaluado <> tbl_sgd_relaciones.evaluador
     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TraeCantidadDeCalibracionesPorEvaluadorSinAe($rut_calibrador, $id_proceso, $evaluador)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
     select * from tbl_sgd_relaciones where calibrador='$rut_calibrador' and id_proceso='$id_proceso' and evaluador='$evaluador' and evaluado<>evaluador
     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TraeCantidadDeCalibracionesPorEvaluador($rut_calibrador, $id_proceso, $evaluador)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
     select * from tbl_sgd_relaciones where calibrador='$rut_calibrador' and id_proceso='$id_proceso' and evaluador='$evaluador'
     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TraeCantidadDeCalibraciones($rut_calibrador, $id_proceso)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
     select * from tbl_sgd_relaciones where calibrador='$rut_calibrador' and id_proceso='$id_proceso'
     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TraeCantidadDeCalibracionesSinAe($rut_calibrador, $id_proceso)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
     select * from tbl_sgd_relaciones where calibrador='$rut_calibrador' and id_proceso='$id_proceso' and evaluado<>evaluador
     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TraigoRespuestasCrucePreguntasPorRangosMenorYMayorPorEvaluado($evaluador, $id_proceso, $rango_menor, $rango_mayor, $evaluado)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
     select tbl_sgd_respuestas.*
     from tbl_sgd_respuestas
     inner join tbl_sgd_preguntas
     on tbl_sgd_preguntas.id=tbl_sgd_respuestas.id_pregunta
     where evaluador='$evaluador' and evaluado='$evaluado' and id_proceso='$id_proceso' and (puntaje>=$rango_menor and puntaje<=$rango_mayor)
     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TraigoRespuestasCrucePreguntasPorEvaluado($evaluador, $id_proceso, $evaluado)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
     select tbl_sgd_respuestas.*
     from tbl_sgd_respuestas
     inner join tbl_sgd_preguntas
     on tbl_sgd_preguntas.id=tbl_sgd_respuestas.id_pregunta
     where evaluador='$evaluador' and id_proceso='$id_proceso' and evaluado='$evaluado'
     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TitulosDinamicosPorEmpresaEnv($id_empresa, $case)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_case_titulo where id_empresa='$id_empresa' and sw='$case' ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TraeEvaluadoresPorProcesoDadoCalibrador($rut, $id_proceso)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
     SELECT
     distinct(tbl_sgd_relaciones.evaluador) as rut,


     perfil_evaluacion
FROM
     tbl_sgd_relaciones
INNER JOIN tbl_usuario ON tbl_usuario.rut = tbl_sgd_relaciones.evaluador
WHERE
     tbl_sgd_relaciones.calibrador = '$rut' and tbl_sgd_relaciones.id_proceso='$id_proceso'   and tbl_sgd_relaciones.evaluado<>tbl_sgd_relaciones.evaluador
     order by nombre_completo asc
     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function VerificaBitacorasPositivasNegativas($rut, $valor)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_bitacora_textos WHERE evaluado='$rut' and realizado='$valor' ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function VerificoEnTablaDeDirectores($rut, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_rut_directores_reportes_directos WHERE rut='$rut' and id_empresa='$id_empresa' ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function VerificaUsuarioMundo($rut, $campo, $valor, $operador_logico)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_mundos where id='$id_mundo'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function DatosPorIdDeMundo($id_mundo)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
     select * from tbl_mundos where id='$id_mundo'    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TraeSubCarpetasPerfiladas($id, $rut)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $datos_usuario = UsuarioEnBasePersonas($rut, $rutcontodo);
    $sql           = "
select
     tbl_galeria.*,tbl_mundos.nombre as nombre_mundos, tbl_comunidades.nombre as nombre_comunidades
FROM
     tbl_galeria


left join tbl_mundos
on tbl_mundos.id=tbl_galeria.id_mundo


left JOIN tbl_comunidades
on tbl_comunidades.id=tbl_galeria.id_comunidad




WHERE
     tbl_galeria.id_categoria = '$id'
order BY
     tbl_galeria.id DESC
     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TraeSlidersPorNoticias($id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    if ($id_empresa == 22) {
        $datos_usuario_session = UsuarioEnBasePersonas($_SESSION["user_"], $rutcontodo);
        if ($datos_usuario_session[0]->unidad_negocio == "Sucursales") {
            $filtro_mundo = "and (tbl_noticias.id_mundo='0' or tbl_noticias.id_mundo='2')";
        } else if ($datos_usuario_session[0]->unidad_negocio == "Santiago") {
            $filtro_mundo = "and (tbl_noticias.id_mundo='0' or tbl_noticias.id_mundo='1')";
        }
    }
    $sql = "
     select *
     from tbl_noticias
     where id_empresa='$id_empresa' and slider_activo>0
     and estado='1'  $filtro_mundo
     order by slider_activo, id asc";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TraeSlidersPorNoticiasBK($id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
     select *
     from tbl_noticias
     where id_empresa='$id_empresa'
     and slider_activo>0
     and estado='1'


     order by slider_activo asc";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function PreguntaEncuestaParaTNT()
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
     select tbl_objeto_pregunta.*
     from tbl_objeto_pregunta
where
i    d_empresa='22'
";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function PreguntaEncuestaParaPorEmpresa($id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
     select tbl_objeto_pregunta.*
     from tbl_objeto_pregunta
where
i    d_empresa='$id_empresa' and activo='1'
";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TotalPerfilesDadoEvaluador1PorProcesoPorCalibrador($calibrador, $id_proceso)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sqlBK_SGD = "select distinct(tbl_usuario.perfil_evaluacion) as id_perfil_ev
     from tbl_sgd_relaciones
     inner join tbl_usuario
     on tbl_usuario.rut=tbl_sgd_relaciones.evaluado
     where tbl_sgd_relaciones.calibrador='$calibrador' and tbl_sgd_relaciones.id_proceso='$id_proceso'
     ";
    $sql       = "select distinct(tbl_sgd_relaciones.perfil_evaluacion_competencias) as id_perfil_ev
     from tbl_sgd_relaciones
     where tbl_sgd_relaciones.calibrador='$calibrador'
     and tbl_sgd_relaciones.id_proceso='$id_proceso'
     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TotalPerfilesDadoEvaluador1PorProceso($evaluador, $id_proceso)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sqlBK_SGD = "select distinct(tbl_usuario.perfil_evaluacion) as id_perfil_ev
     from tbl_sgd_relaciones
     inner join tbl_usuario
     on tbl_usuario.rut=tbl_sgd_relaciones.evaluado
     where tbl_sgd_relaciones.evaluador='$evaluador' and tbl_sgd_relaciones.id_proceso='$id_proceso'
     ";
    $sql       = "SELECT DISTINCT
     (
     tbl_sgd_relaciones.perfil_evaluacion_competencias
     )AS id_perfil_ev
FROM
     tbl_sgd_relaciones


WHERE
     tbl_sgd_relaciones.evaluador = '$evaluador'
and tbl_sgd_relaciones.id_proceso = '$id_proceso'
     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TotalPerfilesDadoEvaluador1PorProcesoEvaluado($evaluador, $id_proceso, $evaluado)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sqlBK_SGD = "select distinct(tbl_usuario.perfil_evaluacion) as id_perfil_ev
     from tbl_sgd_relaciones
     inner join tbl_usuario
     on tbl_usuario.rut=tbl_sgd_relaciones.evaluado
     where tbl_sgd_relaciones.evaluador='$evaluador' and tbl_sgd_relaciones.id_proceso='$id_proceso' and tbl_sgd_relaciones.evaluado='$evaluado'
     ";
    $sql       = "SELECT DISTINCT
     (
     tbl_sgd_relaciones.perfil_evaluacion_competencias
     )AS id_perfil_ev
FROM
     tbl_sgd_relaciones


WHERE
     tbl_sgd_relaciones.evaluador = '$evaluador'
and tbl_sgd_relaciones.id_proceso = '$id_proceso'
and tbl_sgd_relaciones.evaluado = '$evaluado'
     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function EliminoMensajesDeBuzonPorId($id)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = sprintf("DELETE from tbl_mensajes_principal WHERE id = '$id'");
    $database->setquery($sql);
    $database->query();
}
function TiposDestinatariosPorEmpresa($id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "    select nombre, id as tipo_destinatario from tbl_mensajes_destinatarios where id_empresa='$id_empresa' order by orden asc    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TotalMensajesPorRutEmpresaPorTipoDestinatario($rut, $id_empresa, $filtro_destinatario)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "


     select tbl_mensajes_principal.*,
     tbl_usuario.nombre as nombre_creador, tbl_usuario.apaterno, tbl_usuario.amaterno, tbl_mensajes_destinatarios.nombre as nombre_tipo_destinatario,
     tbl_mensaje_tipo.nombre as nombre_titulo,
     (select count(*) as total_respuestas from tbl_mensajes_respuestas where id_mensaje=tbl_mensajes_principal.id) as total_comen
     from tbl_mensajes_principal


     inner join tbl_usuario
     on tbl_usuario.rut=tbl_mensajes_principal.rut_creador


     inner join tbl_mensajes_destinatarios
     on tbl_mensajes_destinatarios.id=tbl_mensajes_principal.id_tipo_destinatario


     inner join tbl_mensaje_tipo
     on tbl_mensaje_tipo.id=tbl_mensajes_principal.tipo_mensaje


     where tbl_mensajes_principal.rut_creador='$rut' and tbl_mensajes_principal.id_empresa='$id_empresa' and tbl_mensajes_principal.id_tipo_destinatario='$filtro_destinatario'


     order by id desc


";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TotalMensajesPorRutDestinatarioPerfilado($rut, $id_empresa, $filtro_destinatario)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "


     SELECT
     tbl_mensajes_principal.*, tbl_usuario.nombre as nombre_creador,
     tbl_usuario.apaterno,
     tbl_usuario.amaterno,
     tbl_mensaje_tipo.nombre AS nombre_titulo,
     tbl_mensajes_destinatarios.nombre AS nombre_tipo_destinatario,
     (select count(*) as total_respuestas from tbl_mensajes_respuestas where id_mensaje=tbl_mensajes_principal.id) as total_comen
FROM
     tbl_mensajes_destinatarios_usuarios
INNER JOIN tbl_mensajes_principal ON tbl_mensajes_principal.id_tipo_destinatario = tbl_mensajes_destinatarios_usuarios.tipo_destinatario
INNER JOIN tbl_usuario ON tbl_usuario.rut = rut_creador
INNER JOIN tbl_mensajes_destinatarios ON tbl_mensajes_destinatarios.id = tbl_mensajes_principal.id_tipo_destinatario
INNER JOIN tbl_mensaje_tipo ON tbl_mensaje_tipo.id = tbl_mensajes_principal.tipo_mensaje
WHERE
     tbl_mensajes_destinatarios_usuarios.rut = '$rut'
and tbl_mensajes_principal.id_empresa = '$id_empresa' and tbl_mensajes_principal.id_tipo_destinatario='$filtro_destinatario'
order by tbl_mensajes_principal.id desc
";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function DAtosDestinatariosPorUsuario($rut, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
     SELECT
     tbl_mensajes_destinatarios_usuarios.*, tbl_mensajes_destinatarios.nombre
FROM
     tbl_mensajes_destinatarios_usuarios


INNER JOIN tbl_mensajes_destinatarios ON tbl_mensajes_destinatarios.id = tbl_mensajes_destinatarios_usuarios.tipo_destinatario WHERE
     rut = '$rut'
     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function DatosCompetenciaDadoId($id_competencia)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
     select * from tbl_sgd_componente where id='$id_competencia'
     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function PerfilesDadoCompetencias($id_competencia)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "    SELECT
     rel_sgd_perfil_competencias.*, tbl_sgd_perfiles_ponderaciones.descripcion as nombre_perfil
FROM
     rel_sgd_perfil_competencias
inner join tbl_sgd_perfiles_ponderaciones
on tbl_sgd_perfiles_ponderaciones.perfil=rel_sgd_perfil_competencias.perfil_evaluacion
WHERE
     id_componente = '$id_competencia'    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function CompetenciasDadoPerfil21($perfil)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
     SELECT
     rel_sgd_perfil_competencias.*, tbl_sgd_componente.nombre AS nombre_componente, tbl_sgd_componente.descripcion AS descripcion_componente,
     tbl_sgd_componente.id_dimension
FROM
     rel_sgd_perfil_competencias
INNER JOIN tbl_sgd_componente ON rel_sgd_perfil_competencias.id_componente = tbl_sgd_componente.id
WHERE
     perfil_evaluacion = '$perfil' order by tbl_sgd_componente.id_dimension
     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function PreguntasPorCompetenciaConRespuestaPorPregunta($id_competencia, $evaluado, $evaluador, $id_proceso, $id_pregunta)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
     SELECT
     tbl_sgd_preguntas.*, tbl_sgd_respuestas.respuesta, tbl_sgd_respuestas.puntaje, tbl_sgd_respuestas.comentario
FROM
     tbl_sgd_preguntas
INNER JOIN tbl_sgd_respuestas ON tbl_sgd_respuestas.id_pregunta = tbl_sgd_preguntas.id
and tbl_sgd_respuestas.evaluado = '$evaluado'
and tbl_sgd_respuestas.evaluador = '$evaluador' and tbl_sgd_respuestas.id_proceso='$id_proceso'
WHERE
     tbl_sgd_preguntas.id_competencia = '$id_competencia' and tbl_sgd_preguntas.id='$id_pregunta'
     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function CompetenciasDadoPerfilPorCompetencia($perfil, $evaluado, $evaluador, $id_competencia)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
     SELECT
     rel_sgd_perfil_competencias.*,
     tbl_sgd_componente.nombre AS nombre_componente,
     tbl_sgd_componente.descripcion AS descripcion_componente,
     tbl_sgd_componente.id AS id_competencia,
     tbl_sgd_componente.muestra_preguntas_informe,
     tbl_sgd_componente.id_dimension,
     (select avg(puntaje) as nota_competncia from tbl_sgd_respuestas where tbl_sgd_respuestas.id_competencia=tbl_sgd_componente.id and evaluado='$evaluado' and evaluador='$evaluador') as nota_promedio
FROM
     rel_sgd_perfil_competencias
INNER JOIN tbl_sgd_componente ON rel_sgd_perfil_competencias.id_componente = tbl_sgd_componente.id
WHERE
     perfil_evaluacion = '$perfil' and tbl_sgd_componente.id='$id_competencia'
order by tbl_sgd_componente.orden asc
     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function IngresaSeguimientoPorPlan($id_plan, $grado_cumplimiento, $comentario)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "update tbl_planes_ingresados
     set
     seguimiento_grado_cumplimiento='$grado_cumplimiento',
     seguimiento_comentario='$comentario'


     where id='$id_plan'";
    $database->setquery($sql);
    $database->query();
}
function IngresaComentariosJefePorPlan($id_plan, $sugiere, $comentario)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "update tbl_planes_ingresados
     set
     jefe_sugiere='$sugiere',
     jefe_comentario='$comentario'


     where id='$id_plan'";
    $database->setquery($sql);
    $database->query();
}
function VerificaEstadoPlanes($rut)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
     SELECT * FROM  tbl_planes_estados  WHERE evaluado= '$rut'
     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function InsertaEstadoPlanes($rut, $id_proceso_plan, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "insert into
     tbl_planes_estados (evaluado, id_empresa, id_proceso_plan)
     values ('$rut', '$id_empresa', '$id_proceso_plan')";
    $database->setquery($sql);
    $database->query();
}
function TotalCompetenciasPorPerfil($id_perfil)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
     SELECT * FROM  rel_sgd_perfil_competencias  WHERE perfil_evaluacion= '$id_perfil'
     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function PreguntasPorCompetencia($id_competencia)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
     SELECT * FROM  tbl_sgd_preguntas  WHERE tbl_sgd_preguntas.id_competencia = '$id_competencia'
     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TotalIdCompetenciasIndividual($sql)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
     SELECT DISTINCT
     (id_componente),
     tbl_sgd_componente.nombre,
     tbl_sgd_componente.descripcion as descripcion_competencia,
     tbl_sgd_componente.imagen as imagen_competencia,
     tbl_sgd_componente.color as color_competencia,


     tbl_sgd_componente.muestra as muestra_competencia,
     tbl_sgd_dimensiones.muestra as muestra_dimension,
     tbl_sgd_dimensiones.nombre as nombre_dimension,
     tbl_sgd_preguntas.tiene_comentarios,
     tbl_sgd_preguntas.comentario_obligatorio


FROM
     rel_sgd_perfil_competencias
INNER JOIN tbl_sgd_componente ON tbl_sgd_componente.id = rel_sgd_perfil_competencias.id_componente
INNER JOIN tbl_sgd_preguntas ON tbl_sgd_preguntas.id_competencia = tbl_sgd_componente.id
INNER JOIN tbl_sgd_dimensiones on tbl_sgd_dimensiones.id=tbl_sgd_componente.id_dimension
WHERE
     $sql
order BY
     tbl_sgd_componente.orden ASC
     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TotalPerfilesDadoEvaluador1PorEvaluado($evaluador, $evaluado, $id_proceso)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sqlBK_SGD = "select distinct(tbl_usuario.perfil_evaluacion) as id_perfil_ev
     from tbl_sgd_relaciones
     inner join tbl_usuario
     on tbl_usuario.rut=tbl_sgd_relaciones.evaluado
     where tbl_sgd_relaciones.evaluador='$evaluador' and tbl_sgd_relaciones.evaluado='$evaluado' and tbl_sgd_relaciones.id_proceso='$id_proceso'
     ";
    $sql       = "SELECT DISTINCT
     (
     tbl_sgd_relaciones.perfil_evaluacion_competencias
     )AS id_perfil_ev
FROM
     tbl_sgd_relaciones


WHERE
     tbl_sgd_relaciones.evaluador = '$evaluador'
and tbl_sgd_relaciones.evaluado = '$evaluado'
and tbl_sgd_relaciones.id_proceso = '$id_proceso'
     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ActualizaPlan($id_plan, $rut, $id_competencia, $actividad_a_desarrollar, $resultado_esperado, $fecha_inicio, $fecha_termino, $plazos)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "update tbl_planes_ingresados
     set
     id_competencia='$id_competencia',
     nombre_competencia='$nombre_competencia',
     actividad_desarrollar='$actividad_a_desarrollar',
     resultado_esperado='$resultado_esperado',
     fecha_inicio='$fecha_inicio',
     fecha_termino='$fecha_termino',
     plazo='$plazos'


     where id='$id_plan'";
    $database->setquery($sql);
    $database->query();
}
function InsertaPlanes($rut, $competencia, $actividad_a_desarrollar, $resultado_esperado, $fecha_inicio, $fecha_termino, $plazos, $id_empresa, $id_proceso, $id_proceso_anual, $id_proceso_evaluacion)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $fecha = date("Y-m-d");
    $hora  = date("H:i:s");
    $sql   = "INSERT INTO tbl_planes_ingresados(evaluado, id_competencia, nombre_competencia, actividad_desarrollar, resultado_esperado, fecha_inicio, fecha_termino, plazo, fecha, hora, id_empresa, id_proceso, id_proceso_anual, id_proceso_evaluacion) " . "VALUES ('$rut', '$competencia', '$nombre_competencia', '$actividad_a_desarrollar', '$resultado_esperado', '$fecha_inicio', '$fecha_termino', '$plazos', '$fecha', '$hora', '$id_empresa', '$id_proceso', '$id_proceso_anual', '$id_proceso_evaluacion');";
    $database->setquery($sql);
    $database->query();
}
function TraeDatosPorPlanes($evaluado)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select tbl_planes_ingresados.*, tbl_sgd_componente.nombre as nombre_competencia, tbl_planes_plazos.nombre as plazo_nombre
     from tbl_planes_ingresados
     inner join tbl_sgd_componente
     on tbl_sgd_componente.id=tbl_planes_ingresados.id_competencia
     inner join tbl_planes_plazos
     on tbl_planes_plazos.id=.tbl_planes_ingresados.plazo


     where evaluado='$evaluado' order by tbl_planes_ingresados.id desc";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function CompetenciasPorPerfilConNombre($id_perfil)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "SELECT
     rel_sgd_perfil_competencias.*, tbl_sgd_componente.nombre as nombre_competencia
FROM
     rel_sgd_perfil_competencias
inner join tbl_sgd_componente
on tbl_sgd_componente.id=rel_sgd_perfil_competencias.id_componente
WHERE
     perfil_evaluacion = '$id_perfil'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function VerCantidadMeGustaPorObjetoYUsuario($id_objeto, $tipo_objeto, $id_empresa, $rut)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_megusta_registro where id_empresa='$id_empresa' and $tipo_objeto='$id_objeto' and rut='$rut'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function VerCantidadMeGustaPorObjeto($id_objeto, $tipo_objeto, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_megusta_registro where id_empresa='$id_empresa' and $tipo_objeto='$id_objeto'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function InsertaRegistroMegusta($id_objeto, $rut, $id_empresa, $tipo_objeto)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $fecha = date("Y-m-d");
    $hora  = date("H:i:s");
    $sql   = "INSERT INTO tbl_megusta_registro(rut, id_empresa, fecha, hora, $tipo_objeto) " . "VALUES ('$rut', '$id_empresa', '$fecha', '$hora', '$id_objeto');";
    $database->setquery($sql);
    $database->query();
}
function InsertaRegistroMegustaFavoritaMP($id_mp, $rut, $id_empresa, $tipo)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $fecha = date("Y-m-d");
    $hora  = date("H:i:s");
    $sql   = "INSERT INTO tbl_mp_interacciones(id_mp, rut, id_empresa, tipo, fecha)
     VALUES ('$id_mp', '$rut', '$id_empresa', '$tipo', '$fecha');";
    $database->setquery($sql);
    $database->query();
}
function TraeCampoPorSucursalEmpresa($nombre_campo, $id_sucursal, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select $nombre_campo as valor from tbl_sucursales where id_empresa='$id_empresa' and id='$id_sucursal'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TraigoCamposParaSucursalPorEmpresa($id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_sucursales_relacion where idempresa='$id_empresa' and orden is not null order by orden asc  ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ObtengoPuntajeDadoAlternativa($alternativa, $perfil, $id_empresa, $dimension)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_sgd_matriz_criterios where id_empresa='$id_empresa' and perfil='$perfil' and alternativa_seleccionada='$alternativa' and dimension='$dimension'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function VeoSiEstaEnTblClave($rut)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_clave where rut='$rut'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ActualizarVisitasPorNoticia($id)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "update tbl_noticias set visitas=visitas+1 where id='$id'";
    $database->setquery($sql);
    $database->query();
}
function ComunidadesPorEmpresa($id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
     select
     * from tbl_comunidades where id_empresa='$id_empresa'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function MundosPorEmpresa($id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
     select
     * from tbl_mundos where id_empresa='$id_empresa'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ObjetivosEspecificosConRespuestaEvaluadoEvaluadorProcesoPorDimension($evaluado, $evaluador, $id_proceso, $id_dimension)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = sprintf("
     SELECT
     tbl_objetivos_dimension.nombre AS nombre_dimension,
     tbl_objetivos_dimension.ponderacion AS ponderacion_dimension,
     tbl_sgd_respuestas.*, tbl_objetivos_individuales.descripcion_objetivo,
     tbl_objetivos_individuales.dimenfsion,
     tbl_objetivos_individuales.ponderacion,
     tbl_objetivos_individuales.nota_descripcion,
     tbl_objetivos_individuales.metrica,
     (select sum(ponderacion) as suma_ponderaciones from tbl_objetivos_individuales as tabla_obj_ind where tabla_obj_ind.rut='$evaluado' and tabla_obj_ind.dimension='$id_dimension' ) as suma_ponderaciones_por_dimension
FROM
     tbl_sgd_respuestas
INNER JOIN tbl_objetivos_individuales ON tbl_objetivos_individuales.id = tbl_sgd_respuestas.id_objetivo
INNER JOIN tbl_objetivos_dimension ON tbl_objetivos_dimension.id = tbl_objetivos_individuales.dimension
WHERE
     tbl_sgd_respuestas.evaluado = '$evaluado'
and tbl_sgd_respuestas.evaluador = '$evaluador'
and tbl_sgd_respuestas.id_proceso = '$id_proceso'
and tbl_objetivos_individuales.dimension = '$id_dimension'
order BY
     nombre_dimension ASC
     ");
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function PromedioPorDimensionObjetivos($evaluado, $evaluador, $id_dimension, $id_proceso)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
     SELECT
     avg(puntaje) as promedio_por_dimension
FROM
     tbl_sgd_respuestas
INNER JOIN tbl_objetivos_individuales ON tbl_sgd_respuestas.id_objetivo = tbl_objetivos_individuales.id
WHERE
     tbl_sgd_respuestas.evaluado = '$evaluado'
and tbl_objetivos_individuales.dimension = '$id_dimension'
and tbl_sgd_respuestas.evaluador = '$evaluador'
and tbl_sgd_respuestas.id_proceso = '$id_proceso'
     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TraeEvaluadosDadoEvaluadorPorProceso2($rut, $id_proceso)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sqlBK_SGD = "
     SELECT
     evaluado AS rut,
     tbl_sgd_relaciones.evaluador, perfil_evaluacion, id_proceso, calibrador
FROM
     tbl_sgd_relaciones
INNER JOIN tbl_usuario ON tbl_usuario.rut = evaluado
WHERE
     tbl_sgd_relaciones.evaluador = '$rut' and tbl_sgd_relaciones.id_proceso='$id_proceso'
     order by subperfil, nombre_completo asc
     ";
    $sql       = "
     SELECT
     evaluado AS rut,
     tbl_sgd_relaciones.evaluador,
     tbl_sgd_relaciones.perfil_evaluacion_competencias as perfil_evaluacion,
     id_proceso,
     calibrador


     FROM
     tbl_sgd_relaciones
     INNER JOIN
     tbl_usuario ON tbl_usuario.rut = evaluado
     WHERE
     tbl_sgd_relaciones.evaluador = '$rut'
     AND tbl_sgd_relaciones.id_proceso = '$id_proceso'
     and (
     tbl_usuario.perfil_evaluacion='' or
     tbl_usuario.perfil_evaluacion is null or
     tbl_usuario.perfil_evaluacion='SI')
     ORDER BY
     subperfil,
     nombre_completo, nombre, apaterno ASC
     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TraeEvaluadosDadoEvaluadorPorProceso2SinAe($rut, $id_proceso)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
     SELECT
     evaluado AS rut,
     tbl_sgd_relaciones.evaluador, perfil_evaluacion, id_proceso
FROM
     tbl_sgd_relaciones
INNER JOIN tbl_usuario ON tbl_usuario.rut = evaluado
WHERE
     tbl_sgd_relaciones.evaluador = '$rut'
     and tbl_sgd_relaciones.id_proceso='$id_proceso' and
     tbl_sgd_relaciones.evaluado<>tbl_sgd_relaciones.evaluador
     and
     (
     tbl_usuario.perfil_evaluacion='' or
     tbl_usuario.perfil_evaluacion is null or
     tbl_usuario.perfil_evaluacion='SI')
     order by subperfil, nombre_completo asc
     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function FinalizadoEvaluadoEvaluadorProProcesoSoloEvaluador($evaluador, $id_proceso)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = sprintf("
     select * from tbl_sgd_finalizados_evaluado_evaluador where evaluador='$evaluador' and id_proceso='$id_proceso'
     ");
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function FinalizadoEvaluadoEvaluadorProProceso($evaluado, $evaluador, $id_proceso)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = sprintf("
     select * from tbl_sgd_finalizados_evaluado_evaluador where evaluado='$evaluado' and evaluador='$evaluador' and id_proceso='$id_proceso'
     ");
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TotalUsuariosPorempresa($id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_usuario where id_empresa='$id_empresa'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TraeAsuntoDeMensaje($id)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_mensaje_tipo where id='$id'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function RespuestasPorMensaje($id_mensaje)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select tbl_mensajes_respuestas.*, tbl_usuario.nombre, tbl_usuario.apaterno, tbl_usuario.amaterno, tbl_usuario.cargo
     from tbl_mensajes_respuestas
     inner join tbl_usuario
     on tbl_usuario.rut=rut_creador where id_mensaje='$id_mensaje'
     order by tbl_mensajes_respuestas.id desc";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function MensajeAtendidoPorAdmin($id_mensaje)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_mensajes_respuestas where id_mensaje='$id_mensaje' and tipo_creador='1'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function InsertaRespuestaMensajeria($id_mensaje, $rut_creador, $mensaje, $id_empresa, $tipo_creador)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $fecha = date("Y-m-d");
    $hora  = date("H:i:s");
    $sql   = "


insert into tbl_mensajes_respuestas(id_mensaje, rut_creador, mensaje, fecha, hora, id_empresa, tipo_creador)
values('$id_mensaje', '$rut_creador', '$mensaje', '$fecha', '$hora', '$id_empresa', '$tipo_creador')




     ";
    $database->setquery($sql);
    $database->query();
}
function TotalMensajesPorRutDestinatario($rut, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "


     SELECT
     tbl_mensajes_principal.*, tbl_usuario.nombre as nombre_creador,
     tbl_usuario.apaterno,
     tbl_usuario.amaterno,
     tbl_mensaje_tipo.nombre AS nombre_titulo,
     tbl_mensajes_destinatarios.nombre AS nombre_tipo_destinatario,
     (select count(*) as total_respuestas from tbl_mensajes_respuestas where id_mensaje=tbl_mensajes_principal.id) as total_comen
FROM
     tbl_mensajes_destinatarios_usuarios
INNER JOIN tbl_mensajes_principal ON tbl_mensajes_principal.id_tipo_destinatario = tbl_mensajes_destinatarios_usuarios.tipo_destinatario
INNER JOIN tbl_usuario ON tbl_usuario.rut = rut_creador
INNER JOIN tbl_mensajes_destinatarios ON tbl_mensajes_destinatarios.id = tbl_mensajes_principal.id_tipo_destinatario
INNER JOIN tbl_mensaje_tipo ON tbl_mensaje_tipo.id = tbl_mensajes_principal.tipo_mensaje
WHERE
     tbl_mensajes_destinatarios_usuarios.rut = '$rut'
and tbl_mensajes_principal.id_empresa = '$id_empresa'
order by tbl_mensajes_principal.id desc
";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function EsDestinatarioMensajeria($rut)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
     select * from tbl_mensajes_destinatarios_usuarios where rut='$rut'
";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ObtengoTipoCorreoPorProcesoEmpresa($id_empresa, $tipo)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_correos where id_empresa='$id_empresa' and tipo_mensajeria='$tipo' ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function EtapasPorProceso($id_procceso)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = sprintf("




     SELECT
     tbl_sgd_proceso_etapa.*, tbl_sgd_proceso_tipo.codigo
FROM
     tbl_sgd_proceso_etapa
INNER JOIN tbl_sgd_proceso_evaluacion ON tbl_sgd_proceso_evaluacion.id_proceso = tbl_sgd_proceso_etapa.id_proceso
INNER JOIN tbl_sgd_proceso_tipo ON tbl_sgd_proceso_tipo.id = tbl_sgd_proceso_evaluacion.tipo_proceso
WHERE
     tbl_sgd_proceso_etapa.id_proceso = '$id_procceso'
     ");
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function DatosLinks($id_links)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = sprintf("
     select * from tbl_links_interes where id='$id_links'
     ");
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ActualizarVisitasLinks($id_link)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
     update tbl_links_interes set visitas=visitas+1 where id='$id_link'";
    $database->setquery($sql);
    $database->query();
}
function ObjetivosEspecificosConRespuestaEvaluadoEvaluadorProceso2($evaluado, $evaluador, $id_proceso)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = sprintf("


     SELECT
     tbl_objetivos_dimension.nombre AS nombre_dimension,
     tbl_sgd_respuestas.*, tbl_objetivos_individuales.descripcion_objetivo,
     tbl_objetivos_individuales.dimension,
     tbl_objetivos_individuales.ponderacion,
     tbl_objetivos_individuales.id as id_objetivo_original,
     tbl_objetivos_individuales.nota_descripcion,
     tbl_objetivos_individuales.nota_ev,
     tbl_objetivos_individuales.metrica
FROM
     tbl_objetivos_individuales
left JOIN tbl_sgd_respuestas ON tbl_objetivos_individuales.id = tbl_sgd_respuestas.id_objetivo and tbl_sgd_respuestas.evaluado='$evaluado' and tbl_sgd_respuestas.evaluador='$evaluador' and tbl_sgd_respuestas.id_proceso='$id_proceso'
INNER JOIN tbl_objetivos_dimension ON tbl_objetivos_dimension.id = tbl_objetivos_individuales.dimension
WHERE
tbl_objetivos_individuales.rut='$evaluado'
order BY
     nombre_dimension ASC




     ");
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function PromedioRespuestasCompPorProceso($evaluado, $evaluador, $competencia, $id_proceso)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = sprintf("select
     avg(puntaje) as nota_competencia,
     id_competencia,
     id_dimension
     from tbl_sgd_respuestas
     where evaluado='$evaluado' and evaluador='$evaluador' and id_competencia ='$competencia' and id_proceso='$id_proceso'");
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function LinksInteresPorEmpresa($id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
     select * from tbl_links_interes where id_empresa='$id_empresa'    and activo='0'


     order by visitas desc


     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function PreguntasPorCompetenciaConRespuesta($id_competencia, $evaluado, $evaluador, $id_proceso)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
     SELECT
     tbl_sgd_preguntas.*, tbl_sgd_respuestas.respuesta, tbl_sgd_respuestas.puntaje, tbl_sgd_respuestas.comentario
FROM
     tbl_sgd_preguntas
INNER JOIN tbl_sgd_respuestas ON tbl_sgd_respuestas.id_pregunta = tbl_sgd_preguntas.id
and tbl_sgd_respuestas.evaluado = '$evaluado'
and tbl_sgd_respuestas.evaluador = '$evaluador' and tbl_sgd_respuestas.id_proceso='$id_proceso'
WHERE
     tbl_sgd_preguntas.id_competencia = '$id_competencia'
     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function DatosProcesoAnualPorId($id)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
     select * from tbl_sgd_proceso_anual where id='$id'
     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function DatosProcesoAnual($ano, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
     select * from tbl_sgd_proceso_anual where id_empresa='$id_empresa' and ano='$ano'
     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function DatosUsuarioConDatosEvaluadorPorProceso($rut, $rut_evaluador, $id_proceso)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sqlBK_SGD = "
     SELECT
     tbl_usuario.*,
     tbl_sgd_perfiles_ponderaciones.descripcion AS nombre_perfil,
     basejefe.nombre AS nombre_evaluador,
     basejefe.apaterno AS apaternojefe,
     basejefe.amaterno AS amaternojefe,
     basejefe.nombre_completo AS nombrecompletojefe,
     basejefe.cargo AS cargo_evaluador,


     basevalidador.nombre_completo AS nombrecompletovalidador,
     basevalidador.cargo AS cargo_validador,


     basecalibrador.nombre_completo AS nombrecompletocalibrador,
     basecalibrador.cargo AS cargo_calibrador,
     tabla_jefe_desde_tblusuario.nombre_completo as nombre_completo_jefatura_tabla_usuario,
     tabla_jefe_desde_tblusuario.nombre as nombre_jefatura_tabla_usuario,
     tabla_jefe_desde_tblusuario.apaterno as apaterno_jefatura_tabla_usuario,
     tabla_jefe_desde_tblusuario.amaterno as amaterno_jefatura_tabla_usuario
     FROM
     tbl_usuario
     LEFT JOIN
     tbl_sgd_perfiles_ponderaciones
     ON
     tbl_usuario.perfil_evaluacion = tbl_sgd_perfiles_ponderaciones.perfil
     LEFT JOIN
     tbl_sgd_relaciones
     ON
     tbl_sgd_relaciones.evaluado = tbl_usuario.rut


     AND tbl_sgd_relaciones.id_proceso = '$id_proceso'
     AND tbl_sgd_relaciones.evaluador = '$rut_evaluador'


     LEFT JOIN tbl_usuario AS basejefe ON basejefe.rut = tbl_sgd_relaciones.evaluador
     LEFT JOIN tbl_usuario AS basevalidador ON basevalidador.rut = tbl_sgd_relaciones.validador
     LEFT JOIN tbl_usuario AS basecalibrador ON basecalibrador.rut = tbl_sgd_relaciones.calibrador
     left join tbl_usuario as tabla_jefe_desde_tblusuario on tabla_jefe_desde_tblusuario.rut=tbl_usuario.jefe


     WHERE
     tbl_usuario.rut = '$rut'


     ";
    $sql       = "
     SELECT
     tbl_usuario.*,
     tbl_sgd_perfiles_ponderaciones.descripcion AS nombre_perfil,
     basejefe.nombre AS nombre_evaluador,
     basejefe.apaterno AS apaternojefe,
     basejefe.amaterno AS amaternojefe,
     basejefe.nombre_completo AS nombrecompletojefe,
     basejefe.cargo AS cargo_evaluador,


     basevalidador.nombre_completo AS nombrecompletovalidador,
     basevalidador.cargo AS cargo_validador,


     basecalibrador.nombre_completo AS nombrecompletocalibrador,
     basecalibrador.cargo AS cargo_calibrador,
     tabla_jefe_desde_tblusuario.nombre_completo as nombre_completo_jefatura_tabla_usuario,
     tabla_jefe_desde_tblusuario.nombre as nombre_jefatura_tabla_usuario,
     tabla_jefe_desde_tblusuario.apaterno as apaterno_jefatura_tabla_usuario,
     tabla_jefe_desde_tblusuario.amaterno as amaterno_jefatura_tabla_usuario
     FROM
     tbl_usuario
     LEFT JOIN
     tbl_sgd_relaciones
     ON
     tbl_sgd_relaciones.evaluado = tbl_usuario.rut


     AND tbl_sgd_relaciones.id_proceso = '$id_proceso'
     AND tbl_sgd_relaciones.evaluador = '$rut_evaluador'


     LEFT JOIN tbl_sgd_perfiles_ponderaciones ON tbl_sgd_relaciones.perfil_evaluacion_competencias= tbl_sgd_perfiles_ponderaciones.perfil




     LEFT JOIN tbl_usuario AS basejefe ON basejefe.rut = tbl_sgd_relaciones.evaluador
     LEFT JOIN tbl_usuario AS basevalidador ON basevalidador.rut = tbl_sgd_relaciones.validador
     LEFT JOIN tbl_usuario AS basecalibrador ON basecalibrador.rut = tbl_sgd_relaciones.calibrador
     left join tbl_usuario as tabla_jefe_desde_tblusuario on tabla_jefe_desde_tblusuario.rut=tbl_usuario.jefe


     WHERE
     tbl_usuario.rut = '$rut'


     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TraigoRespuestasCrucePreguntasPorRangosMenorYMayorSinAe($evaluador, $id_proceso, $rango_menor, $rango_mayor)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
     select tbl_sgd_respuestas.*
     from tbl_sgd_respuestas
     inner join tbl_sgd_preguntas
     on tbl_sgd_preguntas.id=tbl_sgd_respuestas.id_pregunta
     where evaluador='$evaluador' and id_proceso='$id_proceso' and (puntaje>=$rango_menor and puntaje<=$rango_mayor) and evaluado<>evaluador
     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TraigoRespuestasCrucePreguntasPorRangosMenorYMayor($evaluador, $id_proceso, $rango_menor, $rango_mayor)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sqlBK = "
     select tbl_sgd_respuestas.*
     from tbl_sgd_respuestas
     inner join tbl_sgd_preguntas
     on tbl_sgd_preguntas.id=tbl_sgd_respuestas.id_pregunta
     where evaluador='$evaluador' and id_proceso='$id_proceso' and puntaje between $rango_menor and $rango_mayor
     ";
    $sql   = "
     select tbl_sgd_respuestas.*
     from tbl_sgd_respuestas
     inner join tbl_sgd_preguntas
     on tbl_sgd_preguntas.id=tbl_sgd_respuestas.id_pregunta
     where evaluador='$evaluador' and id_proceso='$id_proceso' and (puntaje>=$rango_menor and puntaje<=$rango_mayor)
     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function DatosCriterioPorEmpresaTipo($id_empresa, $tipo_perfil)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = sprintf("
     select * from tbl_sgd_matriz_criterios
     where id_empresa='$id_empresa' and tipo_objeto='$tipo_perfil'
     ");
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TaigoDatosMatriz($id_empresa, $tipo)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
     select * from tbl_sgd_matriz_criterios where id_empresa='$id_empresa' and tipo_objeto='$tipo'


     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TraigoRespuestasCrucePreguntasSinAe($evaluador, $id_proceso)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
     select tbl_sgd_respuestas.*
     from tbl_sgd_respuestas
     inner join tbl_sgd_preguntas
     on tbl_sgd_preguntas.id=tbl_sgd_respuestas.id_pregunta
     where evaluador='$evaluador' and id_proceso='$id_proceso' and evaluado<>evaluador
     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TraigoRespuestasCrucePreguntas($evaluador, $id_proceso)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
     select tbl_sgd_respuestas.*
     from tbl_sgd_respuestas
     inner join tbl_sgd_preguntas
     on tbl_sgd_preguntas.id=tbl_sgd_respuestas.id_pregunta
     where evaluador='$evaluador' and id_proceso='$id_proceso'
     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TraigoValoresPorCategoria($id_categoria, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_salonfama_valores where id_empresa='$id_empresa' and id_categoria='$id_categoria' ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TraigoEmpresaPorTokem($tok)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "


     select * from tbl_empresa where tokem_validacion_externo='$tok'


";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function Insertatbl_salonfama_publicados($id_tipo_reconocimiento, $rut, $id_empresa, $id_valor, $id_conducta, $situacion, $accion, $impacto)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $fecha = date("Y-m-d");
    $hora  = date("H:i:s");
    $sql   = "
     insert into tbl_salonfama_publicados(id_tipo_reconocimiento, rut, idempresa, id_valor, id_conducta, situacion, accion, impacto)
     values ('$id_tipo_reconocimiento', '$rut', '$id_empresa', '$id_valor', '$id_conducta', '$situacion', '$accion', '$impacto')
     ";
    $database->setquery($sql);
    $database->query();
}
function ConductasDadoCategoria($id_categoria, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "


     select * from tbl_salonfama_conductas where id_categoria='$id_categoria' and id_empresa='$id_empresa'


";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function FormularioDadoIdCategoria($id_categoria, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "


     select * from tbl_formularios where id_categoria='$id_categoria' and id_empresa='$id_empresa'


";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TraeProcesosDeEvaluacionPorEmpresaYDiProceso($id_empresa, $id_proceso)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "SELECT
     tbl_sgd_proceso_evaluacion.*, tbl_sgd_proceso_anual.ano
FROM
     tbl_sgd_proceso_evaluacion
inner join tbl_sgd_proceso_anual
on tbl_sgd_proceso_anual.id=tbl_sgd_proceso_evaluacion.id_proceso_anual
WHERE
     tbl_sgd_proceso_evaluacion.id_empresa = '$id_empresa'
and tbl_sgd_proceso_evaluacion.id_proceso = '$id_proceso'


";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TraeProcesosDeEvaluacionDadoId($id_proceso)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "


     select * from tbl_sgd_proceso_evaluacion where id_proceso='$id_proceso'
     order by orden asc


";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TraeProcesosDeEvaluacionPorEmpresa($id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "


     select * from tbl_sgd_proceso_evaluacion where id_empresa='$id_empresa'
     order by orden asc


";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TraeListadoUsuariosPorCategoriaMensaje($id_categoria)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "


     select
     tbl_mensajes_destinatarios_usuarios.rut, nombre, apaterno, amaterno, nombre_completo, cargo, email
     from tbl_mensajes_destinatarios_usuarios


     inner join tbl_usuario
     on tbl_usuario.rut=tbl_mensajes_destinatarios_usuarios.rut


     where tipo_destinatario='$id_categoria'




";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TraeListadoClasicos($id_empresa, $limit, $order)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    if ($limit) {
        $limit = " limit $limit";
    } else {
        $limit = "";
    }
    $sql = "
     SELECT
     rut,
     nombre as nombre_persona,
     apaterno,
     amaterno,
     cargo,
     fecha_ingreso,
(    SELECT
     date_format( now(), '%Y' ) - date_format( fecha_ingreso, '%Y' ) -
     ( date_format( now(), '00-%m-%d') < date_format( fecha_ingreso, '00-%m-%d' ) )
A    S
     edad) as antiguedad
FROM
     tbl_usuario
WHERE
     fecha_ingreso <= DATE(
     DATE_SUB(NOW(), INTERVAL 3650 DAY)
     )
and id_empresa = $id_empresa


$    order
     $limit;
     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function BannersPorEmpresa($id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
     SELECT
     tbl_banners_publicados.*, tbl_banners_categorias.nombre AS nombre_categoria,
     tbl_banners_categorias.icono AS icono_banner,
     tbl_banners_categorias.descripcion AS descripcion_banner,
     tbl_banners_tipos.nombre AS nombre_tipo,
     tbl_banners_tipos.template
FROM
     tbl_banners_publicados
INNER JOIN tbl_banners_categorias ON tbl_banners_categorias.id = tbl_banners_publicados.id_categoriabanner
INNER JOIN tbl_banners_tipos ON tbl_banners_tipos.id = tbl_banners_publicados.tipo
WHERE
     tbl_banners_publicados.idempresa = '$id_empresa'


     ORDER BY
     RAND()
limit 1
     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ActualizaComentarioDadoId($id_comentario, $comentario)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
     update tbl_objeto_comentarios set comentario='$comentario' where id='$id_comentario'


     ";
    $database->setquery($sql);
    $database->query();
}
function DatosComentarioPorId($id)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "


     select * from tbl_objeto_comentarios
     where id='$id'




";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function CategoriasComentariosPorEmpresa($id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "        select * from tbl_objeto_comentarios_categorias where id_empresa='$id_empresa'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function CompetenciasDadoDimensionYPerfil($dimension, $perfil)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
     select
     tbl_sgd_componente.*
     from tbl_sgd_componente


     inner join rel_sgd_perfil_competencias


     on rel_sgd_perfil_competencias.id_componente=tbl_sgd_componente.id


     where tbl_sgd_componente.id_dimension='$dimension' and rel_sgd_perfil_competencias.perfil_evaluacion='$perfil'    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function PreguntasPorCompetenciaPorPerfilEval($perfil_evaluacion)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
select tbl_sgd_preguntas.*
from tbl_sgd_preguntas
inner join tbl_sgd_componente
on tbl_sgd_componente.id=tbl_sgd_preguntas.id_competencia
inner join rel_sgd_perfil_competencias
on rel_sgd_perfil_competencias.id_componente=tbl_sgd_componente.id
where rel_sgd_perfil_competencias.perfil_evaluacion='$perfil_evaluacion'
";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function PreguntasPorCompetenciaPorPerfilEvalParaValidar($perfil_evaluacion)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
select tbl_sgd_preguntas.id
from tbl_sgd_preguntas
inner join tbl_sgd_componente
on tbl_sgd_componente.id=tbl_sgd_preguntas.id_competencia
inner join rel_sgd_perfil_competencias
on rel_sgd_perfil_competencias.id_componente=tbl_sgd_componente.id
where rel_sgd_perfil_competencias.perfil_evaluacion='$perfil_evaluacion'
";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function CantidadBitacorasPorEvaluador($evaluador)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select  * from tbl_bitacora_textos where creador='$evaluador'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ActualizaBitacora($id_bitacora, $texto_st, $texto_a, $texto_r, $realizado, $texto_aa, $texto_at, $valores)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "update tbl_bitacora_textos
     set
     texto_st='$texto_st',
     texto_a='$texto_a',
     texto_r='$texto_r',
     realizado='$realizado',
     texto_aa='$texto_aa',
     texto_at='$texto_at',
     valor='$valores'


     where id='$id_bitacora'";
    $database->setquery($sql);
    $database->query();
}
function InsertaTextosBitacora($rut, $texto_st, $texto_a, $texto_r, $realizado, $texto_aa, $texto_at, $creador, $valores)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $fecha = date("Y-m-d");
    $hora  = date("H:i:s");
    $sql   = "INSERT INTO tbl_bitacora_textos(evaluado, creador, texto_st, texto_a, texto_r, realizado, texto_aa, texto_at, fecha, hora, valor) " . "VALUES ('$rut', '$creador', '$texto_st', '$texto_a', '$texto_r', '$realizado', '$texto_aa', '$texto_at', '$fecha', '$hora', $valores);";
    $database->setquery($sql);
    $database->query();
}
function TraeDatosPorBitacora($evaluado)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select tbl_bitacora_textos.*, tbl_bitacora_valores.valor as nombre_valor, tbl_usuario.nombre_completo
     from tbl_bitacora_textos
     inner join  tbl_bitacora_valores
     on tbl_bitacora_valores.id=tbl_bitacora_textos.valor
     inner join tbl_usuario
     on tbl_usuario.rut=tbl_bitacora_textos.creador
     where evaluado='$evaluado' order by tbl_bitacora_textos.id desc";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ValidoTokem($tokem)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_registro_login where tokem='$tokem'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function InsertaRegistroLogin($arreglo_post)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $fecha = date("Y-m-d");
    $hora  = date("H:i:s");
    $tokem = base64_encode($arreglo_post["user"] . "&" . $fecha . "&" . $hora);
    $sql   = "INSERT INTO tbl_registro_login(rut, nombre, cargo, celular, email, fecha_ingreso, rut_jefe, nombre_jefe, cargo_jefe, correo_jefe, tokem, fecha, hora, id_empresa) " . "VALUES ('" . utf8_decode($arreglo_post["user"]) . "',
     '" . utf8_decode($arreglo_post["nombre"]) . "',
     '" . utf8_decode($arreglo_post["cargo"]) . "',
     '" . utf8_decode($arreglo_post["celular"]) . "',
     '" . utf8_decode($arreglo_post["email"]) . "',
     '" . utf8_decode($arreglo_post["fecha_ingreso"]) . "',
     '" . utf8_decode($arreglo_post["rut_jefe"]) . "',
     '" . utf8_decode($arreglo_post["nombre_jefe"]) . "',
     '" . utf8_decode($arreglo_post["cargo_jefe"]) . "',
     '" . utf8_decode($arreglo_post["correo_jefe"]) . "',
     '$tokem',
     '" . $fecha . "',
     '" . $hora . "',
     '58');";
    $database->setquery($sql);
    $database->query();
    return ($tokem);
}
function InsertaVioBanner($rut, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "INSERT INTO tbl_banner_visto(rut, id_empresa, fecha, hora) " . "VALUES ('$rut', '$id_empresa', '" . date("Y-m-d") . "', '" . date("H:i:s") . "');";
    $database->setquery($sql);
    $database->query();
}
function InsertaVioBannerDinamicoPorAmbiente($rut, $id_empresa, $ambiente)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "INSERT INTO tbl_banner_visto(rut, id_empresa, fecha, hora, ambiente) " . "VALUES ('$rut', '$id_empresa', '" . date("Y-m-d") . "', '" . date("H:i:s") . "', '$ambiente');";
    $database->setquery($sql);
    $database->query();
}
function VioBannerPorAmbiente($rut, $id_empresa, $ambiente)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_banner_visto where rut='$rut' and id_empresa='$id_empresa' and ambiente='$ambiente'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function VioBanner($rut, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_banner_visto where rut='$rut' and id_empresa='$id_empresa'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function DDatosEncSatis($id_encuesta)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select  * from tbl_enc_satis where idencuesta='$id_encuesta'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function CertificacionesPorPrograma($id_programa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
     select  * from tbl_certificacion where id_programa='$id_programa'
     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function VerificoEncuestaFinalizadaPorInsc($id_encuesta, $id_empresa, $rut, $id_inscipcion)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
     select  * from tbl_enc_satis_finalizados where rut='$rut' and id_encuesta='$id_encuesta' and id_empresa='$id_empresa' and id_inscripcion='$id_inscipcion'
     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function VerificoEncuestaFinalizada($id_encuesta, $id_empresa, $rut)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
     select  * from tbl_enc_satis_finalizados where rut='$rut' and id_encuesta='$id_encuesta' and id_empresa='$id_empresa'
     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ObjetivosEspecificosConRespuestaEvaluadoEvaluadorProceso($evaluado, $evaluador, $id_proceso)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = sprintf("
select
     tbl_objetivos_dimension.nombre as nombre_dimension, tbl_sgd_respuestas.*, tbl_objetivos_individuales.descripcion_objetivo, tbl_objetivos_individuales.dimension,
     tbl_objetivos_individuales.ponderacion, tbl_objetivos_individuales.nota_descripcion, tbl_objetivos_individuales.metrica
FROM
     tbl_sgd_respuestas
INNER JOIN tbl_objetivos_individuales ON tbl_objetivos_individuales.id = tbl_sgd_respuestas.id_objetivo
inner join tbl_objetivos_dimension
on tbl_objetivos_dimension.id=tbl_objetivos_individuales.dimension
WHERE
     tbl_sgd_respuestas.evaluado = '$evaluado'
and tbl_sgd_respuestas.evaluador = '$evaluador'
and tbl_sgd_respuestas.id_proceso = '$id_proceso'
order by nombre_dimension asc


     ");
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TraeObjetivosIndividualesDadoRutEvaluadoEvaluadorIdProceso($evaluado, $evaluador, $id_proceso)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "


select
     tbl_sgd_respuestas.puntaje AS nota,
     tbl_sgd_respuestas.respuesta AS alternativa_seleccionada,
     tbl_sgd_respuestas.comentario,


     tbl_objetivos_individuales.*, tbl_objetivos_dimension.nombre AS nombre_dimension
FROM
     tbl_objetivos_individuales
INNER JOIN tbl_objetivos_dimension ON tbl_objetivos_dimension.id = tbl_objetivos_individuales.dimension
left JOIN tbl_sgd_respuestas ON tbl_sgd_respuestas.id_objetivo = tbl_objetivos_individuales.id and tbl_sgd_respuestas.evaluado = '$evaluado' AND tbl_sgd_respuestas.evaluador = '$evaluador' AND tbl_sgd_respuestas.id_proceso = '$id_proceso'
WHERE


tbl_objetivos_individuales.rut='$evaluado'


order BY
     tbl_objetivos_individuales.dimension, tbl_objetivos_individuales.id DESC


     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function EvaluadosDadoEvaluadorPorProceso($evaluador, $id_proceso)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sqlBK_SGD = "SELECT
     tbl_sgd_relaciones.*, tbl_sgd_subperfiles.perfil AS nombre_subperfil, tbl_usuario.perfil_evaluacion, tbl_usuario.nombre_completo
FROM
     tbl_sgd_relaciones
INNER JOIN tbl_sgd_subperfiles ON tbl_sgd_subperfiles.id = tbl_sgd_relaciones.subperfil
INNER JOIN tbl_usuario ON tbl_usuario.rut = tbl_sgd_relaciones.evaluado
WHERE
     tbl_sgd_relaciones.evaluador = '$evaluador'
and tbl_sgd_relaciones.id_proceso = '$id_proceso'
order BY
     nombre_completo ASC
     ";
    $sql       = "SELECT
     tbl_sgd_relaciones.*, tbl_sgd_subperfiles.perfil AS nombre_subperfil,
     tbl_sgd_relaciones.perfil_evaluacion_competencias as perfil_evaluacion,
     tbl_usuario.nombre_completo
FROM
     tbl_sgd_relaciones
INNER JOIN tbl_sgd_subperfiles ON tbl_sgd_subperfiles.id = tbl_sgd_relaciones.subperfil
INNER JOIN tbl_usuario ON tbl_usuario.rut = tbl_sgd_relaciones.evaluado
WHERE
     tbl_sgd_relaciones.evaluador = '$evaluador'
and tbl_sgd_relaciones.id_proceso = '$id_proceso'
order BY
     nombre_completo ASC
     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function EvaluadosDadoEvaluadorPorProcesoPorEvaluado($evaluador, $id_proceso, $evaluado)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sqlBK = "SELECT
     tbl_sgd_relaciones.*, tbl_sgd_subperfiles.perfil AS nombre_subperfil, tbl_usuario.perfil_evaluacion, tbl_usuario.nombre_completo
FROM
     tbl_sgd_relaciones
INNER JOIN tbl_sgd_subperfiles ON tbl_sgd_subperfiles.id = tbl_sgd_relaciones.subperfil
INNER JOIN tbl_usuario ON tbl_usuario.rut = tbl_sgd_relaciones.evaluado
WHERE
     tbl_sgd_relaciones.evaluador = '$evaluador'
and tbl_sgd_relaciones.id_proceso = '$id_proceso'
AND tbl_sgd_relaciones.evaluado = '$evaluado'
order BY
     nombre_completo ASC
     ";
    $sql   = "SELECT
     tbl_sgd_relaciones.*,
     tbl_sgd_subperfiles.perfil AS nombre_subperfil,
     tbl_sgd_relaciones.perfil_evaluacion_competencias as perfil_evaluacion,
     tbl_usuario.nombre_completo
FROM
     tbl_sgd_relaciones
INNER JOIN tbl_sgd_subperfiles ON tbl_sgd_subperfiles.id = tbl_sgd_relaciones.subperfil
INNER JOIN tbl_usuario ON tbl_usuario.rut = tbl_sgd_relaciones.evaluado
WHERE
     tbl_sgd_relaciones.evaluador = '$evaluador'
and tbl_sgd_relaciones.id_proceso = '$id_proceso'
and tbl_sgd_relaciones.evaluado = '$evaluado'
order BY
     nombre_completo ASC
     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function MasDeUnaOpcionPorAlternativa($puntaje, $id_empresa, $id_proceso_evaluacion)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
     select * from tbl_sgd_opciones_alternativas where puntaje='$puntaje' and id_empresa='$id_empresa' and id_proceso='$id_proceso_evaluacion'
";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ProcesosEvalPorEmpresaPorAno($id_empresa, $id_proceso_anual)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "    select *
     from tbl_sgd_proceso_evaluacion
     where id_empresa='$id_empresa' and id_proceso_anual='$id_proceso_anual'
     and visible='0'
     order by orden asc";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ProcesosEvalPorEmpresa($id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "    select * from tbl_sgd_proceso_evaluacion where id_empresa='$id_empresa'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ProcesosEvalPorProcesoAnualParaTabla($id_proceso_anual, $tipo)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql_where = "";
    if ($tipo == "evaluacion") {
        $sql_where = " and tbl_sgd_proceso_tipo.codigo='evaluacion'";
    }
    $sql = "
     select tbl_sgd_proceso_evaluacion.*
     from tbl_sgd_proceso_evaluacion
     inner join tbl_sgd_proceso_tipo
     on tbl_sgd_proceso_evaluacion.tipo_proceso=tbl_sgd_proceso_tipo.id
     where id_proceso_anual='$id_proceso_anual' $sql_where order by tbl_sgd_proceso_evaluacion.orden asc
";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ProcesosEvalPorProcesoAnualSoloEval($id_proceso_anual)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    //   $sql = "    select * from tbl_sgd_proceso_evaluacion where id_proceso_anual='$id_proceso_anual' and tipo_proceso='1'";
    $sql = "    select * from tbl_sgd_proceso_evaluacion where id_proceso_anual='$id_proceso_anual' and tipo_proceso='1'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ProcesosEvalPorProcesoAnual($id_proceso_anual)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
     select * from tbl_sgd_proceso_evaluacion where id_proceso_anual='$id_proceso_anual'
";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function MegustaPorComentario($id_comentario)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "


     select * from tbl_objeto_comentarios_megusta
     where id_comentario='$id_comentario'




";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function MegustaPorComentarioRut($id_comentario, $rut)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "


     select * from tbl_objeto_comentarios_megusta
     where id_comentario='$id_comentario' and rut='$rut'




";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function InsertarMegustaPorComentarioDeObjeto($id_comentario, $rut, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "INSERT INTO tbl_objeto_comentarios_megusta(id_comentario, rut, id_empresa, fecha, hora) " . "VALUES ('$id_comentario', '$rut', '$id_empresa', '" . date("Y-m-d") . "', '" . date("H:i:s") . "');";
    $database->setquery($sql);
    $database->query();
}
function AlternativasDadoGupoIdPregunta($id_pregunta)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
     select tbl_objeto_alternativas.*
     from tbl_objeto_alternativas


     inner join tbl_objeto_pregunta
     on tbl_objeto_pregunta.id_alternativas=tbl_objeto_alternativas.id_alternativa
     where
     tbl_objeto_pregunta.id='$id_pregunta'
";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function AlternativasDadoGupoId($id_grupo_alternativas)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
     select tbl_objeto_alternativas.*
     from tbl_objeto_alternativas
     where
     id_alternativa='$id_grupo_alternativas'
";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function InsertoComentarioPorObjeto($rut, $id_objeto, $comentario, $id_categoria, $rut_colaborador)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $existe_comentario = ComentariosPorObjetoDuplicado($id_objeto, $comentario, $rut);
    if (!$existe_comentario) {
        $sql = "INSERT INTO tbl_objeto_comentarios(rut, id_objeto, comentario, fecha, hora, id_categoria, rut_colaborador) " . "VALUES ('$rut', '$id_objeto', '$comentario', '" . date("Y-m-d") . "', '" . date("H:i:s") . "', '$id_categoria', '$rut_colaborador');";
        $database->setquery($sql);
        $database->query();
    } else {
        echo "<script>
     alert('Comentario ya existe');
     </script>";
    }
}
function ComentariosPorObjetoDuplicado($id_objeto, $comentario, $rut)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
     select * from tbl_objeto_comentarios where id_objeto='$id_objeto' and rut='$rut' and comentario='$comentario'
";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ComentariosPorObjeto($id_objeto)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
     select tbl_objeto_comentarios.*, tbl_usuario.nombre_completo as nombre_persona
     from tbl_objeto_comentarios
     inner join tbl_usuario
     on tbl_usuario.rut=tbl_objeto_comentarios.rut
where
i    d_objeto='$id_objeto'
order by tbl_objeto_comentarios.id desc
";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ComentariosPorCategoria($id_categoria)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
     select tbl_objeto_comentarios.*, tbl_usuario.nombre_completo as nombre_persona
     from tbl_objeto_comentarios
     inner join tbl_usuario
     on tbl_usuario.rut=tbl_objeto_comentarios.rut
where
i    d_categoria='$id_categoria'
order by tbl_objeto_comentarios.id desc
";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function VerificaRespuestaPorPreguntaObjetoUsuario($id_objeto, $id_pregunta, $rut)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "


     select * from tbl_objeto_pregunta_respuestas
     where id_objeto='$id_objeto' and id_pregunta='$id_pregunta' and rut='$rut' limit 1


";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ObtenerRespuestasPreguntaPorObjetoPRegunta($id_objeto, $id_pregunta)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "


     select count(*) as total from tbl_objeto_pregunta_respuestas
     where id_objeto='$id_objeto' and id_pregunta='$id_pregunta'


";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ObtenerRespuestasPreguntaPorObjetoYTipo($id_objeto, $id_pregunta, $alternativa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "


     select count(*) as total from tbl_objeto_pregunta_respuestas
     where id_objeto='$id_objeto' and id_pregunta='$id_pregunta' and respuesta='$alternativa'


";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function InsertoRespuestaPReguntaPorObjeto($rut, $id_objeto, $id_pregunta, $alternativa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "INSERT INTO tbl_objeto_pregunta_respuestas(rut, id_objeto, id_pregunta, respuesta, fecha, hora, id_empresa) " . "VALUES ('$rut', '$id_objeto', '$id_pregunta', '$alternativa',  '" . date("Y-m-d") . "', '" . date("H:i:s") . "', '" . $_SESSION["id_empresa"] . "');";
    $database->setquery($sql);
    $database->query();
}
function DatosPreguntaObjetoDadoId($id_pregunta)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
     select tbl_objeto_pregunta.*
     from tbl_objeto_pregunta
where
i    d='$id_pregunta'
";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function PreguntaDadoIdObjeto($id_objeto, $tipo)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
     select tbl_objeto_pregunta.*
     from tbl_objeto_pregunta
where
i    d_objeto='$id_objeto' and tipo='$tipo'
";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ArchivosDadoIdObjeto($id_objeto)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "


     select tbl_biblio_archivos.*
     from tbl_biblio_archivos
     inner join tbl_biblio_categorias
     on tbl_biblio_categorias.id=tbl_biblio_archivos.id_categoria


     where tbl_biblio_categorias.id_objeto='$id_objeto'




";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function BloqueCitaPorObjeto($id_objeto)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
select * from tbl_objeto_bloque_cita where id_objeto='$id_objeto'
";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function BloqueTextoPorObjeto($id_objeto)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "




select * from tbl_objeto_bloque_texto where id_objeto='$id_objeto'






";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function RelMallaProgramaPorEmpresa($id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "


     SELECT
     rel_malla_programa.*, tbl_programa.nombre AS nombre_programa,
     tbl_programa.id AS id_programa
FROM
     rel_malla_programa
inner join tbl_programa on tbl_programa.id=rel_malla_programa.id_programa
inner join tbl_lms_malla
on tbl_lms_malla.id=rel_malla_programa.id_malla
WHERE
     tbl_lms_malla.id_empresa = '$id_empresa'


     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function DataPorIndicador($id_indicador)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "


select * from tbl_indicadores_data where id_indicador='$id_indicador'


";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TraeIndicadores($id_empresa, $variable)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "


select * from tbl_indicadores where idempresa='$id_empresa' and gerencia='$variable'


";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ObtieneMovimientosNuevosIngresos($id_categoria, $limit, $variable)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    if ($limit) {
        $limit = "limit $limit";
    } else {
        $limit = "";
    }
    if ($variable) {
        $comunidad = " and tbl_usuario.id_comunidad='$variable'";
    } else {
    }
    $sql = "


     select tbl_movimientos_publicados.*, tbl_usuario.nombre, tbl_usuario.apaterno, tbl_usuario.amaterno
     from tbl_movimientos_publicados
     inner join tbl_usuario on  tbl_usuario.rut=tbl_movimientos_publicados.rut
     where id_categoria='$id_categoria' $comunidad




order BY
     RAND()
$limit


     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ObtieneMovimientosNuevosIngresosPorEmpresaBKBK($id_categoria, $limit, $variable, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    if ($limit) {
        $limit = "limit $limit";
    } else {
        $limit = "";
    }
    if ($variable) {
        $comunidad = " and tbl_usuario.id_comunidad='$variable'";
    } else {
    }
    $sql = "


     select tbl_movimientos_publicados.*, tbl_usuario.nombre, tbl_usuario.apaterno, tbl_usuario.amaterno, tbl_usuario.ubicacion
     from tbl_movimientos_publicados
     inner join tbl_usuario on  tbl_usuario.rut=tbl_movimientos_publicados.rut and tbl_usuario.id_empresa='$id_empresa'
     where id_categoria='$id_categoria' $comunidad




order BY
     RAND()
$limit


     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ObtieneMovimientosNuevosIngresosPorEmpresa($id_categoria, $limit, $variable, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    if ($limit) {
        $limit = "limit $limit";
    } else {
        $limit = "";
    }
    if ($variable) {
        $comunidad = " and tbl_usuario.id_comunidad='$variable'";
    } else {
    }
    $sql = "


     select tbl_movimientos_publicados.*, tbl_usuario.nombre, tbl_usuario.apaterno, tbl_usuario.amaterno, tbl_usuario.ubicacion
     from tbl_movimientos_publicados
     inner join tbl_usuario on  tbl_usuario.rut=tbl_movimientos_publicados.rut and tbl_usuario.id_empresa='$id_empresa'
     where id_categoria='$id_categoria' $comunidad




order BY
     RAND()
$limit


     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function InsertarLogNoticia($rut, $id_noticia, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "INSERT INTO tbl_noticias_log(rut, id_empresa, id_noticia, fecha, hora) " . "VALUES ('$rut', '$id_empresa', '$id_noticia', '" . date("Y-m-d") . "', '" . date("H:i:s") . "');";
    $database->setquery($sql);
    $database->query();
}
function TraeUltimasFotosSubidas($limit)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "


select * from tbl_galeria_archivos order by id desc limit $limit


";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TraeUltimasFotosSubidasPorEmpresa($limit, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "


select
     tbl_galeria_archivos.*
FROM
     tbl_galeria_archivos
inner join tbl_galeria
on tbl_galeria.id=tbl_galeria_archivos.id_categoria
where tbl_galeria.id_empresa=$id_empresa
order BY
     id DESC
limit $limit
";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TotalMensajesPorRutEmpresa($rut, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "


     select tbl_mensajes_principal.*,
     tbl_usuario.nombre as nombre_creador, tbl_usuario.apaterno, tbl_usuario.amaterno, tbl_mensajes_destinatarios.nombre as nombre_tipo_destinatario,
     tbl_mensaje_tipo.nombre as nombre_titulo,
     (select count(*) as total_respuestas from tbl_mensajes_respuestas where id_mensaje=tbl_mensajes_principal.id) as total_comen
     from tbl_mensajes_principal


     inner join tbl_usuario
     on tbl_usuario.rut=tbl_mensajes_principal.rut_creador


     inner join tbl_mensajes_destinatarios
     on tbl_mensajes_destinatarios.id=tbl_mensajes_principal.id_tipo_destinatario


     inner join tbl_mensaje_tipo
     on tbl_mensaje_tipo.id=tbl_mensajes_principal.tipo_mensaje


     where tbl_mensajes_principal.rut_creador='$rut' and tbl_mensajes_principal.id_empresa='$id_empresa'


     order by id desc


";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function InsertarMensaje($rut, $titulo, $mensaje, $tipo_mensaje, $id_empresa, $destinatario, $id_curso, $id_objeto)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "INSERT INTO tbl_mensajes_principal(rut_creador, titulo, mensaje, tipo_mensaje, fecha, hora, id_empresa, id_tipo_destinatario, id_curso, id_objeto) " . "VALUES ('$rut', '$titulo', '$mensaje', '$tipo_mensaje', '" . date("Y-m-d") . "', '" . date("H:i:s") . "', '$id_empresa', '$destinatario', '$id_curso', '$id_objeto');";
    $database->setquery($sql);
    $database->query();
}
function TotalMensajesPorRutEmpresaAgente($rut, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "


     select tbl_mensajes_principal.*,
     tbl_usuario.nombre as nombre_creador, tbl_usuario.apaterno, tbl_usuario.amaterno,
     tbl_mensaje_tipo.nombre as nombre_titulo,
     (select count(*) as total_respuestas from tbl_mensajes_respuestas where id_mensaje=tbl_mensajes_principal.id) as total_comen
     from tbl_mensajes_principal


     inner join tbl_usuario
     on tbl_usuario.rut=tbl_mensajes_principal.rut_creador




     inner join tbl_mensaje_tipo
     on tbl_mensaje_tipo.id=tbl_mensajes_principal.tipo_mensaje


     where tbl_mensajes_principal.rut_creador='$rut' and tbl_mensajes_principal.id_empresa='$id_empresa'


     order by id desc";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function InsertarMensaje_agente($rut, $titulo, $mensaje, $tipo_mensaje, $id_empresa, $destinatario, $id_curso, $id_objeto)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "INSERT INTO tbl_mensajes_principal(rut_creador, titulo, mensaje, tipo_mensaje, fecha, hora, id_empresa, id_tipo_destinatario, id_curso, id_objeto) " . "VALUES ('$rut', '$titulo', '$mensaje', '$tipo_mensaje', '" . date("Y-m-d") . "', '" . date("H:i:s") . "', '$id_empresa', '$destinatario', '$id_curso', '$id_objeto');";
    $database->setquery($sql);
    $database->query();
}
function TotalUsuariosPorRutJefe($rut)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "


     select     h.*,
     (select count(id) from tbl_lms_acciones_pendientes where rut_colaborador=h.rut)  as cuenta


     from tbl_usuario h


     where h.jefe='$rut' or h.responsable='$rut'
     and h.vigencia='0'


     order by (select count(id) from tbl_lms_acciones_pendientes where rut_colaborador=h.rut) desc, h.nombre asc


";
//echo $sql; exit();
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TotalUsuariosPorRutLiderEjecutivos($rut)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "


     select     h.*,
     (select count(id) from tbl_lms_acciones_pendientes where rut_colaborador=h.rut)  as cuenta


     from tbl_usuario h


     where h.lider='$rut'
     and h.vigencia='0'


     order by (select count(id) from tbl_lms_acciones_pendientes where rut_colaborador=h.rut) desc, h.nombre asc


     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TotalReconocimientosPorCategoria($id_categoria, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
     SELECT
     tbl_salonfama_publicados.*, tbl_salonfama_categorias.nombre AS nombre_categoria,
     tbl_salonfama_categorias.titulo_listado AS titulo_pagina,
     tbl_salonfama_categorias.descripcion AS descripcion_categoria,
     tbl_salonfama_valores.nombre AS nombre_valor,
     imagen,
     tbl_usuario.nombre,
     tbl_usuario.apaterno,
     tbl_usuario.amaterno,
     tbl_usuario.nombre_completo,
     tbl_usuario.cargo,
     tbl_salonfama_categorias.template_row AS template_row,
     tbl_salonfama_categorias.imagen_form,
     tbl_salonfama_categorias.imagen_inicio_pagina,
     tbl_salonfama_conductas.nombre as nombre_conducta_valor
FROM
     tbl_salonfama_publicados
INNER JOIN tbl_salonfama_categorias ON tbl_salonfama_categorias.id = tbl_salonfama_publicados.id_tipo_reconocimiento
INNER JOIN tbl_salonfama_valores ON tbl_salonfama_valores.id = tbl_salonfama_publicados.id_valor
left join tbl_salonfama_conductas on tbl_salonfama_conductas.id=tbl_salonfama_publicados.id_conducta
INNER JOIN tbl_usuario ON tbl_usuario.rut = tbl_salonfama_publicados.rut
WHERE
     idempresa = '$id_empresa'
and id_tipo_reconocimiento = '$id_categoria'
order BY
     nombre_valor,
     tbl_salonfama_publicados.id DESC


";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TotalReconocimientosPorRut($rut, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
     select
     tbl_salonfama_publicados.*, tbl_salonfama_categorias.nombre as nombre_categoria, tbl_salonfama_categorias.descripcion as descripcion_categoria, imagen
     from tbl_salonfama_publicados
     inner join tbl_salonfama_categorias
     on tbl_salonfama_categorias.id=tbl_salonfama_publicados.id_tipo_reconocimiento
     where rut='$rut' and idempresa='$id_empresa'


";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ObtenerCumpleanosPorMesPorEmpresaTodos($id_empresa, $limit)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    if ($limit) {
        $limit = "limit $limit";
    } else {
        $limit = "";
    }
    $sql = "


select nombre, apaterno, amaterno, cargo, fecha_nacimiento, rut, nombre_completo
from tbl_usuario
where extract(month from fecha_nacimiento) = extract(month from current_date)


AND id_empresa='$id_empresa' order by extract(day from fecha_nacimiento)  $limit






     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ObtenerCumpleanosPorMesPorEmpresa($id_empresa, $limit)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    if ($limit) {
        $limit = "limit $limit";
    } else {
        $limit = "";
    }
    $sql = "


select nombre, cargo, fecha_nacimiento, rut, nombre_completo, apaterno, amaterno
from tbl_usuario
where extract(month from fecha_nacimiento) = extract(month from current_date)
AND
     extract(day from fecha_nacimiento) >= extract(day from current_date)
AND id_empresa='$id_empresa' order by extract(day from fecha_nacimiento)  $limit






     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ObtenerCumpleanosPorDiaPorEmpresa($id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
select nombre, fecha_nacimiento, cargo, rut, ubicacion, nombre_completo, apaterno, amaterno
from tbl_usuario
where extract(month from fecha_nacimiento) = extract(month from current_date) and
     extract(day from fecha_nacimiento) = extract(day from current_date)
AND id_empresa='$id_empresa'


     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ObtenerSalonPorCategoriaYEmpresa($id_empresa, $id_categoria, $limit)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    if ($limit) {
        $limit = "limit $limit";
    } else {
        $limit = "";
    }
    $sql = "


     SELECT
     tbl_salonfama_categorias.nombre,
     tbl_salonfama_categorias.imagen,
     tbl_salonfama_publicados.*, tbl_usuario.nombre AS nombre_persona,
     tbl_usuario.apaterno,
     tbl_usuario.amaterno,
     tbl_usuario.cargo,
     tbl_salonfama_valores.nombre as nombre_valor
FROM
     tbl_salonfama_publicados
INNER JOIN tbl_usuario ON tbl_usuario.rut = tbl_salonfama_publicados.rut
INNER JOIN tbl_salonfama_categorias ON tbl_salonfama_categorias.id = tbl_salonfama_publicados.id_tipo_reconocimiento
left join tbl_salonfama_valores on tbl_salonfama_valores.id=tbl_salonfama_publicados.id_valor
WHERE
     tbl_salonfama_publicados.idempresa = '$id_empresa'
and tbl_salonfama_publicados.id_tipo_reconocimiento = '$id_categoria'
order BY
     RAND()
$limit










     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function CategoriasSalonDeLaFamaPorEmpresaTipoBanners($id_empresa, $tipo_banners)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "


     select * from tbl_salonfama_categorias
     where id_empresa='$id_empresa' and tipo_banners='$tipo_banners'


     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function CategoriasSalonDeLaFamaPorEmpresa($id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "


     select * from tbl_salonfama_categorias
     where id_empresa='$id_empresa' and tipo_banners='1'


     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TotalSalonDeLaFamaPorEmpresa($id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "


     select
     tbl_salonfama_categorias.nombre,
     tbl_salonfama_categorias.imagen,
     tbl_salonfama_publicados.*,
     tbl_usuario.nombre,
     tbl_usuario.apaterno,
     tbl_usuario.amaterno
     from
     tbl_salonfama_publicados
     inner join tbl_usuario
     on tbl_usuario.rut=tbl_salonfama_publicados.rut


inner join tbl_salonfama_categorias
on tbl_salonfama_categorias.id=tbl_salonfama_publicados.id_tipo_reconocimiento
where tbl_salonfama_publicados.idempresa='$id_empresa'


     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function EncSatisTopBottom($id_inscripcion, $limit, $order)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "


     SELECT
     tbl_enc_satis.idencuesta,
     tbl_enc_satis.nombre,
     tbl_enc_satis_dim.iddimension,
     tbl_enc_satis_dim.dimension,
tbl_enc_satis_preg.idpregunta,
     tbl_enc_satis_preg.pregunta,


A    VG(tbl_enc_satis_opc.puntaje) as promedio_por_pregunta
FROM
     tbl_enc_satis_respuestas
INNER JOIN tbl_enc_satis_preg ON tbl_enc_satis_preg.idpregunta = tbl_enc_satis_respuestas.id_pregunta
INNER JOIN tbl_enc_satis_dim ON tbl_enc_satis_dim.iddimension = tbl_enc_satis_preg.iddimension
INNER JOIN tbl_enc_satis ON tbl_enc_satis.idencuesta = tbl_enc_satis_dim.idencuesta
inner join tbl_enc_satis_opc on tbl_enc_satis_opc.idopcion=tbl_enc_satis_preg.idopcion and tbl_enc_satis_respuestas.respuesta=tbl_enc_satis_opc.opcion
where tbl_enc_satis_respuestas.id_inscripcion='$id_inscripcion'


group BY tbl_enc_satis_preg.idpregunta
order BY promedio_por_pregunta $order limit $limit




     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function EncSatisPromedioPorDimension($id_inscripcion, $id_dimension)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "


     SELECT
     tbl_enc_satis.idencuesta,
     tbl_enc_satis.nombre,
     tbl_enc_satis_dim.iddimension,


     tbl_enc_satis_dim.dimension,
     AVG(tbl_enc_satis_opc.puntaje) as promedio
FROM
     tbl_enc_satis_respuestas
INNER JOIN tbl_enc_satis_preg ON tbl_enc_satis_preg.idpregunta = tbl_enc_satis_respuestas.id_pregunta
INNER JOIN tbl_enc_satis_dim ON tbl_enc_satis_dim.iddimension = tbl_enc_satis_preg.iddimension
INNER JOIN tbl_enc_satis ON tbl_enc_satis.idencuesta = tbl_enc_satis_dim.idencuesta
inner join tbl_enc_satis_opc on tbl_enc_satis_opc.idopcion=tbl_enc_satis_preg.idopcion and tbl_enc_satis_respuestas.respuesta=tbl_enc_satis_opc.opcion
where tbl_enc_satis_respuestas.id_inscripcion='$id_inscripcion'


group BY tbl_enc_satis_dim.iddimension
order BY tbl_enc_satis.idencuesta,    tbl_enc_satis_dim.iddimension




     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function DimensionPorEncuesta($id_encuesta)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "


     SELECT
     tbl_enc_satis.idencuesta,
     tbl_enc_satis.nombre,
     tbl_enc_satis_dim.iddimension,
     tbl_enc_satis_dim.dimension


FROM
     tbl_enc_satis_dim


INNER JOIN tbl_enc_satis ON tbl_enc_satis.idencuesta = tbl_enc_satis_dim.idencuesta
WHERE
     tbl_enc_satis.idencuesta = '$id_encuesta'


     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function InsertoRegistroFinEncSatis($rut, $id_encuesta, $id_empresa, $id_inscripcion, $id_objeto)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "INSERT INTO tbl_enc_satis_finalizados(rut, id_encuesta, id_empresa, fecha, hora, id_inscripcion, id_objeto) " . "VALUES ('$rut', '$id_encuesta', '$id_empresa',  '" . date("Y-m-d") . "', '" . date("H:i:s") . "', '$id_inscripcion', '$id_objeto');";
    $database->setquery($sql);
    $database->query();
}
function DatosPreguntaPorId($id)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "




     select tbl_evaluaciones_preguntas.*, tbl_evaluaciones_tipo_preguntas.feedback
     from
     tbl_evaluaciones_preguntas
     left join tbl_evaluaciones_tipo_preguntas
     on tbl_evaluaciones_tipo_preguntas.id=tbl_evaluaciones_preguntas.tipo
     where
     tbl_evaluaciones_preguntas.id='$id'


     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function DatosEnvioCorreoPorProceso($rut, $id_proceso)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "




     select * from tbl_correos_usuarios_proceso where rut='$rut' and id_proceso='$id_proceso' and estado=0


     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function DatosEnvioCorreoPorProcesoReenvio($rut, $id_proceso)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "




     select * from tbl_correos_usuarios_proceso where rut='$rut' and id_proceso='$id_proceso' and estado=1


     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TRaigoTresNoticiasMismaCategoria($id_empresa, $id_categoria, $limit)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    if ($limit) {
        $limit = " limit $limit";
    } else {
        $limit = "";
    }
    $sql = "select *from tbl_noticias where id_empresa='$id_empresa' and categoria='$id_categoria' $limit ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TRaigoUltimas3Noticias($id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select *from tbl_noticias where id_empresa='$id_empresa' order by id desc limit 3 ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TraigoNoticasMasVistas($id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_noticias where id_empresa='$id_empresa' order by visitas desc limit 3 ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function CategoriasNoticiasPorEmpresa($id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
     select
     tbl_noticias_categorias.*,
     (select count(*) as total from tbl_noticias where categoria=tbl_noticias_categorias.id and tbl_noticias.id_empresa='$id_empresa') as total_noticia,
     (select count(*) as total_sub_catego from tbl_noticias_subcategorias where tbl_noticias_subcategorias.id_categoria=tbl_noticias_categorias.id) as tota_sub_cart
     from
     tbl_noticias_categorias
     where
     tbl_noticias_categorias.id_empresa='$id_empresa'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function InsertaVotoUnico($id, $rut)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "INSERT INTO tbl_galeria_votos(id_archivo, id_usuario) " . "VALUES ('$id', '$rut');";
    $database->setquery($sql);
    $database->query();
}
function InsertaMenuN2($nombre, $link, $id_menun1, $tipo_link)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "INSERT INTO tbl_menu_nivel2(id_nivel1, nombre, link, tipo_link) " . "VALUES ('$id_menun1', '$nombre', '$link', '$tipo_link');";
    $database->setquery($sql);
    $database->query();
}
function ActualizoPrioridadNositicasPrincipales($id, $prioridad)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "update tbl_noticias_principales set prioridad='$prioridad' where id='$id'";
    $database->setquery($sql);
    $database->query();
}
function ActualizaDatosMenuN1($nombre, $link, $id)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "update tbl_menu_nivel1 set nombre='$nombre', link='$link'  where id='$id'";
    $database->setquery($sql);
    $database->query();
}
function InsertaMenuN1($nombre, $link, $id_empresa, $tipo_link)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "INSERT INTO tbl_menu_nivel1(nombre, link, id_empresa) " . "VALUES ('$nombre', '$link', '$id_empresa');";
    $database->setquery($sql);
    $database->query();
}
function DatosMenuN1($id_menu)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "




     select
     *
     from tbl_menu_nivel1
     where id='$id_menu'


";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function DatosMenuNivelDadoId($id_nivel, $nivel)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "




     select
     tbl_menu_nivel" . $nivel . ".*,
     tbl_paginas_templates.template  as pagina_a_mostrar,
     tbl_paginas_templates.variable,
     tbl_paginas_templates.contenido
     from tbl_menu_nivel" . $nivel . "
     inner join tbl_paginas_templates
     on tbl_paginas_templates.id=link
     where tbl_menu_nivel" . $nivel . ".id='$id_nivel'


";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function DatosMenuNivel2DadoNivel1($id_nivel1)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "




     select
     *
     from tbl_menu_nivel2
     where id_nivel1='$id_nivel1'
     order by orden


";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function DatosMenuNivel1DadoEmpresa($id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "




     select
     tbl_menu_nivel1.*, (select count(*) as total from tbl_menu_nivel2 where id_nivel1=tbl_menu_nivel1.id) as total_nivel2
     from tbl_menu_nivel1
     where id_empresa='$id_empresa' order by orden asc


";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function EncTraePaginaMayor($id_encuesta)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
     SELECT
     max(DISTINCT(pagina)) AS pagina_mayor
FROM
     tbl_enc_satis_preg
inner join tbl_enc_satis_dim
on tbl_enc_satis_dim.iddimension=tbl_enc_satis_preg.iddimension
inner join tbl_enc_satis
on tbl_enc_satis.idencuesta=tbl_enc_satis_dim.idencuesta
where tbl_enc_satis.idencuesta='$id_encuesta'
";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function InsertoRegistroRespuestaEncSatis($rut, $id_pregunta, $respuesta, $id_encuesta, $id_empresa, $id_inscripcion, $id_objeto, $rut_relator)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "INSERT INTO tbl_enc_satis_respuestas(id_encuesta, id_pregunta, id_empresa, rut, respuesta, fecha, hora, id_inscripcion, id_objeto, rut_relator) " . "VALUES ('$id_encuesta', '$id_pregunta', '$id_empresa', '$rut', '$respuesta', '" . date("Y-m-d") . "', '" . date("H:i:s") . "', '$id_inscripcion', '$id_objeto', '$rut_relator');";
    $database->setquery($sql);
    $database->query();
}
function EliminoColaboradoresDNCDadoId($rut_colaborador, $rut_jefe)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = sprintf("DELETE from tbl_dnc_colaboradores_por_objetivo WHERE rut = '$rut_colaborador' and rut_jefe='$rut_jefe'");
    $database->setquery($sql);
    $database->query();
}
function EliminoColaboradoresDadaSugerencia($id)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = sprintf("DELETE from tbl_dnc_colaboradores_por_objetivo WHERE id_sugerencia = '$id'");
    $database->setquery($sql);
    $database->query();
}
function EliminarSugerenciaDadoId($id)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = sprintf("DELETE from tbl_dnc_sugerencias_por_objetivo WHERE id = '$id'");
    $database->setquery($sql);
    $database->query();
}
function EncActualizaRegistroSesion($rut, $id_empresa, $pagina, $id_objeto, $id_encuesta)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "update tbl_enc_satis_sesion set pagina='$pagina', fecha='" . date("Y-m-d") . "', hora='" . date("H:i:s") . "' where rut='$rut' and id_empresa='$id_empresa' and id_objeto='$id_objeto' and idencuesta='$id_encuesta'";
    $database->setquery($sql);
    $database->query();
}
function EncInsertaRegistroSesion($rut, $id_empresa, $pagina, $id_inscripcion, $id_objeto, $id_encuesta)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "INSERT INTO tbl_enc_satis_sesion(rut, pagina, id_empresa, fecha, hora, id_inscripcion, id_objeto, idencuesta) " . "VALUES ('$rut', '$pagina', '$id_empresa', '" . date("Y-m-d") . "', '" . date("H:i:s") . "', '$id_inscripcion', '$id_objeto', '$id_encuesta');";
    $database->setquery($sql);
    $database->query();
}
function DatosEmpresaHolding($rut)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_empresa_holding where rut='$rut'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function EncTieneSesion($rut, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_enc_satis_sesion where rut='$rut' and id_empresa='$id_empresa'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function EncTieneSesionPorEncuesta($rut, $id_empresa, $id_encuesta, $id_objeto)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_enc_satis_sesion where rut='$rut' and id_empresa='$id_empresa' and idencuesta='$id_encuesta' and id_objeto='$id_objeto'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function EncTieneSesionPorObjeto($rut, $id_empresa, $id_objeto, $id_encuesta)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_enc_satis_sesion where rut='$rut' and id_empresa='$id_empresa' and id_objeto='$id_objeto'  and idencuesta='$id_encuesta' ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function allPersonasPorEmpresa($buscar, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "SELECT * FROM tbl_usuario
     WHERE id_empresa='$id_empresa'
     and (nombre_completo like '%" . $buscar . "%' OR rut like '%" . $buscar . "%')
     and vigencia='0'
     ORDER BY nombre_completo";

    $database->setquery($sql);
    $database->query();
    $datos = $database->listObjects();
    return $datos;
}

function allPersonasPorEmpresaSinDivPersona($buscar, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "SELECT * FROM tbl_usuario
     WHERE id_empresa='$id_empresa'
     and ( rut like '%" . $buscar . "%')
     and vigencia='0' and division<>'Division Personas y Organizacion'
     ORDER BY nombre_completo";

     //echo $sql;exit();

    $database->setquery($sql);
    $database->query();
    $datos = $database->listObjects();
    return $datos;
}
function allPersonasPorEmpresaSinDivPersonaJefe($buscar, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "SELECT * FROM tbl_usuario
     WHERE id_empresa='$id_empresa'
     and ( rut like '%" . $buscar . "%')
     and vigencia='0' and division<>'Division Personas y Organizacion'  and (select count(id) from tbl_usuario where ( jefe like '%" . $buscar . "%') )>0
     ORDER BY nombre_completo";

     //echo $sql;exit();

    $database->setquery($sql);
    $database->query();
    $datos = $database->listObjects();
    return $datos;
}


function allArchivosBibliotecaPorEmpresaMPDATA($buscar, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $nombrearray = explode(" ", $buscar);
    $nombrep1    = $nombrearray[0];
    $nombrep2    = $nombrearray[1];
    $nombrep3    = $nombrearray[2];
    $nombrep4    = $nombrearray[3];
    if ($nombrep2 <> '') {
        $andp1         = " or ";
        $query_nombre2 = " h.titulo like '%" . $nombrep2 . "%'  or  h.descripcion like '%" . $nombrep2 . "%'";
    }
    if ($nombrep3 <> '') {
        $andp2         = " or ";
        $query_nombre3 = " h.titulo like '%" . $nombrep3 . "%'  or  h.descripcion like '%" . $nombrep3 . "%'";
    }
    if ($nombrep4 <> '') {
        $andp3         = " or ";
        $query_nombre4 = " h.titulo like '%" . $nombrep4 . "%'  or  h.descripcion like '%" . $nombrep4 . "%'";
    }
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "SELECT h.*,
     (select categoria from tbl_biblio_categorias where id=h.id_categoria) as NombreSubCat,
     (select categoria from tbl_biblio_categorias where id=(select id_categoria from tbl_biblio_categorias where id=h.id_categoria)) as NombreCat




     FROM tbl_biblio_archivos h
     WHERE
     (select id_empresa from tbl_biblio_categorias where id=h.id_categoria)='$id_empresa'




     and
     (h.titulo like '%" . $nombrep1 . "%' or h.descripcion like '%" . $nombrep1 . "%'
     $andp1
     $query_nombre2
     $andp2
     $query_nombre3
     $andp3
     $query_nombre4








     )




     ORDER BY h.titulo";
    $database->setquery($sql);
    $database->query();
    $datos = $database->listObjects();
    return $datos;
}
function allPersonasPorEmpresaMP($buscar, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $nombrearray = explode(" ", $buscar);
    $nombrep1    = $nombrearray[0];
    $nombrep2    = $nombrearray[1];
    $nombrep3    = $nombrearray[2];
    $nombrep4    = $nombrearray[3];
    if ($nombrep2 <> '') {
        $andp1         = " and ";
        $query_nombre2 = " nombre_completo like '%" . $nombrep2 . "%' ";
    }
    if ($nombrep3 <> '') {
        $andp2         = " and ";
        $query_nombre3 = " nombre_completo like '%" . $nombrep3 . "%' ";
    }
    if ($nombrep4 <> '') {
        $andp3         = " and ";
        $query_nombre4 = " nombre_completo like '%" . $nombrep4 . "%' ";
    }
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "SELECT * FROM tbl_usuario
     WHERE id_empresa='$id_empresa'


     and
     (nombre_completo like '%" . $nombrep1 . "%' $andp1
     $query_nombre2 $andp2
     $query_nombre3 $andp3
     $query_nombre4)


     and vigencia='0'
     ORDER BY nombre_completo";
    $database->setquery($sql);
    $database->query();
    $datos = $database->listObjects();
    return $datos;
}
function allPersonasPorEmpresaMP_GOPLAY($buscar, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $nombrearray = explode(" ", $buscar);
    $nombrep1    = $nombrearray[0];
    $nombrep2    = $nombrearray[1];
    $nombrep3    = $nombrearray[2];
    $nombrep4    = $nombrearray[3];
    if ($nombrep2 <> '') {
        $andp1         = " and ";
        $query_nombre2 = " nombre_completo like '%" . $nombrep2 . "%' ";
    }
    if ($nombrep3 <> '') {
        $andp2         = " and ";
        $query_nombre3 = " nombre_completo like '%" . $nombrep3 . "%' ";
    }
    if ($nombrep4 <> '') {
        $andp3         = " and ";
        $query_nombre4 = " nombre_completo like '%" . $nombrep4 . "%' ";
    }
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "SELECT * FROM tbl_usuario
     WHERE id_empresa='$id_empresa'


     and
     (nombre_completo like '%" . $nombrep1 . "%' $andp1
     $query_nombre2 $andp2
     $query_nombre3 $andp3
     $query_nombre4)


     and rut<>'" . $_SESSION["user_"] . "'
     and vigencia='0'
     ORDER BY nombre_completo";
    $database->setquery($sql);
    $database->query();
    $datos = $database->listObjects();
    return $datos;
}
function allSucursalesPorEmpresa($buscar, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "SELECT * FROM tbl_sucursales WHERE id_empresa='$id_empresa' and (nombre like '%" . $buscar . "%') ORDER BY nombre";
    $database->setquery($sql);
    $database->query();
    $datos = $database->listObjects();
    return $datos;
}
function allPersonas($buscar)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "SELECT * FROM tbl_usuario WHERE nombre_completo like '%" . $buscar . "%' OR rut like '%" . $buscar . "%' ORDER BY nombre_completo";
    $database->setquery($sql);
    $database->query();
    $datos = $database->listObjects();
    return $datos;
}
function DatosExtensionDeObjeto($id)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_objetos_extension


     where id='$id'";

    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function EncOpcionesDadoId($id_opciones)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "


     select * from tbl_enc_satis_opc where idopcion='$id_opciones' order by orden asc






     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function EncTraigoPreguntasDadaPaginaIdEncuesta($id_encuesta, $pagina)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "


     select


     tbl_enc_satis_preg_tipo.template, tbl_enc_satis_preg_tipo.template_opcion,


     tbl_enc_satis_preg.*, tbl_enc_satis_dim.dimension as nombre_dimension, tbl_enc_satis_dim.visible


from


tbl_enc_satis_preg






inner join tbl_enc_satis_dim


on tbl_enc_satis_dim.iddimension=tbl_enc_satis_preg.iddimension






INNER JOIN tbl_enc_satis


on tbl_enc_satis.idencuesta=tbl_enc_satis_dim.idencuesta


inner join tbl_enc_satis_preg_tipo on tbl_enc_satis_preg_tipo.id=tbl_enc_satis_preg.tipo_pregunta








where pagina='$pagina' and tbl_enc_satis.idencuesta='$id_encuesta'






     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ObtenerEncuestaDadiIdObjeto($id_objeto)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select  tbl_enc_satis.*


     from tbl_objeto


     inner join tbl_enc_satis


     on tbl_enc_satis.idencuesta=tbl_objeto.id_encuesta


     where tbl_objeto.id='$id_objeto'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ObtenerEncuestaDadaEmpresa($id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select  tbl_enc_satis.*


     from rel_empresa_encuesta


     inner join tbl_enc_satis


     on tbl_enc_satis.idencuesta=rel_empresa_encuesta.id_encuesta


     where rel_empresa_encuesta.id_empresa='$id_empresa' and tbl_enc_satis.idencuesta";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function InsertoRegistroIngresoPorCorreo($rut, $token)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "INSERT INTO tbl_correos_registros_externos(rut, token, fecha) " . "VALUES ('$rut', '$token', '" . date("Y-m-d") . " " . date("H:i:s") . "');";
    $database->setquery($sql);
    $database->query();
}
function InsertoRegistroEnvioCorreo($rut, $token_individual, $id_inscripcion, $id_proceso)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "INSERT INTO tbl_correos_registros_envios(rut, token_enviado, fecha_envio_correo, id_inscripcion, id_proceso_masivo) " . "VALUES ('$rut', '$token_individual', '" . date("Y-m-d") . " " . date("H:i:s") . "', '$id_inscripcion', '$id_proceso');";
    $database->setquery($sql);
    $database->query();
}
function ActualizaSugerencia($id_sugerencia, $post)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "update tbl_dnc_sugerencias_por_objetivo






     set


     tipo='" . $post["tipo"] . "',


     prioridad='" . $post["prioridad"] . "',


     tipo_accion='" . $post["tipo_accion"] . "',


     descripcion_accion='" . utf8_decode($post["descripcion_accion"]) . "',


     tematica_select='" . $post["tematica_select"] . "',


     tematica_texto='" . utf8_decode($post["tematica_texto"]) . "',


     priorizar_tematica='" . utf8_decode($post["priorizar_tematica"]) . "',
     contenido1='" . utf8_decode($post["contenido1"]) . "',


     contenido2='" . utf8_decode($post["contenido2"]) . "',
     contenido3='" . utf8_decode($post["contenido3"]) . "',
     contenido4='" . utf8_decode($post["contenido4"]) . "',
     contenido5='" . utf8_decode($post["contenido5"]) . "'










     where id='$id_sugerencia';";
    $database->setquery($sql);
    $database->query();
}
function EliminarColaboradoresSinSugerencia($rut_jefe)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = sprintf("DELETE from tbl_dnc_colaboradores_por_objetivo WHERE id_sugerencia is null");
    $database->setquery($sql);
    $database->query();
}
function ActualizaUsuariosPorSugerencia($rut_jefe, $id_sugerencia)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "update tbl_dnc_colaboradores_por_objetivo set id_sugerencia='$id_sugerencia' where rut_jefe='$rut_jefe' and id_sugerencia is null;";
    $database->setquery($sql);
    $database->query();
}
function ActualizaObjetivoPorJefatura($rut_jefe, $objetivo, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "update tbl_dnc_objetivos_por_jefe set objetivo='$objetivo', id_empresa='$id_empresa' where rut_jefe='$rut_jefe';";
    $database->setquery($sql);
    $database->query();
}
function UltimaSugerenciaIngresada($jefe)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select max(id) as ultimo from tbl_dnc_sugerencias_por_objetivo where rut_jefe='$jefe'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ObtenerSugerenciasDadoIdObjetivo($id_objetivo)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_dnc_sugerencias_por_objetivo where id_objetivo='$id_objetivo' order by numero_sugerencia asc";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function SugerenciaPorId($id)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_dnc_sugerencias_por_objetivo where id='$id'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TraigoElAbierto($jefe)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_dnc_sugerencias_por_objetivo where rut_jefe='$jefe' and  cerrado='0'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TRaigoSugerenciasPorObjetivo($jefe)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_dnc_sugerencias_por_objetivo where rut_jefe='$jefe'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TRaigoSugerenciasCerradas($jefe)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_dnc_sugerencias_por_objetivo where rut_jefe='$jefe' where cerrado='1'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function AgregocolPorJefeDNCConIdSug($evaluado, $dato, $evaluador, $id_sugerencia, $rut_evaluado)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "INSERT INTO tbl_dnc_colaboradores_por_objetivo(rut, nombre, rut_jefe, prioridad, id_sugerencia) " . "VALUES ('$rut_evaluado', '$evaluado', '$evaluador', '$dato', '$id_sugerencia');";
    $database->setquery($sql);
    $database->query();
}
function AgregocolPorJefeDNC($evaluado, $dato, $evaluador, $rut_evaluado)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "INSERT INTO tbl_dnc_colaboradores_por_objetivo(rut, nombre, rut_jefe, prioridad) " . "VALUES ('$rut_evaluado', '$evaluado', '$evaluador', '$dato');";
    $database->setquery($sql);
    $database->query();
}
function UsuariosPorSugerenciaJefe($jefe, $id_sugerencia)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_dnc_colaboradores_por_objetivo where rut_jefe='$jefe' and id_sugerencia ='$id_sugerencia'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function UsuariosPorSugerenciaJefeYColaborador($jefe, $colaborador)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_dnc_colaboradores_por_objetivo where rut_jefe='$jefe' and rut='$colaborador'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function UsuariosPorJefeObjDnc($jefe)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_dnc_colaboradores_por_objetivo where rut_jefe='$jefe' and id_sugerencia is null";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function InsertaSugerencia($rut, $arreglo_datos, $numero_sugerencia)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "INSERT INTO tbl_dnc_sugerencias_por_objetivo(id_objetivo, tipo, descripcion, prioridad, tipo_accion, descripcion_accion, rut_jefe, tematica_select, tematica_texto, numero_sugerencia, contenido1, contenido2, contenido3, contenido4, priorizar_tematica, contenido5) " . "VALUES ('" . $arreglo_datos["ido"] . "','" . $arreglo_datos["tipo"] . "', '" . utf8_decode($arreglo_datos["descripcion"]) . "', '" . utf8_decode($arreglo_datos["prioridad"]) . "', '" . utf8_decode($arreglo_datos["tipo_accion"]) . "', '" . utf8_decode($arreglo_datos["descripcion_accion"]) . "', '$rut', '" . utf8_decode($arreglo_datos["tematica_select"]) . "', '" . utf8_decode($arreglo_datos["tematica_texto"]) . "', '$numero_sugerencia',
     '" . utf8_decode($arreglo_datos["contenido1"]) . "',
     '" . utf8_decode($arreglo_datos["contenido2"]) . "',
     '" . utf8_decode($arreglo_datos["contenido3"]) . "',
     '" . utf8_decode($arreglo_datos["contenido4"]) . "',
     '" . utf8_decode($arreglo_datos["priorizar_tematica"]) . "',
     '" . utf8_decode($arreglo_datos["contenido5"]) . "');";
    $database->setquery($sql);
    $database->query();
}
function TieneObjetivosIngresadosDNCFinalizado($jefe)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_dnc_objetivos_por_jefe_finalizado where rut_jefe='$jefe'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TieneObjetivosIngresadosDNC($jefe)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_dnc_objetivos_por_jefe where rut_jefe='$jefe'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function EliminarRegistroFinalizadoObjetivo($rut)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = sprintf("DELETE from tbl_dnc_objetivos_por_jefe_finalizado WHERE rut_jefe='" . $rut . "' ");
    $database->setquery($sql);
    $database->query();
}
function InsertaObjetivoPorJefaturaFinalizado($rut, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "INSERT INTO tbl_dnc_objetivos_por_jefe_finalizado(rut_jefe, fecha, hora, id_empresa) " . "VALUES ('$rut', '" . date("Y-m-d") . "', '" . date("H:i:s") . "', '$id_empresa');";
    $database->setquery($sql);
    $database->query();
}
function InsertaObjetivoPorJefatura($rut, $objetivo, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "INSERT INTO tbl_dnc_objetivos_por_jefe(objetivo, rut_jefe, fecha, hora, id_empresa) " . "VALUES ('$objetivo', '$rut', '" . date("Y-m-d") . "', '" . date("H:i:s") . "', '$id_empresa');";
    $database->setquery($sql);
    $database->query();
}
function TienePersonasInactivas($evaluador)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_sgd_noevaluables where evaluador='$evaluador'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function EliminarObjetivoDadoDimensionRut($dimension, $rut)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = sprintf("DELETE from tbl_objetivos_individuales WHERE rut='" . $rut . "' and dimension='$dimension' ");
    $database->setquery($sql);
    $database->query();
}
function EliminarObjetivoDadoId($id)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = sprintf("DELETE from tbl_objetivos_individuales WHERE id='" . $id . "' ");
    $database->setquery($sql);
    $database->query();
}
function ObtenerObjetivosDeRechazoUltimo($evaluado)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_objetivos_comentarios_rechazo where evaluado='$evaluado' order by id desc limit 1";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function EliminaRegistroEvaluadrAjuste($evaluado, $evaluador)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = sprintf("DELETE from tbl_objetivos_ajustes_jefe WHERE evaluador='" . $evaluador . "' and evaluado='$evaluado'");
    $database->setquery($sql);
    $database->query();
}
function ObtenerObjetivosDeRechazo($evaluado)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_objetivos_comentarios_rechazo where evaluado='$evaluado'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function InsertaComentarioRechazo($evaluado, $evaluador, $validador, $comentario)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "INSERT INTO tbl_objetivos_comentarios_rechazo(evaluado, evaluador, validador, fecha, hora, comentario) " . "VALUES ('$evaluado', '$evaluador', '$validador',  '" . date("Y-m-d") . "', '" . date("H:i:s") . "', '$comentario');";
    $database->setquery($sql);
    $database->query();
}
function InsertaValidacionJefeDelJefe($evaluado, $evaluador, $validador)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "INSERT INTO tbl_objetivos_validaciones(evaluado, evaluador, validador, fecha, hora) " . "VALUES ('$evaluado', '$evaluador', '$validador',  '" . date("Y-m-d") . "', '" . date("H:i:s") . "');";
    $database->setquery($sql);
    $database->query();
}
function EsValidador($rut)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_sgd_relaciones where validador='$rut'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function EsValidador2($rut)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_sgd_relaciones where validador='$rut' and evaluador<>validador";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ObtengoUltimaNotaObjetivoEmpresa($id_empresa, $id_proceso)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "


     SELECT


     avg((


     SELECT


     nota


     FROM


     tbl_sgd_notas_empresa


     WHERE


     tbl_sgd_notas_empresa.id_proceso = '$id_proceso'


     AND tbl_sgd_notas_empresa.id_objetivo = tbl_objetivos_empresa.id ORDER BY fecha desc limit 1


     ) ) as promedio_objetivos_corporativos


FROM


     tbl_objetivos_empresa






where id_empresa='$id_empresa'


     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ObtengoUltimaNotaObjetivoArea($id_area, $id_empresa, $id_proceso)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "


     SELECT


     tbl_objetivos_area.*, (


     SELECT


     tbl_sgd_notas_area.nota


     FROM


     tbl_sgd_notas_area


     WHERE


     tbl_objetivos_area.id = tbl_sgd_notas_area.id_objetivo and tbl_sgd_notas_area.id_proceso='$id_proceso'


     ORDER BY


     fecha DESC


     LIMIT 1


     ) as nota_area


FROM


     tbl_objetivos_area


WHERE


     tbl_objetivos_area.id_area = '$id_area'


and tbl_objetivos_area.id_empresa = '$id_empresa'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ObtengoDimensionesDadoPerfil($perfil)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = sprintf("select DISTINCT (id_dimension) from tbl_sgd_componente


inner join rel_sgd_perfil_competencias


on rel_sgd_perfil_competencias.id_componente=tbl_sgd_componente.id


where rel_sgd_perfil_competencias.perfil_evaluacion='$perfil'");
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function PromedioRespuestasComp($evaluado, $evaluador, $competencia)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = sprintf("select avg(puntaje) as nota_competencia, id_competencia, id_dimension from tbl_sgd_respuestas where evaluado='$evaluado' and evaluador='$evaluador' and id_competencia ='$competencia'");
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function PromedioObjetivosRepuestas($evaluado, $evaluador)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = sprintf("select avg(respuesta) as nota_objetivos from tbl_sgd_respuestas where evaluado='$evaluado' and evaluador='$evaluador' and id_objetivo is not null");
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ObjetivosEspecificosConRespuesta($rut)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = sprintf("






select tbl_sgd_respuestas.*, tbl_objetivos_individuales.descripcion_objetivo , tbl_objetivos_individuales.ponderacion


from tbl_sgd_respuestas


inner join tbl_objetivos_individuales


on tbl_objetivos_individuales.id=tbl_sgd_respuestas.id_objetivo


where evaluado='$rut'


     ");
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function InsertaEvaluadorFinalizado($evaluador, $id_proceso)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "INSERT INTO tbl_sgd_finalizados_evaluador(evaluador, id_proceso, fecha, hora) " . "VALUES ('$evaluador', '$id_proceso', '" . date("Y-m-d") . "', '" . date("H:i:s") . "');";
    $database->setquery($sql);
    $database->query();
}
function InsertaEvaluadoEvaluadorFinalizado($evaluado, $evaluador, $id_proceso)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "INSERT INTO tbl_sgd_finalizados_evaluado_evaluador(evaluado, evaluador, fecha, hora, id_proceso) " . "VALUES ('$evaluado' ,'$evaluador', '" . date("Y-m-d") . "', '" . date("H:i:s") . "', '$id_proceso');";
    $database->setquery($sql);
    $database->query();
}
function ObtenerJefeRel($evaluado)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = sprintf("






     select * from tbl_sgd_relaciones where evaluado='$evaluado' and subperfil='2'






     ");
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ObtenerJefeRelPorProcesoAE($evaluado, $id_proceso)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = sprintf("
     select * from tbl_sgd_relaciones where evaluado='$evaluado' and id_proceso='$id_proceso' and evaluado=evaluador
     ");
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ObtenerJefeRelPorProceso($evaluado, $id_proceso)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = sprintf("
     select *
     from tbl_sgd_relaciones
     where evaluado='$evaluado'
     and id_proceso='$id_proceso'
     and evaluado<>evaluador
     ");
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ObtenerJefeRel2($evaluado)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = sprintf("






     select tbl_usuario.*


     from tbl_sgd_relaciones


     inner join tbl_usuario


     on tbl_usuario.rut=tbl_sgd_relaciones.evaluador


     where tbl_sgd_relaciones.evaluado='$evaluado' and tbl_sgd_relaciones.subperfil='2'






     ");
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function FinalizadoEvaluadoEvaluador($evaluado, $evaluador, $id_proceso)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = sprintf("






     select * from tbl_sgd_finalizados_evaluado_evaluador where evaluado='$evaluado' and evaluador='$evaluador' and id_proceso='$id_proceso'
     ");
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function FinalizadoEvaluadorPorProcesoSinAe($evaluador, $id_proceso)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = sprintf("
     select * from tbl_sgd_finalizados_evaluado_evaluador
     where evaluador='$evaluador'
     and id_proceso='$id_proceso'
     and evaluado<>evaluador
     ");
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function FinalizadoEvaluadorPorProceso($evaluador, $id_proceso)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = sprintf("
     select * from tbl_sgd_finalizados_evaluador where evaluador='$evaluador' and id_proceso='$id_proceso'
     ");
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function FinalizadoEvaluador($evaluador)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = sprintf("
     select * from tbl_sgd_finalizados_evaluador where evaluador='$evaluador'
     ");
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function DatosCriterioPorPerfil($id_empresa, $perfil, $tipo_perfil, $dimension)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    if ($dimension == 0 && !$tipo_perfil) {
        $sql = sprintf("
     select * from tbl_sgd_matriz_criterios
     where id_empresa='$id_empresa' and perfil='$perfil'  and dimension='$dimension' and tipo_objeto is null
     ");
    } else if ($tipo_perfil) {
        $sql = sprintf("
     select * from tbl_sgd_matriz_criterios
     where id_empresa='$id_empresa' and perfil='$perfil' and tipo_objeto='$tipo_perfil'
     ");
    } else if ($dimension >= 0) {
        $sql = sprintf("
     select * from tbl_sgd_matriz_criterios
     where id_empresa='$id_empresa' and perfil='$perfil'  and dimension='$dimension'
     ");
    } else {
        $sql = sprintf("
     select * from tbl_sgd_matriz_criterios
     where id_empresa='$id_empresa' and perfil='$perfil' and tipo_objeto='$tipo_perfil'
     ");
    }
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function DatosCriterio($id_empresa, $perfil, $dimension)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = sprintf("
     select * from tbl_sgd_matriz_criterios
     where id_empresa='$id_empresa' and perfil='$perfil' and dimension='$dimension'
     ");
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function DatosDadoIDPregunta($id_pregunta)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = sprintf("SELECT
     tbl_sgd_preguntas.id as id_pregunta,
     tbl_sgd_componente.id as id_componente,
     tbl_sgd_dimensiones.id as id_dimension
     FROM
     tbl_sgd_preguntas
     inner join tbl_sgd_componente
     on tbl_sgd_componente.id=tbl_sgd_preguntas.id_competencia
     inner join tbl_sgd_dimensiones
     on tbl_sgd_dimensiones.id=tbl_sgd_componente.id_dimension
     WHERE
     tbl_sgd_preguntas.id = $id_pregunta");
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ActualizaRespuestas($evaluado, $evaluador, $respuesta, $id_pregunta, $perfil, $subperfil, $id_proceso, $id_empresa, $dimension, $componente, $criterios, $comentario_por_pregunta)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $datos_evaluado = UsuarioEnBaseDePersonasInnerEmpresa($evaluado);
    $database       = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "update tbl_sgd_respuestas set
     respuesta='$respuesta',
     criterio='" . $criterios[0] . "',
     puntaje='" . $criterios[1] . "',
     comentario='$comentario_por_pregunta',
     cargo_evaluado='" . $datos_evaluado[0]->cargo . "',
     campo1_evaluado='" . $datos_evaluado[0]->{$datos_evaluado[0]->campo1} . "',
     campo2_evaluado='" . $datos_evaluado[0]->{$datos_evaluado[0]->campo2} . "',
     campo3_evaluado='" . $datos_evaluado[0]->{$datos_evaluado[0]->campo3} . "',
     fecha='" . date("Y-m-d") . "',
     hora='" . date("H:i:s") . "'
     where
     evaluado='$evaluado' and
     evaluador='$evaluador' and
     id_pregunta='$id_pregunta' and
     id_proceso='$id_proceso';";
    $database->setquery($sql);
    $database->query();
    $sql = "update tbl_sgd_respuestas_log set
     respuesta='$respuesta',
     criterio='" . $criterios[0] . "',
     puntaje='" . $criterios[1] . "',
     comentario='$comentario_por_pregunta'
     where
     evaluado='$evaluado' and
     evaluador='$evaluador' and
     id_pregunta='$id_pregunta' and
     id_proceso='$id_proceso';";
    $database->setquery($sql);
    $database->query();
}
function ActualizaRespuestasObj2($evaluado, $evaluador, $respuesta, $id_objetivo, $criterio, $id_proceso)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "update tbl_sgd_respuestas set respuesta='$respuesta', criterio='" . $criterio[0] . "', puntaje='" . $criterio[1] . "' where evaluado='$evaluado' and evaluador='$evaluador' and id_objetivo='$id_objetivo' and id_proceso='$id_proceso';";
    $database->setquery($sql);
    $database->query();
    $sql = "update tbl_sgd_respuestas_log set respuesta='$respuesta', criterio='" . $criterio[0] . "', puntaje='" . $criterio[1] . "' where evaluado='$evaluado' and evaluador='$evaluador' and id_objetivo='$id_objetivo' and id_proceso='$id_proceso';";
    $database->setquery($sql);
    $database->query();
}
function ActualizaRespuestasObj1($evaluado, $evaluador, $respuesta, $id_objetivo, $criterio, $comentario_por_objetivo)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "update tbl_sgd_respuestas set respuesta='$respuesta', criterio='" . $criterio[0] . "', puntaje='" . $criterio[1] . "', comentario='" . $comentario_por_objetivo . "' where evaluado='$evaluado' and evaluador='$evaluador' and id_objetivo='$id_objetivo';";
    $database->setquery($sql);
    $database->query();
    $sql = "update tbl_sgd_respuestas_log set respuesta='$respuesta', criterio='" . $criterio[0] . "', puntaje='" . $criterio[1] . "' where evaluado='$evaluado' and evaluador='$evaluador' and id_objetivo='$id_objetivo';";
    $database->setquery($sql);
    $database->query();
}
function InsertaRespuestas($evaluado, $evaluador, $nota, $id_pregunta, $perfil, $subperfil, $id_proceso, $id_empresa, $dimension, $componente, $criterios, $comentario_por_pregunta)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $datos_evaluado = UsuarioEnBaseDePersonasInnerEmpresa($evaluado);
    $database       = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
     INSERT INTO
     tbl_sgd_respuestas
     (evaluado, evaluador, id_pregunta, respuesta, perfil, subperfil, id_proceso, id_empresa, id_dimension, id_competencia, criterio, puntaje, comentario, fecha, hora) " . "VALUES
     ('$evaluado', '$evaluador',  '$id_pregunta', '$nota', '$perfil', '$subperfil', '$id_proceso', '" . $_SESSION["id_empresa"] . "', '$dimension', '$componente', '" . $criterios[0] . "', '" . $criterios[1] . "', '$comentario_por_pregunta', '" . date("Y-m-d") . "', '" . date("H:i:s") . "');";
    $database->setquery($sql);
    $database->query();
    $sql = "INSERT INTO tbl_sgd_respuestas_log(evaluado, evaluador, id_pregunta, respuesta, perfil, subperfil, id_proceso, id_empresa, id_dimension, id_competencia, criterio, puntaje, comentario) " . "VALUES ('$evaluado', '$evaluador',  '$id_pregunta', '$nota', '$perfil', '$subperfil', '$id_proceso', '" . $_SESSION["id_empresa"] . "', '$dimension', '$componente', '" . $criterios[0] . "', '" . $criterios[1] . "', '$comentario_por_pregunta');";
    $database->setquery($sql);
    $database->query();
}
function InsertaRespuestasObj($evaluado, $evaluador, $nota, $id_objetivo, $criterios, $id_proceso, $comentario_por_objetivo)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "INSERT INTO tbl_sgd_respuestas(evaluado, evaluador, id_objetivo, respuesta, criterio, puntaje, id_proceso, id_empresa, fecha, hora, comentario) " . "VALUES ('$evaluado', '$evaluador',  '$id_objetivo', '$nota', '" . $criterios[0] . "', '" . $criterios[1] . "', '$id_proceso', '" . $_SESSION["id_empresa"] . "', '" . date("Y-m-d") . "', '" . date("H:i:s") . "', '" . $comentario_por_objetivo . "');";
    $database->setquery($sql);
    $database->query();
    $sql = "INSERT INTO tbl_sgd_respuestas_log(evaluado, evaluador, id_objetivo, respuesta, criterio, puntaje, id_proceso, id_empresa, fecha, hora) " . "VALUES ('$evaluado', '$evaluador',  '$id_objetivo', '$nota', '" . $criterios[0] . "', '" . $criterios[1] . "', '$id_proceso', '" . $_SESSION["id_empresa"] . "', '" . date("Y-m-d") . "', '" . date("H:i:s") . "');";
    $database->setquery($sql);
    $database->query();
}
function TotalIdCompetencias($sql)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "


     SELECT DISTINCT


     (id_componente),


     tbl_sgd_componente.nombre,
     tbl_sgd_componente.descripcion as descripcion_competencia,
     tbl_sgd_componente.muestra as muestra_competencia,
     tbl_sgd_preguntas.pregunta,
     tbl_sgd_preguntas.descripcion,
     tbl_sgd_preguntas.id as id_pregunta,
     tbl_sgd_preguntas.id_alternativa,
     tbl_sgd_dimensiones.muestra as muestra_dimension,
     tbl_sgd_dimensiones.nombre as nombre_dimension,
     tbl_sgd_preguntas.tiene_comentarios,
     tbl_sgd_preguntas.comentario_obligatorio


FROM


     rel_sgd_perfil_competencias


INNER JOIN tbl_sgd_componente ON tbl_sgd_componente.id = rel_sgd_perfil_competencias.id_componente


INNER JOIN tbl_sgd_preguntas ON tbl_sgd_preguntas.id_competencia = tbl_sgd_componente.id


INNER JOIN tbl_sgd_dimensiones on tbl_sgd_dimensiones.id=tbl_sgd_componente.id_dimension


WHERE


     $sql


order BY


     tbl_sgd_componente.orden ASC


     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TotalPreguntasPorSql($sql)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "


     SELECT DISTINCT


     (id_componente),


     tbl_sgd_componente.nombre, tbl_sgd_preguntas.pregunta, tbl_sgd_preguntas.id_alternativa


FROM


     rel_sgd_perfil_competencias


INNER JOIN tbl_sgd_componente ON tbl_sgd_componente.id = rel_sgd_perfil_competencias.id_componente


INNER JOIN tbl_sgd_preguntas ON tbl_sgd_preguntas.id_competencia = tbl_sgd_componente.id


WHERE


     $sql


order BY


     id_componente ASC


     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ActualizoSesion($evaluado, $evaluador, $pagina, $id_proceso)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "update tbl_sgd_sesion_evaluacion set pagina='$pagina' where evaluado='$evaluado' and evaluador='$evaluador' and id_proceso='$id_proceso';";
    $database->setquery($sql);
    $database->query();
}
function InsertoSesion($evaluado, $evaluador, $pagina, $proceso)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "INSERT INTO tbl_sgd_sesion_evaluacion(evaluado, evaluador, pagina, id_proceso, fecha, hora) " . "VALUES ('$evaluado', '$evaluador',  '$pagina', '$proceso', '" . date("Y-m-d") . "', '" . date("H:i:s") . "');";
    $database->setquery($sql);
    $database->query();
}
function TotalPerfilesDadoEvaluador1($evaluador)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sqlBK_SGD = "select distinct(tbl_usuario.perfil_evaluacion) as id_perfil_ev
     from tbl_sgd_relaciones
     inner join tbl_usuario
     on tbl_usuario.rut=tbl_sgd_relaciones.evaluado
     where tbl_sgd_relaciones.evaluador='$evaluador'
";
    $sql       = "SELECT DISTINCT
     (
     tbl_sgd_relaciones.perfil_evaluacion_competencias
     )AS id_perfil_ev
FROM
     tbl_sgd_relaciones
WHERE
     tbl_sgd_relaciones.evaluador = '$evaluador'
";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TotalPerfilesDadoEvaluador($evaluador)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select distinct(tbl_usuario.perfil_evaluacion) as id_perfil_ev,


(    select count(*) from rel_sgd_perfil_competencias where rel_sgd_perfil_competencias.perfil_evaluacion=id_perfil_ev) as cantidad_componentes


     from tbl_sgd_relaciones


     inner join tbl_usuario


     on tbl_usuario.rut=tbl_sgd_relaciones.evaluado


     where tbl_sgd_relaciones.evaluador='$evaluador'


order by cantidad_componentes DESC LIMIT 1






     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function SesionSGD($evaluado, $evaluador, $id_proceso)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_sgd_sesion_evaluacion where evaluado='$evaluado' and evaluador='$evaluador' and id_proceso='$id_proceso'






     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function SesionSGDSoloEvaluadorEvaluado($evaluador, $id_proceso, $evaluado)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_sgd_sesion_evaluacion where  evaluador='$evaluador' and id_proceso='$id_proceso' and evaluado='$evaluado'    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function SesionSGDSoloEvaluador($evaluador, $id_proceso)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_sgd_sesion_evaluacion where  evaluador='$evaluador' and id_proceso='$id_proceso' and evaluado=''
     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ActualizaNotaObj($id_objetivo, $nota)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "update tbl_objetivos_individuales set nota_ev='$nota' where id='$id_objetivo';";
    $database->setquery($sql);
    $database->query();
}
function EvaluadosDadoEvaluadorEvaluado($evaluador, $evaluado)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_sgd_relaciones where evaluador='$evaluador' and evaluado='$evaluado'






     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function EvaluadosDadoEvaluadorConDatosDeEvaluadoCruceFinalizadoIndividual($evaluador)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select tbl_sgd_relaciones.evaluado, tbl_usuario.nombre, tbl_usuario.cargo


     from tbl_sgd_relaciones


     inner join tbl_usuario


     on tbl_usuario.rut=tbl_sgd_relaciones.evaluado


     inner join tbl_objetivos_indviduales_finalizado


     on tbl_objetivos_indviduales_finalizado.evaluado=tbl_sgd_relaciones.evaluado


     where tbl_sgd_relaciones.evaluador='$evaluador'






     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function EvaluadosDadoEvaluadorConDatosDeEvaluado($evaluador)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select tbl_sgd_relaciones.evaluado, tbl_usuario.nombre, tbl_usuario.cargo


     from tbl_sgd_relaciones


     inner join tbl_usuario


     on tbl_usuario.rut=tbl_sgd_relaciones.evaluado


     where tbl_sgd_relaciones.evaluador='$evaluador'






     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function EvaluadosDadoEvaluadorConDatosDeEvaluadoSinAeParaPestanaMisValidaciones($evaluador)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "SELECT
     tbl_sgd_relaciones.evaluado,
tbl_usuario.nombre,
tbl_usuario.cargo
FROM
     tbl_sgd_relaciones
INNER JOIN tbl_usuario ON tbl_usuario.rut = tbl_sgd_relaciones.evaluado
WHERE
     tbl_sgd_relaciones.evaluado <> tbl_sgd_relaciones.evaluador
and validador = '$evaluador'


     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function EvaluadosDadoEvaluadorConDatosDeEvaluadoSinAe($evaluador)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select tbl_sgd_relaciones.evaluado, tbl_usuario.nombre, tbl_usuario.cargo


     from tbl_sgd_relaciones


     inner join tbl_usuario


     on tbl_usuario.rut=tbl_sgd_relaciones.evaluado


     where tbl_sgd_relaciones.evaluador='$evaluador' and tbl_sgd_relaciones.evaluador<>tbl_sgd_relaciones.evaluado






     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function EvaluadosDadoEvaluadorConDatosDeEvaluadoYValidador($evaluador, $validador)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select tbl_sgd_relaciones.evaluado, tbl_usuario.nombre, tbl_usuario.cargo


     from tbl_sgd_relaciones


     inner join tbl_usuario


     on tbl_usuario.rut=tbl_sgd_relaciones.evaluado


     where tbl_sgd_relaciones.evaluador='$evaluador' and tbl_sgd_relaciones.validador='$validador'






     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function EvaluadosDadoEvaluador($evaluador)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "SELECT
     tbl_sgd_relaciones.*, tbl_sgd_subperfiles.perfil AS nombre_subperfil, tbl_usuario.perfil_evaluacion
FROM
     tbl_sgd_relaciones
INNER JOIN tbl_sgd_subperfiles ON tbl_sgd_subperfiles.id = tbl_sgd_relaciones.subperfil
inner join tbl_usuario
on tbl_usuario.rut=tbl_sgd_relaciones.evaluado
WHERE
     tbl_sgd_relaciones.evaluador = '$evaluador'
order BY
     subperfil,
     tbl_sgd_relaciones.evaluado ASC




     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function VerSiEsEvaluador($rut)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_usuario where evaluador='$rut'






     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ObtenertituloCase($var)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_case_titulo where sw='$var'






     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function DatosUsuarioLeftJefeDeTblUsuario($rut)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "


     SELECT
     tbl_usuario.*,
     base_jefe.nombre as nombre_jefe,
     base_jefe.apaterno as apaterno_jefe,
     base_jefe.amaterno as amaterno_jefe


FROM
     tbl_usuario


left join tbl_usuario as base_jefe
on base_jefe.rut=tbl_usuario.jefe


WHERE
     tbl_usuario.rut = '$rut'


     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function DatosUsuarioLeftJefe($rut)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "


     SELECT tbl_usuario.*,
     basejefe.nombre_completo as nombre_evaluador, tbl_sgd_perfiles_ponderaciones.descripcion as nombre_perfil
     from tbl_usuario
     left join tbl_usuario as basejefe
     on basejefe.rut = tbl_usuario.evaluador
     left join tbl_sgd_perfiles_ponderaciones
     on tbl_usuario.perfil_evaluacion=tbl_sgd_perfiles_ponderaciones.perfil
     where tbl_usuario.rut='$rut'


     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function InsertaRegistroTomoConocimientoCompetencia($rut)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "INSERT INTO tbl_objetivos_aceptacion_competencias(rut, fecha, hora) " . "VALUES ('$rut',  '" . date("Y-m-d") . "', '" . date("H:i:s") . "');";
    $database->setquery($sql);
    $database->query();
}
function TomoConocimientoEvaluadoCompetencias($rut)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "SELECT * from tbl_objetivos_aceptacion_competencias where rut='$rut'






     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function InsertaRegistroTomoConocimiento($rut, $reunion, $comentario, $conoc)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "INSERT INTO tbl_objetivos_aceptacion(rut, reunion_jefatura, comentario_reunion_jefatura, conocimiento_objetivo, fecha, hora) " . "VALUES ('$rut', '$reunion', '$comentario', '$conoc',  '" . date("Y-m-d") . "', '" . date("H:i:s") . "');";
    $database->setquery($sql);
    $database->query();
}
function TomoConocimientoEvaluado($rut)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "SELECT * from tbl_objetivos_aceptacion where rut='$rut'






     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TraePonderacionesPorPerfil($perfil)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "SELECT * from tbl_sgd_perfiles_ponderaciones where perfil='$perfil'    ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TieneRespuestaCompetencia($evaluado, $evaluador, $id_pregunta)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "


     select * from tbl_sgd_respuestas where evaluado='$evaluado' and evaluador='$evaluador' and id_pregunta='$id_pregunta'


     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TieneRespuestaCompetenciaProProceso($evaluado, $evaluador, $id_pregunta, $id_proceso)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "


     select * from tbl_sgd_respuestas where evaluado='$evaluado' and evaluador='$evaluador' and id_pregunta='$id_pregunta' and id_proceso='$id_proceso'


     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TieneRespuestaCompetenciaObjetivo($evaluado, $evaluador, $id_objetivo)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "


     select * from tbl_sgd_respuestas where evaluado='$evaluado' and evaluador='$evaluador' and id_objetivo='$id_objetivo'


     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TieneRespuestaCompetenciaObjetivoPorProceso($evaluado, $evaluador, $id_objetivo, $id_proceso)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "


     select * from tbl_sgd_respuestas where evaluado='$evaluado' and evaluador='$evaluador' and id_objetivo='$id_objetivo' and id_proceso='$id_proceso'


     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function AlternativasDadoIdGrupo($id_grupo_alternativa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "SELECT * from tbl_sgd_alternativas


     where id_grupo_alternativa='$id_grupo_alternativa'


     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function PreguntasDadaCompetencia($id_competencia)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "






     SELECT * from tbl_sgd_preguntas


     where id_competencia='$id_competencia'


     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function CompetenciasDadoDimension($dimension)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "






     select * from tbl_sgd_componente where id_dimension='$dimension'










     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function CompetenciasDadoPerfil2($perfil)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "






     SELECT


     rel_sgd_perfil_competencias.*, tbl_sgd_componente.nombre AS nombre_componente, tbl_sgd_componente.descripcion AS descripcion_componente,


     tbl_sgd_componente.id_dimension,


     (select avg(puntaje) as nota_competncia from tbl_sgd_respuestas where tbl_sgd_respuestas.id_competencia=tbl_sgd_componente.id and evaluado='$evaluado' and evaluador='$evaluador') as nota_promedio


FROM


     rel_sgd_perfil_competencias


INNER JOIN tbl_sgd_componente ON rel_sgd_perfil_competencias.id_componente = tbl_sgd_componente.id


WHERE


     perfil_evaluacion = '$perfil' order by tbl_sgd_componente.id_dimension










     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function CompetenciasDadoPerfil($perfil, $evaluado, $evaluador)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "






     SELECT


     rel_sgd_perfil_competencias.*,
     tbl_sgd_componente.nombre AS nombre_componente,
     tbl_sgd_componente.descripcion AS descripcion_componente,
     tbl_sgd_componente.id AS id_competencia,
     tbl_sgd_componente.muestra_preguntas_informe,
     tbl_sgd_componente.id_dimension,
     tbl_sgd_componente.sigla,




     (select avg(puntaje) as nota_competncia from tbl_sgd_respuestas where tbl_sgd_respuestas.id_competencia=tbl_sgd_componente.id and evaluado='$evaluado' and evaluador='$evaluador') as nota_promedio


FROM


     rel_sgd_perfil_competencias


INNER JOIN tbl_sgd_componente ON rel_sgd_perfil_competencias.id_componente = tbl_sgd_componente.id


WHERE


     perfil_evaluacion = '$perfil'
order by tbl_sgd_componente.orden asc
     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TraeMatrizCompPregAlter($perfil)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "






     SELECT


     rel_sgd_perfil_competencias.perfil_evaluacion,


     tbl_sgd_componente.nombre as nombre_competencia,


     tbl_sgd_preguntas.pregunta as nombre_pregunta,


     tbl_sgd_alternativas.alternativa


FROM


     tbl_sgd_preguntas


INNER JOIN tbl_sgd_alternativas ON tbl_sgd_alternativas.id_grupo_alternativa = tbl_sgd_preguntas.id_alternativa


INNER JOIN tbl_sgd_componente ON tbl_sgd_componente.id = tbl_sgd_preguntas.id_competencia


INNER JOIN rel_sgd_perfil_competencias ON rel_sgd_perfil_competencias.id_componente = tbl_sgd_preguntas.id_competencia


WHERE


     rel_sgd_perfil_competencias.perfil_evaluacion = '$perfil'










     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function InsertaRegistroFinalizadoRevisionJefeObjf($evaluado, $evaluador)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "INSERT INTO tbl_objetivos_ajustes_jefe(evaluado, evaluador, fecha, hora) " . "VALUES ('$evaluado', '$evaluador',  '" . date("Y-m-d") . "', '" . date("H:i:s") . "');";
    $database->setquery($sql);
    $database->query();
}
function VerificaSiObjetivosEstanValidadosDadoEvaluador($evaluador)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "


     select * from tbl_objetivos_validaciones


     where evaluador='$evaluador'


     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function VerificaSiObjetivosEstanValidados($evaluado)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "


     select * from tbl_objetivos_validaciones


     where evaluado='$evaluado'


     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function VerificaSiObjetivosEstanAjustadosEvaluador($evaluador)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "


     select * from tbl_objetivos_ajustes_jefe


     where evaluador='$evaluador'


     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function VerificaSiObjetivosEstanAjustados($evaluado)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "


     select * from tbl_objetivos_ajustes_jefe


     where evaluado='$evaluado'


     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TraeEvaluadosDadoEvaluadorSinAe($rut)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "


     select * from tbl_sgd_relaciones where evaluador='$rut'  and evaluado<>evaluador


     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TraeEvaluadosDadoEvaluadorSinAeYValidador($evaluador, $validador)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "


     select * from tbl_sgd_relaciones where evaluador='$evaluador' and validador='$validador'  and evaluado<>evaluador


     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TraeEvaluadosDadoEvaluador($rut)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "


     select
     evaluado as rut,
     evaluador,
     perfil_evaluacion_competencias as perfil_evaluacion
     from tbl_sgd_relaciones where evaluador='$rut'


     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TraeEvaluadosDadoEvaluadorSinMiPerfil($rut)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
     SELECT
     evaluado AS rut,
     tbl_sgd_relaciones.evaluador, perfil_evaluacion
FROM
     tbl_sgd_relaciones
INNER JOIN tbl_usuario ON tbl_usuario.rut = evaluado
WHERE
     tbl_sgd_relaciones.evaluador = '$rut'
and tbl_sgd_relaciones.evaluado <> tbl_sgd_relaciones.evaluador
order by nombre_completo asc
     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TraeEvaluadosDadoEvaluadorPorProceso($rut, $id_proceso)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
     SELECT
     evaluado AS rut,
     tbl_sgd_relaciones.evaluador, perfil_evaluacion, id_proceso
FROM
     tbl_sgd_relaciones
INNER JOIN tbl_usuario ON tbl_usuario.rut = evaluado
WHERE
     tbl_sgd_relaciones.evaluador = '$rut'
     order by nombre_completo asc




     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TraeEvaluadosDadoEvaluadorPorProcesoSinAe($rut, $id_proceso)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sqlBK_SGD = "
     SELECT
     evaluado AS rut,
     tbl_sgd_relaciones.evaluador, perfil_evaluacion, id_proceso
FROM
     tbl_sgd_relaciones
INNER JOIN tbl_usuario ON tbl_usuario.rut = evaluado
WHERE
     tbl_sgd_relaciones.evaluador = '$rut' and tbl_sgd_relaciones.evaluado<>tbl_sgd_relaciones.evaluador
     order by nombre_completo asc
     ";
    $sql       = "
     SELECT
     evaluado AS rut,
     tbl_sgd_relaciones.evaluador,
     nombre_completo,
     tbl_sgd_relaciones.perfil_evaluacion_competencias as perfil_evaluacion,
     id_proceso
FROM
     tbl_sgd_relaciones
INNER JOIN tbl_usuario ON tbl_usuario.rut = evaluado
WHERE
     tbl_sgd_relaciones.evaluador = '$rut'
     and tbl_sgd_relaciones.evaluado<>tbl_sgd_relaciones.evaluador
     and (
     tbl_usuario.perfil_evaluacion='' or
     tbl_usuario.perfil_evaluacion is null or
     tbl_usuario.perfil_evaluacion='SI')




     order by nombre_completo asc




     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function VerificaFinalizadoObjetivosIndividuales($rut)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
     select * from tbl_objetivos_indviduales_finalizado
     where evaluado='$rut'
     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function InsertarobjetivoIndividualFinalizado($rut)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "INSERT INTO tbl_objetivos_indviduales_finalizado(evaluado, fecha, hora) " . "VALUES ('$rut', '" . date("Y-m-d") . "', '" . date("H:i:s") . "');";
    $database->setquery($sql);
    $database->query();
}
function SumaPonderacionesPorRut($rut)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "


     select sum(ponderacion) as suma_ponderaciones from tbl_objetivos_individuales


     where rut='$rut'


     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ActualizaObjetivosIndividuales($id_objetivo, $rut, $dimension, $objetivo, $metrica, $mes, $ano, $ponderacion)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "update tbl_objetivos_individuales set dimension='$dimension', descripcion_objetivo='$objetivo',  metrica='$metrica', mes='$mes', ano='$ano', ponderacion='$ponderacion'  where rut='$rut' and id='$id_objetivo';";
    $database->setquery($sql);
    $database->query();
}
function TraeDatosParaSemaforo($rut)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "






     select


     tbl_usuario.rut,


     tbl_objetivos_empresa_finalizado.rut as dato_empresa_finalizado,


     tbl_objetivos_area_finalizado.rut as dato_area_finalizado,


     tbl_objetivos_indviduales_finalizado.evaluado as dato_individual_finalizado,


     tbl_objetivos_ajustes_jefe.evaluado as dato_ajuste_jefatura,


     tbl_objetivos_aceptacion.fecha as dato_aceptacion_usuario,


     tbl_objetivos_aceptacion_competencias.fecha as dato_aceptacion_competencias,


     tbl_sgd_finalizados_evaluado_evaluador.fecha as dato_ev_intermedia,


     tbl_objetivos_validaciones.fecha as dato_validacion_validador






     from tbl_usuario


     left join tbl_objetivos_empresa_finalizado


     on tbl_objetivos_empresa_finalizado.rut=tbl_usuario.rut


     left join tbl_objetivos_area_finalizado


     on tbl_objetivos_area_finalizado.rut=tbl_usuario.rut


     left join tbl_objetivos_indviduales_finalizado


     on tbl_objetivos_indviduales_finalizado.evaluado=tbl_usuario.rut


     left join tbl_objetivos_ajustes_jefe


     on tbl_objetivos_ajustes_jefe.evaluado=tbl_usuario.rut


     left join tbl_objetivos_aceptacion


     on tbl_objetivos_aceptacion.rut=tbl_usuario.rut


     left join tbl_objetivos_aceptacion_competencias


     on tbl_objetivos_aceptacion_competencias.rut=tbl_usuario.rut


     left join tbl_sgd_finalizados_evaluado_evaluador


     on tbl_sgd_finalizados_evaluado_evaluador.evaluado=.tbl_usuario.rut






     left join tbl_objetivos_validaciones


     on tbl_objetivos_validaciones.evaluado=tbl_usuario.rut










     where tbl_usuario.rut='$rut'










     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function InsertaObjetivoIndividual($rut, $dimension, $objetivo, $metrica, $mes, $ano, $ponderacion)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "INSERT INTO tbl_objetivos_individuales(rut, dimension, descripcion_objetivo, metrica, mes, ano, fecha, hora, ponderacion, id_empresa) " . "VALUES ('$rut', '$dimension', '$objetivo', '$metrica', '$mes', '$ano', '" . date("Y-m-d") . "', '" . date("H:i:s") . "', '$ponderacion', '" . $_SESSION["id_empresa"] . "');";
    $database->setquery($sql);
    $database->query();
}
function TraeObjetivosIndividualesDadoIdObjetivo($id)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "


     select tbl_objetivos_individuales.*, tbl_objetivos_dimension.nombre as nombre_dimension






     from tbl_objetivos_individuales


     inner join tbl_objetivos_dimension


     on tbl_objetivos_dimension.id=tbl_objetivos_individuales.dimension






     where tbl_objetivos_individuales.id='$id'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TraeObjetivosIndividualesDadoRut($rut)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "


     select tbl_objetivos_individuales.*, tbl_objetivos_dimension.nombre as nombre_dimension






     from tbl_objetivos_individuales


     inner join tbl_objetivos_dimension


     on tbl_objetivos_dimension.id=tbl_objetivos_individuales.dimension






     where rut='$rut' order by tbl_objetivos_individuales.id desc";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function SelectDistValorPorEmpresa($campo, $tabla, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select distinct($campo) as dato from $tabla where id_empresa='$id_empresa' and $campo<>''";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function SelectDistValor($campo, $tabla)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select distinct($campo) as dato from $tabla";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ValorSelectDistinctDinaico2PorEmpresa($tabla, $campo_mostrar, $campo_valor, $order, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select $campo_valor as id, $campo_mostrar as nombre from $tabla  where id_empresa='$id_empresa' $order";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ValorSelectDinaico2PorEmpresa($tabla, $campo_mostrar, $campo_valor, $order, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select $campo_valor as id, $campo_mostrar as nombre from $tabla


     where id_empresa='$id_empresa' $order";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ValorSelectDinaico2($tabla, $campo_mostrar, $campo_valor, $order)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select $campo_valor as id, $campo_mostrar as nombre from $tabla $order";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ValorSelectDinaico($tabla)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from $tabla";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ValorSelectDinaicoPorEmpresa($tabla, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from $tabla where id_empresa='$id_empresa'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function InsertaRevisionObjetivoArea($rut, $id_empresa, $id_area)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "INSERT INTO tbl_objetivos_area_finalizado(rut, id_empresa, id_area) " . "VALUES ('$rut', '$id_empresa', '$id_area');";
    $database->setquery($sql);
    $database->query();
}
function VerificaFinalizadoObjetivosArea($rut, $id_area)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_objetivos_area_finalizado where rut='" . $rut . "'  and id_area=" . $id_area . "";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function DatosObjetivosAreaConNota($id_area, $id_empresa, $id_proceso)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "


     SELECT


     tbl_objetivos_area.*, (select nota from tbl_sgd_notas_area where tbl_sgd_notas_area.id_objetivo=tbl_objetivos_area.id and tbl_sgd_notas_area.id_proceso='$id_proceso' ORDER BY tbl_sgd_notas_area.fecha DESC limit 1) as nota


FROM


     tbl_objetivos_area


WHERE


     tbl_objetivos_area.id_area = '$id_area'


and tbl_objetivos_area.id_empresa = '$id_empresa'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function DatosObjetivosArea($id_area, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "


     select tbl_objetivos_area.*


     from tbl_objetivos_area










     where     tbl_objetivos_area.id_area='" . $id_area . "'


     and     tbl_objetivos_area.id_empresa='" . $id_empresa . "'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function InsertaRevisionObjetivoEmpresa($rut, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "INSERT INTO tbl_objetivos_empresa_finalizado(rut, id_empresa) " . "VALUES ('$rut', '$id_empresa');";
    $database->setquery($sql);
    $database->query();
}
function VerificaObjetivoEmpresa($rut, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_objetivos_empresa_finalizado where rut='" . $rut . "'  and id_empresa=" . $id_empresa . "";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ObjetivosDeEmpresaConNota($id_empresa, $id_proceso)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "SELECT


     tbl_objetivos_empresa.*,


     (select nota from tbl_sgd_notas_empresa where tbl_objetivos_empresa.id=tbl_sgd_notas_empresa.id_objetivo and tbl_sgd_notas_empresa.id_proceso='$id_proceso' order by tbl_sgd_notas_empresa.fecha DESC limit 1) as nota


FROM


     tbl_objetivos_empresa






WHERE


     tbl_objetivos_empresa.id_empresa = '$id_empresa'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ObjetivosDeEmpresa($id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_objetivos_empresa where id_empresa='" . $id_empresa . "'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TraeUsuariosDadoCriterio($campo, $valor, $arreglo_post)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "


     select * from tbl_usuario


     where " . $campo . "='$valor' $filtro






";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ObtenerCargosDadoIdCurso($id_curso)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "


     SELECT










r    el_malla.campo,


r    el_malla.valor as cargo






FROM


     tbl_lms_curso


INNER JOIN rel_nivel_curso ON rel_nivel_curso.id_curso = tbl_lms_curso.id


inner join tbl_nivel on tbl_nivel.id=rel_nivel_curso.id_nivel


inner join tbl_programa on tbl_programa.id=tbl_nivel.id_programa


inner join rel_malla_programa on rel_malla_programa.id_programa=tbl_programa.id


inner join rel_malla on rel_malla.id_malla=rel_malla_programa.id_malla


WHERE


     tbl_lms_curso.id = '$id_curso'






group BY campo, cargo


";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ObtengoIdMalla($id_empresa, $id_cargo)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from rel_malla where id_empresa='" . $id_empresa . "' and valor='" . $id_cargo . "'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TraeSliders($id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_slider where id_empresa='$id_empresa'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function VeProgramaFinalizadoPorMalla($id_malla, $rut)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_programas_finalizados where id_malla='$id_malla' and rut='$rut'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function InsertaProgramaFinalizado($id_programa, $rut, $id_malla)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "INSERT INTO tbl_programas_finalizados(id_programa, rut, fecha, hora, id_malla) " . "VALUES ('$id_programa', '$rut', '" . date("Y-m-d") . "', '" . date("H:i:s") . "', '$id_malla');";
    $database->setquery($sql);
    $database->query();
}
function VeProgramaFinalizado($id_programa, $rut)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_programas_finalizados where id_programa='$id_programa' and rut='$rut'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function totalNavegacionDadoProgramaRut($id_programa, $rut)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select SEC_TO_TIME( SUM( TIME_TO_SEC( tiempo_navegacion ) ) ) as total_tiempo  from tbl_logs_navegacion






inner join tbl_lms_curso


on tbl_lms_curso.id=tbl_logs_navegacion.id_curso


inner join rel_nivel_curso


on rel_nivel_curso.id_curso=tbl_lms_curso.id


inner join tbl_nivel


on tbl_nivel.id=rel_nivel_curso.id_nivel


where tbl_nivel.id_programa='$id_programa' and tbl_logs_navegacion.rut='$rut'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function CantidadCursosPorPrograma($id_programa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "


     select tbl_lms_curso.*


     from rel_nivel_curso


     inner join tbl_nivel


     on tbl_nivel.id=rel_nivel_curso.id_nivel


     inner JOIN tbl_lms_curso


     on tbl_lms_curso.id=rel_nivel_curso.id_curso


     where tbl_nivel.id_programa='$id_programa'


     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function DuracionCursosPorPrograma($id_programa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "


     select


     SEC_TO_TIME( SUM( TIME_TO_SEC((


     SELECT


     SEC_TO_TIME(


     SUM(


     TIME_TO_SEC(duracion_video)


     )


     ) AS total_tiempo


     FROM


     tbl_objeto


     WHERE


     tbl_objeto.id_curso = tbl_lms_curso.id


     )


)


)


)    AS total_suma_tiempos_objetos


     from rel_nivel_curso


     inner join tbl_nivel


     on tbl_nivel.id=rel_nivel_curso.id_nivel


     inner JOIN tbl_lms_curso


     on tbl_lms_curso.id=rel_nivel_curso.id_curso


     where tbl_nivel.id_programa='$id_programa'






     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function CantidadCursosPorProgramaFinalizadosPorUsuario($id_programa, $rut)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "


     select tbl_lms_curso.*


     from rel_nivel_curso






     inner join tbl_nivel


     on tbl_nivel.id=rel_nivel_curso.id_nivel


     inner JOIN tbl_lms_curso


     on tbl_lms_curso.id=rel_nivel_curso.id_curso






     inner join tbl_lms_curso_finalizados


     on tbl_lms_curso_finalizados.id_curso=tbl_lms_curso.id and tbl_lms_curso_finalizados.rut='$rut'






     where tbl_nivel.id_programa='$id_programa'






     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function InsertaNivelFinalizado($id_nivel, $rut, $id_programa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "INSERT INTO tbl_nivel_finalizado(rut, id_nivel, id_programa, fecha, hora) " . "VALUES ('$rut', '$id_nivel', '$id_programa',  '" . date("Y-m-d") . "', '" . date("H:i:s") . "');";
    $database->setquery($sql);
    $database->query();
}
function VerificaNivelFinalizadoDadoNivelPrograma($id_programa, $id_nivel, $rut)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "


     select * from tbl_nivel_finalizado where rut='$rut' and id_nivel='$id_nivel' and id_programa='$id_programa'


     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function PromedioDeEvaluacionesDadoCursoYRut($id_curso, $rut)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select ROUND(avg(nota),1) as promedio_nota_curso from tbl_objetos_finalizados






inner join tbl_objeto


on tbl_objeto.id=tbl_objetos_finalizados.id_objeto


where tbl_objetos_finalizados.rut='$rut'


AND tbl_objeto.id_curso='$id_curso' and nota>='0'


     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function PreguntasDadoIdObjetoaleatorio($id_objeto, $rut)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "SELECT


     tbl_evaluaciones_preguntas.*


FROM


     tbl_evaluaciones_asociacion_preguntas_usuario


inner join tbl_evaluaciones_preguntas


on tbl_evaluaciones_preguntas.id=tbl_evaluaciones_asociacion_preguntas_usuario.id_pregunta






INNER JOIN tbl_objeto
on tbl_evaluaciones_preguntas.evaluacion = tbl_objeto.id_evaluacion
AND tbl_objeto.id_empresa='" . $_SESSION["id_empresa"] . "'
AND tbl_objeto.id='$id_objeto'


WHERE


     tbl_evaluaciones_asociacion_preguntas_usuario.id_objeto ='$id_objeto' and tbl_evaluaciones_asociacion_preguntas_usuario.rut ='$rut'






     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function PreguntaDeEvaluacionAleatorias($id_evaluacion, $numero, $rut, $id_objeto)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "


     select tbl_evaluaciones_preguntas.*, tbl_evaluaciones_tipo_preguntas.tipo as tipo_pregunta,


     tbl_evaluaciones_tipo_preguntas.template as template_pregunta


     from


     tbl_evaluaciones_asociacion_preguntas_usuario






     inner join tbl_evaluaciones_preguntas


     on tbl_evaluaciones_preguntas.id=tbl_evaluaciones_asociacion_preguntas_usuario.id_pregunta






     INNER JOIN tbl_evaluaciones_tipo_preguntas


     ON tbl_evaluaciones_tipo_preguntas.id = tbl_evaluaciones_preguntas.tipo






     where tbl_evaluaciones_asociacion_preguntas_usuario.id_evaluacion='$id_evaluacion' and


tbl_evaluaciones_asociacion_preguntas_usuario.id_objeto='$id_objeto'


     and tbl_evaluaciones_asociacion_preguntas_usuario.orden='$numero' and tbl_evaluaciones_asociacion_preguntas_usuario.rut='$rut'






     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function InsertoRegistroPreguntasAleatorias($rut, $id_evaluacion, $id_objeto, $orden, $id_pregunta, $id_curso)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "INSERT INTO tbl_evaluaciones_asociacion_preguntas_usuario(rut, id_evaluacion, id_objeto, id_curso, id_pregunta, orden) " . "VALUES ('$rut', '$id_evaluacion', '$id_objeto', '$id_curso', '$id_pregunta', '$orden');";
    $database->setquery($sql);
    $database->query();
}
function VerificaSiTienePReguntasAsociadasRandomicas($rut, $id_evaluacion, $id_objeto)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_evaluaciones_asociacion_preguntas_usuario


     where rut='$rut' and id_evaluacion='$id_evaluacion' and id_objeto='$id_objeto' ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function DatosMalla($id)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_lms_malla where id='$id'


     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function DatosObjetoDadoRutCursoyOrden($id_curso, $orden)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "


     select * from tbl_objeto


     where id_curso='$id_curso' and orden='$orden'


     ";
     //echo $sql;
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function DatosObjetoDadoIdCurso($id_curso)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "


     select * from tbl_objeto


     where id_curso='$id_curso'


     ";
     //echo $sql;
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function SumaNavegacionesDadoRutYNivel($rut, $id_nivel)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select SEC_TO_TIME( SUM( TIME_TO_SEC( tiempo_navegacion ) ) ) as total_tiempo  from tbl_logs_navegacion






inner join rel_nivel_curso


on rel_nivel_curso.id_curso=tbl_logs_navegacion.id_curso


where rut='$rut' and rel_nivel_curso.id_nivel='$id_nivel'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function SumaNavegacionesDadoRutYObjeto($rut, $id_objeto, $id_curso)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select SEC_TO_TIME( SUM( TIME_TO_SEC( tiempo_navegacion ) ) ) as total_tiempo
     from tbl_logs_navegacion where rut='$rut'
     and id_curso='$id_curso' and id_objeto='$id_objeto'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function SumaNavegacionesDadoRutYCurso($rut, $id_curso)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select SEC_TO_TIME( SUM( TIME_TO_SEC( tiempo_navegacion ) ) ) as total_tiempo
     from tbl_logs_navegacion where rut='$rut'
     and id_curso='$id_curso'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function SumaNavegacionesDadoRut($rut)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select SEC_TO_TIME( SUM( TIME_TO_SEC( tiempo_navegacion ) ) ) as total_tiempo  from tbl_logs_navegacion where rut='$rut'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ObjetoFinalizadoDadoIdYRut($rut, $id)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_objetos_finalizados where rut='$rut' and id_objeto='$id'";
    //    echo "<br>ObjetoFinalizadoDadoIdYRut<br>".$sql;
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function SumaDeNotasObjetosFinalizadosYNivel($rut, $id_nivel)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "


     select avg(tbl_objetos_finalizados.nota) as promedio_notas_finales


     from tbl_objetos_finalizados






     inner join rel_nivel_curso


     on rel_nivel_curso.id_curso=tbl_objetos_finalizados.id_curso






     where rut='$rut' and nota<>'' and rel_nivel_curso.id_nivel='$id_nivel'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function SumaDeNotasObjetosFinalizados($rut)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select avg(nota) as promedio_notas_finales from tbl_objetos_finalizados where rut='$rut' and nota<>''";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ComportamientoDadoDimension($id_dimension)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_dnc_comportamientos where id_dimension='$id_dimension' ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TotalDimensionesDeCumplimientoDnc()
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_dnc_dimensiones ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function InsertoRegistroFinalzadoEvalConductas($evaluado, $evaluador)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "INSERT INTO tbl_evaluaciones_conducta_finalizado(evaluado, evaluador, fecha, hora) " . "VALUES ('$evaluado', '$evaluador', '" . date("Y-m-d") . "', '" . date("H:i:s") . "');";
    $database->setquery($sql);
    $database->query();
}
function TraeDebilidadAlternativaEvConducta()
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_evaluaciones_niveles_debilidad ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TraeNivelesAlternativaEvConducta()
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_evaluaciones_niveles_alternativas ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ActualizaNotaEConducta($evaluado, $evaluador, $nota, $id_objetivo, $numero_conducta, $debilidad)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "update tbl_evaluaciones_conducta_respuestas set nota_c" . $numero_conducta . "='$nota',  debilidad_c" . $numero_conducta . "='$debilidad' where evaluado='$evaluado' and evaluador='$evaluador' and id_objetivo='$id_objetivo';";
    $database->setquery($sql);
    $database->query();
}
function InsertoNotaEvConducta($evaluado, $evaluador, $nota, $id_objetivo, $numero_conducta, $debilidad)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "INSERT INTO tbl_evaluaciones_conducta_respuestas(evaluado, evaluador, id_objetivo, nota_c" . $numero_conducta . ", debilidad_c" . $numero_conducta . ") " . "VALUES ('$evaluado', '$evaluador', '$id_objetivo', '$nota', '$debilidad');";
    $database->setquery($sql);
    $database->query();
}
function TieneRegistroRespuestaEvConduccta($evaluado, $evaluador, $id_objetivo)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_evaluaciones_conducta_respuestas where evaluado='$evaluado' and evaluador='$evaluador' and id_objetivo='$id_objetivo' ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function EvaluacionFinConducta($evaluado, $evaluador)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_evaluaciones_conducta_finalizado where evaluado='$evaluado' and evaluador='$evaluador' ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function InsertarClaveNueva($rut, $clave)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "INSERT INTO tbl_clave(rut, clave, cambiado, fecha) " . "VALUES ('$rut', '$clave', '1', '" . date("Y-m-d") . "');";
    $database->setquery($sql);
    $database->query();
}
function InsertarClaveDefecto($rut)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "INSERT INTO tbl_clave(rut, clave, cambiado, fecha) " . "VALUES ('$rut', '123456', '0', '" . date("Y-m-d") . "');";
    $database->setquery($sql);
    $database->query();
}
function InsertarUsuarioNuevoCargoTblUsuario2($rut, $nombre, $apateno, $amaterno, $cargo, $id_empresa, $jefe, $gerencia, $email)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "INSERT INTO tbl_usuario(rut, nombre, nombre_completo, apaterno, amaterno, cargo, id_empresa, jefe, gerencia, email) " . "VALUES ('$rut', '$nombre', '$nombre', '$apateno', '$amaterno', '$cargo', '$id_empresa', '$jefe', '$gerencia', '$email');";
    $database->setquery($sql);
    $database->query();
}
function InsertarUsuarioNuevoCargoTblUsuario3($rut, $nombre, $apateno, $amaterno, $nombre_completo, $cargo, $id_empresa, $jefe, $gerencia, $email, $imagen)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    if ($imagen == 'undefined') {
        $sql = "INSERT INTO tbl_usuario(rut, nombre, nombre_completo, apaterno, amaterno, cargo, id_empresa, jefe, gerencia, email) " . "VALUES ('$rut', '$nombre', '$nombre_completo', '$apateno', '$amaterno', '$cargo', '$id_empresa', '$jefe', '$gerencia', '$email');";
    } else {
        $sql = "INSERT INTO tbl_usuario(rut, nombre, nombre_completo, apaterno, amaterno, cargo, id_empresa, jefe, gerencia, email, avatar) " . "VALUES ('$rut', '$nombre', '$nombre_completo', '$apateno', '$amaterno', '$cargo', '$id_empresa', '$jefe', '$gerencia', '$email', '$imagen');";
    }
    $database->setquery($sql);
    $database->query();
}
function UpdateUsuarioNuevoCargoBci($rut, $id_empresa, $imagenUrl)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    if ($imagenUrl == 'undefined') {
    } else {
        $sql = "UPDATE tbl_usuario set avatar='$imagenUrl' where rut='$rut' and id_empresa='$id_empresa';";
    }
    $database->setquery($sql);
    $database->query();
}
function InsertarUsuarioNuevoCargoTblUsuario($cargo, $jefe)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $rut_aleatorio = $prefijo = substr(md5(uniqid(rand())), 0, 6);
    $sql           = "INSERT INTO tbl_usuario(rut, nombre, apaterno, amaterno, cargo, id_empresa, jefe) " . "VALUES ('$rut_aleatorio', '$cargo', '$cargo', '$cargo', '$cargo', '4', '$jefe');";
    $database->setquery($sql);
    $database->query();
}
function InsertaLogSistema($rut, $ambiente, $id_empresa, $id_detalle, $subcategoria, $id_archivo, $nivel, $id_menu_nivel)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    if($ambiente=="sdriesgo_TEsT_"){
        $sql = "INSERT INTO tbl_log_sistema(rut, ambiente, fecha, hora, ip, id_empresa, id_detalle, subcategoria, id_archivo, menu_nivel, id_menu_nivel, variables_post, variables_get) " . "VALUES ('$rut','$ambiente', '" . date("Y-m-d") . "', '" . date("H:i:s") . "', '" . $_SERVER['REMOTE_ADDR'] . "', '$id_empresa', '$id_detalle', '$subcategoria', '$id_archivo', '$nivel', '$id_menu_nivel', '" . ($_POST["value"]) . "', '" . json_encode($_GET) . "');";
        $database->setquery($sql);
        $database->query();

        $sql = "INSERT INTO tbl_json_ext(rut, fecha, hora, json_completo) " . "VALUES ('$rut', '" . date("Y-m-d") . "', '" . date("H:i:s") . "', '" . ($_POST["value"]) . "');";
        $database->setquery($sql);
        $database->query();


    }else if($ambiente=="sdriesgo"){
        $sql = "INSERT INTO tbl_log_sistema(rut, ambiente, fecha, hora, ip, id_empresa, id_detalle, subcategoria, id_archivo, menu_nivel, id_menu_nivel, variables_post, variables_get) " . "VALUES ('$rut','$ambiente', '" . date("Y-m-d") . "', '" . date("H:i:s") . "', '" . $_SERVER['REMOTE_ADDR'] . "', '$id_empresa', '$id_detalle', '$subcategoria', '$id_archivo', '$nivel', '$id_menu_nivel', '" . ($_POST["value"]) . "', '" . json_encode($_GET) . "');";
        $database->setquery($sql);
        $database->query();
        $sql = "INSERT INTO tbl_json_ext(rut, fecha, hora, json_completo) " . "VALUES ('$rut', '" . date("Y-m-d") . "', '" . date("H:i:s") . "', '" . ($_POST["value"]) . "');";
        $database->setquery($sql);
        $database->query();

    }else{
        $sql = "INSERT INTO tbl_log_sistema(rut, ambiente, fecha, hora, ip, id_empresa, id_detalle, subcategoria, id_archivo, menu_nivel, id_menu_nivel, variables_post, variables_get) " . "VALUES ('$rut','$ambiente', '" . date("Y-m-d") . "', '" . date("H:i:s") . "', '" . $_SERVER['REMOTE_ADDR'] . "', '$id_empresa', '$id_detalle', '$subcategoria', '$id_archivo', '$nivel', '$id_menu_nivel', '" . json_encode($_POST) . "', '" . json_encode($_GET) . "');";
        $database->setquery($sql);
        $database->query();
    }
}
function InsertaComentarioFormulario($nombre, $email, $comentario)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "INSERT INTO tbl_formulario_contacto(nombre, email, comentario, fecha, hora) " . "VALUES ('$nombre','$email', '$comentario', '" . date("Y-m-d") . "', '" . date("H:i:s") . "');";
    $database->setquery($sql);
    $database->query();
}
function EliminarObjetivo($id)
{
    global $c_host, $c_user, $c_pass, $c_db;
    if (!isset($pagina)) {
        $pagina = 1;
    }
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = sprintf("DELETE from tbl_dnc_objetivos WHERE id='" . $id . "'");
    $database->setquery($sql);
    $database->query();
}
function ActualizarObjetivoDNC($objetivo, $conducta1, $conducta2, $conducta3, $id_objetivo)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "update tbl_dnc_objetivos set objetivo='$objetivo', conducta1='$conducta1', conducta2='$conducta2', conducta3='$conducta3' where id='$id_objetivo';";
    $database->setquery($sql);
    $database->query();
    $sql = "update tbl_dnc_objetivos_log_jefatura set objetivo='$objetivo', conducta1='$conducta1', conducta2='$conducta2', conducta3='$conducta3' where id='$id_objetivo';";
    $database->setquery($sql);
    $database->query();
}
function ListadoCargosFinalizadosPorJefe($rut)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "






     select * from tbl_dnc_objetivos_finalizado where jefe='$rut'






     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function InsertaFinalizadoObjetivoDnc($cargo, $jefe)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "INSERT INTO tbl_dnc_objetivos_finalizado(jefe, cargo, fecha, hora) " . "VALUES ('$jefe', '$cargo', '" . date("Y-m-d") . "', '" . date("H:i:s") . "');";
    $database->setquery($sql);
    $database->query();
}
function DatosObjetivoDncDadoId($id)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_dnc_objetivos where id='$id' ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function DatosObjetivoDncDadoJefe($jefe)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_dnc_objetivos where jefe='$jefe' ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ListadoObjetivosDncDadoCargo($cargo)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_dnc_objetivos where cargo='$cargo'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ListadoObjetivosDnc2($jefe, $cargo)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_dnc_objetivos where jefe='$jefe' and cargo='$cargo'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function InsertarObjetivoDnc($objetivo, $conducta1, $conducta2, $conducta3, $cargo, $jefe)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "INSERT INTO tbl_dnc_objetivos(jefe, cargo, objetivo, conducta1, conducta2, conducta3, fecha, hora) " . "VALUES ('$jefe', '$cargo' , '$objetivo', '$conducta1', '$conducta2', '$conducta3', '" . date("Y-m-d") . "', '" . date("H:i:s") . "');";
    $database->setquery($sql);
    $database->query();
    $sql = "INSERT INTO tbl_dnc_objetivos_log_jefatura(jefe, cargo, objetivo, conducta1, conducta2, conducta3, fecha, hora) " . "VALUES ('$jefe', '$cargo', '$objetivo', '$conducta1', '$conducta2', '$conducta3', '" . date("Y-m-d") . "', '" . date("H:i:s") . "');";
    $database->setquery($sql);
    $database->query();
}
function VerificaDNCFinalizado($jefe, $cargo)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_dnc_objetivos_finalizado where jefe='$jefe' and cargo='$cargo'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ActualizaCargoDadoJefe($nuevo_cargo, $rutjefe, $cargo_antiguo)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "update tbl_usuario set cargo='$nuevo_cargo' where jefe='$rutjefe' and cargo='$cargo_antiguo';";
    $database->setquery($sql);
    $database->query();
}
function PruebaActualiza($valor)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "update ingreso_db set valor='$valor';










     ";
    $database->setquery($sql);
    $database->query();
}
function ListadoCargosDistinct($rut)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "






     select distinct(cargo), count(*) as numero_colaboradores from tbl_usuario where jefe='$rut'


group BY cargo






     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function InsertarLike($voto, $user, $id_noticia)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $fecha = date('Y-m-d H:i:s');
    $sql   = "INSERT INTO $voto (id_noticia, user, fecha) " . "VALUES ('$id_noticia', '$user', '$fecha');";
    $database->setquery($sql);
    $database->query();
}
function ExisteVoto($voto, $user, $id_noticia)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from $voto WHERE user = '$user' and id_noticia= '$id_noticia'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TraerVotos($voto, $id_noticia)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from $voto WHERE  id_noticia= '$id_noticia'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function NoticiaPorId($id)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_noticias where id='" . $id . "'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function NoticiaPorIdConVistas($id, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select
     tbl_noticias.*,
     (select count(*) as total from tbl_noticias_log where tbl_noticias_log.id_empresa='$id_empresa'
     and tbl_noticias_log.id_noticia='$id') as total_visitas,
     tbl_noticias_categorias.categoria as nombre_categoria,
     tbl_empresa.ve_comentarios


     from
     tbl_noticias


     inner join tbl_noticias_categorias
     on tbl_noticias_categorias.id = tbl_noticias.categoria


     inner join tbl_empresa
     on tbl_empresa.id=tbl_noticias.id_empresa


     where tbl_noticias.id='" . $id . "'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function NoticiaPorIdConVistasPorCategoria($id_categoria, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "


select
     tbl_noticias.*, (
     SELECT
     count(*) AS total
     FROM
     tbl_noticias_log
     WHERE
     tbl_noticias_log.id_empresa = '$id_empresa'
     AND tbl_noticias_log.id_noticia = tbl_noticias.id
     ) AS total_visitas,
     tbl_noticias_categorias.categoria AS nombre_categoria
FROM
     tbl_noticias
INNER JOIN tbl_noticias_categorias ON tbl_noticias_categorias.id = tbl_noticias.categoria
WHERE
     tbl_noticias.categoria = '$id_categoria' and tbl_noticias.id_empresa='$id_empresa'
limit 3


     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TraeNoticias($id_empresa, $pagina, $cantidad_por_pagina)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    if (!$pagina) {
        $limit = " limit 0, $cantidad_por_pagina";
    } else {
        $inicio = ($pagina - 1) * $cantidad_por_pagina;
        $limit  = " limit $inicio, $cantidad_por_pagina";
    }
    if ($id_empresa == 22) {
        $datos_usuario_session = UsuarioEnBasePersonas($_SESSION["user_"], $rutcontodo);
        if ($datos_usuario_session[0]->unidad_negocio == "Sucursales") {
            $filtro_mundo = "and (tbl_noticias.id_mundo='0' or tbl_noticias.id_mundo='2')";
        } else if ($datos_usuario_session[0]->unidad_negocio == "Santiago") {
            $filtro_mundo = "and (tbl_noticias.id_mundo='0' or tbl_noticias.id_mundo='1')";
        }
    }
    $sql = "select tbl_noticias.*, tbl_noticias_categorias.categoria as nombre_categoria
     from tbl_noticias


     inner join tbl_noticias_categorias
     on tbl_noticias_categorias.id=tbl_noticias.categoria
     WHERE
     tbl_noticias.estado = '1' and
     tbl_noticias.id_empresa ='$id_empresa'


     $filtro_mundo








     order by orden is  null, orden asc, fecha_creacion desc $limit";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TraeNoticiasBKBKBK($id_empresa, $pagina, $cantidad_por_pagina)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    if (!$pagina) {
        $limit = " limit 0, $cantidad_por_pagina";
    } else {
        $inicio = ($pagina - 1) * $cantidad_por_pagina;
        $limit  = " limit $inicio, $cantidad_por_pagina";
    }
    $sql = "select tbl_noticias.*, tbl_noticias_categorias.categoria as nombre_categoria
     from tbl_noticias


     inner join tbl_noticias_categorias
     on tbl_noticias_categorias.id=tbl_noticias.categoria
     WHERE tbl_noticias.estado = '1' and tbl_noticias.id_empresa ='$id_empresa'
     order by tbl_noticias.fecha_creacion
     desc , tbl_noticias.id desc limit 0, $cantidad_por_pagina";
    $sql = "select tbl_noticias.*, tbl_noticias_categorias.categoria as nombre_categoria
     from tbl_noticias


     inner join tbl_noticias_categorias
     on tbl_noticias_categorias.id=tbl_noticias.categoria
     WHERE tbl_noticias.estado = '1' and tbl_noticias.id_empresa ='$id_empresa'
     order by tbl_noticias.fecha_creacion
     desc , tbl_noticias.id desc $limit";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TraeNoticiasTodas($id_empresa, $id_categoria)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    if ($id_categoria) {
        $filtro_Categoria = " and tbl_noticias.categoria='$id_categoria'";
    }
    $sql = "select tbl_noticias.*, tbl_noticias_categorias.categoria as nombre_categoria
     from tbl_noticias
     inner join tbl_noticias_categorias
     on tbl_noticias_categorias.id=tbl_noticias.categoria
     WHERE tbl_noticias.estado = '1' and tbl_noticias.id_empresa ='$id_empresa' $filtro_Categoria
     order by tbl_noticias.fecha_creacion
     desc , tbl_noticias.id desc";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TraeNoticiasTodasBKBK($id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select tbl_noticias.*, tbl_noticias_categorias.categoria as nombre_categoria
     from tbl_noticias
     inner join tbl_noticias_categorias
     on tbl_noticias_categorias.id=tbl_noticias.categoria
     WHERE tbl_noticias.estado = '1' and tbl_noticias.id_empresa ='$id_empresa'
     order by tbl_noticias.fecha_creacion
     desc , tbl_noticias.id desc";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TraeNoticiasPorCategoriaTodas($id_empresa, $id_categoria, $pagina, $cantidad_por_pagina)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    if (!$pagina) {
        $limit = " limit 0, $cantidad_por_pagina";
    } else {
        $inicio = ($pagina - 1) * $cantidad_por_pagina;
        $limit  = " limit $inicio, $cantidad_por_pagina";
    }
    if ($id_empresa == 22) {
        $datos_usuario_session = UsuarioEnBasePersonas($_SESSION["user_"], $rutcontodo);
        if ($datos_usuario_session[0]->unidad_negocio == "Sucursales") {
            $filtro_mundo = "and (tbl_noticias.id_mundo='0' or tbl_noticias.id_mundo='2')";
        } else if ($datos_usuario_session[0]->unidad_negocio == "Santiago") {
            $filtro_mundo = "and (tbl_noticias.id_mundo='0' or tbl_noticias.id_mundo='1')";
        }
    }
    $sql = "select tbl_noticias.*, tbl_noticias_categorias.categoria as nombre_categoria
     from tbl_noticias
     inner join tbl_noticias_categorias
     on tbl_noticias_categorias.id=tbl_noticias.categoria
     WHERE tbl_noticias.estado = '1'
     and tbl_noticias.id_empresa ='$id_empresa'
     and tbl_noticias.categoria='$id_categoria'


     $filtro_mundo


     order by orden is  null, orden asc, fecha_creacion desc $limit";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TraeNoticiasPorCategoriaTodasBK($id_empresa, $id_categoria)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select tbl_noticias.*, tbl_noticias_categorias.categoria as nombre_categoria
     from tbl_noticias
     inner join tbl_noticias_categorias
     on tbl_noticias_categorias.id=tbl_noticias.categoria
     WHERE tbl_noticias.estado = '1' and tbl_noticias.id_empresa ='$id_empresa' and tbl_noticias.categoria='$id_categoria' order by tbl_noticias.fecha_Creacion desc";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TraeNoticiasPorCategoria($id_empresa, $id_categoria)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select tbl_noticias.*, tbl_noticias_categorias.categoria as nombre_categoria
     from tbl_noticias
     inner join tbl_noticias_categorias
     on tbl_noticias_categorias.id=tbl_noticias.categoria
     WHERE tbl_noticias.estado = '1' and tbl_noticias.id_empresa ='$id_empresa' and tbl_noticias.categoria='$id_categoria' order by tbl_noticias.fecha_Creacion desc limit 0, 6";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TraeNoticiasPrincipales($id_empresa, $variable, $limit)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    if ($id_empresa == 22) {
        $datos_usuario_session = UsuarioEnBasePersonas($_SESSION["user_"], $rutcontodo);
        if ($datos_usuario_session[0]->unidad_negocio == "Sucursales") {
            $filtro_mundo = "and (tbl_noticias.id_mundo='0' or tbl_noticias.id_mundo='2')";
        } else if ($datos_usuario_session[0]->unidad_negocio == "Santiago") {
            $filtro_mundo = "and (tbl_noticias.id_mundo='0' or tbl_noticias.id_mundo='1')";
        }
    }
    if ($limit) {
        $limit = " LIMIT 0, $limit";
    } else {
        $limit = " ";
    }
    $sql = "
     SELECT
     tbl_noticias.*, tbl_noticias_categorias.categoria as nombre_categoria, tbl_noticias_principales.prioridad, tbl_noticias_principales.id as id_noticia_principal
FROM
     tbl_noticias
inner JOIN tbl_noticias_principales
on tbl_noticias_principales.idnoticia=tbl_noticias.id
inner join tbl_noticias_categorias
on tbl_noticias_categorias.id=tbl_noticias.categoria
WHERE
     estado = '1' and
     tbl_noticias.id_empresa='$id_empresa' and
     tbl_noticias_principales.idempresa is not NULL
     and slider_activo=0
     and tbl_noticias.id_mundo='0' $filtro_mundo
order BY
     prioridad asc
$limit
     ";
    $sql = "
     SELECT
     tbl_noticias.*, tbl_noticias_categorias.categoria AS nombre_categoria
FROM
     tbl_noticias
INNER JOIN tbl_noticias_categorias ON tbl_noticias_categorias.id = tbl_noticias.categoria
WHERE
     estado = '1'AND
     tbl_noticias.id_empresa = '$id_empresa' AND
     tbl_noticias.principal >0
     $filtro_mundo






     order by orden is  null, orden asc, fecha_creacion desc
     $limit
     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TraeNoticiasPrincipalesBK($id_empresa, $variable, $limit)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    if ($limit) {
        $limit = " LIMIT 0, $limit";
    } else {
        $limit = " ";
    }
    $sql = "
     SELECT
     tbl_noticias.*, tbl_noticias_categorias.categoria as nombre_categoria, tbl_noticias_principales.prioridad, tbl_noticias_principales.id as id_noticia_principal
FROM
     tbl_noticias
inner JOIN tbl_noticias_principales
on tbl_noticias_principales.idnoticia=tbl_noticias.id
inner join tbl_noticias_categorias
on tbl_noticias_categorias.id=tbl_noticias.categoria
WHERE
     estado = '1' and
     tbl_noticias.id_empresa='$id_empresa' and
     tbl_noticias_principales.idempresa is not NULL
     and slider_activo=0
order BY
     prioridad asc
$limit
     ";
    $sql = "
     SELECT
     tbl_noticias.*, tbl_noticias_categorias.categoria AS nombre_categoria
FROM
     tbl_noticias
INNER JOIN tbl_noticias_categorias ON tbl_noticias_categorias.id = tbl_noticias.categoria
WHERE
     estado = '1'AND
     tbl_noticias.id_empresa = '$id_empresa' AND
     tbl_noticias.principal >0




order BY
     tbl_noticias.fecha_creacion DESC
     $limit
     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TraeNoticiasPrincipalesCom($id_empresa, $variable, $limit)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    if ($limit) {
        $limit = " LIMIT 0, $limit";
    } else {
        $limit = " ";
    }
    $sql = "
     SELECT
     tbl_noticias.*, tbl_noticias_categorias.categoria as nombre_categoria, tbl_noticias_principales.prioridad, tbl_noticias_principales.id as id_noticia_principal
FROM
     tbl_noticias
inner JOIN tbl_noticias_principales
on tbl_noticias_principales.idnoticia=tbl_noticias.id
inner join tbl_noticias_categorias
on tbl_noticias_categorias.id=tbl_noticias.categoria
WHERE
     estado = '1' and tbl_noticias.id_empresa='$id_empresa' and tbl_noticias_principales.idempresa is not NULL and slider_activo=0
order BY
     prioridad asc
$limit
     ";
    $sql = "
     SELECT
     tbl_noticias.*, tbl_noticias_categorias.categoria AS nombre_categoria
FROM
     tbl_noticias
INNER JOIN tbl_noticias_categorias ON tbl_noticias_categorias.id = tbl_noticias.categoria
WHERE
     tbl_noticias.estado = '1' and tbl_noticias.categoria = '39' and tbl_noticias.principal ='0'
and tbl_noticias.id_empresa = '$id_empresa'


order BY
     tbl_noticias.fecha_creacion DESC limit 3
     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TraeNoticiasPrincipalesPorComunidad($id_empresa, $id_comunidad)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    if ($id_comunidad) {
        $variable = " and id_comunidad='$id_comunidad'";
    } else {
        $variable = "";
    }
    $sql = "
     SELECT
     tbl_noticias.*, tbl_noticias_categorias.categoria as nombre_categoria
FROM
     tbl_noticias
inner join tbl_noticias_categorias
on tbl_noticias_categorias.id=tbl_noticias.categoria
WHERE
     estado = '1' and tbl_noticias.id_empresa='$id_empresa' $variable
limit 0,
     6
     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TraeNoticiasPrincipalesPorGerencia($id_empresa, $variable)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    if ($variable) {
        $variable = " and gerencia='$variable'";
    } else {
        $variable = "";
    }
    $sql = "
     SELECT
     tbl_noticias.*, tbl_noticias_categorias.categoria as nombre_categoria
FROM
     tbl_noticias
inner join tbl_noticias_categorias
on tbl_noticias_categorias.id=tbl_noticias.categoria
WHERE
     estado = '1' and tbl_noticias.id_empresa='$id_empresa' $variable
limit 0,
     6
     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TraeNoticiasSecundarias($id_empresa, $limit)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    if ($id_empresa == 22) {
        $datos_usuario_session = UsuarioEnBasePersonas($_SESSION["user_"], $rutcontodo);
        if ($datos_usuario_session[0]->unidad_negocio == "Sucursales") {
            $filtro_mundo = "and (tbl_noticias.id_mundo='0' or tbl_noticias.id_mundo='2')";
        } else if ($datos_usuario_session[0]->unidad_negocio == "Santiago") {
            $filtro_mundo = "and (tbl_noticias.id_mundo='0' or tbl_noticias.id_mundo='1')";
        }
    }
    $sql = "


     SELECT
     tbl_noticias.*, tbl_noticias_categorias.categoria AS nombre_categoria
    FROM
     tbl_noticias
INNER JOIN tbl_noticias_categorias ON tbl_noticias_categorias.id = tbl_noticias.categoria




WHERE
     estado = '1'
AND tbl_noticias.id_empresa = '$id_empresa' and
tbl_noticias.principal=0 and
slider_activo=0


$filtro_mundo
order by orden is  null, orden asc, fecha_creacion desc


$limit


     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TraeNoticiasSecundariasBK($id_empresa, $limit)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "


     SELECT
     tbl_noticias.*, tbl_noticias_categorias.categoria AS nombre_categoria
FROM
     tbl_noticias
INNER JOIN tbl_noticias_categorias ON tbl_noticias_categorias.id = tbl_noticias.categoria




WHERE
     estado = '1'
and tbl_noticias.id_empresa = '$id_empresa' and
tbl_noticias.principal=0 and
lider_activo=0
order BY
     fecha_Creacion DESC


$limit






     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TraeNoticiasMiniSlider($id_empresa, $limit)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select *
     from tbl_noticiasminislider


     WHERE
     id_empresa ='$id_empresa'


     order by orden is  null, orden asc, fecha desc $limit";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TodosComentarios($id_noticia)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_noticias_comentarios WHERE estado = '1' AND id_noticia = '$id_noticia' order by fecha desc";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function InsertarComentario($id_noticia, $usuario, $comentario, $fecha)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "INSERT INTO tbl_noticias_comentarios(id_noticia, id_usuario, comentario, fecha) " . "VALUES ('$id_noticia', '$usuario', '$comentario', '$fecha');";
    $database->setquery($sql);
    $database->query();
}
function ObjetosDadoCursoCruceNota($id_curso, $rut)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "SELECT


     tbl_objeto.*, tbl_tipo_objeto.nombre AS tipo_objeto,


     tbl_tipo_objeto.icono,


     tbl_tipo_objeto.ambiente,


     (select SEC_TO_TIME( SUM( TIME_TO_SEC( tiempo_navegacion ) ) ) as total_tiempo  from tbl_logs_navegacion where tbl_logs_navegacion.id_objeto=tbl_objeto.id and tbl_logs_navegacion.rut='$rut') as total_tiempo,


     tbl_objetos_finalizados.nota as nota_objeto


FROM
     tbl_objeto
INNER JOIN tbl_tipo_objeto ON tbl_tipo_objeto.id = tbl_objeto.tipo_objeto
left join
tbl_objetos_finalizados
on tbl_objetos_finalizados.id_objeto=tbl_objeto.id and tbl_objetos_finalizados.rut='$rut'


WHERE
     tbl_objeto.id_curso = '$id_curso'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ActualizoComentarioEvaluacionJefatura($evaluado, $evaluador, $id_programa, $comentario)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "


     UPDATE tbl_evaluacion_jefe_respuestas


     SET comentario= '" . $comentario . "',


     fecha='" . date("Y-m-d") . "',


     hora='" . date("H:i:s") . "'






     where evaluado='$evaluado'


     and evaluador='$evaluador'


     and id_programa='$id_programa'










     ";
    $database->setquery($sql);
    $database->query();
}
function InsertaComentarioEvaluacionJefe($evaluado, $evaluador, $id_programa, $comentario)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "INSERT INTO tbl_evaluacion_jefe_comentario(evaluado, evaluador, id_programa, fecha, hora, comentario) " . "VALUES ('$evaluado', '$evaluador', '$id_programa', '" . date("Y-m-d") . "', '" . date("H:i:s") . "', '$comentario');";
    $database->setquery($sql);
    $database->query();
}
function TieneComentarioEvaluacionJefe($evaluado, $evaluador, $id_programa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "


     select * from tbl_evaluacion_jefe_comentario


     where evaluado='$evaluado' and evaluador='$evaluador' and id_programa='$id_programa'






     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TieneRespuestasEvaluacionJefeCrucePRogramas($evaluado, $evaluador, $id_programa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "


     select tbl_evaluacion_jefe_respuestas.*, tbl_conductas.nombre as nombre_conducta, tbl_conductas.requerido


     from tbl_evaluacion_jefe_respuestas


     inner join tbl_programa


     on tbl_programa.id=tbl_evaluacion_jefe_respuestas.id_programa


     inner join tbl_conductas


     on tbl_conductas.id=tbl_evaluacion_jefe_respuestas.id_conducta


     where evaluado='$evaluado' and evaluador='$evaluador'  and tbl_evaluacion_jefe_respuestas.id_programa='$id_programa'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function VerificaFinalizadoEvaluacionJefe($evaluado, $evaluador, $id_programa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_evaluacion_jefe_finalizados where evaluado='$evaluado' and evaluador='$evaluador' and id_programa='$id_programa'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function InsertarFinalizadoEvaluacionJefatura($evaluado, $evaluador, $id_programa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "INSERT INTO tbl_evaluacion_jefe_finalizados(evaluado, evaluador, id_programa, fecha, hora) " . "VALUES ('$evaluado', '$evaluador', '$id_programa', '" . date("Y-m-d") . "', '" . date("H:i:s") . "');";
    $database->setquery($sql);
    $database->query();
}
function ActualizaRespuestasEvaluacionJefe($evaluado, $evaluador, $id_conducta, $id_programa, $alternativa, $debilidad)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "


     UPDATE tbl_evaluacion_jefe_respuestas


     SET respuesta= '" . $alternativa . "',


     debilidad='" . $debilidad . "',


     fecha='" . date("Y-m-d") . "',


     hora='" . date("H:i:s") . "'






     where evaluado='$evaluado'


     and evaluador='$evaluador'


     and id_programa='$id_programa'


     and id_conducta='$id_conducta'";
    $database->setquery($sql);
    $database->query();
}
function InsertaRegistroEvaluacionJefe($evaluado, $evaluador, $id_conducta, $id_programa, $alternativa, $debilidad)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "INSERT INTO tbl_evaluacion_jefe_respuestas(evaluado, evaluador, id_conducta, id_programa, respuesta, fecha, hora, debilidad) " . "VALUES ('$evaluado', '$evaluador', '$id_conducta', '$id_programa', '$alternativa', '" . date("Y-m-d") . "', '" . date("H:i:s") . "', '$debilidad');";
    $database->setquery($sql);
    $database->query();
}
function TieneRespuestasEvaluacionJefe($evaluado, $evaluador, $id_conducta, $id_programa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_evaluacion_jefe_respuestas where evaluado='$evaluado' and evaluador='$evaluador' and id_conducta='$id_conducta' and id_programa='$id_programa'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function AlternativasDadoIdPrograma($id)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_evaluacion_jefe_alternativas where id_grupo_alternativas='$id'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ProgramasDadoMallaTraeEvaluacionesJefe($id_malla)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sqlBK = "


     select tbl_programa.*, tbl_evaluacion_jefe.nombre as nombre_evaluacion


     from rel_malla_programa


     inner join tbl_programa


     on tbl_programa.id=rel_malla_programa.id_programa


     inner join tbl_evaluacion_jefe


     on tbl_evaluacion_jefe.id_programa=tbl_programa.id


     where rel_malla_programa.id_malla='$id_malla'


     ";
    $sql   = "


     select tbl_programa.*


from tbl_programa


INNER JOIN tbl_conductas


on tbl_conductas.id_programa=tbl_programa.id


inner join rel_malla_programa


on rel_malla_programa.id_programa=tbl_programa.id


where rel_malla_programa.id_malla='$id_malla'


group BY tbl_programa.id


     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ConductasParaEvaluacionJefePorMalla($malla)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_evaluacion_jefe_conducta_habilidad where id_malla='$malla' ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ListadoUsuariosLideres($rut)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "


     select


     tbl_usuario.*,


     (select count(*) from tbl_usuario as aux where aux.jefe=tbl_usuario.rut) as total,
     base_jefe.nombre_completo as nombre_jefe,
     base_jefe.rut_completo as rut_jefe


     from tbl_usuario


     left join tbl_usuario as base_jefe
     on base_jefe.rut=tbl_usuario.jefe


     where tbl_usuario.jefe='$rut'






";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function EsJefe($rut)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "


     select


     tbl_usuario.*,


     (select count(*) from tbl_usuario as aux where aux.jefe=tbl_usuario.rut) as total,
     base_jefe.nombre_completo as nombre_jefe,
     base_jefe.rut_completo as rut_jefe


     from tbl_usuario


     left join tbl_usuario as base_jefe
     on base_jefe.rut=tbl_usuario.jefe


     where tbl_usuario.jefe='$rut'


     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function InsertaLogNavegacion($rut, $id_objeto, $tiempo_navegado, $id_curso)
{
    global $c_host, $c_user, $c_pass, $c_db;
    if ($tiempo_navegado == "00:00:00") {
        $tiempo_navegado = "00:01:00";
    }
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "INSERT INTO tbl_logs_navegacion(rut, id_objeto, tiempo_navegacion, id_curso, fecha, hora) " . "VALUES ('$rut', '$id_objeto', '$tiempo_navegado', '$id_curso', '" . date("Y-m-d") . "', '" . date("H:i:s") . "');";
    $database->setquery($sql);
    $database->query();
}
function ObtengoTipoCorreoPorId($id)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_correos where id='$id' ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ObtengoTipoCorreoDadoEmpresa($id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_correos where id_empresa='$id_empresa' ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ObtengoTipoCorreo($tipo)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_correos where tipo='$tipo' ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function DatosEmpresa($id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_empresa
     where id='$id_empresa' ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function goplay_cuentarespuestasDesdeIntentos($id_evaluacion_por_objeto, $rut, $numero_intento)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_evaluaciones_respuestas_intentos     where id_objeto='$id_evaluacion_por_objeto' and rut='$rut' and numero_intento='$numero_intento'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function goplay_cuentarespuestas($id_evaluacion_por_objeto, $rut)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_evaluaciones_respuestas     where id_objeto='$id_evaluacion_por_objeto' and rut='$rut'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function PreguntasDadoEvaluacion($id_evaluacion)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_evaluaciones_preguntas


     where evaluacion='$id_evaluacion' and pregunta<>'' ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function DatosEvaluacion($id_evaluacion)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_evaluaciones


     where id='$id_evaluacion'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function RespuestasDadoRutObjeto($rut, $id_objeto)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "SELECT


     tbl_evaluaciones_respuestas.*, tbl_evaluaciones_alternativas.correcta, tbl_evaluaciones_alternativas.puntaje


FROM tbl_evaluaciones_respuestas


inner join tbl_evaluaciones_alternativas


on tbl_evaluaciones_alternativas.id=tbl_evaluaciones_respuestas.id_alternativa


where rut='$rut' and id_objeto='$id_objeto'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function VErificaCursoFinalizado($id_curso, $rut)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_lms_curso_finalizados where id_curso='" . $id_curso . "' and rut='" . $rut . "'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function PersonasDadoCriterio($campo, $valor)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_usuario where $campo='" . $valor . "'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function CriterioMallaPorEmpresaMalla($id_empresa, $id_malla)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from rel_malla where id_empresa='" . $id_empresa . "' and id_malla='" . $id_malla . "'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function RespuestasDadoConductas($rut, $id_conducta, $id_evaluacion)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "






     select tbl_evaluaciones_respuestas.*, tbl_evaluaciones_alternativas.correcta


     from tbl_evaluaciones_respuestas


     inner join tbl_evaluaciones_preguntas


     on tbl_evaluaciones_preguntas.id=tbl_evaluaciones_respuestas.id_pregunta


     inner join tbl_evaluaciones_alternativas


     on tbl_evaluaciones_alternativas.id=tbl_evaluaciones_respuestas.id_alternativa


     where tbl_evaluaciones_preguntas.id_conducta='$id_conducta'


     and tbl_evaluaciones_preguntas.evaluacion='$id_evaluacion'


     and tbl_evaluaciones_respuestas.rut='$rut'






     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function InsertaCursoFinalizado($id_curso, $rut)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "INSERT INTO tbl_lms_curso_finalizados(id_curso, rut, fecha, hora) " . "VALUES ('$id_curso', '$rut',  '" . date("Y-m-d") . "', '" . date("H:i:s") . "');";
    $database->setquery($sql);
    $database->query();
}
function ObjetosFinalizadosDadoCursoYRut($id_curso, $rut)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select tbl_objetos_finalizados.*


     from tbl_objetos_finalizados


     inner join tbl_objeto


     on tbl_objeto.id=tbl_objetos_finalizados.id_objeto


     where tbl_objeto.id_curso='$id_curso' and tbl_objetos_finalizados.rut='$rut'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ObtenerConductasPorPrograma($id_programa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_conductas


     where id_programa='$id_programa'


     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ObtenerRespuestaDeUsuario($id_pregunta, $rut)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select tbl_evaluaciones_respuestas.*,
     tbl_evaluaciones_alternativas.correcta,
     tbl_evaluaciones_alternativas.alternativa,
     tbl_evaluaciones_alternativas.id_grupo_alternativas,
     (select alternativa from tbl_evaluaciones_alternativas as alt1 where alt1.id_grupo_alternativas=tbl_evaluaciones_alternativas.id_grupo_alternativas and alt1.correcta='1') as alternativa_correcta




FROM


     tbl_evaluaciones_respuestas


left JOIN tbl_evaluaciones_alternativas ON tbl_evaluaciones_respuestas.id_alternativa = tbl_evaluaciones_alternativas.id


WHERE


     tbl_evaluaciones_respuestas.rut = '$rut'


and tbl_evaluaciones_respuestas.id_pregunta = '$id_pregunta'


     ";
    //echo "<br><br>$id_pregunta<br>$sql<br>";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ObtengoCorrectaDePregunta($id_pregunta)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select tbl_evaluaciones_alternativas.*


from tbl_evaluaciones_alternativas


INNER JOIN tbl_pregunta


on tbl_pregunta.id_grupo_alternativa=tbl_evaluaciones_alternativas.id_grupo_alternativas


where tbl_pregunta.id='$id_pregunta' and correcta='1'






     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function PreguntasDadoIdObjeto($id_objeto)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "SELECT


     tbl_evaluaciones_preguntas.*


FROM


     tbl_evaluaciones_preguntas


INNER JOIN tbl_objeto on tbl_evaluaciones_preguntas.evaluacion = tbl_objeto.id_evaluacion


WHERE


     tbl_objeto.id ='$id_objeto'






     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TotalPreguntasDadaEvaluacion($id_evaluacion)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_evaluaciones_preguntas


     where evaluacion='$id_evaluacion' ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ActualizaPaginaEvalContenidos($rut, $pagina, $id_objeto)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "UPDATE tbl_evaluaciones_sesion SET pagina= '" . $pagina . "' WHERE rut = '" . $rut . "' and id_objeto='$id_objeto'";
    $database->setquery($sql);
    $database->query();
}
function ActualizaRespuestaEvalContenidos($rut, $alternativa, $id_pregunta, $id_objeto, $tiempo_evaluacion, $id_empresa, $puntaje, $id_inscripcion, $correcta, $numero_intento_actual)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "UPDATE tbl_evaluaciones_respuestas
    SET
    id_empresa= '" . $id_empresa . "',
    puntaje= '" . $puntaje . "',
    id_alternativa= '" . $alternativa . "',
    id_inscripcion= '" . $id_inscripcion . "',
    correcta= '" . $correcta . "',
    tiempo_evaluacion='$tiempo_evaluacion'

    WHERE rut = '" . $rut . "' and id_pregunta='$id_pregunta'";
    $database->setquery($sql);
    $database->query();



    $database->setquery($sql);
    $database->query();




       $sql = "UPDATE tbl_evaluaciones_respuestas_intentos
    SET
    id_empresa= '" . $id_empresa . "',
    puntaje= '" . $puntaje . "',
    id_alternativa= '" . $alternativa . "',
    id_inscripcion= '" . $id_inscripcion . "',
    correcta= '" . $correcta . "',
    tiempo_evaluacion='$tiempo_evaluacion'

    WHERE rut = '" . $rut . "' and id_pregunta='$id_pregunta' and numero_intento='$numero_intento_actual'";
    $database->setquery($sql);
    $database->query();



    $database->setquery($sql);
    $database->query();






}
function InsertaRespuesta($rut, $alternativa, $id_pregunta, $id_objeto, $tiempo_evaluacion, $id_empresa, $puntaje, $correcta, $numero_intento, $id_desafio_preguntados, $comentario, $id_inscripcion)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "INSERT INTO tbl_evaluaciones_respuestas(rut, id_pregunta, id_alternativa, id_objeto, fecha, hora, tiempo_evaluacion, id_empresa, puntaje, correcta, numero_intento, comentarios, id_inscripcion) " . "VALUES ('$rut', '$id_pregunta', '$alternativa', '$id_objeto',  '" . date("Y-m-d") . "', '" . date("H:i:s") . "', '$tiempo_evaluacion', '$id_empresa', '$puntaje', '$correcta', '$numero_intento', '$comentario', '$id_inscripcion');";
    $database->setquery($sql);
    $database->query();
    $sql = "INSERT INTO tbl_evaluaciones_respuestas_intentos(rut, id_pregunta, id_alternativa, id_objeto, fecha, hora, tiempo_evaluacion, id_empresa, puntaje, correcta, numero_intento, id_desafio_preguntados, comentarios, id_inscripcion) " . "VALUES ('$rut', '$id_pregunta', '$alternativa', '$id_objeto',  '" . date("Y-m-d") . "', '" . date("H:i:s") . "', '$tiempo_evaluacion', '$id_empresa', '$puntaje', '$correcta', '$numero_intento', '$id_desafio_preguntados', '$comentario', '$id_inscripcion');";
    $database->setquery($sql);
    $database->query();
}
function VerificoSiTieneRespuestasObj($rut, $id_pregunta, $id_objeto)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_evaluaciones_respuestas


     where rut='$rut' and id_pregunta='$id_pregunta' and id_objeto='$id_objeto'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function VerificoSiTieneRespuestas($rut, $id_pregunta)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_evaluaciones_respuestas


     where rut='$rut' and id_pregunta='$id_pregunta'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function InsertaRegistroTablaSesionEvaluacionContenido($rut, $id_objeto, $pagina)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "INSERT INTO tbl_evaluaciones_sesion(rut, id_objeto, pagina, fecha, hora) " . "VALUES ('$rut', '$id_objeto', '$pagina', '" . date("Y-m-d") . "', '" . date("H:i:s") . "');";
    $database->setquery($sql);
    $database->query();
}
function AlternativasDadoId($id_alternativa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_evaluaciones_alternativas


     where id_grupo_alternativas='$id_alternativa'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function PreguntaDeEvaluacion($id_evaluacion, $numero)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "SELECT


     tbl_evaluaciones_preguntas.*, tbl_evaluaciones_tipo_preguntas.tipo AS tipo_pregunta,


     tbl_evaluaciones_tipo_preguntas.template AS template_pregunta,
     tbl_evaluaciones_tipo_preguntas.template_feedback AS template_pregunta_feedback


FROM


     tbl_evaluaciones_preguntas


INNER JOIN tbl_evaluaciones_tipo_preguntas ON tbl_evaluaciones_tipo_preguntas.id = tbl_evaluaciones_preguntas.tipo


WHERE


     evaluacion = '$id_evaluacion'


and orden = '$numero'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function SesionEvaluacionContenidos($id_evaluacion, $rut)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_evaluaciones_sesion


     where rut='$rut' and id_objeto='$id_evaluacion'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function IngresoObjetoFinalizado($rut, $id_objeto, $tiempo, $nota_eval, $tiempo_evaluacion, $id_curso, $id_inscripcion)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    if($id_inscripcion){
        $sql = "INSERT INTO tbl_objetos_finalizados(rut, id_objeto, tiempo_navegado, fecha, hora, nota, tiempo_evaluacion, id_curso, id_inscripcion) " . "VALUES ('$rut', '$id_objeto', '$tiempo', '" . date("Y-m-d") . "', '" . date("H:i:s") . "', '$nota_eval', '$tiempo_evaluacion', '$id_curso', '$id_inscripcion');";
    }else{
        $sql = "INSERT INTO tbl_objetos_finalizados(rut, id_objeto, tiempo_navegado, fecha, hora, nota, tiempo_evaluacion, id_curso) " . "VALUES ('$rut', '$id_objeto', '$tiempo', '" . date("Y-m-d") . "', '" . date("H:i:s") . "', '$nota_eval', '$tiempo_evaluacion', '$id_curso');";
    }
      //echo"IngresoObjetoFinalizado<br>sql $sql";
    $database->setquery($sql);
    $database->query();
}
function LeoTipsGanados($id_objeto, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select h.* from tbl_lms_tips h where id_objeto='$id_objeto' and id_empresa='$id_empresa'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ObtenerTipsGanados($rut, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select h.*,(select tips from tbl_lms_tips where id_tip=h.id_tip and id_empresa=h.id_empresa) as tip ,
     (select masinfo from tbl_lms_tips where id_tip=h.id_tip and id_empresa=h.id_empresa) as masinfo ,


     (select titulo from tbl_objeto where id=h.id_objeto ) as modulo
     from tbl_lms_tips_ganados h where rut='$rut' and id_empresa='$id_empresa'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function CuentaObtenerTipsGanados($rut, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select count(id) as cuenta from tbl_lms_tips_ganados  where rut='$rut' and id_empresa='$id_empresa'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod[0]->cuenta;
}
function CuentaPuntosGanados($rut, $id_empresa, $id_malla)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $cod[0]->sumapuntos = 0;
    $database           = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select sum(puntos) as sumapuntos from tbl_gamificado_puntos  where rut='$rut' and id_empresa='$id_empresa' and id_malla='$id_malla'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod[0]->sumapuntos;
}
function traeLineasObjetov($id_empresa, $tipo, $id_objeto, $limit)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    if ($tipo == "opinion") {
        $sql = "SELECT
     h.*,
(    select count(id) as cuenta from tbl_objeto_comentarios_megusta where id_comentario=h.id) as cuenta
FROM
     tbl_objeto_comentarios h
WHERE
     id_objeto = '$id_objeto'


order by (select count(id) as cuenta from tbl_objeto_comentarios_megusta where id_comentario=h.id) DESC
limit $limit";
    } elseif ($tipo == "compromiso") {
        $sql = "SELECT
     tbl_objeto_compromisos.*,
     (select count(*) as total from tbl_objeto_compromisos_megusta where tbl_objeto_compromisos_megusta.id_compromiso=tbl_objeto_compromisos.id) as total_megusta
FROM
     tbl_objeto_compromisos
WHERE
     tbl_objeto_compromisos.id_objeto = '$id_objeto'
limit $limit";
    }
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function traeLineasFaqs($id_empresa, $id_malla)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    if ($malla == "") {
        $querymalla = "  ";
    } else {
        $querymalla = " and h.id_malla='$id_malla' ";
    }
    $sql = "select h.*,
     (select nombre_cat from tbl_lms_faq_cat where id_faq_cat=h.id_cat_faq) as categoria
     from tbl_lms_faqs h
     where h.id_empresa='$id_empresa'
     $querymalla";
    $database->setquery($sql);
    $database->query();
    echo $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function traetituloObjeto($id_empresa, $id_objeto)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select h.* from tbl_objeto h
     where id='$id_objeto' and id_empresa='$id_empresa'


     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function InsertUpdateTipsGanados($id_objeto, $id_tip, $rut, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select count(id) as cuenta from tbl_lms_tips_ganados
     where rut='$rut' and id_objeto='$id_objeto' and id_tip='$id_tip' and id_empresa='$id_empresa'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    if ($cod[0]->cuenta == '0') {
        $fecha = date("Y-m-d");
        $sql   = "INSERT INTO tbl_lms_tips_ganados(id_tip, id_objeto, rut, id_empresa, fecha) " . "VALUES ('$id_tip','$id_objeto', '$rut', '$id_empresa', '$fecha');";
        $database->setquery($sql);
        $database->query();
    } else {
    }
    return $cod;
}
function VerObjetoFinalizado($id_objeto, $rut)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_objetos_finalizados


     where rut='$rut' and id_objeto='$id_objeto'";

     //echo $sql;
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function DatosObjeto($id_objeto)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
     select
     tbl_objeto.*,
     tbl_tipo_objeto.ambiente,
     tbl_paginas_templates.template as template_para_entorno,
     tbl_objetos_extension.template,
     tbl_objetos_extension.template_lectura,
     tbl_objetos_extension.template_check
     from tbl_objeto


     left join tbl_tipo_objeto
     on tbl_tipo_objeto.id=tbl_objeto.tipo_objeto


     left join tbl_paginas_templates
     on tbl_paginas_templates.id=tbl_objeto.id_template


     left join tbl_objetos_extension
     on tbl_objetos_extension.id=tbl_objeto.extension_objeto


     where tbl_objeto.id='$id_objeto'";

     //echo $sql; sleep(5);
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function DetalleCurso($id_curso)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
     select tbl_lms_curso.*,
     tbl_modalidad_curso.modalidad as nombre_modalidad
     from tbl_lms_curso
     left join tbl_modalidad_curso
     on tbl_modalidad_curso.id=tbl_lms_curso.modalidad
     where tbl_lms_curso.id='$id_curso'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function DetalleCursoConSumaNavegacionPorObjeto($id_curso)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "
     SELECT
     tbl_lms_curso.*, tbl_modalidad_curso.modalidad AS nombre_modalidad,


     (
     SELECT
     SEC_TO_TIME(
     SUM(
     TIME_TO_SEC(duracion_video)
     )
     ) AS total_tiempo
     FROM
     tbl_objeto
     WHERE
     tbl_objeto.id_curso = tbl_lms_curso.id
     ) as suma_total_tiempo
FROM
     tbl_lms_curso
LEFT JOIN tbl_modalidad_curso ON tbl_modalidad_curso.id = tbl_lms_curso.modalidad
WHERE
     tbl_lms_curso.id = '$id_curso'
     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ObjetosDadoCurso($id_curso, $rut)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "SELECT


     tbl_objeto.*, tbl_tipo_objeto.nombre AS tipo_objeto,


     tbl_tipo_objeto.icono,


     tbl_tipo_objeto.ambiente,


     tbl_objeto.tipo_objeto as tipo_de_objeto,


     tbl_objetos_finalizados.nota as nota_objeto,


     tbl_objetos_finalizados.fecha as fecha_finalizacion,


     (select SEC_TO_TIME( SUM( TIME_TO_SEC( tiempo_navegacion ) ) ) as total_tiempo  from tbl_logs_navegacion where tbl_logs_navegacion.id_objeto=tbl_objeto.id and tbl_logs_navegacion.rut='$rut') as total_tiempo,






(    select count(*) from tbl_evaluaciones_preguntas WHERE tbl_evaluaciones_preguntas.evaluacion=tbl_objeto.id_evaluacion) as total_preguntas_por_objeto


FROM


     tbl_objeto


INNER JOIN tbl_tipo_objeto ON tbl_tipo_objeto.id = tbl_objeto.tipo_objeto


left join


tbl_objetos_finalizados


on tbl_objetos_finalizados.id_objeto=tbl_objeto.id and tbl_objetos_finalizados.rut='$rut'


WHERE


tbl_objeto.id_curso = '$id_curso'
group by tbl_objeto.id




order by fecha_finalizacion ASC, orden ASC";
    //order by tbl_objeto.orden asc";
    //echo "<br><br>$sql<br><br>";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    // print_r($cod);
    return $cod;
}
function ObjetosDadoCursoOrden($id_curso, $rut, $vista, $dia)
{
    //vista 1 por orden
    // vista 2 por estado
    if ($vista == "1") {
        $order = " order by orden ASC ";
    } else {
        $order = " order by fecha_finalizacion ASC, orden ASC ";
    }
    //echo "<br>vista np $vista";
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    if($dia=="VIDEOS"){
        $filtro_videos=" and tbl_objeto.tipo_objeto='3' ";
    }
    $sql = "SELECT


     tbl_objeto.*, tbl_tipo_objeto.nombre AS tipo_objeto,


     tbl_tipo_objeto.icono,


     tbl_tipo_objeto.ambiente,


     tbl_objeto.tipo_objeto as tipo_de_objeto,


     tbl_objetos_finalizados.nota as nota_objeto,


     tbl_objetos_finalizados.fecha as fecha_finalizacion,


     (select SEC_TO_TIME( SUM( TIME_TO_SEC( tiempo_navegacion ) ) ) as total_tiempo  from tbl_logs_navegacion where tbl_logs_navegacion.id_objeto=tbl_objeto.id and tbl_logs_navegacion.rut='$rut') as total_tiempo,






(select count(*) from tbl_evaluaciones_preguntas WHERE tbl_evaluaciones_preguntas.evaluacion=tbl_objeto.id_evaluacion) as total_preguntas_por_objeto


FROM


     tbl_objeto


INNER JOIN tbl_tipo_objeto ON tbl_tipo_objeto.id = tbl_objeto.tipo_objeto


left join


tbl_objetos_finalizados


on tbl_objetos_finalizados.id_objeto=tbl_objeto.id and tbl_objetos_finalizados.rut='$rut'


WHERE


tbl_objeto.id_curso = '$id_curso' $filtro_videos
group by tbl_objeto.id


$order
";
    //order by tbl_objeto.orden asc";
    if($dia=="VIDEOS"){

    }

    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    // print_r($cod);
    return $cod;
}
function ObjetosDadoInscripcion($id_inscripcion, $rut)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "SELECT


     tbl_objeto.*, tbl_tipo_objeto.nombre AS tipo_objeto,


     tbl_tipo_objeto.icono,


     tbl_tipo_objeto.ambiente,


     tbl_objeto.tipo_objeto as tipo_de_objeto,


     tbl_objetos_finalizados.nota as nota_objeto,


     tbl_objetos_finalizados.fecha as fecha_finalizacion,


     (select SEC_TO_TIME( SUM( TIME_TO_SEC( tiempo_navegacion ) ) ) as total_tiempo  from tbl_logs_navegacion where tbl_logs_navegacion.id_objeto=tbl_objeto.id and tbl_logs_navegacion.rut='$rut') as total_tiempo,






(    select count(*) from tbl_evaluaciones_preguntas WHERE tbl_evaluaciones_preguntas.evaluacion=tbl_objeto.id_evaluacion) as total_preguntas_por_objeto


FROM


     tbl_objeto


INNER JOIN tbl_tipo_objeto ON tbl_tipo_objeto.id = tbl_objeto.tipo_objeto


left join


tbl_objetos_finalizados


on tbl_objetos_finalizados.id_objeto=tbl_objeto.id and tbl_objetos_finalizados.rut='$rut'


WHERE


     tbl_objeto.id_curso = '$id_inscripcion'


     order by tbl_objeto.orden asc";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ObjetosDadoCursoSoloId($id_curso)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "SELECT


     tbl_objeto.*,


     tbl_tipo_objeto.nombre AS tipo_objeto,


     tbl_tipo_objeto.icono,


     tbl_tipo_objeto.ambiente






FROM


     tbl_objeto


INNER JOIN tbl_tipo_objeto ON tbl_tipo_objeto.id = tbl_objeto.tipo_objeto










WHERE


     tbl_objeto.id_curso = '$id_curso'


     order by tbl_objeto.id asc";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function DetalleNivel($id_nivel)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_nivel


     where id='$id_nivel'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function CursosDadoNivel($id_nivel)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select tbl_lms_curso.*,  tbl_modalidad_curso.modalidad as tipo_metodologia, (select count(*) from tbl_objeto where tbl_objeto.id_curso=tbl_lms_curso.id) as total_objetos


,    (select SEC_TO_TIME( SUM( TIME_TO_SEC( duracion_video ) ) ) as total_tiempo
from tbl_objeto where tbl_objeto.id_curso=tbl_lms_curso.id) as total_suma_tiempos_objetos    from
     rel_nivel_curso
     inner join tbl_lms_curso
     on tbl_lms_curso.id=rel_nivel_curso.id_curso
     inner join tbl_modalidad_curso
     on tbl_modalidad_curso.id=tbl_lms_curso.modalidad
     where rel_nivel_curso.id_nivel='$id_nivel'  order by certificacion asc
     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function DatosPrograma($id)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_programa where id='$id'";
    //echo "$sql";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function NivelesDadoPrograma($id_programa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select tbl_nivel.*, tbl_usuario.nombre_completo


     from tbl_nivel


     left join tbl_usuario


     on tbl_usuario.rut=tbl_nivel.tutor


     where tbl_nivel.id_programa='" . $id_programa . "' ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function NotaAprobacionDadoMallaPrograma($id_malla, $id_programa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "






     select * from rel_malla_programa where id_malla='$id_malla' and id_programa='$id_programa'






     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function ProgramasDadoMalla($id_malla)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select tbl_programa.*


     from rel_malla_programa


     inner join tbl_programa


     on tbl_programa.id=rel_malla_programa.id_programa


     where rel_malla_programa.id_malla='$id_malla'


     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function VerificaCriterioMalla($campo, $criterio, $rut, $id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_usuario where $campo='" . $criterio . "' and rut='$rut' and id_empresa='$id_empresa'";
    $sql = "select * from tbl_usuario where rut='$rut' and id_empresa='$id_empresa'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function MallasPorEmpresa2($id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_lms_malla where id_empresa='" . $id_empresa . "' order by nombre asc";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function MallasPorEmpresa($id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_lms_malla where id_empresa='" . $id_empresa . "'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function CambiarClave($rut, $clave)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $fecha       = date("Y-m-d");
    $existe_base = UsuarioEnBasePersonas($rut, $rutcontodo);
    $sql_busca   = "select id  from tbl_clave where rut='" . $rut . "'";
    $database->setquery($sql_busca);
    $database->query();
    $cod = $database->listObjects();
    if ($cod[0]->id > 0) {
        $sql = "UPDATE tbl_clave SET clave= '" . $clave . "', cambiado='1', fecha_cambio='" . $fecha . "' WHERE rut = '" . $rut . "'";
    } else {
        $sql = "UPDATE tbl_clave SET clave= '" . $clave . "', cambiado='1', fecha_cambio='" . $fecha . "' WHERE rut = '" . $rut . "'";
        $sql = "INSERT INTO tbl_clave
     (rut, clave, cambiado, fecha_cambio, id_empresa) " . "
     VALUES ('$rut', '$clave', '1', '" . date("Y-m-d") . "', '" . $existe_base[0]->id_empresa . "');";
    }
    //echo $sql;
    //exit();
    $database->setquery($sql);
    $database->query();
}
function VerificaClaveAcceso($rut, $clave)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $clave    = utf8_decode($clave);
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_clave where rut='" . mysql_real_escape_string($rut) . "' and clave='" . mysql_real_escape_string($clave) . "'";
    $sql = "select * from tbl_clave where rut='" . $rut . "' and clave='" . $clave . "'";
    //echo $sql;
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    if ($cod[0]->id == "") {
        $existe_base      = UsuarioEnBasePersonas($rut, $rutcontodo);
        $NoCambiaClaveArr = VerificaNoCambiaClaveAccesoObligatorio($existe_base[0]->id_empresa);
        $NoCambiaClave    = $NoCambiaClaveArr[0]->nocambiaclaveobligatorio;
        if ($NoCambiaClave <> 1) {
            $obligatorio = 0;
        } else {
            $obligatorio = 1;
        }
        $rutcuatroprimeros = substr($rut, 0, 4);
        $sql               = "INSERT INTO tbl_clave(rut, clave, cambiado, fecha, id_empresa) " . "VALUES ('$rut', '$rutcuatroprimeros', '$obligatorio', '" . date("Y-m-d") . "', '" . $existe_base[0]->id_empresa . "');";
        $database->setquery($sql);
        $database->query();
        $sql = "select * from tbl_clave where rut='" . mysql_real_escape_string($rut) . "' and clave='" . mysql_real_escape_string($clave) . "'";
        $sql = "select * from tbl_clave where rut='" . $rut . "' and clave='" . $clave . "'";
        $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();
    }
    return $cod;
}
function VerificaClaveAccesoSoloRut($rut)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_clave where rut='" . mysql_real_escape_string($rut) . "' ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function UsuarioEnBasePersonasCruceEmpresa2($rut)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "






     SELECT


     tbl_usuario.rut,


     tbl_empresa.id as idempresa,


     tbl_empresa.case_home,


     tbl_empresa.tokem_validacion_externo


FROM


     tbl_usuario


INNER JOIN tbl_empresa ON tbl_empresa.id = tbl_usuario.id_empresa


WHERE


     rut = '$rut'






     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function UsuarioEnBasePersonasConEvaluadorValidador($rut)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "SELECT
     tbl_usuario.*,
     baseevaluador.nombre_completo AS nombre_evaluador,
     basevalidador.nombre_completo AS nombre_validador,
     tbl_sgd_relaciones.evaluador as rut_evaluador,
     tbl_sgd_relaciones.validador as rut_validador
FROM
     tbl_usuario
INNER JOIN tbl_sgd_relaciones ON tbl_sgd_relaciones.evaluado = tbl_usuario.rut
INNER JOIN tbl_usuario AS baseevaluador ON baseevaluador.rut = tbl_sgd_relaciones.evaluador
INNER JOIN tbl_usuario AS basevalidador ON basevalidador.rut = tbl_sgd_relaciones.validador


WHERE
     tbl_usuario.rut = '$rut'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function UsuarioEnBasePersonasConRelacionEvaluadoEvaluador($rut, $evaluador, $id_proceso)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select rut, nombre, apaterno, amaterno, nombre_completo, cargo, gerencia, tbl_usuario.id_empresa, id_area,
     tbl_sgd_relaciones.evaluador,
     tbl_sgd_relaciones.perfil_evaluacion_competencias as perfil_evaluacion,
     tbl_sgd_relaciones.subperfil


     from tbl_usuario
     inner join tbl_sgd_relaciones
     on tbl_sgd_relaciones.evaluado='$rut'
     and tbl_sgd_relaciones.evaluador='$evaluador'
     and tbl_sgd_relaciones.id_proceso='$id_proceso'


     where rut='" . $rut . "'


     ";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function UsuarioEnBasePersonas($rut, $rut_contodo)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_usuario where rut='" . $rut . "'   and '" . $rut . "'<>'' and vigencia='0'";
    //    echo "$c_host, $c_user, $c_pass, $c_db $sql"; sleep(1);
    //exit();
    $database->setquery($sql);
    $database->query();
    $cod    = $database->listObjects();
    $rutKey = $cod[0]->rut;
    if ($rutKey == "") {
        $sql = "select * from tbl_usuario where email='" . $rut_contodo . "'   and '" . $rut_contodo . "'<>'' and vigencia='0'";
        $database->setquery($sql);
        $database->query();
        $cod    = $database->listObjects();
        $rutKey = $cod[0]->rut;
        if ($rutKey == "") {
            $order               = array(
                ".",
                "-",
                " "
            );
            $replace             = '';
            $rut_contodo_limipio = str_replace($order, $replace, $rut_contodo);
            $sql                 = "select * from tbl_usuario where rut='" . $rut_contodo_limipio . "'   and '" . $rut_contodo_limipio . "'<>'' and vigencia='0'";
            $database->setquery($sql);
            $database->query();
            $cod    = $database->listObjects();
            $rutKey = $cod[0]->rut;
            if ($rutKey == "") {
                $order                    = array(
                    ".",
                    "-",
                    " "
                );
                $replace                  = '';
                $rut_contodo_limipio      = str_replace($order, $replace, $rut_contodo);
                $cuentacaracteres         = strlen($rut_contodo_limipio);
                $cuentacaracteresmenosuno = $cuentacaracteres - 1;
                $rut_limpio_sindigito     = substr($rut_contodo_limipio, 0, $cuentacaracteresmenosuno);
                $sql                      = "select * from tbl_usuario where rut='" . $rut_limpio_sindigito . "'   and '" . $rut_limpio_sindigito . "'<>'' and vigencia='0'";
                $database->setquery($sql);
                $database->query();
                $cod    = $database->listObjects();
                $rutKey = $cod[0]->rut;
                return $cod;
            }
            return $cod;
        } else {
            return $cod;
        }
    } else {
        return $cod;
    }
    exit;
}
function UsuarioAdminEmpresa($id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_admin where id_empresa='" . $id_empresa . "'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function VerificaNoCambiaClaveAccesoObligatorio($empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from tbl_empresa where id='" . $empresa . "'   and '" . $empresa . "'<>''";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function UsuarioEnBasePersonas2($rut)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "


     select tbl_usuario.perfil_evaluacion, tbl_sgd_perfiles_ponderaciones.descripcion as nombre_perfil


     from tbl_usuario


     inner join tbl_sgd_perfiles_ponderaciones


     on


     tbl_usuario.perfil_evaluacion=tbl_sgd_perfiles_ponderaciones.perfil


     where rut='" . $rut . "'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function UsuarioEnBasePersonas2PorProceso($rut, $id_proceso)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "


     select DISTINCT(tbl_sgd_relaciones.perfil_evaluacion_competencias) as perfil_evaluacion,
tbl_sgd_perfiles_ponderaciones.descripcion AS nombre_perfil
from tbl_sgd_relaciones
inner join tbl_sgd_perfiles_ponderaciones on tbl_sgd_relaciones.perfil_evaluacion_competencias=tbl_sgd_perfiles_ponderaciones.perfil
where tbl_sgd_relaciones.evaluado='$rut' and tbl_sgd_relaciones.id_proceso='$id_proceso'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function UsuarioEnBasePersonasInnerArea($rut)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select tbl_usuario.*, tbl_area.area as nombre_area
     from tbl_usuario
     inner join tbl_area
     on tbl_area.id=tbl_usuario.id_area
     where rut='" . $rut . "'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function UsuarioEnBaseDePersonasInnerEmpresa($rut)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select tbl_usuario.*, tbl_empresa.campo1, tbl_empresa.campo2, tbl_empresa.campo3
     from tbl_usuario
     inner join tbl_empresa
     on tbl_empresa.id=tbl_usuario.id_empresa
     where rut='" . $rut . "'";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function TraeDatos()
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from go_proceso";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    return $cod;
}
function DatosProceso()
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "select * from go_proceso";
    $database->setquery($sql);
    $database->query();
    $qwerty = $database->listObjects();
    return $qwerty;
}

function mp_buscaDATOSPERSONAS($rut, $id_empresa)
{

    //echo "<br>mp_buscaDATOSPERSONAS rut $rut, ide $id_empresa";

    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);
    $sql = "


    select h.*,
(select biografia from tbl_usuario_biografia where rut=h.rut and id_empresa=h.id_empresa limit 1) as biografia,
(select sueno from tbl_usuario_biografia where rut=h.rut and id_empresa=h.id_empresa  limit 1) as sueno,
(select logros from tbl_usuario_biografia where rut=h.rut and id_empresa=h.id_empresa  limit 1) as logros,
(select avatar from tbl_usuario_biografia where rut=h.rut and id_empresa=h.id_empresa  limit 1) as avatarcomunidad,
(select celular from tbl_usuario_biografia where rut=h.rut and id_empresa=h.id_empresa  limit 1) as celular

 from tbl_usuario h where h.id_empresa='$id_empresa' and h.rut='$rut'


    ";

    //echo "<br>$sql";
    $database->setquery($sql);
    $database->query();
    $cod = $database->listObjects();
    //print_r($cod);

    return $cod;
}


?>